2006-06-13 09:10  Timo Sirainen <tss@iki.fi>

	* src/deliver/Makefile.am: Added mountpoint.o to unused objects
	  list

2006-06-12 16:03  Timo Sirainen <tss@iki.fi>

	* src/deliver/: Makefile.am, deliver.c: Changed hardcoded
	  /var/run/dovecot to PKG_RUNDIR.

2006-06-12 16:02  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated LDA's default auth_socket_path

2006-06-12 15:46  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated postmaster_address and hostname
	  setting descriptions.

2006-06-12 15:42  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Changed default postmaster_address to
	  @example.com

2006-06-12 12:46  Timo Sirainen <timo.sirainen@movial.fi>

	* src/master/mail-process.c: dovecot --exec-mail ext <binary path>
	  now reads the default settings from configuration file, puts them
	  to environment and executes the given binary.

2006-06-12 08:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-file.c, dbox-file.h,
	  dbox-mail.c, dbox-save.c, dbox-storage.h, dbox-sync-expunge.c,
	  dbox-sync-full.c, dbox-sync.c: Allow reading saved mails which
	  haven't been committed yet (ie. make quota plugin work).

2006-06-11 21:55  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Set PAM_TTY.

2006-06-11 21:40  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added protocol lda section.

2006-06-11 20:13  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf:
	  s/login_process_per_use/login_process_per_connection/

2006-06-11 20:12  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Moved around settings and added some main
	  groups to them, hopefully making it easier to find them.

2006-06-11 19:58  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Moved the socket listen example into auth
	  default instead of having its own auth block, which confused
	  people.

2006-06-11 19:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-view-private.h,
	  mail-index-view-sync.c, mail-index-view.c,
	  mail-transaction-log-append.c: We used "already synced log
	  positions in view" array to store locations of committed hidden
	  transactions. They however weren't really synced, which caused
	  some problems. Added a separate "hidden sync log positions" array
	  for them which is handled differently.

2006-06-11 18:14  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/passdb-pam.c: Don't call
	  pam_setcred() unless setcred=yes PAM passdb argument was given.

2006-06-11 17:51  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-subscribe.c: If tb-extra-mailbox-sep workaround was
	  enabled, subscribing was broken unless the namespace had empty
	  prefix.

2006-06-11 17:44  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: If running from inetd, don't try to open/close
	  listener sockets when receiving SIGHUP.

2006-06-11 17:34  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/quota/: quota-dict.c, quota-dirsize.c, quota-fs.c,
	  quota-maildir.c, quota-private.h, quota-storage.c, quota.c,
	  quota.h: If size of the mail was known before saving started, we
	  allocated the quota twice for it.

2006-06-11 16:11  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/quota/quota-storage.c: Update quota when deleting a
	  mailbox.

2006-06-11 16:04  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-expunge.c: If mailbox_search_deinit() fails, we
	  leaked a bit of memory.

2006-06-11 15:00  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: Starting pop3 processes from inetd
	  started actually imap processes after login.

2006-06-11 14:48  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Updates to
	  ssl_verify_client_cert: Check CRLs. If auth_verbose=yes, log
	  invalid sent certificates. If verbose_ssl=yes, log even the valid
	  certificates. When using the username from the certificate, use
	  CommonName.  Based on patch by HenkJan Wolthuis

2006-06-11 14:06  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/maildir/maildir-mail.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/maildir/maildir-util.c,
	  plugins/quota/Makefile.am, plugins/quota/quota-maildir.c: Add
	  ",S=size" to maildir filenames when quota plugin is loaded with
	  Maildir++ backend.

2006-06-11 12:51  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, passdb-pam.c, passdb.h: If password is
	  expired, give "Password expired" error. Currently works only with
	  PAM. Also added "unknown user" PAM return value handling.

2006-06-11 12:11  Timo Sirainen <tss@iki.fi>

	* src/auth/db-sql.c: s/ldap/sql/ in error message

2006-06-11 12:08  Timo Sirainen <tss@iki.fi>

	* INSTALL: Removed most of the content and added links to Wiki
	  instead.

2006-06-11 12:07  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't enable GSSAPI support by default

2006-06-11 11:49  Timo Sirainen <tss@iki.fi>

	* configure.in: Whitespace cleanup for --help

2006-06-11 11:37  Timo Sirainen <tss@iki.fi>

	* src/deliver/: auth-client.c, auth-client.h, deliver.c: Don't try
	  to change uid/gid to the same one it already is.

2006-06-11 11:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-fields.c: If cache field's size is
	  wrong, rebuild the cache file instead of crashing sometimes
	  later.

2006-06-11 11:19  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c: If file begins with
	  ".nfs", stat() it always to see if it's a directory since it may
	  be a temporary file created by kernel.

2006-06-11 11:10  Timo Sirainen <tss@iki.fi>

	* configure.in, src/Makefile.am, src/deliver/Makefile.am,
	  src/deliver/auth-client.c, src/deliver/auth-client.h,
	  src/deliver/deliver.c, src/deliver/deliver.h,
	  src/deliver/duplicate.c, src/deliver/duplicate.h,
	  src/deliver/mail-send.c, src/deliver/mail-send.h,
	  src/deliver/smtp-client.c, src/deliver/smtp-client.h: Moved all
	  the non-Sieve code from dovecot-lda in here and rewrote parts of
	  it to be cleaner. The Sieve code can now be run as a plugin from
	  dovecot-sieve CVS module.

2006-06-11 11:07  Timo Sirainen <tss@iki.fi>

	* .cvsignore, Makefile.am, dovecot-config.in, dovecot-config.in.in:
	  dovecot-config contains now module_dir.

2006-06-09 11:04  Timo Sirainen <tss@iki.fi>

	* doc/mkcert.sh: If cert/key directories don't exist, exit
	  immediately instead of just priting the errors.

2006-06-09 10:05  Timo Sirainen <tss@iki.fi>

	* AUTHORS: Some updates

2006-06-09 10:03  Timo Sirainen <tss@iki.fi>

	* src/lib/primes.c: Minor coding style changes. Removed GLib
	  copyrights as the only thing left from the original code is the
	  prime number list.

2006-06-08 21:23  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/convert-storage.c: Convert subscriptions
	  also.

2006-06-08 21:13  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-format.h: Changed subscriptions
	  filename to just "subscriptions".

2006-06-08 20:25  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-dict.c: Get the quota limits from plugin
	  parameters instead of from the dictionary itself. Added support
	  for message count limits. Other cleanups.

2006-06-08 20:22  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota.c: Don't return NULL error so we don't
	  crash in some systems.

2006-06-08 19:26  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/istream-header-filter.c,
	  lib-storage/index/mbox/istream-raw-mbox.c: Handle i_stream_stat()
	  better.

2006-06-08 18:52  Timo Sirainen <tss@iki.fi>

	* src/master/: main.c, master-settings.c: If ssl_listen setting was
	  empty in config file, startup failed with "Can't resolve address"
	  error.

2006-06-08 18:28  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Crashfix

2006-06-08 18:21  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-save.c, dbox-uidlist.c,
	  dbox-uidlist.h: If mail's size is known beforehand, select the
	  dbox file so that the saving won't grow file larger than
	  dbox_rotate_size.

2006-06-08 16:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-save.c: Saving to multiple files
	  within a transaction was broken.

2006-06-08 16:15  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/convert-storage.c: Create destination INBOX
	  always uppercased.

2006-06-08 16:13  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: Using file_dotlock_touch() caused Dovecot
	  to think the dotlock had been modified by someone else.

2006-06-08 15:25  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/Makefile.am: Added library dependencies to
	  work correctly for convert-tool.

2006-06-08 14:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: dbox_rotate_size
	  checking was wrong.

2006-06-07 09:05  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-fetch.c: If FETCH fails because client disconnects
	  in the middle of it, return "Disconnected" error message instead
	  of "unknown error".

2006-06-05 20:25  Timo Sirainen <tss@iki.fi>

	* src/: login-common/sasl-server.c, login-common/sasl-server.h,
	  imap-login/client-authenticate.c,
	  pop3-login/client-authenticate.c: IMAP: Reply with tagged BAD if
	  authentication is aborted because client sent "*" or something
	  else that was a client error.

	  If authentication failed for any reason, the error message was
	  always "Authentication failed". In case of client errors or if
	  auth process gave an error message, it should have been that
	  instead.

2006-06-02 08:39  Timo Sirainen <tss@iki.fi>

	* configure.in: Check for existence of PQescapeStringConn() in
	  PostgreSQL library. Forgot to commit earlier.

2006-05-31 13:59  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init-openssl.c: Reversed last change. Instead
	  handle DH_generate_parameters() call's failure.

2006-05-31 13:54  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init-openssl.c: Give a nicer error message if
	  i2d_DHparams() returns 0, which apparently it does in some cases.

2006-05-31 13:21  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: With some NFS
	  implementation DELETE failed if ..DOVECOT-TRASHED directory
	  already existed

2006-05-31 13:17  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-storage.c,
	  dbox/dbox-storage.c: Close index files before trying to unlink
	  the index directory

2006-05-31 11:03  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-cache.c, auth-request.c, auth-request.h,
	  db-ldap.c, db-ldap.h, db-passwd-file.c, db-sql.c, passdb-sql.c,
	  userdb-sql.c: Escape SQL strings using sql_escape_string(). Fixes
	  the problems with PostgreSQL.

2006-05-31 11:02  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/: driver-mysql.c, driver-pgsql.c, driver-sqlite.c,
	  sql-api-private.h, sql-api.c, sql-api.h: Added
	  sql_escape_string()

2006-05-30 15:10  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-mysql.c: Use array instead of buffer for
	  storing connections.

2006-05-30 13:35  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream-internal.h, istream.h, nfs-workarounds.h:
	  Include <sys/stat.h> before using struct stat, because some
	  systems may use a macro to define struct stat to something else.

2006-05-30 13:14  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Added assert against NULL reason for
	  client_disconnect().

2006-05-30 13:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Don't return NULL error
	  messages.

2006-05-30 12:20  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/: acl-backend-vfile.c, acl-cache.c, acl-cache.h:
	  Don't check ACL file's timestamp changes more often than once in
	  a second.

2006-05-30 12:18  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c: NULL-terminate the parsed
	  rights

2006-05-30 08:18  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-digest-md5.c: Trying to use subsequent
	  authentication crashed.

2006-05-28 23:43  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: We were caching the EOF block wrongly in
	  some situations.

2006-05-28 21:55  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: Memory leak fix for last
	  update and some other cleanups

2006-05-28 21:18  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-sync-update.c, mail-cache.c,
	  mail-index-private.h, mail-index-sync-update.c,
	  mail-index-sync.c, mail-index.c: We were updating index->map also
	  when syncing views.

2006-05-28 20:03  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c: When extension data is being
	  reset, recreate the index file to make sure that other processes
	  notice the reset_id change. Fixes cache file corruption
	  complaints around the time it's being compressed.

2006-05-28 19:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync.c: Removing and resetting
	  keywords could have operated on wrong file's keyword list.

2006-05-18 21:31  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: BODYSTRUCTURE -> BODY
	  translation was missing CRLF after literal.

2006-05-18 10:08  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-ext.c,
	  mail-index-sync-keywords.c, mail-index-sync-private.h,
	  mail-index-sync-update.c, mail-index-sync.c: If we're
	  synchronizing a view (and not index itself) from transaction log,
	  give a different error message and don't mark the file corrupted.

2006-05-18 09:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: If syncing from transaction log
	  fails, fallback to re-reading the index file (and more
	  importantly, try to avoid crashing in assert..)

2006-05-18 09:50  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: If connection closes while appending, we
	  crashed in some situations.

2006-05-18 09:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-format.h, dbox-list.c,
	  dbox-storage.c: Renamed Mails -> dbox-Mails to make it less
	  likely to conflict with user-created mailbox.

2006-05-18 09:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-keywords.c: Fix for handling
	  keywords

2006-05-13 10:28  Timo Sirainen <tss@iki.fi>

	* README: Added a note about using mailing list for questions.

2006-05-13 10:14  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h: Added support for SASL binding.
	  Patch by Geert Jansen

2006-05-12 18:08  Timo Sirainen <tss@iki.fi>

	* src/pop3/Makefile.am: Link mountpoint.o manually to get
	  mountpoint_get() included into binary, so quota plugin can use
	  it.

2006-05-12 17:54  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: Fixes to compiling with DEBUG

2006-05-12 13:26  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: Don't cause
	  whitespace offsets to break if some headers before it were
	  removed (eg. extra X-IMAPbase headers)

2006-05-12 13:00  Timo Sirainen <timo.sirainen@movial.fi>

	* src/master/: master-settings.c, master-settings.h: Fix for
	  non-C99 compilers.

2006-05-12 09:13  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: Released 1.0.beta8

2006-05-12 08:21  Timo Sirainen <timo.sirainen@movial.fi>

	* src/master/mail-process.c: NFS check wasn't working if chrooting
	  was used.

2006-05-12 08:12  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/: dbox/dbox-storage.c,
	  maildir/maildir-storage.c, mbox/mbox-storage.c: Don't allow "."
	  and ".." mailbox names/masks.

2006-05-11 13:18  Timo Sirainen <tss@iki.fi>

	* src/imap/: Makefile.am, cmd-authenticate.c, cmd-login.c,
	  commands.c, commands.h: Removed LOGIN and AUTHENTICATE command
	  handlers completely. They're only valid in non-authenticated
	  state and there's really no point in having them here anymore.

2006-05-11 11:47  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: When checking if we want to override
	  dotlocks, don't use the file-to-be-locked file's mtime if it's
	  higher than current time.

2006-05-10 15:48  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-kqueue.c: Fixed "Unrecognized event" errors that
	  occurred with IO_ERROR. Patch by Vaclav Haisman

2006-05-10 15:11  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Keep track of write_atomic and
	  write_seq_first/last while copying memory mappings. This is
	  important with mmap_disable=yes because the maps can later be
	  written to index file, and if this information is wrong the file
	  is being updated wrong..

2006-05-10 13:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-mail.c, dbox-sync-full.c: fixes

2006-05-10 11:24  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: If dotlock creation timeouts, unlink()
	  the temp file we used

2006-05-10 11:23  Timo Sirainen <tss@iki.fi>

	* src/lib/sendfile-util.c: Linux's sendfile() returns 0 when remote
	  has closed connection. Convert it to EPIPE.

2006-05-10 10:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: fix

2006-05-10 10:46  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: base_size variable isn't really
	  needed in the pool when DEBUG isn't used.  With DEBUG enabled,
	  check when clearing the pool that the allocated memory is
	  completely cleared, ie. that no-one wrote out of bounds to it.

2006-05-10 10:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: Fix

2006-05-10 09:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-storage.c: Don't allow accessing
	  Mails directory in any way, just return "Invalid mailbox name".

2006-05-10 07:36  Timo Sirainen <tss@iki.fi>

	* src/lib-settings/settings.c: Read empty string settings as "",
	  not NULL.

2006-05-09 21:21  Timo Sirainen <tss@iki.fi>

	* src/lib/mountpoint.c: Minor cleanup: Switch hardcoded /etc/mnttab
	  in Solaris to use MNTTAB macro

2006-05-09 20:47  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client-authenticate.c: If PASS command is given
	  (after unsuccessful USER) with plaintext auth disabled, give
	  proper error message instead of "No username given".

2006-05-08 11:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c:
	  MAIL_CACHE_FLAG_TEXT_PLAIN_7BIT_ASCII wasn't necessarily saved to
	  cache always

2006-05-08 11:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: Strings should be freed with
	  str_free(), not p_free().

