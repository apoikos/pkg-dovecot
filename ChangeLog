2006-08-17 22:17  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: 1.0.rc7 released

2006-08-17 21:16  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop.c: io_add_notify() didn't set refcount so
	  io_remove() crashed for it.

2006-08-17 19:48  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-checkpassword.c: Crashfix

2006-08-17 18:52  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-kqueue.c: Reference IOs before calling timeout
	  handlers, in case they call io_remove().

2006-08-17 18:46  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-internal.h, ioloop-kqueue.c, ioloop.c, ioloop.h:
	  OK, so the original kqueue code wasn't actually broken, but it
	  could have been made much simpler. Updated comments in ioloop.h
	  about IO_READ and IO_ERROR usage.

2006-08-17 18:17  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Cleanup + handle dup() failure.

2006-08-17 17:43  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-kqueue.c: Fixes

2006-08-16 21:33  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-epoll.c, ioloop-kqueue.c: Fixes

2006-08-16 20:48  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: Non-plaintext auth: If
	  auth_debug_passwords=yes, show looked up credentials.

2006-08-16 17:58  Timo Sirainen <tss@iki.fi>

	* src/lib/: ioloop-kqueue.c, ioloop-notify-kqueue.c: Compiling
	  fixes

2006-08-16 15:54  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, ioloop-epoll.c, ioloop-internal.h,
	  ioloop-iolist.c, ioloop-iolist.h, ioloop-kqueue.c,
	  ioloop-notify-kqueue.c, ioloop-poll.c: Rewrote much of the kqueue
	  code. It didn't work correctly if there were both input and
	  output I/O handlers added for the same file descriptor. The code
	  works now very much like epoll code. Did also several cleanups.

2006-08-16 13:31  Timo Sirainen <tss@iki.fi>

	* configure.in: Use notify=kqueue automatically only if
	  ioloop=kqueue.

2006-08-16 12:54  Timo Sirainen <tss@iki.fi>

	* configure.in: Changed --enable-debug's description.

2006-08-16 12:16  Timo Sirainen <tss@iki.fi>

	* src/login-common/: client-common.c, ssl-proxy-openssl.c,
	  ssl-proxy.c, ssl-proxy.h: If SSL/TLS handshake didn't finish,
	  show "TLS handshaking" instead of "TLS" in logout line.

2006-08-11 15:03  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb-checkpassword.c, passdb-pam.c: Set SIGCHLD
	  handler in init, not in preinit when lib_signals_init() hasn't
	  yet been called.

2006-08-11 01:12  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: Check log_creaate_pipe() and dup()
	  return values and handle failures.

2006-08-10 23:21  Timo Sirainen <tss@iki.fi>

	* configure.in: eval doesn't need to have its parameters quoted.
	  The previous \" quoting was broken with POSIX shells (and
	  autoconf 2.60 now sets POSIX mode to non-bash/zsh shells also
	  where this was previously working wrong). So, all in all this
	  should fix OpenBSD compiling problems.

2006-08-10 22:32  Timo Sirainen <tss@iki.fi>

	* src/pop3/: client.c, client.h, commands.c: Show number of
	  actually expunged messages in logout message, instead of number
	  of messages marked as deleted.

2006-08-10 22:03  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/quota/quota-fs.c: Check for XFS quota
	  also from xfs/xqm.h

2006-08-10 21:59  Timo Sirainen <tss@iki.fi>

	* src/auth/: passdb-checkpassword.c, passdb-pam.c: Use SIGCHLD
	  handler to check for killed child processes instead of a timeout
	  loop.

2006-08-10 21:48  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Set umask from dovecot.conf, or default to
	  0077.

2006-08-10 21:40  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: After saving a mail with
	  index being in synced state, update the sync_stamp and sync_size
	  fields in the index so that it actually stays synced.

2006-08-10 21:21  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated login_max_connections comment.

2006-08-10 21:14  Timo Sirainen <tss@iki.fi>

	* src/: login-common/client-common.h, login-common/common.h,
	  login-common/main.c, imap-login/client.c,
	  imap-login/imap-proxy.c, pop3-login/client.c,
	  pop3-login/pop3-proxy.c: Fixes for handling near-full connection
	  queues.

2006-08-10 20:36  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: Create
	  maildirfolder file when creating new maildirs.

2006-08-10 20:22  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt, src/lib/var-expand.c: Negative offsets count
	  from the end of the string. Patch by Johannes Berg.

2006-08-10 20:08  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-dict.c: If dict_init() fails, die with a
	  i_fatal() message instead of crashing.

2006-08-10 19:44  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-ldap.c: If password query returns userdb_
	  prefixed fields (ie. for userdb prefetch) but not userdb_uid or
	  userdb_gid, add them based on the global uid/gid settings.

2006-08-10 19:15  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Allow empty protocols line when
	  using --exec-mail.

2006-08-10 19:06  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c: We got into
	  infinite loops if trying to open a 2 byte sized file as mbox.

2006-08-10 18:52  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Allow base_dir to point to a
	  symlink.

2006-08-10 18:46  Timo Sirainen <tss@iki.fi>

	* src/: auth/main.c, dict/main.c, imap/main.c, login-common/main.c,
	  master/main.c, master/master-settings.c,
	  master/master-settings.h, pop3/main.c: Require that master's
	  version number matches the child's, unless version_ignore=yes.
	  Usually it's an accidental installation problem if the version
	  numbers don't match.

2006-08-10 17:45  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/quota/quota-fs.c,
	  src/plugins/quota/quota-fs.h: Put back specific checks for struct
	  dqblk.dqb_curblocks vs curspace. The removal broke compiling for
	  some OSes such as OSX.

2006-08-10 17:28  Timo Sirainen <tss@iki.fi>

	* configure.in: Updated --with-notify description.

2006-08-10 15:54  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-notify-dn.c: Silently disable dnotify if kernel
	  doesn't support RT signals, instead of just dying.

2006-08-07 15:01  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Don't crash if SSL is
	  disabled.

2006-08-07 12:42  Timo Sirainen <tss@iki.fi>

	* src/: deliver/deliver.c, lib-storage/mail-storage.h,
	  lib-storage/index/index-storage.c,
	  lib-storage/index/index-storage.h,
	  lib-storage/index/mbox/istream-raw-mbox.c,
	  lib-storage/index/mbox/istream-raw-mbox.h,
	  lib-storage/index/mbox/mbox-file.c: Added
	  MAILBOX_OPEN_MBOX_ONE_MSG_ONLY flag for mailbox_open() which
	  makes it ignore all but the first From-line in a mbox. This
	  kludge is required for deliver which builds a temporary mbox
	  stream from the input. Later it should be fixed to use some
	  plain-mailbox format instead of mbox.

2006-08-06 23:29  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: Released 1.0 rc6

2006-08-06 22:22  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.c: Default _LINUX_QUOTA_VERSION to 1
	  instead of 2, since older Linux v1 sys/quota.h didn't define it
	  at all.

2006-08-06 22:01  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: When listing INBOX from inbox=yes namespace,
	  don't insert the namespace prefix

2006-08-06 21:45  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: Fixes to handling INBOX in LIST.

2006-08-06 21:43  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/mail-storage.h: MAILBOX_LIST_INBOX flag
	  conflicted with MAILBOX_LIST_CHILDREN flag, causing problems.

2006-08-06 21:00  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-list.c, mbox/mbox-list.c,
	  dbox/dbox-list.c: Handle reference parameter more like UW-IMAP:
	  If it doesn't begin with separator, just use it as a prefix to
	  mask. I'm not sure where I got the earlier rules..

2006-08-06 20:58  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-list.c: Don't show INBOX if reference parameter is
	  given.

2006-08-06 20:37  Timo Sirainen <tss@iki.fi>

	* src/master/: mail-process.c, master-settings.c: Run imap
	  dump-capability process only after all the settings have been
	  verified to be correct. Added checks against trying
	  mail_drop_priv_before_exec=yes and chrooting, since we can't exec
	  the imap process if that's done. Fixed NFS check with chrooting.

2006-08-06 20:35  Timo Sirainen <tss@iki.fi>

	* src/login-common/main.c: Changed max_connections default value to
	  be 1, not that it should matter.

2006-08-06 20:08  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Minor cleanup, but more
	  importantly last commit message didn't say that the SSL proxy
	  rewrite was once again reverted to the original one, but with
	  SSL_pending() fix from the new one. Hopefully this will finally
	  work with everyone.

2006-08-06 20:05  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap-login/client.c,
	  src/login-common/common.h, src/login-common/login-proxy.c,
	  src/login-common/login-proxy.h, src/login-common/main.c,
	  src/login-common/master.c, src/login-common/master.h,
	  src/login-common/ssl-proxy-openssl.c,
	  src/login-common/ssl-proxy.c, src/login-common/ssl-proxy.h,
	  src/master/login-process.c, src/master/login-process.h,
	  src/master/main.c, src/master/master-login-interface.h,
	  src/master/master-settings.c, src/master/master-settings.h,
	  src/pop3-login/client.c: Fixes to login process handling,
	  especially with login_process_per_connection=no. Removed
	  login_max_logging_users setting since it was somewhat weird in
	  how it worked. Added login_max_connections to replace it with
	  login_process_per_connection=no, and with =yes its functionality
	  is now within login_max_processes_count.

2006-08-04 17:46  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-idle.c: When mailbox changes are noticed and they're
	  sent to client, cork before doing it so each command isn't sent
	  in a separate packet.

2006-08-04 16:32  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/acl-cache.c: Crashfix

2006-08-04 16:28  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/: acl-api-private.h, acl-api.c, acl-backend.c: If
	  .DEFAULT file exists in global ACL root directory, use it as the
	  default ACLs for all mailboxes.

2006-08-03 16:21  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: If master login failed because of
	  non-password failure (eg. allow_nets) don't continue the
	  authentication to non-master passdbs.

2006-08-03 16:20  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: If we logged in with IPv6 address and
	  allow_nets contained IPv4 address, we assert-crashed.

2006-08-03 15:37  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request-handler.c: When logging in as master user,
	  send it as "master_user" field to master among other userdb
	  fields.

2006-08-03 15:27  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-checkpassword.c: Call io_remove() before closing
	  the fd.

2006-08-02 22:39  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/quota/quota-fs.c,
	  src/plugins/quota/quota-fs.h: Added --with-linux-quota configure
	  option to specify which Linux quota version to use. Don't bother
	  looking into struct dqblk to see if curblocks or curspace field
	  exists, we can figure it out from the quota version. If
	  quotactl() returns EINVAL, it could have been because wrong quota
	  version was used, so give a friendly message suggesting to look
	  at --with-linux-quota.

2006-08-02 21:22  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: And 1.0.rc5

2006-08-02 20:14  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction-view.c: And fix for previous
	  change..

2006-08-02 19:44  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: And 1.0.rc4..

2006-08-02 19:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-transaction-view.c: Transaction view:
	  mail_index_get_header() returns now updated next_uid field after
	  appends.

2006-08-02 16:22  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: Released 1.0.rc3.

2006-08-02 00:16  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: We wrote mail bodies
	  through raw output stream, instead of the one that made sure that
	  CR+LF linefeeds were as configured.

2006-07-30 23:05  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-master-connection.c: Debug: Don't log empty error
	  when writing "master out" debug lines.

2006-07-30 23:03  Timo Sirainen <tss@iki.fi>

	* src/: dict/dict-server.c, lib-dict/dict-client.c: dict proxy:
	  Dictionary iteration was broken.

2006-07-30 23:02  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-mail.c,
	  index-mail.h: index_mail_cache_add() was used with lib-storage's
	  internal indexes for most of the received date, physical size and
	  virtual size cache additions. This may have caused all kinds of
	  trouble, but since it went unnoticed this long perhaps not..

2006-07-24 01:57  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c: Don't count "." and ".."
	  directory sizes to quota. After rewriting maildirsize file keep
	  its fd open so that we can later update it. Patch by Alexander
	  Zagrebin

2006-07-24 00:26  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: index-mail-headers.c, index-mail.c:
	  Restore data stream's offset after it has been internally
	  changed, so that it doesn't have much visible effect on the
	  stream returned by mail_get_stream(). The buffered data will
	  still be lost, but this should help with the most common use
	  cases.

2006-07-23 23:32  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Use SSL_pending() to figure
	  out if we should call SSL_read() again.  Otherwise it breaks..

2006-07-23 23:19  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Don't constantly re-read
	  ssl-parameters.dat. Make sure that in input handler we read
	  everything that SSL_read() has buffered so we don't get stuck.

2006-07-23 22:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: Don't crash if sync
	  needs to be rollbacked.

2006-07-23 22:41  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-mail.c: Slightly improved error
	  message.

2006-07-23 22:40  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-save.c: When saving a mail with
	  initial keywords, lock the uidlist before doing anything with the
	  file's header.

2006-07-23 21:41  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-keywords.c,
	  mail-index-sync-update.c: In some conditions a keyword could have
	  been added to the index twice. Also a few cleanups.

2006-07-23 19:08  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-sync-expunge.c, dbox-uidlist.c:
	  Memory/fd leak fixes

2006-07-23 19:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: When saving new mails,
	  append the changes to uidlist file, but only when doing so
	  doesn't temporarily move the file's mtime backwards.

2006-07-23 17:32  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: If header counters got
	  broken when updating internal views, say it clearly in error
	  messages instead of saying they're broken in the files
	  themselves.

2006-07-23 16:50  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync.c: Fixes to writing flags

2006-07-23 15:37  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-save.c, dbox-sync.c,
	  dbox-uidlist.c: Fixes for pop3_lock_session=yes. Wasn't as easy
	  as I thought. :)

2006-07-23 14:22  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Small memory usage optimization.

2006-07-23 14:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-storage.c, dbox-uidlist.c,
	  dbox-uidlist.h: Make pop3_lock_session work with dbox.

2006-07-23 14:20  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-expunge.c: If we find
	  unexpected messages from dbox, rebuild index files to fix the
	  problem.

2006-07-08 15:57  Timo Sirainen <tss@iki.fi>

	* doc/variables.txt: Example fix: %Lp -> %Ls

2006-07-05 19:52  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: dovecot -n and -a: Print the config file path
	  before parsing it so if there are errors you can see what file is
	  being used.

2006-07-05 19:51  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Comment updates

2006-07-04 18:54  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated namespace separator's comments.

2006-07-04 17:51  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: 1.0.rc2 released

2006-07-04 17:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-keywords.c,
	  maildir-storage.c: Added automatic upgrades from 0.99:
	  .subscriptions and .customflags are renamed to their new names
	  automatically.

2006-07-03 13:08  Timo Sirainen <tss@iki.fi>

	* configure.in: --with-ioloop=auto changed to --with-ioloop=best

2006-07-02 19:19  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: mail_cache_min_mail_count is
	  supposed to be an integer, not a string.

2006-07-02 17:54  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Added missing t_pop().

2006-07-02 15:30  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't use epoll/kqueue by default unless
	  --with-ioloop=auto is given.	They're not necessarily as stable.

2006-07-02 13:55  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: If something in io_loop_create() failed, we
	  logged the error to /dev/null.

2006-07-02 13:47  Timo Sirainen <tss@iki.fi>

	* src/lib/failures.c: If writing to log file fails, restore errno
	  before %m is used. Although the log writing most likely fails
	  anyway at that point, but at least strace logs show it right. :)

2006-07-02 11:03  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: List -n and -a in short help. Fixes to
	  --build-options.

2006-07-01 22:54  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Second try with SSL proxy
	  rewrite. Did some fixes since last try.

2006-07-01 22:27  Timo Sirainen <tss@iki.fi>

	* src/plugins/imap-quota/imap-quota-plugin.c: If there is no quota
	  for the user, GETQUOTAROOT leaked memory

2006-07-01 21:19  Timo Sirainen <tss@iki.fi>

	* src/master/auth-process.c: anonymous_username setting wasn't
	  being passed to auth process.

2006-07-01 21:15  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: If verbose_ssl=yes set
	  ssl_info_callback and print any alerts and BIO errors.

2006-07-01 20:26  Timo Sirainen <tss@iki.fi>

	* src/: imap/cmd-close.c, imap/imap-expunge.c, pop3/commands.c:
	  Don't try to expunge messages if the mailbox is read-only. It'll
	  just cause our index files to go out of sync with the real
	  mailbox and cause errors.

2006-07-01 20:14  Timo Sirainen <tss@iki.fi>

	* src/lib/mountpoint.c: mountpoint_get() returned broken mount_path
	  and type with BSDs.

2006-07-01 20:13  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.c: BSD's quotactl() wants a file path,
	  not a device path.

2006-07-01 20:09  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/imap-login/client.c,
	  src/pop3-login/client.c: Removed hardcoded 127.* and ::1 IP
	  checks. Instead just check that local IP matches remote IP to
	  assume the connection is secure.

2006-07-01 19:42  Timo Sirainen <tss@iki.fi>

	* src/auth/db-passwd-file.c: Don't require valid uid/gid fields if
	  passwd-file isn't being used as a userdb.

2006-07-01 19:15  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-pgsql.c: Try to handle failures better.

2006-07-01 18:44  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: Print the used configuration file's path with
	  -n and -a.

2006-07-01 18:40  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-client-connection.c, auth.h, passdb-ldap.c: Moved
	  the <hidden> string into a macro. Hide the password also from
	  LDAP replies.

2006-07-01 18:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c: Messages' received
	  time wasn't saved properly when saving/copying multiple messages
	  at a time. Also if using quota plugin the S= size was only set
	  for the first saved file, and even that was wrong.

2006-07-01 17:53  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-mail.c:
	  mail_get_physical_size() was broken with non-committed mails,
	  which broke quota plugin.

2006-07-01 17:45  Timo Sirainen <tss@iki.fi>

	* src/lib/file-copy.c: Try to preserve file's mode and group when
	  copying it.

2006-07-01 17:44  Timo Sirainen <tss@iki.fi>

	* src/master/mail-process.c: If namespace's location field wasn't
	  set, the default location was supposed to be used.

2006-07-01 17:24  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/: driver-mysql.c, driver-pgsql.c, driver-sqlite.c,
	  sql-api-private.h, sql-api.c, sql-api.h: sql_escape_string()
	  should return const char *, not char *.

2006-06-30 14:49  Timo Sirainen <tss@iki.fi>

	* src/lib/safe-mkdir.c: safe_mkdir() should return 1 always when it
	  creates a new directory, even if it changes the group/permissions
	  when doing it.

2006-06-29 12:49  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added tpop3d's pop3_uidl_format.

2006-06-28 20:21  Timo Sirainen <tss@iki.fi>

	* src/deliver/deliver.c: Allow log_path settings in config file to
	  be empty without trying to use empty files then.

2006-06-27 22:51  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-mail.c, maildir-sync.c,
	  maildir-util.c: Don't break if mailbox path contains ':'
	  characters.

2006-06-27 22:18  Timo Sirainen <tss@iki.fi>

	* NEWS, TODO, configure.in: Released 1.0.rc1

2006-06-27 22:00  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-fs.c: Attempting to fix quota block
	  calculations to be correct.

2006-06-27 21:13  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c: We could have
	  skipped INBOX if there wasn't .INBOX directory.

2006-06-27 21:03  Timo Sirainen <tss@iki.fi>

	* src/: imap/Makefile.am, imap/main.c, master/mail-process.c,
	  pop3/Makefile.am, pop3/main.c: Changed the
	  mail_plugins/mail_plugin_dir settings to be passed as the same
	  environments. If MAIL_PLUGIN_DIR environment isn't given, use the
	  built-in default.

2006-06-27 10:27  Timo Sirainen <tss@iki.fi>

	* src/: deliver/deliver.c, lib-storage/mail-storage.c:
	  MAIL_STORAGE_FLAG_KEEP_HEADER_MD5 flag was supposed to be set if
	  pop3_uidl_format contained %m. Added it now to
	  mail_storage_parse_env() so it's used everywhere.

2006-06-27 09:25  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-sqlite.c: Escape ' with '' instead of with \'.

2006-06-27 07:20  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't try to use any weird _syscall()s when
	  detecting epoll.

2006-06-26 18:51  Timo Sirainen <tss@iki.fi>

	* configure.in: Fix kqueue notify checking.

2006-06-26 17:48  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: If
	  dovecot-shared file exists in the Maildir++ root, use the file's
	  mode and gid when creating mailboxes under it.

2006-06-26 08:56  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init.c: Don't leak a file descriptor when
	  regenerating ssl-parameters.dat

2006-06-26 08:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: Searching (storing,
	  fetching) with sequence sets containing commas was broken

2006-06-24 21:29  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-search.c: Don't crash when different
	  search conditions reduce the search range so that minimum
	  sequence becomes larger than maximum..

2006-06-24 21:03  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/acl-backend.c: Don't crash when checking "owner"
	  ACLs with shared namespaces.

2006-06-24 20:54  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c: We assert-crashed
	  in wrong conditions.

2006-06-24 20:53  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/: istream-raw-mbox.c,
	  mbox-sync-rewrite.c, mbox-sync-update.c: Fixes to handling CR+LF
	  linefeeds.

2006-06-24 19:02  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-passwd-file.c: When using non-plaintext
	  authentication with passdb passwd-file we didn't support
	  extra_fields and we crashed if password scheme wasn't explicitly
	  specified in the passwd-file.

2006-06-24 18:24  Timo Sirainen <tss@iki.fi>

	* configure.in: fix

2006-06-20 15:29  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/index-search.c: Don't crash if seqset
	  restrictions caused no messages to be searched.

2006-06-20 15:16  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/: mail-search.c, index/index-search.c: NOT
	  condition wasn't handled correctly in SEARCH.

2006-06-20 13:59  Timo Sirainen <timo.sirainen@movial.fi>

	* src/auth/passdb-checkpassword.c: If checkpassword lookup failed,
	  we crashed. auth_debug logged checkpassword's exit_status wrong.

2006-06-20 13:13  Timo Sirainen <timo.sirainen@movial.fi>

	* src/auth/passdb-checkpassword.c: Return value 1 from
	  checkpassword can mean either password mismatch or unknown user.
	  Treat it as password mismatch instead of as unknown user.

2006-06-19 18:15  Timo Sirainen <tss@iki.fi>

	* src/lib/file-copy.c: If destination file already existed, we
	  didn't overwrite it with link() copying.

2006-06-19 16:14  Timo Sirainen <tss@iki.fi>

	* src/auth/db-ldap.c: Prefer sasl/sasl.h. Require SASL v2,
	  otherwise disable it.

2006-06-19 16:10  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/db-ldap.c, src/auth/db-ldap.h: Check for
	  sasl.h and sasl/sasl.h existence and use the one that's found. If
	  neither is found, disable support for LDAP SASL.

2006-06-19 14:16  Timo Sirainen <timo.sirainen@movial.fi>

	* src/imap/imap-thread.c: Optimization for checking loops.

2006-06-18 19:47  Timo Sirainen <tss@iki.fi>

	* src/lib-ntlm/ntlm-des.c: Don't include stdint.h directly.

2006-06-18 09:49  Timo Sirainen <tss@iki.fi>

	* src/: auth/Makefile.am, deliver/Makefile.am, dict/Makefile.am,
	  imap/Makefile.am, pop3/Makefile.am: Added -export-dynamic.

2006-06-18 01:34  Timo Sirainen <tss@iki.fi>

	* configure.in: Fixes to io notify detection. Patch by Marcus
	  Rueckert

2006-06-18 00:24  Timo Sirainen <tss@iki.fi>

	* configure.in: Include linux/unistd.h instead of asm/unistd.h when
	  checking for epoll.

2006-06-17 22:44  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-mail.c: If requested mail
	  isn't found from uidlist, mark the mail as expunged.

2006-06-17 21:03  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: auth_debug: If allow_nets is given,
	  print debug messages when matching

2006-06-17 21:02  Timo Sirainen <tss@iki.fi>

	* src/auth/db-passwd-file.c: extra_args field was ignored if the
	  passwd-file wasn't also used as a userdb.

2006-06-17 20:15  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c: Crashfix if mail's
	  data is fetched in specific order (I'm not sure how to reproduce
	  this though, but the crash has happened to others)

2006-06-17 20:03  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c: Removed assert. In normal
	  situations it doesn't happen and in error cases (cached offset is
	  invalid) it causes a crash.

2006-06-17 19:48  Timo Sirainen <tss@iki.fi>

	* src/imap-login/client-authenticate.c: Don't crash if the initial
	  response isn't given for AUTHENTICATE..

2006-06-17 19:32  Timo Sirainen <tss@iki.fi>

	* configure.in, src/auth/db-ldap.c, src/auth/db-ldap.h: Added TLS
	  support for LDAP if the library supports it.

2006-06-17 19:15  Timo Sirainen <tss@iki.fi>

	* src/auth/: mech-anonymous.c, mech-apop.c, mech-cram-md5.c,
	  mech-digest-md5.c, mech-login.c, mech-ntlm.c, mech-plain.c,
	  mech-rpa.c, mech.c, mech.h: Added mech_generic_auth_internal()
	  and mech_generic_auth_free() functions and used them wherever
	  possible to reduce code duplication. Patch by Andrey Panin.

2006-06-17 18:03  Timo Sirainen <tss@iki.fi>

	* src/plugins/: acl/Makefile.am, convert/Makefile.am,
	  quota/Makefile.am, trash/Makefile.am: mkdir_p doesn't accept
	  multiple directories in some systems, so do it one at a time.
	  This also cleans up the code.

2006-06-17 18:00  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c: If saved mail's body
	  doesn't end with LF, add it ourself.

2006-06-17 17:19  Timo Sirainen <tss@iki.fi>

	* configure.in, src/imap-login/client-authenticate.c: Added support
	  for SASL-IR extension.

2006-06-17 17:11  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: If mbox headers
	  have CRLF linefeeds, handle them properly instead of corrupting
	  the headers.

2006-06-17 17:10  Timo Sirainen <tss@iki.fi>

	* src/lib-mail/: message-parser.c, message-parser.h: Added
	  crlf_newline flag to header parser, which is set if the header
	  ended with CR+LF instead of LF.

2006-06-17 16:49  Timo Sirainen <tss@iki.fi>

	* src/master/master-settings.c: Changed the created state dir's
	  default permissions to be 0750. Although this doesn't currently
	  really matter.

2006-06-17 16:26  Timo Sirainen <tss@iki.fi>

	* configure.in, src/master/Makefile.am,
	  src/master/master-settings.c, src/master/ssl-init.c: Added
	  --with-statedir configure option which defaults to
	  localstatedir/lib/dovecot. ssl-parameters.dat is permanently
	  stored in that directory and copied to login_dirs from there.

2006-06-17 16:24  Timo Sirainen <tss@iki.fi>

	* src/lib/: Makefile.am, file-copy.c, file-copy.h: Added
	  file_copy().

2006-06-17 16:01  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, password-scheme.c: Compiler warning fixes
	  and some coding style cleanups.

2006-06-17 15:56  Timo Sirainen <tss@iki.fi>

	* src/: lib/compat.h, lib-storage/index/maildir/maildir-copy.c:
	  Handle EMLINK and EPERM errors the same way as EXDEV when
	  handling hardlink failures. Added ECANTLINK() macro for this.

2006-06-17 15:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: When renaming a
	  mailbox's subfolders, read the list of them first into memory to
	  avoid the possibility of readdir() skipping some of the
	  mailboxes.

2006-06-17 15:22  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request.c: If multiple passdbs were configured and
	  we tried to authenticate as user which was in more than one of
	  them with different passwords, we gave "multiple passwords not
	  supported" error.

2006-06-17 15:14  Timo Sirainen <tss@iki.fi>

	* src/auth/auth-request-handler.c: Fixed memory leak in error
	  handling.

2006-06-17 15:06  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/plugins/trash/trash-plugin.c: Removed
	  hardcoded trash plugin configuration paths. Added information
	  about it to dovecot-example.conf

2006-06-17 14:45  Timo Sirainen <tss@iki.fi>

	* src/lib-auth/auth-server-request.c: Check that initial response
	  doesn't contain invalid characters. Give better error message in
	  case that happens.

2006-06-17 14:02  Timo Sirainen <tss@iki.fi>

	* src/imap/commands-util.c: Fixes to checking if mailbox name is
	  valid. In case mailbox name is invalid, put it through
	  str_sanitize() before giving it in an error message.

2006-06-17 13:55  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/: maildir-sync.c,
	  maildir-uidlist.c, maildir-uidlist.h: Don't go fixing duplicate
	  maildir filenames without properly checking that they really are
	  such.

2006-06-17 13:42  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index.c, mail-transaction-log.c: Handle
	  transaction log deletions silently. Handle whole index directory
	  deletions silently (the most common cases anyway).

2006-06-17 13:01  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/: mail-storage-private.h, mail-storage.c,
	  index/dbox/dbox-storage.c, index/maildir/maildir-storage.c,
	  index/mbox/mbox-storage.c: When creating a mailbox, limit the
	  number of hierarchies (to 20) and the length of the mailbox name
	  within a hierarchy (to 200).

2006-06-17 12:40  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: mail_index_move_to_memory(): Don't
	  break if the index is already in memory.  Fixes
	  mbox_min_index_size.

2006-06-17 12:24  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/dict/dict-server.c,
	  src/lib-dict/dict-client.h, src/master/dict-process.c,
	  src/master/dict-process.h, src/master/log.c, src/master/log.h,
	  src/master/main.c, src/master/master-settings.c,
	  src/master/master-settings.h: Instead of passing URIs directly to
	  dictionary server, it now accepts only named dictionaries which
	  are configured in config file. SIGHUPing master now restarts dict
	  server.

2006-06-17 12:21  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-dict.c: Don't crash if dict_lookup()
	  didn't return success.

2006-06-17 12:20  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-mysql.c: Escaping a string crashed if we
	  weren't connected to mysql.

2006-06-17 11:24  Timo Sirainen <tss@iki.fi>

	* src/dict/main.c: Make sure the process dies when the master
	  process dies.

2006-06-16 18:37  Timo Sirainen <tss@iki.fi>

	* src/deliver/auth-client.c: If USER query doesn't return non-zero
	  uid and gid, give a nice error message.

2006-06-16 18:13  Timo Sirainen <tss@iki.fi>

	* src/master/: auth-process.c, login-process.c, mail-process.c,
	  main.c, master-settings.c: Settings parser nowadays returns ""
	  instead of NULL when it reads an empty value from config file
	  (due to some good reason I unfortunately didn't write to commit
	  message and can't remember anymore). Fixed a lot of existing
	  checks which checked for empty strings with NULL instead of ""
	  checks.

2006-06-16 13:24  Timo Sirainen <tss@iki.fi>

	* configure.in, src/plugins/quota/quota-fs.c: Added support for XFS
	  disk quotas. Patch by Pawel Jarosz

2006-06-16 11:47  Timo Sirainen <tss@iki.fi>

	* configure.in: Better detection for ioloop and notify methods.
	  Patch by Roy Marples

2006-06-16 11:42  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/dict-client.c: Fixes

2006-06-16 11:42  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-mysql.c: Fixes to handling database updates.

2006-06-16 11:09  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Default mail_plugin_dir was wrong for lda.

2006-06-16 10:38  Timo Sirainen <tss@iki.fi>

	* COPYING, src/auth/mech-apop.c, src/auth/mech-gssapi.c,
	  src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth/mech-rpa.c,
	  src/lib/hmac-md5.c, src/lib/ioloop-epoll.c,
	  src/lib-ntlm/ntlm-byteorder.h, src/lib-ntlm/ntlm-encrypt.c,
	  src/lib-ntlm/ntlm-flags.h, src/lib-ntlm/ntlm-message.c,
	  src/lib-ntlm/ntlm-types.h: Relicensed dovecot-auth to MIT.

2006-06-16 10:28  Timo Sirainen <tss@iki.fi>

	* src/auth/password-scheme.c: Added PLAIN-MD4 password scheme.
	  Patch by Andrey Panin.

2006-06-16 10:28  Timo Sirainen <tss@iki.fi>

	* src/lib/: md4.c, md5.c: MD4 was broken with 64bit systems. Added
	  a few x86-64 optimizations. Patch by Andrey Panin

2006-06-16 10:26  Timo Sirainen <tss@iki.fi>

	* src/lib-ntlm/ntlm-byteorder.h: X68_64 CPU can do little-endian
	  accesses itself. This patch updates ntlm-byteorder.h to reflect
	  this fact. Patch by Andrey Panin.

2006-06-16 10:25  Timo Sirainen <tss@iki.fi>

	* src/lib-ntlm/ntlm-des.c: Replaced LGPL licensed DES
	  implementation with MIT licensed one taken from PuTTY SSH client.
	  Patch by Andrey Panin.

2006-06-16 10:21  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-login.c: Support initial SASL response with LOGIN
	  mechanism. Patch by Anders Karlsson

2006-06-16 10:15  Timo Sirainen <tss@iki.fi>

	* src/lib/module-dir.c: Handle errors more correctly. Fixes
	  problems with some OSes.

2006-06-16 10:11  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: We broke if ssl_listen wasn't explicitly set
	  in config file. Patch by Jonathan C. Broome

2006-06-16 09:59  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, passdb-pam.c: Fixes to handling PAM
	  password expiring. Patch by Vaidas Pilkauskas

2006-06-16 09:09  Timo Sirainen <tss@iki.fi>

	* src/deliver/: Makefile.am, deliver.c: If mail_plugin_dir isn't
	  given, use the default path for it instead of ignoring
	  mail_plugins completely.

2006-06-16 08:59  Timo Sirainen <tss@iki.fi>

	* src/dict/dict-server.c: Minor error message update

2006-06-16 08:47  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/dict-sql.c: Fixes to SQL update statements

2006-06-16 08:42  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-dict.c: Don't return "no quota" even
	  though current quota for user doesn't exist yet.

2006-06-16 08:37  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: Crashfix in error
	  cases

2006-06-15 10:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-format.h, dbox-save.c: Added
	  save_time field into dbox mails.

2006-06-14 12:46  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/dict-client.c: Fixes to dict proxy

2006-06-14 12:20  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/dict-client.c: t_pop() calls were missing from some
	  error handling paths

2006-06-14 11:16  Timo Sirainen <tss@iki.fi>

	* src/lib-dict/dict-sql.c: Use sql_escape_string() instead of
	  str_escape()

2006-06-13 12:23  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: Released 1.0.beta9

2006-06-13 12:23  Timo Sirainen <tss@iki.fi>

	* Makefile.am: Delete dovecot-config in distclean.

2006-06-13 11:26  Timo Sirainen <tss@iki.fi>

	* TODO: Updated

2006-06-13 09:10  Timo Sirainen <tss@iki.fi>

	* src/deliver/Makefile.am: Added mountpoint.o to unused objects
	  list

2006-06-12 16:03  Timo Sirainen <tss@iki.fi>

	* src/deliver/: Makefile.am, deliver.c: Changed hardcoded
	  /var/run/dovecot to PKG_RUNDIR.

2006-06-12 16:02  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated LDA's default auth_socket_path

2006-06-12 15:46  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Updated postmaster_address and hostname
	  setting descriptions.

2006-06-12 15:42  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Changed default postmaster_address to
	  @example.com

2006-06-12 12:46  Timo Sirainen <timo.sirainen@movial.fi>

	* src/master/mail-process.c: dovecot --exec-mail ext <binary path>
	  now reads the default settings from configuration file, puts them
	  to environment and executes the given binary.

2006-06-12 08:24  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-file.c, dbox-file.h,
	  dbox-mail.c, dbox-save.c, dbox-storage.h, dbox-sync-expunge.c,
	  dbox-sync-full.c, dbox-sync.c: Allow reading saved mails which
	  haven't been committed yet (ie. make quota plugin work).

2006-06-11 21:55  Timo Sirainen <tss@iki.fi>

	* src/auth/passdb-pam.c: Set PAM_TTY.

2006-06-11 21:40  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Added protocol lda section.

2006-06-11 20:13  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf:
	  s/login_process_per_use/login_process_per_connection/

2006-06-11 20:12  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Moved around settings and added some main
	  groups to them, hopefully making it easier to find them.

2006-06-11 19:58  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf: Moved the socket listen example into auth
	  default instead of having its own auth block, which confused
	  people.

2006-06-11 19:01  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-view-private.h,
	  mail-index-view-sync.c, mail-index-view.c,
	  mail-transaction-log-append.c: We used "already synced log
	  positions in view" array to store locations of committed hidden
	  transactions. They however weren't really synced, which caused
	  some problems. Added a separate "hidden sync log positions" array
	  for them which is handled differently.

2006-06-11 18:14  Timo Sirainen <tss@iki.fi>

	* dovecot-example.conf, src/auth/passdb-pam.c: Don't call
	  pam_setcred() unless setcred=yes PAM passdb argument was given.

2006-06-11 17:51  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-subscribe.c: If tb-extra-mailbox-sep workaround was
	  enabled, subscribing was broken unless the namespace had empty
	  prefix.

2006-06-11 17:44  Timo Sirainen <tss@iki.fi>

	* src/master/main.c: If running from inetd, don't try to open/close
	  listener sockets when receiving SIGHUP.

2006-06-11 17:34  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/quota/: quota-dict.c, quota-dirsize.c, quota-fs.c,
	  quota-maildir.c, quota-private.h, quota-storage.c, quota.c,
	  quota.h: If size of the mail was known before saving started, we
	  allocated the quota twice for it.

2006-06-11 16:11  Timo Sirainen <timo.sirainen@movial.fi>

	* src/plugins/quota/quota-storage.c: Update quota when deleting a
	  mailbox.

2006-06-11 16:04  Timo Sirainen <tss@iki.fi>

	* src/imap/imap-expunge.c: If mailbox_search_deinit() fails, we
	  leaked a bit of memory.

2006-06-11 15:00  Timo Sirainen <tss@iki.fi>

	* src/master/login-process.c: Starting pop3 processes from inetd
	  started actually imap processes after login.

2006-06-11 14:48  Timo Sirainen <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c: Updates to
	  ssl_verify_client_cert: Check CRLs. If auth_verbose=yes, log
	  invalid sent certificates. If verbose_ssl=yes, log even the valid
	  certificates. When using the username from the certificate, use
	  CommonName.  Based on patch by HenkJan Wolthuis

2006-06-11 14:06  Timo Sirainen <tss@iki.fi>

	* src/: lib-storage/index/maildir/maildir-copy.c,
	  lib-storage/index/maildir/maildir-mail.c,
	  lib-storage/index/maildir/maildir-save.c,
	  lib-storage/index/maildir/maildir-storage.h,
	  lib-storage/index/maildir/maildir-util.c,
	  plugins/quota/Makefile.am, plugins/quota/quota-maildir.c: Add
	  ",S=size" to maildir filenames when quota plugin is loaded with
	  Maildir++ backend.

2006-06-11 12:51  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-request.c, passdb-pam.c, passdb.h: If password is
	  expired, give "Password expired" error. Currently works only with
	  PAM. Also added "unknown user" PAM return value handling.

2006-06-11 12:11  Timo Sirainen <tss@iki.fi>

	* src/auth/db-sql.c: s/ldap/sql/ in error message

2006-06-11 12:08  Timo Sirainen <tss@iki.fi>

	* INSTALL: Removed most of the content and added links to Wiki
	  instead.

2006-06-11 12:07  Timo Sirainen <tss@iki.fi>

	* configure.in: Don't enable GSSAPI support by default

2006-06-11 11:49  Timo Sirainen <tss@iki.fi>

	* configure.in: Whitespace cleanup for --help

2006-06-11 11:37  Timo Sirainen <tss@iki.fi>

	* src/deliver/: auth-client.c, auth-client.h, deliver.c: Don't try
	  to change uid/gid to the same one it already is.

2006-06-11 11:26  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache-fields.c: If cache field's size is
	  wrong, rebuild the cache file instead of crashing sometimes
	  later.

2006-06-11 11:19  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c: If file begins with
	  ".nfs", stat() it always to see if it's a directory since it may
	  be a temporary file created by kernel.

2006-06-11 11:10  Timo Sirainen <tss@iki.fi>

	* configure.in, src/Makefile.am, src/deliver/Makefile.am,
	  src/deliver/auth-client.c, src/deliver/auth-client.h,
	  src/deliver/deliver.c, src/deliver/deliver.h,
	  src/deliver/duplicate.c, src/deliver/duplicate.h,
	  src/deliver/mail-send.c, src/deliver/mail-send.h,
	  src/deliver/smtp-client.c, src/deliver/smtp-client.h: Moved all
	  the non-Sieve code from dovecot-lda in here and rewrote parts of
	  it to be cleaner. The Sieve code can now be run as a plugin from
	  dovecot-sieve CVS module.

2006-06-11 11:07  Timo Sirainen <tss@iki.fi>

	* .cvsignore, Makefile.am, dovecot-config.in, dovecot-config.in.in:
	  dovecot-config contains now module_dir.

2006-06-09 11:04  Timo Sirainen <tss@iki.fi>

	* doc/mkcert.sh: If cert/key directories don't exist, exit
	  immediately instead of just priting the errors.

2006-06-09 10:05  Timo Sirainen <tss@iki.fi>

	* AUTHORS: Some updates

2006-06-09 10:03  Timo Sirainen <tss@iki.fi>

	* src/lib/primes.c: Minor coding style changes. Removed GLib
	  copyrights as the only thing left from the original code is the
	  prime number list.

2006-06-08 21:23  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/convert-storage.c: Convert subscriptions
	  also.

2006-06-08 21:13  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-format.h: Changed subscriptions
	  filename to just "subscriptions".

2006-06-08 20:25  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota-dict.c: Get the quota limits from plugin
	  parameters instead of from the dictionary itself. Added support
	  for message count limits. Other cleanups.

2006-06-08 20:22  Timo Sirainen <tss@iki.fi>

	* src/plugins/quota/quota.c: Don't return NULL error so we don't
	  crash in some systems.

2006-06-08 19:26  Timo Sirainen <tss@iki.fi>

	* src/: lib-mail/istream-header-filter.c,
	  lib-storage/index/mbox/istream-raw-mbox.c: Handle i_stream_stat()
	  better.

2006-06-08 18:52  Timo Sirainen <tss@iki.fi>

	* src/master/: main.c, master-settings.c: If ssl_listen setting was
	  empty in config file, startup failed with "Can't resolve address"
	  error.

2006-06-08 18:28  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-cache.c: Crashfix

2006-06-08 18:21  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-save.c, dbox-uidlist.c,
	  dbox-uidlist.h: If mail's size is known beforehand, select the
	  dbox file so that the saving won't grow file larger than
	  dbox_rotate_size.

2006-06-08 16:35  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-save.c: Saving to multiple files
	  within a transaction was broken.

2006-06-08 16:15  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/convert-storage.c: Create destination INBOX
	  always uppercased.

2006-06-08 16:13  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: Using file_dotlock_touch() caused Dovecot
	  to think the dotlock had been modified by someone else.

2006-06-08 15:25  Timo Sirainen <tss@iki.fi>

	* src/plugins/convert/Makefile.am: Added library dependencies to
	  work correctly for convert-tool.

2006-06-08 14:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: dbox_rotate_size
	  checking was wrong.

2006-06-07 09:05  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-fetch.c: If FETCH fails because client disconnects
	  in the middle of it, return "Disconnected" error message instead
	  of "unknown error".

2006-06-05 20:25  Timo Sirainen <tss@iki.fi>

	* src/: login-common/sasl-server.c, login-common/sasl-server.h,
	  imap-login/client-authenticate.c,
	  pop3-login/client-authenticate.c: IMAP: Reply with tagged BAD if
	  authentication is aborted because client sent "*" or something
	  else that was a client error.

	  If authentication failed for any reason, the error message was
	  always "Authentication failed". In case of client errors or if
	  auth process gave an error message, it should have been that
	  instead.

2006-06-02 08:39  Timo Sirainen <tss@iki.fi>

	* configure.in: Check for existence of PQescapeStringConn() in
	  PostgreSQL library. Forgot to commit earlier.

2006-05-31 13:59  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init-openssl.c: Reversed last change. Instead
	  handle DH_generate_parameters() call's failure.

2006-05-31 13:54  Timo Sirainen <tss@iki.fi>

	* src/master/ssl-init-openssl.c: Give a nicer error message if
	  i2d_DHparams() returns 0, which apparently it does in some cases.

2006-05-31 13:21  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c: With some NFS
	  implementation DELETE failed if ..DOVECOT-TRASHED directory
	  already existed

2006-05-31 13:17  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/: maildir/maildir-storage.c,
	  dbox/dbox-storage.c: Close index files before trying to unlink
	  the index directory

2006-05-31 11:03  Timo Sirainen <tss@iki.fi>

	* src/auth/: auth-cache.c, auth-request.c, auth-request.h,
	  db-ldap.c, db-ldap.h, db-passwd-file.c, db-sql.c, passdb-sql.c,
	  userdb-sql.c: Escape SQL strings using sql_escape_string(). Fixes
	  the problems with PostgreSQL.

2006-05-31 11:02  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/: driver-mysql.c, driver-pgsql.c, driver-sqlite.c,
	  sql-api-private.h, sql-api.c, sql-api.h: Added
	  sql_escape_string()

2006-05-30 15:10  Timo Sirainen <tss@iki.fi>

	* src/lib-sql/driver-mysql.c: Use array instead of buffer for
	  storing connections.

2006-05-30 13:35  Timo Sirainen <tss@iki.fi>

	* src/lib/: istream-internal.h, istream.h, nfs-workarounds.h:
	  Include <sys/stat.h> before using struct stat, because some
	  systems may use a macro to define struct stat to something else.

2006-05-30 13:14  Timo Sirainen <tss@iki.fi>

	* src/imap/client.c: Added assert against NULL reason for
	  client_disconnect().

2006-05-30 13:14  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-storage.c: Don't return NULL error
	  messages.

2006-05-30 12:20  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/: acl-backend-vfile.c, acl-cache.c, acl-cache.h:
	  Don't check ACL file's timestamp changes more often than once in
	  a second.

2006-05-30 12:18  Timo Sirainen <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c: NULL-terminate the parsed
	  rights

2006-05-30 08:18  Timo Sirainen <tss@iki.fi>

	* src/auth/mech-digest-md5.c: Trying to use subsequent
	  authentication crashed.

2006-05-28 23:43  Timo Sirainen <tss@iki.fi>

	* src/lib/file-cache.c: We were caching the EOF block wrongly in
	  some situations.

2006-05-28 21:55  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c: Memory leak fix for last
	  update and some other cleanups

2006-05-28 21:18  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-cache-sync-update.c, mail-cache.c,
	  mail-index-private.h, mail-index-sync-update.c,
	  mail-index-sync.c, mail-index.c: We were updating index->map also
	  when syncing views.

2006-05-28 20:03  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c: When extension data is being
	  reset, recreate the index file to make sure that other processes
	  notice the reset_id change. Fixes cache file corruption
	  complaints around the time it's being compressed.

2006-05-28 19:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync.c: Removing and resetting
	  keywords could have operated on wrong file's keyword list.

2006-05-18 21:31  Timo Sirainen <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c: BODYSTRUCTURE -> BODY
	  translation was missing CRLF after literal.

2006-05-18 10:08  Timo Sirainen <tss@iki.fi>

	* src/lib-index/: mail-index-sync-ext.c,
	  mail-index-sync-keywords.c, mail-index-sync-private.h,
	  mail-index-sync-update.c, mail-index-sync.c: If we're
	  synchronizing a view (and not index itself) from transaction log,
	  give a different error message and don't mark the file corrupted.

2006-05-18 09:57  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: If syncing from transaction log
	  fails, fallback to re-reading the index file (and more
	  importantly, try to avoid crashing in assert..)

2006-05-18 09:50  Timo Sirainen <tss@iki.fi>

	* src/imap/cmd-append.c: If connection closes while appending, we
	  crashed in some situations.

2006-05-18 09:38  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-format.h, dbox-list.c,
	  dbox-storage.c: Renamed Mails -> dbox-Mails to make it less
	  likely to conflict with user-created mailbox.

2006-05-18 09:33  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-keywords.c: Fix for handling
	  keywords

2006-05-13 10:28  Timo Sirainen <tss@iki.fi>

	* README: Added a note about using mailing list for questions.

2006-05-13 10:14  Timo Sirainen <tss@iki.fi>

	* src/auth/: db-ldap.c, db-ldap.h: Added support for SASL binding.
	  Patch by Geert Jansen

2006-05-12 18:08  Timo Sirainen <tss@iki.fi>

	* src/pop3/Makefile.am: Link mountpoint.o manually to get
	  mountpoint_get() included into binary, so quota plugin can use
	  it.

2006-05-12 17:54  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: Fixes to compiling with DEBUG

2006-05-12 13:26  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c: Don't cause
	  whitespace offsets to break if some headers before it were
	  removed (eg. extra X-IMAPbase headers)

2006-05-12 13:00  Timo Sirainen <timo.sirainen@movial.fi>

	* src/master/: master-settings.c, master-settings.h: Fix for
	  non-C99 compilers.

2006-05-12 09:13  Timo Sirainen <tss@iki.fi>

	* NEWS, configure.in: Released 1.0.beta8

2006-05-12 08:21  Timo Sirainen <timo.sirainen@movial.fi>

	* src/master/mail-process.c: NFS check wasn't working if chrooting
	  was used.

2006-05-12 08:12  Timo Sirainen <timo.sirainen@movial.fi>

	* src/lib-storage/index/: dbox/dbox-storage.c,
	  maildir/maildir-storage.c, mbox/mbox-storage.c: Don't allow "."
	  and ".." mailbox names/masks.

2006-05-11 13:18  Timo Sirainen <tss@iki.fi>

	* src/imap/: Makefile.am, cmd-authenticate.c, cmd-login.c,
	  commands.c, commands.h: Removed LOGIN and AUTHENTICATE command
	  handlers completely. They're only valid in non-authenticated
	  state and there's really no point in having them here anymore.

2006-05-11 11:47  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: When checking if we want to override
	  dotlocks, don't use the file-to-be-locked file's mtime if it's
	  higher than current time.

2006-05-10 15:48  Timo Sirainen <tss@iki.fi>

	* src/lib/ioloop-kqueue.c: Fixed "Unrecognized event" errors that
	  occurred with IO_ERROR. Patch by Vaclav Haisman

2006-05-10 15:11  Timo Sirainen <tss@iki.fi>

	* src/lib-index/mail-index.c: Keep track of write_atomic and
	  write_seq_first/last while copying memory mappings. This is
	  important with mmap_disable=yes because the maps can later be
	  written to index file, and if this information is wrong the file
	  is being updated wrong..

2006-05-10 13:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/: dbox-mail.c, dbox-sync-full.c: fixes

2006-05-10 11:24  Timo Sirainen <tss@iki.fi>

	* src/lib/file-dotlock.c: If dotlock creation timeouts, unlink()
	  the temp file we used

2006-05-10 11:23  Timo Sirainen <tss@iki.fi>

	* src/lib/sendfile-util.c: Linux's sendfile() returns 0 when remote
	  has closed connection. Convert it to EPIPE.

2006-05-10 10:47  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: fix

2006-05-10 10:46  Timo Sirainen <tss@iki.fi>

	* src/lib/mempool-alloconly.c: base_size variable isn't really
	  needed in the pool when DEBUG isn't used.  With DEBUG enabled,
	  check when clearing the pool that the allocated memory is
	  completely cleared, ie. that no-one wrote out of bounds to it.

2006-05-10 10:34  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-uidlist.c: Fix

2006-05-10 09:05  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-storage.c: Don't allow accessing
	  Mails directory in any way, just return "Invalid mailbox name".

2006-05-10 07:36  Timo Sirainen <tss@iki.fi>

	* src/lib-settings/settings.c: Read empty string settings as "",
	  not NULL.

2006-05-09 21:21  Timo Sirainen <tss@iki.fi>

	* src/lib/mountpoint.c: Minor cleanup: Switch hardcoded /etc/mnttab
	  in Solaris to use MNTTAB macro

2006-05-09 20:47  Timo Sirainen <tss@iki.fi>

	* src/pop3-login/client-authenticate.c: If PASS command is given
	  (after unsuccessful USER) with plaintext auth disabled, give
	  proper error message instead of "No username given".

2006-05-08 11:42  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c:
	  MAIL_CACHE_FLAG_TEXT_PLAIN_7BIT_ASCII wasn't necessarily saved to
	  cache always

2006-05-08 11:25  Timo Sirainen <tss@iki.fi>

	* src/lib-storage/index/index-mail.c: Strings should be freed with
	  str_free(), not p_free().

