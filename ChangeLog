2010-10-01  Timo Sirainen  <tss@iki.fi>

	* .hgsigs:
	Added signature for changeset d0500786b046
	[0149beb01eec] [tip]

	* .hgtags:
	Added tag 1.2.15 for changeset d0500786b046
	[730cc5e22d56]

	* NEWS, configure.in:
	Released v1.2.15.
	[d0500786b046] [1.2.15]

	* src/plugins/acl/acl-api.h, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/acl/acl-backend.c, src/plugins/acl/acl-cache.c:
	acl: Fixed the logic of merging multiple ACLs.
	[fd607e10e75d]

2010-01-25  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c:
	acl: Don't give admin rights to all owner mailboxes. The SETACL IMAP
	command should already prevent this. If this situation is created by
	modifying dovecot-acl file manually, it's probably intentional.
	[9e824012da57]

2010-09-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-file.c:
	dict-file: Don't leak fd on deinit.
	[b7bca02d9ccd]

2010-09-15  Timo Sirainen  <tss@iki.fi>

	* src/lib/failures.c:
	Removed "die after 3 EINTR write() failures to log". This can happen
	with a busy master process that is receiving a lot of SIGCHLD
	signals rapidly while trying to log.
	[e67b892c9ff3]

2010-09-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Avoid unnecessary uidlist recreation during mail delivery.
	[d2da54c3d829]

2010-09-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: If uidlist isn't read, don't mark its UIDs as being known
	when saving.
	[c4b2e4f4ff79]

2010-09-01  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-select.c:
	imap: If selecting a mailbox fails, close the already selected
	mailbox.
	[63857c491143]

2010-08-31  Timo Sirainen  <tss@iki.fi>

	* src/lib/restrict-access.c:
	Fixed setgid() failure error message. Based on patch by Clint Adams
	[4f84f3fe15eb]

2010-08-24  Timo Sirainen  <tss@iki.fi>

	* .hgsigs:
	Added signature for changeset eb04e2b13e3d
	[ace2bd9fefbf]

	* .hgtags:
	Added tag 1.2.14 for changeset eb04e2b13e3d
	[f30e6a345d73]

	* NEWS, configure.in:
	Released v1.2.14.
	[eb04e2b13e3d] [1.2.14]

2010-08-23  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-solr/fts-backend-solr.c:
	fts-solr: Fixes to previous data encoding changes. Patch by Erik
	Hetzner
	[ac0855b1bbea]

	* src/imap/cmd-select.c:
	imap: Fixed parsing SELECT QRESYNC parameters
	[7e959d397a35]

2010-08-20  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-solr/fts-backend-solr.c:
	fts-solr: Replace characters not valid for XML with replacement
	char.
	[cf0da2cd31fb]

	* src/lib/unichar.c, src/lib/unichar.h:
	Added a global utf8_replacement_char variable.
	[5efba9f9f0a7]

2010-08-19  Timo Sirainen  <tss@iki.fi>

	* src/lib/unichar.c, src/lib/unichar.h:
	UTF-8 string validity was still checked incorrectly.
	[cc7aa7a4dd6d]

	* src/imap/imap-fetch.c:
	imap: Don't crash with QRESYNC SELECT specifying sequences larger
	than mailbox's message count.
	[70fa6178380e]

2010-08-18  Timo Sirainen  <tss@iki.fi>

	* src/lib/unichar.c:
	UTF-8 string validity was checked incorrectly.
	[ccc71865dea0]

2010-08-16  Timo Sirainen  <tss@iki.fi>

	* src/lib/eacces-error.c:
	eaccess_error_get(): If UID/GID doesn't have name, show it as
	<unknown>
	[be169f7464de]

2010-08-10  Timo Sirainen  <tss@iki.fi>

	* src/master/dict-process.c:
	master: Don't crash on config reload when using dict processes.
	[2281223b9cb9]

2010-08-04  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-storage.c:
	virtual: Added support for IDLE notifications.
	[367ce71922bf]

2010-08-03  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-storage.c:
	quota: Fixed ns=prefix to work for private namespaces.
	[e5f3bd280210]

2010-07-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c:
	mbox: Fields weren't being added to cache file during message
	saving.
	[166a188f9165]

2010-07-23  Timo Sirainen  <tss@iki.fi>

	* .hgsigs:
	Added signature for changeset b386f997c5c5
	[c275504993c6]

	* .hgtags:
	Added tag 1.2.13 for changeset b386f997c5c5
	[24a891dfde36]

	* NEWS, configure.in:
	Released v1.2.13.
	[b386f997c5c5] [1.2.13]

	* src/plugins/acl/acl-backend-vfile.c:
	acl: Don't use INBOX's ACLs as default ACLs if their paths are the
	same.
	[aae3b2a12cd0]

2010-07-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c:
	mbox: When generating envelope to From_-line, don't append a second
	@owndomain if username already has one.
	[f8c14abf52b4]

2010-07-08  Timo Sirainen  <tss@iki.fi>

	* src/lib/mountpoint.c:
	mountpoint_get()+Solaris: Reset mnttab before each lookup. Patch by
	Juergen Obermann
	[5c0265dba3d1]

2010-07-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/list/mailbox-list-fs.c:
	mbox: Renaming mailbox under newly created dir didn't move index
	directory. This happened if .imap/ directory hadn't yet been created
	for destination dir.
	[4af00b22a466]

2010-06-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c:
	lib-storage: When getting decoded headers, don't fail when MIME
	encoded-words expand to LFs. This fixes errors like: Corrupted index
	cache file dovecot.index.cache: Broken header Subject for mail UID 1
	[659f72bf92ae]

2010-06-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-charset/charset-iconv.c:
	lib-charset: Don't assert-crash when iconv() skips lots of invalid
	input.
	[97b702abd132]

2010-06-19  Timo Sirainen  <tss@iki.fi>

	* .hgsigs:
	Added signature for changeset 41ea174abf10
	[cdc66c6e0c6f]

	* .hgtags:
	Added tag 1.2.12 for changeset 41ea174abf10
	[4d40929d83b4]

	* NEWS, configure.in:
	Released v1.2.12.
	[41ea174abf10] [1.2.12]

2010-06-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	lib-storage: Fixed header searches to work correctly when there are
	multiple headers with same name.
	[4432650c0699]

2010-06-11  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-fs.c:
	quota-fs, Solaris: Don't try to open quotas file with NFS mounts.
	[edc7da213d4c]

	* src/lib-dict/dict-file.c:
	dict file: If file's group permissions equal world permissions,
	don't try to change its gid.
	[0b0cb71aea03]

2010-06-07  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	auth: Fixed prefetch userdb interaction with passdb changing
	username.
	[a3e4af3df83d]

2010-06-01  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-config.c:
	virtual: Fixed looking up namespace for save-destination mailbox
	(!ns/box)
	[40fc39475d02]

2010-05-31  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mailbox-uidvalidity.c:
	lib-storage: Don't log rename() error if dovecot-uidvalidity didn't
	contain valid value.
	[f707fc6705c7]

2010-05-28  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-fs.c:
	quota-fs: Log also mountpoint type with mail_debug=yes.
	[eaba4cfeaa44]

2010-05-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/shared/shared-storage.c:
	lib-storage: Allow shared namespace prefix to use %variable
	modifiers.
	[0a00dcc4f0ea]

2010-05-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	mbox: If write fails with EFBIG, give an error that mentions ulimit
	-f.
	[e63d38c7d2ba]

	* src/lib-storage/index/index-storage.c:
	lib-storage: If read-only mailbox uses private flags, don't return
	it as READ-ONLY.
	[c2c1639b91ee]

	* src/plugins/acl/acl-mailbox-list.c:
	acl: If RENAME failed because user didn't have permissions, it still
	returned success to user.
	[6f25b20b8367]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	maildir: Expunging last messages may have assert-crashed if their
	filenames had changed.
	[d86c7d94f372]

2010-05-18  Timo Sirainen  <tss@iki.fi>

	* src/plugins/listescape/listescape-plugin.c:
	listescape: Fixed listing INBOX when namespace prefix was used.
	[5f0e937ae245]

2010-05-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-copy.c:
	maildir: Fixed a memory leak when copying with hardlinks.
	[2129667cb499]

	* src/lib-index/mail-transaction-log-file.c:
	lib-index: Give a better error message if transction log file
	shrinks unexpectedly.
	[46d3128626b7]

2010-05-10  Timo Sirainen  <tss@iki.fi>

	* src/master/dict-process.c:
	master: Fixed restarting dict processes.
	[2cdfcca171d8]

2010-04-30  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body.c:
	imap: If FETCH notices cached message size is wrong, mark cache
	corrupted (second such check).
	[34c8cdc26dd9]

2010-04-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	maildir: If we detect MH as the cause of unexpunging, log it in the
	error message.
	[7c447e8c24fe]

2010-04-20  Timo Sirainen  <tss@iki.fi>

	* src/plugins/imap-quota/imap-quota-plugin.c:
	imap-quota: Iterate quota roots only once when replying to
	GETQUOTAROOT. This halves the required dict lookup count.
	[efe0efc22d22]

2010-04-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-client.c:
	dict proxy client: Timeout lookups after 30 s, log warning if lookup
	takes >5 s.
	[002b58bab1f5]

2010-04-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-client.c:
	dict proxy: Disconnect from dict server after 1 second of idling.
	[0dca2668004f]

2010-04-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/password-scheme.c:
	auth: Removed special case check for MD5-CRYPT from wrong password
	scheme checking.
	[e4c096fae5ac]

2010-04-14  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	imap/pop3-login: ssl=yes shouldn't change port if port was already
	specified.
	[a6d0fa17ddee]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	imap/pop3-login: If proxy returns ssl=yes, change the default port
	to 993/995.
	[9d472f43bcdb]

2010-04-13  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-dict.c:
	quota: If dict quota update fails, log an error.
	[cf3fe573a560]

2010-04-05  Timo Sirainen  <tss@iki.fi>

	* src/deliver/mail-send.c:
	deliver: Crashfix when sending rejection mail with Auto-Submitted:
	header.
	[7798e254ff67]

2010-03-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/driver-pgsql.c:
	pgsql: Don't leak memory if query returns multiple results. Found by
	Rainer Weikusat.
	[a39372cd040c]

	* src/master/mail-process.c:
	Don't double-expand mail_location %variables when namespace location
	is empty.
	[0cf38dcd8ced]

2010-03-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-mail.c:
	maildir: get_save_date() should return 0, not the timestamp. Patch
	by Rainer Weikusat
	[59591ed04610]

2010-03-08  Timo Sirainen  <tss@iki.fi>

	* .hgsigs:
	Added signature for changeset 4bc6b41be8ff
	[0b8696047804]

	* .hgtags:
	Added tag 1.2.11 for changeset 4bc6b41be8ff
	[bb7ec2bb44e3]

	* NEWS, configure.in:
	Released v1.2.11.
	[4bc6b41be8ff] [1.2.11]

	* src/lib-storage/index/index-mailbox-check.c:
	IDLE: After a change, mailbox changes were being re-checked every
	0.5 seconds.
	[affad804356e]

	* src/lib/restrict-access.c:
	Improved setgid/setuid failure's error message.
	[6794893d03c9]

2010-03-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: uidlist wasn't compressed often enough.
	[7c3b7c3a86ff]

2010-02-28  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-file.c:
	file istream: If trying to seek backwards in unseekable stream,
	panic. The previous way of just setting an error flag was getting
	ignored too easily and causing silent corruption in such situations.
	[578dcf893777]

	* src/lib-storage/index/index-mail.c:
	Disabled stats istream. It's not used by default, and it breaks
	mbox. When stats istream is enabled, reading a mail with a huge
	header from mbox causes Dovecot to eat all CPU for a long time. This
	bug is fixed properly in v2.0.
	[6c9f2ed821df]

2010-02-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/list/mailbox-list-fs-iter.c:
	fs layout: Don't "File name too long" errors if giving too long path
	to LIST.
	[93ee1f7bfeff]

2010-02-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/list/mailbox-list-fs.c:
	fs layout: We didn't properly prevent maildir_name from being used
	in mailbox names.
	[1ff706e7d95f]

2010-02-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Make sure we don't append to uidlist that has already been
	recreated.
	[4a6dd192c8af]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Avoid infinite loops while reading uidlist.
	[a9710cb350c0]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/mbox/mbox-
	storage.c:
	mbox, dbox, cydir: Create mail directory with 0700 permission, not
	0770.
	[99caf87fb3ce]

	* src/lib-storage/index/index-search.c:
	lib-storage: Use mailbox_status() to get number of messages in
	search code. This doesn't really change anything, except makes it
	possible for plugins to hide some messages.
	[ef3b30b24c7c]

	* src/lib-index/mail-index-strmap.c:
	lib-index: Changed strmap's crc32 field to be backwards compatible.
	[0454fde95cbf]

	* src/lib/crc32.c:
	crc32*() didn't return a standard CRC32 value.
	[c24a31b423ed]

2010-01-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	mbox: Fixed assert-crash after sometimes creating pseudo mail.
	[fa1f5b4590d1]

2010-01-25  Timo Sirainen  <tss@iki.fi>

	* .hgsigs:
	Added signature for changeset ece9da037b7e
	[7b0e1b2c9afd]

	* .hgtags:
	Added tag 1.2.10 for changeset ece9da037b7e
	[ade3717fef5f]

	* NEWS, configure.in:
	Released v1.2.10.
	[ece9da037b7e] [1.2.10]

	* dovecot-example.conf:
	dovecot-example.conf: Don't set a default postmaster_address.
	[2e36a3a75961]

	* src/auth/auth-cache.c, src/auth/auth-client-connection.c, src/auth
	/auth-master-connection.c, src/auth/auth-master-listener.c, src/auth
	/auth-request-handler.c, src/auth/auth-request.c, src/auth/auth-
	stream.c, src/auth/auth-worker-client.c, src/auth/auth-worker-
	server.c, src/auth/auth.c, src/auth/db-checkpassword.c, src/auth/db-
	ldap.c, src/auth/db-passwd-file.c, src/auth/db-sql.c,
	src/auth/main.c, src/auth/mech-anonymous.c, src/auth/mech-cram-
	md5.c, src/auth/mech-digest-md5.c, src/auth/mech-external.c,
	src/auth/mech-plain.c, src/auth/mech.c, src/auth/passdb-blocking.c,
	src/auth/passdb-bsdauth.c, src/auth/passdb-cache.c, src/auth/passdb-
	checkpassword.c, src/auth/passdb-ldap.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-sql.c, src/auth/passdb-vpopmail.c, src/auth/passdb.c,
	src/auth/password-scheme.c, src/auth/userdb-blocking.c, src/auth
	/userdb-checkpassword.c, src/auth/userdb-ldap.c, src/auth/userdb-
	nss.c, src/auth/userdb-passwd-file.c, src/auth/userdb-passwd.c,
	src/auth/userdb-prefetch.c, src/auth/userdb-sql.c, src/auth/userdb-
	static.c, src/auth/userdb-vpopmail.c, src/auth/userdb.c, src/deliver
	/auth-client.c, src/deliver/deliver.c, src/deliver/duplicate.c,
	src/deliver/mail-send.c, src/deliver/smtp-client.c, src/dict/dict-
	server.c, src/dict/main.c, src/imap-login/client-authenticate.c, src
	/imap-login/client.c, src/imap-login/imap-proxy.c,
	src/imap/client.c, src/imap/cmd-append.c, src/imap/cmd-
	cancelupdate.c, src/imap/cmd-capability.c, src/imap/cmd-check.c,
	src/imap/cmd-close.c, src/imap/cmd-copy.c, src/imap/cmd-create.c,
	src/imap/cmd-delete.c, src/imap/cmd-enable.c, src/imap/cmd-
	examine.c, src/imap/cmd-expunge.c, src/imap/cmd-fetch.c, src/imap
	/cmd-id.c, src/imap/cmd-idle.c, src/imap/cmd-list.c, src/imap/cmd-
	logout.c, src/imap/cmd-lsub.c, src/imap/cmd-namespace.c, src/imap
	/cmd-noop.c, src/imap/cmd-rename.c, src/imap/cmd-search.c, src/imap
	/cmd-select.c, src/imap/cmd-sort.c, src/imap/cmd-status.c, src/imap
	/cmd-store.c, src/imap/cmd-subscribe.c, src/imap/cmd-thread.c,
	src/imap/cmd-uid.c, src/imap/cmd-unselect.c, src/imap/cmd-
	unsubscribe.c, src/imap/cmd-x-cancel.c, src/imap/commands-util.c,
	src/imap/commands.c, src/imap/imap-expunge.c, src/imap/imap-fetch-
	body.c, src/imap/imap-fetch.c, src/imap/imap-search-args.c, src/imap
	/imap-search.c, src/imap/imap-status.c, src/imap/imap-sync.c,
	src/imap/mail-storage-callbacks.c, src/imap/main.c, src/lib-auth
	/auth-client.c, src/lib-auth/auth-master.c, src/lib-auth/auth-
	server-connection.c, src/lib-auth/auth-server-request.c, src/lib-
	charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src/lib-
	dict/dict-client.c, src/lib-dict/dict-db.c, src/lib-dict/dict-
	file.c, src/lib-dict/dict-sql-settings.c, src/lib-dict/dict-sql.c,
	src/lib-dict/dict.c, src/lib-imap/imap-base-subject.c, src/lib-imap
	/imap-bodystructure.c, src/lib-imap/imap-date.c, src/lib-imap/imap-
	envelope.c, src/lib-imap/imap-id.c, src/lib-imap/imap-match.c, src
	/lib-imap/imap-parser.c, src/lib-imap/imap-quote.c, src/lib-imap
	/imap-seqset.c, src/lib-imap/imap-utf7.c, src/lib-imap/imap-util.c,
	src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	decisions.c, src/lib-index/mail-cache-fields.c, src/lib-index/mail-
	cache-lookup.c, src/lib-index/mail-cache-sync-update.c, src/lib-
	index/mail-cache-transaction.c, src/lib-index/mail-cache.c, src/lib-
	index/mail-index-dummy-view.c, src/lib-index/mail-index-fsck.c, src
	/lib-index/mail-index-lock.c, src/lib-index/mail-index-map.c, src
	/lib-index/mail-index-modseq.c, src/lib-index/mail-index-strmap.c,
	src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	keywords.c, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-sync.c, src/lib-index/mail-index-transaction-view.c, src
	/lib-index/mail-index-transaction.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-index-
	write.c, src/lib-index/mail-index.c, src/lib-index/mail-transaction-
	log-append.c, src/lib-index/mail-transaction-log-file.c, src/lib-
	index/mail-transaction-log-view.c, src/lib-index/mail-transaction-
	log.c, src/lib-index/mailbox-list-index-sync.c, src/lib-index
	/mailbox-list-index.c, src/lib-mail/istream-header-filter.c, src
	/lib-mail/mbox-from.c, src/lib-mail/message-address.c, src/lib-mail
	/message-date.c, src/lib-mail/message-decoder.c, src/lib-mail
	/message-header-decode.c, src/lib-mail/message-header-encode.c, src
	/lib-mail/message-header-parser.c, src/lib-mail/message-id.c, src
	/lib-mail/message-parser.c, src/lib-mail/message-part-serialize.c,
	src/lib-mail/message-search.c, src/lib-mail/message-send.c, src/lib-
	mail/message-size.c, src/lib-mail/quoted-printable.c, src/lib-
	mail/rfc2231-parser.c, src/lib-mail/rfc822-parser.c, src/lib-
	settings/settings.c, src/lib-sql/driver-mysql.c, src/lib-sql/driver-
	pgsql.c, src/lib-sql/sql-api.c, src/lib-sql/sql-pool.c, src/lib-
	storage/index/cydir/cydir-mail.c, src/lib-storage/index/cydir/cydir-
	save.c, src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/cydir/cydir-sync.c, src/lib-storage/index/cydir/cydir-
	transaction.c, src/lib-storage/index/dbox/dbox-file-maildir.c, src
	/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-index.c, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox/dbox-
	storage.c, src/lib-storage/index/dbox/dbox-sync-file.c, src/lib-
	storage/index/dbox/dbox-sync-rebuild.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/dbox/dbox-transaction.c, src
	/lib-storage/index/index-fetch.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-mailbox-check.c, src/lib-storage/index/index-search-result.c,
	src/lib-storage/index/index-search.c, src/lib-storage/index/index-
	sort-string.c, src/lib-storage/index/index-sort.c, src/lib-
	storage/index/index-status.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-sync-changes.c, src/lib-storage/index
	/index-sync-search.c, src/lib-storage/index/index-sync.c, src/lib-
	storage/index/index-thread-finish.c, src/lib-storage/index/index-
	thread-links.c, src/lib-storage/index/index-thread.c, src/lib-
	storage/index/index-transaction.c, src/lib-storage/index/istream-
	mail-stats.c, src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-filename.c, src/lib-
	storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-transaction.c, src/lib-storage/index/maildir/maildir-
	uidlist.c, src/lib-storage/index/maildir/maildir-util.c, src/lib-
	storage/index/mbox/istream-raw-mbox.c, src/lib-storage/index/mbox
	/mbox-file.c, src/lib-storage/index/mbox/mbox-lock.c, src/lib-
	storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox/mbox-
	md5.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync-rewrite.c, src
	/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/index/mbox/mbox-
	transaction.c, src/lib-storage/index/raw/raw-mail.c, src/lib-
	storage/index/raw/raw-storage.c, src/lib-storage/index/raw/raw-
	sync.c, src/lib-storage/index/raw/raw-transaction.c, src/lib-
	storage/index/shared/shared-list.c, src/lib-storage/index/shared
	/shared-storage.c, src/lib-storage/list/index-mailbox-list-sync.c,
	src/lib-storage/list/index-mailbox-list.c, src/lib-storage/list
	/mailbox-list-fs-iter.c, src/lib-storage/list/mailbox-list-fs.c, src
	/lib-storage/list/mailbox-list-maildir-iter.c, src/lib-storage/list
	/mailbox-list-maildir.c, src/lib-storage/list/mailbox-list-
	subscriptions.c, src/lib-storage/list/subscription-file.c, src/lib-
	storage/mail-copy.c, src/lib-storage/mail-error.c, src/lib-storage
	/mail-namespace.c, src/lib-storage/mail-search-build.c, src/lib-
	storage/mail-search.c, src/lib-storage/mail-storage.c, src/lib-
	storage/mail-thread.c, src/lib-storage/mail-user.c, src/lib-
	storage/mail.c, src/lib-storage/mailbox-list.c, src/lib-storage
	/mailbox-search-result.c, src/lib-storage/mailbox-tree.c, src/lib-
	storage/mailbox-uidvalidity.c, src/lib/aqueue.c, src/lib/array.c,
	src/lib/backtrace-string.c, src/lib/base64.c, src/lib/bsearch-
	insert-pos.c, src/lib/buffer.c, src/lib/child-wait.c, src/lib/close-
	keep-errno.c, src/lib/compat.c, src/lib/crc32.c, src/lib/data-
	stack.c, src/lib/eacces-error.c, src/lib/env-util.c,
	src/lib/failures.c, src/lib/fd-close-on-exec.c, src/lib/fd-set-
	nonblock.c, src/lib/fdatasync-path.c, src/lib/fdpass.c, src/lib
	/file-cache.c, src/lib/file-copy.c, src/lib/file-dotlock.c, src/lib
	/file-lock.c, src/lib/file-set-size.c, src/lib/hash.c,
	src/lib/hash2.c, src/lib/hex-binary.c, src/lib/hex-dec.c, src/lib
	/home-expand.c, src/lib/hostpid.c, src/lib/imem.c, src/lib/ioloop-
	notify-dn.c, src/lib/ioloop-notify-fd.c, src/lib/ioloop-notify-
	inotify.c, src/lib/ioloop-notify-none.c, src/lib/ioloop-poll.c,
	src/lib/ioloop-select.c, src/lib/ioloop.c, src/lib/iostream.c,
	src/lib/istream-concat.c, src/lib/istream-crlf.c, src/lib/istream-
	data.c, src/lib/istream-file.c, src/lib/istream-limit.c, src/lib
	/istream-mmap.c, src/lib/istream-seekable.c, src/lib/istream-tee.c,
	src/lib/istream.c, src/lib/lib-signals.c, src/lib/lib.c, src/lib
	/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib/mempool-
	system-clean.c, src/lib/mempool-system.c, src/lib/mempool-unsafe-
	datastack.c, src/lib/mempool.c, src/lib/mkdir-parents.c, src/lib
	/mmap-anon.c, src/lib/mmap-util.c, src/lib/module-dir.c,
	src/lib/mountpoint.c, src/lib/network.c, src/lib/nfs-workarounds.c,
	src/lib/ostream-file.c, src/lib/ostream.c, src/lib/printf-format-
	fix.c, src/lib/priorityq.c, src/lib/process-title.c,
	src/lib/randgen.c, src/lib/read-full.c, src/lib/restrict-access.c,
	src/lib/restrict-process-size.c, src/lib/safe-memset.c, src/lib
	/safe-mkdir.c, src/lib/safe-mkstemp.c, src/lib/sendfile-util.c,
	src/lib/seq-range-array.c, src/lib/str-find.c, src/lib/str-
	sanitize.c, src/lib/str.c, src/lib/strescape.c, src/lib/strfuncs.c,
	src/lib/time-util.c, src/lib/unichar.c, src/lib/unix-socket-
	create.c, src/lib/unlink-directory.c, src/lib/unlink-old-files.c,
	src/lib/utc-mktime.c, src/lib/utc-offset.c, src/lib/var-expand.c,
	src/lib/write-full.c, src/login-common/client-common.c, src/login-
	common/login-proxy-state.c, src/login-common/login-proxy.c, src
	/login-common/main.c, src/login-common/master.c, src/login-common
	/sasl-server.c, src/login-common/ssl-proxy-gnutls.c, src/login-
	common/ssl-proxy-openssl.c, src/login-common/ssl-proxy.c,
	src/master/askpass.c, src/master/auth-process.c, src/master/child-
	process.c, src/master/dict-process.c, src/master/dup2-array.c,
	src/master/listener.c, src/master/log.c, src/master/login-process.c,
	src/master/mail-process.c, src/master/main.c, src/master/master-
	settings.c, src/master/ssl-init-gnutls.c, src/master/ssl-init-
	main.c, src/master/ssl-init-openssl.c, src/master/ssl-init.c,
	src/master/sysinfo-get.c, src/master/syslog-util.c, src/plugins/acl
	/acl-api.c, src/plugins/acl/acl-backend-vfile-acllist.c,
	src/plugins/acl/acl-backend-vfile.c, src/plugins/acl/acl-backend.c,
	src/plugins/acl/acl-cache.c, src/plugins/acl/acl-lookup-dict.c,
	src/plugins/acl/acl-mailbox-list.c, src/plugins/acl/acl-mailbox.c,
	src/plugins/acl/acl-plugin.c, src/plugins/acl/acl-shared-storage.c,
	src/plugins/acl/acl-storage.c, src/plugins/autocreate/autocreate-
	plugin.c, src/plugins/convert/convert-plugin.c, src/plugins/convert
	/convert-storage.c, src/plugins/convert/convert-tool.c,
	src/plugins/expire/auth-client.c, src/plugins/expire/expire-env.c,
	src/plugins/expire/expire-plugin.c, src/plugins/expire/expire-
	tool.c, src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins
	/fts-lucene/fts-lucene-plugin.c, src/plugins/fts-lucene/lucene-
	wrapper.cc, src/plugins/fts-solr/fts-backend-solr.c, src/plugins
	/fts-solr/fts-solr-plugin.c, src/plugins/fts-solr/solr-connection.c,
	src/plugins/fts-squat/fts-backend-squat.c, src/plugins/fts-squat
	/fts-squat-plugin.c, src/plugins/fts-squat/squat-test.c, src/plugins
	/fts-squat/squat-trie.c, src/plugins/fts-squat/squat-uidlist.c,
	src/plugins/fts/fts-api.c, src/plugins/fts/fts-plugin.c,
	src/plugins/fts/fts-search.c, src/plugins/fts/fts-storage.c,
	src/plugins/imap-acl/imap-acl-plugin.c, src/plugins/imap-quota/imap-
	quota-plugin.c, src/plugins/lazy-expunge/lazy-expunge-plugin.c,
	src/plugins/listescape/listescape-plugin.c, src/plugins/mail-log
	/mail-log-plugin.c, src/plugins/mbox-snarf/mbox-snarf-plugin.c,
	src/plugins/quota/quota-count.c, src/plugins/quota/quota-dict.c,
	src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-fs.c,
	src/plugins/quota/quota-maildir.c, src/plugins/quota/quota-plugin.c,
	src/plugins/quota/quota-storage.c, src/plugins/quota/quota.c,
	src/plugins/trash/trash-plugin.c, src/plugins/virtual/virtual-
	config.c, src/plugins/virtual/virtual-mail.c, src/plugins/virtual
	/virtual-plugin.c, src/plugins/virtual/virtual-save.c,
	src/plugins/virtual/virtual-search.c, src/plugins/virtual/virtual-
	storage.c, src/plugins/virtual/virtual-sync.c, src/plugins/virtual
	/virtual-transaction.c, src/plugins/zlib/istream-bzlib.c,
	src/plugins/zlib/istream-zlib.c, src/plugins/zlib/zlib-plugin.c,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.c,
	src/pop3-login/pop3-proxy.c, src/pop3/client.c, src/pop3/commands.c,
	src/pop3/main.c, src/tests/test-common.c, src/tests/test-imap.c,
	src/tests/test-istream.c, src/tests/test-lib.c, src/tests/test-
	mail.c, src/util/authtest.c, src/util/gdbhelper.c,
	src/util/idxview.c, src/util/imap-utf7.c, src/util/listview.c,
	src/util/logview.c, src/util/maildirlock.c, src/util/rawlog.c,
	src/util/threadview.c:
	Updated copyright notices to include year 2010.
	[00cd9aacd03c]

	* src/plugins/Makefile.am:
	--with-lucene was actually enabling solr.
	[e7c462e3e4bd]

2010-01-24  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	dovecot: Don't warn about changing config file, unless -n or -a is
	given.
	[3237519b73f4]

	* src/auth/passdb-passwd-file.c, src/auth/userdb-passwd-file.c:
	passwd-file: Give a better error message if args (path) is empty.
	[4b0ec8160ff4]

2010-01-22  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c, src/master/master-settings.c, src/master/master-
	settings.h:
	dovecot -a|-n: Log a warning if Dovecot was last started using a
	different config file.
	[142c935e44d6]

	* configure.in:
	Added LIST-STATUS to CAPABILITY list.
	[2a7efac89339]

2010-01-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: dropping expunged uidlist records didn't update hash table.
	[a1177c6cf8c7]

2010-01-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-namespace.c:
	namespace list=children: Fail if namespace prefix doesn't end with
	separator.
	[64b8fe0024ba]

2010-01-02  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	configure: Use -llber for ldap only if necessary.
	[e2ea80e1c239]

2009-12-31  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c, src/auth/password-scheme.c, src/auth
	/password-scheme.h:
	auth_debug_passwords: If password is correct but scheme is wrong,
	try to detect and log it.
	[b48a4af4248d]

2009-12-29  Timo Sirainen  <tss@iki.fi>

	* src/plugins/lazy-expunge/lazy-expunge-plugin.c:
	lazy-expunge: Ignore non-private namespaces.
	[029c3afcfbd0]

2009-12-23  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	imap: LIST "" inbox shouldn't crash when using namespace with
	"INBOX." prefix.
	[56dd8c276ed6]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	*-login: Don't assert-crash if trying to proxy caused the connection
	to be killed.
	[d1548d794f72]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Fixed potential assert-crashes with "Duplicate file entry"
	handling.
	[d00abdaf9df2]

2009-12-22  Timo Sirainen  <tss@iki.fi>

	* src/lib/var-expand.c:
	var_expand(): Added support for built-in host, pid and env:*
	variables.
	[ef7b42b237bd]

	* src/lib/istream-seekable.c:
	istream-seekable: If we're immediately at EOF after copying buffer
	to file, don't corrupt the buffer.
	[4e2134570b76]

	* src/lib-mail/message-header-parser.c:
	message-header-parsed: Backported fixes from v2.0.
	[a1622da31bb1]

2009-12-17  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	imap: Refresh index before starting a FETCH, so it sees updated
	flags immediately.
	[b934756a3714]

2009-12-16  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	verbose_ssl: Don't log SSL info messages with "BIO failed" prefix.
	[eecb23d78acf]

	* .hgsigs:
	Added signature for changeset fa4b9d520687
	[0342a6f137bd]

	* .hgtags:
	Added tag 1.2.9 for changeset fa4b9d520687
	[1f5a3979778c]

	* NEWS, TODO, configure.in:
	Released v1.2.9.
	[fa4b9d520687] [1.2.9]

	* src/lib/lib-signals.c:
	lib-signals: Compile fix for Hurd (SA_SIGINFO not available). Based
	on patch by Marco Nenciarini.
	[77b8ead30bb9]

	* src/lib/compat.h:
	Define PATH_MAX for Hurd.
	[845e6da5194a]

2009-12-15  Timo Sirainen  <tss@iki.fi>

	* src/lib/lib-signals.c:
	lib-signals: Set signal pipe fds non-blocking to make sure
	read/write doesn't hang.
	[9c99f15829fa]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-save.c:
	maildir: Always add S=size to filenames. It's necessary for using
	zlib plugin and doesn't hurt much anyway.
	[9af9343084d4]

2009-12-14  Timo Sirainen  <tss@iki.fi>

	* src/plugins/lazy-expunge/lazy-expunge-plugin.c:
	lazy-expunge: Support a single-namespace configuration. If a mailbox
	is deleted, its contents are merged with the existing expunged
	messages.
	[09bed694c6ca]

2009-12-10  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-plugin.h, src/plugins/quota/quota-storage.c:
	quota plugin broke other plugins' namespace_created hooks.
	[5e2206e3c750]

2009-12-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	mbox: If mbox parsing notices unexpected corruption, don't assert-
	crash.
	[fe1f31b4e21e]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	mbox: Log an error if From_-line gets lost/corrupted unexpectedly.
	[8d4621094e54]

	* src/plugins/expire/expire-env.c:
	expire: Settings now support spaces in mailbox names by using quoted
	strings.
	[91c6b067f464]

	* src/plugins/virtual/virtual-sync.c:
	virtual optimization: If saved highest-modseq matches current one,
	don't try to find higher ones.
	[f1c4c0c90da1]

	* src/plugins/virtual/virtual-sync.c:
	virtual: Fixed updating virtual mailbox based on flag changes.
	[9cccb8617820]

	* configure.in:
	configure: Added -llber to ldap libs. Fixes linking in some systems.
	Patch by Marco Nenciarini.
	[58650eedc4fd]

2009-12-08  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c, src/plugins/quota/quota-
	private.h, src/plugins/quota/quota.c:
	Maildir++ quota: % limits weren't updated when limits were read from
	maildirsize.
	[a9b469e1c8de]

	* src/imap/cmd-list.c:
	imap: Fixed listing namespaces with multiple hierarchy separators.
	[b348632b11e2]

	* src/lib-settings/settings.c:
	settings parser: If line ends with '\' continuation, remove extra
	whitespace before it.
	[b7f739902a47]

2009-12-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Removed logging extraneous errors, again.
	[24e48c1d7f79]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Removed logging extraneous errors.
	[c9cc50405ca4]

	* src/lib-storage/index/maildir/maildir-copy.c:
	maildir_copy_preserve_filename=yes could have caused crashes.
	[8472e487da49]

2009-11-23  Timo Sirainen  <tss@iki.fi>

	* src/imap/commands-util.c, src/imap/commands.c, src/imap/commands.h:
	imap: Don't send NONEXISTENT resp code to non-delete operations.
	[3efdbaab2960]

	* src/master/mail-process.c:
	master: If chdir() failed with EACCES, the error message wasn't
	correct.
	[76294bdecd5a]

	* dovecot-example.conf:
	dovecot-example.conf: Updated dict comments.
	[fd84592e817b]

	* src/plugins/fts-squat/squat-trie.c:
	fts-squat: Fixed searching multi-byte characters.
	[6541fcc3bf54]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Changed index/uidlist mismatch from assert-crashing to
	logging an error.
	[e47eb506eebd]

	* src/lib-index/mail-transaction-log-append.c:
	lib-index: One more fix to handling 32bit ext-header updates.
	[40a6a70b3146]

	* src/lib-index/mail-index-sync-ext.c:
	lib-index: Replaced ext-header update assert with "index corrupted"
	error handling.
	[9a8eb4d68b04]

	* src/lib/Makefile.am:
	Makefile: Added UnicodeData.txt to distribution.
	[eff8d8e3673f]

2009-11-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log.h:
	lib-index: MAIL_TRANSACTION_TYPE_MASK didn't contain the new
	_EXT_HDR_UPDATE32.
	[fa8a438c64ce]

2009-11-19  Timo Sirainen  <tss@iki.fi>

	* .hgsigs:
	Added signature for changeset ee1782019a60
	[d536fe262c48]

	* .hgtags:
	Added tag 1.2.8 for changeset ee1782019a60
	[73d328a15bde]

	* NEWS, configure.in:
	Released v1.2.8.
	[ee1782019a60] [1.2.8]

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-transaction-log-append.c, src/lib-index/mail-transaction-
	log.h, src/util/logview.c:
	mail_index_update_header_ext(): Couldn't handle >=64k headers.
	[e5d38150be58]

	* src/lib-index/mail-transaction-log-append.c:
	mail_index_update_header_ext(): updating >32k headers crashed with
	out-of-memory.
	[3e1ca490dde0]

	* src/master/master-settings.c:
	master: Create base_dir with 0755 permissions, not 0777.
	[3ebbccdc05e6]

2009-11-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/rfc2231-parser.c:
	rfc2231 parser: Fixed parsing "key*".
	[96b5d6d8dd2c]

2009-11-09  Timo Sirainen  <tss@iki.fi>

	* src/lib/unichar.c, src/lib/unichar.h:
	Added uni_utf8_str_is_valid().
	[bf2fb1679cb4]

2009-11-10  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c:
	acl: Merge group rights if user belongs to more than one.
	[76ff6831c9ae]

	* src/plugins/acl/acl-mailbox-list.c:
	acl: mailbox_name_status() shouldn't hide its existence if user has
	any rights to it.
	[38d89637aa23]

2009-11-09  Timo Sirainen  <tss@iki.fi>

	* .hgsigs:
	Added signature for changeset 4e001a34078e
	[adcc779985bd]

	* .hgtags:
	Added tag 1.2.7 for changeset 4e001a34078e
	[b3af95931aae]

	* NEWS, TODO, configure.in:
	Released v1.2.7.
	[4e001a34078e] [1.2.7]

2009-11-08  Jørgen P. Tjernø  <jorgen@devsoft.no>

	* src/lib/unicodemap.pl:
	Make unicodemap.pl give correct return code when it fails to
	complete, so that make will stop processing.
	[9c3682683624]

2009-11-09  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	lib-lda: Log mailbox name using UTF-8, not mUTF-7.
	[2a6e47b50ee5]

	* src/auth/userdb-vpopmail.c:
	vpopmail: Removed vauth_open() call. Apparently it's not the right
	way.
	[7ea4e58aa356]

	* src/lib-index/mail-transaction-log-file.c:
	index: If we see duplicate transaction log files, avoid corrupting
	the newer one.
	[2cf9f73cf0aa]

2009-11-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-storage.c:
	dbox notify: Look for dbox index files from index dir, not mail root
	dir.
	[68af994e7f3c]

	* src/master/login-process.c:
	master: When creating login processes, don't close any fds after
	dup2()s.
	[19aee456cec3]

2009-11-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	maildir: Having a lot of keywords assert-crashed with "stack frame
	changed".
	[939edf3ed09b]

	* src/imap-login/imap-proxy.c:
	imap proxy: Always send changed capability to client. The original
	code did it only when client had used CAPABILITY command. Now it's
	also sent in tagged reply to login/authenticate command if the
	remote server didn't already add it.
	[0dc82e18530d]

2009-10-30  Timo Sirainen  <tss@iki.fi>

	* src/util/rawlog.c:
	rawlog: Make also created socketpair fds nonblocking.
	[673a017081af]

	* src/util/rawlog.c:
	rawlog: Make sure to set fds nonblocking to avoid hangs.
	[b7ed70a0192b]

2009-10-29  Timo Sirainen  <tss@iki.fi>

	* src/deliver/Makefile.am:
	deliver: Link with message-header-encode.o so Sieve plugin can use
	it.
	[a0d72e0d88dd]

2009-10-28  Timo Sirainen  <tss@iki.fi>

	* src/lib/data-stack.c:
	data stack: Fixes to handling out-of-memory situations.
	[acfef2f0fec3]

	* src/lib/failures.c, src/lib/str.c:
	Minor memory allocation tweaks.
	[adee8cb3ff5d]

	* src/lib-mail/message-header-encode.c:
	message_header_encode(): Line lengths weren't calculated properly
	with some characters.
	[778a6418f54b]

	* src/lib/str-sanitize.c:
	str_sanitize(): Don't break UTF-8 input.
	[23abbf14279c]

2009-10-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/Makefile.am, src/lib-mail/message-header-encode.c, src
	/lib-mail/message-header-encode.h:
	Added message header (RFC 2047) encoder.
	[bd4a6f500c75]

	* src/lib/eacces-error.c:
	eaccess_error*(): Error message updated.
	[04d841ecb5bf]

	* src/deliver/deliver.c:
	deliver: Fixed binary setuid-checking.
	[ead94beba32a]

	* src/lib-storage/index/index-mailbox-check.c, src/lib-storage/index
	/index-storage.h:
	mailbox_notify_changes(): Delay sending notifications for 500 msecs.
	If the notification is done immediately, IDLE may not notice the
	change because it's not finished yet.
	[abbb153d4643]

2009-10-26  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-concat.c:
	istream-concat: Fixed a lot of bugs.
	[9fff30644260]

	* src/lib/istream-seekable.c:
	istream-seekable: Don't assert-crash when input buffer becomes full.
	[d3d0a2ed804a]

2009-10-22  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-dotlock.c:
	file_dotlock_create(): If nfs_flush is enabled, fdatasync after
	writing PID. This makes sure that the write() doesn't fail later in
	close() and cause problems.
	[c7948ebd433e]

2009-10-20  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/login-common/common.h, src/login-
	common/main.c, src/login-common/ssl-proxy-openssl.c, src/master
	/login-process.c:
	imap-login: If imap_capability is set, show it in the banner instead
	of the default.
	[ab32d7e2c0d6]

	* src/imap/imap-fetch.c:
	QRESYNC: Fixed fallback handling to fetching expunged UIDs (again).
	[36b8d97d0f58]

	* src/lib-settings/settings.c:
	settings parser: Warn if a line has '#' character not preceded by
	whitespace. This should help with people trying to give '#'
	character in e.g. a password and wondering why it's not working.
	[4a6b04c43147]

	* src/imap/cmd-append.c:
	imap: If client disconnects while appending, don't treat the rest of
	the message as commands.
	[d7f8dbc38fd7]

2009-10-18  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/imap/cmd-sort.c, src/lib-storage/index/index-sort-
	string.c, src/lib-storage/index/index-sort.c, src/lib-storage/mail-
	storage.h:
	imap: Implemented SORT=DISPLAY extension (draft-ietf-morg-
	sortdisplay-02).
	[a5d8d201bd39]

2009-10-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c:
	mbox: Write the last LF before fdatasync().
	[b5e6de777e52]

	* src/login-common/login-proxy-state.c, src/login-common/login-proxy-
	state.h, src/login-common/login-proxy.c:
	imap/pop3 proxy: Track "destination down" state separately for
	IP+ports, not just IPs. In some systems different ports could get
	redirected to different servers.
	[562af4a76438]

	* doc/wiki/Makefile.am.in:
	doc/wiki/Makefile.am fix.
	[ebb2a91e6df7]

	* src/lib-storage/index/mbox/mbox-save.c:
	mbox: Make sure failed saves get rolled back with NFS.
	[ebb44fb7d9de]

2009-10-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-file.c:
	lib-index: looking up offset for transaction log's initial modseq
	failed.
	[d55146fea954]

	* src/lib-storage/index/dbox/dbox-save.c:
	dbox: Fixed accessing unsaved mails when more than one message was
	saved.
	[1207923ccb94]

	* src/plugins/expire/expire-plugin.c:
	expire: Mailbox names should be written to dict using their virtual
	name.
	[00757d350812]

	* doc/Makefile.am, doc/wiki/Makefile.am.in:
	--without-docs: make install no longer installs any docs.
	[5763caa55b57]

	* src/login-common/ssl-proxy-openssl.c:
	Potential crashfix for OpenSSL < 0.9.8.
	[0aa7357761a5]

	* src/imap/cmd-idle.c:
	imap: IDLE now sends "Still here" notifications to same user's
	connections at the same time. Perhaps this will save some battery
	power with mobile clients that open multiple connections.
	[373b22cbabac]

	* src/lib-index/mail-index-view-sync.c:
	lib-index: Give nicer error if index's log position suddenly goes
	backwards.
	[6c6460531514]

	* src/plugins/quota/quota-fs.c:
	quota-fs: If mount=path isn't specified, don't fail with multiple
	quota roots.
	[439e14ff1467]

	* src/lib/istream-seekable.c:
	istream-seekable: If we can't write temp file, fallback to using
	memory without limits.
	[a8254e6d5ada]

2009-10-14  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	deliver: Escape local-part if it begins/ends with '.'.
	[f5ce7d271b56]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir_very_dirty_syncs=yes: Make sure uidlist shrinks eventually.
	[7956cc1086e1]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Saving a mail after fast syncing caused slow sync the next
	time.
	[ebdba086e3b1]

2009-10-12  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-bsdauth.c:
	bsdauth: And compile fix to previous change..
	[5fc4fb574c9f]

	* src/auth/passdb-bsdauth.c:
	bsdauth: Use PLAIN as default_pass_scheme instead of CRYPT.
	[08ed9e0e0897]

	* src/auth/passdb-bsdauth.c:
	bsdauth: Set default pass scheme to CRYPT.
	[1c529a941c99]

	* src/login-common/login-proxy.c:
	login proxy: Don't give "tried to change state 2 -> 2" errors with
	login_process_per_connection=yes.
	[bf11870ecb02]

	* src/deliver/deliver.c:
	deliver: Don't escape addresses with "." in local-part.
	[c50acaf1f09f]

2009-10-09  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	QRESYNC: Fixed fallback handling to fetching expunged UIDs.
	[73c4a7d325fe]

	* src/imap/imap-fetch.c:
	QRESYNC: Minor code cleanup by renaming variables to be more
	understandable.
	[51329696ecf5]

	* src/imap/imap-fetch.c:
	imap: Don't crash on SELECT .. QRESYNC if it didn't give seq-uid
	map.
	[352eab3d6ade]

2009-10-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c:
	lib-index: With >1 expunge handlers deinit was called with wrong
	sync_context. Currently there was only one expunge handler so this
	wasn't a real problem.
	[e20921f71bd0]

	* src/lib-index/mail-index-modseq.c:
	Expunging messages caused in-memory modseqs to be wrong.
	[f7f0bff8438a]

2009-10-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-save.c:
	dbox: Getting dbox file for non-first unsaved mail crashed.
	[84e04d84d2b5]

2009-10-06  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/login-common/ssl-proxy-openssl.c:
	Compiling fix for OpenSSL 0.9.7 and older.
	[4add5c3f13ea]

2009-10-05  Timo Sirainen  <tss@iki.fi>

	* .hgsigs:
	Added signature for changeset 609fe4268f40
	[2a48aa6e2bce]

	* .hgtags:
	Added tag 1.2.6 for changeset 5c5fc2aa299a
	[609fe4268f40]

	* NEWS, configure.in:
	Released v1.2.6.
	[5c5fc2aa299a] [1.2.6]

	* .hgignore, src/util/Makefile.am, src/util/authtest.c:
	Added authtest utility for doing passdb and userdb lookups.
	[4d715af3d1e6]

	* src/lib/Makefile.am:
	unicodemap.c now gets recreated if unicodemap.pl changes.
	[df0f95353fdd]

	* src/lib/failures.c:
	If info log can't be opened, log about it to error log.
	[ae29ecea8d06]

	* src/imap/cmd-list.c:
	LSUB "" %: List namespace prefix if namespace has separate
	subscriptions.
	[a0fa514d92f0]

	* src/login-common/client-common.c, src/login-common/client-common.h,
	src/login-common/sasl-server.c:
	*-login: Log more precise reasons for some auth failures.
	[0c7bbdd7b81f]

	* src/master/master-settings.c:
	master: Config file parsing fixes.
	[a3e16df805e3]

	* src/lib-auth/auth-master.c:
	auth-master lookup: Give better error message on connect() EACCES
	errors.
	[2d4d9b0cdcc1]

2009-10-01  Timo Sirainen  <tss@iki.fi>

	* src/lib/unichar.c, src/lib/unicodemap.pl:
	New UnicodeMap.txt has >16bit multi-decomposition keys, support
	them.
	[9a8c565adbe1]

2009-09-30  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/imap-proxy.c:
	imap proxy: Don't fail if LOGIN parameters were sent using literals.
	[8e8a706d6905]

	* src/lib/process-title.c:
	process_title_set(): Don't include executable name in
	setproctitle(), it's done internally.
	[cf291558ce28]

	* src/imap/client.c:
	imap: Reduce command pool's initial size.
	[92d7f08e9105]

	* src/imap-login/imap-proxy.c:
	imap proxy: Don't log "unexpected input" errors about tagged
	CAPABILITY replies.
	[5053bfd20001]

	* src/lib-index/mail-index.c:
	Avoid assert-crashing when two processes try to create index at the
	same time.
	[1fb19e1c84f5]

	* src/deliver/deliver.c, src/lib-settings/settings.c:
	Allow config file line lengths to be unlimited.
	[72a8063cfde0]

	* dovecot-example.conf:
	dovecot-example.conf: Mention that deliver doesn't support
	!includes.
	[436a44194e6a]

	* src/deliver/deliver.c, src/deliver/deliver.h:
	deliver: Changed all EX_CONFIGs to EX_TEMPFAILs to avoid bounces.
	[b39175349d08]

	* src/lib/fd-close-on-exec.c:
	fd_debug_verify_leaks() didn't check the last_fd.
	[401e023c8c29]

2009-09-29  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c:
	imap-login: Is dovecot-auth gives a reason for the failure, don't
	eat first 7 chars. Patch by Kirill Miazine.
	[4c9f068e5ea1]

	* src/login-common/ssl-proxy-openssl.c:
	ssl: If given ssl key is for a different cert, give a nicer error
	message.
	[e7a973c0101b]

2009-09-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search-result.c:
	Assert-crashfix when updating saved search results.
	[bb8c32271dd0]

	* src/lib-storage/mail-search.c:
	mail_search_args_init(): Added an assert.
	[28cea4c5158a]

	* src/lib-storage/mailbox-list.c:
	mail_location: If it ends with ":", ignore it instead of adding ":"
	character. If ":" is really wanted, it should be done with "::".
	[d0e7d95ca46a]

	* src/plugins/quota/quota.c:
	quota: Don't crash with non-Maildir++ quota backend. Patch by
	Brandon Davidson.
	[3132464fbe9c]

	* src/login-common/ssl-proxy-openssl.c:
	login: ssl_security string now also shows the used compression.
	[26ca4ff5d269]

2009-09-23  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/imap-proxy.c:
	imap proxy: Another broken remote server detection and crashfix.
	[c8e24c1b8468]

	* src/imap-login/client.h, src/imap-login/imap-proxy.c:
	imap proxy: Detect and log invalid remote input.
	[b1293abca645]

2009-09-21  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	dovecot --exec-mail was broken.
	[0f04c7da33f1]

2009-09-13  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.2.5 for changeset 42f6578c8602
	[c43bc2a2b44d]

	* NEWS, TODO, configure.in:
	Released v1.2.5.
	[42f6578c8602] [1.2.5]

	* src/auth/auth-client-interface.h, src/login-common/client-common.h,
	src/master/master-login-interface.h:
	Increased SASL auth packet max. sizes for GSSAPI.
	[05eec45994d9]

	* src/plugins/acl/acl-storage.c:
	acl: Don't crash when creating children under a mailboxes with
	global ACL.
	[6df681067e0a]

	* src/lib-mail/message-header-decode.c:
	message_header_decode*() should ignore LWSP between two encoded-
	words.
	[28241a6e1178]

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-fs.c, src/plugins/quota/quota-maildir.c,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota.c:
	maildir quota: Limits weren't read early enough from maildirsize
	file.
	[fe063e0d7109]

2009-09-11  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	master: Startup warnings written to stderr should end with LF.
	[a493ceb26615]

2009-09-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/quoted-printable.c:
	quoted-printable decoding didn't handle QP after soft line breaks
	correctly. Patch by Yamazaki Hideto.
	[f6d668562f5f]

	* src/lib-dict/dict-sql.c:
	Compiler warning fixes.
	[35c5f8d064f5]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	maildir: Save cur/ mtime to index after moving saved messages there,
	not before.
	[f2a6a99ff9ea]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	maildir: Removed some unnecessary code.
	[fcb34048a29c]

	* src/lib/unlink-directory.c:
	unlink_directory(): Log if unlink()ing some file fails.
	[58630516a9d4]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Don't force a resync when saving.
	[f1a29b13f7dc]

2009-09-09  Timo Sirainen  <tss@iki.fi>

	* src/plugins/zlib/zlib-plugin.c:
	zlib: Don't allow clients to save compressed data directly. This way
	clients can't try to exploit uncompression bugs in zlib/bzlib.
	[b359aac78f92]

2009-09-08  Timo Sirainen  <tss@iki.fi>

	* src/lib/lib-signals.c:
	lib-signals: Don't assert-crash with nested signal handler calls.
	[8fd1ee439437]

2009-09-07  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	master: Startup errors crashed on some systems.
	[5f9782109fcf]

	* src/master/main.c:
	master: Expand %m properly at startup errors.
	[cc0d7c00c6ce]

2009-09-06  Timo Sirainen  <tss@iki.fi>

	* src/auth/userdb-vpopmail.c:
	vpopmail: Call vauth_open(), which is required by vpopmail 5.5.0.
	[597e18c0bc7e]

	* src/master/main.c:
	master: Log startup errors as well as writing them to stderr.
	[eb4ea59e4657]

	* src/lib-storage/list/mailbox-list-subscriptions.c:
	Don't assert-crash when listing subscriptions with a >256 chars long
	mailbox name.
	[38e491ff24d0]

	* src/auth/auth-master-listener.c:
	auth: Treat accept() failure as a fatal failure.
	[f56bbf8b33e1]

	* src/master/mail-process.c:
	dovecot --exec-mail: Put mail_uid and mail_gid settings to
	environment.
	[eb22a456a625]

	* src/imap/cmd-copy.c:
	IMAP: Don't return COPYUID if backend didn't provide it. (try #2)
	[1ec784dd4773]

	* src/plugins/quota/quota-dict.c:
	dict quota: When updating quota, recalculate it when necessary.
	[ea522175c549]

	* src/dict/dict-server.c, src/lib-dict/dict-client.c, src/lib-dict
	/dict-client.h, src/lib-dict/dict-db.c, src/lib-dict/dict-file.c,
	src/lib-dict/dict-private.h, src/lib-dict/dict-sql.c, src/lib-
	dict/dict.c, src/lib-dict/dict.h:
	dict: Added support for async commits. Changed dict_atomic_inc()
	behavior.
	[a1b92a251bb9]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/driver-sqlite.c, src/lib-sql/sql-api-private.h, src/lib-sql/sql-
	api.c, src/lib-sql/sql-api.h:
	lib-sql: Added sql_update_get_rows().
	[4530228c8993]

	* src/lib-index/mail-transaction-log-file.c:
	lib-index: Minor code cleanup.
	[6debbb31df39]

	* src/lib-storage/index/dbox/dbox-mail.c, src/lib-storage/index/dbox
	/dbox-save.c, src/lib-storage/index/dbox/dbox-storage.h:
	dbox: Allow getting streams to messages being saved.
	[dc66872f1856]

	* src/imap/client.c, src/imap/cmd-select.c, src/imap/imap-sync.c:
	imap: Some text is required after resp-text-codes
	(HIGHESTMODSEQ/CLOSED).
	[56e619176787]

2009-09-04  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	master: Changed the WhyDoesItNotWork info message.
	[7639914c5cde]

2009-09-01  Timo Sirainen  <tss@iki.fi>

	* src/deliver/mail-send.c:
	deliver: Don't send rejects to any messages that have Auto-Submitted
	header.
	[cd48e01ff2a1]

	* src/lib-index/mail-transaction-log-append.c:
	lib-index: modseqs weren't tracked properly within session when
	changes were done.
	[687ac828b964]

	* src/auth/mech-digest-md5.c, src/auth/mech-rpa.c:
	auth: digest-md5, rpa mechanisms no longer require the realm to be
	listed in auth_realms.
	[3c171f5eee8d]

2009-08-31  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	master: If process uid/gid is too high, refer to last_valid_*
	settings instead of first_valid_*. Based on patch by Pascal Volk.
	[8bf54859b19b]

	* src/plugins/virtual/virtual-sync.c:
	virtual: Don't crash if trying to change a message that was already
	expunged in backend mailbox.
	[170c03680738]

	* src/lib-storage/index/index-fetch.c:
	mail_storage_get_expunged_uids(): Support v2.0 expunge-guid records.
	[4e031f3d9083]

	* src/lib-storage/mailbox-list.c:
	lib-storage: Allow selecting namespace prefix even when list=no.
	[a5d530edfafe]

	* dovecot-example.conf, src/lib-storage/index/cydir/cydir-mail.c, src
	/lib-storage/index/dbox/dbox-mail.c, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/raw/raw-mail.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.h, src/lib-storage/mail.c,
	src/master/mail-process.c, src/master/master-settings-defs.c,
	src/master/master-settings.c, src/master/master-settings.h,
	src/plugins/virtual/virtual-mail.c, src/pop3/commands.c,
	src/pop3/common.h, src/pop3/main.c:
	Added pop3_save_uidl setting. When UIDLs are sent to client, save
	them to dovecot-uidlist. This allows changing pop3_uidl_format
	without messages getting re-downloaded. It's also useful with
	virtual POP3 INBOX when UIDLs are based on IMAP UIDs that may not be
	as stable as in non-virtual INBOX.
	[3eacb6bbd227]

2009-08-28  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-gssapi.c:
	gssapi: Apparently all usernames end with NUL. Allow it.
	[a37fa30b0072]

	* src/imap/imap-fetch.c:
	qresync: Fixed off-by-one modseq comparison when figuring out what
	VANISHED replies to send.
	[e0cee10e0f41]

	* src/imap/imap-fetch.c:
	imap: Don't crash if SELECT .. QRESYNC doesn't specify list of UIDs.
	[5b121790eb3a]

	* doc/dovecot-ldap-example.conf:
	dovecot-ldap-example.conf: Changed the example "base" setting.
	[7fa454048160]

	* src/lib/file-set-size.c:
	file_set_size() was broken with OSes that didn't support
	posix_fallocate().
	[aaa1b2c25c14]

	* src/plugins/acl/acl-mailbox-list.c:
	acl: Don't use dovecot-acl-list with public namespaces. All
	mailboxes in a public namespace are typically in dovecot-acl-list
	anyway.
	[aeb3affa0501]

	* src/lib-index/mail-index-view-sync.c:
	lib-index: Fixed v2.0 forwards compatibility support. Expunges were
	handled wrong.
	[ff4c1e9f47a4]

	* src/lib/lib-signals.c:
	Solaris: Don't crash when signal handler is called with
	siginfo_t=NULL.
	[cc4af8e31175]

2009-08-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c:
	ldap: Don't log an error when server disconnects us because of
	idling.
	[355d5a40f7a7]

	* src/lib-storage/index/maildir/maildir-sync.c:
	maildir: Fixed maildir_sync_get_changes() to work as it should have.
	[e1685886c795]

2009-08-24  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-worker-server.c:
	auth worker server: Don't assert-crash if the whole reply doesn't
	come in one packet.
	[0827941c0e7c]

	* src/master/auth-process.c, src/master/child-process.c, src/master
	/child-process.h, src/master/dict-process.c, src/master/login-
	process.c, src/master/mail-process.c, src/master/ssl-init.c:
	master: If execv() fails with ENOMEM, mention the *_process_size
	setting.
	[366a327b028b]

2009-08-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-mail.c:
	maildir: If opening a mail fails with EACCES, log a better error
	message.
	[a366666f4b50]

	* src/auth/auth-master-connection.c:
	auth: Don't leak memory with buggy auth-master clients.
	[0d0a801a4d1e]

	* .hgtags:
	Added tag 1.2.4 for changeset f32928e74606
	[15b4b2c904fe]

	* NEWS, configure.in:
	Released v1.2.4.
	[f32928e74606] [1.2.4]

	* src/plugins/mbox-snarf/mbox-snarf-plugin.c:
	mbox-snarf: Minor code fix.
	[a40f5c34ace8]

	* src/plugins/mbox-snarf/mbox-snarf-plugin.c:
	mbox-snarf: Keep the mailbox locked while snarfing to avoid
	duplicates.
	[cf93e420fc57]

2009-08-15  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-api.c:
	acl: When looking up ACL defaults, use global/local default files if
	they exist.
	[956d2f962e97]

2009-08-14  Timo Sirainen  <tss@iki.fi>

	* src/plugins/listescape/listescape-plugin.c:
	listescape: Fixed to work with dynamically created shared
	namespaces.
	[a1b1a8b6555e]

	* src/lib-storage/mail-namespace.c:
	namespace initialization: Allow plugins to override
	namespace.real_sep.
	[be4a5cd32b29]

	* src/plugins/listescape/listescape-plugin.c:
	listescape: Handle properly subscriptions to namespaces with
	subscriptions=no.
	[5ae611e975ad]

	* src/lib/istream-crlf.c:
	lf-istream: Don't assert-crash if last character in buffer is CR,
	not followed by LF.
	[4c42e72a3954]

	* src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c, src/auth/mech-
	gssapi.c:
	auth: Check for potentially dangerous NULs in usernames.
	[5d53b1d66d1b]

	* src/login-common/login-proxy-state.h:
	Compiling fix.
	[93e2b0519e65]

	* src/lib/time-util.h:
	Compiler fixes.
	[8ca1f9f1ef2e]

2009-08-13  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-subscribe.c:
	tb-extra-mailbox-sep workaround works better now. Mailbox is
	subscribed without trailing separator. Unsubscribe tries to remove
	both with and without separator.
	[339be408f49a]

	* src/plugins/listescape/listescape-plugin.c:
	listescape: Don't escape characters in namespace prefixes.
	[0463fc241aae]

	* src/lib-index/mail-index-transaction-view.c:
	Transaction view: Don't assert-crash if record size grows during
	transaction.
	[22b45d08cd4e]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	transaction-log-file.c, src/lib-index/mail-transaction-log-view.c,
	src/lib-index/mail-transaction-log.h:
	lib-index: Added support for reading new records generated by
	Dovecot v2.0.
	[9445831aebc0]

	* src/lib-storage/index/cydir/cydir-mail.c, src/lib-storage/index/dbox
	/dbox-file.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/mbox/mbox-file.c, src/lib-storage/index/raw/raw-
	storage.c:
	Use separate read block sizes when reading only message header vs.
	full message.
	[1e8edebee242]

	* src/lib-storage/index/cydir/cydir-mail.c, src/lib-storage/index/dbox
	/dbox-file.c, src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/mbox/mbox-file.c, src/lib-storage/index/raw/raw-
	storage.c:
	lib-storage: Actually use MAIL_READ_BLOCK_SIZE sized blocks when
	reading mails.
	[2fd8d3a2bd52]

	* src/lib/istream-internal.h, src/lib/istream.c, src/lib/istream.h:
	Added i_stream_set_init_buffer_size().
	[70593ef74836]

2009-08-12  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/imap-proxy.c, src/pop3-login/pop3-proxy.c:
	login proxy: Changed again the "unavailable" error message.
	[68c1d3ab515d]

	* src/login-common/login-proxy-state.h, src/login-common/login-
	proxy.c:
	login proxy: Improvements to "fail immediately if server is down"
	handling. Now we use more precise timestamps. Also don't mark server
	as failed if another connect had succeeded after we started
	connecting.
	[34179f0f4d6a]

	* src/lib/time-util.c:
	timeval_diff_*() fixes.
	[00a1d109ecf6]

	* src/plugins/fts-squat/squat-test.c, src/plugins/fts/fts-storage.c:
	Use timeval_diff_*() more.
	[d48640a2ab4a]

	* src/imap/imap-search.c, src/lib-storage/index/index-search.c, src
	/lib-storage/index/maildir/maildir-filename.c, src/lib/Makefile.am,
	src/lib/ioloop.c, src/lib/time-util.c, src/lib/time-util.h,
	src/plugins/fts-squat/squat-test.c:
	Moved all struct timeval comparing/calculation code to lib/time-
	util.
	[f834d95f173a]

	* src/login-common/login-proxy-state.h:
	login proxy: Forgot to add login-proxy-state.h in previous commit.
	[bac1371c18e4]

	* src/login-common/Makefile.am, src/login-common/login-proxy-state.c,
	src/login-common/login-proxy.c, src/login-common/login-proxy.h, src
	/login-common/main.c:
	login-proxy: If proxy destination is known to be down, fail
	immediately. We'll use a simple rule: If connection failed or timed
	out more recently than it succeeded AND there are currently no
	clients trying to connect to it, fail it. Since the connect isn't
	failed unless there is at least one client already trying to connect
	to it, the proxy notices immediately when the server comes back up
	and then starts serving it again.
	[1072d2b53f72]

	* src/imap-login/imap-proxy.c, src/pop3-login/pop3-proxy.c:
	login proxy: Changed the message to show to clients when proxying
	fails.
	[dfbcb8ead5ef]

	* src/imap-login/client-authenticate.c, src/imap-login/imap-proxy.c,
	src/imap-login/imap-proxy.h, src/login-common/login-proxy.c, src
	/login-common/login-proxy.h, src/pop3-login/client-authenticate.c,
	src/pop3-login/pop3-proxy.c, src/pop3-login/pop3-proxy.h:
	login proxy: Added client_proxy passdb extra field to specify
	proxy's connect timeout.
	[e3ccd235a7e5]

2009-08-11  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	Fixed openssl malloc() failure check.
	[b7dbcf86086b]

2009-08-09  Timo Sirainen  <tss@iki.fi>

	* README, src/lib-imap/imap-resp-code.h:
	draft-gulbrandsen-imap-response-codes became RFC 5530.
	[ecc4b80c4dd1]

	* src/lib-storage/mailbox-list.c:
	Don't crash when listing shared namespace prefix.
	[9b62aa2132de]

	* src/plugins/autocreate/autocreate-plugin.c:
	autocreate: Fixed subscribe error message.
	[fc979053eaaa]

	* src/plugins/autocreate/autocreate-plugin.c:
	autocreate: Fixed autosubscribing to mailboxes in subscriptions=no
	namespaces. Also log autosubscribe failures if mail_debug=yes.
	[85e39b7710ee]

2009-08-07  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.2.3 for changeset 24952a7b371b
	[baea3f20c914]

	* .hgignore, NEWS, TODO, configure.in:
	Released v1.2.3.
	[24952a7b371b] [1.2.3]

	* src/lib-storage/index/index-thread.c:
	IMAP: Fixed THREAD .. INTHREAD crashing. Also cleaned up the code a
	bit.
	[76023d59c3b2]

	* configure.in, src/plugins/quota/quota-fs.c:
	configure: Removed --with-linux-quota parameter. It was useful only
	in some broken setups and even there it can be specified with
	CPPFLAGS instead.
	[2910aba191ec]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	dbox: Don't crash when trying to update migrated maildir's uidlist.
	Normally this shouldn't happen though.
	[22119217ab5d]

	* src/plugins/quota/Makefile.am:
	quota: Don't link rpcsvc library. It shouldn't be necessary since we
	generate our own rquota_xdr.c
	[4fcb729cfadc]

	* configure.in:
	configure: Allow --with-linux-quota=n to be only 1 or 2.
	[e92a9c18fd5b]

	* src/lib-storage/index/index-sort-string.c:
	sort: Don't assert-crash if sort indexes are broken.
	[c50f133f0acc]

	* src/plugins/fts-solr/fts-backend-solr.c, src/plugins/fts/fts-api-
	private.h, src/plugins/fts/fts-storage.c:
	fts: Fixed crashing with Squat. A better solution would be for Squat
	to use existing mailboxes' Squat indexes, but for now this isn't
	done.
	[96b764649cbb]

	* src/plugins/virtual/virtual-storage.c:
	virtual: If opening backend mailbox fails, show the maibox name.
	[682e09eb1e8f]

	* src/auth/db-ldap.c:
	ldap: Fixed hang when >128 requests were sent at once. Based on
	patch by Marek Miska.
	[a8bd5b0b6bb9]

	* src/lib-storage/mailbox-list.c:
	lib-storage: Disallow control characters in mailbox names when
	creating them.
	[e57d5c9daed3]

	* src/login-common/ssl-proxy-openssl.c:
	*-login: If OpenSSL fails with malloc failure, log an error.
	[c00df1152f1f]

	* src/lib-storage/index/maildir/maildir-save.c:
	maildir+deliver: Add all existing messages to uidlist if it doesn't
	exist yet.
	[d7251058200c]

	* src/login-common/ssl-proxy.c, src/master/ssl-init.c:
	Compiler warning fixes when building without SSL.
	[528f904067d4]

2009-08-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.h:
	index-mail: Expose tee_stream so plugins can read the stream too
	while mail is being read.
	[ae00eda5b152]

2009-08-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	mail_index_chown(): Check for fchown() failing with EPERM, not
	EACCES.
	[8ea90a23ed74]

	* src/login-common/ssl-proxy-openssl.c:
	ssl_username_from_cert=yes: Don't truncate username, don't allow
	NULs in it.
	[0de21e725d4e]

	* src/imap/cmd-delete.c, src/imap/cmd-subscribe.c:
	imap: Fixed tb-extra-mailbox-sep workeround.
	[9fe57d8ec946]

2009-08-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	mbox: Fixed mkdir() error logging. Not all errors are EACCES.
	[3a25f14abf12]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Don't recreate dovecot-uidlist all the time.
	[25c9df95fda6]

	* src/plugins/listescape/listescape-plugin.c:
	listescape: Fixed problems with handling mailbox listing.
	[7615ccab3829]

	* src/lib-storage/list/mailbox-list-maildir.c:
	maildir++: When renaming child mailboxes, don't check for ACLs. If
	we had access to rename the root, we must rename the children as
	well since that's what IMAP expects.
	[f55e989de7ac]

2009-08-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	maildir: Fixed error handling when trying to open non-existing
	namespace prefix.
	[f41f451984d7]

	* src/imap/cmd-list.c, src/imap/commands-util.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/list
	/mailbox-list-maildir.c, src/lib-storage/mail-namespace.c, src/lib-
	storage/mailbox-list.c, src/lib-storage/mailbox-list.h:
	Allow namespace prefix to be opened as mailbox, if it already
	exists.
	[13fa572535f0]

	* src/lib/env-util.c, src/lib/env-util.h, src/lib/lib.c:
	lib_deinit() now frees memory used by env_put().
	[19d851d93f92]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Don't access uninitialized variables.
	[693fa1d6160a]

2009-07-31  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	dovecot-example.conf: Fixed !include examples.
	[c3d4b5e72ac3]

2009-07-30  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-set-size.c:
	Handle posix_fallocate() failures correctly. Check also for AIX's
	"not supported" failure. Based on patch by Ralf Becker.
	[de52dfd93516]

2009-07-29  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-dotlock.c:
	Fixed file_dotlock_open*() logging errors in some OSes. Patch by
	Ralf Becker.
	[7a6be125e469]

	* src/master/master-settings.c:
	Fixed non-existing mail_gid error message to actually show the gid,
	not uid. Patch by Pascal Volk.
	[93759896b0d2]

2009-07-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-namespace.c:
	Fixed namespaces { list=no } and mail_debug=yes crashing on some
	OSes.
	[a303bb82c1c9]

2009-07-27  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-gssapi.c:
	gssapi: Error handling fix.
	[0ec0b1f1ac6a]

	* src/auth/mech-gssapi.c:
	gssapi: Fixed compiling for non-MIT/Heimdal GSSAPI implementations
	(Solaris).
	[ac2e37e4c2c1]

	* configure.in:
	configure: clock_gettime()'s -lrt adding dropped everything else
	from $LIBS.
	[cd29b745c8dd]

	* src/lib-settings/settings.c:
	Compiling fix for systems without GLOB_BRACE.
	[47449880c0b4]

	* .hgtags:
	Added tag 1.2.2 for changeset 3f25c2a13a71
	[8deada68e818]

	* NEWS, TODO, configure.in:
	Released v1.2.2.
	[3f25c2a13a71] [1.2.2]

2009-07-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir uidlist: Added better next_uid error tracking.
	[5a4875e92829]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	maildir: When UIDVALIDITY changes, don't reset uid_next to 1 in
	uidlist.
	[51aee73e49a5]

	* src/plugins/quota/quota-maildir.c:
	maildir++ quota: Quota was sometimes updated wrong when it was being
	recalculated.
	[1127a2fddffc]

	* src/lib-index/mail-cache-lookup.c:
	cache file: If offset isn't 32bit aligned, assume it's corrupted.
	[ea2eed32d59e]

	* src/auth/mech-gssapi.c:
	gssapi: Fail authentication if mechanism type isn't Kerberos 5. Also
	check GSS_KRB5_NT_PRINCIPAL_NAME more correctly.
	[b36b0291e1c1]

	* src/auth/mech-gssapi.c:
	gssapi: Don't do krb5_kuserok() to authz_name. It shouldn't be
	necessary.
	[1b3e90e829de]

	* src/master/master-settings.c, src/master/master-settings.h:
	dovecot -n/-a now outputs also lda settings.
	[d38e0412cfb4]

	* configure.in, dovecot-example.conf, src/lib-settings/settings.c:
	dovecot.conf: Added support for !include globs. Based on patch by
	Thomas Guthmann.
	[1aec43edab2d]

	* src/lib/mempool-system-clean.c, src/lib/mempool-system.c:
	Don't include malloc.h if it doesn't have malloc_usable_size().
	[d6fcb6d050ba]

	* src/plugins/lazy-expunge/lazy-expunge-plugin.c:
	lazy-expunge: Drop \Deleted flag when moving message.
	[45b110c8da62]

	* src/plugins/virtual/virtual-storage.c, src/plugins/virtual/virtual-
	storage.h, src/plugins/virtual/virtual-sync.c:
	virtual: If another session adds a new mailbox to index, handle it
	without crashing. For now we'll just disconnect the session.
	[88d4e83fcea5]

	* src/plugins/virtual/virtual-storage.c:
	virtual: Minor code cleanup.
	[b24bdff70c63]

	* src/lib-mail/message-decoder.c:
	message-decoder: Fixed assert-crashes caused by the previous quoted-
	printable change.
	[5b07514466c3]

	* src/auth/passdb-pam.c:
	pam: Fixed compiler warning with BSDs.
	[48b1f2b7144b]

	* src/lib-mail/message-header-decode.c, src/lib-mail/quoted-
	printable.c, src/lib-mail/quoted-printable.h:
	Split quoted-printable parsing to q-p body parsing and "Q" header
	parsing. Fixed also several other issues in quoted-printable parsing
	to get it fully RFC compliant.
	[ea84eb708efc]

	* src/plugins/acl/acl-backend-vfile.c:
	acl: Support spaces in user/group identifiers.
	[7168ca62c556]

	* src/master/mail-process.c:
	imap/pop3: If chdir() to home failed, euid was always logged as
	being root.
	[25650d7f6b85]

	* configure.in:
	configure: Check sasl.h existence only when using --with-ldap. Patch
	by Pascal Volk.
	[6a6091e473cc]

	* src/imap/main.c:
	imap: Fix to previous login_executable=imap error check.
	[8f376b8ce81d]

	* configure.in:
	configure: Use -lrt for clock_gettime() if necessary.
	[adda2c5bc0d0]

	* doc/Makefile.am:
	doc: thread-refs.txt was missing from distribution tarball.
	[354c1b47cfec]

	* src/lib-storage/index/index-thread-list.c:
	Removed unused code file.
	[e03aa0d99f3b]

	* configure.in:
	configure: Support finding PostgreSQL without pg_config after all.
	[61329a3c83bd]

2009-07-24  Timo Sirainen  <tss@iki.fi>

	* src/pop3/main.c:
	pop3: Fix to previous change: error message should say pop3, not
	imap.
	[7d54410a34b9]

	* src/imap/main.c, src/pop3/main.c:
	If login_executable=imap/pop3, give better error message.
	[1eb00fd62d1c]

	* src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h:
	Added mailbox_backends_equal().
	[72f159e0aaa6]

2009-07-21  Timo Sirainen  <tss@iki.fi>

	* src/lib/lib-signals.c:
	lib-signals: Redesigned how delayed signals are handled. Fixes
	signal handler hanging infinitely in write() when many signals were
	sent rapidly.
	[a878a0897eb9]

	* src/lib/utc-offset.c:
	utc_offset() was broken with year's first/last day if struct
	tm.tm_gmtoff didn't exist.
	[8e66ca02b6f9]

	* src/lib-index/mail-index-transaction-view.c:
	Transaction view: Fixed getting extension data from messages whose
	flags had changed.
	[ae3e0ff64c94]

2009-07-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/shared/shared-storage.c:
	shared mailboxes: If only %%n is specified in prefix, default to
	current user's domain.
	[518963e8a20d]

2009-07-17  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-gssapi.c:
	GSSAPI: Fixed memory leak on error conditions.
	[f57f9dab059b]

	* configure.in:
	configure: Use pg_config for figuring out PostgreSQL include/libs
	paths. pg_config has existsed since v7.1, so don't bother using any
	fallbacks.
	[71242a8c2dff]

2009-07-15  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-sync.c:
	IMAP: When QRESYNC is enabled, don't crash when a new mail is
	received while IDLEing.
	[2bb46e1c0f53]

	* src/plugins/virtual/virtual-storage.c:
	virtual: Compiler warning fix.
	[6a54f2c41cec]

	* src/plugins/quota/Makefile.am:
	quota-fs: One more build fix.
	[6b7151c1fdc2]

2009-07-14  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/Makefile.am:
	quota: Typofix to previous commit. Hopefully the last change..
	[b6aaca59301a]

	* src/plugins/quota/Makefile.am:
	quota: Yet another build fix for old automakes.
	[1b5a1ac430a7]

2009-07-27  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	IMAP: FETCH X-* parameters weren't working.
	[f353c5b71097]

2009-07-10  Timo Sirainen  <tss@iki.fi>

	* src/plugins/expire/expire-env.c:
	expire: Log initial configuration if mail_debug=yes.
	[bdd8cb7f341a]

	* src/plugins/quota/Makefile.am:
	quota: Fixed compiling with older automakes.
	[66040bffc1a5]

2009-07-09  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.2.1 for changeset 557eb84a64ae
	[f850d37fae04]

	* NEWS, configure.in:
	Released v1.2.1.
	[557eb84a64ae] [1.2.1]

	* src/plugins/quota/Makefile.am:
	quota: When building in a separate dir, make clean should delete
	copied rquota.
	[0a999fedb6e0]

	* src/plugins/convert/convert-storage.c:
	convert plugin: Fixed changing hierarchy separators in mailbox names
	when alt_hierarchy_char isn't set.
	[a9f719f9a509]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/login-common/sasl-server.c, src/login-common/sasl-server.h,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.c:
	login processes: Auth code cleanups. Custom IMAP auth errors now
	have [ALERT] prefix. This should make them visible in more clients.
	[754234248510]

	* src/master/mail-process.c:
	imap/pop3 logins now fail if home directory path is relative.
	[dd49cf3fd2c9]

	* src/master/mail-process.c:
	master: Give better error messages if UNIX uid/gid is too high/low.
	[23f676bada8c]

2009-07-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c:
	maildir: Error message fix.
	[572cd188f6da]

	* src/plugins/quota/Makefile.am:
	quota-fs: Another compiling fix (for older autotools?)
	[7d11a507cf3a]

	* src/lib/ioloop-notify-inotify.c:
	inotify: Give a better error message if user's watch limit exceeds.
	[5cc26d4fc00f]

	* src/lib/eacces-error.c:
	eacces_error_get*(): Show current directory if path is relative.
	[6d7f6ea02e17]

2009-07-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Added some checks for UIDs reaching 2^31-1. Saving messages
	when it's reached will be handled by assert-crash for now.
	[219ee9858156]

	* src/plugins/expire/expire-plugin.c:
	expire plugin: If mail_debug=yes, log more debug information.
	[df2d4e398c06]

	* src/plugins/expire/expire-plugin.c:
	expire plugin: If a transaction expunges all messages and saves a
	new one, don't delete expire row.
	[76cff789dae2]

	* src/plugins/acl/acl-backend-vfile.c:
	acl: dovecot-acl file caching fixes.
	[5d1a52e8d320]

	* src/plugins/acl/acl-backend-vfile-acllist.c:
	acl+mbox: Create also temp acllist file to control directory.
	[bf4f542ec6df]

	* src/lib/safe-mkstemp.c:
	safe_mkstemp*(): Truncate prefix to original length if creation
	failed.
	[644b956f5f5a]

	* src/plugins/acl/acl-backend-vfile-acllist.c:
	acl+mbox: Create dovecot-acl-list to control dir.
	[4c8175452173]

	* src/lib-storage/list/subscription-file.c, src/lib-storage/mailbox-
	list.c, src/lib-storage/mailbox-list.h:
	Added mailbox_list_create_parent_dir() and used it when creating
	subscriptions file.
	[f3c6cabae3af]

	* src/lib-storage/index/maildir/maildir-util.c:
	Maildir: Fixed using in-memory indexes when some required directory
	was missing.
	[c8dc38a3b902]

	* src/lib-storage/index/maildir/maildir-sync.c:
	OSX+Maildir: Also don't log an error if readdir() fails with EINVAL.
	[797474444551]

	* src/lib-storage/index/maildir/maildir-sync.c:
	OSX+Maildir: If readdir() fails with EINVAL after doing rename()s,
	retry. Fixes HFS+. Based on patch by Apple.
	[4e74f4651f5b]

	* src/auth/mech-gssapi.c:
	gssapi: Code cleanup.
	[5d9eab092e97]

	* src/auth/mech-gssapi.c:
	gssapi: Use *userok() functions only when authz_name != authn_name.
	Some more code cleanups.
	[f4ff64dd79a9]

	* autogen.sh:
	autogen.sh: Look up config.rpath also from
	/usr/local/shared/gettext/.
	[44db0de1bbd3]

	* src/auth/mech-gssapi.c:
	gssapi: Set username via auth_request_set_username(). This makes
	GSSAPI also use auth_username_* settings. Also improved logging.
	[a5c5a912769e]

	* src/auth/mech-gssapi.c:
	gssapi: Code cleanups. Logging error level changes.
	[4172004c1958]

	* src/lib-storage/mailbox-list.c:
	mail_location: Added support back for ~user/ expansion in paths.
	[072a44932976]

	* src/plugins/quota/Makefile.am:
	quota-fs: Fixed previous "VPATH build" commit to work with all
	shells.
	[9b8c606eb611]

	* src/lib-storage/index/mbox/mbox-sync.c:
	mbox: Don't use UIDVALIDITY 1 for all new mailboxes.
	[568ddefd7c18]

	* src/plugins/quota/quota-fs.c:
	quota-fs: Default to user quota with NFS, not group quota.
	[534de78dbe84]

2009-07-07  Matthias Andree  <matthias.andree@gmx.de>

	* src/plugins/quota/Makefile.am:
	Fix VPATH build of RQUOTA support.

	Some rpcgen derive #include "..." paths from the infile argument.
	This will be off for VPATH builds, as the generated rquota_xdr.c
	code will look in $(srcdir), but we'll generate the rquota.h file in
	$(builddir). Play safe and copy rquota.x to $(builddir) first.

	This fixes the build on openSUSE 11.1.
	[b340ecb24469]

2009-07-07  Timo Sirainen  <tss@iki.fi>

	* src/plugins/expire/expire-plugin.c, src/plugins/expire/expire-
	tool.c:
	expire: If mail_debug=yes, expire-tool shouldn't log about disabling
	expire plugin.
	[dff7312629a7]

	* src/auth/auth-request-handler.c:
	auth: Ignore empty initial response strings.
	[ee173ea99ea6]

	* src/pop3-login/client-authenticate.c:
	pop3: Fixed AUTH PLAIN command when SASL initial response wasn't
	specified.
	[8f8b5e2f8df7]

	* src/lib/file-dotlock.c:
	file_dotlock_open_*() shouldn't try to fchmod() with no uid/gid
	change. Patch by Ralf Becker.
	[d6337be8ae30]

2009-07-01  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.2.0 for changeset 9ca9361d74ce
	[f70192e7ff3c]

	* NEWS, configure.in:
	Released v1.2.0.
	[9ca9361d74ce] [1.2.0]

2009-06-30  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.2.rc8 for changeset 1e47487e482b
	[4ebc43fdda66]

	* NEWS, configure.in:
	Released v1.2.rc8.
	[1e47487e482b] [1.2.rc8]

	* src/master/master-settings.c:
	dump-capability: Use nobody's group as process gid.
	[62b9661b4c7a]

2009-06-29  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Fixed building LDAP support as plugin. Patch by Paul Howarth.
	[c2f6983a46c6]

2009-06-27  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.2.rc7 for changeset c375c16f1944
	[cfd984a489b7]

	* NEWS, TODO, configure.in:
	Released 1.2.rc7.
	[c375c16f1944] [1.2.rc7]

	* src/plugins/virtual/virtual-sync.c:
	virtual: Fixed inifinite looping.
	[86c32eb84dfa]

	* src/plugins/acl/acl-storage.c:
	acl: When creating a new child mailbox, copy parent's ACLs to it.
	[8faf1cc19bd7]

	* src/plugins/zlib/istream-bzlib.c, src/plugins/zlib/istream-zlib.c:
	zlib: Fixed error handling.
	[fcebba0f438f]

	* src/lib-dict/dict-sql-settings.c:
	dict sql: If pattern, table or value_field is unset, fail early with
	an error.
	[e67c9b3e88b0]

	* src/dict/dict-server.c, src/dict/main.c, src/lib-dict/Makefile.am,
	src/lib-dict/dict-client.c, src/lib-dict/dict-client.h, src/lib-dict
	/dict-db.c, src/lib-dict/dict-file.c, src/lib-dict/dict-private.h,
	src/lib-dict/dict-sql.c, src/lib-dict/dict.c, src/lib-dict/dict.h,
	src/master/dict-process.c, src/plugins/acl/Makefile.am,
	src/plugins/acl/acl-lookup-dict.c, src/plugins/expire/expire-
	plugin.c, src/plugins/expire/expire-tool.c,
	src/plugins/quota/Makefile.am, src/plugins/quota/quota-dict.c:
	dict proxy: Use base_dir as the default dict-server location.
	[eed86bcc33aa]

	* src/master/master-settings.c:
	dump-capability: Use nobody/nogroup as uid/gid if they exist.
	[2db158dd88be]

	* configure.in:
	configure --with-storages: Drop duplicate storages.
	[bc880b70d731]

	* src/plugins/virtual/virtual-save.c:
	virtual: Fixed saving messages with keywords.
	[668bb851d9a6]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib/istream-concat.c, src/lib/istream-
	crlf.c, src/lib/istream-data.c, src/lib/istream-file.c, src/lib
	/istream-limit.c, src/lib/istream-mmap.c, src/lib/istream-
	seekable.c, src/lib/istream.h, src/lib/ostream-file.c,
	src/plugins/zlib/istream-zlib.c:
	Added struct istream.readable_fd, which is used to determine if
	sendfile() can be used.
	[b1a27ed69e60]

2009-06-28  Daniel Mierswa  <impulze@impulze.org>

	* configure.in:
	Added --without-libcap configure option.
	[389148f79d49]

2009-06-27  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c, src/lib-index/mail-index-private.h, src/lib-
	index/mail-index-strmap.c, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/maildir/maildir-keywords.c, src
	/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/list/mailbox-list-fs.c, src/lib-
	storage/list/subscription-file.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mailbox-list-private.h, src/lib-storage
	/mailbox-list.c, src/lib-storage/mailbox-list.h, src/lib/eacces-
	error.c, src/lib/eacces-error.h, src/lib/file-dotlock.c, src/lib
	/file-dotlock.h, src/lib/mkdir-parents.c, src/lib/mkdir-parents.h,
	src/lib/safe-mkstemp.c, src/lib/safe-mkstemp.h, src/plugins/acl/acl-
	backend-vfile-acllist.c, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/lazy-expunge/lazy-expunge-plugin.c, src/plugins/quota
	/quota-maildir.c:
	Whenever file's group changing fails, show the group origin in the
	error message.
	[2bbf175bb6d3]

	* src/imap/commands-util.c:
	Compiler warning fix.
	[5379a940d62a]

	* src/lib-index/mail-index.c, src/lib-storage/index/maildir/maildir-
	uidlist.c:
	Use eacces_get_error() in more places for handling EACCES errors.
	[60c8ea46c740]

	* src/lib/eacces-error.c:
	eacces_error_get(): Check also if user had write permissions to the
	given file.
	[c69a1d0a6bd6]

	* configure.in:
	configure: Show also list of disabled passdbs/userdbs/sql drivers.
	[9214dd33a2a5]

	* configure.in:
	configure: Removed --disable-ipv6 parameter. There's really no point
	having it. Originally it was added back when some OSes had broken
	IPv6 support, but those OSes should be long gone by now. Also we
	still support automatically building without IPv6 support if it's
	not detected.
	[3270d0867546]

	* configure.in, src/Makefile.am:
	Removed configure --with-deliver and --with-pop3d parameters. If you
	don't want them, just don't use them. There are a lot of other
	useless binaries also being compiled.
	[8a2c85c418a1]

2009-06-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-master-connection.c:
	auth: Keep master connection referenced during USER lookups. Fixes a
	crash when master disconnected before USER lookup was finished.
	[af28db3176cf]

2009-06-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c:
	mbox: Don't write garbage to mbox if message doesn't have a body.
	[d639063977cc]

	* src/auth/auth-worker-client.h:
	auth: Increased auth workers' max. input line length to 8192.
	[5aa15e065760]

2009-06-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-namespace.c:
	Don't (double) free mail_user if namespace initialization fails.
	[27322203d925]

2009-06-22  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.2.rc6 for changeset 069d1d3f1760
	[d14e8b8df025]

	* NEWS, configure.in:
	Released 1.2.rc6.
	[069d1d3f1760] [1.2.rc6]

	* src/auth/auth-client-interface.h, src/imap-login/client.c,
	src/pop3-login/client.c:
	login client idle timeout should be larger than auth request
	timeout, not vice versa.
	[1c91fa0d804b]

	* src/plugins/acl/acl-backend-vfile-acllist.c:
	acl: If dovecot-acl-list writing fails, delete it so it gets rebuilt
	later.
	[8206c38856ff]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	imap-acl: Handle empty rights (no rights) properly.
	[f2426d980426]

	* src/plugins/acl/acl-backend-vfile.c:
	acl: Handle empty rights (no rights) properly.
	[ef644130d6c2]

	* src/lib-imap/imap-parser.c:
	imap_parser_read_args() didn't correctly return how many parameters
	were read.
	[31fe9a8740c3]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	imap-acl: Command parameter reading wasn't done correctly.
	[c7402e49132a]

2009-06-21  Timo Sirainen  <tss@iki.fi>

	* src/plugins/expire/auth-client.c:
	expire-tool: Set USER environment while processing a user.
	[283f52768314]

	* src/lib/eacces-error.c:
	eacces_error_get*() works now properly when process's real uid !=
	effective uid.
	[a32a8ea97b25]

	* src/lib/restrict-access.c, src/lib/restrict-access.h:
	Added restrict_get_groups_list() for easily getting list of
	process's groups.
	[c002187195bd]

	* src/plugins/expire/expire-tool.c:
	expire-tool: If auth_socket_path isn't set, default to base_dir
	/auth-master.
	[de64bd431b80]

	* src/lib-storage/mail-namespace.c:
	When accessing a shared namespace, don't change separators in
	mailbox name.
	[c4ac007d4e0b]

	* src/master/mail-process.c:
	master: Set BASE_DIR environment for mail processes.
	[a0fcbb79ef66]

	* src/lib-storage/mailbox-list.c:
	mail_location: Allow using ":" characters in dir names by escaping
	it as "::".
	[675f0df22f24]

2009-06-17  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/imap-login/client.h, src/imap-login
	/imap-proxy.c:
	imap-login: Using CAPABILITY command after STARTTLS shouldn't
	trigger CAPABILITY pushing workaround.
	[5ee5def4f0ff]

	* doc/solr-schema.xml, src/plugins/fts-solr/fts-backend-solr.c:
	solr: Don't use "any" copyfield, it doubles the index size.
	[d21bd1a1710a]

2009-06-16  Timo Sirainen  <tss@iki.fi>

	* src/util/threadview.c:
	threadview: If mmap() fails, fail with an error instead of crashing.
	[fd2869cf92fd]

	* src/plugins/expire/expire-tool.c:
	expire-tool --test: Don't write LFs after timestamps.
	[17e87db4e97c]

	* src/lib/strescape.c:
	str_append_unescaped() didn't unescape \\ correctly. The function
	wasn't used anywhere in Dovecot though.
	[e62afc5ef72f]

2009-06-15  Timo Sirainen  <tss@iki.fi>

	* src/plugins/expire/expire-tool.c:
	expire-tool --test: Fixed timestamp logging.
	[1d343780e009]

	* src/imap/client.c, src/imap/commands.c, src/imap/commands.h,
	src/imap/imap-sync.c, src/imap/imap-sync.h:
	IMAP: Don't crash if IDLE command is pipelined after a long-running
	UID FETCH or UID SEARCH.
	[ef7c0c3b1976]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-create.c,
	src/imap/cmd-rename.c, src/imap/cmd-subscribe.c, src/imap/commands-
	util.c, src/imap/commands-util.h:
	IMAP: Send [ALREADYEXISTS], [NONEXISTENT] and [TRYCREATE] resp-codes
	correctly.
	[39c234ab0b21]

	* src/imap/cmd-rename.c:
	IMAP RENAME: If dest mailbox exists but source doesn't, fail with
	"Mailbox doesn't exist".
	[67fe18c3f8dd]

	* src/plugins/expire/Makefile.am:
	expire-tool: Link mountpoint.o so quota plugin loading doesn't fail.
	[6f36829c9e0e]

	* src/auth/auth-request.c:
	auth: Don't assert-crash if trying to log in as master user but with
	empty login username.
	[6886f1e18c76]

	* src/lib-storage/index/dbox/dbox-index.c, src/lib/file-dotlock.c:
	safe_mkstemp*() was used incorrectly. umask() no longer changes its
	behavior.
	[c8bb7c18f17b]

	* src/lib-index/mail-transaction-log.c:
	Transaction log dotlocking ignored mail_nfs_index and
	dotlock_use_excl settings.
	[73b9d8556f5a]

	* src/lib-storage/mailbox-list.c:
	When getting fs permissions for a non-existing mailbox, fallback to
	root dir's permissions.
	[0cdb6c23683f]

	* src/imap-login/imap-proxy.c:
	imap proxy: Fix to previous change.
	[ca486f917810]

	* src/plugins/acl/acl-backend-vfile.c:
	acl: Don't assert-crash if removing all rights.
	[01fae3737994]

	* src/imap-login/imap-proxy.c:
	imap proxy: Pass through to client unexpected untagged replies from
	remote server.
	[b745911012bb]

2009-06-11  Timo Sirainen  <tss@iki.fi>

	* src/util/Makefile.am, src/util/imap-utf7.c:
	imap_utf7: Renamed to imap-utf7. Also fixed usage error string to
	print LF.
	[6c0fb914e03e]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	mbox: Don't crash with invalid From_-lines.
	[96aec5ab1a52]

2009-06-05  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	dovecot-example.conf: Changed auth_verbose comment.
	[a9d3108d0cec]

2009-06-04  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.2.rc5 for changeset 9da0277755a2
	[795f9ac28894]

	* NEWS, TODO, configure.in:
	Released v1.2.rc5.
	[9da0277755a2] [1.2.rc5]

	* src/imap/cmd-delete.c:
	IMAP: DELETE command didn't properly check if we were deleting
	selected mailbox.
	[3e1899f7c205]

2009-06-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/Makefile.am, src/lib-sql/Makefile.am:
	Compiling fix for Solaris 7.
	[b4b21b51dbc5]

2009-06-02  Timo Sirainen  <tss@iki.fi>

	* src/imap/commands-util.c:
	IMAP: Error handling fix for mailbox name validity checking.
	[c58d78c4ea06]

	* src/plugins/virtual/virtual-storage.c:
	virtual: Error handling fix. Don't expose hidden namespace names.
	[bfa4b2c29dc2]

2009-06-01  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	IMAP FETCH: Previous change broke fetching RFC822*.
	[9ae55b68cf61]

	* src/imap/imap-fetch.c:
	IMAP FETCH: Binary searching fetch handlers was a bit broken.
	[4d2b2adfd415]

	* src/plugins/expire/expire-tool.c:
	expire-tool: Initialize plugins also after loading them.
	[1a7c6732730e]

	* src/imap/cmd-uid.c:
	IMAP: cmd->name memory was allocated wrong.
	[f1a6c9dd4c33]

	* src/lib-mail/message-id.c:
	message_id_get_next() didn't contain @ in reply when msgid wasn't in
	canonical form.
	[9d634c93d28a]

	* src/lib-mail/message-address.c, src/lib-mail/message-address.h:
	message_address_write() wrote extra @ if route was specified.
	[228100f53e88]

2009-05-31  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/auth/auth-cache.c, src/auth/auth-cache.h,
	src/auth/auth-request.c, src/auth/passdb-cache.c:
	auth_cache_negative_ttl is now also used for password mismatches.
	[8a23ab43132a]

	* src/plugins/fts-solr/solr-connection.c:
	fts-solr: Reset XML parser when doing update requests. We don't
	really care about what the XML contains, we'll just verify that it's
	valid input.
	[0c99b67068cb]

	* src/lib-index/mail-index.c, src/lib-storage/mailbox-list.c:
	More group permission handling fixes.
	[e7c0b3068d58]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index.c, src/lib-index/mail-
	transaction-log-file.c:
	index: Handle better errors where a new file's group can't be
	changed.
	[0f2f9e207644]

	* src/imap/cmd-uid.c:
	IMAP: UID commands didn't set cmd->name properly. Patch by Richard
	Platel.
	[940dc274068c]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/maildir
	/maildir-util.c, src/lib-storage/mailbox-list.c:
	storage: Create index/control root directories using same
	permissions as mail root.
	[2f2a907f1132]

	* src/lib/mkdir-parents.c, src/lib/mkdir-parents.h:
	Added mkdir_chown().
	[3870069faea3]

	* src/master/listener.c:
	Give a better error message when trying to listen on IPv6 address
	and IPv6 is disabled.
	[1877cf23eec7]

	* src/plugins/expire/expire-tool.c:
	expire-tool: Make sure expire plugin won't get used.
	[531083e6e84a]

	* src/plugins/expire/Makefile.am, src/plugins/expire/expire-tool.c:
	expire-tool: Load plugins from mail_plugins setting.
	[6fd725b94504]

	* src/plugins/expire/expire-tool.c:
	expire-tool --test: Log timestamps also in user-readable format.
	[f144ef760714]

	* src/lib-storage/index/maildir/maildir-mail.c:
	Maildir: Use i_stream_stat() instead of i_stream_get_fd()+fstat().
	Fixes zlib plugin.
	[e77a5e5ffc9d]

2009-05-28  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-config.c:
	virtual: If search rule is missing, use SEARCH_ALL.
	[6e42cd6ae8a7]

	* src/lib-storage/mail-search.c:
	mail_search_args_dup(): Don't return broken results if there are no
	search args.
	[77aab257cea2]

2009-05-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-header-parser.c:
	message header parser: Don't set hdr->continues=TRUE when
	hdr->eoh=TRUE. This happened if body began with LWSP. Also if parser
	has seen eoh but not the following character, don't bother waiting
	for it.
	[eead0542095f]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-idle.c, src/imap/imap-search.c:
	imap: Cleaned up "command pending" handling code. Should fix hangs
	caused by recent changes.
	[9a0aa39a3a14]

	* src/imap/imap-sync.c:
	imap: Don't cancel sync if client disconnects in the middle. Fixes
	"Message count decreased" errors.
	[60204e3f7c4d]

	* src/auth/auth-request.c, src/auth/passdb.c:
	auth: Improved "Password not in expected scheme" error message.
	[a4bdf6d119f6]

	* src/plugins/virtual/virtual-mail.c:
	virtual: Don't assert-crash if trying to access an expunged mail.
	[73d6117770c7]

	* src/plugins/virtual/virtual-sync.c:
	virtual: Fix to previous commit.
	[abad454e99bb]

	* src/plugins/virtual/virtual-storage.c, src/plugins/virtual/virtual-
	storage.h, src/plugins/virtual/virtual-sync.c:
	virtual: Fixed crashes when simultaneous connections accessed the
	same virtual mailbox.
	[7c162aa78714]

	* src/plugins/convert/convert-storage.c:
	convert plugin: Don't crash after finishing conversion.
	[b2b9cbe17d1b]

2009-05-25  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-storage.c:
	virtual: Virtual mailboxes shouldn't be counted in quota.
	[8eaa3476bdef]

	* src/deliver/deliver.c, src/lib-storage/mail-namespace.c, src/lib-
	storage/mail-namespace.h, src/plugins/acl/acl-lookup-dict.c,
	src/plugins/acl/acl-mailbox-list.c, src/plugins/acl/acl-storage.c,
	src/plugins/lazy-expunge/lazy-expunge-plugin.c, src/plugins/quota
	/quota-storage.c:
	Split NAMESPACE_FLAG_INTERNAL into distinct _NOQUOTA and _NOACL
	flags.
	[5a593a838f90]

	* src/imap-login/client-authenticate.c:
	imap: Don't send "Waiting for auth process" if it's the client
	that's waiting on AUTHENTICATE.
	[c7db09d796b9]

	* src/deliver/deliver.c:
	deliver: If temp file can't be created because home dir doesn't
	exist, create it.
	[36d823adb302]

	* src/deliver/deliver.c, src/lib/istream-seekable.c, src/lib/istream-
	seekable.h:
	istream-seekable: Changed API to use a callback function to create
	the temp file.
	[82949209612e]

	* src/plugins/convert/convert-storage.c:
	convert plugin: If alt_hierarchy_char isn't specified, don't
	truncate mailbox names.
	[616c0ee81222]

	* src/plugins/convert/convert-tool.c:
	convert-tool didn't handle command line parameters correctly.
	[478ad35af83a]

	* src/lib-imap/imap-parser.c:
	imap-parser: Don't return early if line ends with CR but there's no
	LF.
	[09f78cad5d58]

	* dovecot-example.conf:
	dovecot-example.conf: Make it clear mail_log_group_events is
	boolean.
	[f1b0ef72cea7]

	* src/auth/Makefile.am, src/auth/mech-external.c:
	auth: Added support for EXTERNAL SASL mechanism.
	[e3fe9b4a6a2d]

	* src/auth/mech.c:
	auth: If initial SASL reply was given but empty, pass it to auth
	mechanisms.
	[76d455a7f4da]

	* src/lib-mail/message-decoder.c:
	Message-decoder: Fixes to handling binary body parts.
	[7cb4741f076e]

	* src/imap/client.c:
	imap: Mailbox closing command shouldn't hang on waiting a delayed
	sync to finish.
	[73b468723964]

2009-05-24  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c:
	IMAP: Make sure pending syncs are done before a mailbox-changing
	command is run.
	[d77225a64128]

2009-05-22  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-fetch.c:
	FETCH: If FETCH returned [EXPUNGEISSUED], it got stuck to all
	subsequent replies too.
	[995d501d8f41]

	* src/lib-storage/list/mailbox-list-fs.c:
	Mailbox renaming with LAYOUT=fs wasn't renaming control dirs if they
	were used.
	[90915833f106]

2009-05-21  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	imap code cleanup: Use array instead of buffer for storing fetch
	handlers.
	[43f15920dbaa]

	* src/imap/imap-fetch.c, src/imap/imap-fetch.h, src/imap/main.c:
	IMAP: Register FETCH handlers at startup so we don't break if
	plugins add them.
	[106e4e3dccbc]

	* src/auth/password-scheme.c:
	auth: Handle crypt() failing.
	[b57a14e489b3]

2009-05-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	Added FETCH X-SAVEDATE. Based on patch by Alaa Ibrahim.
	[aedec88c6e31]

	* src/deliver/deliver.c:
	deliver_log_format: %s should contain subject in UTF8, not in MIME-
	encoded form.
	[0fdffcb66945]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Maildir: Make sure messages are removed from index if they are
	deleted externally from new/. The problem happened when a message in
	new/ was indexed, deleted externally and the mailbox was again
	opened as read-only. This caused a partial sync in new/ directory,
	which didn't notice that the files were gone.
	[e7792f4509e6]

	* src/auth/db-ldap.c, src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	auth: Fixed using ldap plugin.
	[a31fb9b7179a]

	* configure.in:
	configure: Removed accidentally committed debug line.
	[411ee74cae35]

	* configure.in, src/master/main.c:
	dovecot --build-options: If SQL or LDAP was built as plugins, say
	it.
	[d936c8e243dd]

2009-05-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-search.c:
	SEARCH INTREAD: Crashfix when deinitializing.
	[172cfd750a40]

	* src/imap/imap-fetch-body.c:
	If FETCH gets too little message data, use "FETCH failed"
	disconnection reason.
	[694714d59cd9]

	* src/lib/ostream-file.c:
	o_stream_send_istream(): Make sure istream->eof gets set after
	sending everything with sendfile().
	[3442cd45b502]

	* src/lib/sendfile-util.c:
	safe_sendfile(): Error handling fixes for Linux and Solaris.
	[46c9e3364d81]

2009-05-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/Makefile.am, src/lib-storage/index/index-thread.c,
	src/lib-storage/mail-thread.c:
	Moved mail_thread_type_parse() to lib-storage.a to avoid some
	linking problems.
	[d42a8623a008]

	* src/lib-mail/message-decoder.c, src/lib-mail/message-decoder.h, src
	/lib-mail/message-search.c, src/plugins/fts/fts-storage.c:
	message-decoder now supports optionally returning non-text bodyparts
	as-is.
	[44548a7fb10d]

	* .hgtags:
	Added tag 1.2.rc4 for changeset 27a49c619a33
	[d99c62c8ddd2]

2009-05-17  Timo Sirainen  <tss@iki.fi>

	* NEWS, TODO, configure.in:
	Released v1.2.rc4.
	[27a49c619a33] [1.2.rc4]

	* src/plugins/expire/expire-tool.c:
	expire-tool: Clear only user-specific environment variables when
	changing users.
	[249554df412f]

	* src/lib/env-util.c, src/lib/env-util.h:
	Added env_backup_*() for saving/restoring environment.
	[89de2b91a655]

	* src/plugins/zlib/istream-zlib.c:
	zlib: Don't expose file descriptor. Others can't do anything with it
	anyway. Fixes o_stream_send_istream(zlib_istream), which was trying
	to sendfile() the compressed data.
	[b52f165fccd8]

	* src/lib/env-util.c:
	env_clean(): Clear the environment memory pool also. We trust that
	nowadays our environment clearing code works everywhere.
	[843f81083d0f]

	* src/lib/env-util.c:
	env-util: Minor code cleanup.
	[eb748e01a42b]

	* src/lib-dict/dict-db.c:
	Berkeley DB dict: Transactions should be aborted with abort(), not
	discard().
	[c09602d2820c]

	* src/plugins/expire/auth-client.c:
	expire-tool: Fix to previous change to actually use the mail_gid.
	[6dec24ec8218]

	* src/plugins/expire/auth-client.c, src/plugins/expire/expire-
	plugin.h, src/plugins/expire/expire-tool.c:
	expire-tool: Use mail_uid and mail_gid settings if userdb doesn't
	return uid/gid.
	[cc484a16bbe4]

	* src/plugins/virtual/virtual-config.c, src/plugins/virtual/virtual-
	storage.c, src/plugins/virtual/virtual-storage.h:
	virtual: If we can't open a mailbox that was added using a wildcard,
	just skip it.
	[c5b16d6c39c9]

	* src/lib-storage/mailbox-list.c, src/plugins/virtual/virtual-
	storage.c, src/plugins/virtual/virtual-sync.c:
	Memory usage tweaks.
	[54686141353f]

	* src/plugins/quota/quota-fs.c:
	quota-fs: Improved debug logging.
	[1e9bb18eb439]

	* src/plugins/virtual/virtual-config.c, src/plugins/virtual/virtual-
	storage.c, src/plugins/virtual/virtual-sync.c:
	virtual: Fixed handling multiple mailboxes using the same search
	args.
	[720560d19f5b]

	* src/lib-storage/mail-search.c, src/lib-storage/mail-search.h:
	Added mail_search_args_dup().
	[ef33393452f7]

	* src/plugins/virtual/virtual-sync.c:
	virtual: Handle broken index files better.
	[5e60bba2c748]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log.h:
	Added mail_index_unlink().
	[c8d63b42e9cc]

	* src/lib-sql/sql-pool.c:
	Dropping connections from sql connection pool could have crashed.
	[533e4829212a]

	* src/plugins/virtual/virtual-sync.c:
	virtual: Fixed several crashes.
	[b58a3ad27c88]

	* src/lib/module-dir.c:
	Module loading: Increased initial memory pool size.
	[361b9a35e102]

	* src/lib-storage/index/index-search-result.c, src/lib-storage/index
	/index-search-result.h, src/lib-storage/index/index-sync-private.h,
	src/lib-storage/index/index-sync-search.c, src/lib-storage/index
	/index-sync.c:
	Tracking flag updates in saved search results was broken when
	expunging messages.
	[387f84b2768e]

	* src/lib-storage/index/index-thread-links.c:
	Message threading assert-crashfix.
	[2d5f38d2af31]

	* src/plugins/virtual/virtual-sync.c:
	virtual: Assert-crashfix when opening mailbox.
	[6810af53ae30]

	* src/lib-storage/index/index-search.c:
	Search: Added an assert.
	[b77fbbee8749]

	* src/lib-storage/index/index-thread.c:
	mail_thread_init(): Don't assert-crash when checking if we can use a
	cached thread tree.
	[e3ee0a4c0b58]

	* src/master/log.c:
	Add "dovecot: " log prefix only for messages from master process.
	[194b80691980]

	* src/lib/failures.c:
	logging: Write log prefix after timestamp, not before.
	[0669bc561763]

	* src/master/dict-process.c:
	dict process wasn't restarted after SIGHUP was sent to master.
	[125862a5b52f]

	* src/imap/cmd-list.c:
	LIST: Previous prefix="", list=no change broke listing other list=no
	namespaces.
	[db2fdf3529ac]

2009-05-15  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-append.c:
	APPEND: Don't assert-crash if message size parameter isn't given.
	[fa9bc4ef6f32]

2009-05-14  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c:
	imap: When multiple commands are pipelined, try harder to combine
	their mailbox syncing together.
	[421393827a81]

2009-05-13  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	Fixed checking if protocols setting contains only invalid values.
	[cbeae4ef9af5]

	* dovecot-example.conf:
	dovecot-example.conf: Clarified that commented sections or plugin
	settings aren't defaults.
	[c741d2b135da]

2009-05-12  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c:
	ldap: When using the same LDAP attribute multiple times, give an
	error message.
	[d59748e6a8e8]

	* src/auth/db-ldap.c:
	LDAP: If LDAP_OPT_ERROR_STRING gives more information, log it.
	[4323944abc43]

2009-05-11  Timo Sirainen  <tss@iki.fi>

	* src/lib/data-stack.c:
	DEBUG: data-stack buffer overflow checking code was causing false
	positives.
	[fc8f3f5a7548]

2009-05-09  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c, src/lib-storage/mail-namespace.c:
	Allow prefix="" namespace to have list=no and make it work in a
	somewhat useful way. Based on patch by Mark Washenberger.
	[e36a9edb5fb0]

	* src/lib-index/mail-transaction-log-view.c, src/lib-index/mail-
	transaction-log.h:
	mail_transaction_log_view_clear() should keep oldest_file_seq and
	newer referenced.
	[a6779d086785]

2009-05-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/driver-pgsql.c:
	pgsql: We hadn't called PQsetnonblocking().
	[7ccc533e30bb]

2009-05-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h:
	Maildir: More fixes to uidlist handling.
	[0bb192fe0abd]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/maildir/maildir-uidlist.c,
	src/lib-storage/index/maildir/maildir-uidlist.h, src/lib-
	storage/index/maildir/maildir-util.c:
	Maildir: Handle uidlist errors better.
	[0aa17f3e4a6d]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Maildir saving: Fixed race condition bugs in uidlist handling,
	causing files to be given new UIDs sometimes.
	[6770f46971af]

	* src/lib-mail/rfc2231-parser.c:
	Try to skip over errors in Content-Type parameters.
	[05a98aaf0aaf]

2009-05-03  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib/randgen.c:
	If /dev/arandom exists (OpenBSD), use it instead of /dev/urandom.
	[e569d73e9056]

	* src/lib/primes.c:
	Compiler warning fix.
	[e9e8446ae0ec]

2009-05-02  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-idle.c:
	IDLE: Check DONE case-insensitively.
	[3a4bed08b59d]

	* src/plugins/virtual/virtual-config.c:
	virtual: Open the dovecot-virtual as readonly, we don't need to
	write to it.
	[da37aa38ca89]

2009-05-01  Timo Sirainen  <tss@iki.fi>

	* doc/Makefile.am, doc/dovecot-initd.sh:
	Added example init.d/dovecot script.
	[c2d55b298ec8]

	* src/lib-storage/index/shared/shared-storage.c:
	shared mailboxes: Don't crash if trying to open "shared/domain"
	namespace prefix as mailbox.
	[4fd7b98bcff9]

	* src/plugins/virtual/virtual-storage.c:
	virtual: Don't show mailboxes as \Noselect.
	[fc4f65a4ca60]

	* src/plugins/mbox-snarf/mbox-snarf-plugin.c:
	mbox-snarf plugin: Fixed memory/io leaking.
	[66b6cd495702]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/istream-
	mail-stats.c, src/lib/istream-internal.h, src/lib/istream-limit.c,
	src/lib/istream.c:
	istreams: Fixed some parent stream seeking issues.
	[06bd1266f0c7]

	* src/lib-storage/index/mbox/mbox-sync.c:
	mbox: Don't crash when expunging all messages and file doesn't end
	with [CR]LF.
	[e87431fb8c90]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	mbox: Fix to handling CRs before From_ lines.
	[d2d93c02dc7b]

	* src/plugins/virtual/virtual-config.c:
	virtual: Allow search rules to begin with TAB instead of space.
	[2f895db2af46]

	* src/lib/file-dotlock.c:
	dotlocking: Don't generate "Will override dotlock in 0 secs"
	messages.
	[89b825b20f76]

	* src/lib/safe-mkstemp.c:
	safe_mkstemp()'s mode parameter didn't override umask as it was
	supposed to.
	[5302ce189a70]

2009-04-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-file.c:
	dict-file: When replacing the dict file, preserve its permissions.
	[b02c642b4e51]

	* src/lib-storage/mailbox-list.c:
	When :MAILBOXDIR= was empty, we might have appended extra '/' to it,
	which caused problems.
	[afc1b0ef120d]

	* src/lib-storage/index/mbox/mbox-storage.c:
	mbox: When skipping subscriptions file, use the configured filename
	instead of hardcoded one.
	[86cdd80b9b11]

	* src/lib-storage/index/maildir/maildir-sync.c:
	maildir: Don't assert-crash if we have no read-access to the
	Maildir.
	[cceea391d04d]

	* src/lib-dict/dict-file.c:
	dict-file: If file_dotlock_open() fails, log also the path.
	[c34010571c02]

2009-04-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/cydir/cydir-mail.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/index-search.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/raw/raw-
	mail.c, src/lib-storage/mail-storage-private.h:
	Split struct mail_private.stats_dentry_lookup_count to open/stat
	counts.
	[e14f1d4b6688]

	* src/util/rawlog.c:
	rawlog: If mail_debug=yes, log if dovecot.rawlog/ directory doesn't
	exist.
	[ace37e01c2e0]

	* src/lib-storage/mail-storage.c:
	Shared mailboxes: Fixed a bug where some mailboxes were added to
	root shared namespace.
	[739c4e372140]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Don't show "* OK" messages about lock waits too early.
	[9f91cc822f34]

	* src/plugins/virtual/virtual-storage.c:
	Virtual: If opening a virtual mailbox fails, don't leak
	memory/timeouts.
	[47fa92207042]

	* src/plugins/virtual/virtual-config.c:
	virtual: If last search rule was invalid, we gave "Unknown error".
	[1d21a3d0a295]

	* dovecot-example.conf:
	Unified all <doc/wiki/*.txt> links to look exactly the same.
	[a2ae93a8c7d2]

	* dovecot-example.conf:
	dovecot-example.conf: Improved rawlog example.
	[37c0111961f5]

	* src/auth/db-ldap.c:
	ldap: If first request is over 60 seconds old while a new request
	comes, reconnect.
	[0d3b712342d9]

	* src/login-common/ssl-proxy-openssl.c:
	ssl-proxy: Crashfix to previous commit.
	[d475e17d01a3]

2009-04-28  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/imap-login/imap-proxy.c, src/imap-login
	/imap-proxy.h, src/login-common/login-proxy.c, src/login-common
	/login-proxy.h, src/login-common/ssl-proxy-openssl.c, src/login-
	common/ssl-proxy.c, src/login-common/ssl-proxy.h, src/pop3-login
	/client-authenticate.c, src/pop3-login/client.c,
	src/pop3-login/client.h, src/pop3-login/pop3-proxy.c,
	src/pop3-login/pop3-proxy.h:
	imap/pop3 proxy: Support SSL/TLS connections to remote servers.
	passdb can return ssl=yes, ssl=any-cert and starttls options.
	[f43bebab3dac]

	* src/lib-storage/index/index-search.c:
	Use the new mail_private.stats_* fields to stop non-blocking
	searches after about 250 ms.
	[e7bfb3c134f9]

	* src/lib-storage/index/Makefile.am, src/lib-storage/index/cydir
	/cydir-mail.c, src/lib-storage/index/dbox/dbox-file.h, src/lib-
	storage/index/dbox/dbox-mail.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-mail.h, src/lib-storage/index/istream-mail-stats.c, src/lib-
	storage/index/istream-mail-stats.h, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/raw/raw-mail.c, src/lib-
	storage/mail-storage-private.h:
	struct mail_private now contains all kinds of statistics about file
	accesses.
	[fdaf0bda70d5]

	* src/lib-storage/index/index-search.c:
	Search: Perform all lookups from cache before attempting any
	uncached lookups.
	[947fab5a8992]

	* src/lib-storage/index/cydir/cydir-mail.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/mbox/mbox-mail.c, src/lib-storage/index/raw/raw-
	mail.c, src/lib-storage/mail-storage-private.h, src/lib-storage
	/mail-storage.h, src/lib-storage/mail.c:
	Added struct mail.lookup_abort, which can be used to abort lookups
	that can't be done using cache.
	[5611bba3548b]

2009-04-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-header-parser.c:
	Message header parser didn't skip all LWSP at the beginning of
	headers, only one. Patch by Johann Klasek.
	[c8de2237478f]

2009-04-22  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/imap-login/client.h, src/imap-login
	/imap-proxy.c:
	imap-proxy: Send backend's CAPABILITY if it's different from what
	was sent to client before.
	[f8404c0f14de]

	* src/imap-login/imap-proxy.c:
	imap-proxy: Don't break ID capability check if it's the last
	capability.
	[2e3baa171e20]

2009-04-21  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	master: "Unknown argument" error printed always the first argument
	instead of the unknown one.
	[59a3130bd4ed]

	* src/lib-settings/settings.c:
	Settings parser: And actually make it relative to their parent, not
	to root config..
	[3d9c9b16f000]

	* src/lib-settings/settings.c:
	Settings parser: !included files without absolute paths are relative
	to their parent config file.
	[c2595e358867]

2009-04-20  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-sync.c:
	virtual: Reversed the broken "fix" in previous commit.
	[1f4f68091243]

	* src/plugins/virtual/virtual-sync.c:
	virtual: Some cleanups and fixes.
	[796149c5f3f0]

	* src/lib/array.c:
	array_idx_clear() was broken when clearing an index outside the
	existing array.
	[9ab0177cd004]

	* src/imap/cmd-list.c:
	namespaces: list=children wasn't working correctly.
	[163c3f85a3aa]

	* src/lib-storage/index/shared/shared-list.c:
	shared mailboxes: LIST shared/% shouldn't list "%" entry.
	[6a4cccf11702]

	* src/plugins/quota/quota-maildir.c:
	Maildir++ quota: Recalculation was broken if limits were defined by
	maildirsize file (and not quota_rules).
	[56732ef5ff96]

	* src/deliver/mail-send.c:
	deliver: When forwarding messages, use -f parameter as return path
	and fallback to normalized Return-Path: header.
	[5317349a8dea]

2009-04-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/shared/shared-storage.c:
	Allow shared namespaces to have subscriptions=yes.
	[0dcb7e34a216]

	* src/plugins/fts-solr/solr-connection.c:
	fts-solr: Don't break with curl versions older than v7.17.
	[b9e7bea1d70a]

	* src/master/main.c:
	Removed unused code.
	[5a9c5c65eec0]

2009-04-16  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.2.rc3 for changeset 82ba352b51ae
	[efbce8ddd067]

	* NEWS, configure.in:
	Released v1.2.rc3.
	[82ba352b51ae] [1.2.rc3]

	* src/lib-storage/index/index-thread-finish.c:
	THREAD REFS still might have returned one (0) at the beginning.
	[a2a28c52e951]

	* src/plugins/quota/quota-maildir.c:
	maildir++ quota: Make sure we don't create maildirsize file to wrong
	namespace.
	[b2cd58981808]

	* src/plugins/quota/quota-maildir.c:
	quota: Compiler warning fix.
	[56b21ef694cc]

	* src/plugins/imap-quota/imap-quota-plugin.c:
	imap-quota: Allow GETQUOTAROOT for public namespaces.
	[33f3016673aa]

	* src/plugins/quota/quota-count.c, src/plugins/quota/quota-dict.c,
	src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-
	maildir.c, src/plugins/quota/quota-plugin.c, src/plugins/quota
	/quota-plugin.h, src/plugins/quota/quota-private.h,
	src/plugins/quota/quota-storage.c, src/plugins/quota/quota.c:
	Implemented support for per-namespace quotas. Can be used with
	public namespaces.
	[16c286aee307]

	* src/lib-storage/mail-storage.c:
	When mailbox is successfully opened, mark its namespace as being
	usable.
	[d7847f03ae65]

	* src/lib-storage/index/shared/shared-storage.c:
	shared mailboxes: Don't assert-crash if trying to look up "" user's
	mailboxes.
	[9619fbd698d5]

	* dovecot-example.conf, src/imap/cmd-idle.c, src/master/mail-
	process.c, src/master/master-settings-defs.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added imap_idle_notify_interval setting.
	[8de5b2a19a08]

	* src/plugins/virtual/virtual-sync.c:
	virtual: Crashfix. Also cleaned up the code a bit.
	[91da114598f1]

2009-04-15  Timo Sirainen  <tss@iki.fi>

	* src/master/login-process.c:
	Compile fix for old non-C99 compilers.
	[933d95978040]

	* src/lib-storage/index/index-search-result.c:
	Search result updating: Make sure search args are initialized.
	[d1c0ff11981d]

	* src/lib-storage/mail-search.c, src/lib-storage/mail-search.h:
	mail_search_args_[de]init() calls stack now. Last unref is still
	allowed without deiniting.
	[77fb2731830b]

	* src/plugins/fts-solr/fts-backend-solr.c, src/plugins/fts/fts-
	storage.c, src/plugins/fts/fts-storage.h:
	fts: Fixes to how virtual mailboxes are searched.
	[ec1ae90af21a]

	* src/plugins/virtual/virtual-mail.c:
	virtual: Return original mailbox names with namespace prefix.
	[508bbbd4e6f6]

	* src/lib-storage/list/mailbox-list-maildir.c:
	Maildir++ layout: Allow selecting namespace prefix if inbox=no. With
	Maildir this allows opening the "mailbox root" (i.e. INBOX).
	[7364e19b703e]

	* src/plugins/virtual/virtual-config.c:
	virtual: Fixed using !INBOX when INBOX wasn't in prefix=""
	namespace.
	[71ee47b69bc7]

2009-04-14  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-solr/fts-backend-solr.c:
	Compiler warning fix.
	[7e639229c2c8]

	* src/plugins/fts-solr/fts-backend-solr.c:
	fts-solr: Fixes with virtual mailboxes.
	[43b68bd6023a]

2009-04-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h:
	Removed duplicate mail_index_is_in_memory().
	[1143c696126a]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	storage/index/maildir/maildir-uidlist.c:
	maildir: When saving messages, in some race conditions we might have
	written a duplicate UID.
	[206af25d21bc]

	* src/lib-index/mail-transaction-log-view.c:
	indexes: Added a new assert.
	[653197bf5f55]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-transaction-log-
	append.c, src/lib-index/mail-transaction-log-file.c, src/lib-index
	/mail-transaction-log.c:
	indexes: Error handling fixes.
	[eb9e5ab575a9]

	* src/lib-storage/index/maildir/maildir-save.c:
	maildir saving: If dovecot-uidlist reading failed, we might have
	gone forward and crashed.
	[aba994bec90b]

2009-04-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	mbox: When doing autodetection, don't just create the missing mbox
	directory.
	[302bfa9ae105]

	* src/lib-index/mail-index-map.c, src/lib-storage/index/shared/shared-
	list.c:
	Memory leak fixes.
	[3cc00d9d1c12]

2009-04-09  Timo Sirainen  <tss@iki.fi>

	* src/master/dict-process.c:
	dict: Fixed crashes when dict process dies.
	[5f96ac54de4d]

	* src/plugins/expire/expire-tool.c:
	expire-tool: Added a forwards-compatibility parameter -t, which is
	an alias for --test.
	[153c035cf56b]

	* src/login-common/ssl-proxy-openssl.c:
	ssl: Don't use mempool_system_clean_*() functions. Just extra work
	and they've had some problems.
	[1c6361f7111d]

	* README:
	Updated RFC list in README.
	[55ad1b77e626]

	* src/auth/mech-digest-md5.c:
	digest-md5: If client sent no input, log it as such instead of a
	more cryptic error.
	[a5bc67646c66]

2009-04-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-search.c:
	mail_search_args_deinit(): Always deinitialize, even when there are
	extra references. This fixes at least a crash with virtual mailboxes
	where the same same args may be referenced for multiple mailboxes.
	[99ecc7f748a8]

	* src/plugins/virtual/virtual-mail.c:
	virtual: Crashfixes.
	[e5633843c336]

	* src/login-common/main.c:
	Before starting imaps connections, check how full connection queue
	is.
	[a876b1fafa88]

2009-04-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/shared/shared-list.c, src/lib-storage/mail-
	storage.c, src/lib-storage/mailbox-list-private.h:
	Shared mailboxes: Fix to previous mailbox_open() change.
	[b6abc84440df]

	* src/lib-storage/index/shared/shared-storage.c:
	Shared mailboxes: If selecting prefix/<username>, try to open the
	user's INBOX.
	[3a30d73fc463]

	* src/lib-storage/index/shared/shared-list.c, src/lib-
	storage/index/shared/shared-storage.c, src/lib-storage/list/mailbox-
	list-fs.c, src/lib-storage/list/mailbox-list-maildir.c, src/lib-
	storage/mail-storage.c, src/lib-storage/mailbox-list-private.h:
	Shared mailboxes: Find the final storage before calling
	mail_storage.mailbox_open(), not inside it. This fixes some crashes
	with plugins.
	[7d484e0f0789]

	* src/imap-login/client-authenticate.c, src/imap-login/client-
	authenticate.h, src/imap-login/imap-proxy.c,
	src/pop3-login/pop3-proxy.c:
	imap-login: Use [resp-codes] to figure out when to replace remote's
	auth failed message with ours.
	[415089905616]

	* src/plugins/quota/quota-storage.c:
	quota: Previous change broke other plugins.
	[4907cc591449]

	* src/plugins/quota/quota-storage.c:
	quota: Don't crash when modifying non-private namespaces.
	[f38765916f6d]

2009-04-06  Timo Sirainen  <tss@iki.fi>

	* src/lib/lib-signals.c:
	FreeBSD compiling fix.
	[5040d7cb1335]

	* src/lib/lib-signals.c, src/lib/lib-signals.h:
	Compile fix to NetBSD: Don't use si_code which is a macro. Patch by
	Tatsuyoshi.
	[3d2a48f73f86]

	* src/deliver/deliver.c:
	deliver: We no longer have umask setting, don't try to use it.
	[d75ecf89760d]

	* src/plugins/quota/quota-fs.c:
	quota-fs: Compile fix for OSes without GRPQUOTA define.
	[7bfbbfd2c32a]

	* src/imap/imap-search.h:
	Compile fix: Include sys/time.h for struct timeval.
	[4f506d955365]

	* src/master/mail-process.c:
	system_user -> system_groups_user change broke it completely.
	[3bf386d860c6]

	* src/lib/module-dir.c:
	Compile fix when modules are disabled.
	[7cac67415704]

2009-04-03  Timo Sirainen  <tss@iki.fi>

	* src/deliver/auth-client.c:
	deliver should have used mail_access_groups setting, not
	mail_extra_groups.
	[505f1b4cbd88]

	* src/lib-storage/index/shared/shared-storage.c:
	shared mailboxes: Error logging improvement.
	[676efa08f5d7]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c:
	Compiler warning fixes on 64bit systems.
	[a29215e13241]

	* .hgtags:
	Added tag 1.2.rc2 for changeset f38a9a2692ac
	[af48a429abd0]

	* src/plugins/quota/Makefile.am:
	Fixed quota compiling when using a separate build dir.
	[f38a9a2692ac] [1.2.rc2]

	* NEWS, configure.in:
	Released v1.2.rc2.
	[81ed3dfec651]

	* src/plugins/quota/Makefile.am:
	rquota.x was missing from distribution tarball.
	[d828eedb2f9d]

	* .hgtags:
	Added tag 1.2.rc1 for changeset 9b0f83479056
	[5bfe7d6e387d]

	* NEWS, TODO, configure.in:
	Released v1.2.rc1.
	[9b0f83479056] [1.2.rc1]

	* src/plugins/acl/acl-backend-vfile.c:
	acl: If a global ACL file "foo" exists, don't fail when trying to
	access mailbox "foo/bar".
	[9c82d97a5431]

	* src/imap/cmd-append.c:
	IMAP: Don't allow APPEND to specify INTERNALDATE more than 2 hours
	into future.
	[3c33885a717a]

	* src/plugins/acl/acl-shared-storage.c:
	acl: Don't crash if shared_storage_get_namespace() fails.
	[b567f5f42b3d]

	* src/lib-storage/index/shared/shared-storage.c:
	If shared_storage_get_namespace() fails due to ns prefix pattern
	mismatch, log an error. Although should this ever happen? Maybe they
	should be asserts..
	[2b6107437df3]

2009-04-02  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/imap/cmd-thread.c, src/lib-storage/index/index-
	thread-finish.c, src/lib-storage/index/index-thread.c, src/lib-
	storage/mail-thread.h:
	Renamed THREAD X-REFERENCES2 to THREAD REFS (from INTHREAD draft).
	[20e6fa42d081]

	* src/imap/cmd-list.c:
	imap: Fixed LIST with namespace prefixes that have multiple
	hierarchies.
	[5ce33cfc568f]

	* src/lib-storage/index/shared/shared-storage.c, src/lib-storage/mail-
	namespace.h, src/plugins/acl/acl-backend-vfile-acllist.c:
	acl: Don't try to create dovecot-acl-list file for unknown users'
	auto-created namespaces.
	[703214a10642]

	* src/master/mail-process.c, src/master/master-settings-defs.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Removed umask setting. We're nowadays creating practically all files
	with proper umasks.
	[87c23fa4278e]

	* src/plugins/acl/acl-backend-vfile.c:
	acl: Dropped default ACL cache timeout from 5 minutes to 30 seconds.
	[0e0ce37ef99d]

	* src/lib-storage/list/mailbox-list-maildir-iter.c, src/lib-storage
	/mail-namespace.c:
	Shared Maildirs: Fixes to listing INBOX. Based on patch by Bernhard
	Herzog.
	[aef90950d50b]

	* src/plugins/acl/acl-mailbox-list.c:
	acl: When listing mailboxes, return children flags correctly.
	[23ee853569e6]

	* src/plugins/acl/acl-backend-vfile-acllist.c, src/plugins/acl/acl-
	backend-vfile.h:
	acl: Fixed crash when rebuilding dovecot-acl-list file.
	[db0072f7c6b4]

	* src/lib-storage/index/shared/shared-storage.c:
	shared mailboxes: Mark created users' namespaces as having INBOXes.
	[9b3bb65b808e]

	* src/plugins/acl/acl-backend-vfile.c:
	acl: Don't use root directory's dovecot-acl file as the default acl.
	With Maildir it's usually INBOX's ACL.
	[266266e90384]

	* src/lib-storage/index/index-thread-finish.c:
	THREAD X-REFERENCES2: Don't return (0) nodes.
	[bf16646ec312]

	* src/plugins/quota/Makefile.am, src/plugins/quota/quota-fs.c,
	src/plugins/quota/rquota.x:
	quota-fs: Added support for NFS group quota. Based on patch by
	fandorin at rol.ru.
	[66a8cbe7f007]

	* src/imap-login/client.c, src/pop3-login/client.c:
	imap/pop3-login: Don't crash when shutting down and destroying
	clients.
	[fbb2343b85d9]

	* src/lib/ioloop-epoll.c:
	If epoll_create() fails with EMFILE, suggest increasing epoll's
	max_user_instances.
	[697f380acfbb]

	* src/auth/main.c, src/master/child-process.c:
	Try to make sure auth process can dump core, and if it can't try to
	find why.
	[c5cb1f27caea]

2009-04-01  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb.c, src/auth/userdb.c:
	auth: Fixed loading known passdb/userdb plugins.
	[4aa05d7d8b07]

	* src/master/dict-process.c:
	When shutting down, don't try to restart dict processes.
	[7ddf32656d8c]

	* src/lib/istream-tee.c:
	istream-tee: Added some more asserts.
	[11d2f0fffb61]

	* src/lib/istream.c:
	istream: Added one more assert to make sure return value is correct.
	[5e513d6612e0]

	* src/lib-storage/index/index-fetch.c, src/plugins/imap-acl/imap-acl-
	plugin.c:
	Removed unneeded code. Based on Coccinelle output from Diego
	Liziero.
	[ec8e679294d0]

	* src/auth/main.c, src/deliver/deliver.c, src/dict/main.c,
	src/imap/main.c, src/lib/lib-signals.c, src/lib/lib-signals.h, src
	/login-common/main.c, src/master/main.c, src/pop3/main.c:
	When a process is killed, show the signal code and the sending
	process's pid and uid.
	[5361cb6afe9e]

	* src/auth/auth-cache.c, src/auth/main.c, src/auth/mech-winbind.c,
	src/deliver/deliver.c, src/dict/main.c, src/imap/main.c, src/lib
	/child-wait.c, src/lib/lib-signals.c, src/lib/lib-signals.h, src
	/login-common/main.c, src/master/child-process.c, src/master/main.c,
	src/pop3/main.c, src/util/maildirlock.c:
	lib-signals: Changed callback API to return siginfo_t.
	[9f3968f49ceb]

	* src/master/auth-process.c, src/master/dict-process.c, src/master
	/login-process.c, src/master/mail-process.c:
	Call closelog() before dup2()ing fds.
	[774b0e8138bd]

	* dovecot-example.conf:
	dovecot-example.conf: Added maildir_very_dirty_syncs.
	[709128511fd5]

	* src/plugins/fts-solr/fts-backend-solr.c:
	fts-solr: Don't double-escape "+" if we're filtering what mailboxes
	we want.
	[e81dfb69bfc5]

2009-03-31  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-config.c:
	virtual: Don't fail if using -negative boxes.
	[b44679b31dca]

2009-03-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-address.c:
	Message address parser didn't handle empty group:; correctly.
	[e5658894cd13]

	* src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-keywords.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h,
	src/lib-storage/index/maildir/maildir-util.c, src/master/mail-
	process.c, src/master/master-settings-defs.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added maildir_very_dirty_syncs setting.
	[88aeadb32151]

	* src/lib-index/mail-index-view.c, src/lib-index/mail-index.h:
	Added mail_index_lookup_view_flags()
	[629004d13ec4]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c:
	Write to main index file less often.
	[6cc8ee6080ed]

	* src/lib-index/mail-index-view.c:
	index: Minor optimization.
	[a514df3e20db]

2009-03-26  Timo Sirainen  <tss@iki.fi>

	* src/auth/Makefile.am, src/auth/db-ldap.c, src/auth/mech-gssapi.c,
	src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Fixed --with-ldap=plugin and --with-gssapi=plugin
	[643a96aec996]

	* src/lib-charset/charset-iconv.c:
	charset_to_utf8() may have tried to allocate a lot of memory in some
	conditions.
	[7c21256e3598]

2009-03-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/list/mailbox-list-fs-iter.c:
	fs mailbox listing was sometimes scanning subdirectories unneededly.
	[c5b2260f767d]

	* src/lib-imap/imap-match.c, src/tests/test-imap.c:
	Fix to IMAP LIST pattern matching.
	[8cedfefc98e0]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Don't try to create files to Maildir/tmp/ if INBOX doesn't exist in
	Maildir/.
	[39f1644ed150]

	* src/lib-storage/index/maildir/maildir-copy.c:
	Compiler warning fix.
	[44f7b2f4a767]

	* src/plugins/virtual/virtual-config.c:
	virtual: Give a nice error message if mailbox's namespace isn't
	found.
	[bede7239792f]

	* .hgtags:
	Added tag 1.2.beta4 for changeset 84c70b0695c5
	[35d0d00504f2]

	* configure.in:
	Released v1.2.beta4.
	[84c70b0695c5] [1.2.beta4]

	* src/lib-index/mail-index-strmap.c:
	If unlinking strmap fails because it didn't exist to begin with,
	don't log an error.
	[b61c15279b65]

	* src/lib-index/mail-index-modseq.c:
	mail_index_map_modseq_clone() caused memory corruption.
	[2653007d906d]

	* src/master/child-process.c, src/master/mail-process.c:
	mail_privileged_group setting prevents core dumps - mention it in
	logging.
	[9d00503821d6]

	* src/lib-index/mail-index.h:
	Comment update.
	[7bdc9d0bc9e6]

	* configure.in:
	configure no longer prints "UNSTABLE development branch" warning.
	[26de66d80a23]

	* src/util/dovecotpw.c:
	dovecotpw: Use CRAM-MD5 instead of HMAC-MD5 as the default.
	[ff1665db118c]

	* src/auth/password-scheme.c:
	auth: hex vs. base64 autodetection didn't work with CRAM-MD5 scheme.
	[be03fe93e11b]

2009-03-24  Timo Sirainen  <tss@iki.fi>

	* src/login-common/main.c:
	Fix to previous change: Log version mismatch after log
	initialization.
	[d401e8f95bdc]

	* src/login-common/main.c:
	login process: Check Dovecot version mismatch earlier.
	[ad7013e631d5]

	* src/lib-storage/index/dbox/dbox-storage.c:
	dbox: Reversed the forced MAILBOXDIR change after all. v1.3 can
	force it then.
	[ecf7b65fdda1]

	* src/lib-storage/index/dbox/dbox-storage.c:
	dbox: No longer allow an empty MAILBOXDIR. Future code relies on
	this.
	[7a463166d607]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib/file-
	dotlock.c, src/lib/istream-crlf.c:
	Removed unused code. Based on coccinelle output from Diego Liziero.
	[ed8e33c2199e]

	* src/master/login-process.c:
	login_process_per_connection=yes should have limited how many
	lines/sec process was allowed to log.
	[1c76e82e0b36]

	* src/plugins/fts-squat/squat-uidlist.c:
	squat: error handling fix.
	[79311c07f98f]

2009-03-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h:
	Don't cache Date: header if we don't really want it.
	[c01259945820]

	* src/plugins/fts-solr/fts-backend-solr.c:
	fts-solr: Solr breaks when it sees control characters, so replace
	them with spaces.
	[dd441977c578]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Maildir: Another logging improvement to EACCES error.
	[43a49b3d3b5e]

2009-03-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-sort.c:
	IMAP: ESORT extension was implemented wrong.
	[d6ef39b9e4cf]

2009-03-19  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-storage.c:
	virtual: We don't really need to do fsync for appends or expunges.
	The code just came in accidentally from copy&pasting.
	[78586322a1d2]

	* src/lib-mail/message-size.c, src/lib-storage/index/maildir/maildir-
	uidlist.c:
	Removed some unnecessary code. Patch by Diego Liziero.
	[94dbe538cdb7]

	* src/lib-storage/index/dbox/dbox-index.c:
	dbox: Minor error handling fix. Patch by Diego Liziero.
	[747a0c3199bf]

	* src/lib-charset/charset-iconv.c:
	Charset conversion: Don't panic if iconv() doesn't produce valid
	UTF-8 output.
	[96102e6cd333]

	* src/lib/buffer.c, src/lib/mempool.c:
	Added more asserts.
	[ea833e894759]

2009-03-18  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.2.beta3 for changeset 6ab55d991765
	[241b3c178228]

	* TODO, configure.in:
	Released v1.2.beta3.
	[6ab55d991765] [1.2.beta3]

	* src/lib-storage/mailbox-list.c:
	MAILBOXDIR changes broke some setups.
	[50815f24cc22]

	* src/lib-imap/imap-parser.c, src/lib-imap/imap-parser.h:
	imap-parser: Added IMAP_PARSE_FLAG_MULTILINE_STR flag.
	[c9d6ae6f10fe]

	* src/imap/cmd-fetch.c:
	FETCH n BODY.PEEK[HEADER.FIELDS[.NOT] (...)] returned BAD.
	[dc6880dcbbba]

	* src/lib/failures.c:
	If log write() fails because of EINTR, try again 2 more times.
	[299e30db1ee9]

2009-03-15  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	master: Don't crash in login_executable -D checks if protocols line
	doesn't have imap.
	[5284f45c249a]

	* src/lib-storage/index/mbox/mbox-lock.c:
	mbox: pop3_lock_session=yes was broken with mail_privileged_group.
	[6b84ced81da8]

2009-03-13  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.2.beta2 for changeset 116ca52dfcb5
	[9f0f3c7072eb]

	* TODO, configure.in:
	Released v1.2.beta2.
	[116ca52dfcb5] [1.2.beta2]

	* src/auth/main.c:
	auth: Improved getpwnam() and getgrnam() error handling.
	[d6acde4e9fe0]

	* configure.in:
	--with-vpopmail: Minor fix for previous change.
	[f67a966f2792]

	* configure.in:
	--with-vpopmail=path now also checks path/lib_deps instead of only
	path/etc/lib_deps.
	[71f385df3de4]

	* src/auth/mech-gssapi.c:
	gssapi: Fix to previous change.
	[601e0382b442]

	* src/auth/mech-gssapi.c:
	gssapi: Cross-realm authentication fix. Patch by Bryan Jacobs.
	[ff6378d7b209]

	* src/auth/passdb-vpopmail.c:
	Compiler warning fix.
	[2ed5d2250d1d]

	* dovecot-example.conf:
	dovecot-example.conf: Make example expire_dict go through dict
	proxy. Patch by Robert McQueen.
	[00fae4dc9d46]

	* src/master/child-process.c:
	master: Fixes to core dump log message writing.
	[fa0775526cf4]

	* src/master/child-process.c:
	If login process core dumps, suggest using -D parameter.
	[978010934c02]

	* src/master/master-settings.c:
	master: If login process has -D parameter, make login directory
	writable.
	[71cfd00e1375]

	* src/login-common/main.c:
	login processes: If -D parameter is given, allow dumping core file.
	[6131143fef16]

2009-03-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/list/mailbox-list-fs.c:
	Fix to mailbox_dir_name handling. (Broke mbox .subscriptions
	filtering)
	[eb8b8e152f85]

	* src/lib-storage/index/maildir/maildir-util.c:
	maildir_set_deleted() return value was handled wrong everywhere.
	Changed it to work as it was used, since it seems to be clearer that
	way.
	[1865ca29524f]

	* src/lib-storage/index/dbox/dbox-index.c, src/lib-storage/index/dbox
	/dbox-storage.c, src/lib-storage/index/dbox/dbox-storage.h:
	dbox: Changed the default mailbox dir name, subscriptions and
	uidvalidity filenames.
	[d8c071203322]

	* src/lib-storage/index/mbox/mbox-storage.c, src/lib-storage/list
	/mailbox-list-fs-iter.c, src/lib-storage/list/mailbox-list-fs.c, src
	/lib-storage/mailbox-list.c, src/lib-storage/mailbox-list.h:
	Added :MAILBOXDIR= to mail_location to specify the root dir for
	mailboxes.
	[0e7e25da544c]

	* src/plugins/virtual/virtual-sync.c:
	virtual: Fixes.
	[8785db70472f]

2009-03-11  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Updated comment for valid_chroot_dirs.
	[eb71ec588694]

	* src/imap/imap-fetch-body.c, src/imap/imap-fetch.c, src/imap/imap-
	fetch.h:
	imap: Code cleanup: Changed buffer to an array.
	[6431b25959c4]

	* src/imap/imap-fetch-body.c, src/imap/imap-fetch.h:
	imap: Improve "FETCH .. got too little data" error messages.
	[69a5c4798421]

2009-03-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction-private.h, src/lib-index/mail-transaction-log-append.c,
	src/lib-index/mail-transaction-log-file.c:
	indexes: Fixes to handling shrinking tail offsets.
	[69ddd7c9c585]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c:
	indexes: Removed unnecessary code.
	[b21104f6a752]

2009-03-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-file.c:
	Improved "corrupted transaction log file" error message.
	[8081eb6b1c61]

	* src/lib-storage/index/cydir/cydir-save.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/mail-storage-
	private.h:
	Maildir and Cydir: When saving mail, expose ostream to
	mail_save_context.output. This would allow plugins to hook into it.
	[a05a7a73b475]

	* src/lib-index/mail-transaction-log-append.c:
	If indexes had been reset, extension changes may have been written
	wrong.
	[2a3fd0d46bc6]

	* src/lib-index/mail-index-view-sync.c:
	indexes: Crashfix to error handling.
	[3cebcc8a3f11]

2009-03-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log-file.c:
	indexes: Make sure we don't shrink log_file_tail_offset.
	[3feb2afdd81f]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	mbox: Don't crash if >=8192 bytes long line begins with "From ".
	[638b27b33401]

2009-03-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mailbox-list.c:
	mailbox_list_get_dir_permissions() returned broken permissions if
	root dir didn't exist.
	[fe4782341037]

	* src/plugins/lazy-expunge/lazy-expunge-plugin.c:
	lazy_expunge: When deleting mailboxes, if the destination parent dir
	didn't exist, delete failed.
	[f93d9e08f89c]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	mbox: Possible assert-crashfix. Also added some comments.
	[60e778555558]

2009-03-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/password-scheme.c:
	digest-md5 scheme generation was broken if username didn't contain
	@domain. Broken by previous change to it.
	[ce28325cc1c4]

	* src/lib-index/mailbox-list-index.c, src/lib-storage/index/index-
	sort-string.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/mail-storage.c:
	Compiler warning fixes.
	[969d23a89379]

	* configure.in, src/imap/main.c, src/lib/restrict-access.c, src/lib
	/restrict-access.h, src/master/child-process.c, src/master/common.h,
	src/master/main.c, src/pop3/main.c:
	Improved logging for core dumping. With Linux use PR_SET_DUMPABLE
	for imap/pop3.
	[c9381a0fdc5e]

	* NEWS:
	Updated.
	[3e3aba4a3acd]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: When locking uidlist, send OK notifies if it's taking a
	long time.
	[94c815002d84]

	* src/lib/fdatasync-path.c:
	fdatasync_path(): Ignore EINVAL errors (Linux+CIFS).
	[ebfcfa35b4f4]

2009-02-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	pop3_lock_session=yes didn't use mail_privileged_group while
	dotlocking.
	[4204a706dc9b]

2009-02-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-lock.c:
	mbox: Yet another mbox locking error message fix.
	[dbf2730f76f2]

	* src/pop3/main.c:
	pop3: When mail_debug=yes, log also home directory.
	[75aed0ddfcb1]

	* src/plugins/virtual/Makefile.am, src/plugins/virtual/virtual-
	config.c, src/plugins/virtual/virtual-mail.c, src/plugins/virtual
	/virtual-save.c, src/plugins/virtual/virtual-storage.c,
	src/plugins/virtual/virtual-storage.h, src/plugins/virtual/virtual-
	transaction.c, src/plugins/virtual/virtual-transaction.h:
	virtual: Added support for saving/copying messages to virtual
	mailboxes.
	[93c25cfe2760]

	* src/plugins/virtual/virtual-config.c:
	virtual: Avoid getting duplicate mailboxes when expanding wildcards.
	[7224c45d4719]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c:
	IMAP: Don't return APPENDUI/COPYUID if backend didn't provide them.
	[d153c72800e0]

	* src/lib-storage/index/mbox/mbox-lock.c:
	mbox: Improve dotlock error logging more.
	[1f2dfc6fbda9]

	* src/deliver/deliver.c:
	deliver: Use user's home dir or mail dir when creating temp files,
	instead of hardcoded /tmp.
	[5c3406520c3f]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/lib-storage/mail-user.c, src/lib-storage/mail-user.h:
	Added mail_user_get_temp_prefix() and
	mail_storage_get_temp_prefix().
	[db9811ec1f47]

	* src/lib/istream-seekable.c:
	istream-seekable: Don't add an extra "." after the given prefix.
	[3d11825abf66]

	* src/lib-storage/mailbox-list.c:
	mbox: Creating directories based on mbox file's mode dropped +x
	permissions.
	[89e4d5da5ba7]

	* src/lib-storage/index/mbox/mbox-lock.c:
	mbox: Give better error messages if dotlocking fails.
	[f3ce7c7c0b58]

	* src/master/main.c:
	Compile fix for systems where printf() is a macro.
	[e5cc81734221]

2009-02-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-sort-string.c:
	SORT: Don't waste data stack memory when sorting many messages.
	[513ba5a698a1]

	* src/imap/imap-search.c:
	IMAP: Fixed SORT command crashing.
	[037ff603e27a]

2009-02-24  Timo Sirainen  <tss@iki.fi>

	* .hgignore:
	Ignore also .Tpo files (in .deps).
	[edd65639b63e]

	* src/lib/ostream-file.c:
	ostream: When copying backwards within a file, update in/outstream
	offsets.
	[52e0b40146b1]

	* src/lib-index/mailbox-list-index.c:
	Error message fix for currently unused mailbox list index code.
	[ff1d88068275]

	* src/lib-index/mail-index-map.c:
	mail_index_map_ext_hdr_check(): Fixed a wrong check.
	[3bd20d70b0d6]

	* src/pop3-login/pop3-proxy.c:
	pop3-login: Don't crash after successful login.
	[98e1115cd8f0]

	* src/imap-login/imap-proxy.c:
	imap-proxy: Minor code cleanup
	[e9f711a08dd5]

2009-02-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-storage.c:
	Create missing index dir using the same permissions as the mailbox
	dir.
	[25dd184fc947]

	* src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c:
	maildir: We didn't properly handle missing control directory at
	startup. Also some other error handling when some dirs were missing
	were done wrong.
	[dfcb8a6a4f5f]

	* src/deliver/deliver.c:
	Improved "Can't open delivery mail as raw" error message.
	[8b6dd6d0f33a]

	* src/deliver/deliver.c:
	deliver -p: Expand relative paths before chdir()ing.
	[f1414fa48b4b]

2009-02-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mailbox-list-private.h, src/lib-storage/mailbox-
	list.c:
	mailboxes: Copy root directory's +x modes for newly created dirs
	perfectly.
	[cc8d4d06ef9f]

	* src/auth/auth-request.c, src/auth/userdb-nss.c, src/auth/userdb-
	passwd.c, src/master/mail-process.c:
	Authentication: system_user userdb extra field renamed to
	system_groups_user.
	[91e880ae387a]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/list/mailbox-
	list-fs.c, src/lib-storage/list/subscription-file.c, src/lib-storage
	/mailbox-list.c, src/lib-storage/mailbox-list.h, src/plugins/acl
	/acl-backend-vfile-acllist.c, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/quota/quota-maildir.c:
	Create all mail/index files'/dirs' permissions based on the mailbox
	directory.
	[e82e0a6b9399]

	* src/auth/auth-request.h, src/auth/mech-digest-md5.c,
	src/auth/passdb.c, src/auth/password-scheme.c:
	DIGEST-MD5: Fixed authentication with user@domain usernames.
	[888f57b1bf9c]

	* src/auth/auth-request.h, src/auth/auth-worker-client.c,
	src/auth/passdb.c:
	auth workers: Return plaintext credentials to parent process if
	possible, so it gets cached instead of some other scheme.
	[d69763bee853]

	* src/auth/auth-request.c, src/auth/passdb-cache.c, src/auth/passdb.c:
	auth: Improved logging for "password scheme not available" failures.
	[90e2a21a4298]

	* src/auth/passdb-cache.c:
	auth cache: Don't crash if trying to lookup credentials for NULL
	password.
	[992cfb5ebdb0]

	* src/auth/auth-worker-client.c:
	Auth workers: Don't duplicate "nopassword" field.
	[4cbfff403813]

2009-02-20  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-config.c:
	virtual: Crashfix on a specific configuration.
	[5e6d0ca437a2]

	* src/master/mail-process.c:
	If chdir() fails with EACCES in mail process creation, log a user-
	friendly error.
	[2e563febbc67]

	* src/lib-storage/mail-error.c, src/lib/Makefile.am, src/lib/eacces-
	error.c, src/lib/eacces-error.h:
	Moved user-friendly EACCES error message generation to lib/.
	[6ec819adfde3]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	imap-acl: Don't let client remove admin ACL from its own mailboxes.
	[f810b81c8e05]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	imap-acl: Don't return default rights for mailboxes in non-private
	namespaces.
	[0ac80bed5d3e]

	* src/plugins/acl/acl-api-private.h, src/plugins/acl/acl-api.c,
	src/plugins/acl/acl-api.h, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/acl/acl-backend.c, src/plugins/imap-acl/imap-acl-
	plugin.c:
	imap-acl: GETACL: Convert "owner" to the actual username whenever
	possible.
	[be1d1c722c92]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	imap-acl: Handle obsolete 'c' and 'd' rights. Patch by Sascha Wilde.
	[2579345e877f]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	imap-acl: When GETACL lists negative rights, the "-" wasn't inside
	quotes.
	[ed352de284be]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	imap-acl: Fixed GETACL when listing both negative and postitive
	rights.
	[f62c201dc8ac]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	imap-acl: Fixed handling SETACL with empty rights. Patch by Bernhard
	Herzog.
	[ee02ea08ce30]

	* src/lib-storage/mail-namespace.h, src/lib-storage/mail-search-
	build.h, src/lib-storage/mail-search.h:
	mail-storage API: Added some function description comments.
	[98e46e8153e4]

2009-02-19  Timo Sirainen  <tss@iki.fi>

	* src/util/idxview.c:
	idxview: Support specifying the name of dovecot.index file.
	[f16e102e8693]

	* src/lib-storage/index/index-mail-headers.c:
	If we detect cached header is corrupted while unfolding it, mark the
	cache corrupted.
	[13e1c379ab63]

2009-02-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mailbox-list.h:
	Fixed comment for mailbox_list_iter_deinit().
	[b39e85979c6a]

2009-02-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-mail.c:
	"Maildir filename has wrong W value" error was missing new/cur
	directory in the middle.
	[1e8b0f026399]

2009-02-11  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-search-args.h:
	Code comments updated.
	[cc6ac9aefca5]

2009-02-10  Timo Sirainen  <tss@iki.fi>

	* src/pop3/client.c:
	pop3: Don't crash at startup if mailbox is empty.
	[22d70947597c]

	* .hgtags:
	Added tag 1.2.beta1 for changeset c21c082aebb6
	[bb7cb8a724bd]

	* configure.in:
	Released v1.2.beta1.
	[c21c082aebb6] [1.2.beta1]

	* src/lib-index/mailbox-list-index-private.h, src/lib-index/mailbox-
	list-index.c:
	Minor changes to mailbox list indexing code. Still disabled/non-
	working.
	[37e118a32cd0]

	* src/dict/main.c, src/imap/main.c, src/lib/failures.c,
	src/lib/failures.h, src/pop3/main.c:
	pop3/imap: When master closes our log fd, don't die when trying to
	log disconnect reason.
	[d74fdb84ab8b]

	* src/imap/client.c, src/lib-imap/imap-util.c, src/lib-imap/imap-
	util.h:
	Renamed imap_args_to_str() to imap_write_args() and added a new
	imap_args_to_str().
	[743cc6ff3d89]

2009-02-09  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	master: Another deinit crashfix
	[88ae612dc221]

	* NEWS, TODO:
	Updated.
	[ce8f8ca3ac35]

	* src/lib-storage/mail-namespace.c:
	Give an error if inbox=yes namespace is missing. Previously we
	attempted to set it automatically, but that didn't work.
	[9c45d585227b]

	* src/master/mail-process.c:
	master: make sure we don't access freed memory on deinit.
	[d23ab2c1c0c5]

	* src/master/auth-process.c, src/master/child-process.c, src/master
	/child-process.h:
	master: Don't crash if auth process dies too early.
	[f8fdabb30c0a]

2009-02-06  Timo Sirainen  <tss@iki.fi>

	* src/plugins/imap-acl/imap-acl-plugin.c:
	imap-acl plugin: Memory leak fix
	[f8e407d832b8]

	* src/lib-sql/driver-pgsql.c:
	pgsql: Fixes to handling reconnecting to server.
	[b899076947cf]

	* src/lib-dict/dict-sql-settings.c:
	dict sql: If connect setting isn't given, give an error message
	instead of crashing.
	[4142c933e231]

	* src/imap/client.c, src/imap/client.h:
	imap: Added module contexts to struct client_command_context.
	[3949c6d2e4c8]

	* src/imap/client.c, src/imap/client.h:
	imap: Store command args to client command contexts for debugging
	purposes.
	[9b5d68776d03]

	* src/lib-imap/imap-util.c, src/lib-imap/imap-util.h:
	Added imap_args_to_str()
	[b7ebdade6cbd]

	* src/imap/commands.c, src/imap/commands.h:
	imap: export imap_commands array containing all registered commands.
	[da19acbae79e]

	* src/imap/cmd-search.c, src/imap/cmd-sort.c, src/imap/cmd-thread.c:
	Avoid calling imap_parser_*() directly. It's not required.
	[d2c357625ef2]

	* src/deliver/deliver.c, src/imap/cmd-copy.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-storage.h, src/lib-storage/mail-copy.c, src/lib-storage
	/mail-copy.h, src/lib-storage/mail-storage-private.h, src/lib-
	storage/mail-storage.c, src/lib-storage/mail-storage.h,
	src/plugins/acl/acl-mailbox.c, src/plugins/convert/convert-
	storage.c, src/plugins/expire/expire-plugin.c, src/plugins/mail-log
	/mail-log-plugin.c, src/plugins/mbox-snarf/mbox-snarf-plugin.c,
	src/plugins/quota/quota-storage.c:
	Mail copying API changed to be based on save API. This allows
	extending it easily in future.
	[68db63cc32b3]

	* src/lib-storage/index/maildir/maildir-keywords.c:
	maildir: Adding new keywords was broken by recent changes.
	[c7142c9ac3c1]

2009-02-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-view.c:
	mail_index_lookup_first() didn't always find the result. This caused
	SELECT not to return UNSEEN number always.
	[3453dbc2e42e]

	* src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c:
	pop3: Fix to previous changes: Update \Seen flags even when not
	using QUIT.
	[eaffedbc23f2]

2009-02-04  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-tee.c:
	istream-tee: Minor cleanups, assert and a potential fix.
	[fbc3e829ade6]

	* src/lib/istream.c:
	i_stream_read(): Added a few more asserts.
	[3d8e70cbf224]

	* src/auth/mech-plain.c:
	Grew initial plain_auth_request pool size.
	[d7c8acf3213b]

	* configure.in:
	Added CONTEXT=SEARCH back. We do implement all of it actually, just
	not CONTEXT=SORT.
	[adc64917942c]

	* src/pop3/client.c, src/pop3/client.h:
	pop3: If client idles for 10 seconds, commit transaction (allowing
	mbox to become unlocked).
	[ea9a186d64f9]

	* src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c:
	pop3: Track \Seen flag changes in a bitmask and do the changes at
	QUIT. This way RSET doesn't need to rollback the transaction.
	[6f29380ba3a0]

	* src/lib-storage/index/mbox/mbox-lock.c:
	mbox: flock() and lockf() now use blocking alarm()ed locking.
	[8cca2bf6ab76]

	* configure.in:
	Removed CONTEXT=SEARCH capability for now, since with ESORT it
	requires more code.
	[25dfff279eda]

	* TODO, configure.in, src/imap/Makefile.am, src/imap/cmd-search.c,
	src/imap/cmd-sort.c, src/imap/imap-search.c, src/imap/imap-search.h,
	src/imap/imap-sort.c, src/imap/imap-sort.h:
	Implemented support for ESORT capability.
	[bbdbab5354d6]

	* src/imap/cmd-search.c:
	SEARCH RETURN (PARTIAL): Allow higher:lower numbers in partial seq
	range.
	[0118c6040468]

	* src/imap/cmd-search.c:
	SEARCH: RETURN (PARTIAL) was broken.
	[69cdbfd4c1ed]

	* src/imap/Makefile.am, src/imap/cmd-copy.c, src/imap/cmd-expunge.c,
	src/imap/cmd-fetch.c, src/imap/cmd-search.c, src/imap/cmd-sort.c,
	src/imap/cmd-store.c, src/imap/cmd-thread.c, src/imap/imap-search-
	args.c, src/imap/imap-search-args.h, src/imap/imap-search.c,
	src/imap/imap-search.h:
	Renamed imap-search.[ch] to imap-search-args.[ch]
	[bd2bb6ff0a83]

	* src/auth/passdb-ldap.c:
	auth_debug_passwords=yes: If auth bind fails, log the attempted
	password.
	[eaf8c93be56e]

	* src/auth/passdb-pam.c:
	auth_debug_passwords=yes: Log password for PAM lookups.
	[323c8eff78d4]

2009-02-03  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	nfs_check: Mention also mail_nfs_storage=yes in the error message.
	[7c4f4a1b1313]

	* src/master/mail-process.c:
	If mail_chroot is set, don't fail at startup in dump-capability.
	[af3fa3dd0d31]

2009-02-02  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-ldap-example.conf:
	dovecot-ldap-example.conf: Updated dn and dnpass comments.
	[e2251b0bd12b]

	* src/auth/db-ldap.c:
	ldap: Give better error message when aborting LDAP requests due to
	not being connected.
	[a7503487627d]

	* doc/dovecot-ldap-example.conf, src/auth/db-ldap.c:
	Changed default ldap_version from 2 to 3. Some servers no longer
	allow v2.
	[ffcb2fb59c1d]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	nfs+maildir: lseek() may also return ESTALE failure, handle it.
	[e07901202df1]

	* src/deliver/deliver.c:
	deliver: If -a wasn't specified and no Envelope-To: header, the
	fallback implementation was buggy. Patch by Steffen Kaiser.
	[8fb251e401e6]

	* src/deliver/deliver.c:
	deliver: If -f <sender> was specified and -a not, the sender was
	used also as the destination. %f in deliver_log_format was also
	expanded to the sender.
	[db9989630e89]

	* src/master/master-settings.c:
	master: Give an error if login_dir = base_dir.
	[02f72e7be270]

	* src/master/main.c:
	master: Don't crash at quit if there is some unwritten data in logs.
	[035037f388fa]

	* src/auth/auth-worker-client.c:
	userdb prefetch + blocking passdbs was still broken with non-
	plaintext auth.
	[3aeb924bae35]

2009-02-01  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-storage.c:
	acl: We stopped calling hook_mail_storage_created for internal
	namespaces.
	[c9ed3bf730b9]

2009-01-31  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	auth: Using "username" or "domain" passdb fields caused problems
	with cache and blocking passdbs.
	[20345491824c]

2009-01-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-file-maildir.c:
	dbox: INTERNALDATE and save date was returned wrong for converted
	maildir files. Patch by Jose Celestino.
	[e296435586c1]

2009-01-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-storage.c:
	mailbox_allow_new_keywords() was returning the opposite value,
	causing \* flag to be reported wrong.
	[d564ff619baf]

	* src/lib-dict/dict-file.c:
	dict file: Compiler warning fix.
	[a15d1f8bd289]

2009-01-26  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	If some setting contains a bad value, make sure the error message
	contains the setting name.
	[77c67307d316]

	* src/lib/file-dotlock.c:
	dotlocking: Increase the wait time 1,5 x every second until we reach
	3 seconds. If the dotlock ever gets updated in any way, the wait
	time is dropped back to the initial value of 0.1-0.2 secs.
	[81a146c34a5c]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	maildir: Handling keywords was more or less broken because of a
	broken sort compare function.
	[80486913baf3]

2009-01-25  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	dovecot-example.conf: Moved userdb prefetch before other userdbs,
	since that's where it should be.
	[21d797789179]

	* src/auth/auth-worker-client.c:
	Another caching fix to blocking passdbs when using non-plaintext
	auth.
	[4b25c3e326a4]

	* src/auth/auth-worker-client.c:
	Previous change to handling blocking passdbs broke it for userdb
	prefetch.
	[dbd0c6e863cc]

	* src/master/dict-process.c:
	master: When shutting down, avoid dict processes giving "unknown
	process exited" errors.
	[0e9b885bd29e]

	* src/lib-dict/dict-sql.c, src/lib-storage/index/shared/shared-list.c,
	src/lib-storage/index/shared/shared-storage.c,
	src/plugins/quota/quota.c:
	Increased some initial memory pool sizes.
	[6ee78e18d026]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c:
	pgsql: Don't break when using multiple transactions.
	[ad35aae691ce]

	* src/lib-dict/dict-client.c:
	dict proxy client: Don't hang when doing an async commit.
	[a68ed51b681d]

	* src/master/dict-process.c:
	dict: Fixes to handling dying dict processes.
	[49ad944c5741]

	* src/dict/dict-server.c:
	dict: Set listener socket non-blocking so it doesn't hang on
	accept() when Dovecot is shutting down.
	[0c2ba85280d1]

	* src/plugins/virtual/virtual-sync.c:
	virtual: Fix assert-crashing caused by previous changes.
	[be4006078b6b]

	* src/lib-storage/index/dbox/dbox-sync-rebuild.c:
	dbox rebuild: Previous change removed too much code.
	[418a6b109238]

2009-01-23  Timo Sirainen  <tss@iki.fi>

	* src/login-common/main.c:
	Don't use clean_pool with login processes. The previous fix for
	clean_pool perhaps might have fixed all the bugs related to it, but
	since it only produces extra work with no real benefit, just don't
	use it. The original idea behind using it was flawed.
	[d9c28e76ef97]

	* src/lib-storage/index/shared/shared-storage.c:
	Shared namespaces: Allow using %% in the prefix.
	[61dd475e9f0a]

2009-01-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-rebuild.c:
	dbox rebuild: Dont try to give unknown maildir files UIDs that are
	after uidlist's nextuid. Although it might allow keeping the same
	UIDs after repeated rebuilds, if any of the files were deleted at
	some point the UIDs would change and that would be just worse.
	[b45d3705f7d5]

	* src/lib-index/mail-index-transaction.c:
	Another fix to mail_index_transaction_get_next_uid() fix.
	[3be909959c02]

2009-01-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	Fix to mail_index_transaction_get_next_uid() fix.
	[9c0b76fa8ef6]

	* src/lib-storage/index/dbox/dbox-mail.c:
	dbox: Minor error logging fix.
	[8f1fc77aea7e]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c:
	mail_index_transaction_get_next_uid() shouldn't sort appends. They
	may still be modified! Fixes a dbox rebuild bug.
	[735001110846]

	* src/lib-storage/index/dbox/dbox-mail.c:
	dbox: Improved error message.
	[92fa46fc86f8]

	* src/auth/auth-cache.c:
	Sending SIGUSR2 to dovecot-auth now also logs statistics about cache
	inserts.
	[85476be1fee2]

	* src/plugins/quota/quota.c:
	quota debug: Hide "(0%)" if quota limits aren't defined defined in
	percentages.
	[14b9a90eb01d]

	* src/lib-storage/index/dbox/dbox-sync-rebuild.c:
	dbox rebuild: Don't crash if nothing was previously in cache.
	[1cea5aa6915c]

2009-01-20  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	Don't warn about maybe not being able to log in if protocols=none.
	[d4376328f8c0]

	* src/master/login-process.c, src/master/login-process.h:
	If all login processes are in use and we can't create a new one, log
	a warning.
	[ca964325664e]

	* src/master/master-settings-defs.c, src/master/master-settings.c,
	src/master/master-settings.h:
	mail_extra_groups backwards compatibility setting removed.
	[d1954af8aa3b]

	* src/dict/dict-server.c, src/lib-dict/dict-client.c, src/lib-dict
	/dict-client.h:
	dict proxy: Handle async commits better.
	[446775a31754]

2009-01-19  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-checkpassword.c:
	Give a better error message when userdb-only checkpassword program
	is used with passdb checkpassword.
	[011a1fb49cfd]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	imap-acl plugin: Include version string in the plugin.
	[78d7efda07b2]

	* src/plugins/quota/quota-dict.c:
	dict quota: Use dict_transaction_commit_async().
	[aad162a02672]

	* src/lib-dict/dict-client.c, src/lib-dict/dict-db.c, src/lib-dict
	/dict-private.h, src/lib-dict/dict-sql.c, src/lib-dict/dict.c, src
	/lib-dict/dict.h:
	Added dict_transaction_commit_async().
	[d8a56ea9f408]

	* src/plugins/quota/quota.c:
	dict quota: noenforcing setting caused quota to not be updated at
	all.
	[c349c4a106af]

	* src/plugins/quota/quota.c:
	dict quota: When updating quota don't look up the current byte/msg
	limit if there's no limit for it.
	[d326adcfd518]

	* src/lib-storage/index/dbox/dbox-sync-file.c:
	dbox: Notify plugins about expunges. Fixes quota.
	[e579406fdab6]

	* src/lib-dict/dict-file.c:
	dict-file: Fixed a crash.
	[b5f8834ec679]

	* src/plugins/quota/quota-dict.c:
	quota: Fixed debug logging.
	[46f95c498708]

2009-01-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-sql.c:
	pgsql: When doing negative increments, don't even try to use INSERT.
	[abb1a50a266d]

	* src/lib-sql/driver-pgsql.c:
	pgsql: More fixes to transaction handling.
	[4dadcc2f6be2]

	* src/lib-storage/index/shared/shared-storage.c, src/lib-storage/mail-
	namespace.c, src/lib-storage/mail-user.c, src/lib-storage/mail-
	user.h:
	hook_mail_namespaces_created() wasn't always called with all
	namespaces as parameter.
	[8b3af54b4dc3]

	* src/plugins/listescape/listescape-plugin.c:
	listescape plugin: The next namespaces_created callback was called
	with NULL namespaces.
	[a498c440eef2]

2009-01-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/driver-pgsql.c:
	pgsql: Don't write to freed memory if transaction is aborted while
	SQL commands are being executed.
	[81fd92599c7f]

	* src/master/dict-process.c, src/master/dict-process.h,
	src/master/main.c, src/master/master-settings-defs.c, src/master
	/master-settings.c, src/master/master-settings.h:
	Added dict_process_count setting for creating multiple dict
	processes.
	[67c08c386702]

	* src/lib-sql/driver-pgsql.c:
	pgsql: Removed accidentally committed debug code.
	[5bd547dbb8fc]

	* src/lib-dict/dict-sql.c:
	sql dict: Merge two INSERTs together whenever possible (for dict
	quota).
	[cc46e5822b96]

	* src/lib-sql/driver-pgsql.c:
	pgsql: Don't use BEGIN/COMMIT if transaction has only a single
	change.
	[7c568270c8df]

	* src/plugins/quota/quota-private.h, src/plugins/quota/quota.c:
	quota plugin optimization: Don't look up quota values every time
	when iterating quota roots.
	[a90d1488bacf]

	* src/lib/ioloop-select.c:
	Previous changes broke compiling with select ioloop.
	[bf53ab94db72]

2009-01-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c, src/lib-storage/mail-
	error.c:
	Fixes to handling +w permission errors and use it more often.
	[97a350198a4f]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/mail-error.c, src/lib-storage/mail-error.h:
	Permission denied error handling can now suggest missing +w
	permissions.
	[dd53d40a2f09]

	* src/lib-storage/mail-error.c:
	Fix to previous commit to actually compile..
	[02ba04b6aa07]

	* src/lib-storage/mail-error.c:
	Permission error logging: If UNIX permissions appear to be ok,
	suggest ACL problem.
	[1bfe762cb9ff]

2009-01-15  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-system-clean.c:
	mempool system clean: Don't break if realloc() shrinks the memory
	area.
	[685a5e3565b0]

	* src/login-common/main.c:
	Earlier changes broke login process, because it wasn't chdir()ing to
	login directory.
	[b8357fbedc8f]

	* src/deliver/deliver.c:
	deliver: Don't allow running as setuid-root if world can execute the
	binary.
	[557cc9cf7d5f]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	Maildir: Fix to earlier >26 keywords handling change.
	[11e18a303661]

	* src/login-common/main.c:
	login processes: Tell ioloop the maximum number of fds we can use.
	[c8f619c13d07]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-internal.h, src/lib/ioloop-
	kqueue.c, src/lib/ioloop-poll.c, src/lib/ioloop.c, src/lib/ioloop.h:
	Added io_loop_set_max_fd_count() to specify how many fds we expect
	to use. It's used currently only for figuring out how much space
	should be allocated initially to fds.
	[86c28d14ddeb]

	* src/master/master-settings.c:
	Removed some old backwards compatibility handling code.
	[7e4c1d8b2a1a]

	* dovecot-example.conf, src/imap-login/client-authenticate.c, src
	/login-common/common.h, src/login-common/main.c,
	src/master/listener.c, src/master/login-process.c, src/master
	/master-settings-defs.c, src/master/master-settings.c, src/master
	/master-settings.h, src/master/ssl-init.c, src/pop3-login/client-
	authenticate.c:
	Renamed "ssl_disable" setting to "ssl". Added support for
	ssl=required.
	[5a4fcfde3e91]

	* src/lib-imap/imap-resp-code.h:
	Updated imap response codes.
	[eb63b1a888e5]

	* dovecot-example.conf, src/deliver/deliver.h:
	deliver: Changed the default rejection_subject.
	[ee7c5ec212bb]

	* src/lib-storage/index/maildir/maildir-keywords.c:
	Maildir keywords handling code cleanup.
	[1efdf705203c]

2009-01-14  Timo Sirainen  <tss@iki.fi>

	* src/lib/failures.c, src/lib/failures.h, src/login-common/main.c,
	src/master/auth-process.c, src/master/child-process.c, src/master
	/child-process.h, src/master/log.c, src/master/login-process.c,
	src/master/ssl-init.c:
	If login process crashes, log the IP address that (maybe) caused it.
	[e85c7cb22ad7]

	* src/lib-index/mail-index-transaction.c:
	Crashfix / keyword handling fix when appending messages non-sorted
	(dbox rebuild).
	[b920d841f8fe]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox/mbox-
	lock.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/index/mbox/mbox-sync.c:
	Cleaned up read-only mailbox handling. Fixes a bug with Maildir
	syncing. If Maildir was opened read-only (STATUS, EXAMINE) then all
	flag changes were saved to index as dirty.
	[a9dd29e7dc4f]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	maildir: Fixes to handling over 26 keywords.
	[de27a19a8721]

	* src/pop3/client.h, src/pop3/commands.c:
	pop3: Prevent clients from looping forever trying to fetch an
	expunged message.
	[16f4752882b9]

	* src/pop3/commands.c:
	pop3: Treat invalid command parameters also as command errors that
	will cause disconnection after enough errors.
	[e6a58515d86d]

2009-01-13  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/deliver/deliver.c, src/deliver/deliver.h,
	src/deliver/mail-send.c:
	Added rejection_subject setting to deliver, which is used for
	rejected mails. Based on patch by Allan Cassaro.
	[2fa464fd3aab]

	* src/login-common/Makefile.am, src/login-common/ssl-proxy-openssl.c:
	Check broken ssl-parameters.dat files better and give a better error
	message when seeing one.
	[22985329af92]

	* src/login-common/main.c, src/master/login-process.c:
	Always send LOGIN_DIR environment to login processes.
	[9edf4a6e0cdb]

2009-01-12  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	s/acl_dict/acl_shared_dict/
	[9c4f9c47299b]

	* src/auth/main.c:
	Auth sockets: Allow specifying user and group with numbers.
	[8bda844b1ee5]

	* src/lib-sql/driver-pgsql.c:
	pgsql: If query failed because connection was lost, retry it
	automatically.
	[e3fd1a6467f2]

	* src/lib-sql/driver-pgsql.c:
	pgsql: ROLLBACK wasn't sent correctly in synchronous commit
	failures.
	[e50c8c44ab28]

	* src/lib-sql/driver-pgsql.c:
	pgsql: If query fails because connection gets closed, return a
	proper error message.
	[57b00471cdc6]

	* src/lib-sql/driver-pgsql.c:
	psql: Don't give errors with epoll if db connection gets closed.
	[fc3bd6608c90]

	* src/lib-index/mail-transaction-log-file.c:
	Improved "Transaction log corrupted unexpectedly" error message.
	[37e74d43ff26]

	* src/lib-index/mail-transaction-log-view.c:
	index: Expunge records' UIDs weren't verified to be valid before
	using them.
	[3ee12ca9e2c4]

	* src/lib-storage/index/dbox/dbox-index.c, src/lib-storage/index/dbox
	/dbox-sync-file.c:
	dbox: Fixes to handling maildir-converted files.
	[e9a28087b9f9]

2009-01-10  Timo Sirainen  <tss@iki.fi>

	* src/lib/array.h:
	Added array_get_pool(). Patch by Stephan Bosch.
	[9f98a74e0757]

2009-01-09  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	deliver: If log path begins with ~/, expand it to $HOME directory.
	This doesn't really work if using -d parameter, since the expansion
	is done before the userdb lookup.
	[26516ae3b687]

	* src/plugins/quota/quota.c:
	quota: Log a bit more when "Unknown backend" error happens.
	[63ec83d811bb]

	* src/lib-dict/dict-db.c:
	Berkeley DB fixes and cleanups. Don't leak memory/bdb resources.
	[04816f18bf18]

	* src/auth/mech-apop.c:
	apop: Compile fix for previous commit.
	[c1fea9e157c8]

	* src/auth/auth.c, src/auth/mech-anonymous.c, src/auth/mech-apop.c,
	src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c, src/auth/mech-
	gssapi.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth
	/mech-otp.c, src/auth/mech-plain.c, src/auth/mech-rpa.c, src/auth
	/mech-skey.c, src/auth/mech-winbind.c, src/auth/mech.h:
	auth: Code cleanup for specifying what passdb features auth
	mechanisms need.
	[84eea1977632]

	* src/auth/mech-apop.c:
	APOP auth: Minor code cleanups.
	[67f923c9988a]

2009-01-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	mbox: Fixed crash with pop3_lock_session=yes if dotlock already
	existed.
	[fe4b8c4a6922]

	* src/lib-storage/index/mbox/mbox-transaction.c:
	mbox: Fixed assert-crash with pop3_lock_session=yes
	[06c641b17175]

	* configure.in:
	configure: Test strtoumax() and strtoimax() by linking instead of
	just compiling (Tru64 fix).
	[da02a1d15783]

	* configure.in, src/lib/env-util.c:
	env_remove(): Implement a fallback method if unsetenv() doesn't
	exist. Fixes compiling at least with Solaris 8.
	[7c12e20f1eee]

	* src/auth/auth-request.c, src/auth/auth.c:
	auth worker processes shouldn't duplicate the auth cache.
	[812a977d7c1a]

	* src/auth/auth-worker-client.c:
	auth cache wasn't working correctly for all fields (e.g. allow_nets)
	with blocking passdbs. The extra cache-only fields weren't
	transferred to the main auth process which was handling the cached
	entries.
	[2778cd717f22]

2009-01-07  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-cache.c, src/auth/auth-request.c:
	auth: Removed extra string escaping from places where it's not
	necessary (or is even harmful).
	[9f885dbd8157]

	* src/lib-storage/index/mbox/mbox-save.c, src/lib/hostpid.c,
	src/lib/hostpid.h:
	Added my_hostdomain() function which mbox code now uses instead of
	doing that internally. Based on patch by Apple.
	[2609eca99495]

	* src/master/main.c:
	master: When receiving SIGHUP, get the hostname again in case it
	changed.
	[829b6555392b]

	* src/lib/hash.h:
	Removed unnecessary APPLE comment.
	[f05c50f43793]

	* src/auth/main.c, src/dict/dict-server.c, src/master/auth-process.c,
	src/master/dict-process.c, src/master/listener.c:
	Increase listen queues to handle high loads better. Patch by Apple.
	[3cccf56e802a]

2009-01-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-index.c:
	dbox crashfix
	[8299d17219fa]

	* src/auth/userdb-passwd.c:
	userdb passwd: Removed the check for catching broken NSS
	implementations. The nss_ldap problem is already fixed in both
	Dovecot and nss_ldap itself. This also now allows NSS to change
	username on purpose.
	[072a943c3de3]

	* src/auth/auth-cache.c, src/auth/auth-client-connection.c, src/auth
	/auth-master-connection.c, src/auth/auth-master-listener.c, src/auth
	/auth-request-handler.c, src/auth/auth-request.c, src/auth/auth-
	stream.c, src/auth/auth-worker-client.c, src/auth/auth-worker-
	server.c, src/auth/auth.c, src/auth/db-checkpassword.c, src/auth/db-
	ldap.c, src/auth/db-passwd-file.c, src/auth/db-sql.c,
	src/auth/main.c, src/auth/mech-anonymous.c, src/auth/mech-cram-
	md5.c, src/auth/mech-digest-md5.c, src/auth/mech-plain.c,
	src/auth/mech.c, src/auth/passdb-blocking.c, src/auth/passdb-
	bsdauth.c, src/auth/passdb-cache.c, src/auth/passdb-checkpassword.c,
	src/auth/passdb-ldap.c, src/auth/passdb-passwd-file.c, src/auth
	/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth/passdb-sql.c,
	src/auth/passdb-vpopmail.c, src/auth/passdb.c, src/auth/password-
	scheme.c, src/auth/userdb-blocking.c, src/auth/userdb-
	checkpassword.c, src/auth/userdb-ldap.c, src/auth/userdb-nss.c,
	src/auth/userdb-passwd-file.c, src/auth/userdb-passwd.c, src/auth
	/userdb-prefetch.c, src/auth/userdb-sql.c, src/auth/userdb-static.c,
	src/auth/userdb-vpopmail.c, src/auth/userdb.c, src/deliver/auth-
	client.c, src/deliver/deliver.c, src/deliver/duplicate.c,
	src/deliver/mail-send.c, src/deliver/smtp-client.c, src/dict/dict-
	server.c, src/dict/main.c, src/imap-login/client-authenticate.c, src
	/imap-login/client.c, src/imap-login/imap-proxy.c,
	src/imap/client.c, src/imap/cmd-append.c, src/imap/cmd-
	cancelupdate.c, src/imap/cmd-capability.c, src/imap/cmd-check.c,
	src/imap/cmd-close.c, src/imap/cmd-copy.c, src/imap/cmd-create.c,
	src/imap/cmd-delete.c, src/imap/cmd-enable.c, src/imap/cmd-
	examine.c, src/imap/cmd-expunge.c, src/imap/cmd-fetch.c, src/imap
	/cmd-id.c, src/imap/cmd-idle.c, src/imap/cmd-list.c, src/imap/cmd-
	logout.c, src/imap/cmd-lsub.c, src/imap/cmd-namespace.c, src/imap
	/cmd-noop.c, src/imap/cmd-rename.c, src/imap/cmd-search.c, src/imap
	/cmd-select.c, src/imap/cmd-sort.c, src/imap/cmd-status.c, src/imap
	/cmd-store.c, src/imap/cmd-subscribe.c, src/imap/cmd-thread.c,
	src/imap/cmd-uid.c, src/imap/cmd-unselect.c, src/imap/cmd-
	unsubscribe.c, src/imap/cmd-x-cancel.c, src/imap/commands-util.c,
	src/imap/commands.c, src/imap/imap-expunge.c, src/imap/imap-fetch-
	body.c, src/imap/imap-fetch.c, src/imap/imap-search.c, src/imap
	/imap-sort.c, src/imap/imap-status.c, src/imap/imap-sync.c, src/imap
	/mail-storage-callbacks.c, src/imap/main.c, src/lib-auth/auth-
	client.c, src/lib-auth/auth-master.c, src/lib-auth/auth-server-
	connection.c, src/lib-auth/auth-server-request.c, src/lib-charset
	/charset-iconv.c, src/lib-charset/charset-utf8.c, src/lib-dict/dict-
	client.c, src/lib-dict/dict-db.c, src/lib-dict/dict-file.c, src/lib-
	dict/dict-sql-settings.c, src/lib-dict/dict-sql.c, src/lib-
	dict/dict.c, src/lib-imap/imap-base-subject.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-date.c, src/lib-imap/imap-
	envelope.c, src/lib-imap/imap-id.c, src/lib-imap/imap-match.c, src
	/lib-imap/imap-parser.c, src/lib-imap/imap-quote.c, src/lib-imap
	/imap-seqset.c, src/lib-imap/imap-utf7.c, src/lib-imap/imap-util.c,
	src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	decisions.c, src/lib-index/mail-cache-fields.c, src/lib-index/mail-
	cache-lookup.c, src/lib-index/mail-cache-sync-update.c, src/lib-
	index/mail-cache-transaction.c, src/lib-index/mail-cache.c, src/lib-
	index/mail-index-dummy-view.c, src/lib-index/mail-index-fsck.c, src
	/lib-index/mail-index-lock.c, src/lib-index/mail-index-map.c, src
	/lib-index/mail-index-modseq.c, src/lib-index/mail-index-strmap.c,
	src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	keywords.c, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-sync.c, src/lib-index/mail-index-transaction-view.c, src
	/lib-index/mail-index-transaction.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-index-
	write.c, src/lib-index/mail-index.c, src/lib-index/mail-transaction-
	log-append.c, src/lib-index/mail-transaction-log-file.c, src/lib-
	index/mail-transaction-log-view.c, src/lib-index/mail-transaction-
	log.c, src/lib-index/mailbox-list-index-sync.c, src/lib-index
	/mailbox-list-index.c, src/lib-mail/istream-header-filter.c, src
	/lib-mail/mbox-from.c, src/lib-mail/message-address.c, src/lib-mail
	/message-date.c, src/lib-mail/message-decoder.c, src/lib-mail
	/message-header-decode.c, src/lib-mail/message-header-parser.c, src
	/lib-mail/message-id.c, src/lib-mail/message-parser.c, src/lib-mail
	/message-part-serialize.c, src/lib-mail/message-search.c, src/lib-
	mail/message-send.c, src/lib-mail/message-size.c, src/lib-mail
	/quoted-printable.c, src/lib-mail/rfc2231-parser.c, src/lib-
	mail/rfc822-parser.c, src/lib-settings/settings.c, src/lib-sql
	/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql/sql-api.c,
	src/lib-sql/sql-pool.c, src/lib-storage/index/cydir/cydir-mail.c,
	src/lib-storage/index/cydir/cydir-save.c, src/lib-
	storage/index/cydir/cydir-storage.c, src/lib-storage/index/cydir
	/cydir-sync.c, src/lib-storage/index/cydir/cydir-transaction.c, src
	/lib-storage/index/dbox/dbox-file-maildir.c, src/lib-
	storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox/dbox-
	index.c, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox/dbox-
	storage.c, src/lib-storage/index/dbox/dbox-sync-file.c, src/lib-
	storage/index/dbox/dbox-sync-rebuild.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/dbox/dbox-transaction.c, src
	/lib-storage/index/index-fetch.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-mailbox-check.c, src/lib-storage/index/index-search-result.c,
	src/lib-storage/index/index-search.c, src/lib-storage/index/index-
	sort-string.c, src/lib-storage/index/index-sort.c, src/lib-
	storage/index/index-status.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-sync-changes.c, src/lib-storage/index
	/index-sync-search.c, src/lib-storage/index/index-sync.c, src/lib-
	storage/index/index-thread-finish.c, src/lib-storage/index/index-
	thread-links.c, src/lib-storage/index/index-thread-list.c, src/lib-
	storage/index/index-thread.c, src/lib-storage/index/index-
	transaction.c, src/lib-storage/index/maildir/maildir-copy.c, src
	/lib-storage/index/maildir/maildir-filename.c, src/lib-
	storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-transaction.c, src/lib-storage/index/maildir/maildir-
	uidlist.c, src/lib-storage/index/maildir/maildir-util.c, src/lib-
	storage/index/mbox/istream-raw-mbox.c, src/lib-storage/index/mbox
	/mbox-file.c, src/lib-storage/index/mbox/mbox-lock.c, src/lib-
	storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox/mbox-
	md5.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync-rewrite.c, src
	/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/index/mbox/mbox-
	transaction.c, src/lib-storage/index/raw/raw-mail.c, src/lib-
	storage/index/raw/raw-storage.c, src/lib-storage/index/raw/raw-
	sync.c, src/lib-storage/index/raw/raw-transaction.c, src/lib-
	storage/index/shared/shared-list.c, src/lib-storage/index/shared
	/shared-storage.c, src/lib-storage/list/index-mailbox-list-sync.c,
	src/lib-storage/list/index-mailbox-list.c, src/lib-storage/list
	/mailbox-list-fs-iter.c, src/lib-storage/list/mailbox-list-fs.c, src
	/lib-storage/list/mailbox-list-maildir-iter.c, src/lib-storage/list
	/mailbox-list-maildir.c, src/lib-storage/list/mailbox-list-
	subscriptions.c, src/lib-storage/list/subscription-file.c, src/lib-
	storage/mail-copy.c, src/lib-storage/mail-error.c, src/lib-storage
	/mail-namespace.c, src/lib-storage/mail-search-build.c, src/lib-
	storage/mail-search.c, src/lib-storage/mail-storage.c, src/lib-
	storage/mail-user.c, src/lib-storage/mail.c, src/lib-storage
	/mailbox-list.c, src/lib-storage/mailbox-search-result.c, src/lib-
	storage/mailbox-tree.c, src/lib-storage/mailbox-uidvalidity.c,
	src/lib/aqueue.c, src/lib/array.c, src/lib/backtrace-string.c,
	src/lib/base64.c, src/lib/bsearch-insert-pos.c, src/lib/buffer.c,
	src/lib/child-wait.c, src/lib/close-keep-errno.c, src/lib/compat.c,
	src/lib/crc32.c, src/lib/data-stack.c, src/lib/env-util.c,
	src/lib/failures.c, src/lib/fd-close-on-exec.c, src/lib/fd-set-
	nonblock.c, src/lib/fdatasync-path.c, src/lib/fdpass.c, src/lib
	/file-cache.c, src/lib/file-copy.c, src/lib/file-dotlock.c, src/lib
	/file-lock.c, src/lib/file-set-size.c, src/lib/hash.c,
	src/lib/hash2.c, src/lib/hex-binary.c, src/lib/hex-dec.c, src/lib
	/home-expand.c, src/lib/hostpid.c, src/lib/imem.c, src/lib/ioloop-
	notify-dn.c, src/lib/ioloop-notify-fd.c, src/lib/ioloop-notify-
	inotify.c, src/lib/ioloop-notify-none.c, src/lib/ioloop-poll.c,
	src/lib/ioloop-select.c, src/lib/ioloop.c, src/lib/iostream.c,
	src/lib/istream-concat.c, src/lib/istream-crlf.c, src/lib/istream-
	data.c, src/lib/istream-file.c, src/lib/istream-limit.c, src/lib
	/istream-mmap.c, src/lib/istream-seekable.c, src/lib/istream-tee.c,
	src/lib/istream.c, src/lib/lib-signals.c, src/lib/lib.c, src/lib
	/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib/mempool-
	system-clean.c, src/lib/mempool-system.c, src/lib/mempool-unsafe-
	datastack.c, src/lib/mempool.c, src/lib/mkdir-parents.c, src/lib
	/mmap-anon.c, src/lib/mmap-util.c, src/lib/module-dir.c,
	src/lib/mountpoint.c, src/lib/network.c, src/lib/nfs-workarounds.c,
	src/lib/ostream-file.c, src/lib/ostream.c, src/lib/printf-format-
	fix.c, src/lib/priorityq.c, src/lib/process-title.c,
	src/lib/randgen.c, src/lib/read-full.c, src/lib/restrict-access.c,
	src/lib/restrict-process-size.c, src/lib/safe-memset.c, src/lib
	/safe-mkdir.c, src/lib/safe-mkstemp.c, src/lib/sendfile-util.c,
	src/lib/seq-range-array.c, src/lib/str-find.c, src/lib/str-
	sanitize.c, src/lib/str.c, src/lib/strescape.c, src/lib/strfuncs.c,
	src/lib/unichar.c, src/lib/unix-socket-create.c, src/lib/unlink-
	directory.c, src/lib/unlink-old-files.c, src/lib/utc-mktime.c,
	src/lib/utc-offset.c, src/lib/var-expand.c, src/lib/write-full.c,
	src/login-common/client-common.c, src/login-common/login-proxy.c,
	src/login-common/main.c, src/login-common/master.c, src/login-common
	/sasl-server.c, src/login-common/ssl-proxy-gnutls.c, src/login-
	common/ssl-proxy-openssl.c, src/login-common/ssl-proxy.c,
	src/master/askpass.c, src/master/auth-process.c, src/master/child-
	process.c, src/master/dict-process.c, src/master/dup2-array.c,
	src/master/listener.c, src/master/log.c, src/master/login-process.c,
	src/master/mail-process.c, src/master/main.c, src/master/master-
	settings.c, src/master/ssl-init-gnutls.c, src/master/ssl-init-
	main.c, src/master/ssl-init-openssl.c, src/master/ssl-init.c,
	src/master/sysinfo-get.c, src/master/syslog-util.c, src/plugins/acl
	/acl-api.c, src/plugins/acl/acl-backend-vfile-acllist.c,
	src/plugins/acl/acl-backend-vfile.c, src/plugins/acl/acl-backend.c,
	src/plugins/acl/acl-cache.c, src/plugins/acl/acl-lookup-dict.c,
	src/plugins/acl/acl-mailbox-list.c, src/plugins/acl/acl-mailbox.c,
	src/plugins/acl/acl-plugin.c, src/plugins/acl/acl-shared-storage.c,
	src/plugins/acl/acl-storage.c, src/plugins/convert/convert-plugin.c,
	src/plugins/convert/convert-storage.c, src/plugins/convert/convert-
	tool.c, src/plugins/expire/auth-client.c, src/plugins/expire/expire-
	env.c, src/plugins/expire/expire-plugin.c, src/plugins/expire
	/expire-tool.c, src/plugins/fts-lucene/fts-backend-lucene.c,
	src/plugins/fts-lucene/fts-lucene-plugin.c, src/plugins/fts-solr
	/fts-backend-solr.c, src/plugins/fts-solr/fts-solr-plugin.c,
	src/plugins/fts-solr/solr-connection.c, src/plugins/fts-squat/fts-
	backend-squat.c, src/plugins/fts-squat/fts-squat-plugin.c,
	src/plugins/fts-squat/squat-test.c, src/plugins/fts-squat/squat-
	trie.c, src/plugins/fts-squat/squat-uidlist.c, src/plugins/fts/fts-
	api.c, src/plugins/fts/fts-plugin.c, src/plugins/fts/fts-search.c,
	src/plugins/fts/fts-storage.c, src/plugins/imap-acl/imap-acl-
	plugin.c, src/plugins/imap-quota/imap-quota-plugin.c, src/plugins
	/lazy-expunge/lazy-expunge-plugin.c, src/plugins/mail-log/mail-log-
	plugin.c, src/plugins/mbox-snarf/mbox-snarf-plugin.c,
	src/plugins/quota/quota-count.c, src/plugins/quota/quota-dict.c,
	src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-fs.c,
	src/plugins/quota/quota-maildir.c, src/plugins/quota/quota-plugin.c,
	src/plugins/quota/quota-storage.c, src/plugins/quota/quota.c,
	src/plugins/trash/trash-plugin.c, src/plugins/virtual/virtual-
	config.c, src/plugins/virtual/virtual-mail.c, src/plugins/virtual
	/virtual-plugin.c, src/plugins/virtual/virtual-search.c,
	src/plugins/virtual/virtual-storage.c, src/plugins/virtual/virtual-
	sync.c, src/plugins/virtual/virtual-transaction.c, src/plugins/zlib
	/istream-bzlib.c, src/plugins/zlib/istream-zlib.c, src/plugins/zlib
	/zlib-plugin.c, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/pop3-proxy.c,
	src/pop3/client.c, src/pop3/commands.c, src/pop3/main.c, src/tests
	/test-common.c, src/tests/test-imap.c, src/tests/test-istream.c,
	src/tests/test-lib.c, src/tests/test-mail.c, src/util/gdbhelper.c,
	src/util/idxview.c, src/util/imap-utf7.c, src/util/listview.c,
	src/util/logview.c, src/util/maildirlock.c, src/util/rawlog.c,
	src/util/threadview.c:
	Updated copyright notices to include year 2009.
	[b9faf4db2a9f]

2009-01-04  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/Makefile.am:
	quota-fs: Avoid compiler warning with BSDs.
	[a496105bf45c]

	* src/auth/passdb-bsdauth.c:
	bsdauth: Fix compiler warning + crash on 64bit systems.
	[73b8468c3b87]

2009-01-03  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c, src/deliver/deliver.h, src/deliver/smtp-
	client.c:
	deliver: Don't preserve HOME environment when using -d parameter.
	[db0d0d7385fd]

2008-12-31  Timo Sirainen  <tss@iki.fi>

	* src/auth/password-scheme.c:
	auth: If MD5 scheme can't decode the password log an error.
	[71cc9f3e3f2d]

2008-12-27  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	Added a bit more generic get_process_capability() function. To make
	life easier for managesieve patch. Patch by Stephan Bosch.
	[24ccf040026b]

2008-12-21  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	Log a warning at startup if there doesn't seem to be any way to log
	in from non-localhost.
	[0eac46c235e7]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/imap-login/imap-proxy.c, src/imap-login
	/imap-proxy.h, src/login-common/client-common.c, src/login-common
	/client-common.h, src/login-common/login-proxy.c, src/login-common
	/login-proxy.h, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/client.h,
	src/pop3-login/pop3-proxy.c:
	imap/pop3-login: Cleaned up proxying code. Don't disconnect client
	on proxy failures. Log proxy failures as errors.
	[2ff2cac3578b]

2008-12-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-file-maildir.c:
	dbox maildir migration: Support empty POP3 UIDL = base filename.
	[467606dbabb7]

	* src/lib-storage/index/dbox/dbox-file-maildir.c:
	dbox: Maildir fallbacking code was returning wrong virtual file
	sizes.
	[a920044c8775]

	* src/lib-storage/index/dbox/dbox-file-maildir.c, src/lib-
	storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox/dbox-
	index.c, src/lib-storage/index/dbox/dbox-index.h, src/lib-
	storage/index/dbox/dbox-sync-rebuild.c:
	dbox: In Maildir migrations preserve POP3 UIDL from dovecot-uidlist.
	[1efbbf9d0841]

	* src/util/idxview.c:
	idxview: Show seconds in timestamps (except for cache headers).
	[3b16e400fa8c]

	* configure.in:
	Some versions of Mac OS X have buggy CMSG_* macros, avoid using
	them. Patch by Apple.
	[729576bb91d8]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.c:
	login: Reset idle timeout only when input is actually read from
	client. This prevents client from just sending lots of failed
	authentication attempts and then doing nothing for hours.
	[164569761647]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	Maildir: Avoid rename() when source and dest are identical, stat()
	instead.
	[d077e608a2d6]

	* AUTHORS:
	Added Apple to AUTHORS.
	[52417406a50c]

	* src/auth/auth-request-handler.c, src/imap-login/client-
	authenticate.c, src/imap-login/client.c, src/imap-login/client.h,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.c,
	src/pop3-login/client.h:
	Increase failed login's reply delay by 5 seconds for each failure.
	Don't add any delays if passdb returned nodelay extra field. Based
	on patch by Apple.
	[1b744c38bcac]

	* src/auth/auth-cache.c, src/auth/auth-request-handler.c, src/auth/db-
	ldap.c, src/auth/db-passwd-file.c, src/auth/otp-skey-common.c,
	src/auth/passdb-checkpassword.c, src/auth/passdb-ldap.c, src/auth
	/userdb-checkpassword.c, src/auth/userdb-ldap.c,
	src/deliver/duplicate.c, src/lib-auth/auth-server-connection.c, src
	/lib-auth/auth-server-request.c, src/lib-dict/dict-file.c, src/lib-
	index/mail-cache-fields.c, src/lib-index/mail-cache.c, src/lib-index
	/mail-index.c, src/lib-sql/sql-pool.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/index-thread-finish.c, src/lib-
	storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib/child-wait.c,
	src/lib/hash.c, src/lib/hash.h, src/login-common/master.c, src
	/login-common/ssl-proxy-gnutls.c, src/master/auth-process.c,
	src/master/child-process.c, src/master/login-process.c, src/master
	/mail-process.c, src/plugins/acl/acl-cache.c:
	Renamed hash_*() to hash_table_*() to avoid conflicts with OSX's
	strhash.h Based on patch by Apple.
	[f9166a09423a]

	* configure.in, src/lib-index/mail-index-map.c, src/lib-index/mail-
	index.c, src/lib/sha1.c:
	Try to use (Apple) gcc's __BIG_ENDIAN__ and __LITTLE_ENDIAN__ macros
	if possible. Based on a patch by Apple.
	[9ec2882243a6]

	* src/plugins/virtual/virtual-sync.c:
	virtual: More syncing fixes.
	[563e61fa7726]

	* src/plugins/virtual/virtual-sync.c:
	virtual: Fixed initial mailbox synchronization for the last virtual
	mailbox.
	[67ef46a47065]

	* src/deliver/Makefile.am, src/pop3/Makefile.am:
	Make sure mail_log plugin works with deliver and pop3.
	[5eb05134db86]

	* src/auth/passdb-ldap.c:
	LDAP: Allow empty/missing password field if nopassword field is
	given.
	[935930abeb7a]

2008-12-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-mail.c:
	Maildir: If POP3 UIDL field is empty in dovecot-uidlist, use base
	filename as UIDL.
	[c6facf63c7f9]

	* src/lib/restrict-access.c:
	Fix to previous change: Don't lose errno during uid/gid naming.
	[1c462a3c21ba]

	* src/lib/restrict-access.c:
	If uid/gid changing fails, log also the name of the uid/gid instead
	of just the number.
	[23ae9c63ae47]

2008-12-17  Timo Sirainen  <tss@iki.fi>

	* TODO, src/imap-login/client-authenticate.c, src/login-
	common/common.h:
	Mention SSL/TLS in "plaintext auth disallowed" error.
	[3c4934783aff]

2008-12-16  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	deliver: Don't break if username gets changed by userdb lookup.
	[4c2ff35ba88d]

	* src/lib-storage/mail-user.c:
	Added some extra checks to make sure username can't be empty.
	[6168f782c51a]

	* .hgtags:
	Added tag 1.2.alpha5
	[95eb3dab078b]

	* dovecot-example.conf, src/auth/auth-worker-client.c, src/auth/auth-
	worker-server.c, src/auth/common.h, src/auth/main.c, src/auth
	/passdb-pam.c, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Replaced auth_worker_max_request_count setting with passdb pam {
	args = max_requests=n }
	[b6a7bc10c19a]

	* src/auth/auth-worker-server.c:
	Redesigned auth request queuing to auth worker processes. Only a
	single request is now pending for a worker at a time. If a request
	was queued for more than 3 seconds, log a warning (but no often than
	once in 5 minutes).
	[b0bc4519332f]

	* src/lib-storage/index/index-mail.c:
	mail_set_seq(): Don't open input stream immediately if message
	hasn't been saved yet.
	[94e0fda6802e]

	* src/lib/ioloop-notify-kqueue.c:
	kqueue notify: Don't assert-cras if kevent() returns multiple events
	for the same io.
	[076ccdcbbeb2]

2008-12-15  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Released v1.2.alpha5.
	[5d80abcfb2ff] [1.2.alpha5]

	* TODO:
	Updated TODO.
	[7a7fc8622e24]

	* src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h:
	maildir: Allow opening mailbox and expunging messages when uidlist
	couldn't be locked (e.g. out of quota).
	[c438437b709a]

2008-12-14  Timo Sirainen  <tss@iki.fi>

	* src/plugins/mbox-snarf/mbox-snarf-plugin.c:
	mbox-snarf plugin: If copying failed due to out of disk space, don't
	rollback the entire move.
	[e8a8383895df]

	* dovecot-example.conf, src/plugins/mail-log/mail-log-plugin.c:
	mail-log plugin: Added initial support for append event. uids aren't
	logged though.
	[adfe0b077dc7]

	* dovecot-example.conf, src/plugins/mail-log/mail-log-plugin.c:
	mail-log plugin: Added from and subject fields.
	[2dcfd12f70f2]

	* dovecot-example.conf, src/plugins/mail-log/Makefile.am, src/plugins
	/mail-log/mail-log-plugin.c:
	mail-log plugin: Added flag_change event and flags field.
	[613151990b79]

	* src/lib-index/mail-index-dummy-view.c, src/lib-index/mail-index-
	transaction-private.h, src/lib-index/mail-index-transaction-view.c,
	src/lib-index/mail-index-transaction.c, src/lib-index/mail-index-
	view-private.h, src/lib-index/mail-index-view.c, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-mail.h,
	src/plugins/virtual/virtual-mail.c:
	mail_get_flags/keywords() now returns updated values if they've been
	changed within transaction.
	[7b16388a3bb0]

	* src/lib-index/mail-index-transaction-view.c:
	transaction view: Allow looking up multiple ext datas for the same
	message without breaking.
	[6a6a3bfea547]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-map.c, src
	/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	ext.c, src/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-
	index.c, src/util/idxview.c:
	Replaced literal "keywords" strings with a macro.
	[545cb188f7ab]

	* src/auth/auth-request-handler.c, src/imap-login/client-
	authenticate.c, src/imap-login/client.c, src/imap-login/client.h,
	src/imap-login/imap-proxy.c, src/imap-login/imap-proxy.h,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.h,
	src/pop3-login/pop3-proxy.c, src/pop3-login/pop3-proxy.h:
	imap/pop3 proxy: Support master user logins.
	[50f49805b13b]

	* Makefile.am:
	Don't add config.h to tarball in make dist.
	[ef08feef501a]

2008-12-13  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c, src/deliver/deliver.c, src/deliver/mail-
	send.c, src/imap/client.c, src/lib-storage/index/shared/shared-
	storage.c, src/lib/var-expand.c, src/lib/var-expand.h, src/login-
	common/client-common.c, src/master/mail-process.c, src/plugins/acl
	/acl-shared-storage.c, src/pop3/client.c, src/pop3/commands.c:
	var_expand(): Added support for long %{variable} names.
	[983d38de06c9]

	* dovecot-example.conf:
	Updated ssl_listen and ssl_disable comments.
	[89a31d203d0b]

	* src/plugins/quota/quota-maildir.c:
	Maildir++ quota: Directory mtimes weren't properly kept track of
	when recalculating quota.
	[4799b4fe4e45]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h:
	mmap_disable=yes: Opening index always tried to read it from
	transaction log. This caused more disk I/O than necessary.
	[ca3dd777b405]

	* src/lib-storage/index/index-thread.c, src/plugins/virtual/virtual-
	mail.c:
	Check mail_set_uid() return value properly.
	[868ce575a3e6]

	* src/lib-storage/index/index-mail.c:
	expunged and has(_no)_nuls status wasn't reset when switching
	between mails. This may have caused Dovecot to wrongly assume that a
	mail was expunged if the previous one was.
	[280c92d3a80c]

	* src/deliver/deliver.c:
	deliver: If -a parameter isn't given, fallback to Envelope-To:
	header and user@hostname.
	[19e05e1bcb5c]

	* src/deliver/deliver.c:
	deliver: Allow overriding a boolean setting to "no" in protocol lda
	section.
	[1e913c30c1ed]

	* src/lib/env-util.c, src/lib/env-util.h:
	Added env_remove().
	[b1a7df02ba38]

	* src/pop3-login/client-authenticate.c:
	POP3: A bit more code for handling nicely unsupported auth
	mechanisms.
	[403621c075c5]

	* src/imap-login/client-authenticate.c, src/imap-login/client.h,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.h:
	Don't crash if trying to use an unsupported auth mechanism.
	[4693c9f72baa]

	* src/lib-storage/mail-storage.c:
	Die if trying to sync mailbox while transactions are open.
	[70b0597e2bb5]

	* src/lib-storage/index/index-search.c:
	Sorting messages was completely broken.
	[3e1b401dd543]

	* src/lib-mail/message-send.c:
	Crashfix to previous message parsing error handling changes.
	[f63f26da3845]

	* src/lib-index/mail-index-view-sync.c:
	Crashfix to handling missing transaction logs.
	[60ea101c7534]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-file.c, src/lib-storage/index/mbox/mbox-lock.c, src/lib-
	storage/index/mbox/mbox-mail.c:
	mbox: Don't cache mbox state after it has been unlocked.
	[e7b0a099c33d]

	* src/lib-storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/index/mbox/mbox-transaction.c:
	mbox locking fixes.
	[1a9e14718bd6]

	* src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c, src/util/idxview.c:
	mbox: Added a new index header where dirtyness state is stored. This
	also fixes a bug where sync_size wasn't updated in header when mbox
	was marked dirty, causing other parts of code to assume wrong file
	size and return wrong size for the last message and/or cause "Next
	message unexpectedly lost" errors.
	[6d07bedcdb80]

	* src/imap/imap-fetch-body.c, src/lib-mail/istream-header-filter.c,
	src/lib-mail/message-send.c, src/lib-mail/message-send.h, src/lib-
	mail/message-size.c, src/lib-mail/message-size.h, src/lib-
	storage/index/index-mail.c:
	Message parsing/reading: If read returns failure, don't ignore the
	error.
	[c63cc3580150]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	i_stream_raw_mbox_read(): If we already detected corruption, return
	failure instead of assert-crashing.
	[9c8b0f8075d2]

2008-12-08  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-storage.c:
	virtual: Fixed to work with recent changes.
	[60080a56ebc7]

2008-12-06  Timo Sirainen  <tss@iki.fi>

	* autogen.sh, configure.in:
	Use "foreign" automake option so it doesn't complain about missing
	ChangeLog.
	[426b356a0708]

	* src/auth/passdb-bsdauth.c, src/auth/passdb-passwd.c, src/auth
	/passdb-shadow.c:
	Previous "Unknown setting" in passdb check changes were a bit
	broken.
	[b80ef0ddd1d3]

	* src/imap/commands-util.c, src/lib-imap/imap-resp-code.h, src/plugins
	/imap-acl/imap-acl-plugin.c:
	Changed imap-resp-code [ACL] to [NOPERM], which it will be in the
	next draft.
	[182552d20b17]

	* src/master/mail-process.c:
	Changed error messages.
	[86477dd0b276]

	* src/plugins/fts-solr/fts-backend-solr.c:
	fts-solr: Minor bugfix
	[f456043e10d3]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/list/mailbox-
	list-maildir-iter.c, src/lib-storage/mail-error.c, src/lib-storage
	/mail-error.h, src/lib-storage/mail-storage-private.h, src/lib-
	storage/mail-storage.c:
	Improved "Permission denied" error handling. It'll now show also the
	uid/gid name. Also moved the code to mail-error.c and used it when
	listing mailboxes.
	[1e42b631f037]

	* configure.in:
	configure: Handle --with-*=* consistently and give better error
	messages.
	[451e3cf38290]

2008-12-05  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Updated comment about shared namespaces.
	[101b206caa00]

	* dovecot-example.conf:
	Removed a comment about namespaces not working with LDA.
	[3dc481f92b7d]

2008-12-03  Timo Sirainen  <tss@iki.fi>

	* src/lib/compat.c:
	my_vsnprintf() implementation was broken (for old non-C99 compliant
	OSes)
	[1bb73f69b3f3]

2008-12-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-bsdauth.c, src/auth/passdb-pam.c, src/auth/passdb-
	passwd-file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c,
	src/auth/passdb-vpopmail.c, src/auth/passdb.c, src/auth/userdb-
	nss.c, src/auth/userdb-vpopmail.c, src/auth/userdb.c:
	Fail if trying to give unknown parameters to passdb/userdb. Also
	changed error messages to be consistent.
	[0691f5294bb9]

	* src/auth/userdb-prefetch.c:
	If only userdb prefetch is defined and userdb lookup is tried, give
	a better error message.
	[2034087a9663]

	* src/master/master-settings.c:
	Fixed "alias_for points to unknown namespace" error handling.
	[bd145a5c5482]

2008-12-01  Timo Sirainen  <tss@iki.fi>

	* src/plugins/autocreate/autocreate-plugin.c:
	autocreate plugin: If mail_debug=yes, log the reason why mailbox
	creation fails.
	[ac872ae669ff]

2008-11-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c, src/plugins/fts/fts-storage.c:
	Increased search_nonblock() to go through 50 messages at a time.
	[2eede4287841]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-storage-
	private.h, src/plugins/fts/fts-storage.c:
	fts: Hide "Searching .." notify while indexing.
	[689a63a99363]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-storage-
	private.h, src/plugins/fts/fts-storage.c, src/plugins/virtual
	/virtual-search.c:
	Give more correct "* OK searched n%" notifications with fts and
	virtual mailboxes.
	[f323bf2465bd]

	* src/plugins/fts/fts-search.c:
	fts: Don't crash if using both X-TEXT-FAST and TEXT in the same
	query without substr fts.
	[52f95ea3932b]

	* src/plugins/fts-solr/fts-backend-solr.c:
	fts-solr: In filter queries use "+" prefixes to require all the
	parameters to match.
	[5cc1c4f3d38b]

	* src/lib/ioloop.c:
	ioloop: 0 ms timeouts could still have caused infinite looping.
	[2297a352dfd3]

	* src/lib/ioloop.c:
	Avoid integer overflows when calculating with very large timeout
	values.
	[16ca1b36e6c3]

	* src/lib-storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	mbox: If mailbox is deleted under us, try to avoid logging errors.
	[570927dfc769]

	* src/lib-storage/mail-user.c:
	mail_user_get_home() looked up user's home directory from userdb
	even if was already known.
	[3fe1fb4e4f11]

	* src/lib-storage/mail-namespace.c, src/lib-storage/mail-namespace.h,
	src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h, src/plugins/fts-solr/fts-backend-solr.c,
	src/plugins/fts/fts-storage.c:
	Added alias_for setting for namespaces. Fixes namespace issues with
	fts.
	[3efcdc45d111]

	* doc/solr-schema.xml, src/lib-storage/mail-storage-private.h, src
	/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h,
	src/plugins/fts-solr/fts-backend-solr.c, src/plugins/fts-solr/fts-
	solr-plugin.c, src/plugins/fts-solr/fts-solr-plugin.h, src/plugins
	/fts-solr/solr-connection.c, src/plugins/fts-solr/solr-connection.h,
	src/plugins/fts/fts-storage.c, src/plugins/virtual/virtual-config.c,
	src/plugins/virtual/virtual-storage.c, src/plugins/virtual/virtual-
	storage.h:
	fts: Added support for handling multiple namespaces.
	[252b29ac5f43]

	* src/util/idxview.c:
	idxview: Decode virtual extension records.
	[fb5fedcf4deb]

2008-11-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	Fixed searching in virtual mailboxes.
	[8a511d7da23f]

	* src/plugins/fts/fts-storage.c, src/plugins/fts/fts-storage.h:
	fts: Cache "last indexed uid" lookups as long as new messages aren't
	added to mailbox.
	[1e8f718884c4]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/index/raw/raw-storage.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins
	/fts-solr/fts-backend-solr.c, src/plugins/fts-solr/solr-
	connection.c, src/plugins/fts-solr/solr-connection.h, src/plugins
	/fts-squat/fts-backend-squat.c, src/plugins/fts/fts-api-private.h,
	src/plugins/fts/fts-api.c, src/plugins/fts/fts-api.h,
	src/plugins/fts/fts-storage.c, src/plugins/fts/fts-storage.h,
	src/plugins/virtual/virtual-config.c, src/plugins/virtual/virtual-
	storage.c, src/plugins/virtual/virtual-storage.h:
	Finished making full text search indexes work fast with virtual
	mailboxes.
	[ffb37c392166]

	* src/plugins/fts-solr/solr-connection.c:
	fts-solr: Don't break if mailbox name contains '&' characters.
	[57e704c361a7]

	* src/plugins/fts-solr/fts-backend-solr.c:
	fts-solr: Use '!' as escape character in usernames. Escape '/' and
	'!'.
	[149c6ccc3df4]

	* doc/solr-schema.xml, src/plugins/fts-solr/fts-backend-solr.c:
	fts-solr: Keep last_uid field updated containing the mailbox's last
	added UID. Use the last_uid document for finding the last added UID
	instead of creating a query with rows=1&sort=uid. It should be
	faster this way.
	[ee1ecdda8a6b]

2008-11-24  Timo Sirainen  <tss@iki.fi>

	* NEWS:
	Updated.
	[f48e7614677a]

	* .hgtags:
	Added tag 1.2.alpha4 for changeset f53952ac4285
	[3e0273dd6687]

	* configure.in:
	Released v1.2.alpha4.
	[f53952ac4285] [1.2.alpha4]

	* NEWS, TODO:
	Updated
	[072edbdb8102]

	* src/plugins/autocreate/autocreate-plugin.c, src/plugins/trash/trash-
	plugin.c:
	Call next hook_mail_namespaces_created in correct order.
	[cee696a95320]

	* src/plugins/listescape/listescape-plugin.c:
	listescape plugin wasn't calling next hook_mail_namespaces_created.
	[23620e05e7c8]

2008-11-23  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Added a note about !include_try to ssl_key_password in dovecot-
	example.conf
	[739d868c5fe9]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/index/raw/raw-storage.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/plugins/fts-solr/fts-backend-solr.c, src/plugins/fts-
	solr/solr-connection.c, src/plugins/fts-solr/solr-connection.h,
	src/plugins/fts/fts-storage.c, src/plugins/fts/fts-storage.h,
	src/plugins/virtual/virtual-storage.c, src/plugins/virtual/virtual-
	storage.h:
	Initial support for getting full text search working nicely with
	virtual mailboxes.
	[db78eab2ba5d]

	* src/plugins/virtual/Makefile.am, src/plugins/virtual/virtual-
	search.c, src/plugins/virtual/virtual-storage.c, src/plugins/virtual
	/virtual-storage.h:
	Optimized searching with virtual mailboxes. Instead of going through
	the messages in the virtual mailbox order, go them through one
	mailbox at a time and in ascending message order within that
	mailbox.
	[b12705704329]

	* src/lib-storage/index/index-mail.c, src/lib-storage/mail-storage-
	private.h:
	Added wanted_fields and wanted_headers fields to struct
	mail_search_context.
	[1ff129ed866a]

	* src/lib-storage/index/index-search.c:
	Moved search update result checks to search_next_update_seq().
	[9db582413fef]

	* src/lib-storage/index/index-sort-string.c:
	Sorting: Don't break if search code adds sequences in random order.
	[f0c9677bf489]

	* src/lib-storage/index/index-search.c:
	Fix to previous search_next_update_seq change.
	[bcdbf33ae9b8]

	* src/lib-storage/mailbox-list.c:
	Fixed crashing with virtual mailboxes.
	[adf36d9cd338]

2008-11-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/mail-storage-private.h, src/plugins/fts
	/fts-storage.c:
	mail_storage.search_next_update_seq returns now bool. It was never
	failing.
	[c033b3e2d9b6]

2008-11-21  Timo Sirainen  <tss@iki.fi>

	* src/lib/nfs-workarounds.c:
	Linux/Solaris NFS: if there are no locks, try flushing data cache by
	flushing attr cache.
	[9bcc2dd5f17f]

	* src/auth/auth-worker-server.c:
	Auth workers: Don't assert-crash when process's idle timeout hits.
	[b64fb26e3b6f]

	* src/auth/auth-worker-server.c:
	Auth workers: Use the correct lookup timeout.
	[a24661b372a1]

	* src/lib-storage/mailbox-list.c:
	Fixed deleting control directory when it wasn't the same as index
	directory.
	[81bc28227b6c]

	* src/lib-storage/mail-namespace.c:
	Changed mail_user refcounting to fix deinitialization.
	[ae30ea8532ee]

	* src/plugins/expire/expire-plugin.c:
	Expire plugin works now with multiple struct mail_users.
	[f82ba0d5ed30]

	* src/lib-storage/mail-user.c, src/lib-storage/mail-user.h,
	src/plugins/imap-quota/imap-quota-plugin.c, src/plugins/quota/quota-
	storage.c, src/plugins/quota/quota.c:
	Quota works now properly with shared mailboxes.
	[e4f319453cb2]

	* src/plugins/quota/quota-count.c:
	dict quota: Don't fail quota calculation if some mailboxes aren't
	accessible.
	[e2ec45b71119]

	* src/deliver/deliver.c, src/imap/cmd-append.c, src/imap/cmd-copy.c,
	src/imap/cmd-select.c, src/imap/imap-status.c, src/lib-storage/mail-
	storage.c, src/lib-storage/mail-storage.h, src/plugins/convert
	/convert-storage.c, src/plugins/expire/expire-tool.c, src/plugins
	/imap-acl/imap-acl-plugin.c, src/plugins/imap-quota/imap-quota-
	plugin.c, src/plugins/lazy-expunge/lazy-expunge-plugin.c,
	src/plugins/mbox-snarf/mbox-snarf-plugin.c, src/plugins/quota/quota-
	count.c, src/plugins/quota/quota-storage.c, src/plugins/trash/trash-
	plugin.c, src/plugins/virtual/virtual-storage.c, src/pop3/client.c:
	mailbox_open() now takes struct mail_storage ** so it can be
	changed.
	[d4eab639c253]

	* src/deliver/deliver.c, src/imap/client.c, src/imap/main.c, src/lib-
	storage/Makefile.am, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/shared/Makefile.am, src/lib-storage/index/shared
	/shared-storage.c, src/lib-storage/index/shared/shared-storage.h,
	src/lib-storage/mail-namespace.c, src/lib-storage/mail-namespace.h,
	src/lib-storage/mail-storage.c, src/lib-storage/mail-user.c, src
	/lib-storage/mail-user.h, src/plugins/acl/acl-lookup-dict.c,
	src/plugins/convert/convert-plugin.c, src/plugins/convert/convert-
	storage.c, src/plugins/convert/convert-tool.c, src/plugins/expire
	/expire-tool.c, src/pop3/client.c, src/pop3/main.c:
	mail_user_*() now handles home directory lookups when necessary.
	Namespace owner is now a pointer to struct mail_user rather than a
	string.
	[03c418eadc8b]

	* src/plugins/acl/acl-lookup-dict.c:
	acl: Update acl_dict correctly also for other visible users' shared
	namespaces.
	[4553e28eb4f5]

	* src/lib-storage/index/shared/shared-storage.c, src/lib-storage/mail-
	namespace.c, src/lib-storage/mail-namespace.h:
	Added namespace owner username to struct mail_namespace.
	[027a61241ebb]

	* src/plugins/acl/acl-lookup-dict.c:
	acl: Crashfix.
	[75d2b3b5b367]

	* dovecot-example.conf:
	dovecot-example.conf: Added acl_dict example.
	[6e5c37d9dcf9]

	* dovecot-example.conf:
	Added an example shared namespace.
	[449634ed81b6]

	* src/imap/cmd-list.c, src/imap/cmd-subscribe.c, src/lib-
	storage/index/shared/shared-list.c, src/lib-storage/index/shared
	/shared-storage.c, src/lib-storage/mail-namespace.c, src/lib-storage
	/mail-namespace.h, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added list=children option for namespaces.
	[659667d89f69]

	* src/plugins/acl/acl-mailbox-list.c:
	acl: Don't check ACLs for shared root namespace. Make sure next
	hook_mailbox_list_created gets called always.
	[8dfb193bb30c]

	* src/plugins/quota/quota-fs.h:
	Compiling fix for HP-UX.
	[a946f744aea3]

	* src/deliver/auth-client.c, src/deliver/auth-client.h,
	src/deliver/deliver.c, src/lib-auth/auth-master.c, src/lib-auth
	/auth-master.h:
	deliver: Allow userdb to change the username.
	[ed4d6f6e4da7]

2008-11-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-sync.c, src/lib-storage/index/shared/shared-storage.c,
	src/lib-storage/mail-user.c, src/lib-storage/mail-user.h:
	Don't drop useless namespaces automatically while creating a new
	one. It may free namespaces that are still being used elsewhere.
	Rather do it explicitly at the beginning of each mailbox sync.
	[f5554ae61732]

2008-11-19  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	Add login username in "Attempted master login with no master
	passdbs" error.
	[529034798b6b]

	* src/plugins/acl/acl-backend-vfile.c:
	acl: Fixes to handling extended ACL names.
	[645af8d240d6]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	IMAP: SETACL +<rights> or -<rights> was broken.
	[ba5f7a4b89d6]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/mail-
	storage.h:
	mail_get_headers_utf8() and mail_get_first_header_utf8() return
	headers unfolded now.
	[1d542b149bed]

	* src/deliver/deliver.c:
	deliver: Ignore !include_try, give error if !include is tried to be
	used.
	[7dcffe7ee7f5]

	* src/lib-settings/settings.c:
	Added !include and !include_try directives to config file reader.
	[e14aabe52d8e]

	* src/plugins/acl/acl-mailbox-list.c:
	acl: Don't break mailbox visibility checks if the name has "*"
	characters.
	[f532e962f05d]

	* src/plugins/acl/acl-mailbox-list.c:
	acl: Save the entire dovecot-acl-list to memory, otherwise "has
	visible children" check fails.
	[9dbb98d029e7]

	* src/lib-storage/index/shared/shared-storage.c, src/lib-storage/mail-
	namespace.h, src/lib-storage/mailbox-list.c:
	When autocreating a new shared namespace, drop existing namespaces
	where we haven't seen any mailboxes.
	[4cf249042df6]

	* src/plugins/acl/acl-shared-storage.c:
	acl: If a user's namespace has no mailboxes visible to us, remove
	the namespace immediately.
	[c56835b33b14]

	* src/lib-storage/index/shared/shared-storage.c, src/lib-storage/mail-
	namespace.c, src/lib-storage/mail-namespace.h:
	Added mail_namespace_destroy().
	[1c13cf0f8bb5]

	* src/plugins/acl/acl-mailbox-list.c:
	acl LIST: Mailboxes without LOOKUP right are now listed as non-
	existent if they have visible children.
	[33dc554bd33f]

	* src/plugins/acl/acl-mailbox-list.c:
	acl: Code cleanups.
	[e3c8fd174378]

	* src/plugins/acl/acl-backend-vfile-acllist.c:
	vfile _nonowner_iter_next(): Don't return failure if we detect that
	acllist changes. The code was probably added during development for
	some reason but it has never been of any use.
	[4a99dc803465]

	* src/lib-storage/index/index-mail.c, src/lib/hash.c, src/plugins/acl
	/acl-mailbox-list.c:
	Minor code cleanup: Removed extra ';' characters.
	[944a13d1fe83]

	* src/plugins/acl/acl-lookup-dict.c:
	Don't crash if acl_dict setting is missing.
	[6d5ca089bd1e]

	* src/lib-storage/list/subscription-file.c:
	Subscriptions file: Don't ignore last line if it's missing LF.
	[a3feb99907af]

	* src/auth/db-passwd-file.c, src/deliver/deliver.c, src/lib-
	settings/settings.c, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/trash/trash-plugin.c, src/plugins/virtual/virtual-
	config.c:
	Changed all config file readers to not ignore the last line if it's
	missing LF.
	[596a577698c1]

	* src/lib/istream-internal.h, src/lib/istream.c, src/lib/istream.h:
	Added i_stream_set_return_partial_line().
	[1baa595093f5]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	imap-acl: If ACLs are disabled, don't give errors at logout.
	[8f41c9f3f392]

2008-11-18  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota.h:
	IMAP quota should have returned "MESSAGE", not "MESSAGES" quota.
	[08b636ff0841]

2008-11-17  Andrey Panin  <pazke@donpac.ru>

	* src/lib-storage/index/shared/shared-list.c:
	Fix build error with Sun C compiler.
	[2b17f1cd86f3]

	* src/lib/unicodemap.pl:
	Constify generated unicode tables.
	[fa755adddb11]

2008-11-16  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/Makefile.am, src/plugins/acl/acl-api-private.h,
	src/plugins/acl/acl-api.c, src/plugins/acl/acl-backend-vfile-
	acllist.c, src/plugins/acl/acl-backend-vfile.c, src/plugins/acl/acl-
	lookup-dict.c, src/plugins/acl/acl-lookup-dict.h, src/plugins/acl
	/acl-mailbox-list.c, src/plugins/acl/acl-mailbox.c, src/plugins/acl
	/acl-plugin.c, src/plugins/acl/acl-plugin.h, src/plugins/acl/acl-
	shared-storage.c, src/plugins/acl/acl-shared-storage.h,
	src/plugins/acl/acl-storage.c, src/plugins/acl/acl-storage.h:
	Initial support for LISTing users with shared mailboxes.
	[dfe39e9a9e78]

	* src/lib-dict/dict-file.c:
	Iteration was broken in dict-file.
	[8f083c8482e1]

	* src/lib-storage/index/shared/shared-list.c, src/lib-
	storage/index/shared/shared-storage.c, src/lib-storage/index/shared
	/shared-storage.h:
	shared-storage.h doesn't require index-storage.h, don't include it.
	[118e07fdfe11]

	* src/plugins/acl/acl-api-private.h, src/plugins/acl/acl-api.c,
	src/plugins/acl/acl-backend-vfile-acllist.c, src/plugins/acl/acl-
	backend-vfile.c:
	acl: When lookup ACLs are changed, make sure dovecot-acl-list is
	updated.
	[23aee2534249]

	* src/plugins/acl/acl-mailbox.c, src/plugins/acl/acl-storage.c:
	Fixed OPEN_IGNORE_ACLS flag to work again with imap-acl plugin.
	[633f5ff81767]

	* src/deliver/deliver.c, src/lib-storage/index/index-storage.c, src
	/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/mail-storage-private.h, src/lib-
	storage/mail-storage.h, src/plugins/acl/acl-api.h, src/plugins/acl
	/acl-backend-vfile.c, src/plugins/acl/acl-backend.c, src/plugins/acl
	/acl-mailbox-list.c, src/plugins/acl/acl-mailbox.c, src/plugins/acl
	/acl-storage.c, src/plugins/acl/acl-storage.h, src/plugins/imap-acl
	/imap-acl-plugin.c:
	ACLs: Initial support for "post" right.
	[1b7c0a216663]

	* src/lib-storage/mail-storage.h, src/plugins/acl/acl-storage.c,
	src/plugins/imap-acl/imap-acl-plugin.c:
	IGNORE_ACLS should have been mailbox_open_flags, not
	mail_storage_flag.
	[47198d7a5f03]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	IMAP ACLs: Let MYRIGHTS show the rights even if we don't have "r"
	permission.
	[5c4af90c9155]

	* src/plugins/acl/acl-storage.c:
	acl: Use MAIL_STORAGE_FLAG_IGNORE_ACLS flag.
	[65d005f2c28b]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	IMAP ACLs: Unless acl_anyone=allow, disallow adding "anyone" and
	"authenticated" identifiers.
	[e758515bbbbf]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	IMAP ACLs: Use '#' prefix for global ACLs.
	[1f93b1bd8a32]

	* src/plugins/acl/acl-backend-vfile.c:
	acl: After updating ACLs, try to avoid re-reading the ACLs on next
	access.
	[6d97abf20724]

	* src/plugins/acl/acl-api-private.h, src/plugins/acl/acl-backend-
	vfile.c, src/plugins/acl/acl-backend.c:
	acl: Default owner rights override anyone/authenticated/group
	rights.
	[2df1b964d32a]

	* src/plugins/acl/acl-backend-vfile.c:
	acl: Always give admin right to owner in private mailboxes.
	[f60d9dd18722]

	* src/plugins/imap-acl/imap-acl-plugin.c:
	imap-acl: Removed a duplicate [ACL] prefix from error message.
	[b8a3b8d6c60c]

	* configure.in, src/plugins/Makefile.am, src/plugins/acl/Makefile.am,
	src/plugins/acl/acl-api-private.h, src/plugins/acl/acl-api.c,
	src/plugins/acl/acl-api.h, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/acl/acl-cache.c, src/plugins/acl/acl-mailbox.c,
	src/plugins/acl/acl-plugin.h, src/plugins/acl/acl-storage.h,
	src/plugins/imap-acl/Makefile.am, src/plugins/imap-acl/imap-acl-
	plugin.c, src/plugins/imap-acl/imap-acl-plugin.h:
	Added IMAP ACL commands with ability to modify ACLs. Based on patch
	by Bernhard Herzog and Sascha Wilde.
	[29b1ec15880a]

	* src/lib-storage/mail-error.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/lib-storage/mailbox-list.c:
	Made CRITICAL_MSG* public to MAIL_ERRSTR_CRITICAL_MSG* in mail-
	error.h.
	[106ad33091ca]

	* src/plugins/acl/acl-api.c:
	acl_object_get_my_rights() was returning broken rights.
	[f5d753c4c8c6]

	* src/plugins/acl/acl-api.h, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/acl/acl-cache.c, src/plugins/acl/acl-cache.h:
	ACL: Crashfix to previous change. Also fixes "-id" to work correctly
	with missing "id".
	[d00c446a95df]

	* src/plugins/acl/acl-api.h, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/acl/acl-cache.c, src/plugins/acl/acl-cache.h:
	Global ACLs now override all local ACLs. Also did some some internal
	in anticipation of ACL file update code.
	[d486dfe02c1e]

2008-11-15  Timo Sirainen  <tss@iki.fi>

	* doc/auth-protocol.txt, src/auth/auth-request-handler.c, src/imap-
	login/client-authenticate.c:
	Give a different error message if authentication succeeds but
	authorization fails. Added a new "authz" parameter for FAIL result
	in the auth protocol for this.
	[24c8bc8098ee]

	* src/imap-login/client-authenticate.c, src/imap/client.c, src/imap
	/cmd-copy.c, src/imap/cmd-fetch.c, src/imap/cmd-search.c, src/imap
	/cmd-status.c, src/imap/commands-util.c, src/lib-imap/Makefile.am,
	src/lib-imap/imap-resp-code.h:
	Moved imap-resp-codes to macros.
	[6e9100795d89]

	* src/imap-login/client-authenticate.c, src/imap/client.c, src/imap
	/cmd-copy.c, src/imap/cmd-fetch.c, src/imap/cmd-search.c, src/imap
	/cmd-status.c, src/imap/commands-util.c, src/lib-storage/index/cydir
	/cydir-storage.c, src/lib-storage/index/dbox/dbox-storage.c, src
	/lib-storage/index/index-search.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/list/mailbox-list-fs.c, src/lib-storage/list/mailbox-
	list-maildir.c, src/lib-storage/mail-error.h, src/lib-storage/mail-
	storage-private.h, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h, src/lib-storage/mailbox-list.c:
	Implemented imap-response-codes draft.
	[abd0ef855a33]

	* src/imap/imap-status.c:
	Minor code cleanup.
	[3c0d14ec17a5]

	* src/imap/cmd-search.c:
	IMAP: SEARCH command was returning EXPUNGEs to client.
	[97f7b15f7d44]

	* src/deliver/deliver.c:
	deliver: When logging to syslog, use "dovecot" as ident. Add
	deliver(%u) manually.
	[cf5a467e991c]

	* src/lib/failures.c, src/lib/failures.h:
	Logging: Support specifying a prefix also for syslog logging.
	[511ceaaa2268]

	* src/master/mail-process.c:
	Code cleanup for previous change.
	[ed4d6fc5712b]

	* src/master/mail-process.c:
	dovecot --exec-mail: Never listen input from stderr, there's no
	point.
	[cb742f826abd]

	* src/plugins/acl/acl-plugin.c, src/plugins/convert/convert-plugin.c,
	src/plugins/expire/expire-plugin.c, src/plugins/fts/fts-plugin.c,
	src/plugins/lazy-expunge/lazy-expunge-plugin.c, src/plugins/mbox-
	snarf/mbox-snarf-plugin.c, src/plugins/quota/quota-plugin.c,
	src/plugins/trash/trash-plugin.c:
	Plugins: If mail_debug=yes, log "plugin disabled" if plugin's
	required setting isn't set.
	[d3cbd3494a8c]

	* src/master/master-settings.c:
	If auth process count > 0 and auth sockets are defined, give an
	understandable error message.
	[88b15ab4b1d0]

	* src/auth/auth-request.c:
	auth: Improved "user not found from userdb" error message.
	[244addad91a5]

	* src/plugins/fts-solr/solr-connection.c:
	fts-solr: Don't assert-crash if we couldn't connect to Solr.
	[83cad8a5bf15]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Maildir: Fixed to work with LAYOUT=fs and non-empty DIRNAME.
	[ce4779b95fc8]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-storage/list
	/mailbox-list-fs.c, src/lib-storage/list/mailbox-list-maildir.c, src
	/lib-storage/mailbox-list-private.h, src/lib-storage/mailbox-list.c,
	src/lib-storage/mailbox-list.h:
	Fixed dbox to work with Maildir++ layout.
	[155700456194]

	* configure.in:
	configure: Previous change broke shared storage completely.
	[d331b8fc8ba8]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Maildir + LAYOUT=fs: Return children flags correctly.
	[83cfa6204784]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Make maildir++ iter_is_mailbox() code consistent with others.
	[8b8a424ed82e]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Maildir: LAYOUT=fs didn't return \NonExistent flag correctly. Also
	made the *_iter_is_mailbox() handling consistent between backends.
	[401d1d3f4eca]

2008-11-13  Timo Sirainen  <tss@iki.fi>

	* src/auth/password-scheme.c:
	Added support for SSHA256 password scheme.
	[8be0fe79093b]

	* src/lib/sha2.c, src/lib/sha2.h:
	sha256_loop() takes now const void *data parameter.
	[44f3bf2d0671]

2008-11-12  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	configure: Shared storage should always be enabled, don't allow
	removing it (and causing a compiler failure).
	[3b6999dc112f]

2008-11-11  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-sync.c:
	virtual mailboxes: Fixed an assert-crash when mailbox was being
	opened.
	[2a9d0bfc2c2b]

2008-11-07  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-config.c:
	virtual mailboxes: Support negative mailbox patterns/names. This
	allows for example "all mailboxes, except Spam".
	[db0c70913765]

2008-11-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c:
	Maildir saving: Handle "out of disk space/quota" failures in fsync()
	and close(). Those failures could happen with NFS (close() only if
	fsync_disable=yes).
	[b9e34721e74c]

2008-11-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-file.c:
	dict-file: Minor optimization when writing the file.
	[4a608f96609b]

	* src/plugins/fts/fts-storage.c, src/plugins/fts/fts-storage.h:
	fts: If we haven't indexed all messages, search the rest using non-
	indexed search. Typically this happens with header searches which
	don't force an index update.
	[fbd90ad20593]

	* src/plugins/fts/fts-storage.c:
	fts: Don't force SEARCH_HEADER_COMPRESS_LWSP to update indexes
	either.
	[7b21f9546aa7]

	* src/plugins/fts/fts-search.c:
	fts: Handle also SEARCH_HEADER_COMPRESS_LWSP, not just
	SEARCH_HEADER.
	[63f7e1ad7646]

2008-11-01  Timo Sirainen  <tss@iki.fi>

	* src/deliver/Makefile.am, src/deliver/deliver.c:
	deliver -m: Assume the given mailbox name is in UTF-8 format.
	[c6482b5cdea1]

	* .hgignore, src/util/Makefile.am, src/util/imap-utf7.c:
	Added imap_utf7 tool for mUTF-7 <-> UTF-8 conversion.
	[8815fc1099c8]

	* src/lib-storage/mailbox-list.c:
	Enforce valid mUTF-7 names when creating new mailboxes.
	[bcf3a185bfc1]

	* src/lib-imap/Makefile.am, src/lib-imap/imap-utf7.c, src/lib-imap
	/imap-utf7.h, src/tests/test-imap.c:
	Added code for encoding and decoding IMAP's modified-UTF7 strings.
	[81c0fe5bd635]

	* src/lib/base64.c:
	Minor base64 code optimization.
	[59fc12b2b08a]

	* src/tests/test-lib.c:
	Added some base64 random testing.
	[1a9cda20c462]

	* src/lib/unichar.h:
	Added some UTF16_ macros for helping UTF-16 conversions.
	[fcce76948c8a]

	* src/plugins/zlib/istream-zlib.c:
	Compiler warning fix in some 32bit systems.
	[a76540e6d773]

	* configure.in, src/deliver/Makefile.am, src/imap/Makefile.am,
	src/plugins/convert/Makefile.am, src/plugins/expire/Makefile.am,
	src/plugins/fts-squat/Makefile.am, src/pop3/Makefile.am:
	$STORAGE_LIBS now contains all the libraries that libstorage needs.
	There's no point in listing the same required libraries everywhere.
	[2d24b8b46308]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/shared/shared-storage.c, src
	/lib-storage/index/shared/shared-storage.h:
	shared mailboxes: Cleanups, fixes and optimizations.
	[4aafdbe62680]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	dbox/mbox: Don't auto-create INBOX if storage isn't in the INBOX
	namespace.
	[9d7c0ff9c2a0]

	* src/deliver/auth-client.c, src/lib-auth/auth-master.c, src/lib-auth
	/auth-master.h, src/plugins/expire/auth-client.c, src/plugins/expire
	/auth-client.h, src/plugins/expire/expire-tool.c:
	auth-master API cleanups.
	[9524ec6e14fc]

2008-10-28  Sascha Wilde  <wilde@intevation.de>

	* src/imap/Makefile.am, src/lib-storage/index/shared/Makefile.am, src
	/lib-storage/index/shared/shared-storage.c,
	src/plugins/convert/Makefile.am, src/plugins/expire/Makefile.am,
	src/plugins/fts-squat/Makefile.am, src/pop3/Makefile.am:
	shared namespaces: new %%h variable, expanding to the traget users
	home.
	[469fc16380da]

2008-11-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-uidlist.c,
	src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib-storage/index/shared/shared-storage.c:
	Use mail_storage_set_critical() instead of i_error() directly.
	[b46cf0979768]

	* src/plugins/expire/Makefile.am, src/plugins/expire/auth-client.c,
	src/plugins/expire/expire-tool.c:
	expire-tool: Use the new auth-master API instead of doing the lookup
	ourself.
	[ffe34451c01a]

	* src/deliver/auth-client.c, src/lib-auth/auth-master.c, src/lib-auth
	/auth-master.h:
	auth-master API cleanup.
	[6db401560d37]

	* src/deliver/Makefile.am, src/deliver/auth-client.c, src/deliver
	/auth-client.h, src/deliver/deliver.c, src/lib-auth/auth-master.c,
	src/lib-auth/auth-master.h:
	Cleanups and fixes to auth-master API.
	[9babcdc6f4f7]

	* src/lib/lib-signals.c, src/lib/lib-signals.h:
	Added lib_signals_reset_ioloop() for handling signals with multiple
	ioloops.
	[0d49326397b4]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-internal.h, src/lib/ioloop-
	kqueue.c, src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-fd.c,
	src/lib/ioloop-notify-inotify.c, src/lib/ioloop-notify-kqueue.c,
	src/lib/ioloop-notify-none.c, src/lib/ioloop-poll.c, src/lib/ioloop-
	select.c, src/lib/ioloop.c, src/lib/ioloop.h:
	Don't break if io_remove() or timeout_remove() are called for non-
	active ioloops.
	[2c111b572eee]

2008-10-24  Sascha Wilde  <wilde@intevation.de>

	* src/deliver/Makefile.am, src/deliver/auth-client.c, src/deliver
	/auth-client.h, src/deliver/deliver.c, src/lib-auth/Makefile.am, src
	/lib-auth/auth-master.c, src/lib-auth/auth-master.h:
	New generic userdb lookup api `auth-master' in lib-auth.
	[f97099eb4dee]

2008-10-31  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	dump-capability: Previous change was done badly, retry.
	[58afb62be4e0]

	* src/master/master-settings.c:
	dump-capability: Added a fake home directory so we won't die if it's
	missing.
	[281ef8e9863f]

	* src/plugins/acl/acl-mailbox-list.c:
	Fix to previous ACL fix..
	[ca4e277a6615]

	* src/plugins/acl/acl-mailbox-list.c:
	ACL: If a subscribed mailbox doesn't have list right, show it as
	non-existing.
	[692aac54ae1c]

2008-10-30  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Update dovecot-example.conf comment about dict proxy.
	[7c615ac48711]

	* src/auth/db-checkpassword.c, src/lib-dict/dict-file.c, src/lib-
	storage/mailbox-uidvalidity.c:
	Compiler warning fixes
	[54ff30d93cab]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	mbox: Another From_-line skipping fix.
	[35e770620a2b]

2008-10-29  Timo Sirainen  <tss@iki.fi>

	* src/master/sysinfo-get.c:
	dovecot -n/-a: Added Gentoo check.
	[a66bd1e629a2]

	* src/master/sysinfo-get.c:
	dovecot -n/-a: Fixes to printing which filesystem is being used.
	[125e530609d4]

	* src/master/sysinfo-get.c:
	dovecot -n/-a: Added more Linux distros.
	[3a0101119ae3]

	* configure.in, src/master/Makefile.am, src/master/main.c, src/master
	/sysinfo-get.c, src/master/sysinfo-get.h:
	dovecot -n/-a: Print some information about the system.
	[5339d2ebeb56]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	mbox: If Content-Length: is correct, don't break if message body
	begins with a From_-line. Based on a patch by Lennart Lövstrand.
	[9873654f9c48]

	* src/plugins/quota/quota.c:
	Quota: If mail_debug=yes, log when quota warning script is executed.
	[1dc1f8163166]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	login: If client pipelines multiple failing auth commands, don't
	stop handling after two.
	[cd83c5dc66d8]

	* src/pop3-login/client.c:
	Minor code cleanup.
	[1d0cff9ae4cd]

	* src/master/mail-process.c:
	master: Set LOCAL_IP environment to mail processes.
	[6503306b19cf]

2008-10-26  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb.c:
	auth_debug_passwords: When converting plaintext password to another
	scheme, log how it's done.
	[88a6a193e288]

	* src/auth/auth-request.c, src/auth/passdb.c:
	auth: original_username should never be NULL, removed all code that
	checks for it.
	[fc5683975951]

	* src/auth/auth-request.c:
	Pass original_username to auth-workers.
	[9f66028a1089]

	* src/auth/passdb.c:
	Don't assume original_username is always set.
	[28867a0ee182]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	Login prcesses: If auth_debug=yes, don't warn about "user" parameter
	being unknown.
	[938700823522]

	* src/plugins/virtual/virtual-mail.c:
	Minor code cleanup.
	[221eb8e4d08e]

	* src/plugins/virtual/virtual-mail.c:
	Virtual mailboxes: One more mailbox_header_lookup_ctx fix.
	[18a7e838e4a7]

2008-10-25  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-mail.c, src/plugins/virtual/virtual-
	storage.c, src/plugins/virtual/virtual-storage.h,
	src/plugins/virtual/virtual-sync.c:
	Virtual mailboxes: Fixes to handling errors.
	[fa564d405f51]

	* src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-sync.c:
	mbox: If mailbox isn't a valid mbox, don't try to sync it when
	closing.
	[1bf3afdd6450]

	* src/imap/cmd-select.c:
	SELECT: If closing old mailbox gives an error, don't crash.
	[672fd089a8f7]

	* src/plugins/virtual/virtual-config.c:
	Virtual mailboxes: Skip non-selectable mailboxes when matching
	wildcards.
	[0ee4090b85fe]

	* src/lib-storage/index/index-mail-headers.c, src/plugins/virtual
	/virtual-mail.c:
	Virtual mailboxes: Don't use virtual mailbox_header_lookup_ctx in
	backend calls.
	[210e2b09d9d4]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/mail-
	storage-private.h:
	Make mailbox_header_lookup_ctx's list of headers available.
	[13418c67c683]

	* src/lib-storage/list/mailbox-list-fs-iter.c, src/lib-storage
	/mailbox-list.c:
	Fixes to mailbox list iteration (fixes some issues with virtual
	mailboxes).
	[3f6fa7862843]

	* src/plugins/virtual/virtual-sync.c:
	Virtual mailboxes: Another crashfix.
	[ba6ec21af651]

	* src/plugins/virtual/virtual-storage.c:
	virtual mailboxes: Potential crashfix.
	[0738739a8152]

	* src/lib-index/mail-index-sync-ext.c:
	Fixed "no extension shrinking" code to work correctly.
	[b41126d4379e]

	* src/imap-login/client-authenticate.c, src/login-common/common.h, src
	/login-common/main.c, src/master/login-process.c, src/pop3-login
	/client-authenticate.c:
	Login processes: If auth_debug=yes, log about received unknown
	passdb extra fields.
	[8fb20b423f8b]

	* src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins/fts-squat
	/fts-backend-squat.c, src/plugins/fts/fts-plugin.c, src/plugins/fts
	/fts-storage.c:
	FTS: If mail_debug=yes, log messages if fts is disabled.
	[16a99d3a34dd]

	* src/lib-storage/mailbox-list.c:
	If a missing home directory is tried to be used, fail the namespace
	creation.
	[c7d14e00c158]

	* src/lib-storage/mail-user.c:
	mail user: Assume an empty home directory is the same as a missing
	one.
	[a3df5b1eac6d]

	* src/master/mail-process.c:
	master: If there's no home directory don't set HOME environment at
	all.
	[8aeff7f48995]

	* src/lib-mail/message-address.c:
	Compiler warning fix.
	[ccc0322c6804]

	* src/master/mail-process.c:
	Give a nicer error message if %h is used while there is no home
	directory.
	[74720db3bef7]

	* src/lib/var-expand.c, src/lib/var-expand.h:
	Added var_has_key().
	[66e0eaf4d536]

	* src/master/main.c:
	master: Don't print "last died with error .." for fatals that were
	from forked child processes.
	[60c48789841b]

2008-10-24  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-fetch.c, src/imap/cmd-select.c, src/imap/imap-fetch.c,
	src/imap/imap-fetch.h:
	QRESYNC: FETCH CHANGEDSINCE and SELECT with modseq shouldn't have
	returned changes with the same modseq.
	[66a792567e59]

	* src/lib-mail/message-address.c:
	Fixed message address assert-crashing if the entire input was
	invalid. Patch by Richard Platel.
	[b62e350500c9]

2008-10-23  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request-handler.c, src/auth/auth-request.c, src/auth
	/auth-request.h:
	Added %k variable to display valid-client-cert status. It expands to
	"valid" or empty.
	[d49aa6720fb2]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/index/shared/shared-storage.c, src/lib-storage/mail-
	storage-private.h:
	Fixed shared mailboxes to work with plugins.
	[8553bb4c53ad]

	* src/lib-mail/rfc822-parser.c:
	rfc822_parse_quoted_string(): Handle folding whitespace.
	[836c8c2b87f5]

	* src/auth/main.c:
	The new checkpassword code was still missing a bit to actually work.
	[62e134c25a5e]

2008-10-22  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.2.alpha3 for changeset 3c8d43f85b1a
	[afdc27e0b665]

	* NEWS, TODO:
	Released v1.2.alpha3.
	[3c8d43f85b1a] [1.2.alpha3]

	* dovecot-example.conf, src/auth/checkpassword-reply.c, src/auth
	/userdb-checkpassword.c:
	Added missing changes to userdb checkpassword.
	[4497c58eaca8]

	* src/auth/auth-worker-server.c:
	Auth worker: Another try at not aborting a lookup too early.
	[284dea506006]

	* src/lib-index/mail-transaction-log-file.c:
	If we detect that transaction log file size is invalid, mark the log
	corrupted.
	[963330c3df1e]

	* src/auth/auth-worker-client.c:
	Auth worker: Don't die after idling one minute. The server process
	decides when to do it.
	[2792b3a9b67a]

	* src/auth/auth-worker-server.c:
	Auth workers: Use one full timeout per worker instead of a waking up
	every minute.
	[2e62e212f8a1]

	* src/auth/auth-worker-server.c:
	Auth worker: Make sure we don't abort a lookup too early.
	[b8b75dcb3531]

	* src/auth/auth-worker-server.c:
	Auth worker: Log if any auth lookups get aborted.
	[9c7c9fa381d4]

	* configure.in, src/auth/Makefile.am, src/auth/db-checkpassword.c,
	src/auth/db-checkpassword.h, src/auth/mech-winbind.c, src/auth
	/passdb-checkpassword.c, src/auth/userdb-checkpassword.c,
	src/auth/userdb.c:
	Added support for userdb checkpassword. Patch by Sascha Wilde.
	[33eae1ca0be0]

	* src/lib/Makefile.am, src/lib/child-wait.c, src/lib/child-wait.h:
	Added API for waiting child processes.
	[3e8f847f68a4]

2008-10-20  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Don't show the WhyDoesItNotWork link if auth_debug=yes already.
	[e4d0ce4d3420]

2008-10-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Maildir: Added more strict asserts.
	[ab22ace44190]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Maildir: Re-read uidlist from the beginning before deciding it's
	corrupted.
	[d3b37327936e]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/login-common/client-common.c, src/login-common/client-common.h, src
	/login-common/common.h, src/login-common/main.c, src/login-common
	/ssl-proxy-openssl.c, src/login-common/ssl-proxy.c, src/login-common
	/ssl-proxy.h, src/master/login-process.c, src/pop3-login/client-
	authenticate.c, src/pop3-login/client.c:
	Login process: Log auth failure reasons better in disconnect
	message. For example if client certs are required it now logs if the
	cert wasn't sent or if the cert was invalid.
	[0db37acdc59f]

	* src/master/auth-process.c, src/master/common.h, src/master/main.c:
	Print a help message about authentication at startup until the first
	successful authentication.
	[d46579bb7a3c]

	* src/deliver/deliver.c, src/imap/main.c, src/lib-dict/Makefile.am,
	src/lib-dict/dict-client.h, src/lib-dict/dict-file.c, src/lib-dict
	/dict-private.h, src/lib-dict/dict.c, src/lib-dict/dict.h,
	src/plugins/expire/expire-tool.c, src/pop3/main.c:
	Added a simple flat file dict backend.
	[9d963e3bbe65]

	* src/plugins/quota/quota.c:
	quota: If quota backend's init() function fails, die without
	crashing.
	[da848018d760]

2008-10-18  Timo Sirainen  <tss@iki.fi>

	* src/plugins/autocreate/autocreate-plugin.c:
	autocreate plugin: Added support for namespaces.
	[e88c6b43665a]

	* configure.in, src/plugins/Makefile.am,
	src/plugins/listescape/Makefile.am, src/plugins/listescape
	/listescape-plugin.c, src/plugins/listescape/listescape-plugin.h:
	Added listescape plugin.
	[0d1bd98a6387]

	* src/util/maildirlock.c:
	maildirlock: Don't use %m format with fprintf(), it's not portable.
	[698fca0d8b0a]

	* configure.in, src/plugins/Makefile.am,
	src/plugins/autocreate/Makefile.am, src/plugins/autocreate
	/autocreate-plugin.c, src/plugins/autocreate/autocreate-plugin.h:
	Added autocreate plugin.
	[f40ebb033a1b]

	* src/plugins/trash/trash-plugin.c:
	Trash plugin: Assign storage to all mailboxes at startup so errors
	are caught immediately. Also previous optimization change broke
	trash plugin when using multiple mail_users. This change fixes it to
	work again.
	[8aa69e3d27ef]

	* src/login-common/master.c:
	login processes: When shutting down, don't die with fd_send() error
	message.
	[6f2bb9f58804]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache.c, src
	/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log-file.c, src/lib-index/mail-transaction-log-
	private.h, src/lib-index/mail-transaction-log.c, src/lib-
	storage/index/maildir/maildir-save.c:
	Fixes to handling "out of disk space/quota" write failures.
	[9ed4ecd4a866]

	* src/imap/cmd-subscribe.c, src/lib-storage/index/shared/shared-
	storage.c, src/lib-storage/list/mailbox-list-subscriptions.c, src
	/lib-storage/mail-namespace.c, src/lib-storage/mail-namespace.h:
	Subscription handling fixes for subscriptions=no namespaces and
	shared mailboxes.
	[4296aa3fbb75]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-
	transaction-log-view.c:
	index files: Another try at fixing handling log files with different
	header sizes.
	[4402563ad86e]

	* src/lib-index/mail-transaction-log-view.c:
	index files: Fix for handling two log files with different header
	sizes.
	[fd351312dedb]

	* src/lib-storage/index/maildir/maildir-save.c:
	maildir: Crashfix on some save failures (e.g. over quota).
	[5e79a333954d]

	* src/plugins/trash/trash-plugin.c:
	Trash plugin: Small optimization.
	[944f709797df]

	* src/plugins/quota/quota-storage.c:
	quota: Previous dict quota fix broke trash plugin.
	[f21c6ade6e7f]

	* src/deliver/auth-client.c:
	deliver: Log an error if auth lookup fails unexpectedly.
	[95437a2d0136]

	* src/deliver/deliver.c:
	deliver: Fixed quota_full_tempfail=no parsing.
	[d956f79228da]

2008-10-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-strmap.c:
	uninitialized variable fix
	[1e0b1888a876]

2008-10-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-fields.c:
	cache file: Don't crash if file has no fields.
	[a0c05c33f838]

	* src/lib-dict/dict-sql.c:
	dict-sql: Fixed sorting by key.
	[3e34e1816ac1]

	* src/lib-mail/istream-header-filter.c:
	Added asserts.
	[116202a99576]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	mbox: Replaced EBADMSG errno for invalid mboxes with EINVAL to fix
	compiling with OpenBSD. The errno is used only for logging purposes
	so it doesn't really matter what it is.
	[444f0d5bfcbc]

	* src/lib-dict/dict-sql.c:
	dict-sql: atomic_inc() didn't work right with negative values.
	[6b23fa31c553]

	* src/lib-mail/message-header-parser.c, src/lib/istream.c:
	Added asserts.
	[943955343653]

	* src/plugins/quota/quota-storage.c:
	dict quota: Don't crash when recalculating quota (and quota warnings
	enabled).
	[dcc80beecb40]

	* src/deliver/deliver.c:
	deliver: Expand variables in namespace prefix.
	[0a8320a714b5]

2008-10-15  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c, src/imap/imap-sync.c:
	FETCH MODSEQ (n) was missing parenthesis.
	[242e6d47f790]

2008-10-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c:
	Cache file was never updated if the file existed but index didn't
	have cache extension.
	[40df4d4cced0]

	* src/lib-storage/list/mailbox-list-fs-iter.c:
	mbox: Fixed listing mailboxes in namespaces with prefix beginning
	with '~' or '/'.
	[434a8a0edc0a]

	* TODO:
	Updated TODO.
	[e18adf3003a4]

2008-10-12  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-sync.c:
	Virtual mailboxes: Crashfix with more than one backend mailbox.
	[3a579de74dae]

	* src/plugins/virtual/virtual-config.c:
	Virtual mailboxes: Configuration parsing fix.
	[399bf5883beb]

	* src/plugins/virtual/virtual-config.c, src/plugins/virtual/virtual-
	storage.h, src/plugins/virtual/virtual-sync.c:
	Virtual mailboxes: If CRC32 of the search strings changes, rebuild
	the mailbox.
	[eb320fbb87f0]

	* src/lib/crc32.c, src/lib/crc32.h:
	Added crc32_[str_]more().
	[3d2736ece94a]

	* src/lib-index/mail-transaction-log.h:
	Comment update.
	[47edfe6ad295]

	* src/lib-dict/dict-sql.c:
	dict-sql: Dictionary iteration fixes.
	[72b7277aefb3]

	* src/lib-storage/mail-storage.c, src/lib/file-lock.c, src/lib/file-
	lock.h:
	Moved file lock type string parsing code to file-lock.c
	[f472f9ad69be]

	* src/lib/str.c, src/lib/str.h:
	Added t_str_new_const().
	[c1568782774e]

2008-10-11  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-vpopmail.c:
	vpopmail: Use pw_flags field if vpopmail has it.
	[b51344f37d88]

	* src/auth/passdb-vpopmail.c:
	vpopmail: Improve imap/pop3 disabled error message.
	[7f7cef2b5552]

	* src/lib-storage/Makefile.am, src/lib-storage/index/dbox/dbox-
	index.c, src/lib-storage/index/dbox/dbox-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-storage/mailbox-
	uidvalidity.c, src/lib-storage/mailbox-uidvalidity.h:
	Maildir/dbox: Try harder to assign unique UIDVALIDITY values to
	mailboxes.
	[110afc84fbb1]

2008-10-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-mail.c, src/lib-storage/mail-
	storage.h, src/pop3/client.c:
	pop3+maildir: Make sure virtual sizes always get written to dovecot-
	uidlist file.
	[4dc07239ddfa]

2008-10-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mailbox-list.c:
	Shared mailboxes: Don't crash in some systems when debug logging
	NULL root_dir.
	[7db59981c1a0]

	* src/lib-storage/index/shared/shared-list.c:
	Some fixes to shared namespace listing code.
	[d30f0525d457]

	* src/auth/db-ldap.c:
	LDAP: If auth request queue is full, log how long ago the first
	request was added.
	[6e1d0ae97963]

2008-10-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/checkpassword-reply.c:
	checkpassword: Allow setting uid/gid in userdb_uid and userdb_gid
	environment.
	[a38778911fa9]

	* src/lib-storage/index/shared/shared-storage.c:
	Shared mailboxes: First mailbox access failed if virtual separator
	didn't match real separator.
	[c465b10a76fd]

2008-10-06  Timo Sirainen  <tss@iki.fi>

	* src/plugins/expire/expire-plugin.c:
	Expire plugin was crashing because of previous change.
	[c9b9b551eb3f]

	* src/auth/passdb-pam.c:
	Solaris: Compile fix for previous PAM changes.
	[533b43760eaa]

	* src/auth/passdb-pam.c:
	PAM: Attempt to give better error messages. Detect missing
	/etc/pam.d/service file and log it as an error the first time after
	startup. Don't return "unknown user" and "password mismatch" as
	errors but informational messages.
	[26e7d4905d81]

2008-10-05  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	Maildir++ quota: If there are no limits, write "0S" as the file
	header.
	[750ca24835c4]

	* .hgtags:
	Added tag 1.2.alpha2 for changeset 140688a281c2
	[8a0e9dfb0729]

	* configure.in:
	Released v1.2.alpha2.
	[140688a281c2] [1.2.alpha2]

	* TODO:
	Updated TODO.
	[a43b7da805f8]

	* src/plugins/quota/quota-maildir.c:
	Maildir++ quota: Fixed maildirsize recalculation when quota limits
	were read from the file.
	[8e5fd70ea3be]

	* src/plugins/quota/quota-maildir.c:
	Maildir++ quota: If there'a s "*" quota rule with 0 limits, keep the
	quota up-to-date anyway.
	[2b39142e6430]

	* src/lib-storage/index/mbox/mbox-save.c:
	mbox: Don't crash if saving fails because of write error (out of
	disk space).
	[327c893590c3]

	* src/plugins/expire/expire-plugin.c, src/plugins/expire/expire-
	tool.c:
	expire plugin: Fixes for using namespace prefixes.
	[9cabb706d3df]

	* src/master/mail-process.c:
	Don't expand ~/ in mail_location or namespace location. lib-storage
	does that expansion in any case and this is kind of a kludgy
	workaround to allow expire-tool to work by letting it expand the ~.
	[7038df7f5d34]

	* src/plugins/expire/expire-tool.c:
	expire-tool: More logging improvements.
	[9bc8264d3d00]

	* src/plugins/expire/expire-tool.c:
	expire-tool: --test now shows the username in info messages.
	[cc5e5c43ebfe]

	* NEWS:
	Updated NEWS file.
	[d6d7a56f7160]

	* src/util/logview.c:
	logview: Crashfix for CPUs requiring proper alignment.
	[93e01a80cb8e]

	* src/lib-mail/message-parser.c:
	Earlier changes broke message parsing near EOF.
	[5adb665bfc0c]

	* src/lib-storage/index/index-mail.c:
	Increased initial "mail" memory pool size.
	[4b9a7920e774]

	* src/plugins/fts-squat/squat-trie.c:
	fts squat: Some error handling fixes fixes.
	[87936290b682]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	mbox: Potential crashfix after "next message unexpectedly lost"
	failures.
	[4d40d93842e3]

	* src/login-common/sasl-server.c:
	Mention mail_max_userip_connections setting in the log message if
	the limit is exceeded.
	[b7cbf648228f]

	* src/plugins/quota/quota.c:
	Changed the default "quota exceeded" error message.
	[cf74d1e2a458]

	* src/dict/main.c:
	dict: Register dicts only after loading modules. This allows using
	SQL drivers from modules.
	[5ed1662b3f5e]

	* src/plugins/acl/acl-backend.c:
	ACL plugin: ACL groups weren't strdup()ed so they were pretty much
	broken.
	[c283babd0ab1]

	* src/dict/dict-server.c:
	dict: Previous changes caused it to fail with "Socket already
	exists".
	[3718d603f9d0]

	* src/lib/file-set-size.c:
	Removed posix_fallocate() failure check for AIX. Apparently it can
	fail in multiple ways, so we now rely on configure to catch the
	problem.
	[c9efd231a97f]

	* configure.in:
	Test if posix_fallocate() works already in configure.
	[9886bf0a4c40]

	* configure.in:
	configure: create test files with mode 0600.
	[3e493fd3a9fa]

	* src/lib-storage/index/mbox/mbox-sync.c:
	mbox: last-uid field wasn't being updated in X-IMAP[base]: header.
	[fe97a84145f9]

	* src/login-common/ssl-proxy-openssl.c:
	Log a better error message if ssl_cert_file doesn't point to a valid
	certificate.
	[7ac86b33ad64]

	* src/master/child-process.c:
	If a process dies because it's out of memory, mention *_process_size
	setting in the error message.
	[66ecd60b7ea2]

2008-10-01  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	If we reached max_mail_processes limit, mention the setting in the
	error message.
	[1155c1f7fed8]

2008-09-29  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c, src/deliver/deliver.h:
	deliver: tried_default_save variable is now global.
	[f6ef01a25db9]

	* src/deliver/deliver.c, src/deliver/deliver.h:
	deliver: Moved mailbox autocreate/autosubscribe settings to struct
	deliver_settings.
	[8e5c93f37e48]

2008-09-27  Timo Sirainen  <tss@iki.fi>

	* src/auth/main.c, src/dict/dict-server.c, src/lib/network.c,
	src/lib/network.h, src/lib/unix-socket-create.c, src/master/dict-
	process.c:
	Added net_listen_unix_unlink_stale() and use it where needed to
	avoid code duplication.
	[ec83f6dcb585]

2008-09-24  Timo Sirainen  <tss@iki.fi>

	* doc/Makefile.am:
	Added missing dovecot-dict-sql-example.conf to Makefile.
	[2df7a88a5458]

	* src/auth/passdb-bsdauth.c, src/auth/passdb-checkpassword.c, src/auth
	/passdb-ldap.c, src/auth/passdb-pam.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-sia.c, src/auth/passdb-sql.c, src/auth/passdb-vpopmail.c,
	src/auth/passdb.c, src/auth/userdb-ldap.c, src/auth/userdb-nss.c,
	src/auth/userdb-passwd-file.c, src/auth/userdb-passwd.c, src/auth
	/userdb-prefetch.c, src/auth/userdb-sql.c, src/auth/userdb-static.c,
	src/auth/userdb-vpopmail.c, src/auth/userdb.c:
	Separate "unknown passdb/userdb X" and "support for X not compiled
	in" error messages.
	[c47b78e843aa]

2008-09-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	mbox: Give an error if trying to use "mbox:INBOX=.." as mail
	location.
	[11ff5d768660]

2008-09-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction-view.c:
	Transaction view: If index is reset, lookup_first() shouldn't return
	old sequences.
	[c0888db40086]

	* src/lib-index/mail-index-transaction-view.c:
	Transaction view: If index is reset, don't return old to-be-removed
	sequences.
	[76425554b4bc]

	* src/lib-index/mail-index-transaction-view.c:
	Transaction view: get_message_count() returned one too few when
	there were new messages.
	[ffefb9074966]

	* src/plugins/acl/acl-backend-vfile-acllist.c, src/plugins/acl/acl-
	backend-vfile.c:
	ACL: Handle shared namespaces.
	[909ed7cd98a5]

	* src/lib-storage/index/shared/shared-list.c:
	Shared namespace: If we don't have a directory, return NULL instead
	of panicing. The callers are now expected to handle returned NULLs.
	In future some other non-filesystem based storages will probably
	also return NULLs.
	[fd4091d53627]

	* src/lib/istream.c:
	istream: Fix to previous error handling changes.
	[1ea7d60cf39a]

	* src/plugins/quota/quota-maildir.c:
	Maildir++ quota: Create the missing directory using the correct
	permissions.
	[329d8757e5c2]

	* src/plugins/quota/quota-maildir.c:
	Maildir++ quota: If directory for maildirsize doesn't exist, create
	it.
	[f67d4a0d423b]

	* src/lib/file-set-size.c:
	AIX: Silently ignore posix_fallocate() failures.
	[2442529e4cec]

	* src/lib/mempool-alloconly.c, src/lib/mempool-system-clean.c, src/lib
	/mempool-system.c:
	If memory allocation fails, log how large allocation we were trying
	to do.
	[53ad035a2d0b]

	* src/plugins/fts-squat/fts-backend-squat.c, src/plugins/fts-squat
	/squat-test.c, src/plugins/fts-squat/squat-trie-private.h,
	src/plugins/fts-squat/squat-trie.c, src/plugins/fts-squat/squat-
	trie.h, src/plugins/fts-squat/squat-uidlist.c:
	Squat: Create files with the correct mode and group.
	[b62042ddb79e]

2008-09-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-sql-settings.c:
	Don't use uninitialized variable for allocating initial array size.
	[f643f8c0e29d]

	* src/lib/istream.c:
	i_stream_close(): EBADFD doesn't exist everywhere, use ENOENT
	instead.
	[fb0691b3de71]

2008-09-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-address.c:
	message address parser: Fixed some assert-crashes.
	[79b29796d239]

2008-09-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c:
	header filter istream: Fixed previosly added assert.
	[979ce2cb7517]

2008-09-13  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb.c:
	DIGEST-MD5 auth: Hash generation from plaintext passwords wasn't
	done with the original username.
	[b0d72f3eaacd]

	* src/lib-index/mail-index-transaction-view.c:
	Transaction view: One more try at really fixing lookup_ext()..
	[94c751fa58e3]

	* doc/dovecot-sql-example.conf:
	dovecot-sql-example.conf: Note that MySQL supports multiple host
	parameters.
	[b50faeeefb4c]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-file.c:
	mbox: Log mbox file path for "Unexpectedly lost .." errors.
	[264f493b1575]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib/istream-concat.c, src/lib/istream-
	crlf.c, src/lib/istream-file.c, src/lib/istream-limit.c, src/lib
	/istream-mmap.c, src/lib/istream-seekable.c, src/lib/istream-tee.c,
	src/lib/istream.c, src/plugins/zlib/istream-zlib.c:
	Input streams: Improved error handling and added more asserts.
	[40a07553606c]

	* src/lib-index/mail-index-transaction-view.c:
	Transaction view: Fix for the previous lookup_ext() fix.
	[413c70b0ae1d]

	* src/lib/istream.c:
	i_stream_read_data(): Error handling fixes.
	[1ee313158639]

	* src/lib-storage/index/index-sort-string.c:
	Sort indexes: Don't assert-crash with broken sort IDs.
	[b3fb8215a339]

2008-09-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction-view.c:
	Transaction view: lookup_ext() crashed if extension was just being
	added within the transaction.
	[32aa972895cc]

	* src/auth/mech-gssapi.c:
	GSSAPI: stdlib.h wasn't included with all OSes, causing crash at
	startup with 64bit systems.
	[f14e68845b6b]

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache.c:
	Mail cache: If locking failed, the next time try to lock it only
	once. Also increased the first timeout to 10 seconds.
	[9902de77194e]

	* src/lib-index/mail-cache.c:
	Mail cache: Don't warn if dotlocking fails due to timeout (non-
	dotlocking already didn't).
	[7528e7256a1a]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c:
	Mail cache compression: If we can't get lock immediately, do it
	later.
	[2db48458d73b]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c:
	Mail cache: lock_method=dotlock could have caused a process to
	deadlock with itself.
	[f1203dce2d8c]

	* src/lib-storage/index/maildir/maildir-save.c:
	Maildir saving: If uidlist locking timed out and we needed it, fail
	instead of trying to continue (and break).
	[2358ee07d2db]

2008-09-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c:
	Don't try to allocate too much memory if extension intro had too
	high ext_id.
	[28abdf929037]

	* src/lib/file-dotlock.c:
	file_dotlock_open_mode(): Log uid/gid in fchown() failures.
	[c22b7db8c173]

2008-09-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache.c:
	Mail cache file: Fix to previous locking changes.
	[da6fd72f8103]

	* src/lib-index/mail-cache-private.h:
	Mail cache file: Changed lock timeout to just 2 seconds. It's better
	to not update cache than waste a lot of time waiting for a lock.
	Also increased staleness timeout to 5 minutes - it's safer that way
	and with the reduced lock timeout doesn't matter as much.
	[4bfe2c1c375f]

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache.c:
	mail_cache_lock(): Return -1 if locking times out. This fixes cache
	compression starting even when locking timed out.
	[5c0c674eae1a]

	* src/lib-index/mail-index-sync-ext.c:
	Don't crash if trying to reset an extension which had a broken intro
	record.
	[f6838eb4e0e6]

	* src/plugins/virtual/virtual-sync.c:
	virtual: STATUS command on a virtual mailbox crashed.
	[414b6a5c35db]

	* src/lib/file-dotlock.c:
	dotlocking: If rename() fails due to ENOENT, show how long we kept
	the lock. Also for all these "replaced/deleted" notifications show
	how long ago the lock was last touched (if it ever was).
	[a6ae37414011]

2008-09-08  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-cache.c:
	ACLs: Negative rights were actually treated as positive rights.
	[bdc3465bb803]

	* src/lib-storage/list/subscription-file.c:
	subscriptins: If r/w fails due to EACCES and mail_debug=yes, log the
	failure.
	[dbf8f0c231a2]

	* src/lib-storage/mail-storage.c:
	If mail_debug=yes, log all permission (and some other) problems
	instead of only giving a generic "Permission denied" (or similar)
	error message.
	[69e933c5cc26]

	* src/lib-storage/list/subscription-file.c:
	Subscriptions file: If read/write fails due to EACCES, give an error
	message that mentions subscriptions.
	[4ff103f5b64c]

2008-09-07  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/shared/Makefile.am, src/lib-storage/index/shared
	/shared-list.c, src/lib-storage/index/shared/shared-storage.c, src
	/lib-storage/index/shared/shared-storage.h, src/lib-storage/mail-
	namespace.c, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/lib-storage/mail-user.c, src/lib-storage/mail-user.h,
	src/lib-storage/register/Makefile.am:
	Added initial support for shared mailboxes. Listing isn't supported
	yet. Each user gets their own hidden namespace created automatically
	when they're accessed the first time.
	[6dd0c6755afe]

	* src/plugins/virtual/virtual-config.c:
	Virtual mailboxes: Fixes to handling invalid configuration.
	[c0a80d6b8ef6]

	* src/lib-mail/message-address.c, src/tests/test-mail.c:
	message address parser: More error handling improvements.
	[60b8c2609087]

	* src/lib-mail/message-date.c:
	message date parser: Fixed parsing last optional fields due to
	previous rfc822 parser changes.
	[3e21ec854acc]

	* src/lib-mail/message-address.c:
	message address parser: Check better if adress is invalid and set
	invalid_syntax.
	[cb01142bb9e8]

	* src/lib-mail/rfc822-parser.c:
	rfc822_parse_[dot_]atom(): Return failure if there isn't at least
	one character.
	[55871f3b4481]

	* src/lib-mail/message-address.c:
	message address parser: Handle errors better, fix crash in previous
	change.
	[99704b6b8dde]

	* src/lib-mail/message-address.c, src/lib-mail/message-address.h:
	message address parser: Set invalid_syntax=TRUE if the input is
	invalid.
	[a1f6c93afbc2]

	* src/plugins/acl/acl-api-private.h, src/plugins/acl/acl-api.c,
	src/plugins/acl/acl-api.h, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/acl/acl-mailbox-list.c, src/plugins/acl/acl-plugin.h,
	src/plugins/acl/acl-storage.c:
	acl: Fixed handling 'k' right. Although box/child creation was
	prevented, box/child/child wasn't.
	[459c4c496983]

	* src/pop3/commands.c:
	pop3: Don't crash in UIDL command.
	[314fab62b3d1]

2008-09-05  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	Added a special userdb_import field to add TAB-separated fields to
	userdb reply.
	[498dd1ec2b93]

	* .hgtags:
	Added tag 1.2.alpha1 for changeset eaa3469db1dd
	[19da1a89be5a]

	* configure.in:
	Released v1.2.alpha1.
	[eaa3469db1dd] [1.2.alpha1]

	* src/lib-index/mail-index-strmap.c:
	strmap: Don't check conflicts for strings known to be unique.
	[e76d8777d20c]

	* src/lib-storage/index/index-thread.c:
	thread indexes: Removed debugging code.
	[f6f2af2db365]

	* NEWS, TODO:
	Updated TODO and NEWS.
	[ad3ac0cb4573]

	* src/imap/cmd-close.c:
	CLOSE: Don't send any mailbox changes or HIGHESTMODSEQ to client.
	Also the previous code wasn't really even closing the mailbox.
	[5ca8140fcc95]

	* src/lib-storage/index/index-thread.c:
	thread indexes: Forgot to commit strmap syncing in some situations.
	[f77a285629a5]

	* src/lib-index/mail-index-strmap.c, src/lib-storage/index/index-
	thread.c:
	strmap: Make sure the records array is always zero-terminated.
	[b8feb139cf92]

	* src/lib/hash2.c:
	hash2: minor code cleanup.
	[f15ce57d84d1]

	* src/lib/hash2.c:
	hash2_clear() didn't reset deleted_values list, causing bugs later
	on.
	[30fedb49296e]

	* src/lib-storage/index/index-thread.c:
	thread index fixes.
	[9690f8a1d21f]

2008-09-01  Timo Sirainen  <tss@iki.fi>

	* src/lib/hash2.c:
	hash2_remove_iter(): Never resize hash table, otherwise iteration
	breaks.
	[10a5483c0d02]

	* src/lib/hash2.c:
	hash2_remove_iter() was broken when it resized the hash table.
	[7b5120f7f732]

	* src/lib-storage/index/index-thread-links.c:
	Thread indexes: Crashfix.
	[17cec811c5fd]

	* src/lib-storage/index/index-thread.c:
	Thread index: Minor optimization.
	[920c1ca3a8db]

	* src/lib-storage/index/index-thread.c:
	Thread index bugfix.
	[b7e097200892]

	* .hgignore, src/imap/cmd-thread.c, src/lib-index/Makefile.am, src
	/lib-index/mail-hash.c, src/lib-index/mail-hash.h, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index-strmap.c, src/lib-
	index/mail-index-strmap.h, src/lib-index/mail-index.c, src/lib-
	storage/index/Makefile.am, src/lib-storage/index/index-search.c, src
	/lib-storage/index/index-thread-finish.c, src/lib-storage/index
	/index-thread-links.c, src/lib-storage/index/index-thread-private.h,
	src/lib-storage/index/index-thread.c, src/lib-storage/mail-thread.h,
	src/util/Makefile.am, src/util/threadview.c:
	Rewrote thread indexing code. It's a lot simpler and takes less disk
	space. We no longer try to keep a hash table and the entire thread
	tree stored on disk. Instead we keep a simple Message-ID string
	(actually just "uid, ref#" pointer) -> unique index number mapping
	on disk, read it to memory and use it to build the thread tree.
	After the initial build the thread tree is still updated
	incrementally.
	[70b53e9b232e]

	* doc/thread-refs.txt:
	Minor cleanup to thread indexing document.
	[b296beccb70e]

	* src/lib-storage/mail-search.c, src/lib-storage/mail-search.h:
	Added mail_search_args_equal().
	[ea5f84256c3f]

	* src/lib/Makefile.am, src/lib/hash2.c, src/lib/hash2.h:
	Added an alternative hash table implementation.
	[29ed66459a74]

	* src/lib/hash.c, src/lib/primes.c, src/tests/test-lib.c:
	primes_closest(): Use exponentially growing primes.
	[c55a66afddea]

	* src/lib/array.h:
	array_copy() was broken if source array was different from
	destination array.
	[5b845716308d]

2008-08-31  Timo Sirainen  <tss@iki.fi>

	* TODO:
	Updated TODO
	[f8de4a912916]

	* src/lib-storage/index/index-mail-headers.c:
	If imap.envelope is cached, use it instead of rebuilding it.
	[f942af88598b]

	* src/lib-storage/index/index-mail-headers.c:
	Minor code cleanup.
	[e459274fc83f]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/index/raw/raw-storage.c, src/lib-storage/list/mailbox-
	list-fs-iter.c, src/lib-storage/list/mailbox-list-fs.c, src/lib-
	storage/list/mailbox-list-maildir-iter.c, src/lib-storage/list
	/mailbox-list-maildir.c, src/lib-storage/mail-user.c, src/lib-
	storage/mail-user.h, src/lib-storage/mailbox-list-private.h, src
	/lib-storage/mailbox-list.c, src/plugins/mbox-snarf/mbox-snarf-
	plugin.c, src/plugins/trash/trash-plugin.c, src/plugins/virtual
	/virtual-storage.c, src/plugins/zlib/zlib-plugin.c:
	Created mail_user_[try_]home_expand(). Used them for expanding mail
	directories.
	[b2a258213ee0]

	* src/lib-index/mail-transaction-log-file.c, src/lib-index/mail-
	transaction-log-private.h:
	Don't give bogus "log_file_tail_offset shrank" errors.
	[285f636884dc]

	* src/lib-index/mail-transaction-log.h:
	Added padding to struct mail_transaction_log_header so it's 64bit
	aligned. Most compilers did that automatically already.
	[0be9c476acdd]

	* src/lib-index/mail-index-fsck.c:
	index fsck: Don't give bogus "duplicate extension" errors and break
	them.
	[447638ac601a]

	* src/lib-storage/index/maildir/maildir-save.c:
	Added assert.
	[11f07916003a]

	* src/lib-storage/index/index-sync.c:
	DEBUG: Don't verify recent flags if view is already marked
	inconsistent.
	[66dd5f452d32]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-modseq.c,
	src/lib-index/mail-index-modseq.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-view-sync.c:
	Fixed crashes related to struct mail_index_map_modseq handling.
	[32a045eaf6b6]

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-transaction-
	log-append.c, src/lib-index/mail-transaction-log.h:
	Replaced "no extension resizing" flag with "no extension shrinking".
	It fixes some bugs while still handling the original reason it was
	added.
	[b97c3be33b04]

	* src/lib-index/mail-transaction-log-file.c, src/lib-index/mail-
	transaction-log.h, src/util/logview.c:
	Write CPU endianess to transaction log header and check it's correct
	when reading.
	[612eb505775f]

2008-08-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c:
	message parser: Cleaned up the code and another attempt at fixing
	infinite looping.
	[fcf0c5ac5975]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-storage.c:
	mbox: If we detect corrupted cached offsets/sizes, make sure the
	mbox gets resynced.
	[8b0e3e27b551]

	* src/lib-index/mail-index-transaction-view.c:
	mail_index_lookup_ext*() didn't return properly aligned pointers
	with updated transaction views.
	[cf2c4f3c636f]

	* src/deliver/deliver.c:
	deliver: Added -s parameter to autosubscribe to autocreated
	mailboxes.
	[81967ad7098f]

	* src/lib/ostream-file.c:
	ostream: Make sure writing to files always fully succeeds or fails.
	Don't allow partial writes (to NFS).
	[744f9dbff89c]

	* src/imap-login/imap-proxy.c, src/pop3-login/pop3-proxy.c:
	imap/pop3-proxy: If auth_verbose=yes, log proxy login failures.
	[26b67708b365]

	* src/login-common/client-common.c, src/login-common/ssl-proxy-
	openssl.c, src/login-common/ssl-proxy.c, src/login-common/ssl-
	proxy.h:
	login_log_format_elements: Added %k to show SSL protocol/cipher
	information.
	[3917bf9cf311]

	* src/lib-mail/message-parser.c:
	message_parser_init_from_parts(): If parts were broken, we may have
	assert-crashed.
	[d95770cfd935]

	* src/plugins/zlib/istream-zlib.c:
	zlib plugin/bzip2 handling: Update stream's visible fd after
	changing it.
	[3a1e0970d053]

	* src/lib-index/mail-cache-fields.c:
	cache file: Don't crash if fields header offset points outside
	mmapped data.
	[c96d9af856d1]

2008-08-29  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	deliver: If we're dying because we can't write to log file, write
	error to stderr.
	[6665a641780c]

	* src/lib/failures.c:
	If logging failed to info log, try to log a failure to error log if
	it's elsewhere.
	[079ed76a987d]

2008-08-28  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Updated auth_debug_passwords to say that it also turns on
	auth_debug.
	[827c3a3a1627]

	* src/lib-index/mail-index-transaction-view.c:
	mail_index_lookup_seq*() could have returned wrong sequences with
	transaction views. This caused assert-crashes in recent flag
	handling for mbox and maildir.
	[8ac8713b1386]

2008-08-27  Timo Sirainen  <tss@iki.fi>

	* src/plugins/zlib/istream-zlib.c:
	bzip plugin: Seeking streams backwards was broken.
	[74153b8e63a6]

	* doc/dovecot-dict-sql-example.conf, src/dict/Makefile.am, src/lib-
	dict/Makefile.am, src/lib-dict/dict-sql-settings.c, src/lib-dict
	/dict-sql-settings.h, src/lib-dict/dict-sql.c, src/lib-dict/dict.c:
	dict sql: Added configuration for mapping dict paths to SQL fields.
	[2d3e942a4cde]

	* src/plugins/expire/expire-env.h, src/plugins/expire/expire-plugin.c,
	src/plugins/expire/expire-tool.c:
	Expire plugin: Include expire/ in the dictionary path.
	[d630b13ccd60]

	* src/auth/auth-request.c, src/auth/auth-request.h:
	auth: %m variable didn't work with blocking passdbs
	[d49bdda63506]

	* src/dict/dict-server.c:
	dict: Support large iterations by sending data in output stream
	flush callback. Fixes also a hang if a lot of changes were done
	during the iteration.
	[1cf9844b7a20]

	* src/plugins/fts-solr/fts-backend-solr.c:
	fts-solr: Fixed compiling with recent struct mail_user changes.
	[e7929190cd32]

	* src/dict/dict-server.c, src/lib-dict/dict.c, src/lib-dict/dict.h,
	src/plugins/expire/expire-plugin.c, src/plugins/expire/expire-
	tool.c, src/plugins/quota/quota-dict.c:
	dict API: deinit functions now take pointer-to-pointer parameter
	which gets NULLed.
	[b46b0158eb64]

	* src/lib/ostream.h:
	Updated o_stream_flush() comment.
	[dfae8a7d695b]

2008-08-25  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/pop3-login/client.c:
	If client disconnects without any auth attempts, don't log "auth
	failed".
	[16cb3a2b25ab]

	* src/lib-dict/dict-client.c:
	Calling dict_iterate_init() multiple times for a dict assert-
	crashed. Patch by Bernhard Herzog.
	[ad9ad222729c]

2008-08-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/list/mailbox-list-fs-iter.c:
	mail_full_filesystem_access=yes was broken when listing mailboxes.
	[b03b937dadcf]

	* src/lib-mail/message-parser.c:
	Fixed infinite looping when parsing some (not all) broken multipart
	mails that didn't end with proper --boundary--.
	[360ade35792f]

	* src/lib-sql/driver-sqlite.c:
	sqlite crashed with dict server. Patch by Bernhard Herzog.
	[277aadb0ef8c]

2008-08-21  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c:
	ldap: Avoid kqueue/epoll errors when LDAP connection closes
	unexpectedly.
	[06cb6f9d3054]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-internal.h, src/lib/ioloop-
	kqueue.c, src/lib/ioloop-poll.c, src/lib/ioloop-select.c,
	src/lib/ioloop.c, src/lib/ioloop.h:
	Added io_remove_closed().
	[83aef3a6c0a3]

	* src/lib-storage/index/mbox/mbox-sync.c:
	mbox lazy writes: Mark messages dirty when their rewrite is delayed
	to make sure they'll eventually get rewritten.
	[060165bdb0b0]

	* src/master/mail-process.c:
	Don't apply mail_max_userip_connections limit to master user logins.
	[8f0111854933]

2008-08-14  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/imap-proxy.c, src/pop3-login/pop3-proxy.c:
	Proxy: Log destuser in the "proxying" line if it's different from
	username.
	[4d6cc7bb3426]

2008-08-13  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-fs.c, src/plugins/quota/quota-maildir.c,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota.c:
	Fixed FS quota compiling and Maildir++ quota with multiple users.
	[f35a8a3dc06d]

	* dovecot-example.conf, src/auth/mech-gssapi.c, src/auth/mech.c,
	src/master/auth-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Renamed auth_ntlm_use_winbind to auth_use_winbind, which also
	determines if GSS-SPNEGO is handled by GSSAPI or winbind.
	[1f948670f274]

	* configure.in, src/auth/mech-gssapi.c, src/auth/mech.c:
	Support GSS-SPNEGO mechanism if GSSAPI library supports it. Based on
	a patch by Jason Gunthorpe.
	[641d761219a6]

	* dovecot-example.conf, src/auth/mech-gssapi.c:
	Added support for gssapi_hostname=$ALL for multihomed hosts. Patch
	by Jason Gunthorpe.
	[9ca5e8f66d10]

	* src/login-common/client-common.c, src/login-common/client-common.h,
	src/login-common/master.c, src/login-common/master.h, src/login-
	common/sasl-server.c, src/master/login-process.c, src/master/mail-
	process.c, src/master/mail-process.h, src/master/master-login-
	interface.h, src/master/master-settings.c:
	Pass the created mail process PID back to login process so it can
	log it. Added %e log format element for it.
	[29b623366e1e]

2008-08-12  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-fs.c:
	quota-fs: compile fix for previous changes.
	[ceca59aaae89]

	* configure.in:
	Added --with-zlib and --with-bzlib configure options.
	[75b1f16cba72]

	* src/auth/passdb-vpopmail.c:
	vpopmail: Added webmail=ip parameter. Use it for checking
	imap/webmail access.
	[30e4c3360e76]

	* src/login-common/main.c, src/master/login-process.c:
	Master process leaked one fd to login process. Typically it was
	listener fd, which caused imap-login processes existing after
	Dovecot was killed to keep the port reserved so Dovecot couldn't be
	started again.
	[14a061acbb7b]

	* src/plugins/quota/quota-storage.c:
	quota: Fix to previous mailbox deletion fix.
	[7a498b73380c]

	* src/plugins/quota/quota-storage.c:
	quota: Fixed error handling if quota shrinking fails when deleting a
	mailbox.
	[27940e82901e]

	* src/deliver/deliver.c, src/imap/main.c, src/lib-storage/mail-
	namespace.c, src/lib-storage/mail-namespace.h, src/plugins/convert
	/convert-storage.c, src/plugins/convert/convert-tool.c,
	src/plugins/expire/expire-tool.c, src/pop3/main.c:
	Removed pool parameter from mail_namespaces_init*(). Use mail_user's
	pool intead.
	[bf83aa9c3f4a]

	* src/lib-storage/mail-user.c, src/lib-storage/mail-user.h:
	Forgot to add mail-user.* files in previous struct mail_user commit.
	[f12f8c1da0bf]

	* src/lib-storage/mail-storage.h:
	Typofix in comment.
	[bed6d0895dce]

	* src/deliver/deliver.c, src/imap/client.c, src/imap/client.h,
	src/imap/cmd-list.c, src/imap/cmd-namespace.c, src/imap/cmd-
	subscribe.c, src/imap/commands-util.c, src/imap/main.c, src/lib-
	storage/Makefile.am, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-namespace.c,
	src/lib-storage/mail-namespace.h, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/plugins/acl/acl-mailbox-list.c, src/plugins/convert
	/convert-plugin.c, src/plugins/convert/convert-storage.c,
	src/plugins/convert/convert-storage.h, src/plugins/convert/convert-
	tool.c, src/plugins/expire/expire-plugin.c, src/plugins/expire
	/expire-tool.c, src/plugins/imap-quota/imap-quota-plugin.c,
	src/plugins/lazy-expunge/lazy-expunge-plugin.c, src/plugins/quota
	/quota-count.c, src/plugins/quota/quota-dict.c, src/plugins/quota
	/quota-maildir.c, src/plugins/quota/quota-plugin.c,
	src/plugins/quota/quota-plugin.h, src/plugins/quota/quota-private.h,
	src/plugins/quota/quota-storage.c, src/plugins/quota/quota.c,
	src/plugins/quota/quota.h, src/plugins/trash/trash-plugin.c,
	src/plugins/virtual/virtual-config.c, src/plugins/virtual/virtual-
	plugin.c, src/plugins/virtual/virtual-plugin.h, src/plugins/virtual
	/virtual-storage.c, src/pop3/client.c, src/pop3/client.h,
	src/pop3/main.c:
	Added struct mail_user and fixed the code to support multiple users
	per process.
	[db66611fd195]

2008-08-08  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-storage.c, src/plugins/virtual/virtual-
	storage.h:
	virtual mailboxes: Detect loops in virtual mailbox definitions.
	[0d5fba71cb93]

	* src/plugins/virtual/virtual-config.c, src/plugins/virtual/virtual-
	storage.h:
	virtual mailboxes: Added support for using wildcards in mailbox
	names. The wildcards don't span namespaces so that "*" won't also
	match mailboxes in virtual namespace.
	[3aec087609f0]

	* src/lib-storage/list/mailbox-list-maildir-iter.c, src/lib-storage
	/mailbox-list.c, src/lib-storage/mailbox-list.h:
	Added mailbox_list_iter_init_namespaces() for listing mailboxes from
	multiple namespaces. struct mailbox_info now always contains the
	listed namespace.
	[4e1b54eb7407]

	* src/lib-storage/list/mailbox-list-fs-iter.c:
	dbox could have listed INBOX twice.
	[c8d3024015a8]

2008-08-07  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c, src/lib-storage/index/cydir/cydir-save.c, src
	/lib-storage/index/dbox/dbox-file-maildir.c, src/lib-
	storage/index/dbox/dbox-file.h, src/lib-storage/index/dbox/dbox-
	mail.c, src/lib-storage/index/dbox/dbox-save.c, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-mail.h, src
	/lib-storage/index/index-search.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/mail-copy.c, src/lib-storage/mail-search-build.c, src/lib-
	storage/mail-search.h, src/lib-storage/mail-storage-private.h, src
	/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h, src
	/lib-storage/mail.c:
	Added the concept of Global UIDs that are preserved across copies.
	They can be fetched, searched and specified for the save API. dbox
	format supports them correctly, but with maildir the base filename
	is used so maildir_copy_preserve_filename=yes is required to
	preserve GUIDs when copying.
	[6d51328896d6]

	* configure.in, src/lib/compat.c, src/lib/compat.h:
	Added clock_gettime() compatibility function for systems without it.
	[bbfbc84f795c]

	* src/imap/cmd-append.c, src/lib-storage/index/cydir/cydir-save.c, src
	/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/cydir/cydir-storage.h, src/lib-storage/index/dbox
	/dbox-save.c, src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-storage.h, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/raw/raw-storage.c, src/lib-storage/mail-copy.c, src
	/lib-storage/mail-storage-private.h, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h, src/plugins/acl/acl-mailbox.c,
	src/plugins/quota/quota-storage.c, src/plugins/virtual/virtual-
	storage.c:
	mailbox_save_init() API was split to multiple functions. This allows
	adding more parameters easily in future.
	[8a068f879cd1]

	* src/lib-storage/index/index-search.c:
	INTHREAD search may have failed randomly.
	[05565bfadc6b]

2008-08-06  Timo Sirainen  <tss@iki.fi>

	* src/login-common/main.c:
	login processes: Another try at setting the correct fd limit.
	[f27ecc07d93a]

	* src/login-common/main.c:
	Reverted previous change, it wasn't correct..
	[f6cff15160d4]

	* src/login-common/main.c:
	login processes set their fd limit too low, causing "too many open
	files" errors
	[f39a6be7d42a]

2008-08-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-sort-string.c:
	sort indexes: One more assert-crashfix when renumbering sort IDs.
	[7e3590da43a9]

2008-08-04  Timo Sirainen  <tss@iki.fi>

	* src/auth/main.c:
	dovecot-auth: Give a nice error message if you try to run it
	manually.
	[6396a64b0fcb]

	* configure.in, src/auth/mech-gssapi.c, src/master/auth-process.c:
	gssapi: Make auth_krb5_keytab work by calling
	_register_acceptor_identity() instead of relying on KRB5_KTNAME
	environment to be picked up.
	[9569038e0816]

	* src/lib-index/mail-index-fsck.c:
	Index fsck crashfix / cleanup.
	[6319603ffa70]

	* src/util/maildirlock.c:
	maildirlock: Do IPC with pipes instead of with signals. Fixes race
	conditions. Based on patch by Kyle Wheeler.
	[28b1c4f68c9f]

	* src/lib/hostpid.c:
	hostpid_init(): If called again, update the hostname/pid.
	[c832be51c7ac]

	* src/auth/mech-cram-md5.c:
	Don't call hostpid_init(), it's always called at startup anyway.
	[02c6ce8d4fef]

	* src/imap/client.h, src/imap/cmd-select.c, src/imap/cmd-store.c:
	imap: Try to allow STORE for read-only mailboxes, but not for
	EXAMINEd.
	[f7cbcd15ef2c]

	* src/master/main.c:
	Master could have crashed if auth process died too early and not log
	the reason.
	[a69c49565a5b]

	* src/lib-storage/index/mbox/mbox-save.c:
	mbox: Saving may have truncated the mail being saved.
	save_continue() must not return if there's still data to be saved
	and index_mail_cache_parse_continue() may read more of it, so make
	sure after calling that the save input is handled.
	[7f1389badb4c]

	* src/lib-index/mail-index-fsck.c:
	Index opening: If there's broken index and no .log, don't crash.
	[4bfe7618743e]

2008-07-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-db.c:
	dict-db: Don't assume bdb returns aligned memory addresses.
	[25ff4c990c23]

	* src/auth/userdb-prefetch.c:
	userdb prefetch: Userdb lookups shouldn't log the "passdb didn't
	return userdb entries" since there was no passdb lookup at all. But
	log it anyway when auth_debug=yes.
	[17d8b197641b]

	* src/auth/passdb-checkpassword.c:
	checkpassword: Set TCPLOCALPORT and TCPREMOTEPORT environments.
	[2fc09774bc02]

	* src/lib-storage/index/mbox/mbox-file.c:
	mbox: Fixed assert-crash with read-only mbox streams (e.g. zlib
	plugin)
	[f30268333748]

	* configure.in, src/master/main.c:
	Don't list checkpassword as a userdb, since it isn't one.
	[1894a0b4957d]

2008-07-22  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	deliver: Fixed reading namespace settings.
	[1b22f5e61136]

2008-07-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	mbox: Fixed a rare assert-crash with \Recent flag handling.
	[d8a22a7f8b08]

	* src/lib-storage/index/index-mail.c:
	Fixed a potential crash if message parsing failed while fetching
	bodystructure.
	[ab7ad44d709a]

	* src/plugins/fts-lucene/Makefile.am, src/plugins/fts-
	solr/Makefile.am, src/plugins/fts-squat/Makefile.am,
	src/plugins/fts/Makefile.am:
	Symlink FTS plugins to pop3 directory too.
	[0cf12f30985f]

	* src/plugins/zlib/Makefile.am:
	zlib: Install the plugin also to pop3 directory.
	[ba857d9b5f77]

	* configure.in:
	s/zlib/bzlib/ in HAVE_BZLIB description.
	[e2f3b5bd0e47]

	* src/lib-storage/mailbox-list.c:
	Compiler warning fix.
	[63bd99cb4c97]

	* src/plugins/zlib/istream-bzlib.c:
	bzlib: Include stdio.h in case bzlib.h needs it.
	[965f8809d30c]

	* configure.in:
	Check that libbz2 has correct functions. Old versions had different
	names.
	[8afc9ddd723e]

	* src/lib-index/mail-index-transaction.c:
	If UIDVALIDITY changes and view hasn't noticed it yet, don't assert-
	crash when saving messages.
	[f0ca5110b99d]

	* src/lib/mountpoint.c:
	AIX compiling fix.
	[56c0494d8c49]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/mbox-sync-parse.c, src/plugins/virtual/virtual-storage.c:
	A few more fixes to previous mailbox_keyword_is_valid() commit.
	[b40e772d2e2c]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/raw/raw-storage.c, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h:
	Added mailbox_keyword_is_valid().
	[0e7a9547be83]

	* src/util/Makefile.am, src/util/maildirlock.c:
	Compiling fix.
	[4de1590878ea]

	* doc/Makefile.am, src/plugins/fts-solr/Makefile.am:
	solr-schema.xml move was forgotten from Makefiles.
	[f118ee90ab21]

	* src/plugins/quota/quota-fs.c:
	Solaris fs quota may have closed fd 0.
	[ccf59801b63c]

2008-07-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/cydir/cydir-save.c, src/lib-
	storage/index/cydir/cydir-storage.h, src/lib-storage/index/dbox
	/dbox-save.c, src/lib-storage/index/dbox/dbox-storage.h, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.h, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/plugins/acl/acl-
	mailbox.c, src/plugins/quota/quota-storage.c, src/plugins/virtual
	/virtual-storage.c:
	mailbox.save_init() API now takes ** pointer to dest_mail, so
	multiple plugins can safely specify it. ctx->dest_mail also gets
	updated then.
	[dc280df713f4]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/list/mailbox-list-fs.c, src/lib-
	storage/list/subscription-file.c, src/lib-storage/mailbox-list.c,
	src/lib-storage/mailbox-list.h, src/plugins/quota/quota-maildir.c:
	Use permissions based on mail root directory when creating new
	files/dirs under it.
	[ab1c170b1559]

	* src/lib/file-dotlock.c, src/lib/file-dotlock.h:
	Added file_dotlock_open_mode().
	[b3303b65c3f2]

	* src/lib/mkdir-parents.c, src/lib/mkdir-parents.h:
	Added mkdir_parents_chown().
	[ed12eee73357]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/list/mailbox-list-fs.c, src/lib-
	storage/list/subscription-file.c, src/lib/mkdir-parents.c, src/lib
	/mkdir-parents.h, src/plugins/fts-lucene/fts-backend-lucene.c:
	mkdir_parents() API was sometimes assumed to return EEXIST and
	sometimes not. Standardized it now so that the API does return
	EEXIST.
	[b3efdd9dc293]

	* src/lib-storage/mailbox-list.c:
	If mail_debug=yes: Log which per-namespace file permissions are
	used.
	[38897ffeec2d]

	* src/lib/safe-mkstemp.c:
	safe_mkstemp(): If fchown() fails, log the used uid/gid.
	[fa2bd47fc59c]

	* src/plugins/quota/quota-fs.c:
	fs quota: Don't crash if some mail storages are outside known
	mountpoints.
	[be8550f51b02]

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota-fs.c:
	Use quota->debug instead of getenv()ing it every time.
	[7fdb5f222d95]

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-fs.c, src/plugins/quota/quota-maildir.c,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota.c:
	FS quota: Handle quota only for the quota roots which apply to the
	mailbox when there are multiple roots. With a single quota root the
	check is usually unnecessary. Based on patch by Ralf Becker.
	[796307638449]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Maildir: Create maildirfolder using the same permissions as dovecot-
	shared.
	[ea4821b4e29a]

	* src/auth/db-ldap.c, src/auth/db-sql.c, src/dict/main.c, src/imap
	/cmd-fetch.c, src/imap/commands.c, src/imap/imap-fetch.c,
	src/imap/main.c, src/lib-index/mail-index-transaction.c, src/lib-
	index/mailbox-list-index.c, src/lib-otp/otp-parity.h, src/lib-sql
	/driver-sqlite.c, src/lib-storage/index/mbox/mbox-lock.c, src/login-
	common/client-common.c, src/plugins/convert/convert-storage.c,
	src/plugins/quota/quota-maildir.c, src/pop3/main.c:
	extern/static fixes (from a sparse check by Diego Liziero)
	[62cf70991cf2]

	* src/lib-index/mail-cache-fields.c, src/tests/test-lib.c:
	Compiler warning fixes.
	[ff6ccf848cc1]

	* src/lib-storage/index/index-mail.c:
	Maildir: If uidlist couldn't be locked while saving, we might have
	assert-crashed afterwards when trying to update cache file for the
	newly saved message whose index update was already cancelled.
	[09295548c123]

	* src/deliver/deliver.c:
	deliver: Save mails to namespace prefix to INBOX instead.
	[8cb32b10a536]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Maildir: Group of the created shared directory wasn't set. Patch by
	Simon Michelson.
	[a90541a1192c]

	* configure.in, src/lib/mountpoint.c:
	mountpoint_get(): Added support for AIX support with mntctl().
	[d1da922a437d]

	* src/plugins/mbox-snarf/mbox-snarf-plugin.c:
	mbox-snarf: Messages weren't sometimes expunged from the source
	mbox, causing duplicates.
	[1f20b78f37d7]

	* src/lib/istream-seekable.c:
	istream-seekable: Log file creation error as creat() failure, not
	open().
	[701828d42e66]

	* src/lib/failures.c:
	Logging: Make sure we don't recurse infinitely when running out of
	memory. Also cleaned up the logging handlers' code a bit.
	[bd0a8f1485b5]

	* src/lib-storage/index/index-sort-string.c:
	SORT: Fixed assert-crash.
	[2621f6f10c2e]

	* src/lib-storage/list/mailbox-list-fs-iter.c:
	fs mailbox layout: Several fixes to handling INBOX listing.
	[4a80a7ec7c6a]

	* src/imap/cmd-list.c:
	LIST didn't show INBOX if list patterns didn't match namespace
	prefix.
	[8b240457c4a4]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Maildir: Check more correctly when we should update/recreate
	uidlist.
	[73b4fe95a6dd]

2008-06-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Recreate dovecot-uidlist if updating it would shrink the file more
	than 25%.
	[cb2650c20a58]

	* src/lib/restrict-process-size.c:
	If process's RLIMIT_NOFILE can't be changed, log an error but don't
	die. Fixes running with Valgrind.
	[7513ad244f0f]

2008-07-20  Timo Sirainen  <tss@iki.fi>

	* src/lib/fdatasync-path.c:
	fdatasync_path(): Ignore EBADF errors, it probably means directory
	fsyncing isn't allowed (e.g. NetBSD).
	[164bdad216b8]

2008-07-19  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c, src/imap/imap-fetch-body.c, src/imap/imap-
	fetch.c, src/imap/imap-sort.c, src/lib-storage/index/cydir/cydir-
	storage.c, src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/index-mail-headers.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/index-search.c, src/lib-storage/index
	/index-storage.h, src/lib-storage/index/index-thread.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/raw/raw-storage.c, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/plugins/virtual/virtual-storage.c:
	struct mailbox_header_lookup_ctx can now be referenced/unreferenced
	so it can be shared among multiple struct mails.
	[2d902d1f8bea]

2008-07-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-copy.c:
	Message copying: Don't save empty mail if input was already read to
	memory.
	[2c1e4f1fc4e0]

	* src/lib-mail/rfc822-parser.c:
	rfc822_parse_phrase(): Don't read outside data boundaries if input
	is empty.
	[289593cceb58]

	* configure.in:
	Removed MIT Kerberos v1.2 check, since Heimdal v1.2 is out and it
	works fine.
	[1d209ee7eead]

	* src/lib/str.c, src/lib/str.h:
	Added str_new_const().
	[b3dd6db685a4]

2008-07-13  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-sort.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-sort.c, src/lib-storage/mail-storage.h,
	src/plugins/fts-solr/fts-backend-solr.c, src/plugins/fts-solr/solr-
	connection.c, src/plugins/fts-solr/solr-connection.h,
	src/plugins/fts/fts-api-private.h, src/plugins/fts/fts-api.c,
	src/plugins/fts/fts-api.h, src/plugins/fts/fts-search.c,
	src/plugins/fts/fts-storage.c, src/plugins/fts/fts-storage.h:
	Added support for sorting by X-SCORE. Currently it's only set by
	fts-solr.
	[0a3b5ddb0869]

	* src/imap/cmd-sort.c:
	SORT: Return BAD if sort program ends with REVERSE.
	[67eb95aa7293]

	* src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins/fts-solr
	/fts-backend-solr.c, src/plugins/fts-squat/fts-backend-squat.c,
	src/plugins/fts/fts-api-private.h, src/plugins/fts/fts-api.c,
	src/plugins/fts/fts-api.h, src/plugins/fts/fts-search.c,
	src/plugins/fts/fts-storage.h:
	fts: Added a new lookup API where the backend can look up all the
	fields using a single query. Implemented it to fts-solr.
	[6418d4c0ff16]

	* doc/solr-schema.xml, src/plugins/fts-solr/schema.xml:
	Moved Solr schema.xml to doc/.
	[d6d7be735b40]

	* src/plugins/fts-solr/fts-backend-solr.c, src/plugins/fts-solr/fts-
	solr-plugin.c, src/plugins/fts-solr/fts-solr-plugin.h, src/plugins
	/fts-solr/solr-connection.c, src/plugins/fts-solr/solr-connection.h:
	fts-solr: Added break-imap-search setting to use Solr with SEARCH
	TEXT/BODY parameters. This makes the SEARCH non-compliant with
	standard IMAP protocol, because TEXT/BODY require support for
	substring searches and Lucene doesn't support them.
	[e814614ffb65]

	* src/plugins/fts-solr/fts-backend-solr.c, src/plugins/fts-solr/solr-
	connection.c:
	fts-solr: Send data to Solr in larger packets. Commit after
	expunges.
	[3fbfdda3e5d3]

	* src/plugins/fts-solr/fts-backend-solr.c:
	fts-solr: Encode entities when indexing data.
	[61be6a4722c5]

	* src/plugins/fts-solr/fts-backend-solr.c, src/plugins/fts-solr/solr-
	connection.c, src/plugins/fts-solr/solr-connection.h:
	fts-solr: Error handling fixes.
	[1ceb49f2eb50]

	* src/plugins/fts-solr/Makefile.am:
	fts-solr: Compiling fixes.
	[c69ccedfaf4a]

2008-07-12  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib-imap/imap-match.c, src/lib/str-find.c:
	Fixed compiling on some older pre-C99 compilers.
	[0d66b44689ee]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Maildir: If filename has CR or LF, log a warning and ignore it
	instead of writing a corrupted dovecot-uidlist.
	[fa90c913eae4]

	* src/deliver/deliver.c:
	deliver didn't expand %variables in namespace location settings.
	[907835a6595c]

	* dovecot-example.conf:
	Another dovecot-db.conf -> dovecot-db-example.conf change.
	[04720c150b72]

	* doc/Makefile.am, doc/dovecot-db-example.conf, doc/dovecot-db.conf:
	Renamed dovecot-db.conf to dovecot-db-example.conf and added it to
	Makefile.
	[8513b6e9608f]

	* src/imap/main.c, src/pop3/main.c:
	imap/pop3: Don't open /dev/urandom at startup. Nothing needs it.
	[b6aea17ce21e]

	* src/plugins/zlib/zlib-plugin.c:
	zlib plugin: Added bzip2 support also for mboxes.
	[b6c6070a38ac]

2008-07-11  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/plugins/Makefile.am, src/plugins/fts-
	solr/Makefile.am, src/plugins/fts-solr/fts-backend-solr.c,
	src/plugins/fts-solr/fts-solr-plugin.c, src/plugins/fts-solr/fts-
	solr-plugin.h, src/plugins/fts-solr/schema.xml, src/plugins/fts-solr
	/solr-connection.c, src/plugins/fts-solr/solr-connection.h,
	src/plugins/fts/fts-storage.c:
	Initial code to support Apache Solr (Lucene indexing server).
	[662172573fe1]

2008-07-10  Timo Sirainen  <tss@iki.fi>

	* src/plugins/zlib/zlib-plugin.c:
	zlib: If gz/bz2 support isn't compiled in but we detect a mail with
	gz/bz2 compression, log an error and fail to read the mail.
	[9369c0190ef0]

2008-07-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-client.c:
	dict-proxy: Fix error message if remote disconnects.
	[e069e4c221e1]

	* src/deliver/deliver.c:
	deliver: Another try at getting LDA settings to override plugin
	settings.
	[a02dd752ef43]

	* doc/dovecot-sql-example.conf, src/auth/db-sql.c:
	Changed SQL's default password scheme to MD5.
	[bcd70b69c7e5]

	* src/auth/passdb-ldap.c:
	ldap: MD5 -> PLAIN-MD5 autoconversion is no longer necessary since
	it's done in the generic MD5 verification code now.
	[a6d187abaa5a]

	* src/auth/password-scheme.c:
	MD5 scheme can now autodetect between MD5-CRYPT and PLAIN-MD5.
	[399b81cc6189]

	* configure.in:
	Removed accidentally committed fts-proxy plugin Makefile generation.
	[ba581bed8cc7]

2008-07-08  Timo Sirainen  <tss@iki.fi>

	* src/util/maildirlock.c:
	maildirlock: Previous implementation wasn't usable - redesigned.
	[140d9f439c0f]

	* configure.in, src/plugins/Makefile.am, src/plugins/zlib/Makefile.am,
	src/plugins/zlib/istream-bzlib.c, src/plugins/zlib/istream-zlib.c,
	src/plugins/zlib/istream-zlib.h, src/plugins/zlib/zlib-plugin.c:
	zlib plugin supports now bzip2 also.
	[bb9d3aabcb61]

	* .hgignore:
	hg: ignore maildirlock
	[b37d5d9b4c0c]

	* .hgignore:
	hg: ignore Info.plist files that OS X creates.
	[3eac38f8d5a4]

	* src/lib/istream.h:
	i_stream_read_data() comment update.
	[6f47263b947b]

	* src/util/Makefile.am, src/util/maildirlock.c:
	Added a new maildirlock utility for write-locking Dovecot MMaildir.
	[fed87704b48a]

	* src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	Maildir: Uidlist stale timeout macro is now globally available.
	[d4b7ef797828]

	* src/lib/file-dotlock.c:
	dotlocking: Small code cleanups.
	[03ab8199bbe1]

	* src/deliver/deliver.c:
	deliver: Allow lda section to override plugin settings.
	[afc0d1197fe8]

	* src/deliver/deliver.c:
	Reverted previous change.
	[6ccb546b9615]

	* src/deliver/deliver.c:
	deliver: Don't let plugin section override other settings (at least
	for now).
	[97f3adc9ac61]

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota.c:
	quota: All backends now take noenforcing parameter.
	[7a6e72d2c599]

	* src/plugins/quota/quota-maildir.c, src/plugins/quota/quota.c:
	maildir: Add ,S=<size> to maildir filename with all quota backends.
	[bc5a85e2b11d]

	* src/lib-dict/dict-client.c:
	Set dict proxy istream nonblocking so EINTR (^C) won't crash.
	[2cd775b45b0c]

	* src/lib-sql/driver-pgsql.c:
	pgsql: Don't crash in sync queries if db can't be connected to.
	[47483377feb4]

	* src/lib-sql/driver-pgsql.c:
	pgsql: Don't break with synchronous queries (with dict-sql)
	[6d9f2185b9e0]

2008-07-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-sql.c:
	dict-sql: Only MySQL supports "INSERT .. ON DUPLICATE KEY". With
	others just use the INSERT and let created triggers handle updating
	existing rows.
	[54225d0b6e2b]

2008-07-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-ldap.c, src/auth/passdb-sql.c:
	"Empty password returned without no_password" message ->
	"nopassword".
	[72a560a00def]

2008-07-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-filename.c:
	Maildir: If there are multiple :2,<flags> in filename, use the last
	one both getting and setting the flags.
	[639f6fb48277]

2008-07-02  Timo Sirainen  <tss@iki.fi>

	* doc/thread-refs.txt:
	Updated thread index documentation.
	[7760a30a5f7e]

2008-06-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-file.c:
	Index modseq handling crashfix.
	[465931d0a642]

2008-06-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	Maildir: \Recent flags weren't set correctly if mail was saved
	externally.
	[820cc75d6ccc]

	* src/lib-storage/index/index-thread-finish.c:
	THREAD X-REFERENCES2: Assert-crashfix.
	[ccbbfa63a36e]

	* dovecot-example.conf:
	Removed a comment about [::] maybe listening for IPv4 as well. It
	should listen only on IPv6 on all modern OSes.
	[532e9496fe88]

	* configure.in:
	When checking for -lssl, include -ldl if it exists. OpenSSL 0.9.8
	uses it.
	[adb7d13d7d97]

	* src/plugins/quota/Makefile.am:
	rquota_xdr compilation fixes for AIX (hopefully won't break other
	OSes).
	[22244e559776]

	* src/imap/cmd-fetch.c, src/imap/imap-fetch.c, src/lib-index/mail-
	index-modseq.c, src/lib-storage/index/index-sort-string.c, src/lib-
	storage/index/index-sort.c:
	Memory leak fixes.
	[439636cce455]

2008-06-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-sort-string.c:
	s/reseting/resetting/
	[83019368c9dc]

	* src/lib-storage/index/index-sort-string.c:
	Sort index sometimes failed wrongly with "Sort IDs broken" errors.
	[d75fdd0fb8b2]

	* src/lib-storage/index/index-mail.c:
	Fetch BODYSTRUCTURE: Added missing NIL to the plain reply.
	[01c23befce4f]

	* doc/thread-refs.txt, src/lib-index/mail-hash.c, src/lib-index/mail-
	hash.h, src/lib-storage/index/Makefile.am, src/lib-storage/index
	/index-thread-finish.c, src/lib-storage/index/index-thread-links.c,
	src/lib-storage/index/index-thread-list.c, src/lib-storage/index
	/index-thread-private.h, src/lib-storage/index/index-thread.c:
	Thread index fixes and optimizations.
	[04a3be30e5a6]

	* src/lib-storage/index/index-thread.c:
	Threading: Fixed fallbacking to in-memory hash if the primary hash
	couldn't be updated.
	[5e3b995372d4]

2008-06-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c, src/lib-mail/Makefile.am, src
	/lib-mail/message-decoder.c, src/lib-mail/message-parser.c, src/lib-
	mail/rfc2231-parser.c, src/lib-mail/rfc2231-parser.h, src/tests
	/test-mail.c:
	Merge RFC 2231 header continuations in BODY/BODYSTRUCTURE replies.
	Also use them internally while parsing messages.
	[3412c43d6707]

	* src/lib-imap/imap-bodystructure.c:
	Added missing Content-Language: support for BODYSTRUCTURE.
	[e787f6cae97c]

	* src/imap/imap-fetch.c:
	FETCH BODY/BODYSTRUCTURE failures replied with too many NILs.
	[e29ddf600a09]

2008-06-23  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Include "nss" in dovecot --build-options.
	[cd2789afcb09]

	* configure.in, src/lib/restrict-process-size.c, src/lib/restrict-
	process-size.h, src/master/main.c:
	If core dump limit is 0, add "core dumps disabled" to startup log
	line.
	[aad49536db41]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Maildir: Create maildirfolder file also when dovecot-shared file
	exists when creating new mailboxes.
	[346fb1ff74ed]

2008-06-22  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Removed login_greeting_capability setting, it's no longer used.
	[6d1214687c89]

2008-06-21  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/imap/main.c, src/login-common/client-
	common.h, src/login-common/master.c, src/master/login-process.c,
	src/master/mail-process.c, src/master/mail-process.h, src/master
	/master-login-interface.h:
	Just send CAPABILITY response code for all LOGIN/AUTHENTICATE
	commands. Simplifies things and Lemonade spec specifies it as a
	"MUST be sent" anyway.
	[138a64b6dffe]

	* src/imap-login/client.c:
	Don't drop automatic post-login CAPABILITY reply if client sent
	CAPABILITY command _before_ STARTTLS.
	[80b06754846b]

	* src/master/master-settings.c:
	Don't give a bogus error message if multiple socket listen blocks
	are used.
	[f33e8e801023]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Convert dovecot-uidlist files to new format immediately
	when opening them. Without this it's possible that entries are
	appended to old format uidlist in the new format.
	[87214cbd824c]

2008-06-20  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-squat/squat-trie.c:
	squat: Potential crashfix with mmap_disable=yes.
	[8df17bb25a6e]

	* src/lib-mail/message-parser.c:
	Message parser: Fixed assert-crash if cached MIME structure was
	broken.
	[e06d4049d282]

	* src/plugins/quota/Makefile.am:
	quota: Generated rquota_xdr.c file was missing LF after first
	#include.
	[fd32947addb4]

	* src/lib/restrict-access.c:
	AIX compiling fix.
	[bdc5cf87dbaa]

	* src/lib-index/mail-index-sync-update.c:
	Index files: Fixed reading uninitialized memory when handling
	extension resets generated by older Dovecot versions.
	[9b5040a75f9f]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	mbox: Fixed a crash when adding a new X-IMAPbase: header with
	keywords.
	[5dcc04b62e14]

2008-06-19  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-system-clean.c:
	Don't use malloc_usable_size() for clearing out memory before
	freeing it. It doesn't seem to work perfectly everywhere. Maybe put
	it back at some point.
	[96b8f50c9eea]

2008-06-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-modseq.c, src/lib-index/mail-index-view-
	private.h, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	transaction-log-file.c, src/lib-storage/index/index-status.c:
	View syncing: Keep track of highest modseq in views. If we lose
	transaction log, return all messages with higher modseq than the old
	highest-modseq as having changed. This works better than the
	previous code which compared the old modseq which may have already
	changed after the previous view sync. Return changes based on modseq
	being larger than
	[91758686277a]

	* src/lib-index/mail-index-modseq.c, src/lib-index/mail-index-
	modseq.h, src/lib-index/mail-transaction-log-append.c, src/lib-index
	/mail-transaction-log-file.c, src/lib-index/mail-transaction-log-
	private.h, src/lib-index/mail-transaction-log-view.c,
	src/util/logview.c:
	Keep modseqs as 1 until the first modseq ext intro record enables
	them. Performance should be better again when modseqs are disabled.
	[502cfdcc5650]

	* src/imap/cmd-select.c, src/lib-storage/index/index-status.c, src
	/lib-storage/mail-storage.h:
	CONDSTORE: Return HIGHESTMODSEQ correctly even if indexes are in
	memory.
	[b4286cde68d0]

	* configure.in:
	Renamed --enable-debug to --enable-devel-checks, which describes it
	better.
	[55d1a2bf4573]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/imap/main.c, src/login-common/client-
	common.h, src/login-common/master.c, src/master/login-process.c,
	src/master/mail-process.c, src/master/mail-process.h, src/master
	/master-login-interface.h, src/master/master-settings.c,
	src/pop3-login/client-authenticate.c, src/pop3/main.c:
	Send login command OK reply in IMAP/POP3 process.
	[9e226056a208]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/imap-login/imap-proxy.c,
	src/imap/client.c, src/imap/client.h, src/imap/main.c, src/login-
	common/client-common.h, src/login-common/master.c, src/master/login-
	process.c, src/master/mail-process.c, src/master/mail-process.h,
	src/master/master-login-interface.h, src/master/master-settings.c,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.c,
	src/pop3-login/client.h, src/pop3-login/pop3-proxy.c,
	src/pop3/client.c, src/pop3/client.h, src/pop3/main.c:
	If commands are pipelined after the login command, pass them to the
	IMAP/POP3 process so it can process the command instead of
	discarding it.
	[2351a81ce699]

	* src/lib-storage/index/index-storage.c:
	Make sure the mailbox is opened when enabling modseqs (fixes a
	STATUS crash).
	[187183c360dd]

	* src/lib/istream.c, src/lib/istream.h:
	Added i_stream_add_data().
	[4a166ccec256]

	* configure.in:
	Include ENABLE in banner capabilities, since it can be pipelined
	after login.
	[30871a9961f7]

	* src/imap-login/client.c:
	Don't return BAD if ENABLE command is used in pre-auth state. Just
	ignore it.
	[67a2d45e8e95]

	* configure.in, src/imap-login/client-authenticate.c, src/imap-
	login/client.c, src/imap-login/client.h, src/login-common/common.h,
	src/login-common/main.c, src/master/login-process.c, src/master
	/master-settings-defs.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Removed login_greeting_capability setting. Instead now a minimal
	pre-login capability list is sent in the banner. CAPABILITY command
	still returns a full list. If CAPABILITY command wasn't used, the
	full capability list is sent in LOGIN/AUTHENTICATE tagged OK reply.
	[4b4d2a4423ec]

	* src/imap-login/client.c, src/imap-login/imap-proxy.c:
	Renamed x-local-ip/port to x-connected-ip/port
	[9a7469e52f91]

	* dovecot-example.conf, src/imap-login/client.c, src/imap-login/imap-
	proxy.c, src/login-common/client-common.c, src/login-common/client-
	common.h, src/login-common/common.h, src/login-common/main.c,
	src/master/login-process.c, src/master/master-settings-defs.c,
	src/master/master-settings.c, src/master/master-settings.h,
	src/pop3-login/client.c:
	Support transferring original IPs and ports through IMAP proxies.
	Clients from login_trusted_networks are allowed to override them.
	Dovecot's IMAP proxy sends them via IMAP ID command. They're always
	sent if the remote advertises ID in the banner's CAPABILITY.
	[3644883cf44e]

	* src/auth/auth-request.c, src/lib/network.c, src/lib/network.h:
	Created net_parse_range() from auth code.
	[423b8e3fedbb]

	* src/plugins/virtual/virtual-storage.c:
	virtual: Fixed to work with the previous CONDSTORE commit.
	[b1784b48821d]

	* README, configure.in, dovecot-example.conf, src/imap-login/client.c,
	src/imap-login/client.h, src/imap/Makefile.am, src/imap/client.h,
	src/imap/cmd-id.c, src/imap/commands.c, src/imap/commands.h,
	src/imap/common.h, src/imap/main.c, src/lib-imap/Makefile.am, src
	/lib-imap/imap-id.c, src/lib-imap/imap-id.h, src/master/login-
	process.c, src/master/mail-process.c, src/master/master-settings-
	defs.c, src/master/master-settings.c, src/master/master-settings.h:
	Added support for IMAP ID extension.
	[ca2ff54ee9b4]

	* src/lib-imap/imap-quote.c, src/lib-imap/imap-quote.h:
	Added imap_dquote_append().
	[8f3115354d14]

	* src/lib/strfuncs.c, src/lib/strfuncs.h:
	Added str_array_icase_find().
	[1789ac4637b0]

	* configure.in, src/master/main.c, src/master/master-settings.c:
	Uppercased PACKAGE_NAME macro and started using it in some places.
	[5061533382be]

	* src/imap/cmd-store.c, src/lib-index/mail-index-transaction-
	private.h, src/lib-index/mail-index-transaction.c, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log-append.c, src/lib-
	storage/index/cydir/cydir-storage.c, src/lib-storage/index/dbox
	/dbox-storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-transaction.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/index/raw/raw-storage.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h:
	CONDSTORE: STORE UNCHANGEDSINCE conflicts are now checked
	atomically.
	[e04513064165]

2008-06-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/commands-util.c, src/imap/commands-util.h, src/lib-charset
	/charset-utf8.h, src/lib-imap/imap-bodystructure.c, src/lib-imap
	/imap-bodystructure.h, src/lib-mail/message-header-parser.c, src
	/lib-mail/message-header-parser.h, src/lib-storage/mail-namespace.c,
	src/lib-storage/mail-namespace.h, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h, src/lib-storage/mailbox-list.c, src
	/lib-storage/mailbox-list.h, src/lib/aqueue.h, src/lib/array.c,
	src/lib/array.h, src/lib/buffer.c, src/lib/buffer.h,
	src/lib/crc32.h, src/lib/data-stack.h, src/lib/hash.h, src/lib/hex-
	dec.h, src/lib/istream.c, src/lib/istream.h, src/lib/lib.h,
	src/lib/network.h, src/lib/ostream-file.c, src/lib/ostream-
	internal.h, src/lib/ostream.c, src/lib/ostream.h, src/lib/primes.h,
	src/lib/priorityq.h, src/lib/seq-range-array.h, src/lib/str.h,
	src/lib/strfuncs.h, src/lib/unichar.h, src/lib/var-expand.h, src
	/login-common/client-common.h, src/login-common/login-proxy.c, src
	/login-common/login-proxy.h, src/login-common/ssl-proxy-openssl.c,
	src/login-common/ssl-proxy.c, src/login-common/ssl-proxy.h:
	Added more consts, ATTR_CONSTs and ATTR_PUREs.
	[81806d402514]

	* src/lib/macros.h:
	Added ATTR_PURE macro, which expands to pure attribute if available.
	[3d65aeed7ea0]

	* src/imap/imap-fetch.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-search.c, src/lib-storage/mail-search-build.c,
	src/lib-storage/mail-search.h, src/lib-storage/mail-storage.h,
	src/plugins/virtual/virtual-mail.c:
	FETCH X-MAILBOX and SEARCH X-MAILBOX can be used with virtual
	mailboxes to find out the original mailbox. In non-virtual mailboxes
	they always just use the current mailbox name.
	[c1bbdc2b262e]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-search-
	build.c, src/lib-storage/mail-search.c, src/lib-storage/mail-
	search.h:
	Added non-optimized support for SEARCH INTHREAD.
	[bf9c51edbc66]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-search.c,
	src/lib-storage/mail-search.h, src/lib-storage/mail-storage.c:
	Search code cleanups and minor optimizations.
	[1e69c84a1e5a]

	* src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h:
	Added mailbox_search_result_build().
	[021c39f58af3]

	* src/imap/cmd-thread.c, src/lib-storage/index/index-thread.c, src
	/lib-storage/mail-thread.h:
	Thread code cleanups + fixes
	[d987e018483b]

	* src/lib/seq-range-array.c, src/lib/seq-range-array.h, src/tests
	/test-lib.c:
	Added seq_range_array_have_common().
	[3e8bcf4f6f5e]

2008-06-19  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	deliver: Settings inside protocol imap {} weren't ignored.
	[34085062ad89]

	* src/plugins/fts-squat/fts-backend-squat.c:
	Compiler warning fixes.
	[5e8de444ad43]

	* configure.in, src/plugins/quota/quota-fs.h:
	AIX FS quota: Include sys/fs/quota_common.h
	[34e7c571434d]

	* src/lib/restrict-access.c:
	Compiling fix for AIX.
	[fbbb1cdb2fe9]

	* src/lib-storage/index/mbox/mbox-mail.c:
	mbox: Don't give "Can't find next message offset" warnings when
	(quota) plugin accesses the message being saved.
	[40863bb70e3c]

	* src/lib-storage/index/mbox/mbox-save.c:
	mbox: Don't crash if saving is aborted early.
	[11727b49373e]

2008-06-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search-result.c, src/lib-storage
	/mailbox-search-result-private.h, src/lib-storage/mailbox-search-
	result.c, src/plugins/virtual/virtual-config.c, src/plugins/virtual
	/virtual-storage.c, src/plugins/virtual/virtual-storage.h,
	src/plugins/virtual/virtual-sync.c:
	Virtual mailboxes: Speed up initial search result building using
	modseqs.
	[29d6c17f2009]

	* src/util/logview.c:
	logview: Show flags field in extension intros.
	[02bef9a155d7]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-transaction-log-append.c:
	mail_index_update_header_ext() can now be called multiple times for
	the same extension.
	[efb782e078b9]

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-transaction-
	log-append.c, src/lib-index/mail-transaction-log.h:
	Mail index extension introductions now add a "no resizes" flag to
	the intro records. If it's found, the header and record sizes are
	used only if the extension doesn't exist yet, otherwise they're
	ignored.
	[5bedea448cf9]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Removed accidentally committed debug code that caused Maildir tmp/
	directory to be scanned every time mailbox was opened.
	[15f01af8449a]

	* src/lib-storage/mailbox-search-result-private.h, src/lib-storage
	/mailbox-search-result.c:
	Added mailbox_search_result_alloc() for building search results
	manually.
	[9e4be86d4b7d]

	* src/lib-index/mail-transaction-log-append.c:
	mail_index_update_header_ext(): Don't crash if size isn't 32bit
	aligned.
	[053d1aa325f6]

	* src/auth/passdb-cache.c:
	Code cleanup: Don't mix up '\0' and NULL.
	[9cd7caa922d6]

	* src/lib-index/mail-index-transaction.c:
	mail_index_ext_resize() may have looked up old record size from
	wrong message.
	[51a56b173df7]

	* configure.in:
	Check strtoimax() and strtoumax() with inttypes.h included. They
	won't be detected otherwise with HP-UX.
	[ef8af0eb161a]

	* src/lib-storage/index/Makefile.am, src/lib-storage/index/index-
	search-result.c, src/lib-storage/index/index-search-result.h, src
	/lib-storage/index/index-sync-private.h, src/lib-storage/index
	/index-sync-search.c, src/lib-storage/index/index-sync.c:
	Moved non-syncing related search result updating code to a separate
	file and did some other cleanups.
	[3ffac3f6173f]

	* src/lib-storage/index/index-sync-private.h, src/lib-storage/index
	/index-sync-search.c, src/lib-storage/index/index-sync.c:
	Search result update handling code cleanups.
	[38bdfafa655c]

	* src/lib-storage/index/index-fetch.c, src/lib/seq-range-array.c,
	src/lib/seq-range-array.h, src/plugins/fts-squat/squat-trie.c,
	src/plugins/fts/fts-api.c:
	Renamed seq_range_array_remove_invert_range() to
	seq_range_array_intersect().
	[d12fc53f71be]

	* src/lib-index/mail-index-view-sync.c:
	Mailbox view sync: If modseqs are enabled, use them as well as
	direct flag/keyword comparing to find out changes when transaction
	logs are missing.
	[ad087a4c480f]

	* src/auth/mech-rpa.c:
	RPA auth mechanism: Fixed handling usernames longer than 255
	characters.
	[a097b704be1b]

2008-06-17  Timo Sirainen  <tss@iki.fi>

	* TODO, src/lib-index/mail-index-sync-update.c, src/lib-index/mail-
	index-view-sync.c:
	Mailbox view sync: Figure out the changes by comparing old and new
	maps if any of the required transaction logs are missing.
	[bc5eca410ed3]

	* src/lib-index/mail-index-sync-update.c:
	Added assert.
	[ab08272053c5]

	* src/lib-index/mail-index-map.c:
	mail_index_record_map_move_to_private(): Drop messages from
	record_map the map hasn't itself seen yet.
	[b8262c3a36f3]

	* src/lib-index/mail-index-view.c, src/lib-index/mail-index.h:
	Added mail_index_map_lookup_keywords().
	[cca4ef877d43]

	* src/lib-storage/index/index-sync-search.c:
	CONTEXT=SEARCH optimization: Don't look up expunged messages' UIDs
	if we don't have any saved search results.
	[bc05d48eac44]

	* src/lib-index/mail-transaction-log.c:
	Rotated transaction logs weren't always unlocked, potentially
	causing other processes to fail with timeout errors.
	[1da72e385de4]

	* src/lib-storage/index/maildir/maildir-save.c:
	Maildir saving: Fixed a potential crash when saving a mail with
	keywords.
	[2e75e5a42f0e]

	* src/lib-index/mail-index-view-sync.c:
	Mail index view sync: Don't look for expunges if we already did it
	once.
	[94fe6f7747da]

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index.h,
	src/lib-storage/index/index-sync.c:
	Changed mail index view syncing API to return only flag changes.
	Currently it has only a single caller and it's not interested in
	anything else.
	[8ded6c06bcfc]

	* src/lib-index/mail-index-view-sync.c:
	mail_index_view_sync_begin() code cleanup.
	[650330db2f99]

	* src/lib-index/mail-index-view-sync.c:
	mail_index_view_sync_begin() _FLAG_FIX_INCONSISTENT code cleanup.
	[af9d5fd1071c]

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index.h,
	src/lib-storage/index/index-sync.c:
	mail_index_view_sync_begin() now delays its failures to _commit().
	[3882c6cbfa99]

	* README:
	Updated conformed RFC list.
	[6718f97ed2c3]

2008-06-13  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-append.c:
	APPEND: Uncork stream only after syncing and sending tagged reply.
	[490fdb3c04de]

	* configure.in:
	If $shrext_cmds isn't set for some reason, fallback to ".so" suffix.
	[fe465f0f86fb]

	* src/lib/macros.h:
	MEMBER(): Don't try to use the C99 "." feature with HP-UX.
	[04d86d65c469]

	* configure.in:
	Fixed looking up plugin suffix.
	[3f8282688777]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Compiler warning fix
	[e4884450ecf4]

	* configure.in:
	Fixed setting MODULE_SUFFIX with OS X.
	[7e2f20d65631]

	* src/plugins/acl/Makefile.am, src/plugins/convert/Makefile.am,
	src/plugins/expire/Makefile.am, src/plugins/fts-lucene/Makefile.am,
	src/plugins/fts-squat/Makefile.am, src/plugins/fts/Makefile.am,
	src/plugins/lazy-expunge/Makefile.am, src/plugins/mail-
	log/Makefile.am, src/plugins/mbox-snarf/Makefile.am,
	src/plugins/quota/Makefile.am, src/plugins/trash/Makefile.am:
	Previous changes broke plugin symlink creation in make install.
	[f5d1dc944a7c]

	* configure.in, src/lib/mempool-system-clean.c, src/lib/mempool-
	system.c:
	FreeBSD compile warning fix.
	[b145040d5adb]

	* src/lib/mempool-system-clean.c:
	Removed accidentally committed debug code.
	[fa00c24cf0d6]

	* src/lib-charset/charset-utf8.c:
	Compiler warning fix when compiling without iconv.
	[481fa709dce3]

	* src/lib/nfs-workarounds.c:
	FreeBSD NFS workarounds: We called fchown() with random UID. It
	shouldn't have really mattered though, because the call failed
	always anyway.
	[85f457b9b3ad]

	* src/lib-storage/index/index-sort-private.h, src/lib-storage/index
	/index-sort-string.c, src/lib-storage/index/index-sort.c:
	Reversing the primary sort criterion reversed also reversed
	secondary criterions. Fixed reverse sorting the first condition.
	[f431c67621ed]

	* src/lib/array.c, src/lib/array.h, src/tests/test-lib.c:
	Added array_reverse().
	[69c1e3e13464]

	* src/lib/Makefile.am, src/lib/array.c, src/lib/array.h:
	Uninlined some of the more complex array functions.
	[63df79ccfedb]

	* src/lib-imap/imap-base-subject.c:
	imap_get_base_subject_cased(): Subject trailers weren't removed
	correctly. Also cleaned up the code a bit.
	[3c8736e8f08d]

	* src/lib-storage/index/index-sort.c:
	Message sorting by date, arrival or size was broken.
	[b5a6e6783786]

	* src/auth/userdb-prefetch.c:
	prefetch: Updated log message.
	[ea275bc7c8a1]

	* src/util/logview.c:
	logview: Expand header update records to user-readable form.
	[98aa72f63578]

	* src/login-common/main.c, src/master/login-process.c:
	Change fd limit in login process after it's execed. This fixes OSes
	which don't allow setting fd limit below what's already used (e.g.
	HP-UX).
	[53604857c7d2]

	* src/master/login-process.c:
	Cleanup: Calculate file descriptor count a bit more correctly.
	[560611fa3d68]

	* configure.in, src/lib/compat.c, src/lib/compat.h:
	Support systems with non-C99 vsnprintf().
	[7f9f7fc02359]

	* src/lib/data-stack.c:
	t_get_bytes_available(): Return a bit less than is available because
	some space is wasted to alignmentation (and for other things when
	DEBUG enabled).
	[9a00bd31ca99]

2008-06-12  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-fs.c:
	HP-UX fs quota: Convert blocks to bytes using filesystem's actual
	block size instead of using a hardcoded DEV_BSIZE (should this be
	done with other OSes too?)
	[a1fd8b29f629]

	* configure.in, src/lib/compat.c, src/lib/compat.h:
	Added more fallbacks if strtoll() or strtoull() isn't implemented
	(e.g. HP-UX).
	[35877d1131db]

	* src/plugins/quota/quota-fs.c:
	HP-UX: Fixed compiling problem in fs-quota.
	[f4c53ad3610f]

	* src/plugins/quota/quota-fs.c:
	fs quota: message/inode values and limits were set wrong, except for
	Solaris
	[e4e9cc00d9ba]

	* configure.in, dovecot-config.in.in, src/auth/Makefile.am,
	src/deliver/Makefile.am, src/dict/Makefile.am, src/imap/Makefile.am,
	src/plugins/convert/Makefile.am, src/plugins/expire/Makefile.am,
	src/plugins/fts-squat/Makefile.am, src/pop3/Makefile.am,
	src/tests/Makefile.am, src/util/Makefile.am:
	If we need -lcrypto for randomness, put it to $LIBS instead of
	$RAND_LIBS since it needs to be linked to all binaries anyway.
	[7b39370dae6b]

2008-06-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-search-build.c:
	Increased default mail search args memory pool size.
	[0df78677ea1b]

	* src/lib-index/mail-transaction-log-file.c:
	Make sure initial_modseq is correct when rotating transaction log.
	[6480642aba24]

	* src/lib-index/mail-transaction-log-append.c:
	Update sync_highest_modseq while appending new transactions. Our own
	transaction commits
	[38cb76c22dc5]

	* src/imap/imap-sync.c:
	QRESYNC: We could have sent VANISHED with UID 0.
	[dbfa021f8985]

2008-06-13  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c, src/lib-mail/mbox-from.c, src/lib-mail/mbox-
	from.h, src/lib-storage/index/mbox/istream-raw-mbox.c:
	mbox_from_parse() now returns also the parsed timezone.
	[d076e1758c6a]

	* src/lib-imap/imap-date.c, src/lib-imap/imap-date.h:
	Added imap_to_datetime_tz() to create IMAP date-time with specified
	timezone.
	[1b1fe3d50079]

2008-06-12  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota.c:
	Quota: If quota root has unwanted parameters, log an error and die.
	[e557042b2c1c]

	* src/lib-storage/index/dbox/dbox-save.c:
	dbox: Don't double-free memory if message saving is aborted.
	[e019f0152775]

	* src/lib-mail/message-header-parser.c:
	Message header parser: Don't return values pointing to input stream.
	It seemed to work most of the time, but not always when combined
	with message-parser.
	[1b0d19442120]

	* src/tests/test-common.c, src/tests/test-common.h, src/tests/test-
	mail.c:
	tests: Test message-parser better with nonblocking input.
	[2ac2ca9089bf]

	* src/lib-storage/index/index-thread.c:
	threading left search parameters broken when returning.
	[c6a49099a4fc]

	* src/lib-storage/index/index-thread-links.c:
	mail_hash_update() updated wrong index.
	[e1c13a782399]

	* src/imap/imap-sync.c:
	CONTEXT=SEARCH: Removed extra ')' from ESEARCH replies.
	[b2d18f10b5a7]

	* src/lib-storage/index/dbox/dbox-storage.c:
	dbox: Set MAILBOX_NOCHILDREN flag for selectable mailboxes if we
	know it.
	[5a6aa66e2ccd]

	* src/lib-storage/index/dbox/dbox-storage.c:
	dbox: Set MAILBOX_CHILDREN flag for \NoSelect mailboxes if we know
	it.
	[1550dc4f24a5]

	* src/lib-storage/index/index-search.c:
	SEARCH: Fixed NOT <seqset> not matching anything.
	[7caab06fb890]

	* src/lib-storage/index/index-thread.c:
	thread indexes: Fixed infinite loop.
	[6659785091ab]

	* configure.in, src/lib/module-dir.c, src/plugins/acl/Makefile.am,
	src/plugins/convert/Makefile.am, src/plugins/expire/Makefile.am,
	src/plugins/fts-lucene/Makefile.am, src/plugins/fts-
	squat/Makefile.am, src/plugins/fts/Makefile.am, src/plugins/lazy-
	expunge/Makefile.am, src/plugins/mail-log/Makefile.am, src/plugins
	/mbox-snarf/Makefile.am, src/plugins/quota/Makefile.am,
	src/plugins/trash/Makefile.am:
	Use dynamic module suffix provided by libtool rather than hardcoded
	".so".
	[b63aa0ffe564]

	* src/deliver/deliver.h:
	HP-UX: Added missing EX_CONFIG macro
	[0307382cf011]

	* src/plugins/quota/quota-fs.c, src/plugins/quota/quota-fs.h:
	HP-UX: Fixed quota-fs compiling.
	[c0ff3c147375]

	* configure.in:
	HP-UX: Fixed fd passing.
	[b13dca205eaa]

	* configure.in, src/lib/compat.c, src/lib/compat.h:
	HP-UX: pread() and pwrite() are broken, use our own implementation.
	[5abe05d7d093]

2008-06-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-sql.c:
	dict sql: Iterated keys need to contain private/shared prefix.
	[654cd4d966be]

	* src/plugins/expire/expire-tool.c:
	expire-tool: Iterate dict recursively - we want everything.
	[3fa91ced11e8]

	* src/lib-dict/dict-sql.c:
	Fixed dict iteration with SQL backend.
	[59ec9752c3dd]

	* src/imap/cmd-close.c:
	CLOSE: Use MAILBOX_SYNC_FLAG_EXPUNGE.
	[a36001eb64af]

	* src/imap/client.h, src/imap/cmd-close.c, src/imap/cmd-expunge.c,
	src/imap/cmd-idle.c, src/imap/imap-fetch.c, src/imap/imap-sync.c,
	src/imap/imap-sync.h:
	QRESYNC: Send HIGHESTMODSEQ automatically in all tagged replies
	whenever it seems useful.
	[ffaf1ea49704]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-close.c, src/imap
	/cmd-select.c, src/imap/cmd-unselect.c:
	Changed the way mailbox changing ambiguity is checked.
	[ea6727a1220e]

	* src/imap/client.h, src/imap/cmd-select.c, src/imap/imap-fetch.c,
	src/imap/imap-sync.c, src/lib-index/mail-index-view-sync.c, src/lib-
	index/mail-index.h, src/lib-storage/index/index-sync.c, src/lib-
	storage/mail-storage.h:
	QRESYNC: If MODSEQs were returned in FETCH replies but there are
	pending expunges, send a low enough HIGHESTMODSEQ reply to make sure
	the client will later see the expunges.
	[2d62129a709b]

	* src/imap/imap-sync.c:
	QRESYNC: Always send UID in FETCH sync replies.
	[1ae3d4a5057b]

	* src/imap/imap-fetch.c:
	QRESYNC crashfix
	[f8a0e11566c8]

	* src/lib-index/mail-index-modseq.c, src/lib-index/mail-index-
	modseq.h, src/lib-index/mail-index-private.h, src/lib-index/mail-
	index-sync-update.c, src/lib-index/mail-index-view-sync.c, src/lib-
	index/mail-transaction-log-file.c, src/lib-index/mail-transaction-
	log-private.h, src/lib-index/mail-transaction-log-view.c, src/lib-
	index/mail-transaction-log.h, src/lib-storage/index/index-fetch.c,
	src/util/logview.c:
	Modseqs are no longer calculated from transaction log sequence +
	offset. Now they begin from 1 and each "visible" transaction
	increases it by one.
	[d10cb44ab446]

	* src/plugins/virtual/Makefile.am:
	Added missing virtual-plugin.h
	[85191a8cd7df]

	* src/imap/cmd-search.c:
	UID SEARCH: Don't return EXPUNGEs if search criteria contains
	sequences.
	[a32df93cc112]

	* src/util/logview.c:
	logview: Handle unexpected header sizes correctly.
	[a5bbb3abeff8]

2008-06-10  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	LIST: Renamed X-STATUS return option to STATUS, since the first
	draft of the standard was released now. The capability isn't added
	yet though.
	[9185f2adeefb]

	* src/lib/env-util.c:
	env_clean(): calloc() is probably the safest way to do it.
	[8704bd29617b]

	* src/lib/env-util.c:
	env_clean(): Try yet another way that appears to work better.
	[5ae1c7c4edcf]

2008-06-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-search.c, src/lib-mail/message-search.h, src
	/lib-storage/index/index-search.c:
	Removed pool parameter from message_search_init().
	[d440b7cad709]

	* configure.in, src/lib/env-util.c:
	Use clearenv() if available.
	[27b97457d274]

	* src/lib/env-util.c:
	env_clean(): Don't free environment memory pool to make sure the
	environment won't get corrupted in case the clearing fails.
	[7d7ac2149243]

	* src/deliver/deliver.c:
	deliver: Kludge more to get boolean settings with "yes" as default
	value to work correctly.
	[64c9fa2d2cae]

	* src/lib-storage/index/maildir/maildir-copy.c:
	Maildir: When hardlink-copying a file, copy the W=vsize if it exists
	in the original filename.
	[40da0a9ccd9d]

	* doc/thread-refs.txt:
	Added documentation about how thread indexes work.
	[524b4acad38b]

	* configure.in:
	Added a note about this being UNSTABLE branch.
	[4aa830b4f8bc]

	* README, TODO, configure.in, dovecot-example.conf, src/imap/client.c,
	src/imap/client.h, src/imap/cmd-append.c, src/imap/cmd-search.c,
	src/imap/cmd-sort.c, src/imap/cmd-store.c, src/imap/cmd-thread.c,
	src/imap/commands.h, src/imap/imap-search.c, src/imap/imap-sync.c,
	src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-transaction.c, src/lib-index
	/mail-index.c, src/lib-index/mail-index.h, src/lib-mail/message-
	parser.c, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/cydir/cydir-storage.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-mail.h, src
	/lib-storage/index/index-search.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-sync.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/raw/raw-
	mail.c, src/lib-storage/index/raw/raw-storage.c, src/lib-storage
	/mail-storage.c, src/lib-storage/mail-storage.h, src/plugins/convert
	/convert-storage.c, src/plugins/expire/expire-tool.c, src/plugins
	/fts-squat/fts-backend-squat.c, src/plugins/fts/fts-storage.c,
	src/plugins/lazy-expunge/lazy-expunge-plugin.c, src/plugins/mbox-
	snarf/mbox-snarf-plugin.c, src/plugins/quota/quota-count.c,
	src/plugins/quota/quota-storage.c, src/pop3/client.c,
	src/pop3/commands.c, src/util/idxview.c:
	Merged latest v1.1 changes.
	[8e206e25a142]

2008-05-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-thread-links.c:
	Link unreferencing was done backwards for References: header.
	[86e84fb00776]

2008-06-09  Timo Sirainen  <tss@iki.fi>

	* src/imap/Makefile.am, src/imap/cmd-thread.c, src/imap/imap-thread-
	finish.c, src/imap/imap-thread-links.c, src/imap/imap-thread-
	private.h, src/imap/imap-thread.c, src/imap/imap-thread.h,
	src/imap/main.c, src/lib-storage/Makefile.am, src/lib-
	storage/index/Makefile.am, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-thread-finish.c, src/lib-storage/index
	/index-thread-links.c, src/lib-storage/index/index-thread-private.h,
	src/lib-storage/index/index-thread.c, src/lib-storage/mail-thread.h:
	Moved threading code to lib-storage.
	[37f23e0476e2]

2008-05-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-thread-links.c:
	mail_hash_update() updated wrong index.
	[56114dc2ccfc]

2008-06-09  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-thread.c, src/imap/imap-thread-finish.c, src/imap/imap-
	thread-private.h, src/imap/imap-thread.c, src/imap/imap-thread.h,
	src/imap/main.c:
	Moved code around so that cmd-thread.c can do the THREAD reply
	writing.
	[b2fefe24b849]

	* src/imap/imap-thread-finish.c, src/imap/imap-thread-private.h,
	src/imap/imap-thread.c:
	Use iterators to go through the thread instead of directly writing
	to output stream.
	[844857c8ad1d]

2008-05-13  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-thread-finish.c:
	Error handling fix
	[42973d5eb385]

	* src/imap/imap-thread-finish.c:
	Fix THREAD=REFERENCES2.
	[7e7e2b1996b0]

2008-06-09  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-thread.c, src/imap/imap-thread-finish.c, src/imap/imap-
	thread-links.c, src/imap/imap-thread-private.h, src/imap/imap-
	thread.c, src/imap/imap-thread.h:
	Link refcounting redesign to fix problems. Started getting rid of
	client/command dependencies from threading code.
	[05511835e4b1]

2008-05-13  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-thread-finish.c:
	Removed recently added wrong code.
	[0d6531065d89]

	* src/imap/imap-thread-finish.c:
	Code cleanups
	[3718262bec49]

	* src/imap/imap-thread-finish.c:
	Dummy root fix
	[ad51fc17da67]

	* src/lib-index/mail-hash.c:
	Added assert
	[8f6fa7aa0236]

2008-05-09  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-thread.c:
	Use hook_mailbox_index_opened instead of hook_mailbox_opened.
	[5046f47f273b]

	* src/lib-storage/index/index-storage.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c:
	Added hook_mailbox_index_opened.
	[1e21a556c153]

2008-06-09  Timo Sirainen  <tss@iki.fi>

	* TODO, configure.in, dovecot-example.conf, src/imap/Makefile.am,
	src/imap/cmd-thread.c, src/imap/imap-thread-finish.c, src/imap/imap-
	thread.c, src/imap/imap-thread.h, src/lib-index/Makefile.am, src
	/lib-index/mail-index-sync-ext.c, src/lib-mail/message-parser.c,
	src/lib/istream-crlf.c:
	Merged initial mail thread indexing implementation.
	[929198b1f313]

2008-05-09  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-thread-private.h, src/imap/imap-thread.c, src/lib-
	index/mail-hash.c, src/lib-index/mail-hash.h:
	Thread index fixes
	[bc346cfdf954]

2008-05-06  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-thread.c, src/lib-index/mail-hash.c, src/lib-index
	/mail-hash.h:
	Fixed deadlocking and other locking issues.
	[ec1c76b75de3]

	* src/imap/imap-thread-finish.c, src/imap/imap-thread.c:
	Crashfix. Memory leak fixes.
	[4e13694c0400]

	* src/lib-index/mail-hash.c:
	Added asserts. Did some fixes.
	[472326085681]

2008-03-16  Timo Sirainen  <tss@iki.fi>

	* TODO:
	updated
	[f01d8d387447]

	* src/imap/Makefile.am, src/imap/cmd-thread.c, src/imap/imap-thread-
	finish.c, src/imap/imap-thread-links.c, src/imap/imap-thread-
	private.h, src/imap/imap-thread.c, src/imap/imap-thread.h,
	src/imap/main.c, src/lib-index/mail-hash.c, src/lib-index/mail-
	hash.h:
	Initial thread indexing code.
	[34d402399040]

2008-03-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c:
	Expunge handler crashfix
	[cad7aba678ad]

2008-03-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	update.c:
	Expunge handler calling fixes.
	[304089d87792]

	* src/lib-index/mail-index.c:
	mail_index_ext_register(): Allow registering an extension without
	record or header. It can still be used to register expunge/sync
	handlers.
	[35b9020ea25b]

	* src/lib-index/mail-cache.c:
	Catch dotlock creation timeout error.
	[91b26b5c5a23]

	* src/lib-index/mail-transaction-log-file.c:
	Error message fix.
	[07ae4a8d83c0]

	* src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h:
	Added mailbox_transaction_get_mailbox()
	[f2d856bb0cae]

	* src/lib-imap/imap-quote.c:
	imap_quote(): Don't crash if allocating from data stack pool.
	[ebcfd53efe94]

2008-03-04  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/lib-storage/index/mbox/mbox-lock.c, src
	/lib-storage/index/mbox/mbox-lock.h, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib
	/restrict-access.c, src/lib/restrict-access.h, src/master/auth-
	process.c, src/master/login-process.c, src/master/mail-process.c,
	src/master/master-settings-defs.c, src/master/master-settings.c,
	src/master/master-settings.h:
	Replaced mail_extra_groups setting with mail_privileged_group and
	mail_access_groups settings. mail_privileged_group allows temporary
	access to the group when creating mbox INBOX dotlocks.
	[12adb981226e]

	* src/master/master-settings.c:
	If mail_uid or mail_gid doesn't exist, log an error.
	[2e8ff3074f5b]

	* src/plugins/expire/expire-tool.c:
	Fail if any parameters other than --test is given.
	[d25860363eaf]

	* src/lib-storage/index/dbox/dbox-mail.c:
	If save time is missing, use the file's ctime instead of current
	time.
	[64c1d13202cb]

	* src/plugins/expire/expire-env.c:
	Forgot to change expire time to be calculated as hours after
	debugging.
	[5597b0835902]

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index.h,
	src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-file.h, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/dbox/dbox-
	storage.h, src/lib-storage/index/dbox/dbox-sync-file.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/index-mail.c,
	src/lib-storage/index/maildir/maildir-save.c, src/lib/Makefile.am,
	src/lib/fdatasync-path.c, src/lib/fdatasync-path.h, src/master
	/child-process.c, src/master/child-process.h, src/master/mail-
	process.c, src/master/mail-process.h, src/master/main.c,
	src/plugins/expire/Makefile.am, src/plugins/expire/expire-env.c,
	src/plugins/expire/expire-env.h, src/plugins/expire/expire-plugin.c,
	src/plugins/expire/expire-tool.c:
	Moved fdatasync_path() to a global function.
	[aaeae4a920f7]

2008-03-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	SEARCH NOT SUBJECT didn't work correctly.
	[028939047ffb]

	* src/lib/mempool-alloconly.c:
	DEBUG: Use t_buffer_alloc_last_full() before calling i_warning() to
	make sure we don't trash unallocated data from data stack.
	[1defcf913178]

	* src/lib/data-stack.c, src/lib/data-stack.h:
	Added t_buffer_alloc_last_full().
	[26d7e3336a48]

	* src/tests/test-imap.c:
	Added more tests to imap_match().
	[2fca2f050f33]

	* src/lib-storage/index/dbox/dbox-storage.c:
	LIST: Show \NoSelect status correctly.
	[35480e6e45b3]

	* src/lib-storage/index/dbox/dbox-storage.c:
	Mailbox deletion fixes.
	[28fd0d83d117]

	* src/lib-storage/list/mailbox-list-fs-iter.c:
	Mailbox listing fix.
	[c9567a98760d]

	* src/deliver/deliver.c, src/lib-mail/Makefile.am, src/lib-mail/mbox-
	from.c, src/lib-mail/mbox-from.h, src/lib-
	storage/index/mbox/Makefile.am, src/lib-storage/index/mbox/mbox-
	from.c, src/lib-storage/index/mbox/mbox-from.h:
	Moved mbox From_-line handling to lib-mail, since it's also used by
	deliver.
	[5d37ca11808d]

	* src/lib-index/mail-index-sync.c:
	mail_index_sync_have_any(): Refresh index to see if there are any
	new unseen changes before returning anything.
	[533bee708cc0]

	* src/imap/cmd-close.c:
	CLOSE: Synchronize the mailbox after expunging messages to actually
	get them expunged.
	[efff12e19514]

2008-03-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	Fixed pass=yes with blocking passdbs. Also master_user wasn't
	exported correctly to blocking passdbs.
	[2b8568b54384]

	* src/plugins/acl/acl-backend-vfile.c:
	Ignore spaces and TABs at the end of ACL lines.
	[8ef6b651e2f8]

	* src/lib-storage/index/mbox/mbox-lock.c:
	Don't try to flush NFS file handle cache for mbox files.
	[7f412e03ab8e]

	* src/plugins/mail-log/mail-log-plugin.c:
	Copies were tracked using the source transaction instead of
	destination transaction, so rollbacking source transaction logged
	bogus "transaction rolled back" messages.
	[bb78360d7aa4]

	* src/lib-imap/imap-match.c:
	imap_match(): "foo/bar/%" pattern matching to "foo/" should return
	CHILDREN instead of NO.
	[f8d49fe38db5]

	* .hgignore, src/tests/Makefile.am, src/tests/test-imap.c:
	Added unit tests for imap_match()
	[2937b7f44f79]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-transaction.c, src/lib-index
	/mail-cache.c:
	Optimized cache record loop tracking.
	[fea46320f834]

2008-03-01  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-limit.c:
	Seek also non-seekable parent streams to current offset as long as
	we're not seeking backwards.
	[29a6eec987e5]

2008-02-29  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	Trying to user $USER environment didn't work before environment was
	already cleared. Get it earlier.
	[e4aa76ca2bc5]

	* src/deliver/deliver.c:
	If username lookup fails, return EX_USAGE instead of EX_TEMPFAIL
	because we haven't yet opened the log file.
	[1d79c534b54b]

	* src/lib/seq-range-array.c:
	Implemented optimized seq_range_array_add_range().
	[18f5d0538baa]

	* src/tests/test-lib.c:
	Use smaller test buffer sizes
	[338ea1ecca5f]

	* src/tests/test-lib.c:
	Added randomized unit test for seq_range_array*()
	[9b10a0c47e9b]

	* src/lib-storage/index/index-mail-headers.c:
	array_clear() is now equivalent to buffer_clear(), use it.
	[5889b8a76c4b]

	* src/tests/test-lib.c:
	Added unit testing for buffer_t.
	[a56c676ce65d]

	* src/lib/buffer.c:
	buffer_reset(buf) and buffer_set_used_size(buf, 0) now do the same
	thing.
	[7995da69b348]

	* src/lib/priorityq.c:
	Fixed removing last item from priority queue.
	[1b8277a36723]

2008-02-28  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-limit.c:
	If underlying stream doesn't support seeking, don't try to seek to
	original position.
	[ade241ae256e]

	* src/lib/istream-crlf.c:
	Added support for seeking forwards in the stream. Also mark the
	stream as non-seekable since seeking backwards doesn't work.
	[e063797bdcd5]

2008-02-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Fixed dirty flag/keyword handling.
	[446899ed6a65]

2008-02-26  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Base docdir to datadir instead of datarootdir which doesn't exist in
	old autoconfs either.
	[9bc49f7ff7da]

	* configure.in:
	Added support for autoconf versions older than 2.59c.
	[93431cc2d39e]

	* doc/wiki/Makefile.am.in:
	wiki docs weren't using docdir.
	[272a05aeb53d]

	* src/plugins/quota/quota-maildir.c, src/plugins/quota/quota-
	private.h, src/plugins/quota/quota.c:
	quota_rule=?:.. specifies the default quota limits to use when
	backend doesn't have any. If backend has limits, this rule is
	ignored.
	[746aee869ac5]

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-fs.c, src/plugins/quota/quota-maildir.c,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota.c:
	Relative (%) limits in quota rules and warnings work now if the
	backend specifies or changes the limits (e.g. Maildir++ maildirsize
	file)
	[7c5ceaaa3066]

	* src/auth/db-ldap.c, src/auth/userdb-ldap.c:
	Don't crash if ldap userdb lookup fails.
	[2e3f6188e164]

2008-02-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mailbox-check.c, src/lib-storage/index
	/index-sync.c:
	mailbox_notify_changes(): Don't trigger the timeout once a second to
	see if the timeout really occurred.
	[8a3a06fc5d10]

	* src/lib-storage/index/cydir/cydir-sync.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/maildir/maildir-
	sync.c, src/lib-storage/index/mbox/mbox-sync.c:
	Check and update sync_last_check in one common function.
	[baff41db898a]

	* src/lib-storage/index/index-mail-headers.c:
	And compile fix for last change.
	[643b9f2ca446]

	* src/lib-storage/index/index-mail-headers.c:
	array_clear() only truncates the array, growing its size later
	doesn't fill it with zero. Use buffer_reset() instead here which
	does zeroing.
	[20dc04cd6548]

	* src/imap/commands.c:
	LOGOUT command also closes mailbox, so mark it as such to fix
	command pipelining problems.
	[2f559fb30617]

2008-02-24  Timo Sirainen  <tss@iki.fi>

	* src/plugins/trash/trash-plugin.c:
	Allow #comments in trash config
	[5ad7032ee313]

2008-02-21  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-search.c, src/lib-storage/index/index-search.c, src
	/lib-storage/mail-search.c, src/lib-storage/mail-search.h:
	SEARCH SUBJECT now changes LWSP to spaces to match ENVELOPE's
	subject field.
	[79fee036a09f]

	* src/lib-imap/imap-quote.c:
	imap_quote*() with LWSP compression: Make sure TABs are always
	converted to spaces.
	[2c1768e723c7]

	* src/lib/data-stack.c:
	DEBUG: Buffer overflow checking caused false errors sometimes.
	[8a470f7fd622]

	* src/lib-storage/index/index-search.c:
	Header searches shouldn't include the header name or ":" in
	matching.
	[8d2d400fbb89]

	* src/lib-storage/index/index-mail.c:
	index_mail_get_date() didn't return timezone if date was already
	parsed.
	[24470b86ee63]

	* src/lib-storage/index/index-search.c:
	More fixes to SEARCH BEFORE/ON/SINCE timezone handling.
	[6e7db5f06497]

	* src/auth/auth-request.c:
	Fixed proxy_maybe handling.
	[ab9c6952cc49]

	* src/auth/passdb-cache.c:
	auth_debug: Hide passwords from "cache hit" log lines if
	auth_debug_passwords=no
	[14335cfd2fd2]

	* src/auth/auth-worker-client.c:
	Blocking passdbs that returned some userdb_* fields returned also an
	extra userdb_<username> field.
	[c5a666d16a81]

	* src/auth/passdb-cache.c:
	auth_debug: Show cache contents in "cache hit" lines.
	[00cff54ecfb4]

	* dovecot-example.conf, src/lib/network.c:
	[::] listens only for IPv6 addresses now. This gets rid of
	IPv4-mapped IPv6 addresses. Use "listen = *, [::]" for listening
	both.
	[1919baa9e636]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Fixed "uid_validity updated unexpectedly" errors when mbox file was
	being recreated and index files still existed.
	[fa2b3c9b7d08]

	* src/lib-mail/message-parser.c:
	Assert fix
	[3c046e52f649]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Make sure we don't use a stale first_unwritten_pos to optimize
	dovecot-uidlist writing.
	[50b8d966d987]

2008-02-20  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	Don't crash if trying to deliver mail to mailbox outside all
	namespaces.
	[e041d85a6236]

	* src/lib-storage/index/index-search.c:
	SEARCH BEFORE/ON/SINCE didn't handling timezones correctly.
	[ac5d76fc8eb2]

2008-02-17  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Changed the default ioloop to "best".
	[68241b50fabe]

	* src/lib-storage/index/maildir/maildir-save.c:
	fdatasync() the new/ and/or cur/ directory after mails are renamed.
	[16e06a1c43e6]

	* src/imap/cmd-idle.c:
	Assert-crashfix if IDLE finishes immediately.
	[374ee665b95f]

	* src/lib-storage/index/mbox/mbox-mail.c:
	Fixed "Cached message offset lost" errors when quota plugin was
	used.
	[0a15a13f382f]

	* configure.in:
	Fixed --enable-ipv6
	[3c2ed5046fc8]

	* dovecot-example.conf:
	Typofixes
	[3a2a20a4141c]

	* src/plugins/fts/fts-api.c:
	Don't crash if FTS backend initialization fails.
	[9014a3cc5d39]

2008-02-16  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	If __gss_userok() is found from -lgss, make sure we link with -lgss.
	[27e714c659d6]

	* src/master/mail-process.c:
	Last commit broke mail_drop_priv_before_exec/mail_chroot conflict
	check.
	[a00dc6f78106]

	* dovecot-example.conf, src/master/mail-process.c:
	mail_chroot no longer needs to be in valid_chroot_dirs.
	[f3508f678485]

	* dovecot-example.conf:
	Added a warning comment to mail_extra_groups.
	[5b4e578372f7]

	* src/imap/cmd-list.c:
	Don't convert real separators to virtual separators. The mailbox
	listing code already did it for us.
	[5d4efb4fb414]

	* .hgignore:
	Updated
	[de707046ab32]

	* src/imap/imap-fetch-body.c, src/imap/imap-fetch.h:
	If stream ends unexpectedly, it was most likely because of a broken
	cached field, so mark the cache corrupted.
	[6b326bab415d]

	* src/lib-storage/index/index-mail.c:
	When setting cache corrupted, make sure we don't write broken values
	to the new cache file. Also log broken virtual size fetches better
	and support 0 as a generic "some fields" value.
	[e1cb4e647fa5]

	* src/plugins/fts-squat/squat-trie.c, src/plugins/fts/fts-search.c:
	Memory leak fixes
	[7e8bcf1ef37b]

	* src/plugins/fts-squat/squat-trie.c:
	Expunge fix
	[affc1f7ccca7]

	* src/plugins/fts-squat/squat-trie.c:
	Fixed squat lookup.
	[49e91699be7d]

	* src/plugins/fts-squat/squat-trie.c:
	Fixed handling expunges.
	[9137bd313e04]

2008-02-15  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	Check for "/./" chrooting in home dirs only if valid_chroot_dirs
	isn't empty.
	[077a8ccac8af]

	* src/plugins/fts-squat/squat-trie.c:
	squat_trie_lookup() for empty string returns now all UIDs from root
	node. This is mainly useful for debugging.
	[68a59be6fb29]

	* src/lib-mail/message-parser.c, src/lib-storage/mail-storage.c, src
	/lib-storage/mailbox-list-private.h, src/lib-storage/mailbox-list.c:
	Memory leak fixes
	[7e93b52dbada]

	* src/lib-index/mail-index-transaction.c:
	Fixed bad memcpy() usage with memmove().
	[97b8ea4dd200]

2008-02-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c, src/lib-mail/message-parser.h, src
	/lib-mail/message-search.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/plugins/fts/fts-
	storage.c, src/tests/test-mail.c:
	Changed message_parser_deinit() to return -1 if the parser was using
	preparsed broken message parts. Callers catch the error and mark the
	cache file corrupted.
	[f24fd0a7d453]

	* src/lib-mail/message-search.c, src/lib-mail/message-search.h, src
	/lib-storage/index/index-search.c:
	message_search_more*() now returns bool instead of int. They can't
	fail.
	[b246d9bfab50]

	* src/lib-storage/index/cydir/cydir-mail.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/index-search.c,
	src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/mbox/mbox-mail.c, src/lib-storage/index/raw/raw-
	mail.c, src/lib-storage/mail-storage-private.h, src/lib-storage
	/mail-storage.h, src/lib-storage/mail.c:
	Added mail_set_cache_corrupted() to rebuild the cache file and force
	recalculating the given field.
	[221e58854b33]

	* src/lib-charset/charset-iconv.c:
	Crashfix for converting invalid input to UTF-8.
	[ff4431c2272d]

2008-02-13  Timo Sirainen  <tss@iki.fi>

	* src/plugins/convert/convert-tool.c:
	convert-tool returned inverted exit status.
	[5e4c711a0c06]

	* src/plugins/fts/fts-api-private.h:
	Compile fix with some compilers
	[5612692d751c]

	* src/plugins/fts-squat/fts-backend-squat.c:
	Compiler warning fix (wrong enums used, just happened to work)
	[be58c216dbf0]

	* src/lib-index/mail-index-sync-update.c:
	Code cleanup for last commit
	[2194777bcd8e]

	* src/lib-index/mail-index-sync-update.c:
	Log an error if uid_validity field is updated unexpectedly. If
	next_uid field decreases log an error and ignore the update.
	[5e3c1fde2f78]

	* src/util/idxview.c:
	Don't crash if there are no extensions.
	[fd29c90047e9]

2008-02-12  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	This code tree is now v1.2.UNSTABLE.
	[74e1dc23e441]

2008-06-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c, src/lib-storage/mailbox-
	search-result-private.h, src/lib-storage/mailbox-search-result.c:
	Saved search results: Remember what messages' static checks never
	match, so we don't waste time checking them over and over again.
	[882888286bf5]

	* src/plugins/virtual/virtual-mail.c, src/plugins/virtual/virtual-
	storage.c, src/plugins/virtual/virtual-storage.h,
	src/plugins/virtual/virtual-sync.c:
	virtual mailboxes: Use saved search results to find out which
	messages were added/removed. Also several other fixes and
	optimizations.
	[c8b19aca45d9]

	* src/lib-storage/mail-storage.c:
	mailbox_sync(): Don't add FIX_INCONSISTENT flag if there are saved
	search results, otherwise they won't be updated.
	[242a4fae3587]

	* src/lib/seq-range-array.c, src/lib/seq-range-array.h:
	Added seq_range_count().
	[bba1bb98d162]

2008-06-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mailbox-search-result.c:
	CONTEXT=SEARCH: Handle correctly if the same mail is added and
	removed (or removed and added) before next sync.
	[303b71884a05]

2008-06-07  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/imap/cmd-expunge.c, src/lib-imap/imap-
	messageset.c, src/lib-imap/imap-messageset.h, src/lib-index/mail-
	index-transaction.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/mail-search-build.c, src/lib-storage/mail-storage.h,
	src/plugins/virtual/virtual-config.c, src/plugins/virtual/virtual-
	mail.c, src/plugins/virtual/virtual-storage.c, src/plugins/virtual
	/virtual-storage.h, src/plugins/virtual/virtual-sync.c:
	Merged virtual mailbox support.
	[eb0f45d0c9f2]

2008-03-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-search-build.c:
	Fixed SEARCH UID
	[40b0892de395]

2008-03-15  Timo Sirainen  <tss@iki.fi>

	* src/plugins/virtual/virtual-storage.c:
	Fixed using mailboxes from namespaces with a prefix or non-default
	separator.
	[df3728c2093c]

2008-03-14  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/plugins/Makefile.am,
	src/plugins/virtual/Makefile.am, src/plugins/virtual/virtual-
	config.c, src/plugins/virtual/virtual-mail.c, src/plugins/virtual
	/virtual-plugin.c, src/plugins/virtual/virtual-plugin.h,
	src/plugins/virtual/virtual-storage.c, src/plugins/virtual/virtual-
	storage.h, src/plugins/virtual/virtual-sync.c, src/plugins/virtual
	/virtual-transaction.c:
	Added initial support for virtual mailboxes.
	[8fc919084252]

	* src/imap/Makefile.am, src/imap/cmd-search.c, src/imap/imap-
	messageset.c, src/imap/imap-messageset.h, src/imap/imap-search.c,
	src/imap/imap-search.h, src/lib-imap/Makefile.am, src/lib-imap/imap-
	messageset.c, src/lib-imap/imap-messageset.h, src/lib-
	storage/Makefile.am, src/lib-storage/index/index-search.c, src/lib-
	storage/mail-search-build.c, src/lib-storage/mail-search-build.h,
	src/lib-storage/mail-search.h, src/plugins/fts/fts-storage.c,
	src/pop3/commands.c:
	Moved IMAP messageset handling to lib-imap/ and searching to lib-
	storage/. Rewrote messageset handling to use struct seq_range
	instead.
	[2d3d1a61f734]

	* src/imap/cmd-expunge.c, src/lib-storage/mail-storage.h:
	Added MAILBOX_SYNC_FLAG_EXPUNGE.
	[d274d0870a1a]

	* src/lib-index/mail-index-transaction.c:
	MAIL_INDEX_TRANSACTION_FLAG_AVOID_FLAG_UPDATES: Don't crash if
	trying to add keywords to newly added messages.
	[e6e32571025e]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-search.h:
	Added support for SEARCH_UIDSET.
	[4c9027eacfce]

	* src/lib-storage/index/cydir/cydir-mail.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/index-search.c,
	src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/mbox/mbox-mail.c, src/lib-storage/index/raw/raw-
	mail.c, src/lib-storage/mail-storage-private.h:
	struct mail can't necessarily be casted to struct index_mail. Added
	a new get_index_mail() method to return it.
	[1ff4a6d15b11]

	* src/lib-storage/mail-storage-private.h, src/lib-storage/mail-
	storage.c:
	Added transaction flags to struct mailbox_transaction_context.
	[f83c391c2428]

	* src/lib-index/mail-index-transaction.c:
	MAIL_INDEX_TRANSACTION_FLAG_AVOID_FLAG_UPDATES: Avoid also keyword
	updates. Also fixed a bug with flag updates.
	[94ad5f7d08ac]

2008-06-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-search.c, src/lib-storage/mail-search.h, src
	/lib-storage/mailbox-search-result.c:
	SEARCH UPDATE: Convert seqsets in saved results to uidsets so that
	they can be matched correctly later if messages are expunged.
	[ec49260ed4ee]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/raw/raw-storage.c, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h:
	Added mailbox_get_uid_range().
	[1004a3555a03]

	* src/imap/imap-sync.c, src/imap/imap-thread.c, src/lib-
	storage/index/cydir/cydir-storage.c, src/lib-storage/index/dbox
	/dbox-storage.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/index/raw/raw-storage.c, src/lib-storage/mail-search.c,
	src/lib-storage/mail-storage-private.h, src/lib-storage/mail-
	storage.c, src/lib-storage/mail-storage.h, src/plugins/fts/fts-
	search.c, src/plugins/fts/fts-storage.c, src/plugins/lazy-expunge
	/lazy-expunge-plugin.c:
	Renamed mailbox_get_uids() to mailbox_get_seq_range().
	[f8e902acfbae]

	* src/imap/cmd-search.c:
	SEARCH PARTIAL: Don't treat range as seq-range because it isn't one.
	[959fcc5e9068]

	* src/imap/cmd-search.c:
	SEARCH=CONTEXT error checking fix / changes.
	[6fb9a58ad8c5]

	* src/imap/cmd-search.c:
	CONTEXT=SEARCH: Implemented SEARCH PARTIAL (non-optimized).
	[edd180c77b99]

2008-06-06  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-select.c, src/imap/imap-search.c, src/lib-
	imap/Makefile.am, src/lib-imap/imap-messageset.c, src/lib-imap/imap-
	messageset.h, src/lib-imap/imap-seqset.c, src/lib-imap/imap-
	seqset.h, src/lib-storage/mail-search-build.c:
	Renamed imap_messageset_parse() to imap_seq_set_parse(). Added
	imap_seq_range_parse().
	[efbfe9344c14]

2008-06-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-sync.c:
	CONTEXT=SEARCH: ADDTO and REMOVEFROM can be sent in same ESEARCH
	reply.
	[d003fb4bb7d9]

	* configure.in, src/imap/Makefile.am, src/imap/client.c,
	src/imap/client.h, src/imap/cmd-cancelupdate.c, src/imap/cmd-
	close.c, src/imap/cmd-delete.c, src/imap/cmd-logout.c, src/imap/cmd-
	search.c, src/imap/cmd-select.c, src/imap/cmd-unselect.c,
	src/imap/commands.c, src/imap/commands.h, src/imap/imap-sync.c, src
	/lib-storage/Makefile.am, src/lib-storage/index/Makefile.am, src
	/lib-storage/index/index-search.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-sync-private.h, src/lib-
	storage/index/index-sync-search.c, src/lib-storage/index/index-
	sync.c, src/lib-storage/mail-search.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/lib-storage/mailbox-search-result-private.h, src/lib-
	storage/mailbox-search-result.c:
	Implemented CONTEXT=SEARCH extension.
	[879208fdc7e3]

	* src/lib/seq-range-array.c, src/lib/seq-range-array.h:
	Added seq_range_array_merge()
	[f0dc2a3dee54]

	* src/imap/cmd-search.c:
	Extended UID SEARCH should include UID in the ESEARCH reply.
	[3215e880909f]

	* src/imap/cmd-expunge.c:
	Crashfix to previous search args commit.
	[eb17957ee1fe]

2008-06-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-storage.c:
	Keep mail_search_args referenced during searches.
	[803e3574f4f5]

	* src/imap/cmd-copy.c, src/imap/cmd-expunge.c, src/imap/cmd-fetch.c,
	src/imap/cmd-search.c, src/imap/cmd-select.c, src/imap/cmd-sort.c,
	src/imap/cmd-store.c, src/imap/cmd-thread.c, src/imap/imap-
	expunge.c, src/imap/imap-expunge.h, src/imap/imap-fetch.c, src/imap
	/imap-fetch.h, src/imap/imap-search.c, src/imap/imap-search.h,
	src/imap/imap-sort.c, src/imap/imap-sort.h, src/imap/imap-thread.c,
	src/imap/imap-thread.h, src/lib-storage/index/index-search.c, src
	/lib-storage/index/index-storage.h, src/lib-storage/mail-search-
	build.c, src/lib-storage/mail-search-build.h, src/lib-storage/mail-
	search.c, src/lib-storage/mail-search.h, src/lib-storage/mail-
	storage-private.h, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h, src/plugins/convert/convert-storage.c,
	src/plugins/expire/expire-tool.c, src/plugins/fts-squat/fts-backend-
	squat.c, src/plugins/fts/fts-search.c, src/plugins/fts/fts-
	storage.c, src/plugins/fts/fts-storage.h, src/plugins/mbox-snarf
	/mbox-snarf-plugin.c, src/plugins/quota/quota-count.c,
	src/plugins/quota/quota-storage.c, src/plugins/trash/trash-plugin.c,
	src/pop3/client.c, src/pop3/commands.c:
	Make mail_search_args an independent structure that can be used for
	multiple separate searches.
	[077bb84e9e77]

2008-03-16  Timo Sirainen  <tss@iki.fi>

	* README:
	Updated conformed RFCs list
	[d5cae1f5fb6a]

	* configure.in, src/lib-storage/index/index-search.c, src/lib-storage
	/mail-search-build.c, src/lib-storage/mail-search.h:
	Implemented WITHIN extension.
	[c78e9204f3f2]

	* configure.in, src/imap/client.c, src/imap/client.h, src/imap/cmd-
	copy.c, src/imap/cmd-expunge.c, src/imap/cmd-fetch.c, src/imap/cmd-
	search.c, src/imap/cmd-sort.c, src/imap/cmd-store.c, src/imap/cmd-
	thread.c, src/imap/imap-fetch.c, src/imap/imap-search.c, src/imap
	/imap-search.h, src/lib-storage/mail-search-build.c, src/lib-storage
	/mail-search-build.h:
	Implemented SEARCHRES extension.
	[03146f02403f]

	* src/lib-storage/mail-search-build.c:
	Fixed SEARCH UID
	[7f57fd10c9bd]

	* configure.in, src/imap/cmd-search.c:
	Implemented ESEARCH extension
	[cf0cce4b0e4e]

	* src/imap/imap-search.c:
	Messageset 1,* was thought of as invalid
	[8ca66e0ac4ed]

	* src/imap/client.h, src/imap/cmd-expunge.c, src/imap/imap-sync.c:
	EXPUNGE: Send HIGHESTMODSEQ only if something was actually expunged.
	[19327e95a787]

	* src/imap/imap-expunge.c:
	Use MAILBOX_TRANSACTION_FLAG_REFRESH to make sure we see the latest
	\Deleted flags before expunging.
	[3980292275ab]

	* src/imap/client.c, src/imap/cmd-select.c:
	If CONDSTORE is enabled only after mailbox has been selected, send
	HIGHESTMODSEQ so client knows if it had missed some changes.
	[27a0de620b0c]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-close.c, src/imap
	/cmd-expunge.c, src/imap/cmd-select.c, src/imap/cmd-unselect.c,
	src/imap/imap-expunge.c, src/imap/imap-expunge.h:
	Fixed CLOSE HIGEHSTMODSEQ race condition. Added some checks to make
	sure mailbox isn't being closed/opened while the previous
	SELECT/CLOSE is still being processed.
	[6e2e4e5c52f3]

	* src/imap/cmd-store.c, src/lib-storage/index/index-transaction.c, src
	/lib-storage/mail-storage.h:
	Added MAILBOX_TRANSACTION_FLAG_REFRESH. Use it with STORE
	UNCHANGEDSINCE.
	[5d3b6a766032]

2008-03-15  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Added CONDSTORE and QRESYNC capabilities
	[7d208a7e0cbd]

	* src/imap/client.h, src/imap/cmd-close.c, src/imap/cmd-copy.c,
	src/imap/cmd-enable.c, src/imap/cmd-expunge.c, src/imap/cmd-fetch.c,
	src/imap/cmd-search.c, src/imap/cmd-select.c, src/imap/cmd-store.c,
	src/imap/imap-fetch.c, src/imap/imap-fetch.h, src/imap/imap-
	search.c, src/imap/imap-search.h, src/imap/imap-sync.c, src/lib-
	index/mail-index-modseq.c, src/lib-index/mail-index-modseq.h, src
	/lib-storage/index/cydir/cydir-storage.c, src/lib-storage/index/dbox
	/dbox-storage.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/index/raw/raw-storage.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/util/idxview.c:
	Added QRESYNC support.
	[bad3a811a148]

	* src/lib/seq-range-array.c, src/lib/seq-range-array.h:
	Added seq_range_array_iter_nth()
	[af2441dc6de6]

	* src/lib-index/mail-index-modseq.c, src/lib-index/mail-index-
	modseq.h:
	Left out from initial CONDSTORE commit.
	[4fd41f9467ea]

	* src/lib-index/mail-index-view-sync.c:
	Crashfix for previous view sync change
	[96207583aaa0]

	* src/imap/cmd-search.c, src/lib-index/mail-index-sync-ext.c, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-search.c:
	CONDSTORE fixes
	[98a03cf8ad5d]

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index.h,
	src/lib-storage/index/index-sync.c:
	View sync returns now also hidden records, but they're marked as
	such. Mailbox syncing returns hidden records as modseq changes.
	[271131a1e060]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c:
	Keep view's map always at least up-to-date with syncing. If there
	have been no expunges, the map is immediately replaced with the
	latest map. Before the map may not have been updated until syncing
	was finished. This change is necessary to update modseqs correctly
	while they're being enabled.
	[1285aedb353c]

2008-03-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	MAIL_INDEX_TRANSACTION_FLAG_AVOID_FLAG_UPDATES: Don't crash if
	trying to add keywords to newly added messages.
	[23bbefd2ef4e]

2008-03-13  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/imap/cmd-enable.c,
	src/imap/commands.c, src/imap/commands.h:
	Added support for ENABLE extension.
	[bec7141872eb]

2008-03-15  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-copy.c, src/imap/cmd-fetch.c, src/imap/cmd-search.c,
	src/imap/cmd-select.c, src/imap/cmd-store.c, src/imap/imap-fetch.c,
	src/imap/imap-fetch.h, src/imap/imap-status.c, src/imap/imap-sync.c,
	src/lib-imap/imap-util.c, src/lib-imap/imap-util.h, src/lib-
	index/Makefile.am, src/lib-index/mail-index-map.c, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index-sync-ext.c, src/lib-
	index/mail-index-sync-keywords.c, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-transaction.c, src/lib-index/mail-index-view-sync.c, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	storage/index/cydir/cydir-mail.c, src/lib-storage/index/cydir/cydir-
	storage.c, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/index-mail.h, src/lib-storage/index
	/index-search.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-transaction.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/raw/raw-
	mail.c, src/lib-storage/index/raw/raw-storage.c, src/lib-storage
	/mail-search-build.c, src/lib-storage/mail-search.h, src/lib-storage
	/mail-storage-private.h, src/lib-storage/mail-storage.c, src/lib-
	storage/mail-storage.h, src/lib-storage/mail.c:
	Initial CONDSTORE support.
	[4b8c1c164d8f]

2008-03-14  Timo Sirainen  <tss@iki.fi>

	* src/imap/Makefile.am, src/imap/cmd-search.c, src/imap/imap-
	messageset.c, src/imap/imap-messageset.h, src/imap/imap-search.c,
	src/imap/imap-search.h, src/lib-imap/Makefile.am, src/lib-imap/imap-
	messageset.c, src/lib-imap/imap-messageset.h, src/lib-
	storage/Makefile.am, src/lib-storage/index/index-search.c, src/lib-
	storage/mail-search-build.c, src/lib-storage/mail-search-build.h,
	src/lib-storage/mail-search.h, src/plugins/fts/fts-storage.c,
	src/pop3/commands.c:
	Moved IMAP messageset handling to lib-imap/ and searching to lib-
	storage/. Rewrote messageset handling to use struct seq_range
	instead.
	[56f55bd35aa5]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-search.h:
	Added support for SEARCH_UIDSET.
	[6dbd70663adf]

2008-06-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-storage.c:
	mailbox_sync(): Don't call mailbox_sync_next() - it's not necessary
	and it just slows down the syncing.
	[d8d1fdbe29bf]

	* src/lib-storage/index/index-sync.c:
	Minor code cleanup
	[dcdf6f9e1fc0]

2008-06-07  Timo Sirainen  <tss@iki.fi>

	* src/lib/failures.c:
	If writing to log failed with EAGAIN (shouldn't normally happen),
	waiting for the log fd to be writable again was buggy.
	[7c9895192a23]

2008-06-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-sort-string.c:
	sort index: Try to catch broken sort_ids and recreate them correctly
	instead of assert-crashing.
	[dd899a1841d9]

	* src/lib-storage/index/index-sort-string.c:
	sort index: Messages without sort_id weren't sorted correctly on
	secondary sort conditions.
	[63602977ca9b]

	* src/lib-storage/index/index-sort-string.c:
	sort index: Removed some optimization checks that wouldn't always be
	true, causing bad results.
	[5824e6f1d279]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir: Write dovecot-uidlist before syncing index to make sure
	that any new messages' filenames are available immediately when
	they're seen in index.
	[5f481022db04]

2008-06-04  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/auth/mech-gssapi.c:
	gssapi: Check for gssapi_krb5.h existence before trying to use it.
	[280e570a5ced]

	* src/lib-storage/index/index-sort-string.c:
	sort index: Fixed infinite looping.
	[c008dde3c973]

2008-06-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c:
	mbox: Empty lines were inserted in the middle of saved mails'
	headers.
	[e043135e971d]

	* src/auth/passdb.c:
	auth_debug_passwords: Include the password when logging about
	"Requested x scheme, but we have only y".
	[ff3adeb71d47]

	* NEWS:
	Changed deliver -c parameter to -p parameter, which is the correct
	one.
	[c88c1365b60d]

	* src/deliver/deliver.c:
	deliver: Added -p parameter to help.
	[bb47eb08015f]

	* .hgtags:
	Added tag 1.1.rc8 for changeset 58c7f5c31db1
	[098539c6d034]

	* NEWS, TODO, configure.in:
	Released v1.1.rc8.
	[58c7f5c31db1] [1.1.rc8]

2008-06-02  Timo Sirainen  <tss@iki.fi>

	* src/plugins/expire/expire-plugin.c:
	expire plugin: Pass username to dict_init().
	[d73cc550b389]

	* src/lib-dict/dict.c:
	dict: Added assert to make sure username is never NULL.
	[04cb8f657b65]

	* src/lib-storage/index/dbox/dbox-file-maildir.c:
	Compiler warning fix
	[09f98612f10d]

	* src/lib-storage/index/mbox/mbox-save.c:
	mbox: We always add end-of-headers line while saving the message, so
	make sure the parsing code also sees it and updates cache correctly.
	[d5588b153cf6]

	* src/lib-mail/istream-header-filter.c, src/lib-mail/istream-header-
	filter.h:
	header filter istream: Added HEADER_FILTER_ADD_MISSING_EOH flag to
	add end-of-headers line if it's missing.
	[50120b047f0a]

	* src/lib-mail/message-parser.c:
	If cached message part showed header's size to be smaller than in
	reality, return "broken" instead of assert-crashing.
	[f27e6f583817]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	dbox: Forgot to add pop3.uidl cache variables in previous commit.
	[60733457ea20]

	* src/tests/Makefile.am:
	Link test-imap with libcharset.a as well (required by some linkers)
	[cb55e435b79e]

	* src/lib-storage/index/dbox/dbox-sync-rebuild.c:
	dbox sync rebuilding: Don't leave all maildir file fds open until
	the end of sync. It can cause too many open files.
	[8ae5268762b5]

	* src/lib-storage/index/dbox/dbox-file-maildir.c, src/lib-
	storage/index/dbox/dbox-file.h, src/lib-storage/index/dbox/dbox-
	mail.c, src/lib-storage/index/dbox/dbox-sync-file.c:
	dbox: Use POP3 UIDLs from metadata if they exist.
	[2d367594b41c]

	* src/lib-storage/index/dbox/dbox-file-maildir.c, src/lib-
	storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox/dbox-
	sync-file.c:
	dbox: When converting maildir-format file to native dbox format, be
	sure to set received/save dates in metadata. Try to write virtual
	size as well if it exists in the maildir filename.
	[c53e20911f07]

	* src/deliver/deliver.c, src/lib-storage/index/maildir/maildir-copy.c,
	src/lib-storage/index/raw/raw-mail.c, src/lib-storage/index/raw/raw-
	storage.c, src/lib-storage/index/raw/raw-storage.h:
	deliver: Added -c parameter to provide path to delivered mail. This
	allows maildir to save it using hard links.
	[a1a146de3ccc]

	* src/lib-storage/index/maildir/maildir-copy.c:
	maildir copy: Try to use hard linking also between different
	namespaces.
	[76bc7f7e1d60]

	* src/lib-storage/index/dbox/dbox-file.c:
	dbox: Fixed opening a maildir-converted file.
	[f681e55f5c60]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	dbox: Crashfix when using old maildir files.
	[ffa9c0dc27a7]

	* src/lib-storage/index/dbox/dbox-file-maildir.c:
	dbox: If converted maildir filenames don't contain ,W=<vsize>, don't
	return broken values.
	[0fad9c4d0146]

	* src/plugins/convert/convert-storage.c:
	maildir -> dbox conversion: Create the destination mailbox so the
	conversion won't fail with rename() error.
	[40a660972c70]

	* src/lib-storage/index/dbox/dbox-storage.c:
	dbox: Support creating non-selectable mailboxes ("directories").
	[326ca0ed8983]

2008-05-31  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	Rewrite X-IMAPbase: header before updating index file header, so
	that we write the latest mtime as sync_stamp.
	[e528d9e3cdc8]

	* src/imap/client.c:
	Don't try to call a cancelled command if it hasn't started running.
	Cancel the input-waiting command last. These should fix "Trying to
	close mailbox with open transactions" assert when client
	disconnects.
	[a99b9735f875]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/maildir
	/maildir-mail.c, src/pop3/commands.c:
	MAIL_FETCH_UIDL_BACKEND crashed with non-maildir backends. Changed
	the API a bit and fixed/cleaned/optimized POP3 UIDL listing a bit.
	[8e7a15987428]

2008-05-30  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.1.rc7 for changeset 290bd8b0c2d7
	[89041c61c10b]

	* NEWS, configure.in:
	Released v1.1.rc7.
	[290bd8b0c2d7] [1.1.rc7]

	* src/tests/Makefile.am:
	Link test-imap with libmail.a as well (required by some linkers)
	[e2497df7cf3f]

	* src/lib/compat.h:
	Previous fix broke CMP_ST_CTIME() nsec checks.
	[5766890f1275]

	* src/lib/compat.h:
	Fixed compiling in BSD systems.
	[0d842b055838]

	* .hgtags:
	Added tag 1.1.rc6 for changeset 79857a116d28
	[eb8334db63a7]

	* NEWS, TODO, configure.in:
	Released v1.1.rc6.
	[79857a116d28] [1.1.rc6]

	* src/lib-storage/index/index-mail-headers.c:
	When saving new messages, make sure we parse the "Date" header so we
	can add "date.sent" to cache file even if "hdr.Date" isn't added.
	[346f172c8c71]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log-file.c, src/lib-index/mail-
	transaction-log.c, src/lib-index/mail-transaction-log.h:
	Fixes to handling races in initial index creation.
	[de08cc81da73]

2008-05-29  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-search.c:
	SEARCH/SORT/THREAD: If search parameters are missing, return a clear
	error message.
	[b7fcace54fad]

	* src/imap/cmd-sort.c, src/imap/cmd-thread.c:
	If SORT/THREAD has invalid search parameters, return BAD instead of
	NO.
	[443dcddf9a9a]

	* src/lib-storage/index/maildir/maildir-mail.c, src/lib-storage/mail-
	storage.h, src/pop3/commands.c:
	Maildir: If POP3 UIDL extra field is found from dovecot-uidlist,
	it's used instead of the default UIDL format (or X-UIDL: header).
	Patch by Nicholas Von Hollen @ Mailtrust.
	[2220b2aa9f7c]

	* src/lib-storage/index/index-sort-string.c:
	Sort index optimization: Don't write changes to sort IDs if we're
	doing it only to give sort ID space to expunged messages.
	[ea913434d522]

	* src/lib-storage/index/index-sort-string.c:
	Sort index: Fix to renumbering sort IDs.
	[66e6b61680a5]

	* src/lib-storage/index/index-sort-string.c:
	Sort index: Handle reset_id growing while adding non-wanted messages
	to sort list.
	[9c0d2413735d]

	* src/lib-storage/index/index-sort-string.c:
	Fixes to sort indexing.
	[8ae86f73f80d]

	* src/util/logview.c:
	logview: Show ext reset.preserve_data.
	[6930859e7a5a]

	* src/lib-storage/index/Makefile.am, src/lib-storage/index/index-sort-
	private.h, src/lib-storage/index/index-sort-string.c, src/lib-
	storage/index/index-sort.c:
	Message sort index handling rewrite to fix several race conditions
	when multiple processes are sorting at the same time. Also fixes
	sorting to work correctly with 64bit timestamps and file sizes.
	[4a9ce9df52c5]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index-sync-
	ext.c, src/lib-index/mail-index-sync-update.c, src/lib-index/mail-
	index-transaction-private.h, src/lib-index/mail-index-transaction.c,
	src/lib-index/mail-index.h, src/lib-index/mail-transaction-log-
	append.c, src/lib-index/mail-transaction-log.h, src/lib-
	storage/index/dbox/dbox-sync-rebuild.c:
	Added mail_index_ext_reset_inc() to atomically increase extension's
	reset_id. Added clear_data parameter to mail_index_ext_reset*().
	[6de1aed24ce5]

2008-05-28  Timo Sirainen  <tss@iki.fi>

	* src/lib/failures.c:
	Print raw backtrace when dying with out-of-memory (with all log
	backends).
	[4c702defc245]

2008-05-27  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-master-listener.c, src/auth/db-passwd-file.c, src/auth
	/userdb-nss.c, src/deliver/auth-client.c, src/deliver/deliver.c,
	src/deliver/duplicate.c, src/deliver/duplicate.h, src/imap/imap-
	fetch-body.c, src/imap/imap-thread.c, src/lib-imap/imap-date.c, src
	/lib-imap/imap-date.h, src/lib-index/mail-cache-compress.c, src/lib-
	index/mail-index-map.c, src/lib-mail/mbox-from.c, src/lib-mail/mbox-
	from.h, src/lib-mail/message-date.c, src/lib-mail/message-date.h,
	src/lib-storage/index/dbox/dbox-index.c, src/lib-storage/index
	/index-sync.c, src/lib-storage/index/mbox/mbox-sync.c, src/lib-
	storage/list/mailbox-list-fs-iter.c, src/lib/module-dir.c, src/lib
	/restrict-access.c, src/master/dict-process.c,
	src/master/listener.c, src/master/mail-process.c, src/master/mail-
	process.h, src/master/master-settings.c, src/plugins/fts-squat
	/squat-trie.c, src/plugins/quota/quota-fs.c, src/util/idxview.c,
	src/util/rawlog.c:
	Avoid using shadow variables. Unfortunately -Wshadow also complains
	about index variable conflicting with index(), which is used in way
	too many places to change.
	[1a58b18652a6]

	* src/lib-storage/index/mbox/mbox-save.c:
	mbox: Be sure to flush output when writing to non-seekable "mboxes"
	(pipes).
	[fedeb23a3d53]

	* src/lib-storage/index/mbox/mbox-save.c:
	mbox: When saving messages buffer the output until it's full, so if
	we die at the beginning we don't just leave a single From_-line.
	[dd9d344ba140]

2008-05-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Minor cleanup to previous commit.
	[a1ba58f7d695]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	If dovecot-uidlist contains a filename with '/', log an error and
	recreate the uidlist instead of assert-crashing.
	[5532bc0eb7bc]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Code cleanup
	[ded075753258]

	* configure.in:
	Prefix AC_CACHE_CHECK variables with i_cv_.
	[47c5e52c1181]

	* configure.in:
	Once $KRB5_CFLAGS is set, use it instead of calling krb5-config
	again.
	[419b7cfc954c]

2008-05-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mailbox-tree.c:
	Don't crash if subscribed mailbox begins with hierarchy separator.
	[0e0054c0da66]

	* src/imap/cmd-subscribe.c:
	If SUBSCRIBE or UNSUBSCRIBE fails, we returned "Unknown error".
	[f0600e9db643]

	* src/plugins/expire/auth-client.c:
	expire-tool: Fixed changing uid/gid.
	[5b27f5cbf016]

	* src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-uidlist.c:
	Maildir: Moved uidlist refreshing to maildir_uidlist_lookup() where
	it benefits all callers.
	[d920ec986c34]

	* src/lib-index/mail-transaction-log-view.c:
	Fixed previous transaction log assert-avoidance check.
	[e54ca78ce35f]

	* configure.in:
	Fixed GSSAPI checks. Perhaps it works now with Solaris krb5-config
	also.
	[e6187b556b65]

	* src/lib-index/mail-index-map.c:
	If index file's header shows that it's unusable (e.g. major version
	change or CPU arch change), make sure they're not tried to be used
	and handle the rebuilding nicely.
	[baf21d1db4e5]

	* src/lib-index/mail-transaction-log-file.c:
	When creating a new transaction log, don't reuse an existing one if
	its sequence isn't 1.
	[7940ff8ecd13]

	* src/lib-index/mail-transaction-log-view.c:
	Avoid assert-crashing with broken transaction log files.
	[2c3bb09045be]

	* src/plugins/fts-squat/squat-trie.c:
	squat: Flush NFS caches.
	[7512b6d8afe1]

	* src/lib-storage/index/dbox/dbox-save.c:
	dbox: fdatasync() when saving.
	[8a4ac809d472]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-save.c:
	dbox: Don't write message UID to u.* files' header, since the
	filename itself specifies the UID already. When reading u.* files
	ignore the UID field completely. This would allow hard linking u.*
	files, but the metadata will then contain only a single mailbox's
	flags+keywords.
	[cf924043234d]

	* src/lib-storage/index/dbox/dbox-mail.c:
	dbox error handling fix
	[a2a199667c05]

	* src/lib-storage/index/dbox/dbox-file.c:
	dbox: Some mails could have been written using m.* files, even
	though everything was supposed to be u.* for now.
	[30a97495c7bf]

	* dovecot-example.conf, src/lib-storage/index/mbox/mbox-storage.c:
	mbox: If INBOX creation fails because of EACCES, try with privileged
	group enabled.
	[dd378ab0263e]

	* src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	Maildir: If dovecot-uidlist has wrong cached virtual size, remove it
	when we detect it. If maildir filename has wrong W value, log a
	clear error about it.
	[abdf9e06a956]

	* src/lib/ioloop.c:
	timeout_add(0, ..) was looping in timeout handling code.
	[d432ef4835e3]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index.h:
	Make sure MAIL_RECENT flag is cleared from index file's flags so it
	can be used in future for other purposes. Increased minor version
	number because of this.
	[b6b3ea77e83e]

	* src/plugins/zlib/zlib-plugin.c:
	zlib plugin: Uncompress if the message begins with zlib header
	instead of looking at the 'Z' flag. This fixes copying with hard
	links. Based on a patch by Richard Platel.
	[0b9a5a7a0b3e]

	* src/imap/cmd-list.c:
	LIST X-STATUS: Send LIST reply before STATUS reply.
	[9c781d042afe]

2008-05-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c:
	dbox & cydir: If mailbox doesn't exist, return it as \nonexistent
	instead of \noselect.
	[7690cdabb3f8]

	* src/lib-storage/list/mailbox-list-fs-iter.c:
	Mailbox flags could have been wrong with filesystem layout.
	[bf8227a34937]

	* src/imap/cmd-list.c:
	LIST-EXTENDED: CHILDINFO shouldn't be quoted.
	[0cd3db11a42f]

2008-05-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Compile fix
	[e29dafc501cc]

2008-05-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir uidlist: Include old and new UID in "Duplicate file entry"
	warning.
	[6ab2ccae0868]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Maildir error handling fixes if appending to uidlist failed.
	[4a0e2927a232]

	* src/lib/ioloop-notify-kqueue.c:
	kqueue: If opening a file fails with ESTALE, don't log an error. It
	probably just means the file was deleted by another NFS client.
	[20c6e9545d56]

	* configure.in, src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib/compat.h:
	Replaced HAVE_ST_NSEC macro checks with more generic ST_?TIME_NSEC()
	macros for getting the nanosecond and ST_NTIMES_EQUAL() macro for
	comparing them. Added support for BSD st_?timespec fields.
	[a957567706ec]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Fixed compiling on systems without nanoseconds in struct stat.
	[4c70d5f54409]

2008-05-16  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c, src/imap/commands.h:
	If client tries to change the selected mailbox state while another
	command is still running, wait until the command is finished.
	[c4342385d696]

	* src/lib/var-expand.c:
	Added %T = trim modifier.
	[15ddb7513e2d]

2008-05-15  Timo Sirainen  <tss@iki.fi>

	* src/tests/test-lib.c:
	buffer test failed if stack wasn't cleared by OS.
	[abb4d2011b52]

	* src/lib-storage/index/maildir/maildir-mail.c:
	If file isn't found from uidlist, refresh the file and look again in
	case it was added after the previous mailbox sync (but after the
	previous view sync that found new messages).
	[cb1c6c942768]

	* src/lib/network.c:
	net_is_in_network(): Fixed to work with big endian machines.
	[85203e817f90]

	* src/tests/test-lib.c:
	net_is_in_network(): Added IPv6 unit tests
	[4ba3de34eaa4]

	* src/lib/failures.c:
	"Can't open log file" error was missing linefeed.
	[45a4fe590389]

	* src/auth/auth-request.c, src/lib/network.c, src/lib/network.h,
	src/tests/test-lib.c:
	Moved net_is_in_network() to lib/network.c.
	[e0007da64cdc]

	* src/util/idxview.c:
	Show the new uidlist_* fields in maildir header.
	[7a7cf6662302]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-sync.h, src/lib-storage/index/maildir/maildir-uidlist.c,
	src/lib-storage/index/maildir/maildir-uidlist.h:
	Keep track of dovecot-uidlist mtime+size in index file. If it's up-
	to-date (and unless indexes weren't updated at some point, it always
	is) and we're saving a new message, don't bother reading the uidlist
	contents.
	[c14a2b0a3126]

	* src/lib-storage/index/maildir/maildir-save.c:
	More maildir saving code cleanups
	[3b818654abfa]

	* src/lib-storage/index/maildir/maildir-save.c:
	Fix to previous cleanup.
	[b2e844f4214b]

	* src/lib-storage/index/maildir/maildir-save.c:
	Code cleanup
	[534d93ab2fac]

2008-05-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c:
	W=<vsize> is now always added to maildir filenames (the code was
	accidentally commented out).
	[f96fd5c97375]

2008-05-11  Diego Liziero  <diegoliz@gmail.com>

	* src/lib/data-stack.c:
	make outofmem_area static
	[553f26afc900]

2008-05-09  Timo Sirainen  <tss@iki.fi>

	* src/lib/data-stack.c:
	Removed unused variable popped_frame_pos. Patch by Diego Liziero.
	[89a0a4e1f918]

2008-05-07  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	If SSL function fails and there are no errors, return "Unknown
	error" instead of "Success" as the reason.
	[bec3cd8e8151]

2008-05-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-mail.c:
	If we lose a maildir filename, make sure the message gets marked as
	expunged in index.
	[b776f2b8d827]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Removed a bad assert.
	[118ae423dbc4]

2008-05-05  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-notify-inotify.c:
	If inotify_add_watch() fails, log an error.
	[3c0dd5c29aca]

	* src/lib/ioloop-notify-inotify.c:
	If inotify instance limit is reached, give a hint about
	max_user_instances file that can be increased.
	[31e1382b315f]

	* .hgtags:
	Added tag 1.1.rc5 for changeset 3b09af6458e5
	[0a80134510b1]

	* NEWS, TODO, configure.in:
	Released v1.1.rc5.
	[3b09af6458e5] [1.1.rc5]

	* src/lib-dict/dict-db.c, src/lib-sql/driver-mysql.c, src/lib-
	storage/index/dbox/dbox-sync-rebuild.c:
	Added ATTR_UNUSED to function parameters that won't be implemented
	for v1.1.
	[c6e9fd175bdf]

	* src/login-common/ssl-proxy-openssl.c:
	Free OpenSSL memory at deinit.
	[74e2c7b68c71]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Removed accidentally committed debug sleep().
	[23651c111fbd]

	* src/plugins/acl/acl-mailbox.c:
	ACL: If any of the flag set rights were given, STORE FLAGS allowed
	replacing all flags (+/-FLAGS worked correctly).
	[85b48992cc97]

	* src/plugins/acl/acl-mailbox.c:
	ACL: If we don't have 'w' access, don't allow creating new keywords.
	[1c1dc9d1f383]

2008-05-04  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-mailbox-list.c:
	ACL plugin was listing mailboxes directly from dovecot-acl-list. It
	was supposed to be used only as an optimization to avoid looking
	into all mailboxes to see which ones contained dovecot-acl files.
	[036d06b57bd1]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/istream-raw-mbox.c,
	src/lib-storage/index/mbox/mbox-storage.c, src/lib-storage/index/raw
	/raw-storage.c, src/lib-storage/list/mailbox-list-fs-iter.c, src
	/lib-storage/list/mailbox-list-maildir-iter.c, src/lib-storage
	/mailbox-list-private.h:
	Added mailbox_name parameter to mailbox_list.iter_is_mailbox().
	[7f7003bcf422]

	* src/lib-storage/list/mailbox-list-subscriptions.c, src/lib-storage
	/mailbox-list-private.h, src/lib-storage/mailbox-list.c:
	mailbox_list_iter_update() was always setting subscribed flags to
	processed nodes. Changed the API so the flags can be specified.
	[2dd86c2f8efb]

	* src/lib-storage/list/mailbox-list-maildir-iter.c:
	maildir++ LIST (subscribed): If listing finds a non-subscribed
	mailbox under a subscribed one, mark the subscribed one as having
	children.
	[3d5379e33664]

	* src/imap/cmd-list.c:
	LIST-EXTENDED options were ignored.
	[ae8a3595d707]

	* src/lib/mempool-alloconly.c:
	DEBUG: Fixes to calculating minimum initial pool size in debug mode.
	[33d6be3b5c01]

	* src/lib-storage/index/mbox/mbox-save.c:
	mbox: Always update sync_size when saving mails. We rely on
	sync_size for getting the last message's physical size.
	[e935b36b8b65]

	* src/lib-storage/index/mbox/mbox-mail.c:
	Getting "next message's offset" was broken if a new message had been
	added recently. This broke message size calculations.
	[80d827b411c8]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Added assert.
	[9bef11f4faf6]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-mail.c:
	Error message improvements.
	[6dfa085a49d6]

	* dovecot-example.conf, src/deliver/auth-client.c, src/master/mail-
	process.c:
	If mail_chroot ends with "/.", remove chroot prefix from home
	directory.
	[9edaf878bb96]

	* src/auth/auth-stream.c, src/auth/db-passwd-file.c, src/lib-index
	/mail-index-map.c, src/lib-mail/istream-header-filter.c, src/lib
	/env-util.c:
	Memory pool allocation tweaks.
	[8bed019c834d]

	* src/lib/mempool-alloconly.c:
	Use smaller sentries between allocations. Larger ones make "Growing
	memory pool" warnings pointless, because most of the space is wasted
	on sentries. A smaller sentry will still catch most of the buffer
	overflows.
	[96f724a4a1a0]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c:
	mbox_lazy_writes: If errors are noticed in mbox, write changes to
	fix them immediately to avoid constant errors in logs.
	[591145eaaf87]

	* src/plugins/expire/expire-plugin.c, src/plugins/expire/expire-
	tool.c:
	Handle dict_init() and dict_lookup() failures without crashing.
	[955ae7b7ad1a]

	* doc/dovecot-db.conf, dovecot-example.conf, src/master/dict-
	process.c, src/master/master-settings-defs.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added dict_db_config setting to point to a Berkeley DB config file.
	[768231eb84cf]

	* src/auth/mech-gssapi.c:
	Don't use krb5_get_error_message(), it doesn't work with Heimdal
	Kerberos.
	[ad0f32abda6d]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-mail.c:
	mbox: Don't stop at From_-lines in the message bodies. Use Content-
	Length: header to figure out if it belongs to a message body or not.
	[7871b6219480]

	* src/master/login-process.c:
	The previous gdb check should be done only with --enable-debug.
	[0eb6a0c01001]

	* src/auth/mech-gssapi.c:
	Support cross-realm krb5 authentication. Based on patch by Zachary
	Kotlarek.
	[841209428d2d]

	* src/plugins/quota/quota-maildir.c:
	When updating maildir quota create also missing maildirsize file and
	make sure the limits in the header are up-to-date.
	[2475c57fadb0]

	* src/master/login-process.c:
	Don't restrict login process fd limits when running with GDB=1.
	[4407ef392711]

	* src/deliver/deliver.c:
	deliver -e: Write the error string to stderr also with tempfails.
	[40929ce03622]

	* src/deliver/auth-client.c:
	mail_uid and mail_gid settings weren't handled correctly.
	[1b15881ed93b]

	* src/lib-storage/index/dbox/dbox-index.c, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib/file-lock.c:
	If fcntl() fails with EACCES, give a more understandable error
	message since it's more similar to EAGAIN than anything to do with
	permissions.
	[aa41caaf8e0b]

	* src/master/auth-process.c:
	If auth process dies at startup, deinitialize logs properly so that
	any pending log messages from auth process get logged before we kill
	ourself.
	[e7e3d6ffb0c1]

	* src/plugins/quota/quota-count.c, src/plugins/quota/quota-dict.c,
	src/plugins/quota/quota-maildir.c, src/plugins/quota/quota-
	private.h, src/plugins/quota/quota.c:
	Added "ignore" option to quota rules which causes the mailbox to be
	ignored when counting quota.
	[73368107aeda]

2008-04-30  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c, src/plugins/acl/acl-cache.c,
	src/plugins/acl/acl-mailbox-list.c:
	Fixed several memory leaks in ACL plugin.
	[ba634d2c0ab9]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Use a larger initial mbox keywords pool size.
	[080dd4d2fd94]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Fixed updating first_recent_uid in index header.
	[abc88e664e63]

	* src/lib/mempool-alloconly.c:
	DEBUG: Make sure mempool's initial size is large enough to account
	for extra sentries.
	[f5af6ce6376f]

2008-04-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c:
	Static attributes were broken in user_attrs.
	[6c6af734f284]

	* src/lib-storage/index/index-sync.c, src/lib-storage/index/maildir
	/maildir-sync-index.c:
	Fixes to handling recent flags with UIDVALIDITY changing.
	[4dc5542f58aa]

	* src/lib-storage/index/dbox/dbox-sync-rebuild.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Reset cached \Recent flags if UIDVALIDITY changes, because we were
	using UIDs in the cache.
	[d1bd08d468d0]

	* src/plugins/acl/acl-mailbox-list.c, src/plugins/acl/acl-storage.c,
	src/plugins/convert/convert-plugin.c, src/plugins/expire/expire-
	plugin.c, src/plugins/fts/fts-storage.c, src/plugins/lazy-expunge
	/lazy-expunge-plugin.c, src/plugins/mail-log/mail-log-plugin.c,
	src/plugins/mbox-snarf/mbox-snarf-plugin.c, src/plugins/quota/quota-
	storage.c, src/plugins/zlib/zlib-plugin.c:
	next_hook should be called after our hook is finished with its
	doings, that way they get executed in the intended order. This
	should fix some problems when multiple plugins are used.
	[068f6eefc62b]

	* src/plugins/acl/acl-cache.h:
	SIZEOF_ACL_MASK() macro wasn't used as it was intended. Changed so
	it allocates enough memory for the struct.
	[bf99bd33d69b]

	* src/plugins/expire/expire-env.c:
	Expire plugin wasn't working unless expire_altmove was also defined.
	[e1fe3d080314]

2008-04-24  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-notify-dn.c:
	Better error handling for dnotify failures.
	[63cd8ec2007a]

	* src/lib-storage/index/dbox/dbox-storage.c:
	If mailbox hasn't been opened when closing it, don't crash when
	trying to flush dirty flags.
	[43674a726a92]

	* src/lib/file-dotlock.c, src/lib/ioloop-notify-dn.c, src/lib/ioloop-
	notify-inotify.c, src/lib/ioloop-notify-kqueue.c, src/lib/ioloop-
	notify-none.c, src/lib/ioloop.h:
	Renamed IO_NOTIFY_DISABLED to IO_NOTIFY_NOSUPPORT.
	IO_NOTIFY_NOSUPPORT is now also given by dnotify when trying to
	listen for files. Fixes busy looping with dnotify when waiting for
	dotlock to get deleted.
	[940641318f12]

	* src/lib/file-dotlock.c:
	Comment updates
	[8af71985e97b]

	* src/auth/db-ldap.c:
	Allow %variables in static LDAP fields.
	[0dbf10f4493a]

	* src/imap-login/imap-proxy.c, src/pop3-login/pop3-proxy.c:
	Send the success reply in one write. Based on patch by Onno
	Molenkamp.
	[053ec63146cb]

	* src/pop3/client.c:
	If remote disconnects, log "Connection closed: reason" just like
	IMAP does.
	[3353ddd8ac9f]

2008-04-18  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Namespace inbox setting defaults to "no", not "yes".
	[29518d8b5029]

2008-04-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-gssapi.c:
	GSSAPI: Show username in "autn_name and authz_name differ" error.
	[4a64c2f8e194]

2008-04-01  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.1.rc4 for changeset 4607141a6bdc
	[3f8b51994ebb]

	* NEWS, TODO, configure.in:
	Released v1.1.rc4.
	[4607141a6bdc] [1.1.rc4]

	* src/lib/mempool-alloconly.c:
	DEBUG: Added buffer overflow checking to alloconly memory pools.
	[45884655c0c4]

	* src/lib-storage/mail-storage.c:
	mailbox_transaction_commit(): Use separate temporary variables to
	store uidvalidity, first_uid and last_uid so that plugins can look
	at them.
	[70cf4172af74]

	* src/auth/db-ldap.c:
	Using templates in pass_attrs or user_attrs was somewhat broken,
	causing errors for other fields. Fixed by richs at whidbey.net
	[15fbff736ab9]

	* src/lib/data-stack.c:
	t_buffer_get() overflow check worked only with 64bit systems.
	[3e7592582f93]

	* src/imap/imap-sync.c:
	Memory leak fix by Diego Liziero
	[9d694f41a699]

2008-03-30  Timo Sirainen  <tss@iki.fi>

	* src/lib/str-find.c:
	matches[] wasn't also allocated enough memory.
	[00d3b46f61e6]

	* src/imap/cmd-store.c:
	STORE: Ignore flag changes for read-only (especially EXAMINEd)
	mailboxes.
	[eec74a6ad62e]

	* src/lib/str-find.c:
	str_find_init() allocated too little memory for temporary suffixes
	buffer. Found by Diego Liziero.
	[ffd549b542c5]

	* src/lib/data-stack.c:
	DEBUG: Catch if we write past t_buffer_get()ed memory.
	[213dd8e78ad8]

	* src/lib-index/mail-transaction-log-file.c:
	Fix to previous optimization: Don't crash if we want to read older
	data from transaction log.
	[dc9c098a7d26]

2008-03-26  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/imap-login/imap-proxy.c, src/pop3-login
	/client-authenticate.c, src/pop3-login/client.c,
	src/pop3-login/client.h, src/pop3-login/pop3-proxy.c:
	Log clearly with "auth failed, # attempts" if user gets disconnected
	before logging in.
	[65fbb6226141]

	* src/imap/cmd-idle.c:
	Workaround to never idle-disconnect IDLEing clients got broken by
	timeout code changes.
	[498975950370]

2008-03-23  Timo Sirainen  <tss@iki.fi>

	* src/lib/randgen.c:
	random_fill(): If read(/dev/urandom) returned EINTR, it could have
	written random data before the given buffer (buffer underflow).
	Pointed out by Sami Farin.

	This function is used only by auth and pop3-login (with APOP
	enabled) processes, so normal users shouldn't be able to send
	signals to any of them to exploit this. Even then the data would be
	random, making it quite unlikely to cause anything else than a
	crash.
	[cdb007c1923d]

2008-03-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-file.c:
	Small optimization: Don't try to pread() log file if we already know
	we've read everything.
	[6983dfc231d7]

2008-03-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-sync.c:
	Try to send tagged replies in the same order as the commands were
	received (fixes Apple Mail bug).
	[4407b7265afd]

	* src/lib-storage/index/maildir/maildir-mail.c:
	"Corrupted physical/virtual size" shows now also the UID of the
	message.
	[0ee365c21c16]

	* src/imap/imap-sync.c:
	Don't access freed memory.
	[9b8590b3749b]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-idle.c, src/imap/cmd-search.c, src/imap/cmd-x-cancel.c,
	src/imap/imap-sync.c:
	client_command_free()/cancel(): Take pointer-to-pointer parameter
	and set it to NULL to make sure it's not accessed again.
	[33d8adcc2d44]

	* src/plugins/fts-squat/squat-trie.c:
	If we have both maybe and definite UIDs, remove all definite UIDs
	from maybe UIDs.
	[2b89ceb0f6af]

	* src/plugins/fts-squat/fts-backend-squat.c, src/plugins/fts-squat
	/squat-trie-private.h, src/plugins/fts-squat/squat-trie.c,
	src/plugins/fts-squat/squat-trie.h:
	Added FTS_SQUAT environment with partial=n and full=m settings.
	[477b619b926b]

	* src/plugins/acl/acl-backend-vfile-acllist.c:
	If dovecot-acl-list can't be created because of permission problems,
	it's probably because the account is read-only, so don't log an
	error.
	[d6f1eb00e4d3]

	* src/lib-storage/index/mbox/mbox-sync.c:
	If mbox isn't writable, don't try to update its atime with utime().
	[264d4f41c627]

2008-03-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	Ignore \Recent flag in indexes when searching them (leftovers from
	v1.0).
	[11e7ec83665d]

	* src/plugins/quota/quota.c:
	Quota: backend= didn't work in rules.
	[1da16dbcacf7]

	* src/plugins/quota/quota-plugin.c:
	"Invalid quota rule" didn't specify the error message
	[a2bc615e026d]

2008-03-16  Timo Sirainen  <tss@iki.fi>

	* src/plugins/expire/expire-env.c, src/plugins/expire/expire-env.h,
	src/plugins/expire/expire-plugin.c:
	If first message is expunged from expire_altmove mailbox, don't
	update dict.
	[bd54359bfb3a]

	* README:
	Updated conformed RFCs list
	[ae746a73e51e]

	* src/imap/imap-sync.c:
	If sync queue has commands that don't allow EXPUNGEs and also
	commands that do allow them, sync first the ones that don't allow
	EXPUNGEs, otherwise we could send untagged EXPUNGEs before e.g.
	tagged FETCH reply.
	[ac984d42917f]

2008-03-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c:
	DEBUG: Verify that UIDs are ascending after sync.
	[a4a552321bd3]

	* src/lib-index/mail-index-map.c:
	Fixed extension record checking.
	[fc526477d36b]

	* src/lib-dict/dict-client.c:
	Reverted last error handling change, it can't happen after all.
	[a18f7f0dcff5]

	* src/lib-dict/dict-client.c:
	Error handling fix
	[e8df909de851]

	* dovecot-example.conf, src/master/mail-process.c:
	Disable log throttling while mail_debug=yes
	[4c093cfa8756]

2008-03-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	MAIL_INDEX_TRANSACTION_FLAG_AVOID_FLAG_UPDATES bugfix
	[58c0b1f833f3]

	* src/lib-storage/index/cydir/cydir-mail.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/index-search.c,
	src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/mbox/mbox-mail.c, src/lib-storage/index/raw/raw-
	mail.c, src/lib-storage/mail-storage-private.h:
	struct mail can't necessarily be casted to struct index_mail. Added
	a new get_index_mail() method to return it.
	[45624f5ba358]

	* src/lib-storage/mail-storage-private.h, src/lib-storage/mail-
	storage.c:
	Added transaction flags to struct mailbox_transaction_context.
	[5d96b15832fc]

2008-03-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c:
	Expunge handler crashfix
	[50ebec7bd4c5]

2008-03-11  Timo Sirainen  <tss@iki.fi>

	* src/lib/failures.c:
	Log raw backtrace when dying with "out of memory" error
	[ed147ad1e03e]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-sync-ext.c,
	src/lib/fdpass.c:
	Apparently "alignmentation" isn't a word. Changed to "alignment".
	[b3c900eb7e83]

	* src/imap/cmd-fetch.c:
	Make UID FETCH return the UID as the first field to fix problems
	with bad IMAP clients.
	[5b18c2ff2e2d]

	* src/lib-storage/index/index-mail.c:
	BODY/BODYSTRUCTURE may have been returned as NULL in some
	situations.
	[7e27d67d3abe]

	* src/lib-storage/index/dbox/dbox-file.c:
	dbox metadata writing fixes
	[81994d76fd24]

	* src/lib-storage/index/dbox/dbox-file.c:
	When reading dbox metadata, flush the input stream's cached data
	first to make sure the latest metadata is used.
	[8afcffeae291]

	* src/lib-storage/index/dbox/dbox-sync-rebuild.c:
	dbox rebuild: If alt directory doesn't exist, don't fail.
	[0d3ab8eaeedf]

	* src/plugins/convert/convert-plugin.c:
	Call the next namespaces hook.
	[ba8ae35ce462]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c:
	Error message fixes
	[da3b83d7928f]

	* src/lib-index/Makefile.am, src/lib-index/mail-hash.c, src/lib-index
	/mail-hash.h:
	Removed mail-hash. It's not used anywhere and its API has been
	redesigned.
	[ce11885b99a0]

	* src/lib-storage/index/maildir/maildir-mail.c:
	Typofix in error message
	[f5011bb9a633]

2008-03-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-mail.c:
	If we caught broken cached virtual/physical size, change the value
	to the one in filename/uidlist.
	[35150eb346c1]

	* src/lib-storage/index/maildir/maildir-mail.c:
	If physical/virtual size is in both cache and in filename/uidlist,
	mark the cache corrupted if they don't match.
	[7173d502b4e6]

	* src/lib-storage/index/maildir/maildir-mail.c:
	uidlist size caching check was wrong for physical sizes.
	[705afa37b818]

	* doc/dovecot-ldap-example.conf, src/auth/db-ldap.c, src/auth/db-
	ldap.h:
	Added ldaprc_path setting.
	[8a4ecf4c2ca1]

	* doc/dovecot-ldap-example.conf, src/auth/db-ldap.c, src/auth/db-
	ldap.h:
	Added debug_level LDAP option to specify OpenLDAP's debug level.
	[a61102ad418f]

	* src/imap-login/client-authenticate.c:
	If we sent client "waiting for auth process" message, we crashed
	later.
	[de4881149c0e]

	* src/auth/auth-request.c:
	Changing "user" from userdb crashed.
	[2d3b9a6d23f5]

	* src/lib-index/mail-transaction-log.c:
	Memory leak fix (by Diego Liziero)
	[e569788da4e8]

2008-03-09  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.1.rc3 for changeset c73d6224a96b
	[88f0c016f766]

	* NEWS, TODO, configure.in:
	Released v1.1.rc3.
	[c73d6224a96b] [1.1.rc3]

	* src/plugins/fts-squat/squat-uidlist.c:
	Crashfix if file is empty.
	[04297ce26b78]

	* src/auth/auth-request.c:
	If trying to log in with password having illegal characters, make
	sure we fail early.
	[1125d2d59e82]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-master-connection.h, src/auth/auth-
	request-handler.c, src/auth/auth-request-handler.h, src/auth/auth-
	request.c, src/auth/auth-request.h, src/auth/auth-stream.c, src/auth
	/auth-stream.h, src/auth/auth-worker-client.c, src/auth/auth-worker-
	server.c, src/auth/auth-worker-server.h, src/auth/passdb-blocking.c,
	src/auth/userdb-blocking.c:
	Use auth-stream API to build all TAB-delimited strings to make sure
	strings are escaped properly where necessary.
	[08d31d752893]

	* src/lib/restrict-access.c:
	Make sure the primary GID is in supplementary groups when using
	mail_privileged_group so when effective GID is switched to the
	privileged GID we still have primary GID's access as well.
	[2bef36355718]

	* src/lib/restrict-access.c:
	mail_privileged_group didn't work with systems where setresgid()
	wasn't supported (e.g. OSX, Solaris)
	[85934050fdbd]

	* src/lib-index/mail-index-map.c:
	Valgrind warning fix
	[8e014fd46e84]

	* src/auth/auth-request-handler.c, src/plugins/expire/expire-tool.c,
	src/util/listview.c:
	Compiler warning fixes
	[899127b7c7e6]

	* src/plugins/fts-squat/fts-backend-squat.c:
	Flags weren't passed correctly to squat.
	[9d6d555950dd]

2008-03-08  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	deliver -d parameter was broken by recent changes.
	[631fd6f25e41]

	* .hgtags:
	Added tag 1.1.rc2 for changeset dfd811aa0418
	[d06f113871a5]

	* NEWS, TODO, configure.in:
	Relased v1.1.rc2.
	[dfd811aa0418] [1.1.rc2]

	* src/imap/imap-thread.c:
	THREAD fixes: If sent date isn't usable, fallback to received date.
	If thread building would introduce loop, the message should not have
	a parent then.
	[dbbb91f70719]

	* src/deliver/mail-send.c:
	mail_debug=yes: Log recipient/return-path when sending rejects and
	forwards.
	[1570eb502366]

	* src/plugins/fts/fts-storage.c:
	If the SEARCH TEXT/BODY command contained more parameters, we could
	have returned too many/little replies.
	[f435be3e3def]

	* src/plugins/fts/fts-search.c:
	Small optimization.
	[1307a1702e5e]

	* src/plugins/fts-squat/squat-trie.c:
	When searching words with only non-indexed characters, return all
	messages as "maybe".
	[92c2ab255c65]

	* src/login-common/client-common.c, src/login-common/ssl-proxy-
	openssl.c, src/login-common/ssl-proxy.c, src/login-common/ssl-
	proxy.h:
	If TLS connection closes with anything except a clean disconnection,
	log the reason in the normal disconnected line.
	[0bb3fc72a74f]

2008-03-07  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-squat/squat-uidlist.c:
	When rebuilding uidlist, read the existing one entirely into memory
	at the beginning. This this is a lot faster than reading it with
	random access in smaller pieces.
	[4445415da4ff]

	* src/plugins/fts-squat/squat-trie.c:
	Don't crash when expunging (broken by seq_range_array_add_range()
	change)
	[2201fd4548e3]

	* src/plugins/fts-squat/squat-trie-private.h, src/plugins/fts-squat
	/squat-trie.c, src/plugins/fts-squat/squat-trie.h, src/plugins/fts-
	squat/squat-uidlist.c:
	Added support for dotlocks.
	[55712d36224b]

	* src/plugins/fts-squat/squat-uidlist.c:
	Minor optimization and possible compile fix.
	[d51565e31ceb]

	* src/plugins/fts-squat/squat-uidlist.c:
	If uidlist writing fails, don't assert-crash.
	[fc296dfcfd29]

	* src/plugins/fts-squat/squat-trie-private.h:
	squat_unpack_num() returned error for numbers >= 2^28, causing Squat
	to report index corruption with (very) large files.
	[750ff2eb83a0]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h:
	Don't allow too large extension header sizes. They're probably
	caused by file corruption.
	[8b0fe9c43c85]

	* src/lib-index/mail-index-sync-ext.c:
	Check extension header validity before using it.
	[f4990a37a8df]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't crash if trying to open a non-file as mbox.
	[33b90e21b634]

	* src/plugins/quota/quota-maildir.c:
	If both byte and message count limits weren't set, we recalculated
	maildirsize all the time.
	[1b160b2cd080]

2008-03-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	update.c:
	Expunge handler calling fixes.
	[dc24431136b3]

	* src/lib-index/mail-index-view.c:
	mail_index_bsearch_uid(): Small optimization.
	[1bbef480786a]

	* src/lib-index/mail-index.c:
	mail_index_ext_register(): Allow registering an extension without
	record or header. It can still be used to register expunge/sync
	handlers.
	[11eb0bd76299]

	* src/lib-index/mail-cache.c:
	Catch dotlock creation timeout error.
	[c4fda7e5d879]

	* src/lib-index/mail-transaction-log-file.c:
	Error message fix.
	[b747eb6e1ca1]

	* src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h:
	Added mailbox_transaction_get_mailbox()
	[ffb7e8b1c114]

	* src/lib-imap/imap-quote.c:
	imap_quote(): Don't crash if allocating from data stack pool.
	[7d4f7c7095dd]

	* src/plugins/zlib/zlib-plugin.c:
	Assert-crashfix when using a specific plugin combination.
	[25551453b13c]

2008-03-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-storage/list
	/mailbox-list-fs.c, src/lib-storage/list/mailbox-list-maildir.c, src
	/lib-storage/mailbox-list-private.h:
	dbox: Fixes to creating, deleting and renaming mailboxes when using
	alt directories.
	[5193f5c6ab5d]

	* src/master/mail-process.c:
	NFS checking checks now mail_nfs_index=yes instead of
	mmap_disable=yes.
	[de47a37ca0c1]

	* src/imap/client.h, src/imap/cmd-expunge.c, src/imap/imap-sync.c,
	src/imap/imap-sync.h:
	Syncing supports now calling a callback after sync instead of just
	sending a tagged reply. Use it with EXPUNGE to retry EXPUNGE in case
	the syncing had seen new \Deleted flags (Outlook workaround).
	[33304b5f6070]

	* src/imap/client.c:
	uncork stream only after syncing to avoid extra writes.
	[4f63124e756e]

	* src/master/main.c:
	Fatals/panics logged by master weren't logged properly.
	[6115fe69094c]

	* src/lib/failures.c:
	Prefix fatal/panic messages with syslog.
	[51c72fdaadfd]

	* src/lib-storage/index/index-mail.c:
	If mail parsing was aborted (mail saving was aborted), don't even
	try to generate data to be cached to avoid crashes.
	[63ef0998cd53]

	* src/lib/istream.c:
	If stream is closed without stream_errno set, change it to
	ECONNRESET so if there are any future reads they'll return it.
	[32d555a08443]

	* src/lib/istream-tee.c:
	If parent stream read() fails, update our stream_errno from the
	parent.
	[34cc59e3da17]

	* src/login-common/ssl-proxy-openssl.c:
	Call SSL_shutdown()
	[393abdd250bb]

	* src/auth/db-ldap.c:
	Fail with a clear error if both tls=yes and ldaps:// URI is used.
	[0c7dc0b0bb7b]

	* src/auth/db-ldap.c:
	If sasl_bind=yes or tls=yes is used and ldap_version<3, fail with an
	error.
	[57ae4181bb32]

	* src/lib/safe-mkstemp.c:
	Ignore EACCES errors silently.
	[034e18a91a6b]

2008-03-04  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-crlf.c:
	Added support for seeking forwards in the stream.
	[c1c977afe06c]

	* dovecot-example.conf, src/lib-storage/index/mbox/mbox-lock.c, src
	/lib-storage/index/mbox/mbox-lock.h, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib
	/restrict-access.c, src/lib/restrict-access.h, src/master/auth-
	process.c, src/master/login-process.c, src/master/mail-process.c,
	src/master/master-settings-defs.c, src/master/master-settings.c,
	src/master/master-settings.h:
	Replaced mail_extra_groups setting with mail_privileged_group and
	mail_access_groups settings. mail_privileged_group allows temporary
	access to the group when creating mbox INBOX dotlocks.
	[af998ae4254b]

	* src/lib/file-dotlock.c:
	file_dotlock_create(): Don't log an EACCES failures.
	[09cdd4330d73]

	* src/master/master-settings.c:
	If mail_uid or mail_gid doesn't exist, log an error.
	[218245e5e4e7]

	* src/plugins/expire/expire-tool.c:
	Fail if any parameters other than --test is given.
	[d0db93a071e3]

	* src/lib-storage/index/dbox/dbox-mail.c:
	If save time is missing, use the file's ctime instead of current
	time.
	[31c4ab6a9b4e]

	* src/plugins/expire/expire-env.c:
	Forgot to change expire time to be calculated as hours after
	debugging.
	[c150eceb1f6e]

	* src/plugins/expire/Makefile.am, src/plugins/expire/expire-env.c,
	src/plugins/expire/expire-env.h, src/plugins/expire/expire-plugin.c,
	src/plugins/expire/expire-tool.c:
	Added wildcard support to expire plugin. Added a new expire_altmove
	setting which moves mails to alt directory with dbox instead of
	expunging them. Both settings can be used simultaneously. Added
	--test parameter to expire-tool. Fixed several bugs and did some
	optimizations.
	[969656b58e7f]

	* src/master/child-process.c, src/master/child-process.h, src/master
	/mail-process.c, src/master/mail-process.h, src/master/main.c:
	Allow dovecot --exec-mail ext program arguments.
	[ae8180a4febd]

	* src/lib-storage/index/index-mail.c:
	Make MAIL_INDEX_MAIL_FLAG_BACKEND visible to mail_get_flags() and
	allow it to be changed.
	[cd22f3bcd29d]

	* src/lib-storage/index/dbox/dbox-mail.c:
	If dbox file doesn't have sent date, return (and cache) current
	time.
	[3f9f01913f90]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-file.h, src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-storage.h, src/lib-storage/index/dbox/dbox-
	sync-file.c, src/lib-storage/index/dbox/dbox-sync.c:
	MAIL_INDEX_MAIL_FLAG_BACKEND specifies if file should be in alt dir
	or primary dir. If the flag is changed, the file is moved.
	[9ef06104648a]

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index.h:
	Added MAIL_INDEX_MAIL_FLAG_BACKEND flag that can be used for
	backend-specific uses.
	[93f67b71476c]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib/Makefile.am,
	src/lib/fdatasync-path.c, src/lib/fdatasync-path.h:
	Moved fdatasync_path() to a global function.
	[d2b10facb504]

2008-03-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	SEARCH NOT SUBJECT didn't work correctly.
	[e0e212e7deeb]

	* src/lib/mempool-alloconly.c:
	DEBUG: Use t_buffer_alloc_last_full() before calling i_warning() to
	make sure we don't trash unallocated data from data stack.
	[a1b8a12521a0]

	* src/lib/data-stack.c, src/lib/data-stack.h:
	Added t_buffer_alloc_last_full().
	[5017c74367e3]

	* src/tests/test-imap.c:
	Added more tests to imap_match().
	[3bece69a5bfc]

	* src/lib-storage/index/dbox/dbox-storage.c:
	LIST: Show \NoSelect status correctly.
	[1d0de3d644e4]

	* src/lib-storage/index/dbox/dbox-storage.c:
	Mailbox deletion fixes.
	[bbafc37e3251]

	* src/lib-storage/list/mailbox-list-fs-iter.c:
	Mailbox listing fix.
	[a8963df83db2]

	* src/deliver/deliver.c, src/lib-mail/Makefile.am, src/lib-mail/mbox-
	from.c, src/lib-mail/mbox-from.h, src/lib-
	storage/index/mbox/Makefile.am, src/lib-storage/index/mbox/mbox-
	from.c, src/lib-storage/index/mbox/mbox-from.h:
	Moved mbox From_-line handling to lib-mail, since it's also used by
	deliver.
	[06f59be7f508]

	* src/lib-index/mail-index-sync.c:
	mail_index_sync_have_any(): Refresh index to see if there are any
	new unseen changes before returning anything.
	[fa8e8bcc85a5]

	* src/imap/cmd-close.c:
	CLOSE: Synchronize the mailbox after expunging messages to actually
	get them expunged.
	[d76c54e092f5]

2008-03-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	Fixed pass=yes with blocking passdbs. Also master_user wasn't
	exported correctly to blocking passdbs.
	[be991f857c70]

	* src/plugins/acl/acl-backend-vfile.c:
	Ignore spaces and TABs at the end of ACL lines.
	[92cd0509b2b9]

	* src/lib-storage/index/mbox/mbox-lock.c:
	Don't try to flush NFS file handle cache for mbox files.
	[258477a3f1e7]

	* src/plugins/mail-log/mail-log-plugin.c:
	Copies were tracked using the source transaction instead of
	destination transaction, so rollbacking source transaction logged
	bogus "transaction rolled back" messages.
	[3f53f528d338]

	* src/lib-imap/imap-match.c:
	imap_match(): "foo/bar/%" pattern matching to "foo/" should return
	CHILDREN instead of NO.
	[3765f80f4d29]

	* .hgignore, src/tests/Makefile.am, src/tests/test-imap.c:
	Added unit tests for imap_match()
	[ff7b11c64321]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-transaction.c, src/lib-index
	/mail-cache.c:
	Optimized cache record loop tracking.
	[6f59434cf229]

2008-03-01  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-limit.c:
	Seek also non-seekable parent streams to current offset as long as
	we're not seeking backwards.
	[fce616c59597]

2008-02-29  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	Trying to user $USER environment didn't work before environment was
	already cleared. Get it earlier.
	[18766f26a7ed]

	* src/deliver/deliver.c:
	If username lookup fails, return EX_USAGE instead of EX_TEMPFAIL
	because we haven't yet opened the log file.
	[553eb182004a]

	* src/lib/seq-range-array.c:
	Implemented optimized seq_range_array_add_range().
	[e318f3c8a724]

	* src/tests/test-lib.c:
	Use smaller test buffer sizes
	[5c683653d962]

	* src/tests/test-lib.c:
	Added randomized unit test for seq_range_array*()
	[b7d55cccc7f4]

	* src/lib-storage/index/index-mail-headers.c:
	array_clear() is now equivalent to buffer_clear(), use it.
	[3161b8648468]

	* src/tests/test-lib.c:
	Added unit testing for buffer_t.
	[90154a6d225e]

	* src/lib/buffer.c:
	buffer_reset(buf) and buffer_set_used_size(buf, 0) now do the same
	thing.
	[db4a29902723]

	* src/lib/priorityq.c:
	Fixed removing last item from priority queue.
	[8e65f6755843]

2008-02-28  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-limit.c:
	If underlying stream doesn't support seeking, don't try to seek to
	original position.
	[c75b2e1fa5a2]

	* src/lib/istream-crlf.c:
	Added support for seeking forwards in the stream. Also mark the
	stream as non-seekable since seeking backwards doesn't work.
	[f0c7e9198313]

2008-02-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Fixed dirty flag/keyword handling.
	[4e1161bad6ec]

2008-02-26  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Base docdir to datadir instead of datarootdir which doesn't exist in
	old autoconfs either.
	[86af79a203d7]

	* configure.in:
	Added support for autoconf versions older than 2.59c.
	[2cda05620383]

	* doc/wiki/Makefile.am.in:
	wiki docs weren't using docdir.
	[ecf5a34a4758]

	* src/plugins/quota/quota-maildir.c, src/plugins/quota/quota-
	private.h, src/plugins/quota/quota.c:
	quota_rule=?:.. specifies the default quota limits to use when
	backend doesn't have any. If backend has limits, this rule is
	ignored.
	[a39b16b0a530]

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-fs.c, src/plugins/quota/quota-maildir.c,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota.c:
	Relative (%) limits in quota rules and warnings work now if the
	backend specifies or changes the limits (e.g. Maildir++ maildirsize
	file)
	[9e4c26471b19]

	* src/auth/db-ldap.c, src/auth/userdb-ldap.c:
	Don't crash if ldap userdb lookup fails.
	[f78b83bf16b7]

2008-02-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mailbox-check.c, src/lib-storage/index
	/index-sync.c:
	mailbox_notify_changes(): Don't trigger the timeout once a second to
	see if the timeout really occurred.
	[d0520bb9177f]

	* src/lib-storage/index/cydir/cydir-sync.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/maildir/maildir-
	sync.c, src/lib-storage/index/mbox/mbox-sync.c:
	Check and update sync_last_check in one common function.
	[db65d921b0e1]

	* src/lib-storage/index/index-mail-headers.c:
	And compile fix for last change.
	[697000a67c42]

	* src/lib-storage/index/index-mail-headers.c:
	array_clear() only truncates the array, growing its size later
	doesn't fill it with zero. Use buffer_reset() instead here which
	does zeroing.
	[589663d269de]

	* src/imap/commands.c:
	LOGOUT command also closes mailbox, so mark it as such to fix
	command pipelining problems.
	[0917df31efec]

2008-02-24  Timo Sirainen  <tss@iki.fi>

	* src/plugins/trash/trash-plugin.c:
	Allow #comments in trash config
	[75526c605044]

2008-02-21  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.1.rc1 for changeset 958e377fc1dc
	[c47b498a427b]

	* NEWS, TODO, configure.in:
	Released v1.1.rc1.
	[958e377fc1dc] [1.1.rc1]

	* src/imap/imap-search.c, src/lib-storage/index/index-search.c, src
	/lib-storage/mail-search.c, src/lib-storage/mail-search.h:
	SEARCH SUBJECT now changes LWSP to spaces to match ENVELOPE's
	subject field.
	[346d4a44c2f4]

	* src/lib-imap/imap-quote.c:
	imap_quote*() with LWSP compression: Make sure TABs are always
	converted to spaces.
	[f70c4d501251]

	* src/lib/data-stack.c:
	DEBUG: Buffer overflow checking caused false errors sometimes.
	[bbae5b6b6d2b]

	* src/lib-storage/index/index-search.c:
	Header searches shouldn't include the header name or ":" in
	matching.
	[e5b840b3c5c2]

	* src/lib-storage/index/index-mail.c:
	index_mail_get_date() didn't return timezone if date was already
	parsed.
	[e5d3e6c598ec]

	* src/lib-storage/index/index-search.c:
	More fixes to SEARCH BEFORE/ON/SINCE timezone handling.
	[ef13dd179331]

	* src/auth/auth-request.c:
	Fixed proxy_maybe handling.
	[27b7b6c34961]

	* src/auth/passdb-cache.c:
	auth_debug: Hide passwords from "cache hit" log lines if
	auth_debug_passwords=no
	[e0debdcd2e10]

	* src/auth/auth-worker-client.c:
	Blocking passdbs that returned some userdb_* fields returned also an
	extra userdb_<username> field.
	[e8b5e5da1c09]

	* src/auth/passdb-cache.c:
	auth_debug: Show cache contents in "cache hit" lines.
	[6127a0501e72]

	* dovecot-example.conf, src/lib/network.c:
	[::] listens only for IPv6 addresses now. This gets rid of
	IPv4-mapped IPv6 addresses. Use "listen = *, [::]" for listening
	both.
	[da971cec0395]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Fixed "uid_validity updated unexpectedly" errors when mbox file was
	being recreated and index files still existed.
	[1d87dc550378]

	* src/lib-mail/message-parser.c:
	Assert fix
	[1e5deb36a79f]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Make sure we don't use a stale first_unwritten_pos to optimize
	dovecot-uidlist writing.
	[4ac4e9ba1124]

2008-02-20  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	Don't crash if trying to deliver mail to mailbox outside all
	namespaces.
	[c6afa177bbf1]

	* src/lib-storage/index/index-search.c:
	SEARCH BEFORE/ON/SINCE didn't handling timezones correctly.
	[af415b88ba1d]

2008-02-17  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Changed the default ioloop to "best".
	[80cd999d5623]

	* src/lib-storage/index/maildir/maildir-save.c:
	fdatasync() the new/ and/or cur/ directory after mails are renamed.
	[0444707aa95c]

	* src/imap/cmd-idle.c:
	Assert-crashfix if IDLE finishes immediately.
	[c1e18e979ac3]

	* src/lib-storage/index/mbox/mbox-mail.c:
	Fixed "Cached message offset lost" errors when quota plugin was
	used.
	[36da161ecc66]

	* configure.in:
	Fixed --enable-ipv6
	[91cf91f0a0a8]

	* dovecot-example.conf:
	Typofixes
	[b34b2d4aac03]

	* src/plugins/fts/fts-api.c:
	Don't crash if FTS backend initialization fails.
	[41bbf9edf7f8]

2008-02-16  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	If __gss_userok() is found from -lgss, make sure we link with -lgss.
	[e665ef583668]

	* .hgtags:
	Added tag 1.1.beta16 for changeset 2aa39f1e3993
	[b1bde5ea779f]

	* TODO, configure.in:
	Released v1.1.beta16.
	[2aa39f1e3993] [1.1.beta16]

	* src/master/mail-process.c:
	Last commit broke mail_drop_priv_before_exec/mail_chroot conflict
	check.
	[de96d58b6ee2]

	* dovecot-example.conf, src/master/mail-process.c:
	mail_chroot no longer needs to be in valid_chroot_dirs.
	[1f982f1201ef]

	* dovecot-example.conf:
	Added a warning comment to mail_extra_groups.
	[39c2f2adfed1]

	* src/imap/cmd-list.c:
	Don't convert real separators to virtual separators. The mailbox
	listing code already did it for us.
	[cd7eeb8cc7fc]

	* .hgignore:
	Updated
	[a9ddd7d0e160]

	* src/imap/imap-fetch-body.c, src/imap/imap-fetch.h:
	If stream ends unexpectedly, it was most likely because of a broken
	cached field, so mark the cache corrupted.
	[6f9786d83007]

	* src/lib-storage/index/index-mail.c:
	When setting cache corrupted, make sure we don't write broken values
	to the new cache file. Also log broken virtual size fetches better
	and support 0 as a generic "some fields" value.
	[c96bf18c886b]

	* src/plugins/fts-squat/squat-trie.c, src/plugins/fts/fts-search.c:
	Memory leak fixes
	[c3d829cdbfa5]

	* src/plugins/fts-squat/squat-trie.c:
	Expunge fix
	[44069f98343e]

	* src/plugins/fts-squat/squat-trie.c:
	Fixed squat lookup.
	[eb310b0d0966]

	* src/plugins/fts-squat/squat-trie.c:
	Fixed handling expunges.
	[139f2f03b81b]

2008-02-15  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	Check for "/./" chrooting in home dirs only if valid_chroot_dirs
	isn't empty.
	[17c65dfdac2a]

	* src/plugins/fts-squat/squat-trie.c:
	squat_trie_lookup() for empty string returns now all UIDs from root
	node. This is mainly useful for debugging.
	[599a9c679ee2]

	* src/lib-mail/message-parser.c, src/lib-storage/mail-storage.c, src
	/lib-storage/mailbox-list-private.h, src/lib-storage/mailbox-list.c:
	Memory leak fixes
	[dbb7f65e6307]

	* src/lib-index/mail-index-transaction.c:
	Fixed bad memcpy() usage with memmove().
	[673132f88be3]

2008-02-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c, src/lib-mail/message-parser.h, src
	/lib-mail/message-search.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/plugins/fts/fts-
	storage.c, src/tests/test-mail.c:
	Changed message_parser_deinit() to return -1 if the parser was using
	preparsed broken message parts. Callers catch the error and mark the
	cache file corrupted.
	[289765861d66]

	* src/lib-mail/message-search.c, src/lib-mail/message-search.h, src
	/lib-storage/index/index-search.c:
	message_search_more*() now returns bool instead of int. They can't
	fail.
	[8cfa61f98e32]

	* src/lib-storage/index/cydir/cydir-mail.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/index-search.c,
	src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/mbox/mbox-mail.c, src/lib-storage/index/raw/raw-
	mail.c, src/lib-storage/mail-storage-private.h, src/lib-storage
	/mail-storage.h, src/lib-storage/mail.c:
	Added mail_set_cache_corrupted() to rebuild the cache file and force
	recalculating the given field.
	[a6c066f50877]

	* src/lib-charset/charset-iconv.c:
	Crashfix for converting invalid input to UTF-8.
	[fcfe2ea5c3ed]

2008-02-13  Timo Sirainen  <tss@iki.fi>

	* src/plugins/convert/convert-tool.c:
	convert-tool returned inverted exit status.
	[0e8339ad1932]

	* src/plugins/fts/fts-api-private.h:
	Compile fix with some compilers
	[983c6ea05de0]

	* src/plugins/fts-squat/fts-backend-squat.c:
	Compiler warning fix (wrong enums used, just happened to work)
	[a46e705f8110]

	* src/lib-index/mail-index-sync-update.c:
	Code cleanup for last commit
	[b0b2c620a2b5]

	* src/lib-index/mail-index-sync-update.c:
	Log an error if uid_validity field is updated unexpectedly. If
	next_uid field decreases log an error and ignore the update.
	[40b6d4113e52]

	* src/util/idxview.c:
	Don't crash if there are no extensions.
	[b8b100c7771c]

2008-02-12  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Removed mailbox_list_index setting since it's always disabled.
	[01fc464ddddd]

2008-02-11  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Released v1.1.beta15.
	[df570f504edf]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	Handle first_recent_uid=0 without crashing, even though it shouldn't
	happen..
	[0706d404a8fb]

	* src/plugins/fts-lucene/lucene-wrapper.cc:
	When dropping last_uid fields, finish the search before removing
	them. Otherwise lucene could crash.
	[777131d76168]

	* src/master/main.c:
	If Dovecot master dies with a fatal failure, log the error message
	to a file in base_dir. If the file exists at startup, show its
	contents and a comment about looking at error logs why it happened.
	Hopefully this will reduce "why Dovecot died without a reason?"
	questions.
	[586abf9b561c]

	* src/lib/failures.c, src/lib/failures.h:
	Default failure functions are now public.
	[45a083e03fba]

	* src/master/auth-process.c:
	If auth process dies too early, kill ourself with i_fatal() so the
	log clearly shows why we died.
	[d64b898066a9]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-request.c, src/auth/auth-worker-
	client.c, src/auth/auth-worker-server.c, src/auth/db-ldap.c,
	src/auth/db-passwd-file.c, src/auth/main.c, src/deliver/deliver.c,
	src/dict/dict-server.c, src/imap/client.c, src/imap/cmd-list.c,
	src/imap/imap-fetch.c, src/imap/imap-thread.c, src/imap/mail-
	storage-callbacks.c, src/lib-auth/auth-server-connection.c, src/lib-
	auth/auth-server-request.c, src/lib-dict/dict-client.c, src/lib-dict
	/dict-sql.c, src/lib-dict/dict.c, src/lib-imap/imap-bodystructure.c,
	src/lib-imap/imap-match.c, src/lib-imap/imap-quote.c, src/lib-index
	/mail-cache-fields.c, src/lib-index/mail-cache-lookup.c, src/lib-
	index/mail-cache-transaction.c, src/lib-index/mail-cache.c, src/lib-
	index/mail-index-fsck.c, src/lib-index/mail-index-map.c, src/lib-
	index/mail-index-sync-update.c, src/lib-index/mail-index-sync.c, src
	/lib-index/mail-index-view-sync.c, src/lib-index/mail-transaction-
	log-append.c, src/lib-index/mail-transaction-log-file.c, src/lib-
	index/mail-transaction-log-view.c, src/lib-index/mailbox-list-index-
	sync.c, src/lib-index/mailbox-list-index.c, src/lib-mail/message-
	address.c, src/lib-mail/message-date.c, src/lib-mail/message-
	decoder.c, src/lib-mail/message-parser.c, src/lib-mail/message-
	search.c, src/lib-settings/settings.c, src/lib-sql/driver-mysql.c,
	src/lib-sql/driver-pgsql.c, src/lib-storage/index/cydir/cydir-
	save.c, src/lib-storage/index/dbox/dbox-file.c, src/lib-
	storage/index/dbox/dbox-index.c, src/lib-storage/index/dbox/dbox-
	save.c, src/lib-storage/index/dbox/dbox-sync-file.c, src/lib-
	storage/index/dbox/dbox-sync-rebuild.c, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-sort.c,
	src/lib-storage/index/index-storage.c, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-keywords.c,
	src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-util.c,
	src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-sync-parse.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c, src/lib-storage/list/index-
	mailbox-list-sync.c, src/lib-storage/list/mailbox-list-fs-iter.c,
	src/lib-storage/list/mailbox-list-maildir-iter.c, src/lib-
	storage/list/mailbox-list-maildir.c, src/lib-storage/list/mailbox-
	list-subscriptions.c, src/lib-storage/mail-namespace.c, src/lib-
	storage/mail-search.c, src/lib-storage/mail-storage.c, src/lib-
	storage/mailbox-list.c, src/lib-storage/mailbox-tree.c,
	src/lib/compat.c, src/lib/data-stack.h, src/lib/failures.c, src/lib
	/file-copy.c, src/lib/file-dotlock.c, src/lib/imem.c,
	src/lib/ioloop.c, src/lib/mkdir-parents.c, src/lib/module-dir.c,
	src/lib/nfs-workarounds.c, src/lib/restrict-access.c,
	src/lib/strfuncs.c, src/lib/unlink-old-files.c, src/login-common
	/client-common.c, src/login-common/ssl-proxy-gnutls.c, src/master
	/auth-process.c, src/master/log.c, src/master/login-process.c,
	src/master/main.c, src/plugins/acl/acl-api.c, src/plugins/acl/acl-
	backend-vfile-acllist.c, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/acl/acl-backend.c, src/plugins/acl/acl-cache.c,
	src/plugins/acl/acl-mailbox-list.c, src/plugins/acl/acl-storage.c,
	src/plugins/convert/convert-storage.c, src/plugins/expire/expire-
	plugin.c, src/plugins/expire/expire-tool.c, src/plugins/fts-squat
	/squat-trie.c, src/plugins/fts-squat/squat-uidlist.c,
	src/plugins/fts/fts-api.c, src/plugins/fts/fts-search.c,
	src/plugins/fts/fts-storage.c, src/plugins/mail-log/mail-log-
	plugin.c, src/plugins/quota/quota-dict.c, src/plugins/quota/quota-
	dirsize.c, src/plugins/quota/quota-fs.c, src/plugins/quota/quota-
	maildir.c, src/pop3/client.c, src/tests/test-lib.c,
	src/util/idxview.c, src/util/listview.c, src/util/logview.c:
	Renamed T_FRAME_BEGIN/END to T_BEGIN/END. Removed T_FRAME() macro
	and replaced them with T_BEGIN/END calls. T_FRAME() made it
	difficult to debug code with gdb.
	[e6693a0ec8e1]

	* src/imap/imap-search.c:
	Only the first value in a messageset was verified to be valid, the
	rest were ignored (e.g. 1,100000 passed).
	[0fe19a3d82a3]

	* src/plugins/fts-squat/squat-trie.c:
	Make sure mmap_* variables are reset after munmap() so we don't try
	to munmap() the memory multiple times.
	[d5116fa2c88f]

	* src/plugins/fts-squat/squat-trie.c:
	Assert crashfix
	[71af49ba330e]

2008-02-10  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-squat/fts-backend-squat.c:
	Each message has two UIDs stored (body and header), so build the
	expunge list using those UIDs instead of the real message UIDs.
	[3deaf85bb47c]

	* src/plugins/fts-squat/squat-trie-private.h, src/plugins/fts-squat
	/squat-trie.c:
	More squat fixes.
	[e042b6385c7b]

2008-02-09  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-squat/squat-trie.c, src/plugins/fts-squat/squat-
	uidlist.c:
	Expunge fixes
	[21d1d0ced13e]

	* src/plugins/fts-squat/squat-trie.c:
	Squat fixes
	[6c48b72c5096]

	* src/plugins/fts-squat/squat-trie.c, src/plugins/fts-squat/squat-
	uidlist.c:
	Squat fixes
	[43d2f70fb279]

2008-02-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-header-parser.c:
	Assert-crashfix when header line was longer than our input buffer
	and MESSAGE_HEADER_PARSER_FLAG_CLEAN_ONELINE was used.
	[4674cdad3672]

2008-02-06  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/imap-proxy.c, src/pop3-login/pop3-proxy.c:
	If proxy fails to log in to the backend server, forward the error
	message instead of always replying with a generic "Authentication
	failed", which could hide temporary failure and "too many
	connections" errors. However if the backend isn't Dovecot, this
	could allow an attacker to find out what users exist on the system.
	[56f8ac7a3a77]

2008-02-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-append.c:
	Fixed a potential hang after APPEND.
	[492c5dfc5fd8]

2008-02-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c:
	The header ending a message/rfc822 doesn't belong to its child MIME
	part. Fixes a crash with fetching bodystructure.
	[2d58b1c2dfd0]

	* src/lib/file-lock.c:
	If fcntl() or flock() fails, log the lock_type.
	[45bfc162a43c]

	* src/imap/cmd-search.c:
	If SEARCH wasn't handled in one run, it may have hanged.
	[2ed72512334b]

	* src/lib-auth/auth-server-request.c:
	Local and remote ports weren't passed to dovecot-auth.
	[83fb5f84a270]

2008-02-03  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-squat/fts-backend-squat.c, src/plugins/fts-squat
	/squat-test.c, src/plugins/fts-squat/squat-trie.c, src/plugins/fts-
	squat/squat-trie.h, src/plugins/fts-squat/squat-uidlist.c,
	src/plugins/fts-squat/squat-uidlist.h:
	Initial code to support expunging from squat indexes, probably still
	buggy.
	[f5f77a3ae203]

	* src/plugins/fts-squat/squat-test.c:
	Fixed squat-test
	[d7d885b6dd46]

	* src/plugins/fts/fts-api.c:
	If fts_backend.build_init() fails, don't mark backend as being
	built.
	[eec99cefd3bd]

	* src/plugins/fts/fts-api-private.h, src/plugins/fts/fts-api.c:
	Keep struct mailbox pointer in struct fts_backend.
	[2dffefc14e25]

2008-02-02  Timo Sirainen  <tss@iki.fi>

	* src/util/rawlog.c:
	Added -b parameter which writes packet boundaries like <<<packet>>>.
	[83a3239808d3]

2008-01-31  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache.c:
	If cache file's version/architecture/indexid changed, make sure the
	file gets unlinked so it gets rebuilt.
	[a17e3d81a517]

	* src/lib/macros.h:
	Use malloc attribute, __builtin_expect() and
	__builtin_types_compatible_p() only with new enough gccs. Patch by
	Sven Anderson.
	[c3cb23ed73d1]

	* src/login-common/main.c:
	equilevant -> equivalent
	[0269d0c563ea]

	* src/auth/db-ldap.c:
	auth_debug: If LDAP server returned no fields, log it.
	[ace71babd1ec]

2008-01-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-sort.c:
	Infinite looping fix.
	[52639b885d87]

	* src/lib-storage/index/index-sort.c:
	Code cleanup
	[c7f1cb8556be]

	* src/lib-index/mail-cache-transaction.c:
	Removed cache prev_offset optimization for now. It could have caused
	cache record loops.
	[24266b9a6c55]

2008-01-27  Timo Sirainen  <tss@iki.fi>

	* src/imap/commands-util.c:
	"Mailbox is in inconsistent state" -> "IMAP session state is
	inconsistent".
	[7f7e295910a5]

	* src/plugins/fts-squat/squat-trie.c:
	uidlist renumbering: changed iteration code to iterate children
	first. This will be needed for handling expunges.
	[bb9304dee6d4]

2008-01-26  Timo Sirainen  <tss@iki.fi>

	* doc/Makefile.am:
	Removed docdir definition once more. We require autoconf 2.59c or
	later now.
	[4f1527e3d61b]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/imap-sync.c, src/imap/imap-sync.h:
	When pipelining commands, delay synchronizations so that only one
	combined sync is performed for all the commands. This improves
	performance as well as fixes some problems with the earlier method.
	[bca55675d77c]

	* src/lib-storage/index/maildir/maildir-mail.c:
	Last change caused mail_get_physical_size() to assert-crash
	sometimes.
	[226e80da0a23]

2008-01-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	Store physical message sizes also to dovecot-uidlist if needed.
	[e5af14239137]

	* src/auth/db-ldap.c:
	If any of the tls_* settings are used but support isn't compiled in,
	log a warning.
	[5b654defd376]

	* doc/dovecot-ldap-example.conf, src/auth/db-ldap.c, src/auth/db-
	ldap.h:
	Added support for OpenLDAP-specific TLS settings.
	[1cbaa724aba8]

	* src/lib-storage/index/maildir/maildir-save.c:
	Don't fsync() saved mail if saving failed and we're going to
	unlink() it.
	[b9a9c7257f4e]

	* src/lib-storage/index/cydir/cydir-save.c, src/lib-storage/index/dbox
	/dbox-save.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/maildir/maildir-
	save.c, src/lib-storage/index/mbox/mbox-save.c:
	If mail saving fails, don't try to update cache file (only to have
	the changes rollbacked).
	[34057a03a357]

	* src/lib/istream-file.c:
	If EOF is triggered with keyboard (^D), make sure to return EOF for
	future reads as well.
	[febb2592e616]

2008-01-22  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-squat/squat-trie.c:
	Treat replacement characters as non-indexed chars.
	[d9b87e3ce6c8]

	* src/lib-charset/charset-iconv.c:
	Fixed handling invalid charset input. Replace it with replacement
	character.
	[d48c419a27ca]

	* src/lib/unichar.c, src/lib/unichar.h:
	Replace invalid UTF8 input with a replacement character.
	[6f014a866f38]

	* src/plugins/fts-lucene/fts-backend-lucene.c:
	Fixed module registration.
	[7416737df8b8]

2008-01-20  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	posix_fallocate() needs to be tested with linking, not compiling
	[6c868e7fe7b2]

	* .hgtags:
	Added tag 1.1.beta14 for changeset 88de748a2f17
	[efc78f6db374]

	* configure.in:
	Released v1.1.beta14.
	[88de748a2f17] [1.1.beta14]

	* TODO:
	updated
	[1869c4827e86]

	* src/deliver/deliver.c:
	If base_dir is set, use it as the default auth-master socket
	directory.
	[e1a45bbd63d9]

	* src/deliver/mail-send.c:
	Fixed assert-crash when forwarding messages.
	[d8f8b5ab2b8f]

	* src/plugins/quota/quota.c:
	Fixed quota warning handling.
	[c1db7b6e5dbc]

	* src/plugins/quota/quota-maildir.c:
	Fix to maildirsize reading optimization.
	[d719b373a1aa]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage-private.h, src/lib-
	storage/mail-storage.c:
	If mail storage or mailbox can't be accessed because of EACCES, log
	an error message that clearly shows where the permission problem is.
	[93fe72ef59f6]

	* src/lib-storage/index/index-sync.c:
	Don't crash if sync initialization fails.
	[f090b6bf8021]

	* src/plugins/quota/quota-maildir.c:
	Don't re-read maildirsize if it hasn't changed.
	[9841a8563116]

	* src/plugins/quota/quota-maildir.c:
	If quota limits weren't specified, they should have been taken from
	maildirsize file.
	[097fe25ab218]

2008-01-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Previous garbage fix was still incorrect. Fixed it and also changed
	extensions to be unsigned char* so it can't be accidentally used as
	a normal string.
	[2e60288f0d75]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Extensions weren't copied in memory correctly, possibly causing
	garbage to be written to uidlist file.
	[36092ec27396]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Optimization fix: We always read dovecot-uidlist from the beginning
	of the file even though we could have just read the new lines.
	[b9d78196e9ba]

	* src/plugins/zlib/istream-zlib.c:
	Assert-crashfix.
	[e33119f2dfdc]

	* src/plugins/zlib/zlib-plugin.c:
	Maildir: Don't crash if mailbox couldn't be opened. Patch by Richard
	Platel.
	[93b1d16dc720]

2008-01-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Log errors in dovecot-uidlist better.
	[c8f5955a4cf8]

	* src/master/master-settings.c:
	If we see that Dovecot is already running, log the error as fatal
	instead of later giving "Invalid configuration" fatal.
	[805d0831deb6]

	* configure.in:
	Don't use posix_fallocate() with GLIBC versions older than 2.7. It
	probably works with a bit older versions, but at least in 2.3.5 it
	can cause infinite loops.
	[d349cdeddc7d]

2008-01-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c:
	If extension record was tried to be updated for uid=0, log an error
	instead of crashing. Also log error if uid >= next_uid.
	[b7fc50c68c35]

2008-01-14  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-squat/squat-test.c:
	Fixes
	[1bcb1bae8bed]

	* src/plugins/fts-squat/squat-trie.c:
	squat_trie_lookup(): Make sure we clear result arrays first.
	[b2333f0f23af]

	* src/plugins/fts-squat/squat-test.c:
	Add only valid UTF-8 data to Squat index.
	[f1220b37d7f7]

	* src/plugins/fts-squat/squat-trie.c:
	Don't use ioloop_time. Fixes squat-test which doesn't create ioloop.
	[2de2058a5cdc]

	* src/plugins/fts-squat/squat-trie.c:
	Init header for newly created files.
	[f41bd3065ec8]

	* src/lib/unichar.c:
	uni_utf8_get_valid_data(): Check for invalid UTF-8 better.
	[0c1d5a814368]

2008-01-12  Timo Sirainen  <tss@iki.fi>

	* src/lib/nfs-workarounds.c:
	Fixed nfs_flush_file_handle_cache() for Solaris when trying to flush
	the current directory's cache. Now we temporarily change to parent
	directory so rmdir() doesn't return EINVAL.
	[5dda06c19eb1]

	* src/lib/nfs-workarounds.c:
	nfs_flush_file_handle_cache_dir: If rmdir() fails with EACCES, the
	cache is flushed.
	[dd64c0e649aa]

	* src/lib/ioloop.c:
	Another fix for io_loop_get_wait_time()
	[5587fcd83636]

	* src/lib/ioloop-kqueue.c:
	Ignore io_loop_get_wait_time() return value, we don't need it.
	[4ecc97c9ce12]

	* src/lib/ioloop-internal.h, src/lib/ioloop.c:
	timeout_get_wait_time() may have returned negative seconds in
	timeval. Also changed the timeval variable name to tv_r to make it
	clearer it's a return value.
	[3e506d46655f]

	* src/imap/client.c, src/imap/client.h:
	Use more robust command calling in output handler.
	[2ced9dd8b2cc]

	* src/imap/client.c:
	Use linked list macros for command queue.
	[8a531386c856]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-idle.c:
	Replaced waiting_ambiguity bitmask with a command state.
	[323b425a0f46]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-fetch.c, src/imap/cmd-idle.c, src/imap/cmd-list.c,
	src/imap/imap-sync.c:
	Added "command state" for running commands. Use it instead of some
	bitfields to test for the current state.
	[5e3188213724]

2008-01-11  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-private.h, src/plugins/quota/quota-
	storage.c, src/plugins/quota/quota.c:
	Added quota_exceeded_message setting.
	[740a17139b67]

	* src/plugins/zlib/zlib-plugin.c:
	Fixed assert-crash when trying to open compressed maildir files.
	[ca223be145b5]

	* src/lib-index/mail-index-sync.c:
	Make sure tail offset gets updated when extension records are
	updated.
	[5187649faa52]

	* src/lib-index/mail-index-sync-update.c:
	Fixed index reopen check to work more correctly when syncing
	view/head.
	[0734af67ca99]

	* src/lib-index/mail-index-sync-update.c:
	If mmap_disable=yes, don't reopen index file unless we really have
	to, because it causes cache sync to get lost.
	[81d7093fb892]

2008-01-10  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c:
	"Disconnected for inactivity in reading our output" happened after a
	command had already finished.
	[58cb2c6f90c7]

	* src/imap/cmd-rename.c:
	Disallow RENAME box box/child.
	[ead08ca27435]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Removed accidentally committed pointless assert.
	[979294cabcab]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Don't try to recreate dovecot-uidlist if we're not locked.
	[7424de4bac23]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-transaction.c:
	Link cache records together directly when writing the new records,
	instead of delaying them until later and causing lots of small
	writes. We still do this delayed check and do the writes when it's
	required, but it shouldn't happen normally.
	[876c7bca351c]

2008-01-07  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/login-common/client-common.h, src
	/login-common/main.c, src/pop3-login/client.c:
	Added clients_init() and clients_deinit() back (for Managesieve).
	[c33c87781ab4]

	* src/deliver/deliver.c:
	If USER and HOME environments both exists, never do getpwuid()
	lookup. If HOME doesn't exist, do the lookup but don't fail unless
	also USER doesn't exist.
	[24526ffec9a2]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Changed assert to first check if dotlock had been overridden, and if
	so log an error instead of crashing.
	[9fef306a0d95]

	* src/lib/file-dotlock.c, src/lib/file-dotlock.h:
	Added file_dotlock_is_locked().
	[9c2b65bfe604]

	* src/lib-index/mail-index-transaction.c:
	When converting sequence ranges to UID ranges, don't try to optimize
	the UID ranges by letting them contain expunged UIDs. This makes the
	transactions somewhat larger if UID range has holes, but it properly
	fixes problems with updating flags for expunged messages.
	[e0115302e68e]

	* src/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-index-
	sync-private.h, src/lib-index/mail-index-sync-update.c, src/lib-
	index/mail-index-view-sync.c:
	Reverted fix for dropping expunged messages from flag updates. It's
	more common that the UID range was actually meant to include the
	expunged message.
	[a1d1f7c9671e]

2008-01-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-parser.c:
	If IMAP_PARSE_FLAG_ATOM_ALLCHARS is enabled, allow also ')'
	characters in atoms if no lists are open.
	[0355a4603e80]

	* src/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-index-
	sync-private.h, src/lib-index/mail-index-sync-update.c, src/lib-
	index/mail-index-view-sync.c:
	If a message was expunged but is still visible in a view, its
	flags/keywords might have been updated if an uid range included the
	expunged message.
	[26dbad6c08f3]

	* src/lib-storage/index/index-mail.c:
	Don't crash with 0 byte mails when saving/copying them and trying to
	add e.g. bodystructure to cache.
	[0c1859ca8ee9]

	* src/imap/imap-sync.c, src/lib-storage/index/index-storage.h, src
	/lib-storage/index/index-sync-changes.c, src/lib-storage/index
	/index-sync-changes.h, src/lib-storage/index/index-sync.c, src/lib-
	storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/mbox/mbox-sync-update.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/mail-storage.h:
	When syncing a mailbox, sync the view internally first completely
	and just get a list of messages that have changed. Then just have
	mailbox_sync_next() return flag updates from that list. This avoids
	duplicate notifications and also fixes some bugs in previous
	implementation.

	MAILBOX_SYNC_TYPE_KEYWORDS no longer exists, keyword changes are
	included in MAILBOX_SYNC_TYPE_FLAGS.
	[98788fdcc3a6]

	* src/lib/seq-range-array.c, src/lib/seq-range-array.h:
	Added unoptimized seq_range_array_add_range()
	[010485455f75]

	* src/imap/cmd-append.c, src/imap/cmd-idle.c:
	Reset idle timeout also in APPEND/IDLE.
	[0861436bfe14]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Buffer writes to dovecot-uidlist instead of doing lots of small
	write()s.
	[7ee2bee70d6a]

	* src/lib/restrict-access.c:
	Setting extra groups crashed.
	[fe42e3097e23]

	* src/auth/auth-request-handler.c, src/auth/auth-request.c, src/auth
	/auth-request.h:
	If proxy user has a password and authentication fails, don't return
	the proxy fields to client.
	[25e7c37c7c10]

	* src/auth/auth-request-handler.c, src/auth/auth-request.c, src/auth
	/auth-request.h, src/auth/auth-stream.c, src/auth/auth-stream.h:
	Added "proxy_maybe" field. If it's used instead of "proxy" and the
	proxy destination matches the current connection, the user is logged
	in normally instead of the login failing with "Proxying loops".
	[fb03422c0760]

	* src/imap-login/client-authenticate.c:
	Fixed assert-crash when login fails to proxied server.
	[05bc8679c886]

	* src/login-common/client-common.c:
	Use linked list macros for handling clients linked list.
	[eb71cda96663]

	* src/login-common/login-proxy.c, src/login-common/ssl-proxy-
	openssl.c:
	Replaced clients hash with a linked list.
	[8c6a7af67e8c]

	* src/lib/Makefile.am, src/lib/llist.h:
	Added macros for handling a doubly linked list.
	[b626d8975193]

	* src/imap-login/imap-proxy.c, src/login-common/client-common.c, src
	/login-common/login-proxy.c, src/pop3-login/pop3-proxy.c:
	Make sure all user input is sanitized before it's logged.
	[769181a20483]

	* src/imap-login/client-authenticate.c:
	If proxying tries to loop to itself, fail the login and log an
	error.
	[df5e4bea11e2]

	* src/imap-login/client-authenticate.c:
	Assert-crashfix
	[fc06e748f8e4]

	* src/imap-login/client.c:
	"Waiting for auth process" was supposed to come after 30s, not 30ms.
	[9bbe74f6f2a9]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/list/mailbox-list-maildir.c, src/lib-storage/mailbox-list.c:
	Fixes to handling INBOX with non-INBOX namespaces.
	[d5dd0841b2db]

	* src/lib/restrict-access.c:
	If RESTRICT_* environments aren't set, don't try to enable group -1.
	[bffc8788eb94]

2008-01-05  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-sql-example.conf:
	Comment updates
	[3b61ff127127]

	* doc/dovecot-sql-example.conf, src/auth/db-sql.c:
	Updated comments and defaults to SQL queries. SQL is typically used
	with separate user and domain fields, so use that kind of default
	settings.
	[c3365e886746]

	* src/auth/main.c, src/deliver/auth-client.c, src/dict/main.c,
	src/imap/main.c, src/lib/env-util.c, src/lib/env-util.h, src/lib
	/restrict-access.c, src/lib/restrict-access.h, src/login-
	common/main.c, src/master/auth-process.c, src/master/child-
	process.c, src/master/child-process.h, src/master/dict-process.c,
	src/master/login-process.c, src/master/mail-process.c, src/master
	/ssl-init.c, src/plugins/expire/auth-client.c, src/pop3/main.c,
	src/util/rawlog.c:
	Reverted "environment array" changes. It broke overriding imap/pop3
	settings from userdb and the performance improvements weren't all
	that great anyway.
	[e6823d781317]

2008-01-04  Timo Sirainen  <tss@iki.fi>

	* src/tests/test-lib.c, src/tests/test-mail.c:
	Fixed tests. utc_mktime() can't handle returning
	-2^(TIME_T_MAX_BITS-1).
	[fe74d0999e3a]

	* src/tests/test-lib.c:
	Added utc_mktime() unit test.
	[95cadc27d344]

	* src/auth/auth-request.c:
	If AUTH has "nologin" parameter, the request is freed when
	authentication is finished (instead of delayed until master looks it
	up).
	[1bd8b17bfabe]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c:
	Fixes to handling when fields are dropped from cache file.
	[f0ad529ac9ea]

	* src/login-common/client-common.c, src/login-common/client-common.h,
	src/login-common/main.c:
	Forgot from imap/pop3-login clients hash -> linked list commit.
	[db5f55daa002]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-search.c, src/imap/common.h, src/pop3/client.c,
	src/pop3/client.h:
	Use separate idle timeouts to avoid unneededly checking them every n
	seconds.
	[284dd5f2777d]

	* src/imap-login/client.c, src/pop3-login/client.c:
	Minor cleanups
	[75f4e7ce8151]

	* src/imap-login/client.c, src/pop3-login/client.c:
	Use a linked list to keep track of all clients instead of a hash
	table.
	[09556a64b4e5]

	* src/pop3-login/client.c:
	Idle timeout should have been 180 seconds, not 180 milliseconds.
	[4c6364f99ff0]

2008-01-03  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/pop3-login/client.c,
	src/pop3-login/client.h:
	Use separate per-client timeouts instead of going through all
	clients in one timeout.
	[3f5b7bebfd82]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-internal.h, src/lib/ioloop-
	kqueue.c, src/lib/ioloop-poll.c, src/lib/ioloop-select.c,
	src/lib/ioloop.c, src/lib/ioloop.h:
	Use priority queue to implement timeout handling. Added
	timeout_reset().
	[becdf2eacdce]

	* src/lib/Makefile.am, src/lib/priorityq.c, src/lib/priorityq.h,
	src/tests/test-lib.c:
	Added a priority queue implementation.
	[618472c2c3c5]

	* src/lib/mempool-alloconly.c, src/tests/test-lib.c:
	If giving pool_alloconly_create() less than 40 bytes as the initial
	size with 32bit systems, destroying the pool crashed.
	[bf1d4795085f]

2008-01-02  Timo Sirainen  <tss@iki.fi>

	* src/master/auth-process.c, src/master/child-process.c:
	Fixes to envarr changes.
	[e06ee42ad5f9]

	* configure.in, src/deliver/Makefile.am, src/imap/Makefile.am,
	src/plugins/convert/Makefile.am, src/plugins/expire/Makefile.am,
	src/plugins/fts-squat/Makefile.am, src/pop3/Makefile.am:
	Changed library linking order.
	[145f721b6412]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/raw/raw-storage.c, src/lib-
	storage/mail-storage.c:
	libstorage.a shouldn't reference symbols in libstorage_index.a.
	Changed index_storage_destroy_unrefed() call to be done by
	storage.destroy().
	[f0623745bd4c]

	* src/master/mail-process.c:
	Fixed NFS warning check. We can't use getenv() anymore.
	[a31c0f6f4386]

	* src/auth/main.c, src/deliver/auth-client.c, src/dict/main.c,
	src/imap/main.c, src/lib/restrict-access.c, src/lib/restrict-
	access.h, src/login-common/main.c, src/master/auth-process.c,
	src/master/child-process.c, src/master/child-process.h, src/master
	/dict-process.c, src/master/login-process.c, src/master/mail-
	process.c, src/master/ssl-init.c, src/plugins/expire/auth-client.c,
	src/pop3/main.c, src/util/rawlog.c:
	Build environment using envarr and pass it to execve(). This is
	faster than using putenv() directly. restrict_access_*_env() API
	changed to take environment array parameter.
	[59ac3628b8d8]

	* src/lib/env-util.c, src/lib/env-util.h:
	Added functions for building an "environment array". It can be
	passed later to execve().
	[c8878d66c4a1]

	* dovecot-example.conf, src/auth/auth-request-handler.c,
	src/auth/auth.h, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added auth_failure_delay setting.
	[10d49a20b04e]

2008-01-01  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request-handler.c, src/auth/auth-request-handler.h,
	src/auth/main.c:
	Make sure failed auth requests stay in failure buffer for at least a
	second.
	[958500009336]

	* src/auth/auth-request-handler.c, src/auth/auth-worker-server.c:
	Converted some buffers to arrays.
	[a281705a2360]

	* src/auth/auth-cache.c, src/auth/auth-client-connection.c, src/auth
	/auth-master-connection.c, src/auth/auth-master-listener.c, src/auth
	/auth-request-handler.c, src/auth/auth-request.c, src/auth/auth-
	stream.c, src/auth/auth-worker-client.c, src/auth/auth-worker-
	server.c, src/auth/auth.c, src/auth/db-ldap.c, src/auth/db-passwd-
	file.c, src/auth/db-sql.c, src/auth/main.c, src/auth/mech-
	anonymous.c, src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c,
	src/auth/mech-plain.c, src/auth/mech.c, src/auth/passdb-blocking.c,
	src/auth/passdb-bsdauth.c, src/auth/passdb-cache.c, src/auth/passdb-
	checkpassword.c, src/auth/passdb-ldap.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-sql.c, src/auth/passdb-vpopmail.c, src/auth/passdb.c,
	src/auth/password-scheme.c, src/auth/userdb-blocking.c, src/auth
	/userdb-ldap.c, src/auth/userdb-nss.c, src/auth/userdb-passwd-
	file.c, src/auth/userdb-passwd.c, src/auth/userdb-prefetch.c,
	src/auth/userdb-sql.c, src/auth/userdb-static.c, src/auth/userdb-
	vpopmail.c, src/auth/userdb.c, src/deliver/auth-client.c,
	src/deliver/deliver.c, src/deliver/duplicate.c, src/deliver/mail-
	send.c, src/deliver/smtp-client.c, src/dict/dict-server.c,
	src/dict/main.c, src/imap-login/client-authenticate.c, src/imap-
	login/client.c, src/imap-login/imap-proxy.c, src/imap/client.c,
	src/imap/cmd-append.c, src/imap/cmd-capability.c, src/imap/cmd-
	check.c, src/imap/cmd-close.c, src/imap/cmd-copy.c, src/imap/cmd-
	create.c, src/imap/cmd-delete.c, src/imap/cmd-examine.c, src/imap
	/cmd-expunge.c, src/imap/cmd-fetch.c, src/imap/cmd-idle.c, src/imap
	/cmd-list.c, src/imap/cmd-logout.c, src/imap/cmd-lsub.c, src/imap
	/cmd-namespace.c, src/imap/cmd-noop.c, src/imap/cmd-rename.c,
	src/imap/cmd-search.c, src/imap/cmd-select.c, src/imap/cmd-sort.c,
	src/imap/cmd-status.c, src/imap/cmd-store.c, src/imap/cmd-
	subscribe.c, src/imap/cmd-thread.c, src/imap/cmd-uid.c, src/imap
	/cmd-unselect.c, src/imap/cmd-unsubscribe.c,
	src/imap/cmd-x-cancel.c, src/imap/commands-util.c,
	src/imap/commands.c, src/imap/imap-expunge.c, src/imap/imap-fetch-
	body.c, src/imap/imap-fetch.c, src/imap/imap-messageset.c, src/imap
	/imap-search.c, src/imap/imap-sort.c, src/imap/imap-status.c,
	src/imap/imap-sync.c, src/imap/imap-thread.c, src/imap/mail-storage-
	callbacks.c, src/imap/main.c, src/lib-auth/auth-client.c, src/lib-
	auth/auth-server-connection.c, src/lib-auth/auth-server-request.c,
	src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-dict/dict-client.c, src/lib-dict/dict-db.c, src/lib-dict/dict-
	sql.c, src/lib-dict/dict.c, src/lib-imap/imap-base-subject.c, src
	/lib-imap/imap-bodystructure.c, src/lib-imap/imap-date.c, src/lib-
	imap/imap-envelope.c, src/lib-imap/imap-match.c, src/lib-imap/imap-
	parser.c, src/lib-imap/imap-quote.c, src/lib-imap/imap-util.c, src
	/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	decisions.c, src/lib-index/mail-cache-fields.c, src/lib-index/mail-
	cache-lookup.c, src/lib-index/mail-cache-sync-update.c, src/lib-
	index/mail-cache-transaction.c, src/lib-index/mail-cache.c, src/lib-
	index/mail-hash.c, src/lib-index/mail-index-dummy-view.c, src/lib-
	index/mail-index-fsck.c, src/lib-index/mail-index-lock.c, src/lib-
	index/mail-index-map.c, src/lib-index/mail-index-sync-ext.c, src
	/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index-transaction-view.c, src/lib-index/mail-index-transaction.c,
	src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index-
	view.c, src/lib-index/mail-index-write.c, src/lib-index/mail-
	index.c, src/lib-index/mail-transaction-log-append.c, src/lib-index
	/mail-transaction-log-file.c, src/lib-index/mail-transaction-log-
	view.c, src/lib-index/mail-transaction-log.c, src/lib-index/mailbox-
	list-index-sync.c, src/lib-index/mailbox-list-index.c, src/lib-mail
	/istream-header-filter.c, src/lib-mail/message-address.c, src/lib-
	mail/message-date.c, src/lib-mail/message-decoder.c, src/lib-mail
	/message-header-decode.c, src/lib-mail/message-header-parser.c, src
	/lib-mail/message-id.c, src/lib-mail/message-parser.c, src/lib-mail
	/message-part-serialize.c, src/lib-mail/message-search.c, src/lib-
	mail/message-send.c, src/lib-mail/message-size.c, src/lib-mail
	/quoted-printable.c, src/lib-mail/rfc822-parser.c, src/lib-
	settings/settings.c, src/lib-sql/driver-mysql.c, src/lib-sql/driver-
	pgsql.c, src/lib-sql/sql-api.c, src/lib-sql/sql-pool.c, src/lib-
	storage/index/cydir/cydir-mail.c, src/lib-storage/index/cydir/cydir-
	save.c, src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/cydir/cydir-sync.c, src/lib-storage/index/cydir/cydir-
	transaction.c, src/lib-storage/index/dbox/dbox-file-maildir.c, src
	/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-index.c, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox/dbox-
	storage.c, src/lib-storage/index/dbox/dbox-sync-file.c, src/lib-
	storage/index/dbox/dbox-sync-rebuild.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/dbox/dbox-transaction.c, src
	/lib-storage/index/index-fetch.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-mailbox-check.c, src/lib-storage/index/index-search.c, src
	/lib-storage/index/index-sort.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-sync-changes.c, src/lib-storage/index/index-
	sync.c, src/lib-storage/index/index-transaction.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-filename.c, src/lib-storage/index/maildir/maildir-
	keywords.c, src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-sync-
	index.c, src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-transaction.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib-storage/index/mbox/mbox-file.c, src
	/lib-storage/index/mbox/mbox-from.c, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-md5.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-sync-parse.c, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c, src/lib-storage/index/mbox
	/mbox-transaction.c, src/lib-storage/index/raw/raw-mail.c, src/lib-
	storage/index/raw/raw-storage.c, src/lib-storage/index/raw/raw-
	sync.c, src/lib-storage/index/raw/raw-transaction.c, src/lib-
	storage/list/index-mailbox-list-sync.c, src/lib-storage/list/index-
	mailbox-list.c, src/lib-storage/list/mailbox-list-fs-iter.c, src
	/lib-storage/list/mailbox-list-fs.c, src/lib-storage/list/mailbox-
	list-maildir-iter.c, src/lib-storage/list/mailbox-list-maildir.c,
	src/lib-storage/list/mailbox-list-subscriptions.c, src/lib-
	storage/list/subscription-file.c, src/lib-storage/mail-copy.c, src
	/lib-storage/mail-error.c, src/lib-storage/mail-namespace.c, src
	/lib-storage/mail-search.c, src/lib-storage/mail-storage.c, src/lib-
	storage/mail.c, src/lib-storage/mailbox-list.c, src/lib-storage
	/mailbox-tree.c, src/lib/aqueue.c, src/lib/backtrace-string.c,
	src/lib/base64.c, src/lib/bsearch-insert-pos.c, src/lib/buffer.c,
	src/lib/close-keep-errno.c, src/lib/compat.c, src/lib/crc32.c,
	src/lib/data-stack.c, src/lib/env-util.c, src/lib/failures.c,
	src/lib/fd-close-on-exec.c, src/lib/fd-set-nonblock.c,
	src/lib/fdpass.c, src/lib/file-cache.c, src/lib/file-copy.c, src/lib
	/file-dotlock.c, src/lib/file-lock.c, src/lib/file-set-size.c,
	src/lib/hash.c, src/lib/hex-binary.c, src/lib/hex-dec.c, src/lib
	/home-expand.c, src/lib/hostpid.c, src/lib/imem.c, src/lib/ioloop-
	notify-dn.c, src/lib/ioloop-notify-fd.c, src/lib/ioloop-notify-
	inotify.c, src/lib/ioloop-notify-none.c, src/lib/ioloop-poll.c,
	src/lib/ioloop-select.c, src/lib/ioloop.c, src/lib/iostream.c,
	src/lib/istream-concat.c, src/lib/istream-crlf.c, src/lib/istream-
	data.c, src/lib/istream-file.c, src/lib/istream-limit.c, src/lib
	/istream-mmap.c, src/lib/istream-seekable.c, src/lib/istream-tee.c,
	src/lib/istream.c, src/lib/lib-signals.c, src/lib/lib.c, src/lib
	/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib/mempool-
	system-clean.c, src/lib/mempool-system.c, src/lib/mempool-unsafe-
	datastack.c, src/lib/mempool.c, src/lib/mkdir-parents.c, src/lib
	/mmap-anon.c, src/lib/mmap-util.c, src/lib/module-dir.c,
	src/lib/mountpoint.c, src/lib/network.c, src/lib/nfs-workarounds.c,
	src/lib/ostream-file.c, src/lib/ostream.c, src/lib/printf-format-
	fix.c, src/lib/process-title.c, src/lib/randgen.c, src/lib/read-
	full.c, src/lib/restrict-access.c, src/lib/restrict-process-size.c,
	src/lib/safe-memset.c, src/lib/safe-mkdir.c, src/lib/safe-mkstemp.c,
	src/lib/sendfile-util.c, src/lib/seq-range-array.c, src/lib/str-
	find.c, src/lib/str-sanitize.c, src/lib/str.c, src/lib/strescape.c,
	src/lib/strfuncs.c, src/lib/unichar.c, src/lib/unix-socket-create.c,
	src/lib/unlink-directory.c, src/lib/unlink-old-files.c, src/lib/utc-
	mktime.c, src/lib/utc-offset.c, src/lib/var-expand.c, src/lib/write-
	full.c, src/login-common/client-common.c, src/login-common/login-
	proxy.c, src/login-common/main.c, src/login-common/master.c, src
	/login-common/sasl-server.c, src/login-common/ssl-proxy-gnutls.c,
	src/login-common/ssl-proxy-openssl.c, src/login-common/ssl-proxy.c,
	src/master/askpass.c, src/master/auth-process.c, src/master/child-
	process.c, src/master/dict-process.c, src/master/dup2-array.c,
	src/master/listener.c, src/master/log.c, src/master/login-process.c,
	src/master/mail-process.c, src/master/main.c, src/master/master-
	settings.c, src/master/ssl-init-gnutls.c, src/master/ssl-init-
	main.c, src/master/ssl-init-openssl.c, src/master/ssl-init.c,
	src/master/syslog-util.c, src/plugins/acl/acl-api.c, src/plugins/acl
	/acl-backend-vfile-acllist.c, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/acl/acl-backend.c, src/plugins/acl/acl-cache.c,
	src/plugins/acl/acl-mailbox-list.c, src/plugins/acl/acl-mailbox.c,
	src/plugins/acl/acl-plugin.c, src/plugins/acl/acl-storage.c,
	src/plugins/convert/convert-plugin.c, src/plugins/convert/convert-
	storage.c, src/plugins/convert/convert-tool.c, src/plugins/expire
	/auth-client.c, src/plugins/expire/expire-env.c, src/plugins/expire
	/expire-plugin.c, src/plugins/expire/expire-tool.c, src/plugins/fts-
	lucene/fts-backend-lucene.c, src/plugins/fts-lucene/fts-lucene-
	plugin.c, src/plugins/fts-squat/fts-backend-squat.c, src/plugins
	/fts-squat/fts-squat-plugin.c, src/plugins/fts-squat/squat-test.c,
	src/plugins/fts-squat/squat-trie.c, src/plugins/fts-squat/squat-
	uidlist.c, src/plugins/fts/fts-api.c, src/plugins/fts/fts-plugin.c,
	src/plugins/fts/fts-search.c, src/plugins/fts/fts-storage.c,
	src/plugins/imap-quota/imap-quota-plugin.c, src/plugins/lazy-expunge
	/lazy-expunge-plugin.c, src/plugins/mail-log/mail-log-plugin.c,
	src/plugins/mbox-snarf/mbox-snarf-plugin.c, src/plugins/quota/quota-
	count.c, src/plugins/quota/quota-dict.c, src/plugins/quota/quota-
	dirsize.c, src/plugins/quota/quota-fs.c, src/plugins/quota/quota-
	maildir.c, src/plugins/quota/quota-plugin.c, src/plugins/quota
	/quota-storage.c, src/plugins/quota/quota.c, src/plugins/trash
	/trash-plugin.c, src/plugins/zlib/istream-zlib.c, src/plugins/zlib
	/zlib-plugin.c, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/pop3-proxy.c,
	src/pop3/client.c, src/pop3/commands.c, src/pop3/main.c, src/tests
	/test-common.c, src/tests/test-istream.c, src/tests/test-lib.c,
	src/tests/test-mail.c, src/util/gdbhelper.c, src/util/idxview.c,
	src/util/listview.c, src/util/logview.c, src/util/rawlog.c:
	Updated copyright notices to include year 2008.
	[7ed926ed7aa4]

	* dovecot-config.in.in:
	s/SS_LIBS/SSL_LIBS/
	[d60a2e859e38]

	* src/lib/unichar.c:
	uni_ucs4_to_utf8(): Check len>0 first so we don't access input[len].
	[d8e7699ac68e]

	* dovecot-config.in.in:
	Added SSL_LIBS
	[de129bdc9f58]

	* src/deliver/deliver.c:
	If mail begins with a mbox From_ line, take the message's received
	date from it. Also if -f parameter hasn't been specified, take the
	envelope sender from it.
	[ce15433c6212]

	* doc/dovecot-sql-example.conf, src/lib-sql/driver-mysql.c:
	Renamed default_file/group to option_file/group.
	[ab81d6801423]

	* doc/dovecot-sql-example.conf, src/lib-sql/driver-mysql.c:
	Added default_file and default_group settings for MySQL. Patch by
	Luca Longinotti
	[19bd363bcf5d]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/lib/Makefile.am,
	src/lib/aqueue.c, src/lib/aqueue.h, src/lib/queue.c,
	src/lib/queue.h, src/tests/test-lib.c:
	Renamed queue to aqueue ("array queue") because struct queue already
	exists in Solaris.
	[d45c3058b91a]

2007-12-30  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Don't check for getrusage(), we no longer need it.
	[4e3c7037c2ca]

	* src/lib/randgen.c:
	If OpenSSL's random number generator can't initialize itself, fail
	instead of initializing it with weak entropy. If this happens (i.e.
	no /dev/urandom or /dev/random), the user can install egd on
	/var/run/egd-pool or some other location that OpenSSL internally
	checks.
	[aa9a4d419905]

	* src/lib-index/mail-cache-decisions.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-private.h:
	Update caching decision for fields even if it doesn't currently
	exist in the cache file. If the field is added later within the
	session, the decision and last_used field will be correct.
	[3cb00348ed06]

	* src/lib-index/mail-cache-fields.c:
	Don't trigger cache compression based on fields with a forced
	decision.
	[c8507f755f0b]

	* .hgtags:
	Added tag 1.1.beta13 for changeset 358cba31b4d5
	[0b2955fc57f1]

	* configure.in:
	Released v1.1.beta13.
	[358cba31b4d5] [1.1.beta13]

2007-12-29  Timo Sirainen  <tss@iki.fi>

	* TODO:
	updated
	[238816066c95]

	* src/lib-mail/message-decoder.c:
	If Content-Transfer-Encoding type is unknown, skip the body instead
	of handling it as binary.
	[5de49bb0a7b3]

	* src/lib-index/mail-cache-fields.c:
	If cache field is cached with decision=no, don't try to compress
	cache file just to get rid of it.
	[1bf9e7248e15]

	* src/lib-index/mail-cache-decisions.c:
	Update last_used also for decision=yes cache fields, otherwise they
	get dropped when compressing.
	[46d531d521b9]

	* src/lib-index/mail-cache-compress.c:
	Don't drop fields whose decision has been forced.
	[180e219aab9a]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-sync-index.c:
	Fixed handling \Recent flags.
	[7999ce2bb43a]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If MAILBOX_SYNC_FLAG_FULL_READ flag is set (SELECT and CHECK IMAP
	commands), make sure we refresh maildirs with delayed syncs.
	[048325df1ec4]

	* src/lib/file-dotlock.c:
	If dotlock file contains pid <= 0, assume it's invalid.
	[04e048fcd6d7]

	* src/lib-index/mail-index-transaction-view.c:
	mail_index_lookup_seq*() were broken for updated transaction view
	when trying to find messages past the first newly appended message.
	[046d06f52aa6]

	* src/imap/commands-util.c:
	Last change broke fetching keywords
	[f9fa0f38cb0e]

	* src/auth/db-ldap.c:
	When aborting queued requests, log the reason for it.
	[36402809db43]

	* src/lib/ostream-file.c:
	If writev() fails for non-file and nothing was sent, return failure
	instead of ignoring the error.
	[4ff39d30aa4a]

	* src/lib-storage/index/maildir/maildir-save.c:
	Free mail before committing index sync to avoid crashes when
	updating cache file.
	[72122918288c]

	* src/lib-storage/mail-namespace.c:
	Set ns->sep before creating storage so sep_str gets set correctly.
	[0a0ff276bc38]

	* src/lib-index/mail-cache-fields.c:
	Previous compiler warning fix changes broke cache file reading.
	[cf4cee852a05]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-close.c, src/imap
	/cmd-select.c, src/imap/cmd-unselect.c, src/imap/commands-util.c,
	src/imap/commands-util.h, src/imap/imap-fetch.c, src/imap/imap-
	fetch.h, src/imap/imap-sync.c:
	FLAGS/PERMENENTFLAGS weren't always sent to client early enough.
	Also optimized sending keywords with FETCH FLAGS.
	[81f4c9689c18]

	* src/imap/cmd-append.c:
	client_parse_mail_flags() no longer does keyword verification, so
	there's no need to change client->keywords.
	[097c70cfa55e]

	* src/imap/imap-sync.c:
	Removed debugging code.
	[428884a4e297]

	* src/lib-index/mail-cache-sync-update.c, src/lib-index/mail-cache-
	transaction.c, src/lib-index/mail-index-sync-update.c:
	Fixed crashes at error conditions.
	[4c6e9edfd4ce]

	* src/lib/file-dotlock.c:
	If we use notify I/O to watch for dotlock deletion, make sure we
	still sleep a while after overriding a dotlock. Otherwise multiple
	processes might try to do that at the same time and unlink each
	others' newly created dotlocks.
	[622fa7cef9db]

	* src/lib/data-stack.c:
	Fixed buffer overflow checking code.
	[c751ec28b869]

	* src/lib/data-stack.c:
	Don't access uninitialized memory.
	[1d37d2997220]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	src/auth/userdb-ldap.c:
	LDAP handling rewrite. Reconnections are handled a lot better now.
	If connection is down, requests are added to queue and they always
	stay there at least 4 seconds.
	[0dcea80312b0]

	* src/lib/Makefile.am, src/lib/array.h, src/lib/queue.c,
	src/lib/queue.h, src/tests/test-lib.c:
	Added queue implementation.
	[bbeee3db9967]

	* src/tests/test-lib.c:
	Run each test in its own data stack frame.
	[2eeb9b2d8f9a]

	* src/tests/test-common.c, src/tests/test-common.h:
	Added test_out_reason()
	[3fe934d0843a]

2007-12-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c:
	When doing a forced sync, we're not necessarily locked. If it takes
	a while, don't try to touch dovecot-uidlist and assert-crash.
	[e74a1d1dca07]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c:
	If LDAP server disconnects the connection and we haven't sent
	requests for a minute, disconnect silently and don't reconnect until
	the next auth request comes.
	[ae0556fb268d]

	* src/lib-storage/index/raw/raw-mail.c:
	raw storage caused assert-crashes after mail_get_stream(). Fixes
	deliver.
	[b7f037c8ff57]

	* src/deliver/duplicate.c, src/lib-index/mail-cache-compress.c, src
	/lib-index/mail-cache-fields.c, src/lib-storage/index/dbox/dbox-
	sync.c, src/lib-storage/index/index-sort.c, src/lib-
	storage/index/maildir/maildir-sync-index.c, src/lib/failures.c,
	src/plugins/fts-squat/squat-trie.c:
	Compiler warning fixes on 32bit systems.
	[7708a8c166d6]

2007-12-27  Timo Sirainen  <tss@iki.fi>

	* src/lib/unichar.c, src/lib/unichar.h:
	Define unichars array type and use it for uni_utf8_to_ucs4() output.
	[dcbf6afdf931]

	* src/lib/failures.c, src/lib/failures.h:
	Make failure_log_type_prefixes[] and failure_exit() public.
	[cc70ab74f4f3]

2007-12-23  cras  <cras@kaali>

	* src/pop3/Makefile.am:
	str_sanitize.o no longer needs to be in unused_objects.
	[5e0f115665bf]

2007-12-22  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.1.beta12 for changeset a1353d4fc3b6
	[1496782a2461]

	* configure.in:
	Released v1.1.beta12.
	[a1353d4fc3b6] [1.1.beta12]

	* src/lib/data-stack.c:
	DEBUG: Fixed clearing data stack memory.
	[215e96e1f6a3]

	* src/lib/data-stack.c:
	Crashfix
	[1ed56d4064f5]

	* src/lib-storage/index/index-mail.c:
	Free filter_stream before mail stream so we don't crash.
	[0f4e8b995760]

	* src/lib/istream.c:
	i_stream_seek(): If parent stream is set, use skip optimization only
	if all the parent streams are at their expected offsets.
	[e527ac1a7b4b]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-mail.c:
	Avoid moving raw stream offset.
	[5b40343e96c7]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib/istream-concat.c, src/lib/istream-
	crlf.c, src/lib/istream-data.c, src/lib/istream-file.c, src/lib
	/istream-internal.h, src/lib/istream-limit.c, src/lib/istream-
	mmap.c, src/lib/istream-seekable.c, src/lib/istream-tee.c,
	src/lib/istream.c, src/plugins/zlib/istream-zlib.c:
	i_stream_create() now takes parent stream as parameter and
	internally sets abs_start_offset correctly. Added
	parent_start_offset which is used by filters instead of their own
	internal start_offset.
	[85cf52f0bc64]

	* src/deliver/deliver.c, src/imap/cmd-append.c, src/imap/imap-fetch-
	body.c, src/lib-storage/index/dbox/dbox-file.c, src/lib-
	storage/index/dbox/dbox-sync-file.c, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-sync-rewrite.c,
	src/lib/istream-limit.c, src/lib/istream.h:
	Removed v_start_offset parameter from i_stream_create_limit(). We'll
	always use input->v_offset now.
	[4b51ee73ed51]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib/istream-crlf.c, src/lib/istream-
	internal.h, src/lib/istream-limit.c:
	Use istream_private->parent pointer globally instead of each filter
	stream having its own.
	[1a89a1509e81]

	* src/util/idxview.c:
	Show integer output for 64bit fixed fields in cache file.
	[595b600ddf8b]

	* src/lib-storage/index/mbox/mbox-save.c:
	Refresh index when we want to know the next_uid, otherwise we might
	have used too low value.
	[78a75a5a5350]

	* src/lib/data-stack.c, src/lib/data-stack.h:
	Removed DISABLE_DATA_STACK. Using it was probably broken anyway and
	it was confusing having two implementations in the same file.
	[ae06eb5e2638]

	* src/lib/data-stack.c:
	DEBUG: Make sure memory allocated from data stack doesn't overflow
	the buffer.
	[8dc08ad6717c]

	* src/lib/data-stack.c:
	DEBUG: Data stack wasn't cleared at t_pop() as it should have been.
	Also ignore data_stack_set_clean_after_pop(FALSE) if DEBUG is
	enabled.
	[984c05510dbc]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	Assert-crash if mail's input stream is closed too early or too late.
	[b42691420ff8]

	* src/lib/iostream-internal.h, src/lib/iostream.c, src/lib/istream.c,
	src/lib/istream.h:
	Added i_stream_set_destroy_callback().
	[56a5a00e490c]

	* src/imap/imap-fetch-body.c:
	If mail_get_stream() succeeds but mail_get_*_size() fails, we didn't
	reference the stream so we must not unreference it later either.
	[ebdd050c0a58]

	* src/imap/imap-fetch.c:
	Added assert
	[c4f4fa03e14e]

	* src/lib-index/mail-index-transaction.c:
	mail_index_transaction_reset() didn't reset
	mail_index_ext_set_reset_id() calls. Those calls also leaked memory.
	[a567e6863aa7]

	* src/imap/client.c:
	If client is sending a lot of commands at once, stop reading input
	instead of sending "BAD Too long argument".
	[08a3ba5de497]

	* src/imap/cmd-append.c:
	If post-APPEND syncing sent a lot of data, connection could have
	hanged.
	[b83be2b6ac8f]

	* src/imap/imap-fetch.c:
	When pipelining commands another command could have written output
	in the middle of FETCH literal.
	[80d3b8fcec09]

2007-12-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/mbox/mbox-
	mail.c, src/lib-storage/mail-storage.h:
	mail_get_physical_size() returns now the message stream's size and
	not the physical size on disk that varies. This fixes mbox issues
	and it's also more correct conceptually, because it doesn't return
	metadata size with other formats either.
	[ac32dc7ae0c1]

	* src/lib-storage/index/index-mail.c:
	Don't try to cache BODY/BODYSTRUCTURE if we didn't even parse it.
	[03cb4c0802a7]

	* src/lib-imap/imap-bodystructure.c:
	Add a context structure to all message parts and remove the NULL
	checks. That way instead of returning a broken reply,
	imap_bodystructure_write() crashes if caller tries to give it non-
	parsed MIME parts.
	[6835ac721609]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	maildir_uidlist_set_ext() assert-crashed when trying to set it to
	expunged message or so new message that we hadn't yet refreshed
	uidlist since seeing it.
	[7966e025ac0f]

	* src/lib-storage/index/mbox/mbox-save.c:
	When saving mail, it wasn't set \Recent when \Seen flag was also
	set.
	[2f25031c4a84]

	* src/plugins/quota/quota.c:
	Quota warnings may have been triggered too early.
	[71b9541adad1]

	* src/plugins/quota/quota.c:
	mail_debug=yes: Log quota warnings. Log rule limits in bytes.
	[e78c47c6ee8e]

	* src/plugins/quota/quota.c:
	Fixed using % in quota rules/warnings.
	[24233c8361fc]

	* src/lib-dict/dict-client.c:
	Don't try to reconnect more often than once/sec.
	[6950bb5e7921]

	* src/lib-dict/dict-client.c:
	Delay connecting to dict proxy until it's needed. Fixed also
	reconnecting.
	[6285b390311a]

	* src/plugins/quota/quota-storage.c:
	If transaction rollbacked, we assert-crashed.
	[712d92061ddf]

	* src/master/master-settings.c:
	Last dec2str() removal broke dovecot -n/-a for integers.
	[d8555d377101]

	* src/master/master-settings.c:
	If protocols=none, don't check if mail/login executables are usable.
	[421226dbdce1]

	* src/plugins/quota/quota-dirsize.c:
	Fixed with mboxes.
	[f622ddfb69b2]

	* src/lib/str-sanitize.c, src/lib/str-sanitize.h, src/tests/test-
	lib.c:
	str_sanitize*(): Don't crash if max_len is less than 3.
	str_sanitize(): If there's nothing to sanitize, don't bother
	allocating memory, just return the input string. Also allow NULL as
	input.
	[f359a0a9407f]

	* src/auth/userdb-vpopmail.c:
	userdb vpopmail crashed.
	[7305d675b05c]

	* src/lib-storage/list/mailbox-list-fs-iter.c:
	Don't use a temporary struct dirent ourself. In some systems we
	don't know easily how long filenames can be stored in it. Also now
	there's no need to try to handle too long filenames.
	[c45b8cbfb3fa]

2007-12-20  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	If LDAP base contained variables, auth cache should have included
	them in the cache key.
	[9e75e67420b4]

	* src/lib/compat.c:
	Compile fix: s/DSTACK_FRAME/T_FRAME/
	[0375f2c0a1f6]

2007-12-18  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c:
	T_FRAME() changes caused infinite looping.
	[0008fb28e62b]

2007-12-17  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	Check if we have maildir quota storages at all before trying to
	expunge messages.
	[021b6900a900]

	* src/plugins/quota/quota-maildir.c:
	Expunging messages didn't update maildirsize file if it wasn't
	already opened or if the file had since been replaced by another
	process.
	[2e9fcf711fc4]

	* src/plugins/quota/quota.c:
	Added more debugging with mail_debug=yes
	[79ba0e9a8725]

2007-12-11  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Updated ssl_ca_file comment.
	[ce2262d47250]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/login-common/client-common.h, src/login-common/sasl-server.c,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.c:
	Instead of logging only "Aborted login", log also if client tried to
	use plaintext auth, or if not log the number of authentication
	attempts.
	[249e6c711e8d]

2007-12-10  Timo Sirainen  <tss@iki.fi>

	* src/lib/restrict-access.c:
	Don't use empty setgroups() list to drop groups. It doesn't work at
	least with OSX.
	[d7a48bf83a0e]

	* configure.in:
	Add I18NLEVEL=1 capability.
	[e43c4db35e94]

2007-12-09  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.1.beta11 for changeset e334e53fcc61
	[b87b0fe8217d]

	* configure.in:
	Released v1.1.beta11.
	[e334e53fcc61] [1.1.beta11]

	* NEWS, TODO:
	Updated
	[ad1361eee1ae]

	* src/imap/imap-sync.c:
	mail_get_keyword_indexes() can be used more efficiently to get the
	keywords list. Use it. Also make sure that if a new keyword is seen,
	it's sent to client first with FLAGS/PERMEANENTFLAGS reply.
	[a421767d29ba]

	* src/lib-storage/index/cydir/cydir-mail.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/maildir/maildir-
	mail.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/raw/raw-mail.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.h, src/lib-storage/mail.c:
	Added mail_get_keyword_indexes()
	[58b8daf695bf]

	* src/lib-index/mail-index.h, src/lib-mail/mail-types.h:
	Moved keyword_indexes array type to lib-mail.
	[45e07aee9aa2]

	* src/imap/cmd-append.c:
	If APPEND updated keywords list in selected mailbox, send the list
	to client as well.
	[9a074ef38b02]

	* src/lib-storage/index/dbox/dbox-sync.c:
	Don't rebuild dbox if another process had done it already by the
	time we got the mailbox locked.
	[c8df2492959e]

	* src/lib-index/mail-transaction-log-file.c:
	If we're rotating log file while we're locked, lock the newly
	created file so the lock is preserved.
	[66b439e24c47]

	* src/lib-storage/index/dbox/dbox-sync.c, src/lib-storage/index/index-
	mail-headers.c:
	Memory leak fixes
	[d373913cd763]

	* src/imap/imap-fetch.c:
	Fixed memory leak when FETCH command used multiple streams.
	[1029b2ffad2d]

	* src/lib-storage/mail-namespace.c, src/lib-storage/mail-namespace.h,
	src/lib-storage/mail-storage.c:
	mail_storage_create() now finishes namespace initialization so
	namespaces can be created more easily.
	[4fb1b0f43d60]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-file.h, src/lib-storage/index/dbox/dbox-save.c:
	When saving multiple mails, close some of the files temporarily so
	we don't use all available fds.
	[038467bffcbd]

	* src/plugins/convert/convert-plugin.c, src/plugins/convert/convert-
	storage.c, src/plugins/convert/convert-storage.h,
	src/plugins/convert/convert-tool.c:
	Convert only after namespaces are created. Convert mailboxes to
	INBOX namespace.
	[7cedc391e6c5]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-save.c:
	Use less space from data stack.
	[f2c37fe48668]

	* configure.in:
	--with-package=yes now fails if package can't be used. --with-
	package=auto (which is also used by default) uses the package if it
	can.
	[ec6cc297dd82]

	* src/lib-storage/index/index-sort.c:
	Cleanups and fixes.
	[123a1c8120cd]

2007-12-08  Timo Sirainen  <tss@iki.fi>

	* src/lib/restrict-access.c:
	Code cleanups and error handling fixes to setting/dropping groups.
	[296ee9005d80]

	* src/lib-storage/index/index-sort.c:
	Removed unneeded code.
	[228e2380f564]

	* src/lib-storage/index/index-sort.c:
	Don't add arrival/date/size sort IDs to index file. They can be
	looked up from cache file fast enough as it is.
	[891d2b36feee]

	* src/lib-storage/index/index-sort.c:
	Fix
	[c13473a5c0e4]

	* src/lib-storage/index/index-sort.c:
	Simplified and optimized the sorting code.
	[09e1e8d4aa53]

	* src/lib/str.c, src/lib/str.h:
	Added str_equals()
	[4c3002f3cd51]

	* src/lib-storage/index/index-search.c:
	Optimize searching flags and keywords.
	[7bb6ef75715c]

	* src/imap/cmd-search.c, src/imap/imap-search.c, src/imap/imap-
	search.h, src/lib-storage/index/index-search.c, src/lib-storage
	/mail-search.c, src/lib-storage/mail-search.h:
	SEARCH_KEYWORDS now uses struct mail_keywords instead of a string
	array.
	[ae369569e7de]

	* src/lib-storage/mail-search.c:
	We can't always merge SEARCH_FLAGS.
	[b9d674728523]

	* src/lib-storage/mail-search.c:
	Merge SEARCH_FLAGS arguments when possible.
	[5fb86ed98860]

	* src/imap/imap-expunge.c, src/imap/imap-search.c, src/lib-
	storage/index/index-search.c, src/lib-storage/mail-search.h:
	Replaced SEARCH_<flag> with a generic SEARCH_FLAGS. Use value.size
	for SEARCH_LARGER and SEARCH_SMALLER and give an error if it's not a
	valid number.
	[659e4a606aae]

	* src/lib-storage/index/dbox/dbox-storage.c:
	All changes end up to dovecot.index.log with dbox, so watch only it
	instead of the whole dbox directory.
	[16f761cdc910]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-storage.h:
	Scan dbox directories every 8 days and delete stale temp files.
	[99ad673724ad]

	* src/lib-storage/list/mailbox-list-fs.c, src/lib-storage/list
	/mailbox-list-maildir.c, src/lib-storage/list/mailbox-list-
	maildir.h, src/lib-storage/mailbox-list-private.h, src/lib-storage
	/mailbox-list.c, src/lib-storage/mailbox-list.h:
	Added mailbox_list_get_global_temp_prefix()
	[a1e271317eb2]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-util.c:
	Removed maildir_tmp_cleanup(). Use unlink_old_files() instead.
	[7ae8505870c1]

	* src/lib/Makefile.am, src/lib/unlink-lockfiles.c, src/lib/unlink-
	lockfiles.h, src/lib/unlink-old-files.c, src/lib/unlink-old-files.h:
	Removed unlink_lockfiles() and replaced it with a simpler
	unlink_old_files()
	[d421f14ba797]

	* src/lib-storage/index/index-sync.c:
	Code cleanup
	[f0dbbc1f0586]

	* src/lib-storage/index/index-sync.c:
	Don't assert-crash if sync was aborted and it still had expunges
	left.
	[07f151520c84]

	* src/lib-mail/message-header-decode.c:
	If we encounter an unknown charset, get the ASCII (or UTF-8
	actually) characters instead of ignoring it completely.
	[aee731c09668]

	* src/lib/unichar.c:
	uni_utf8_to_decomposed_titlecase(): If we encounter invalid UTF-8
	input, skip over it instead of aborting directly.
	[edd296d164db]

	* src/lib-mail/message-decoder.c, src/lib/unichar.c,
	src/lib/unichar.h:
	uni_utf8_get_valid_data() API changed.
	[08e4d7efcd6a]

	* src/lib-mail/message-decoder.c, src/lib/unichar.c,
	src/lib/unichar.h:
	Moved uni_utf8_get_valid_data() to lib/
	[1f70c72e4312]

	* src/lib-mail/message-header-decode.c:
	If header contains invalid MIME input, preserve the =? in output.
	[63e225ab7361]

	* src/deliver/deliver.c:
	Sanitize the headers before logging.
	[eda51f08e8bf]

	* dovecot-example.conf, src/deliver/deliver.c, src/deliver/deliver.h:
	Added deliver_log_format setting to control what's logged when a
	mail is delivered.
	[6b5f89c41de5]

	* src/deliver/deliver.c:
	Added deliver_log(), which is used to log the mail delivery status
	instead of handling it separately all over.
	[0a7d53a1b8fe]

	* src/lib-imap/imap-parser.c:
	Fixed handling invalid characters in atoms.
	[49ba86f65da5]

2007-12-07  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-squat/squat-trie.c, src/plugins/fts-squat/squat-
	uidlist.c:
	UID ranges can be large, don't allocate them from data stack.
	[5915aea5f070]

	* src/plugins/fts-squat/squat-trie-private.h, src/plugins/fts-squat
	/squat-trie.c, src/plugins/fts-squat/squat-uidlist.c:
	Support mmap_disable=yes and some error handling improvements.
	[66b3e894041b]

	* src/imap/cmd-search.c:
	Return in OK reply how long the SEARCH took.
	[0a93c4e07776]

	* src/lib-mail/message-decoder.c:
	Crashfix
	[3af80c378959]

2007-12-06  Timo Sirainen  <tss@iki.fi>

	* NEWS:
	Mention LIST+STATUS combination.
	[9a050d3a87b1]

2007-12-05  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-request-handler.c, src/auth/auth-
	request.c, src/auth/auth-worker-client.c, src/auth/auth-worker-
	server.c, src/auth/auth.c, src/auth/db-ldap.c, src/auth/db-passwd-
	file.c, src/auth/main.c, src/auth/mech-digest-md5.c, src/auth
	/passdb-pam.c, src/auth/passdb-passwd-file.c, src/auth/passdb-sql.c,
	src/auth/userdb-nss.c, src/auth/userdb-passwd-file.c, src/auth
	/userdb-static.c, src/deliver/deliver.c, src/dict/dict-server.c,
	src/imap/client.c, src/imap/cmd-list.c, src/imap/imap-fetch-body.c,
	src/imap/imap-fetch.c, src/imap/imap-status.c, src/imap/imap-sync.c,
	src/imap/imap-thread.c, src/imap/mail-storage-callbacks.c, src/lib-
	auth/auth-server-connection.c, src/lib-auth/auth-server-request.c,
	src/lib-dict/dict-client.c, src/lib-dict/dict-sql.c, src/lib-
	dict/dict.c, src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-
	match.c, src/lib-imap/imap-quote.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache-lookup.c, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	index-fsck.c, src/lib-index/mail-index-map.c, src/lib-index/mail-
	index-sync-ext.c, src/lib-index/mail-index-sync-update.c, src/lib-
	index/mail-index-sync.c, src/lib-index/mail-index-view-sync.c, src
	/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log-file.c, src/lib-index/mail-transaction-log-view.c,
	src/lib-index/mailbox-list-index-sync.c, src/lib-index/mailbox-list-
	index.c, src/lib-mail/message-address.c, src/lib-mail/message-
	date.c, src/lib-mail/message-decoder.c, src/lib-mail/message-
	parser.c, src/lib-mail/message-search.c, src/lib-
	settings/settings.c, src/lib-sql/driver-mysql.c, src/lib-sql/driver-
	pgsql.c, src/lib-sql/sql-pool.c, src/lib-storage/index/cydir/cydir-
	save.c, src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox/dbox-
	index.c, src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-sync-file.c, src/lib-storage/index/dbox
	/dbox-sync-rebuild.c, src/lib-storage/index/index-mail-headers.c,
	src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-sort.c, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/maildir/maildir-copy.c, src
	/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-sync.c,
	src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-sync-parse.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c, src
	/lib-storage/index/raw/raw-storage.c, src/lib-storage/list/index-
	mailbox-list-sync.c, src/lib-storage/list/mailbox-list-fs-iter.c,
	src/lib-storage/list/mailbox-list-maildir-iter.c, src/lib-
	storage/list/mailbox-list-maildir.c, src/lib-storage/list/mailbox-
	list-subscriptions.c, src/lib-storage/mail-namespace.c, src/lib-
	storage/mail-storage.c, src/lib-storage/mailbox-list.c, src/lib-
	storage/mailbox-tree.c, src/lib/compat.c, src/lib/failures.c,
	src/lib/file-copy.c, src/lib/file-dotlock.c, src/lib/imem.c, src/lib
	/mkdir-parents.c, src/lib/module-dir.c, src/lib/nfs-workarounds.c,
	src/lib/restrict-access.c, src/lib/strfuncs.c, src/lib/unlink-
	lockfiles.c, src/login-common/client-common.c, src/login-common/ssl-
	proxy-gnutls.c, src/master/auth-process.c, src/master/dup2-array.c,
	src/master/listener.c, src/master/log.c, src/master/login-process.c,
	src/master/mail-process.c, src/master/main.c, src/master/master-
	settings.c, src/plugins/acl/acl-api.c, src/plugins/acl/acl-backend-
	vfile-acllist.c, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/acl/acl-backend.c, src/plugins/acl/acl-cache.c,
	src/plugins/acl/acl-mailbox-list.c, src/plugins/acl/acl-storage.c,
	src/plugins/convert/convert-storage.c, src/plugins/expire/expire-
	plugin.c, src/plugins/expire/expire-tool.c, src/plugins/fts-squat
	/squat-trie.c, src/plugins/fts-squat/squat-uidlist.c,
	src/plugins/fts/fts-api.c, src/plugins/fts/fts-search.c,
	src/plugins/fts/fts-storage.c, src/plugins/imap-quota/imap-quota-
	plugin.c, src/plugins/lazy-expunge/lazy-expunge-plugin.c,
	src/plugins/mail-log/mail-log-plugin.c, src/plugins/quota/quota-
	dict.c, src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-
	fs.c, src/plugins/quota/quota-maildir.c, src/plugins/quota/quota-
	plugin.c, src/plugins/quota/quota.c, src/pop3-login/client.c,
	src/pop3/client.c, src/pop3/commands.c, src/util/idxview.c,
	src/util/listview.c, src/util/logview.c:
	Replaced t_push/t_pop calls with T_FRAME*() macros.
	[414c9d631a81]

	* src/lib/data-stack.c, src/lib/data-stack.h:
	Added T_FRAME*() macros. It's too easy to accidentally break
	t_push/t_pop pairing. These new macros make it a lot more difficult.
	[c7b42fea5fcc]

	* src/plugins/acl/acl-mailbox-list.c:
	Code cleanup
	[8aaec038767c]

	* src/lib/file-dotlock.c:
	Code cleanups
	[94e94e3b5b30]

	* src/auth/auth.c, src/auth/auth.h, src/auth/mech-digest-md5.c,
	src/auth/mech-rpa.c:
	Allocate auth_realms from auth pool instead of from data stack.
	[aacc69cc267b]

	* src/auth/auth-client-connection.c:
	Minor optimization.
	[38fd7447172d]

	* src/lib/data-stack.c:
	If we fail with out of memory, make sure i_panic() can allocate
	enough memory for itself.
	[f6118fc9c23e]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	If file is lost, don't try to look for it until stack overflows.
	[ad16a4582033]

	* src/lib/data-stack.h:
	Comment updates
	[90b63ce0c6a5]

2007-12-04  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-squat/squat-trie.c, src/plugins/fts-squat/squat-
	uidlist.c, src/plugins/fts-squat/squat-uidlist.h:
	Locking and error handling fixes.
	[97702c9c4111]

	* src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-file.h, src/lib-storage/index/mbox/mbox-mail.c:
	Optimize physical mail size calculation by using the next message's
	offset or the mbox size for the last message.
	[48ddc0c4036c]

	* src/lib-index/mail-transaction-log-file.c:
	Don't mmap() transaction log file if we're reading less than a page.
	[8c80093fbab4]

	* src/lib-index/mail-transaction-log-file.c:
	NFS attribute cache flushing fix
	[fe777302d928]

	* src/lib-index/mail-index-sync-update.c:
	Previous tail_offset change broke when rotating transaction logs.
	[9a11ee1c7912]

	* src/util/logview.c:
	Show log_file_tail_offset header updates more clearly.
	[f90a4e265d00]

	* src/lib-index/mail-index-sync.c:
	Code cleanup
	[d6dd3fce2817]

	* src/lib-index/mail-index-sync-update.c:
	If we didn't read tail offset update from transaction log, we set it
	to 0 in index header, causing a lot of unnecessary work.
	[c46a191a8726]

	* src/util/idxview.c:
	Print the number of cache file compressions.
	[efd6dfbddf19]

	* src/lib-index/mail-cache-fields.c:
	Don't compress cache file unneededly when creating the first
	messages.
	[284c22a7a92e]

	* src/lib-index/mail-transaction-log-file.c:
	Code cleanup
	[4aa0a3a2d3f8]

2007-12-03  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.1.beta10 for changeset 75fabf3fded8
	[58cf18fc9358]

	* configure.in:
	Released v1.1.beta10.
	[75fabf3fded8] [1.1.beta10]

	* src/deliver/deliver.c:
	If we can't open/create the wanted mailbox, log an error.
	[2f7939f262ef]

	* src/plugins/fts-squat/squat-uidlist.c:
	Removed t_push/t_pop which could have caused crashes
	[751e773f50b2]

	* src/lib-mail/message-decoder.c, src/lib-mail/message-decoder.h, src
	/lib-mail/message-search.c:
	Message decoding wasn't reset properly between messages when
	searching.
	[0b8a78914db7]

	* src/lib-mail/message-decoder.c:
	Remove illegal UTF-8 sequences from output.
	[671c2eb25f3d]

	* src/plugins/fts-squat/squat-trie.c, src/plugins/fts/fts-storage.c:
	Index message's all headers (including MIME headers) after the body.
	[9c3f0e180751]

	* src/lib-mail/message-search.c:
	When searching only message bodies, we skipped headers completely so
	body decoding didn't work for non-ASCII.
	[f28a14a07a98]

	* src/plugins/fts-squat/squat-trie.c:
	Fix for searching <4 char keys.
	[b326327b1f10]

	* src/plugins/fts-squat/squat-trie.c, src/plugins/fts/Makefile.am,
	src/plugins/fts/fts-search.c, src/plugins/fts/fts-storage.c,
	src/plugins/fts/fts-storage.h:
	Fixed non-ASCII searches.
	[a215deb3de8d]

	* src/lib-mail/message-decoder.c, src/lib-mail/message-header-
	decode.c:
	charset_to_utf8_begin() was called with bad flags parameter
	(although it just happened to be the same value, so it worked).
	[c68564884bae]

	* src/lib-mail/message-search.c:
	Use charset_to_utf8_str() instead of doing it ourself.
	[725a31acbe00]

	* src/lib-charset/charset-utf8.c, src/lib-charset/charset-utf8.h:
	Added charset_to_utf8_str()
	[a340d3379b90]

	* src/lib/istream-concat.c:
	Don't crash when seeking to end of file.
	[25ca7c443357]

	* src/lib-settings/settings.c:
	"section changed at line" was always reporting the current line
	instead of the previous section change line.
	[a201579e585d]

	* src/plugins/fts-squat/squat-trie-private.h, src/plugins/fts-squat
	/squat-trie.c, src/plugins/fts/fts-api.c, src/plugins/fts/fts-
	storage.c, src/plugins/fts/fts-storage.h:
	Fixes to FTS handling.
	[8c779f3e16be]

	* src/lib-mail/message-parser.c:
	Another fix to returning body blocks.
	[275d22eb25ba]

	* src/plugins/fts/fts-search.c, src/plugins/fts/fts-storage.h:
	Added missing files.
	[a8d3513b54c5]

	* src/plugins/fts-squat/squat-trie.c:
	Fixed handling non-indexed characters in search key.
	[cff5428c3c4d]

	* src/plugins/fts/fts-storage.c:
	We only want to skip non-text message bodies, never any headers and
	definitely not entire multiparts.
	[92e197fa699e]

	* src/lib-mail/message-parser.c:
	Message parser wasn't returning body blocks correctly, causing
	problems with message body searches.
	[950ce0b5edb5]

2007-12-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-search.c,
	src/lib-storage/mail-search.h, src/lib-storage/mail-storage.c:
	Simplify search arguments immediately when calling
	mailbox_search_init().
	[69babcc2fb80]

	* src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins/fts-lucene
	/lucene-wrapper.cc, src/plugins/fts-squat/fts-backend-squat.c,
	src/plugins/fts-squat/squat-test.c, src/plugins/fts-squat/squat-
	trie-private.h, src/plugins/fts-squat/squat-trie.c, src/plugins/fts-
	squat/squat-trie.h, src/plugins/fts-squat/squat-uidlist.c,
	src/plugins/fts-squat/squat-uidlist.h, src/plugins/fts/Makefile.am,
	src/plugins/fts/fts-api-private.h, src/plugins/fts/fts-api.c,
	src/plugins/fts/fts-api.h, src/plugins/fts/fts-storage.c:
	FTS API changes and Squat rewrite. Squat is still missing expunge
	handling.
	[e739cffd05ef]

	* src/lib/seq-range-array.c, src/lib/seq-range-array.h:
	Added seq_range_array_remove_seq_range() and
	seq_range_array_remove_invert_range().
	[0a3186f44dff]

	* dovecot-example.conf, src/master/master-settings.c:
	Use dotlock_use_excl=yes by default.
	[139bd6094de6]

	* src/auth/passdb-vpopmail.c:
	Removed broken debug logging.
	[bfdbc073598e]

	* configure.in:
	Updated list of available mail storage formats. Changed deliver's
	internal storage format from mbox to raw.
	[84bcf1c8b07a]

	* src/master/main.c:
	--build-options didn't list "sia" in passdbs.
	[a9daec3c00b5]

	* src/lib/nfs-workarounds.c:
	Ignore EEXIST errors for rmdir().
	[95caa2ab300c]

	* src/lib/str-sanitize.c:
	str_sanitize*() didn't properly limit string length.
	[e744479186b6]

	* src/lib-imap/imap-util.h:
	Compiler warning fix.
	[0ddc6511e9ff]

	* src/lib-imap/imap-parser.c, src/lib-imap/imap-parser.h:
	Added IMAP_PARSE_FLAG_ATOM_ALLCHARS.
	[3ec5a07d00f2]

	* src/imap/imap-fetch.c:
	When client tried to fetch INTERNALDATE for an expunged message, we
	sent a broken reply.
	[51bf40995f0f]

2007-12-01  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	Code cleanup
	[19a6aeeb8f4f]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-sync.h, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-util.c:
	If doing a lockless forced sync, track the UID we're trying to find.
	If we didn't find it, do a locked sync to find out if it's expunged.
	[82420ed23379]

	* src/lib-storage/index/maildir/maildir-util.c:
	Code cleanup
	[a22b1a72ea89]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	Removed pointless maildir_uidlist_sync_next_pre() calling.
	[2bef19ae5233]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If we did unlocked maildir sync, make sure we sync it later with
	locking.
	[15df8bb27d7a]

	* src/imap/cmd-fetch.c:
	Do fast sync if \Seen flags haven't changed, not vice versa.
	[19baca289025]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	If we're doing a fast sync, try only once to lock uidlist.
	[b1554dea8ee8]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	maildir_storage_sync_force(): Don't wait on trying to lock uidlist.
	Just try once and if it fails, find the changed filenames and do
	nothing else.
	[724c8f12eed2]

	* src/lib-storage/index/maildir/maildir-save.c:
	Error handling fixes
	[fed2843b4ab8]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-sync.c:
	maildir_uidlist_sync_init() was called wrong, although it just
	happened to work.
	[0c3ab0aef33c]

2007-11-29  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-search.c:
	Don't crash when searching for empty TEXT or BODY.
	[a5a7d38b6df7]

	* src/lib/network.c:
	FreeBSD: If connect() fails with EADDRINUSE or EACCES, try again
	max. 3 times.
	[ed6693fc06d6]

	* src/util/idxview.c:
	Print maildir nsecs fields as integers, not as timestamps.
	[a9e4221d5c0b]

2007-11-28  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-fs.c, src/plugins/quota/quota-private.h,
	src/plugins/quota/quota.c:
	Added noenforcing option to fs quota backend.
	[1d0521b7151d]

	* src/auth/db-ldap.c:
	Die if (Solaris) LDAP library returns wrong file descriptor.
	[3069e66789b3]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-ext.c:
	Verify extension fields are correct when registering it from
	transaction log.
	[082526b2702e]

	* src/lib-index/mail-index.c:
	mail_index_ext_register(): Panic if parameters aren't correct.
	[f7ec019fd3f6]

	* src/dict/dict-server.c:
	Make sure all client connections are freed when exiting.
	[373beccc2468]

	* src/master/dict-process.c:
	Don't crash when dict process exists and we receive SIGHUP.
	[5f97bba6df15]

	* src/plugins/quota/quota-storage.c:
	Free mail before committing transaction.
	[019ccd4e9888]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-transaction.c:
	Assert-crash if there are mails belonging to a transaction while
	it's being committed or rolled back.
	[901467b1506e]

	* src/imap/imap-fetch-body.c:
	Don't get message's header and body sizes separately if we really
	only need the full size.
	[b223a34c64cb]

	* src/lib-storage/index/index-mail.c:
	mail_get_stream(): If we have virtual size cached, we don't have to
	read the entire body to get its size. Instead use cached virtual
	size - hdr size.
	[5c48dc658d78]

2007-11-27  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-ldap.c:
	If auth_bind=no, ignore auth_bind_userdn setting instead of having
	it turn auth binds on.
	[6d271590e0e9]

	* src/dict/Makefile.am, src/lib-dict/Makefile.am:
	Create a separate libdict_backend.a library with sql/db backends and
	link it only to dict server. This fixes linking issues with linkers
	that didn't automatically drop the unused sql/db code.
	[63dd68ae343f]

2007-11-26  Timo Sirainen  <tss@iki.fi>

	* src/lib/macros.h:
	unlikely() and likely() were broken with non-gcc.
	[ff884d70197b]

	* .hgtags:
	Added tag 1.1.beta9 for changeset 4b768f8b4034
	[b08d98ebb2a7]

	* configure.in:
	Released v1.1.beta9.
	[4b768f8b4034] [1.1.beta9]

	* src/lib-storage/index/dbox/dbox-sync-rebuild.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/maildir/maildir-uidlist.c,
	src/lib-storage/index/maildir/maildir-uidlist.h:
	Delayed NFS attribute cache flushing had some bug, so removed it for
	now.
	[64e0f45e8dc3]

	* src/lib/nfs-workarounds.c:
	Don't try to rmdir() the file to flush its file handle with FreeBSD.
	Although it appeared to work in my test program, looks like it
	doesn't really work after all..
	[78922561e9ea]

2007-11-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache.c, src/lib-index/mail-hash.c, src/lib-index
	/mail-index.c, src/lib-index/mail-transaction-log-file.c, src/lib-
	index/mail-transaction-log.c, src/lib-index/mailbox-list-index.c,
	src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib/file-dotlock.c, src/lib/nfs-workarounds.c,
	src/lib/nfs-workarounds.h:
	NFS cache flushing updates.
	[41911abe6fa7]

	* src/imap/cmd-list.c:
	If client tries to use unknown list-extended options, fail with BAD.
	[a249d916f6e6]

	* src/auth/auth-request.c:
	Added "password_noscheme" field which assumes the password is in the
	default scheme even if it begins with '{'.
	[5c514ebda66a]

	* src/auth/auth-request.c:
	When saving password, add scheme prefix also if password begins with
	{ but doesn't contain }. This fixes an assert-crash later.
	[074ae6017b0a]

2007-11-24  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream.c:
	o_stream_sendv(): If we're trying to send 0 bytes, just return 0
	immediately.
	[7717e03db8b3]

	* src/lib/seq-range-array.c:
	seq_range_array_remove_range(): Don't break if seq2 is -1U.
	[6ed01546f211]

	* src/lib/ostream-file.c:
	Handle write failures with files better.
	[6a9080055e54]

	* src/lib/ostream.c, src/lib/ostream.h:
	Added last_failed_errno to ostream to make error handling easier
	with files.
	[c8f6eec5e996]

	* src/lib/ostream-file.c, src/lib/ostream.c:
	Moved stream_errno clearing to common functions in ostream.c.
	[e722bcdd426e]

	* src/lib/ostream-file.c:
	Assert: With files o_stream_send*() must either write everything or
	return an error.
	[b73cb35a8427]

2007-11-23  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	Removed broken check for empty lines in maildirsize, which could
	have caused maildirsize recalculations to happen too often.
	[04809db163ab]

	* src/lib-storage/index/maildir/maildir-mail.c:
	Don't add virtual size to uidlist if it's already in filename.
	[61a764835d40]

	* src/lib-storage/index/maildir/maildir-mail.c:
	Don't try to set virtual size to uidlist for newly saved mails. They
	already have the size in their filename.
	[b2ec808acd76]

	* src/lib-storage/index/maildir/maildir-mail.c:
	POP3 state checking wasn't done right.
	[d3d0144f9be1]

	* src/lib-storage/index/cydir/cydir-save.c, src/lib-storage/index/dbox
	/dbox-save.c, src/lib-storage/index/maildir/maildir-save.c:
	Free mail structure before transaction is committed, so that it can
	update cache file within the transaction.
	[9ca7f055b646]

2007-11-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/cydir/cydir-mail.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/index-mail-headers.c, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-mail.h, src
	/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/mbox/mbox-mail.c:
	Cleanups/rewrites to how/when date/size caching is done.
	[d2c8269a0679]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-transaction.c, src/lib-index
	/mail-cache.c:
	mail_cache_field_want_add(): Return TRUE for temp fields only if
	we're adding the field to a new enough message.
	[0c970b3493ac]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.h:
	Don't cache all headers just because they're listed in cache file.
	First check if we actually want to cache them.
	[efec8836586a]

	* src/lib-index/mail-cache-compress.c:
	Removed wrong assert
	[af74d2e6f3c5]

2007-11-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c:
	mail_get_headers() returned bad data when headers were already
	cached. Dovecot doesn't use this function internally, but it might
	have caused crashes with Sieve plugin.
	[e726f298d87e]

2007-11-20  Timo Sirainen  <tss@iki.fi>

	* src/tests/Makefile.am:
	Link with iconv and random libraries if needed.
	[6a6a224a2ceb]

	* src/lib/Makefile.am:
	Create unicodemap.c to $(srcdir).
	[413dbb37b839]

2007-11-18  Timo Sirainen  <tss@iki.fi>

	* src/login-common/sasl-server.c:
	Compile fix for last changes.
	[ff9e591a2aa5]

	* src/imap-login/client-authenticate.c, src/login-common/client-
	common.h, src/pop3-login/client-authenticate.c:
	Disable processing input while it's not expected, otherwise we could
	get there and crash while master is processing the login. Also allow
	client to send the SASL data within the same IP packet as the
	AUTH/AUTHENTICATE command without hanging.
	[ff62b2323a97]

	* src/lib-storage/mailbox-list.c:
	If we can't delete the index or control directory, give a nice error
	message instead of internal error.
	[337e6a9a2959]

	* src/lib-mail/message-decoder.c:
	Charset translation fixes
	[ea4d3778c99b]

	* src/lib-index/mail-cache-transaction.c:
	When we create the initial cache file or recreate a broken one,
	write the offsets to transaction log using a temporary transaction
	instead of a long-running one which may get aborted.
	[ddf393049f28]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	transaction.c, src/lib-index/mail-cache.c:
	If cache file's file_seq appears to be broken, handle it by
	compressing the cache instead of just never using it.
	[3a41003bb1ae]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-sync-update.c, src/lib-index
	/mail-cache.c, src/lib-index/mail-hash.c, src/lib-index/mail-index-
	lock.c, src/lib-index/mail-index-map.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index.c, src/lib-index/mail-
	transaction-log-file.c, src/lib-index/mail-transaction-log.c, src
	/lib-index/mailbox-list-index-sync.c, src/lib-index/mailbox-list-
	index.c, src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib-storage/mailbox-list.c, src/lib/file-
	dotlock.c, src/lib/nfs-workarounds.c, src/lib/nfs-workarounds.h:
	NFS cache flushing APIs changed and backend implements it a bit
	differently. Hopefully this works now more correctly.
	[dbab5e592577]

	* src/lib-storage/index/dbox/dbox-index.c:
	nfs_safe_link() was used wrong
	[8470d0845fc2]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-map.c:
	Don't bother flushing attribute cache if we just fcntl locked the
	file.
	[e3af6e0e55ae]

2007-11-17  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-system.c:
	Don't check if pointer is NULL before passing it to free(). ANSI-C
	requires that free(NULL) is a no-op anyway.
	[bca08d6f001d]

	* src/lib/base64.c, src/lib/buffer.c, src/lib/data-stack.c,
	src/lib/hash.c, src/lib/istream-file.c, src/lib/istream.c, src/lib
	/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib/mempool-
	system-clean.c, src/lib/mempool-system.c, src/lib/mempool-unsafe-
	datastack.c, src/lib/network.c, src/lib/nfs-workarounds.c,
	src/lib/ostream.c, src/lib/randgen.c, src/lib/write-full.c:
	Use likely() and unlikely() macros to make commonly checked error
	handling paths unlikely.
	[85385079b044]

	* src/lib-storage/list/subscription-file.c:
	If control directory doesn't exist when trying to create
	subscriptions file, create the directory.
	[b8c66f025583]

2007-11-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c:
	Update cache->st_ino and st_dev after compressing.
	[ee1c4c3d5e5a]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-sync.c:
	When reading an index file created by v1.0, make sure we update the
	header version and write the main index.
	[f814eecd75cd]

	* src/lib-index/mail-index-sync-update.c:
	If errors were found while syncing, fsck the index at the end to
	make sure everything looks correct.
	[eebfe0cd2add]

	* src/lib/nfs-workarounds.c:
	FreeBSD and Solaris supports flushing attribute cache with
	chown(uid=-1, gid=-1). Do it with them.
	[6dfb3969baae]

	* src/lib-index/mail-cache.c, src/lib-index/mail-hash.c, src/lib-index
	/mail-index.c, src/lib-index/mail-transaction-log-file.c, src/lib-
	index/mail-transaction-log.c, src/lib-index/mailbox-list-index.c,
	src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib/file-dotlock.c, src/lib/nfs-workarounds.c,
	src/lib/nfs-workarounds.h:
	nfs_flush_attr_cache() doesn't take flush_dir paramter anymore.
	Instead the directory is always flushed now.
	[256725979152]

	* src/lib/ioloop-notify-inotify.c:
	Don't disable inotify when seeing ESTALE errors.
	[f637a8a1aae7]

	* src/lib/ioloop-notify-dn.c:
	Ignore ESTALE errors.
	[766250fcedd8]

	* src/lib/nfs-workarounds.c:
	FreeBSD: Flush directory attribute caches by rmdir()ing it.
	[8573124a89b3]

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache.c:
	Fixed cache file's NFS attribute cache flushing.
	[c991d1b132d8]

	* configure.in:
	Removed warning about this being unstable branch.
	[020838158024]

	* src/lib-index/mail-transaction-log-file.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib/file-dotlock.c,
	src/lib/nfs-workarounds.c, src/lib/nfs-workarounds.h:
	nfs_safe_link(): Support linking files without original link
	count=1. Use it when copying maildir files, but only if
	mail_nfs_storage=yes.
	[575235932194]

2007-11-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-file.c, src/lib-
	storage/index/dbox/dbox-index.c, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib/file-dotlock.c:
	Use nfs_safe_link() instead of link().
	[ebe88bc73154]

	* src/lib/nfs-workarounds.c, src/lib/nfs-workarounds.h:
	Added nfs_safe_link().
	[9bc620b934f4]

	* src/lib-index/mail-index-sync.c:
	If MAIL_INDEX_SYNC_FLAG_REQUIRE_CHANGES is set, check if there's
	anything to sync before locking transaction log.
	[a4c87d5d881c]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index.h, src
	/lib-storage/index/cydir/cydir-save.c, src/lib-storage/index/cydir
	/cydir-sync.c, src/lib-storage/index/cydir/cydir-sync.h, src/lib-
	storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox/dbox-
	sync.c, src/lib-storage/index/dbox/dbox-sync.h, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/index/raw/raw-
	sync.c:
	Added MAIL_INDEX_SYNC_FLAG_REQUIRE_CHANGES flag and changed
	mail_index_sync_begin() to return 1 at success and 0 if there's
	nothing to do.
	[9d8c00d4c467]

	* src/lib-index/mail-transaction-log-file.c, src/lib-index/mail-
	transaction-log.c:
	Don't flush attribute cache twice after locking transaction log.
	[937faba78a68]

	* src/lib-index/mail-transaction-log-file.c:
	Avoid flushing attribute cache when checking to see if there's new
	data in transaction log and we're not locked.
	[5382964fc01d]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c:
	Return children state based on directory links count if possible.
	[f9e24a274ede]

	* src/lib-storage/list/mailbox-list-fs-iter.c:
	If storage backend doesn't return children flags, scan them ourself.
	[b2bcfe178a30]

	* src/lib-storage/index/dbox/dbox-storage.c:
	Default maildir_name was missing.
	[ed4e708951de]

	* src/lib/file-dotlock.c:
	If file_dotlock_create() fails with "dotlock was immediately
	recreated under us", return errno=ENOENT.
	[9f40c3f83773]

	* src/lib-index/mail-transaction-log-file.c, src/lib-index/mail-
	transaction-log-private.h, src/lib-index/mail-transaction-log-
	view.c, src/lib-index/mail-transaction-log.c:
	Keep better track of when we need to flush NFS attribute caches.
	[ba58eaf06763]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	NFS attribute cache flushing optimization
	[6a5540e5a464]

	* src/lib-storage/index/dbox/dbox-sync-rebuild.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/maildir/maildir-uidlist.c,
	src/lib-storage/index/maildir/maildir-uidlist.h:
	NFS: Delay flushing dovecot-uidlist's attribute cache until we find
	an unseen file or UID.
	[ca849e28a062]

	* src/lib/file-dotlock.c:
	Don't flush attribute cache the first time when stating a lock file.
	Usually the locking works fine without it.
	[c1bd43be8f9a]

	* src/lib-index/mail-transaction-log-file.c, src/lib-index/mail-
	transaction-log.c, src/lib-storage/index/maildir/maildir-keywords.c,
	src/lib-storage/index/maildir/maildir-uidlist.c:
	Don't flush attribute cache unless we're locked and we really need
	to know the latest changes.
	[e70686f19f67]

2007-11-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-hash.c, src/lib-index/mail-index.c, src/lib-index
	/mail-transaction-log-file.c, src/lib-index/mail-transaction-log.c,
	src/lib-index/mailbox-list-index.c, src/lib-storage/index/maildir
	/maildir-keywords.c, src/lib-storage/index/maildir/maildir-
	uidlist.c, src/lib-storage/index/mbox/mbox-lock.c, src/lib/file-
	dotlock.c, src/lib/nfs-workarounds.c, src/lib/nfs-workarounds.h:
	NFS attribute cache flushing fixes. nfs_flush_attr_cache() takes now
	flush_dir parameter and nfs_flush_attr_cache_fd() returns FALSE if
	file handle is already stale.
	[a59deefc552f]

	* src/lib-index/mail-transaction-log-append.c:
	If mail_nfs_index=yes, we need to call fdatasync() for all written
	transactions. Also this fdatasyncing needs to be done after
	rewriting the first record's size.
	[587a9d3054c1]

2007-11-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-fields.c:
	mmap_disable=yes: Don't invalidate file cache unneededly when
	reading cache fields.
	[407f75ee2598]

2007-11-12  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/master/master-settings.c:
	Increased default login_process_size to 64MB. 32MB wasn't enough in
	all 64bit systems.
	[513076febc7a]

	* src/lib-sql/driver-pgsql.c:
	Fixes to handling transaction updates.
	[33cfef65a5e1]

	* src/lib-sql/driver-pgsql.c:
	More fixes to handling driver_pgsql_query_s() when not connected.
	[7005fc7e69dc]

	* src/lib-sql/driver-pgsql.c:
	Don't break if driver_pgsql_query_s() fails because we're not
	connected.
	[4d6ba6cd1bbc]

	* src/lib/failures.c:
	Fix to last logging changes.
	[7a985b3e6a7c]

	* src/lib-sql/driver-pgsql.c:
	Crashfix when calling driver_pgsql_escape_string() and we're not
	connected.
	[ee9bc72e0ed2]

2007-11-11  Timo Sirainen  <tss@iki.fi>

	* src/lib/macros.h:
	Added likely() and unlikely() macros. Use unlikely() with asserts.
	[993760061348]

	* src/master/mail-process.c:
	Error message updates.
	[b0dc70ac3372]

	* src/deliver/deliver.c:
	Error handling fix
	[92768090a106]

	* src/lib-storage/index/maildir/maildir-storage.c:
	If dovecot-shared doesn't have group permissions set, ignore the
	group.
	[f744f28c7346]

	* src/lib-storage/mailbox-list.c:
	mailbox_list_get_permissions(): If group doesn't have any
	permissions, don't bother returning any group either.
	[33f59b91c4bf]

	* .hgtags:
	Added tag 1.1.beta8 for changeset 4628e3ec65e4
	[007cbfcaf3bc]

	* TODO, configure.in:
	Released v1.1.beta8.
	[4628e3ec65e4] [1.1.beta8]

	* src/lib-mail/message-search.c:
	If Content-Type: was the first header in a MIME part, we didn't set
	content_type_text flag properly and so we searched non-text MIME
	parts unneededly.
	[eb4f1fbeecda]

	* src/lib/unichar.c:
	Assert fix
	[8b11c9f06bbf]

	* src/lib-storage/list/mailbox-list-maildir.c:
	Removed assert.
	[8d6a70a42830]

	* src/lib/failures.c:
	Use write()s instead of FILE streams to write to logs.
	[460eec427d23]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/maildir/maildir-keywords.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-util.c,
	src/lib-storage/mail-storage-private.h, src/lib-storage/mailbox-
	list.c:
	Delay creating directories until we really need them.
	[186b164a9579]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-file.h, src/lib-storage/index/dbox/dbox-index.c:
	Create dbox files using mailbox.file_create_mode.
	[47c746a769ba]

	* src/lib/file-dotlock.c, src/lib/safe-mkstemp.c:
	Don't log an ENOENT error.
	[b6135e6a5ff2]

	* src/plugins/acl/acl-backend-vfile-acllist.c:
	Log error if safe_mkstemp() fails
	[532b29891022]

	* src/plugins/acl/acl-backend-vfile-acllist.c:
	Compile fix
	[b2b1da3f85b4]

	* src/deliver/duplicate.c, src/lib-index/mail-cache.c, src/lib-index
	/mail-hash.c, src/plugins/convert/convert-storage.c:
	Added missing error logging for file_dotlock_create/open calls.
	[b78cfc60f6a1]

	* src/lib-storage/index/dbox/dbox-sync-rebuild.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c:
	Moved mailbox_deleted to struct mailbox. Added and used
	mailbox_set_deleted() which also sets an error message to storage.
	[fd9effba151d]

	* src/lib-storage/mailbox-list-private.h, src/lib-storage/mailbox-
	list.c, src/lib-storage/mailbox-list.h, src/plugins/acl/acl-backend-
	vfile-acllist.c:
	Simplified mailbox_list_get_permissions() a bit. Now it returns only
	permissions for the root directory. Also UID isn't returned anymore.
	[083681d2f4fb]

	* src/deliver/deliver.c:
	Removed unnecessary includes
	[3ac33cc68f24]

2007-11-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-file.h, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-sync-file.c, src/lib-storage/index/dbox
	/dbox-sync-rebuild.c, src/lib-storage/index/maildir/maildir-
	keywords.c:
	dbox fixes
	[f8baedac2417]

	* src/util/idxview.c:
	Fix showing extensions.
	[51793c88b1c7]

	* src/lib-storage/index/dbox/dbox-sync-rebuild.c:
	Fix for checking if new maildir files can be given UIDs beginning
	from the eexisting maildir UIDs.
	[a72d725ccb1b]

	* src/lib-index/mail-index-transaction.c:
	Panic if duplicate UIDs are tried to be appended within a
	transaction.
	[5a189b41f6b0]

	* src/lib-storage/index/dbox/dbox-index.c, src/lib-storage/index/dbox
	/dbox-sync-rebuild.c:
	Avoid growing data stack too large.
	[8a342eab2f5e]

	* src/lib-storage/index/dbox/dbox-sync-file.c:
	Crashfix
	[b393080f6911]

	* src/imap/cmd-subscribe.c:
	Fix to subscribing namespaces.
	[ba74249c79f0]

	* src/lib-index/mail-transaction-log-file.c:
	Code cleanup
	[d0a2e137f044]

	* src/lib-index/mail-index-sync-update.c:
	If transaction log contains records with unknown types, log an error
	instead of assert-crashing.
	[74f4cea90bcd]

	* src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins/fts-squat
	/fts-backend-squat.c, src/plugins/fts/fts-api.c, src/plugins/fts
	/fts-api.h, src/plugins/fts/fts-storage.c:
	Handle NOT in search without returning wrong results.
	[8e0d9821c0d7]

	* src/lib/seq-range-array.c, src/lib/seq-range-array.h, src/tests
	/test-lib.c:
	Added seq_range_array_invert()
	[3896c75bfaa8]

	* src/imap/cmd-subscribe.c:
	If namespace prefix has multiple hierarchies, allow subscribing to
	any of them.
	[f7aea3542cce]

	* src/lib-index/mail-cache-sync-update.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index-transaction.c:
	Fixes to handling cache file syncs and expunging.
	[e78c51d6305f]

	* src/lib-index/mail-index.c:
	mail_index_refresh(): If index is in memory, we should still refresh
	the map in case we ourself had committed transactions. Also don't
	bother checking if index is exclusively locked, it never happens
	anymore.
	[b3de2053937f]

2007-11-08  Timo Sirainen  <tss@iki.fi>

	* TODO:
	Updated
	[4b92160ac256]

	* src/lib-index/mail-cache-sync-update.c:
	Flush cache file's NFS attribute cache only once per sync. Don't
	invalidate areas that have already been invalidated within this
	sync.
	[de67ceff3199]

	* src/lib-storage/index/raw/raw-mail.c:
	Don't change ctime/mtime when stating if they're already set.
	[75f7163d4379]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-file.c, src/lib-storage/mail-storage.h:
	Removed MAILBOX_OPEN_MBOX_ONE_MSG_ONLY flag and handling. Raw
	storage replaced its functionality.
	[a6782f59c44f]

	* src/deliver/Makefile.am, src/deliver/deliver.c:
	Use raw storage instead of mbox storage to access input mail stream.
	[b822b7b78d7b]

	* src/lib-storage/index/raw/raw-mail.c, src/lib-storage/index/raw/raw-
	storage.h:
	Support returning MAIL_FETCH_FROM_ENVELOPE.
	[ced2ffbeef8b]

	* configure.in, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/raw/Makefile.am, src/lib-storage/index/raw/raw-mail.c,
	src/lib-storage/index/raw/raw-storage.c, src/lib-storage/index/raw
	/raw-storage.h, src/lib-storage/index/raw/raw-sync.c, src/lib-
	storage/index/raw/raw-sync.h, src/lib-storage/index/raw/raw-
	transaction.c:
	Added raw storage for opening single-mail files/streams as
	mailboxes.
	[d712370dfd14]

	* src/lib-storage/mail-storage.c:
	Handle missing save_init() here by returning "not supported" error.
	[0cee1cccd14c]

	* src/lib/istream-seekable.c:
	Stating seekable stream didn't restore read conditions correctly.
	Also it returned broken values with larger streams.
	[2259ec6c009a]

	* src/lib-storage/index/index-mail.c:
	Mail closing should just unreference streams, not close them.
	[55853fd9d2cf]

	* src/tests/test-common.c, src/tests/test-common.h, src/tests/test-
	mail.c:
	Code cleanup
	[e349cb1c4daf]

	* src/deliver/deliver.c:
	Use even easier way to check for first header: name_offset==0.
	[20829db7b96a]

	* src/lib-mail/istream-header-filter.c:
	Handle returning mixed header+body multiple times without breaking.
	Handle correctly callbacks excluding headers and seeking back and
	re-reading header.
	[87a0f26edb39]

	* src/tests/test-common.c, src/tests/test-common.h, src/tests/test-
	mail.c:
	Added unit test for istream-header-filter.
	[d329f3c77c65]

	* src/deliver/deliver.c:
	Replaced kludgy input_first variable with just checking if input
	stream's offset is 0.
	[23afbedda4af]

	* src/lib-imap/imap-parser.c, src/lib-imap/imap-parser.h:
	Added imap_parser_get_literal_size() and
	imap_parser_read_last_literal() to help continue parsing input after
	IMAP_ARG_LITERAL_SIZE when IMAP_PARSE_FLAG_LITERAL_SIZE is used.
	[d145669ed45a]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Error message fix: s/fsync/fdatasync/
	[c3e6d7d96f1a]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c:
	Cydir and dbox needs to fsync appends and expunges in indexes,
	because they don't normally check if mailbox has changed externally.
	[977f224e57a6]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h, src/lib-index/mail-transaction-log-
	append.c:
	fsync transaction commits only if the transaction contains change
	types specified by mail_index_set_fsync_types().
	[3e189cbb7e7a]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	transaction.c:
	We don't really care if we lost a cache file or if it gets broken,
	so don't ever fsync it unless mail_nfs_index=yes.
	[a881755b3db8]

	* configure.in:
	Released v1.1.beta7.
	[da69c4853e35]

	* src/lib-index/mail-cache-transaction.c:
	Crashfix if cache file got unusable in the middle of a transaction.
	[72dad50b1c9f]

	* src/lib/file-cache.c:
	Drop read_highwater position when invalidating if possible.
	[f4b266590003]

	* src/lib-index/mail-cache-transaction.c:
	Crashfix in error conditions
	[42acb5629519]

	* src/deliver/deliver.c:
	Our input stream is blocking, mark it as such.
	[5f30b309a79e]

	* src/lib-mail/message-parser.c:
	If we're at EOF but we wanted more data, return what we have so far
	instead of ignoring it.
	[f323da4ef459]

	* src/lib-mail/message-header-parser.c:
	More fixes to handling nonblocking streams.
	[79110f203734]

	* src/tests/test-mail.c:
	Added message-parser unit test.
	[c49084d2148e]

	* src/lib-mail/message-header-parser.c:
	Fixes to handling multiline headers with nonblocking input streams.
	[1a551d95ac9c]

	* src/lib/istream-crlf.c, src/tests/test-istream.c:
	Lone CR handling fixes.
	[f0f6cec0ac46]

	* src/tests/Makefile.am, src/tests/test-istream.c, src/tests/test-
	lib.c, src/tests/test-lib.h:
	Added istream-crlf unit test.
	[76fc7245e74b]

	* src/lib/ostream-file.c:
	o_stream_send_istream(): Don't fstat() the stream unless we have to.
	[ba048bb01842]

	* src/lib/istream-crlf.c:
	Rewrote with separate CRLF/LF-only read functions. The code is much
	easier to read now and it fixes some bugs as well.
	[a9739ce5a7e4]

	* src/lib/istream-crlf.c:
	Minor optimization
	[9aab8ac958fb]

2007-11-07  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream.c:
	i_stream_read_next_line(): Try to read the next line until we get it
	or i_stream_read() fails.
	[e1ec38002b2b]

	* src/Makefile.am:
	Added tests directory
	[1efa924b134b]

	* .hgignore, configure.in, src/tests/Makefile.am, src/tests/test-
	common.c, src/tests/test-common.h, src/tests/test-lib.c, src/tests
	/test-mail.c:
	Added beginnings of unit tests.
	[4e4a5d6bb2cb]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c:
	Don't write fields to cache file with last_used=0. If fields were
	just added without being used yet, this makes sure that they're not
	dropped too early by compression.
	[02014f5b0068]

	* src/lib-index/mail-index-write.c:
	When writing dovecot.index, try to do it with less writes.
	[35bebea1211b]

	* src/lib-index/mail-index-write.c:
	Use fdatasync() instead of fsync(), we don't care about mtimes.
	[5f5c9095633c]

2007-11-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c:
	If messages are unexpectedly lost from index file, log an error
	instead of assert-crashing.
	[700555e06849]

	* src/lib/base64.c:
	base64_decode(): Update src_pos_r even if we return -1.
	[cfdf3b2e3dd3]

	* src/lib/base64.c:
	Fixed skipping whitespace.
	[ebe275c91ba4]

	* src/lib-storage/index/index-sort.c:
	Assert-crashfix
	[7e969a570307]

	* src/lib-storage/index/maildir/maildir-save.c:
	Code cleanup
	[6ea1f19a6a01]

	* src/lib-index/mail-cache-transaction.c:
	Reopen cache file early enough in the transaction if it has changed.
	[395082a34cf8]

	* src/lib-index/mail-cache.c:
	Fix to last change
	[a677ce398a6f]

	* src/lib-index/mail-cache-fields.c:
	Don't bother compressing cache file just to drop fields from header
	that have never been used.
	[4752637a6ad4]

	* src/lib-index/mail-cache.c:
	Code cleanup
	[4f999ac56a53]

	* src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c:
	When reading the latest fields, begin finding the fields from the
	last known header instead of from the beginning.
	[68bb5bec043e]

	* src/lib-index/mail-cache-fields.c:
	mmap_disable=yes: Find the latest cache field header by pread()ing
	the file instead of invalidating+reading full pages.
	[b0e8403b4bb1]

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache-
	transaction.c, src/lib-index/mail-cache.c:
	Keep a separate copy of mail_cache_header when mmap_disable=yes,
	otherwise it could get cleared unexpectedly.
	[75c48f171ad3]

	* src/lib-index/mail-cache.c:
	If cache file header is corrupted, keep hdr=NULL so cache file isn't
	tried to be used.
	[34a5cf8675fc]

	* src/lib-index/mail-cache.c:
	mail_cache_reopen(): Don't bother reopening if file is still the
	same.
	[c601e8cd0ffc]

	* src/lib-index/mail-cache.c:
	mmap_disable=yes: Don't flush NFS caches if mail_nfs_index=no.
	[16fc51385cd1]

	* src/lib-index/mail-cache-transaction.c:
	Last change caused assert-crashes.
	[faa4da358d37]

2007-11-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	Minor error handling fix.
	[76cf2e548c6d]

	* src/lib/istream-crlf.c:
	Memory leak fix
	[0adff60c543b]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	transaction.c:
	When adding new fields to the cache file, add all the fields we
	currently know about to avoid adding them one-by-one.
	[68adf46a6b3f]

	* src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache-
	private.h:
	If we need to do more than 4 reads to get to the cached fields
	header, compress the cache file.
	[76c0e3a4df7a]

	* src/lib-index/mail-cache-fields.c:
	mmap_disable=yes: When following cache field headers, don't
	invalidate the same part of the cache file over and over again and
	cause re-reads.
	[c7742d109a67]

	* src/lib-index/mail-index-view-sync.c:
	Assert-crashfix
	[3123e03dc3d8]

	* src/login-common/sasl-server.c:
	"Unsupported auth mechanism" and "Plaintext auth disabled" errors
	should result in NO instead of BAD reply.
	[a3079c4320c6]

	* src/util/idxview.c:
	Don't crash if index has no keywords at all.
	[ee9c8e0f25b7]

2007-11-04  Timo Sirainen  <tss@iki.fi>

	* src/util/idxview.c:
	Support showing only a single UID's contents.
	[040cbd9c4695]

	* src/util/idxview.c:
	Show extension headers' contents.
	[b19f4de84900]

	* src/util/idxview.c:
	Make output a bit more cleaner.
	[3cd4b722baab]

	* src/util/Makefile.am, src/util/idxview.c:
	idxview rewrite. It now uses lib-index functions to read the files.
	[294af3a8d974]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache.c, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h:
	Added MAIL_INDEX_OPEN_FLAG_READONLY.
	[610f3d9813b5]

2007-11-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-rebuild.c:
	Handle maildir files that aren't in dovecot-uidlist file.
	[113bf6033abe]

	* src/lib-storage/index/maildir/maildir-uidlist.h:
	#ifndef typofix
	[d2a11b0df2c4]

	* src/lib-storage/index/dbox/dbox-sync-rebuild.c:
	Removed unnecessary code.
	[196d9e3cb864]

	* src/lib-index/mail-index-view-sync.c:
	Fixes to MAIL_INDEX_VIEW_SYNC_FLAG_FIX_INCONSISTENT handling.
	[53173ab706a0]

	* src/plugins/convert/convert-storage.c:
	Use a fast rename() method for maildir -> dbox conversion.
	[b502a4926298]

	* src/lib-storage/index/dbox/dbox-sync-rebuild.c, src/lib-
	storage/index/dbox/dbox-sync.c:
	Use the flags, keywords and cache from old index even when
	rebuilding dbox.
	[715ef6f98f44]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h:
	Added mail_index_ext_lookup()
	[90196328bcce]

	* src/lib-index/mail-cache-compress.c:
	Don't drop all fields if day_stamp is still 0 in index header.
	[6601ee607b6f]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index-sync-
	ext.c, src/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-
	index-sync-update.c, src/lib-index/mail-index-transaction-view.c,
	src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-
	index.h, src/lib-index/mailbox-list-index-sync.c, src/lib-
	storage/index/cydir/cydir-sync.c, src/lib-storage/index/dbox/dbox-
	sync-file.c, src/lib-storage/index/dbox/dbox-sync.c, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-mail.c, src
	/lib-storage/index/index-search.c, src/lib-storage/index/index-sync-
	changes.c, src/lib-storage/index/index-sync.c, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/list/index-mailbox-
	list-sync.c, src/lib-storage/list/index-mailbox-list.c:
	Renamed mail_index_lookup_uid_range() to
	mail_index_lookup_seq_range(), made it return a bool and added
	mail_index_lookup_seq(). Cleaned up the code to use these functions.
	[90bcf480312d]

	* src/lib-storage/index/index-sync.c:
	Use MAIL_INDEX_VIEW_SYNC_FLAG_FIX_INCONSISTENT instead of handling
	inconsistency ourself.
	[6a54a5339a64]

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index.h:
	Added MAIL_INDEX_VIEW_SYNC_FLAG_FIX_INCONSISTENT flag.
	[a4f475d415d6]

	* src/lib-storage/index/index-sync.c, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h:
	Added MAILBOX_SYNC_FLAG_FIX_INCONSISTENT flag. mailbox_sync() uses
	it always. If view is invalid or view syncing causes the view to
	become invalid, the view is reopened.
	[2637fb191e5e]

	* src/lib-index/mail-index-view-sync.c, src/lib-storage/index/index-
	sync.c:
	Fixes to handling inconsistent views after index reset.
	[c5e4a7b75586]

	* src/plugins/convert/convert-plugin.c:
	Don't crash if convert_alt_hierarchy_char isn't set.
	[baf570ca608b]

	* src/lib/restrict-access.c:
	If setgid() fails, includ euid and egid in the log message.
	[2a49ba9789b1]

	* src/lib/file-copy.c:
	If o_stream_send_istream() fails, log an error.
	[03af6da2ace1]

	* src/lib-storage/index/dbox/dbox-sync-rebuild.c:
	dbox rebuilding fixes
	[dd9d618fefb9]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-file-maildir.c, src/lib-storage/index/dbox
	/dbox-file.c, src/lib-storage/index/dbox/dbox-file.h, src/lib-
	storage/index/dbox/dbox-index.c, src/lib-storage/index/dbox/dbox-
	save.c, src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-storage.h, src/lib-storage/index/dbox/dbox-
	sync-file.c, src/lib-storage/index/dbox/dbox-sync-rebuild.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mailbox-list-
	private.h, src/lib-storage/mailbox-list.c:
	Support for looking up dbox files from an alternative directory if
	they're not found from the primary directory.
	[4a3cc2968040]

	* src/lib-index/mail-cache-transaction.c:
	Assert-crashfix
	[b6c76ea86e2a]

	* src/lib/network.c:
	Typofix in error message.
	[fc5e27a49c87]

2007-11-02  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.1.beta6 for changeset 1745e18a2e54
	[0fe5b772c576]

	* configure.in:
	Released v1.1.beta6.
	[1745e18a2e54] [1.1.beta6]

	* src/lib-index/mail-index-view-sync.c:
	Don't assert-crash if index was just reset.
	[7d7f31de0826]

	* src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins/fts-lucene
	/fts-lucene-plugin.h:
	Fixed "undefined symbol" when trying to load the plugin.
	[c2c543538b5d]

	* src/lib/restrict-access.c:
	If setuid() fails, log the current effective uid.
	[dbe6224b0309]

	* src/deliver/deliver.c:
	Fix handling envelope senders containing spaces.
	[a7d462ed94df]

	* src/lib-mail/rfc822-parser.c, src/lib-mail/rfc822-parser.h:
	Made IS_ATEXT*() public.
	[d9fb00afbc25]

	* src/auth/auth-cache.c, src/auth/auth-request.c, src/auth/auth-
	request.h:
	Auth cache didn't work for usernames that got translated internally.
	[d22888a77a1e]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Make sure uidlist gets written if we only added some extension
	fields to it.
	[5da6da5cea95]

	* src/lib-index/mail-index-transaction.c:
	Refresh index always after committing a transaction. This is
	especially useful now that we don't always bother to sync the
	mailbox after a commit.
	[b8f2fade7aeb]

	* src/lib-index/mail-cache-transaction.c:
	Last change broke cache file creation completely.
	[9ffa528c257c]

2007-10-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c:
	Infinite looping fixes
	[ac0e7f713d70]

2007-10-28  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-copy.c:
	Log an error if fchown() fails, but not because of EPERM.
	[947a8a032371]

	* src/pop3/client.c:
	Fixed using uninitialized variable in error handling.
	[c62f30cc1153]

	* src/plugins/fts-lucene/lucene-wrapper.cc, src/plugins/fts-lucene
	/lucene-wrapper.h:
	Compiler warning fixes
	[3acd85fbd55b]

	* src/lib-storage/index/dbox/dbox-file.c:
	Metadata writing fix
	[de99b5438fdf]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Code cleanup
	[96e4aff1be38]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Fix to handling setgid-bit-ignores-gid.
	[b2c14c07dcb2]

	* src/lib/file-dotlock.c:
	If dotlock was less than 2 seconds old, we never read PID from it.
	Now it's read after 2 seconds.
	[6dd5df1c1ec9]

	* src/lib-index/mail-cache-transaction.c:
	Fixed a race condition causing cache corruption when
	creating/compressing cache file.
	[f3ca0b9e3628]

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-transaction-
	log-file.c, src/lib-storage/index/mbox/mbox-sync.c:
	s/shrinked/shrank/
	[ce7f9d33d566]

	* src/lib-storage/index/index-sort.c:
	Fixed assert-crash for sorting by strings.
	[119c5a16150c]

	* .hgtags:
	Added tag 1.1.beta5 for changeset 2c3d08ad32ff
	[3240d834be16]

	* configure.in:
	Released v1.1.beta5.
	[2c3d08ad32ff] [1.1.beta5]

	* TODO:
	Updated
	[89dba9d9fa01]

	* src/lib/restrict-access.c:
	If RESTRICT_USER is empty string, don't call initgroups().
	[7f2501b3e993]

	* src/imap/cmd-list.c, src/lib-storage/list/mailbox-list-fs-iter.c,
	src/lib-storage/list/mailbox-list-maildir-iter.c, src/lib-
	storage/list/mailbox-list-subscriptions.c, src/lib-storage/mail-
	namespace.c, src/lib-storage/mail-namespace.h, src/lib-storage
	/mailbox-list-private.h, src/lib-storage/mailbox-list.c, src/lib-
	storage/mailbox-list.h, src/plugins/acl/acl-mailbox-list.c:
	Fixes to handling namespace prefixes and real!=virtual separator.
	Added a new MAILBOX_LIST_ITER_VIRTUAL_NAMES which specifies if
	mailbox listing should be using virtual or real mailbox names.
	[e1fde9940f7e]

	* src/lib/failures.h:
	Fix for compiling with g++ 3.x.
	[e2a4722f1b9b]

	* src/lib-storage/index/dbox/dbox-index.c:
	Don't use // comments
	[ce0088893a20]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-file.h, src/lib-storage/index/dbox/dbox-save.c, src/lib-
	storage/index/dbox/dbox-sync-file.c, src/lib-storage/index/dbox
	/dbox-sync.c:
	Handle maildir -> dbox file conversion when metadata is wanted to be
	updated.
	[6d870394cc3b]

2007-10-27  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/master/main.c:
	Show mail storages in dovecot --build-options.
	[e4f9e2b94a90]

	* src/lib-storage/index/dbox/dbox-sync-file.c:
	Remove compiler warning from currently unused/broken code.
	[1002deeef3a5]

	* COPYING:
	Added src/lib/UnicodeData.txt license.
	[5d73517a9b98]

	* src/lib-storage/list/mailbox-list-maildir-iter.c:
	Mailbox listing was broken if namespace had a prefix.
	[80419a82081f]

	* src/lib-storage/index/maildir/maildir-storage.c:
	If dovecot-shared file has setgid bit set, the group is ignored.
	[0dd9b91fd52c]

	* src/plugins/quota/quota-storage.c:
	Don't fail if trying to delete a nonselectable mailbox.
	[427eeded8078]

	* src/imap/cmd-subscribe.c:
	Allow subscribing to namespace prefixes if they're listable.
	[0511e301acbc]

	* src/lib-index/mail-transaction-log.c:
	Don't crash if we couldn't create transaction log.
	[7373240c3d1d]

	* src/auth/auth-client-connection.c:
	auth_debug: Log new auth connections and their PIDs.
	[7124f607fb1b]

	* src/lib-auth/auth-server-connection.c, src/lib-auth/auth-server-
	connection.h:
	If auth server hasn't responded to handshake in 30 seconds, log an
	error and reconnect.
	[5c25f5d7b29d]

	* src/imap-login/client.c, src/imap-login/client.h:
	If we've been waiting auth server to respond for over 30 seconds,
	send a "OK Waiting.." message to client.
	[f40f4e1a0a3c]

	* src/deliver/deliver.c:
	If syncing internal dummy mbox fails, show the error message.
	[91a003d00b4e]

	* src/lib/file-set-size.c:
	We need to include config.h before checking HAVE_* macros.
	[dde1980eccae]

	* src/lib/file-set-size.c:
	Solaris compile fix.
	[d6cc55e018fe]

	* src/imap/cmd-append.c:
	Changed error message.
	[744e4f5b6cd0]

	* src/auth/auth.c:
	Master passdbs are in their own list, so allow pass=yes even if a
	master passdb is the last in the list.
	[2a9edc9136f9]

	* src/auth/auth-request.c, src/auth/auth-request.h:
	Don't keep master username in original_username.
	[2a36e7d9ddb6]

	* src/auth/password-scheme.c:
	digest_md5_generate(): Fail with fatal instead of panic if username
	isn't given. This can easily happen with dovecotpw utility.
	[39f5251b04f9]

	* src/lib/istream-crlf.c:
	We called parent stream's read() too often, causing early EOFs.
	[f33be4f9ba4d]

2007-10-25  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Use AC_SYS_LARGEFILE instead of our own checks. Also removes
	--with-file-offset-bits parameter, but no-one probably cares.
	[be366eda336e]

	* src/plugins/zlib/zlib-plugin.c:
	Error handling fix.
	[63b4e1932a89]

	* src/plugins/zlib/zlib-plugin.c:
	If maildir file has a "Z" flag, open it with zlib.
	[ab3d8fba6420]

	* src/lib/crc32.c, src/lib/crc32.h:
	Renamed crc32() to crc32_data() so we don't conflict with zlib's
	crc32().
	[eccb154b310c]

2007-10-23  Timo Sirainen  <tss@iki.fi>

	* NEWS:
	Updated
	[8aa7924e7cc7]

	* .hgtags:
	Added tag 1.1.beta4 for changeset f92e583e2a0e
	[2d8e80021d95]

	* configure.in:
	Released v1.1.beta4.
	[f92e583e2a0e] [1.1.beta4]

	* src/lib-storage/index/dbox/Makefile.am:
	Added missing header file
	[eca135189e01]

	* TODO:
	Updated
	[c0d18ea33806]

	* src/lib-mail/message-search.c:
	Include CRLFs in searched text between headers.
	[59f5c5cbf7b7]

	* src/lib-storage/index/mbox/mbox-mail.c:
	Return mbox stream without CRs. Fixes crashes at least when
	searching.
	[1fc0aae1c159]

2007-10-22  Timo Sirainen  <tss@iki.fi>

	* src/lib/base64.c:
	Whitespace skipping was broken.
	[d81a50101724]

2007-10-21  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-mailbox-list.c:
	Don't crash when listing mailboxes in a namespace with a prefix.
	[1478fc5cf632]

	* dovecot-example.conf, src/deliver/deliver.c, src/imap/cmd-list.c,
	src/imap/cmd-subscribe.c, src/lib-storage/mail-namespace.c, src/lib-
	storage/mail-namespace.h, src/master/mail-process.c, src/master
	/master-settings.c, src/master/master-settings.h:
	Added subscriptions setting to namespaces to specify if it should
	handle subscriptions itself or if the parent namespace should handle
	them.
	[afc28dd2d4c5]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Crashfix
	[3660e9cc06d2]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-index.c, src/lib-storage/index/dbox/dbox-sync-file.c, src/lib-
	storage/index/dbox/dbox-sync.c:
	Fixes to handling maildir files.
	[835daa872b0a]

	* src/lib-storage/index/dbox/Makefile.am, src/lib-storage/index/dbox
	/dbox-file-maildir.c, src/lib-storage/index/dbox/dbox-file-
	maildir.h, src/lib-storage/index/dbox/dbox-file.c, src/lib-
	storage/index/dbox/dbox-file.h, src/lib-storage/index/dbox/dbox-
	index.c, src/lib-storage/index/dbox/dbox-index.h, src/lib-
	storage/index/dbox/dbox-mail.c, src/lib-storage/index/dbox/dbox-
	storage.h, src/lib-storage/index/dbox/dbox-sync-rebuild.c:
	Support for reading maildir files. This makes it possible to do a
	fast maildir to dbox conversion by only renaming a few files.
	[416d9ee66047]

	* src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	Added maildir_uidlist_init_readonly() and maildir_uidlist_get_uid().
	[a6f51026b969]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-keywords.c,
	src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-storage/mail-
	storage-private.h:
	Moved mail_create_mode/gid from struct maildir_mailbox to struct
	mailbox.
	[7eb8fd17f8c5]

	* src/lib/utc-mktime.c:
	Fix to 64bit time_t
	[7b5b3b0c7002]

	* src/master/mail-process.c:
	imap_logout_format setting wasn't passed to imap process.
	[454829f6655b]

	* src/lib-storage/index/maildir/maildir-storage.c:
	If control dir isn't the same as root dir, we created .box/.box/
	directory instead of just .box/.
	[952540aef485]

	* src/lib-storage/list/mailbox-list-subscriptions.c:
	Fix listing subscriptions when real separator != virtual separator.
	[2bd0aaeb35f3]

	* src/lib/file-dotlock.c:
	Check ctimes after all, but only as long as nfs_flush=FALSE.
	[be0a8109cde6]

	* src/deliver/duplicate.c, src/lib-index/mail-cache.c, src/lib-index
	/mail-hash.c, src/lib-index/mail-transaction-log.c, src/lib-index
	/mailbox-list-index.c, src/lib-storage/index/maildir/maildir-
	keywords.c, src/lib-storage/index/maildir/maildir-uidlist.c, src
	/lib-storage/index/mbox/mbox-lock.c, src/lib-storage/list
	/subscription-file.c, src/lib-storage/mail-storage.c, src/lib-
	storage/mailbox-list.h, src/lib/file-dotlock.c, src/lib/file-
	dotlock.h, src/plugins/convert/convert-storage.c, src/plugins/quota
	/quota-maildir.c:
	dotlocks: Flush NFS attribute cache only if nfs_flush setting is
	TRUE.
	[b6631550cf84]

	* src/deliver/duplicate.c:
	Use a new format for duplicate file which can handle moving between
	32bit and 64bit systems.
	[f74e84fd11fc]

	* src/lib/file-dotlock.c:
	Don't check ctime changes, because we change it ourself all the time
	when flushing NFS attribute caches.
	[b9b201f5c581]

	* src/lib-index/mail-cache-transaction.c:
	Don't give "Newly added field got lost unexpectedly" errors when
	cache file is created while adding a new field.
	[0e46072f797a]

	* src/lib/ioloop-notify-kqueue.c:
	Don't crash when removing kqueue notify.
	[fd01ec16611f]

	* src/lib/ioloop.c:
	Added assert.
	[06e3cff76570]

	* src/lib-mail/message-parser.c:
	Handle lines longer than 8192 bytes without going to infinite loop.
	[d6b2343238f9]

	* src/lib/file-set-size.c:
	If posix_fallocate() returns EINVAL, fallback to writing.
	[a9dfe05dfadd]

	* src/lib/utc-mktime.c:
	utc_mktime() was broken with 32bit time_t. Also don't try to
	optimize away the seconds, it doesn't really help and it makes the
	lowest time_t values unusable.
	[4fb613eb8ce9]

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync.c:
	When saving to empty mbox files, sync them first since it doesn't
	take hardly any time anyway.
	[104a8929ef7c]

	* src/plugins/quota/quota-maildir.c:
	Log a nice warning if using maildir++ quota without maildir
	storages.
	[9e7bf6becfb4]

	* src/deliver/auth-client.c:
	If connect to auth socket fails with a temporary error, retry max.
	10 times.
	[d4b2df823ca5]

	* src/deliver/deliver.c:
	Default to list=yes in namespaces.
	[d172fb7d216f]

	* src/lib-mail/message-decoder.c:
	Body decoding was broken.
	[825621c540b8]

	* src/lib-storage/list/mailbox-list-maildir.c:
	Handle RENAME "a" "a.b" correctly. Based on patch by pod.
	[d7ed8c41d8b3]

	* src/imap/cmd-list.c:
	Send namespace prefix LIST reply for list=no namespaces also if
	doing LIST "" prefix.
	[5b2ff32877d4]

	* src/auth/db-ldap.c:
	If ldap_bind() failed because LDAP server was down, we never
	reconnected. Patch by Brendan Braybrook.
	[66e6311e22b3]

	* src/auth/auth-request.c:
	Added "username" and "domain" fields for modifying the username.
	[d573bc2a967d]

2007-10-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	Header searches didn't decode MIME encoded words.
	[ab3a1a8ade55]

	* src/imap/cmd-list.c, src/lib-storage/list/mailbox-list-fs-iter.c,
	src/lib-storage/list/mailbox-list-maildir-iter.c:
	Fixes for listing namespaces with prefixes and real != virtual
	separator.
	[c901bdf0db75]

	* src/master/listener.c:
	Use "listen" setting for SSL listeners if "ssl_listen" is empty.
	[79836b3474f4]

	* src/lib-mail/istream-header-filter.c:
	Last change broke HEADER_FILTER_HIDE_BODY flag.
	[ed09701ff3d0]

	* src/imap/client.c:
	Don't assert-crash if client disconnects while IDLEing.
	[86e964111b1f]

	* src/lib/file-set-size.c:
	If file_set_size() fails for any other reason than "not enough disk
	space/quota", log the syscall that caused the error.
	[b7d8695d864d]

	* src/lib/istream-seekable.c:
	If all streams are seekable, return a concat stream instead.
	[717fdce1cfb4]

	* src/lib-mail/istream-header-filter.c:
	Support returning mixed header and body data in read().
	[b8442b2e3c04]

	* src/lib/istream-concat.c:
	Fixes
	[1f98c63aaaa3]

	* src/lib-mail/istream-header-filter.c:
	Fix to handling buffer full conditions.
	[b39233d16d0f]

	* src/lib/istream-concat.c, src/lib/istream-seekable.c:
	Set blocking/seekable flags.
	[c4fa8b1ee24a]

	* src/lib/istream-crlf.c:
	Don't assert-crash if underlying input stream read only a CR
	character.
	[d85bfe89f4b8]

	* src/lib-storage/index/mbox/mbox-save.c:
	More fixes to handling mail saving.
	[8917cf7fa8ba]

	* src/lib/Makefile.am, src/lib/istream-concat.c, src/lib/istream-
	concat.h:
	Added concatenation input stream.
	[026f67ecd858]

	* src/lib-index/mail-cache-lookup.c:
	Minor read access buffer overflow fix.
	[9036aa956d14]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib/istream-crlf.c, src/lib/istream-
	limit.c, src/lib/istream-seekable.c, src/lib/istream-tee.c:
	Always keep a usable value in stream->max_buffer_size.
	[15a9ce2cc0ab]

	* src/lib/istream-crlf.c, src/lib/istream-file.c, src/lib/istream-
	internal.h, src/lib/istream.c:
	Added i_stream_get_buffer_space() to remove code duplication.
	[4a1caf69ca14]

	* src/lib/istream-limit.c:
	Fix to handling buffer full conditions.
	[b56ed305a8bf]

	* src/lib-storage/index/mbox/mbox-save.c:
	Fixed saving messages
	[f9a4bd4ea2bb]

2007-10-16  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.1.beta3 for changeset 4fddc10844ff
	[b3392a7da84f]

	* configure.in:
	Released v1.1.beta3.
	[4fddc10844ff] [1.1.beta3]

	* src/deliver/deliver.c:
	Parse namespaces from config file.
	[e752f60f7e60]

	* src/lib/istream-crlf.c:
	Fix
	[d8343f5863d3]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Removed accidentally committed broken asserts.
	[9bdc9ecfc470]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Fixed "file size unexpectedly shrinked" error in some conditions.
	[db6afac39fde]

	* src/lib-storage/index/index-sort.c:
	Fixed handling reversed sorts.
	[bf5293708132]

	* doc/Makefile.am, doc/wiki/Makefile.am.in:
	Put back docdir definition. Looks like it's a recent automake(?)
	addition which doesn't work everywhere.
	[810ea4ef69f4]

	* src/lib-storage/index/index-sort.c:
	Don't assert-crash with node.sort_id != 0.
	[7a207cbc008b]

	* src/lib-storage/index/index-sort.c:
	Nowadays the SORT draft specifies that if Date: header is missing or
	broken, SORT should fallback to using INTERNALDATE.
	[a53bc41fade4]

	* src/lib-storage/index/index-mail.c:
	mail_get_date(): Missing Date: header should be returned as 0, not
	as -1.
	[699c4c193ffc]

2007-10-09  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-crlf.c:
	Fixes
	[68c8a6ddde12]

	* src/lib-storage/mail-namespace.c, src/master/mail-process.c:
	hidden=yes list=yes is a valid namespace combination
	[2d0b59aeb41a]

	* src/master/auth-process.c, src/master/child-process.c, src/master
	/child-process.h, src/master/dict-process.c, src/master/log.c,
	src/master/log.h, src/master/login-process.c, src/master/mail-
	process.c, src/master/ssl-init.c:
	If child process logged a fatal failure, don't show "returned error
	89" message.
	[402d14b5ef8b]

	* src/master/log.c:
	Log fatal/panic messages coming from child processes as such,
	instead of converting them to errors.
	[56d6a891c41c]

	* src/deliver/deliver.c, src/imap/main.c, src/pop3/main.c:
	If namespace initialization fails, die with a fatal error message
	instead of just exiting.
	[12a779e08a73]

	* src/lib/failures.c, src/lib/failures.h:
	Changed failure callbacks to take failure type parameter, so it's no
	longer necessary to have separate panic and warning callbacks. Added
	i_log_type() function to log a message with any type (even
	fatal/panic without dying ourself).
	[a93a7738c0ec]

2007-10-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-header-decode.c:
	Fix for last change: don't crash if temp buffer wasn't created..
	[1b7d91f7b151]

	* src/lib-mail/message-header-decode.c:
	message_header_decode(): Don't use t_push/t_pop. The callback may
	want to write to a buffer in data stack.
	[58d9f94b9919]

	* dovecot-example.conf, src/plugins/mail-log/mail-log-plugin.c:
	Log mailbox renames also.
	[2a2fd5c3b42e]

	* src/lib-storage/list/mailbox-list-maildir.c:
	Don't break when renaming mailboxes with '*' or '%' characters and
	children.
	[d4d6457550b5]

	* src/lib-storage/mail-namespace.c:
	Give an error if trying to use list=no and empty prefix.
	[dea6ed0002ae]

	* dovecot-example.conf:
	Updated hidden namespace comments.
	[6c96c8205fd0]

	* src/lib-storage/index/index-sort.c:
	Assert-crashfix
	[da3093d9f572]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-idle.c, src/imap/cmd-search.c:
	Fixed process hanging sometimes when disconnecting.
	[d747bfbda43c]

	* src/lib/Makefile.am, src/lib/ostream-crlf.c, src/lib/ostream-crlf.h:
	Removed CRLF/LF output streams. They're no longer needed.
	[2f397bc2cc0c]

	* src/lib-mail/message-parser.c, src/lib-mail/message-parser.h:
	Removed message_parser_set_crlfs(). It's no longer needed and it
	might not work as wanted anyway.
	[aee441840b5a]

	* src/lib-storage/index/cydir/cydir-save.c, src/lib-storage/index/dbox
	/dbox-save.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/mbox
	/mbox-save.c:
	Use crlf input streams instead of output streams so message parser
	doesn't end up saving broken offsets.
	[aedda93baa2c]

	* src/lib/Makefile.am, src/lib/istream-crlf.c, src/lib/istream-crlf.h:
	Added input stream filters for reading linefeeds as CRLFs or LFs.
	[ba65c858b7dd]

2007-10-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c:
	Make sure we parse everything so they can be saved to cache.
	[c4205f6ac88f]

2007-10-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-client.c:
	Error handling fix
	[ae684f2e0534]

2007-09-30  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.1.beta2 for changeset 19b73ae1d6f6
	[20a5e69e6266]

	* configure.in:
	Released v1.1.beta2.
	[19b73ae1d6f6] [1.1.beta2]

	* configure.in:
	With 32bit time_t we were checking it up to 64 bits, which
	overflowed the checks and broke them.
	[6c46542a5ce5]

	* src/lib-storage/list/index-mailbox-list.c:
	Compiler warning fix
	[9534f7adc0c6]

	* src/plugins/fts/fts-api.c:
	Compile fix
	[745d5bb908f4]

	* src/master/login-process.c:
	Login processes started by inetd aren't ours, don't treat them as
	such.
	[66e5f514355e]

	* src/deliver/deliver.c:
	Another try, -d is now destination user as originally and -a is now
	destination address.
	[9b71007b70c7]

	* src/deliver/deliver.c:
	Update help string.
	[4e92a6c44b44]

	* src/deliver/deliver.c:
	And call deliver_mail() with destaddr instead of user.
	[af3194cbd364]

	* src/deliver/deliver.c, src/deliver/deliver.h:
	Added -a parameter to specify authentication username. It can be
	used to override -d parameter which specifies the destination
	address (e.g. user+detail@domain). The destination address is now
	passed to plugins instead of the username.
	[95eb92b49d9c]

	* src/pop3/commands.c:
	Sync mailbox after committing transaction, so that the messages
	really get expunged.
	[b058f43c77e2]

	* src/master/master-settings.c:
	Compiler warning fix
	[0a157f89fb52]

	* src/deliver/deliver.c, src/imap/cmd-append.c, src/imap/cmd-copy.c,
	src/imap/cmd-search.c, src/imap/cmd-store.c, src/imap/imap-
	expunge.c, src/imap/imap-fetch.c, src/imap/imap-sort.c, src/imap
	/imap-sync.c, src/imap/imap-thread.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-transaction.c, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/plugins/acl/acl-mailbox.c,
	src/plugins/convert/convert-storage.c, src/plugins/expire/expire-
	plugin.c, src/plugins/expire/expire-tool.c, src/plugins/fts/fts-
	storage.c, src/plugins/lazy-expunge/lazy-expunge-plugin.c,
	src/plugins/mail-log/mail-log-plugin.c, src/plugins/mbox-snarf/mbox-
	snarf-plugin.c, src/plugins/quota/quota-count.c, src/plugins/quota
	/quota-storage.c, src/plugins/trash/trash-plugin.c,
	src/pop3/client.c, src/pop3/commands.c:
	mailbox_transaction_commit*() doesn't sync the mailbox anymore, so
	it shouldn't take mailbox_sync_flags parameter either.
	[1a3604c8ee05]

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-storage.h, src/lib-storage/index/mbox/mbox-transaction.c:
	Sync mbox when committing transaction only when saving messages to
	update last-uid.
	[fe5c19ffc119]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-sync-
	update.c:
	Fixes to NFS read cache flushing.
	[d79975141df2]

	* src/lib/restrict-access.c:
	Use better error messages for setgroups() failures.
	[d0689497bb11]

	* src/deliver/deliver.c:
	If -f parameter is given, use it for deliver_get_return_address()
	instead of Return-Path: header.
	[722bef1a0c4e]

	* src/lib-index/mail-index-map.c:
	Avoid "first_recent_uid 0 -> 1" errors when upgrading from v1.0
	index files.
	[392a49f0c69a]

	* src/lib-mail/message-search.c:
	Using uninitialized variable sometimes caused crash by trying to use
	too much memory.
	[c83e3272ae88]

	* doc/Makefile.am, doc/wiki/Makefile.am.in:
	Use the predefined $(docdir) instead of creating our own.
	[0da3d9671426]

	* src/lib-storage/mail-namespace.c:
	hook_mail_namespaces_created was called with empty namespace list if
	namespaces weren't explicitly defined.
	[9aec63500aea]

2007-09-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-storage.h:
	Compiler warning fix
	[cc60666f66bb]

2007-09-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.h, src/lib-storage/index/cydir/cydir-
	sync.h, src/lib-storage/index/cydir/cydir-transaction.c, src/lib-
	storage/index/dbox/dbox-sync.h, src/plugins/fts-squat/squat-trie.h:
	Don't forward declare enums. It doesn't seem to work with all
	compilers.
	[c4cb7f25bf09]

	* configure.in:
	Make sure we don't define BUILTIN_GSSAPI unless HAVE_GSSAPI is also
	defined.
	[dee85392c5c1]

	* src/plugins/fts-lucene/Makefile.am:
	Add lucene-wrapper.h to distribution.
	[8b58219e6ac5]

	* src/imap/cmd-idle.c:
	Crashfix in some conditions
	[4cb03870a714]

	* NEWS:
	Don't list all changes here, just point to the upgrading doc.
	[67668832dd6c]

	* src/deliver/auth-client.c:
	Use mail_uid/gid settings if userdb didn't return uid/gid.
	[79176ff12ad8]

	* src/imap/cmd-list.c, src/lib-index/mailbox-list-index-sync.c, src
	/lib-otp/otp-hash.c:
	Compiler warning fixes
	[406c9a863f26]

	* src/lib-storage/mail.c, src/login-common/ssl-proxy-openssl.c:
	Don't return void values from void functions.
	[94501a17dcd0]

2007-09-24  Timo Sirainen  <tss@iki.fi>

	* src/deliver/mail-send.c, src/imap/commands.c, src/imap/imap-fetch.c,
	src/lib-index/mail-index-transaction.c, src/lib-otp/otp-hash.c, src
	/lib-storage/index/mbox/mbox-md5.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib
	/backtrace-string.c, src/lib/ioloop-notify-kqueue.c,
	src/lib/primes.c, src/master/capabilities-posix.c, src/master/ssl-
	init-openssl.c, src/plugins/quota/quota.c:
	Use N_ELEMENTS() macro instead of doing sizeof()/sizeof([0])
	ourself.
	[59490181469e]

	* src/deliver/deliver.c:
	From-line checking wrote to bad memory location in stack.
	[2821a472806f]

	* src/lib-storage/index/index-search.c:
	Don't crash with empty messagesets.
	[c6b85cf1e63a]

	* src/lib/istream-tee.c:
	Compiling fix for non-gcc.
	[a43faaff06fd]

2007-09-23  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.1.beta1 for changeset 1d45cf642d86
	[c4429ac4ce6b]

	* configure.in:
	Released v1.1.beta1.
	[1d45cf642d86] [1.1.beta1]

	* .hgignore:
	rquota_xdr.h -> rquota.h
	[013e84571cc8]

	* src/lib-storage/index/index-search.c:
	Small code optimization.
	[fda4b611440b]

	* src/lib-storage/index/index-search.c:
	Merge also unnecessary sub-ORs.
	[33480577814e]

	* src/lib-storage/index/index-search.c:
	Simplify search tree by canonicalizing message sets, converting NOT
	away from NOT (list) and dropping extra sub lists. Fix also handling
	NOT messagesets.
	[2eff72b212fe]

	* AUTHORS, COPYING:
	There's no Cyrus code anymore. Show BSD license in COPYING.
	[59b7fec40e0d]

	* configure.in, src/lib/utc-mktime.c, src/lib/utc-mktime.h:
	Rewrote utc_mktime() so it's now MIT licensed. This also fixes
	handling years older than 1970.
	[6d15946eccb5]

2007-09-22  Timo Sirainen  <tss@iki.fi>

	* src/lib/base64.c:
	Rewrote base64 functions so they're now MIT licensed.
	[c02c7912fb15]

	* src/dict/Makefile.am, src/dict/dict-cache.c, src/dict/dict-cache.h,
	src/dict/dict-server.c:
	Use dicts directly instead of caching them. Caching doesn't help
	much here.
	[e81e56e67ba1]

	* src/lib-dict/dict-sql.c:
	Use SQL connection pools.
	[7596339a9452]

	* src/lib-sql/Makefile.am, src/lib-sql/sql-pool.c, src/lib-sql/sql-
	pool.h:
	Added SQL connection pools.
	[e66bf9b9e011]

	* src/lib-sql/sql-api.c:
	Added sql_db_module_register for module_contexts users.
	[1e07f47e5e1e]

	* src/master/dict-process.c:
	If dict process dies, master assert-crashed when trying to restart
	it.
	[15874cb050e2]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/driver-sqlite.c, src/lib-sql/sql-api.c:
	Let deinit() free all the memory itself after all.
	[af14dc005392]

	* src/auth/db-ldap.c, src/auth/db-passwd-file.c, src/auth/passdb-
	ldap.c, src/deliver/duplicate.c, src/imap-login/client.c,
	src/lib/hash.c, src/lib/hash.h, src/login-common/login-proxy.c, src
	/login-common/ssl-proxy-openssl.c, src/pop3-login/client.c:
	Renamed hash_size() -> hash_count().
	[ee420f238104]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/driver-sqlite.c, src/lib-sql/sql-api-private.h, src/lib-sql/sql-
	api.c:
	Added module_contexts to struct sql_db.
	[46c3e1ee196f]

	* src/dict/dict-cache.c, src/dict/dict-cache.h, src/dict/dict-
	server.c:
	Don't cache dict to different users.
	[bd886e12aaa0]

	* src/imap-login/client-authenticate.c, src/login-common/login-
	proxy.c, src/login-common/login-proxy.h, src/pop3-login/client-
	authenticate.c:
	If proxy points to the same host/port/user combination as we
	currently have, don't create an infinite connection loop.
	[6afb29dc9273]

	* src/deliver/deliver.c:
	If the first line begins with "From ", ignore it.
	[910aadd76897]

	* src/lib-storage/index/index-mailbox-check.c:
	Minor code cleanup
	[d2c37921f5f9]

	* src/lib-storage/index/index-mailbox-check.c:
	Dropped interval between mailbox change notifies from
	mailbox_idle_check_interval to 1 second. Some clients keep a long-
	running IDLE connection and use other connections to check the new
	mail.
	[416973e853db]

	* src/plugins/lazy-expunge/lazy-expunge-plugin.c:
	If rename() fails, log an error.
	[bca937328758]

	* src/plugins/lazy-expunge/lazy-expunge-plugin.c:
	Crashfix to last change
	[7499e36629c6]

	* src/imap/cmd-create.c:
	Don't assert-crash if trying to create mailbox prefix.
	[eab04861f2fc]

	* src/deliver/auth-client.c:
	If we're connecting to client socket instead of a master socket, log
	an understandable error message.
	[da4867da38c2]

	* src/plugins/quota/quota-count.c, src/plugins/quota/quota-storage.c:
	Synchronize mailbox after it has been opened.
	[90faec88598f]

	* src/imap/cmd-select.c, src/imap/imap-status.c, src/imap/imap-sync.c,
	src/imap/imap-sync.h, src/plugins/convert/convert-storage.c,
	src/plugins/mbox-snarf/mbox-snarf-plugin.c, src/plugins/trash/trash-
	plugin.c, src/pop3/client.c:
	Use mailbox_sync() instead of our own implementation.
	[aeee5076f99f]

	* src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h:
	Added mailbox_sync() to easily synchronize a mailbox.
	[60a34f26c35a]

	* src/lib-storage/index/maildir/maildir-transaction.c:
	Compiler warning fix
	[c057369df638]

	* src/plugins/lazy-expunge/lazy-expunge-plugin.c:
	Mark lazy expunge's namespaces as internal so quota doesn't count
	them.
	[d4df001f9bd0]

	* src/deliver/deliver.c, src/lib-storage/mail-namespace.h,
	src/plugins/quota/quota-storage.c:
	Mark deliver's dummy mbox namespace as internal and don't include it
	in quota calculation.
	[c6849b4a3812]

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c, src
	/lib-index/mail-transaction-log.h:
	Keep transaction logs referenced while we know we need them. This
	fixes desync errors with in-memory indexes.
	[cca479cb3ef0]

	* src/lib-storage/index/index-search.c:
	Searching NOT sequence set with multiple search ranges containing
	either first or last sequence caused some messages to be skipped.
	[3645048f6f6e]

	* src/lib-storage/index/maildir/maildir-save.c:
	If we expunged saved mails, rollback also cache transaction.
	[ac87cdd44305]

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache-
	transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-index/mail-index-transaction.c:
	mail_cache_transaction_commit()/rollback() API is now public and
	takes a ** pointer. Don't break if transaction is
	committed/rollbacked multiple times for a cache view.
	[5ad7a36ca8c3]

	* src/imap/cmd-append.c, src/imap/cmd-check.c, src/imap/cmd-copy.c,
	src/imap/cmd-expunge.c, src/imap/cmd-fetch.c, src/imap/cmd-noop.c,
	src/imap/cmd-store.c, src/imap/imap-fetch.c, src/imap/imap-fetch.h,
	src/imap/imap-sync.c, src/imap/imap-sync.h:
	Make sure we do a mailbox sync after flag updates (STORE, FETCH).
	Also added a new IMAP_SYNC_FLAG_SAFE which is used to figure out if
	appends and expunges are safe to send to client when delay-newmail
	workaround is enabled.
	[b5e6543b4385]

	* src/lib-storage/index/cydir/cydir-sync.c, src/lib-
	storage/index/cydir/cydir-sync.h, src/lib-storage/index/cydir/cydir-
	transaction.c, src/lib-storage/index/dbox/dbox-transaction.c:
	Don't sync mailbox when committing transaction. It's not needed.
	[d98617723bc2]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-sync.h, src/lib-storage/index/maildir
	/maildir-transaction.c:
	Don't sync mailbox immediately when committing transactions. When
	it's done later, make sure we sync the mailbox if there are pending
	changes in transaction log.
	[a62923d3c969]

	* src/lib-storage/index/maildir/maildir-keywords.h:
	Compiler warning fix when including directly.
	[cbfce8bbc917]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index.h, src
	/lib-index/mail-transaction-log.c:
	Added mail_index_sync_have_any().
	[3132ce8f425d]

	* src/lib-storage/index/maildir/maildir-save.c:
	If we couldn't lock dovecot-uidlist, drop our appends so they don't
	get written to transaction log with uid=0.
	[880e1bf0127b]

	* src/lib-index/mail-index-transaction.c:
	mail_index_expunge() can now expunge the last appended message.
	[bb838223bb93]

	* src/lib-index/mail-index-transaction.c:
	When sorting appends, sort also keyword resets.
	[ed433a2a5f3d]

	* .hgtags:
	Added tag 1.1.alpha6 for changeset 5ac9c11807e7
	[0a44101371a4]

	* src/lib-storage/index/index-mail-headers.c:
	Don't assert-crash if looking up a non-parsed header after headers
	were already parsed once.
	[4d33a6959d32]

	* src/lib-storage/list/index-mailbox-list.c:
	Disable mailbox list indexing always (so it's disabled in deliver).
	[2b434cf6954e]

	* src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache-
	transaction.c:
	Code cleanups and some minor fixes.
	[53313d1e7e4f]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Crashfix
	[6f12401a149e]

	* src/imap/cmd-copy.c:
	Don't assert-crash if COPYing didn't copy any messages.
	[758016646062]

2007-09-20  Timo Sirainen  <tss@iki.fi>

	* src/lib/data-stack.c:
	If data stack growing fails because of out-of-memory, something's
	probably buggy so do assert() to dump core.
	[e10e2147d994]

2007-09-18  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/Makefile.am, src/plugins/quota/quota-fs.c:
	Yet another try at getting rquota code compiling properly with BSD
	make.
	[b951f3e42322]

2007-09-17  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/Makefile.am:
	rquota_xdr.h -> rquota.h
	[2ab3cb6af745]

	* .hgignore, src/plugins/quota/Makefile.am:
	Generate also rquota_xdr.h.
	[92bce6a3fdad]

	* src/auth/auth-worker-client.c, src/auth/passdb-blocking.c:
	Transfer also userdb information from blocking passdb workers, so
	prefetch doesn't break with auth cache.
	[fd7ffed49763]

	* src/plugins/quota/Makefile.am:
	Try an alternative way to specify rquota_xdr.c dependency.
	[1672a4cb665e]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/mailbox-list-private.h, src/lib-storage/mailbox-list.c:
	Moved mail_location data parsing to a common function. It supports
	now also specifying SUBSCRIPTIONS and DIRNAME.
	[7b745fb85975]

	* src/master/master-settings.c:
	Include sys/resource.h
	[375ba923a622]

2007-09-16  Timo Sirainen  <tss@iki.fi>

	* README:
	Updated.
	[5ac9c11807e7] [1.1.alpha6]

	* .hgignore:
	Added "compile" binary that autotools seem to create nowadays
	[76ed2ef0874b]

	* src/auth/userdb-nss.c, src/lib-storage/index/cydir/cydir-mail.c, src
	/lib-storage/index/cydir/cydir-save.c, src/lib-storage/index/cydir
	/cydir-storage.c, src/lib-storage/index/cydir/cydir-sync.c, src/lib-
	storage/index/cydir/cydir-transaction.c, src/lib-storage/index/dbox
	/dbox-file.c, src/lib-storage/index/dbox/dbox-index.c, src/lib-
	storage/index/dbox/dbox-mail.c, src/lib-storage/index/dbox/dbox-
	save.c, src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-sync-file.c, src/lib-storage/index/dbox
	/dbox-sync-rebuild.c, src/lib-storage/index/dbox/dbox-sync.c, src
	/lib-storage/index/dbox/dbox-transaction.c, src/lib-storage/index
	/index-sync-changes.c, src/lib-storage/index/maildir/maildir-sync-
	index.c, src/lib-storage/mail-error.c, src/lib/ioloop-notify-fd.c,
	src/lib/mempool-system-clean.c, src/lib/safe-mkstemp.c, src/lib/str-
	find.c, src/master/dup2-array.c, src/plugins/acl/acl-backend-vfile-
	acllist.c, src/plugins/mail-log/mail-log-plugin.c, src/plugins/mbox-
	snarf/mbox-snarf-plugin.c, src/util/idxview.c, src/util/listview.c,
	src/util/logview.c:
	Copyright cleanup: 2007-2007 -> 2007
	[47c3c4d41b26]

	* COPYING, src/auth/auth-cache.c, src/auth/auth-client-connection.c,
	src/auth/auth-master-connection.c, src/auth/auth-master-listener.c,
	src/auth/auth-request-handler.c, src/auth/auth-request.c, src/auth
	/auth-stream.c, src/auth/auth-worker-client.c, src/auth/auth-worker-
	server.c, src/auth/auth.c, src/auth/db-ldap.c, src/auth/db-passwd-
	file.c, src/auth/db-sql.c, src/auth/main.c, src/auth/mech-
	anonymous.c, src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c,
	src/auth/mech-plain.c, src/auth/mech.c, src/auth/passdb-blocking.c,
	src/auth/passdb-bsdauth.c, src/auth/passdb-cache.c, src/auth/passdb-
	checkpassword.c, src/auth/passdb-ldap.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-sql.c, src/auth/passdb-vpopmail.c, src/auth/passdb.c,
	src/auth/password-scheme.c, src/auth/userdb-blocking.c, src/auth
	/userdb-ldap.c, src/auth/userdb-nss.c, src/auth/userdb-passwd-
	file.c, src/auth/userdb-passwd.c, src/auth/userdb-prefetch.c,
	src/auth/userdb-sql.c, src/auth/userdb-static.c, src/auth/userdb-
	vpopmail.c, src/auth/userdb.c, src/deliver/auth-client.c,
	src/deliver/deliver.c, src/deliver/duplicate.c, src/deliver/mail-
	send.c, src/deliver/smtp-client.c, src/dict/dict-cache.c, src/dict
	/dict-server.c, src/dict/main.c, src/imap-login/client-
	authenticate.c, src/imap-login/client.c, src/imap-login/imap-
	proxy.c, src/imap/client.c, src/imap/cmd-append.c, src/imap/cmd-
	capability.c, src/imap/cmd-check.c, src/imap/cmd-close.c, src/imap
	/cmd-copy.c, src/imap/cmd-create.c, src/imap/cmd-delete.c, src/imap
	/cmd-examine.c, src/imap/cmd-expunge.c, src/imap/cmd-fetch.c,
	src/imap/cmd-idle.c, src/imap/cmd-list.c, src/imap/cmd-logout.c,
	src/imap/cmd-lsub.c, src/imap/cmd-namespace.c, src/imap/cmd-noop.c,
	src/imap/cmd-rename.c, src/imap/cmd-search.c, src/imap/cmd-select.c,
	src/imap/cmd-sort.c, src/imap/cmd-status.c, src/imap/cmd-store.c,
	src/imap/cmd-subscribe.c, src/imap/cmd-thread.c, src/imap/cmd-uid.c,
	src/imap/cmd-unselect.c, src/imap/cmd-unsubscribe.c,
	src/imap/cmd-x-cancel.c, src/imap/commands-util.c,
	src/imap/commands.c, src/imap/imap-expunge.c, src/imap/imap-fetch-
	body.c, src/imap/imap-fetch.c, src/imap/imap-messageset.c, src/imap
	/imap-search.c, src/imap/imap-sort.c, src/imap/imap-status.c,
	src/imap/imap-sync.c, src/imap/imap-thread.c, src/imap/mail-storage-
	callbacks.c, src/imap/main.c, src/lib-auth/auth-client.c, src/lib-
	auth/auth-server-connection.c, src/lib-auth/auth-server-request.c,
	src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-dict/dict-client.c, src/lib-dict/dict-db.c, src/lib-dict/dict-
	sql.c, src/lib-dict/dict.c, src/lib-imap/imap-base-subject.c, src
	/lib-imap/imap-bodystructure.c, src/lib-imap/imap-date.c, src/lib-
	imap/imap-envelope.c, src/lib-imap/imap-match.c, src/lib-imap/imap-
	parser.c, src/lib-imap/imap-quote.c, src/lib-imap/imap-util.c, src
	/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	decisions.c, src/lib-index/mail-cache-fields.c, src/lib-index/mail-
	cache-lookup.c, src/lib-index/mail-cache-sync-update.c, src/lib-
	index/mail-cache-transaction.c, src/lib-index/mail-cache.c, src/lib-
	index/mail-hash.c, src/lib-index/mail-index-dummy-view.c, src/lib-
	index/mail-index-fsck.c, src/lib-index/mail-index-lock.c, src/lib-
	index/mail-index-map.c, src/lib-index/mail-index-sync-ext.c, src
	/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index-transaction-view.c, src/lib-index/mail-index-transaction.c,
	src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index-
	view.c, src/lib-index/mail-index-write.c, src/lib-index/mail-
	index.c, src/lib-index/mail-transaction-log-append.c, src/lib-index
	/mail-transaction-log-file.c, src/lib-index/mail-transaction-log-
	view.c, src/lib-index/mail-transaction-log.c, src/lib-index/mailbox-
	list-index-sync.c, src/lib-index/mailbox-list-index.c, src/lib-mail
	/istream-header-filter.c, src/lib-mail/message-address.c, src/lib-
	mail/message-date.c, src/lib-mail/message-decoder.c, src/lib-mail
	/message-header-decode.c, src/lib-mail/message-header-parser.c, src
	/lib-mail/message-id.c, src/lib-mail/message-parser.c, src/lib-mail
	/message-part-serialize.c, src/lib-mail/message-search.c, src/lib-
	mail/message-send.c, src/lib-mail/message-size.c, src/lib-mail
	/quoted-printable.c, src/lib-mail/rfc822-parser.c, src/lib-
	settings/settings.c, src/lib-sql/driver-mysql.c, src/lib-sql/driver-
	pgsql.c, src/lib-sql/sql-api.c, src/lib-storage/index/cydir/cydir-
	mail.c, src/lib-storage/index/cydir/cydir-save.c, src/lib-
	storage/index/cydir/cydir-storage.c, src/lib-storage/index/cydir
	/cydir-sync.c, src/lib-storage/index/cydir/cydir-transaction.c, src
	/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-index.c, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox/dbox-
	storage.c, src/lib-storage/index/dbox/dbox-sync-file.c, src/lib-
	storage/index/dbox/dbox-sync-rebuild.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/dbox/dbox-transaction.c, src
	/lib-storage/index/index-fetch.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-mailbox-check.c, src/lib-storage/index/index-search.c, src
	/lib-storage/index/index-sort.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-sync-changes.c, src/lib-storage/index/index-
	sync.c, src/lib-storage/index/index-transaction.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-filename.c, src/lib-storage/index/maildir/maildir-
	keywords.c, src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-sync-
	index.c, src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-transaction.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib-storage/index/mbox/mbox-file.c, src
	/lib-storage/index/mbox/mbox-from.c, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-md5.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-sync-parse.c, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c, src/lib-storage/index/mbox
	/mbox-transaction.c, src/lib-storage/list/index-mailbox-list-sync.c,
	src/lib-storage/list/index-mailbox-list.c, src/lib-storage/list
	/mailbox-list-fs-iter.c, src/lib-storage/list/mailbox-list-fs.c, src
	/lib-storage/list/mailbox-list-maildir-iter.c, src/lib-storage/list
	/mailbox-list-maildir.c, src/lib-storage/list/mailbox-list-
	subscriptions.c, src/lib-storage/list/subscription-file.c, src/lib-
	storage/mail-copy.c, src/lib-storage/mail-error.c, src/lib-storage
	/mail-namespace.c, src/lib-storage/mail-search.c, src/lib-storage
	/mail-storage.c, src/lib-storage/mail.c, src/lib-storage/mailbox-
	list.c, src/lib-storage/mailbox-tree.c, src/lib/backtrace-string.c,
	src/lib/bsearch-insert-pos.c, src/lib/buffer.c, src/lib/close-keep-
	errno.c, src/lib/compat.c, src/lib/crc32.c, src/lib/data-stack.c,
	src/lib/env-util.c, src/lib/failures.c, src/lib/fd-close-on-exec.c,
	src/lib/fd-set-nonblock.c, src/lib/fdpass.c, src/lib/file-cache.c,
	src/lib/file-copy.c, src/lib/file-dotlock.c, src/lib/file-lock.c,
	src/lib/file-set-size.c, src/lib/hash.c, src/lib/hex-binary.c,
	src/lib/hex-dec.c, src/lib/home-expand.c, src/lib/hostpid.c,
	src/lib/imem.c, src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-
	fd.c, src/lib/ioloop-notify-inotify.c, src/lib/ioloop-notify-none.c,
	src/lib/ioloop-poll.c, src/lib/ioloop-select.c, src/lib/ioloop.c,
	src/lib/iostream.c, src/lib/istream-data.c, src/lib/istream-file.c,
	src/lib/istream-limit.c, src/lib/istream-mmap.c, src/lib/istream-
	seekable.c, src/lib/istream-tee.c, src/lib/istream.c, src/lib/lib-
	signals.c, src/lib/lib.c, src/lib/mempool-alloconly.c, src/lib
	/mempool-datastack.c, src/lib/mempool-system-clean.c, src/lib
	/mempool-system.c, src/lib/mempool-unsafe-datastack.c,
	src/lib/mempool.c, src/lib/mkdir-parents.c, src/lib/mmap-anon.c,
	src/lib/mmap-util.c, src/lib/module-dir.c, src/lib/mountpoint.c,
	src/lib/network.c, src/lib/nfs-workarounds.c, src/lib/ostream-
	crlf.c, src/lib/ostream-file.c, src/lib/ostream.c, src/lib/printf-
	format-fix.c, src/lib/process-title.c, src/lib/randgen.c, src/lib
	/read-full.c, src/lib/restrict-access.c, src/lib/restrict-process-
	size.c, src/lib/safe-memset.c, src/lib/safe-mkdir.c, src/lib/safe-
	mkstemp.c, src/lib/sendfile-util.c, src/lib/seq-range-array.c,
	src/lib/str-find.c, src/lib/str-sanitize.c, src/lib/str.c,
	src/lib/strescape.c, src/lib/strfuncs.c, src/lib/unichar.c, src/lib
	/unix-socket-create.c, src/lib/unlink-directory.c, src/lib/unlink-
	lockfiles.c, src/lib/utc-offset.c, src/lib/var-expand.c, src/lib
	/write-full.c, src/login-common/client-common.c, src/login-common
	/login-proxy.c, src/login-common/main.c, src/login-common/master.c,
	src/login-common/sasl-server.c, src/login-common/ssl-proxy-gnutls.c,
	src/login-common/ssl-proxy-openssl.c, src/login-common/ssl-proxy.c,
	src/master/askpass.c, src/master/auth-process.c, src/master/child-
	process.c, src/master/dict-process.c, src/master/dup2-array.c,
	src/master/listener.c, src/master/log.c, src/master/login-process.c,
	src/master/mail-process.c, src/master/main.c, src/master/master-
	settings.c, src/master/ssl-init-gnutls.c, src/master/ssl-init-
	main.c, src/master/ssl-init-openssl.c, src/master/ssl-init.c,
	src/master/syslog-util.c, src/plugins/acl/acl-api.c, src/plugins/acl
	/acl-backend-vfile-acllist.c, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/acl/acl-backend.c, src/plugins/acl/acl-cache.c,
	src/plugins/acl/acl-mailbox-list.c, src/plugins/acl/acl-mailbox.c,
	src/plugins/acl/acl-plugin.c, src/plugins/acl/acl-storage.c,
	src/plugins/convert/convert-plugin.c, src/plugins/convert/convert-
	storage.c, src/plugins/convert/convert-tool.c, src/plugins/expire
	/auth-client.c, src/plugins/expire/expire-env.c, src/plugins/expire
	/expire-plugin.c, src/plugins/expire/expire-tool.c, src/plugins/fts-
	lucene/fts-backend-lucene.c, src/plugins/fts-lucene/fts-lucene-
	plugin.c, src/plugins/fts-squat/fts-backend-squat.c, src/plugins
	/fts-squat/fts-squat-plugin.c, src/plugins/fts-squat/squat-test.c,
	src/plugins/fts-squat/squat-trie.c, src/plugins/fts-squat/squat-
	uidlist.c, src/plugins/fts/fts-api.c, src/plugins/fts/fts-plugin.c,
	src/plugins/fts/fts-storage.c, src/plugins/imap-quota/imap-quota-
	plugin.c, src/plugins/lazy-expunge/lazy-expunge-plugin.c,
	src/plugins/mail-log/mail-log-plugin.c, src/plugins/mbox-snarf/mbox-
	snarf-plugin.c, src/plugins/quota/quota-count.c, src/plugins/quota
	/quota-dict.c, src/plugins/quota/quota-dirsize.c, src/plugins/quota
	/quota-fs.c, src/plugins/quota/quota-maildir.c, src/plugins/quota
	/quota-plugin.c, src/plugins/quota/quota-storage.c,
	src/plugins/quota/quota.c, src/plugins/trash/trash-plugin.c,
	src/plugins/zlib/istream-zlib.c, src/plugins/zlib/zlib-plugin.c,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.c,
	src/pop3-login/pop3-proxy.c, src/pop3/client.c, src/pop3/commands.c,
	src/pop3/main.c, src/util/gdbhelper.c, src/util/idxview.c,
	src/util/listview.c, src/util/logview.c, src/util/rawlog.c:
	Replaced my Copyright notices. The year range always ends with 2007
	now. My name was replaced with "Dovecot authors". In many cases I
	didn't really even own the copyright, so this is more correct.
	[65c69a53a7be]

	* src/auth/auth-request-handler.c, src/auth/auth-request.c,
	src/auth/auth.c, src/auth/db-ldap.c, src/auth/db-passwd-file.c,
	src/auth/db-sql.c, src/auth/mech-gssapi.c, src/auth/mech-rpa.c,
	src/auth/mech.c, src/auth/otp-skey-common.c, src/deliver/deliver.c,
	src/deliver/duplicate.c, src/imap/client.c, src/imap/cmd-append.c,
	src/imap/cmd-sort.c, src/imap/cmd-thread.c, src/imap/imap-thread.c,
	src/imap/main.c, src/lib-auth/auth-server-connection.c, src/lib-dict
	/dict-client.c, src/lib-dict/dict-db.c, src/lib-dict/dict-sql.c, src
	/lib-imap/imap-parser.c, src/lib-index/mail-cache.c, src/lib-index
	/mail-index-map.c, src/lib-index/mail-index.c, src/lib-index
	/mailbox-list-index-sync.c, src/lib-mail/istream-header-filter.c,
	src/lib-mail/message-parser.c, src/lib-sql/driver-mysql.c, src/lib-
	sql/driver-sqlite.c, src/lib-storage/index/dbox/dbox-file.c, src
	/lib-storage/index/dbox/dbox-sync.c, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/mbox/mbox-sync.c, src/lib-
	storage/list/index-mailbox-list.c, src/lib-storage/list/mailbox-
	list-fs-iter.c, src/lib-storage/list/mailbox-list-fs.c, src/lib-
	storage/list/mailbox-list-maildir-iter.c, src/lib-storage/list
	/mailbox-list-maildir.c, src/lib-storage/mail-storage.c, src/lib-
	storage/mailbox-tree.c, src/lib/env-util.c, src/lib/mempool.h,
	src/lib/module-dir.c, src/master/master-settings.c, src/plugins/acl
	/acl-backend-vfile.c, src/plugins/acl/acl-cache.c,
	src/plugins/expire/expire-env.c, src/plugins/fts-squat/squat-
	uidlist.c, src/plugins/mail-log/mail-log-plugin.c,
	src/plugins/quota/quota.c, src/plugins/trash/trash-plugin.c:
	pool_unref() now takes ** pointer.
	[7cad076906eb]

	* src/deliver/duplicate.c:
	Don't crash if duplicate database contains broken entries.
	[c242677f2aa9]

	* src/lib/strfuncs.c, src/lib/strfuncs.h:
	Removed str_path() and str_ppath(). Dynamic strings are better.
	[f32ee254913d]

	* src/lib/unlink-lockfiles.c:
	Use dynamically growing string for paths.
	[382828caeb61]

	* src/auth/userdb-static.c, src/deliver/deliver.c, src/dict/dict-
	server.c, src/imap/cmd-copy.c, src/lib-imap/imap-match.c, src/lib-
	index/mail-index-transaction.c, src/lib-storage/index/index-mail-
	headers.c, src/lib/strfuncs.c, src/lib/strfuncs.h, src/plugins/acl
	/acl-backend.c, src/plugins/acl/acl-cache.c, src/plugins/convert
	/convert-storage.c, src/plugins/expire/expire-env.c:
	Renamed strarray_length/remote() to str_array_length/remove()
	[687efa138e77]

	* src/imap/imap-fetch-body.c, src/lib-mail/message-date.c, src/lib-
	mail/message-decoder.c, src/lib-storage/index/index-mail-headers.c,
	src/lib-storage/index/mbox/mbox-from.c, src/lib/strfuncs.c,
	src/lib/strfuncs.h, src/plugins/acl/acl-backend.c:
	Added i_ prefix to strcmp_p(), strcasecmp_p() and memcasecmp().
	[13b0a3ba5f7b]

	* src/auth/password-scheme-otp.c, src/imap/main.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/list/mailbox-list-
	fs-iter.c, src/lib/hostpid.c, src/lib/network.c, src/lib/process-
	title.c, src/lib/strfuncs.c, src/lib/strfuncs.h, src/login-common
	/ssl-proxy-openssl.c, src/plugins/lazy-expunge/lazy-expunge-
	plugin.c, src/pop3/main.c:
	Renamed strocpy() to i_strocpy().
	[18173a52f721]

	* src/lib/strfuncs.h:
	Removed is_empty_str() macro. Nothing used it, and it's not very
	useful anyway.
	[6fdc552c24de]

	* src/lib-index/mail-index-dummy-view.c, src/lib-index/mail-index-
	transaction-view.c, src/lib-index/mail-index-transaction.c, src/lib-
	index/mail-index-view.c, src/lib-mail/istream-header-filter.c, src
	/lib-mail/message-part-serialize.c, src/lib-sql/driver-mysql.c, src
	/lib-sql/driver-pgsql.c, src/lib-sql/driver-sqlite.c, src/lib-
	storage/index/mbox/istream-raw-mbox.c, src/lib/istream-data.c,
	src/lib/istream-file.c, src/lib/istream-limit.c, src/lib/istream-
	mmap.c, src/lib/istream-seekable.c, src/lib/istream-tee.c,
	src/lib/istream.c, src/lib/ostream-crlf.c, src/lib/ostream-file.c,
	src/lib/sha1.c, src/lib/strfuncs.c, src/plugins/zlib/istream-zlib.c:
	Removed _ prefixes from function names.
	[a8b515e1a26f]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib/iostream.c, src/lib/istream-data.c,
	src/lib/istream-limit.c, src/lib/ostream-crlf.c:
	If iostream.close/destroy isn't set by the stream implementation,
	use a default no-op function.
	[3a960ffa5de8]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-examine.c, src/imap/cmd-list.c, src/imap/cmd-lsub.c,
	src/imap/cmd-select.c, src/imap/cmd-subscribe.c, src/imap/cmd-
	unsubscribe.c, src/imap/commands.h, src/lib-imap/imap-parser.c, src
	/lib-imap/imap-parser.h, src/lib/imem.c, src/lib/strfuncs.c,
	src/lib/strfuncs.h, src/master/ssl-init-gnutls.c, src/master/ssl-
	init-main.c, src/master/ssl-init-openssl.c, src/master/ssl-init.h,
	src/plugins/fts-squat/squat-test.c, src/plugins/fts-squat/squat-
	trie.c, src/plugins/fts-squat/squat-trie.h, src/plugins/fts-squat
	/squat-uidlist.c:
	Removed _ prefix from all public APIs.
	[46d9ee79f292]

	* src/auth/auth-cache.c, src/auth/auth-request-handler.c, src/auth/db-
	ldap.c, src/auth/db-passwd-file.c, src/auth/passdb-checkpassword.c,
	src/deliver/duplicate.c, src/dict/dict-cache.c, src/imap-
	login/client.c, src/imap/imap-thread.c, src/lib-auth/auth-server-
	connection.c, src/lib-auth/auth-server-request.c, src/lib-index
	/mail-cache.c, src/lib-index/mail-index.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/maildir
	/maildir-keywords.c, src/lib-storage/index/maildir/maildir-
	uidlist.c, src/lib/hash.c, src/lib/hash.h, src/login-common/login-
	proxy.c, src/login-common/master.c, src/login-common/ssl-proxy-
	openssl.c, src/master/auth-process.c, src/master/child-process.c,
	src/master/login-process.c, src/master/mail-process.c,
	src/plugins/acl/acl-cache.c, src/pop3-login/client.c:
	hash_destroy() and hash_iterate_deinit() now take ** pointer.
	[047d0d8bbf0a]

	* src/lib/array.h, src/lib/module-context.h:
	Renamed _array_*() to array_*_i()
	[298e651e18de]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib/iostream-internal.h,
	src/lib/iostream.c, src/lib/istream-data.c, src/lib/istream-file.c,
	src/lib/istream-internal.h, src/lib/istream-limit.c, src/lib
	/istream-mmap.c, src/lib/istream-seekable.c, src/lib/istream-tee.c,
	src/lib/istream.c, src/lib/istream.h, src/lib/ostream-crlf.c,
	src/lib/ostream-file.c, src/lib/ostream-internal.h,
	src/lib/ostream.c, src/lib/ostream.h, src/plugins/zlib/istream-
	zlib.c:
	Renamed struct _[io]stream to struct [io]stream_private. Also
	removed _ prefix from _[io]stream_*() functions.
	[b0096861c390]

	* src/auth/auth-request-handler.c, src/auth/auth-worker-server.c,
	src/auth/mech-rpa.c, src/auth/password-scheme-rpa.c, src/lib-auth
	/auth-client.c, src/lib-auth/auth-server-connection.c, src/lib-index
	/mail-cache-compress.c, src/lib-index/mail-cache-transaction.c, src
	/lib-index/mail-cache.c, src/lib-index/mail-index-fsck.c, src/lib-
	index/mail-index-map.c, src/lib-index/mail-index-sync-ext.c, src
	/lib-index/mail-index-sync-update.c, src/lib-index/mail-transaction-
	log-append.c, src/lib-index/mail-transaction-log-file.c, src/lib-
	index/mailbox-list-index-sync.c, src/lib-mail/message-decoder.c, src
	/lib-mail/message-header-parser.c, src/lib-ntlm/ntlm-encrypt.c, src
	/lib-ntlm/ntlm-message.c, src/lib-storage/index/index-mail.c,
	src/lib/array.h, src/lib/buffer.c, src/lib/buffer.h, src/lib/file-
	cache.c, src/lib/istream-seekable.c, src/lib/str.c, src/plugins/fts-
	squat/squat-trie.c, src/plugins/fts-squat/squat-uidlist.c,
	src/pop3/client.c:
	Changed buffer_free() and buffer_free_without_data() APIs to take **
	pointer which is set to NULL instead of hiding it with a macro.
	[a6a49d5efc59]

	* src/plugins/quota/Makefile.am:
	__attr_unused__ -> ATTR_UNUSED
	[a991fa000b20]

	* src/lib-ntlm/ntlm-message.c, src/lib-ntlm/ntlm.h, src/lib-
	storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/mbox/mbox-sync.c, src/plugins/trash/trash-plugin.c:
	Get rid of __ prefixes.
	[8ebc07d2eee9]

	* src/auth/auth-cache.c, src/auth/auth-request-handler.c, src/auth
	/auth-request.c, src/auth/auth-request.h, src/auth/auth-worker-
	server.c, src/auth/db-ldap.c, src/auth/db-passwd-file.c,
	src/auth/main.c, src/auth/mech-cram-md5.c, src/auth/mech-digest-
	md5.c, src/auth/mech-winbind.c, src/auth/passdb-bsdauth.c, src/auth
	/passdb-checkpassword.c, src/auth/passdb-ldap.c, src/auth/passdb-
	passwd-file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c,
	src/auth/passdb-sia.c, src/auth/passdb-sql.c, src/auth/passdb-
	vpopmail.c, src/auth/password-scheme.c, src/auth/userdb-ldap.c,
	src/auth/userdb-passwd-file.c, src/auth/userdb-sql.c, src/auth
	/userdb-static.c, src/deliver/deliver.c, src/deliver/smtp-client.c,
	src/dict/main.c, src/imap-login/client.c, src/imap/client.c,
	src/imap/imap-fetch-body.c, src/imap/imap-fetch.c, src/imap/mail-
	storage-callbacks.c, src/imap/main.c, src/lib-charset/charset-
	utf8.c, src/lib-dict/dict-db.c, src/lib-dict/dict-sql.c, src/lib-
	imap/imap-parser.c, src/lib-imap/imap-parser.h, src/lib-index/mail-
	cache-sync-update.c, src/lib-index/mail-cache.h, src/lib-index/mail-
	index-dummy-view.c, src/lib-index/mail-index-fsck.c, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index-sync-private.h, src
	/lib-index/mail-index-view.c, src/lib-index/mail-transaction-log-
	private.h, src/lib-index/mail-transaction-log.h, src/lib-mail
	/istream-header-filter.c, src/lib-mail/message-parser.c, src/lib-sql
	/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql/driver-
	sqlite.c, src/lib-sql/sql-api.c, src/lib-storage/index/cydir/cydir-
	save.c, src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox/dbox-
	storage.c, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-util.c, src/lib-
	storage/index/mbox/istream-raw-mbox.c, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/list
	/mailbox-list-fs.c, src/lib-storage/list/mailbox-list-maildir.c, src
	/lib-storage/mail-storage-private.h, src/lib-storage/mailbox-list-
	private.h, src/lib-storage/mailbox-list.c, src/lib/backtrace-
	string.c, src/lib/data-stack.c, src/lib/data-stack.h,
	src/lib/failures.c, src/lib/failures.h, src/lib/fdpass.c,
	src/lib/imem.h, src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-
	none.c, src/lib/istream-data.c, src/lib/istream-file.c, src/lib
	/istream-limit.c, src/lib/istream-mmap.c, src/lib/istream-
	seekable.c, src/lib/istream-tee.c, src/lib/istream.c, src/lib/lib-
	signals.c, src/lib/macros.h, src/lib/mempool-alloconly.c, src/lib
	/mempool-datastack.c, src/lib/mempool-system-clean.c, src/lib
	/mempool-system.c, src/lib/mempool-unsafe-datastack.c,
	src/lib/mempool.h, src/lib/mmap-anon.c, src/lib/mmap-util.c, src/lib
	/mmap-util.h, src/lib/module-dir.c, src/lib/network.c, src/lib/nfs-
	workarounds.c, src/lib/ostream-crlf.c, src/lib/printf-format-fix.h,
	src/lib/process-title.c, src/lib/restrict-process-size.c, src/lib
	/sendfile-util.c, src/lib/str.h, src/lib/strfuncs.h, src/lib/utc-
	offset.c, src/lib/var-expand.c, src/login-common/main.c, src/login-
	common/master.c, src/login-common/ssl-proxy-gnutls.c, src/login-
	common/ssl-proxy-openssl.c, src/login-common/ssl-proxy.c, src/master
	/auth-process.c, src/master/child-process.c, src/master/dict-
	process.c, src/master/log.c, src/master/login-process.c, src/master
	/mail-process.c, src/master/mail-process.h, src/master/main.c,
	src/master/master-settings.c, src/master/ssl-init-main.c, src/master
	/ssl-init.c, src/plugins/acl/acl-backend-vfile.c, src/plugins/fts-
	lucene/fts-backend-lucene.c, src/plugins/fts-squat/fts-backend-
	squat.c, src/plugins/fts-squat/squat-test.c, src/plugins/lazy-
	expunge/lazy-expunge-plugin.c, src/plugins/quota/quota-dict.c,
	src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-fs.c,
	src/plugins/quota/quota-maildir.c, src/plugins/quota/quota.c,
	src/plugins/zlib/istream-zlib.c, src/pop3-login/client-
	authenticate.c, src/pop3-login/client.c, src/pop3/client.c,
	src/pop3/client.h, src/pop3/commands.c, src/pop3/main.c,
	src/util/dovecotpw.c, src/util/listview.c:
	Renamed __attr_*__ to ATTR_*. Renamed __attrs_used__ to
	ATTRS_DEFINED.
	[6a64e64fa3a3]

	* src/auth/auth-cache.h, src/auth/auth-client-connection.h, src/auth
	/auth-client-interface.h, src/auth/auth-master-connection.h,
	src/auth/auth-master-interface.h, src/auth/auth-master-listener.h,
	src/auth/auth-request-handler.h, src/auth/auth-request.h, src/auth
	/auth-stream.h, src/auth/auth-worker-client.h, src/auth/auth-worker-
	server.h, src/auth/auth.h, src/auth/common.h, src/auth/db-ldap.h,
	src/auth/db-passwd-file.h, src/auth/db-sql.h, src/auth/mech.h,
	src/auth/mycrypt.h, src/auth/otp-skey-common.h, src/auth/passdb-
	blocking.h, src/auth/passdb-cache.h, src/auth/passdb.h, src/auth
	/password-scheme.h, src/auth/plain-common.h, src/auth/userdb-
	blocking.h, src/auth/userdb-static.h, src/auth/userdb-vpopmail.h,
	src/auth/userdb.h, src/deliver/auth-client.h, src/deliver/deliver.h,
	src/deliver/duplicate.h, src/deliver/mail-send.h, src/deliver/smtp-
	client.h, src/dict/dict-cache.h, src/dict/dict-server.h, src/imap-
	login/client-authenticate.h, src/imap-login/client.h, src/imap-login
	/imap-proxy.h, src/imap/client.h, src/imap/commands-util.h,
	src/imap/commands.h, src/imap/common.h, src/imap/imap-expunge.h,
	src/imap/imap-fetch.h, src/imap/imap-messageset.h, src/imap/imap-
	search.h, src/imap/imap-sort.h, src/imap/imap-status.h, src/imap
	/imap-sync.h, src/imap/imap-thread.h, src/lib-auth/auth-client.h,
	src/lib-auth/auth-server-connection.h, src/lib-auth/auth-server-
	request.h, src/lib-charset/charset-utf8.h, src/lib-dict/dict-
	client.h, src/lib-dict/dict-private.h, src/lib-dict/dict-sql.h, src
	/lib-dict/dict.h, src/lib-imap/imap-base-subject.h, src/lib-imap
	/imap-bodystructure.h, src/lib-imap/imap-date.h, src/lib-imap/imap-
	envelope.h, src/lib-imap/imap-match.h, src/lib-imap/imap-parser.h,
	src/lib-imap/imap-quote.h, src/lib-imap/imap-util.h, src/lib-index
	/mail-cache-private.h, src/lib-index/mail-cache.h, src/lib-index
	/mail-hash.h, src/lib-index/mail-index-private.h, src/lib-index
	/mail-index-sync-private.h, src/lib-index/mail-index-transaction-
	private.h, src/lib-index/mail-index-view-private.h, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log-private.h, src
	/lib-index/mail-transaction-log.h, src/lib-index/mailbox-list-index-
	private.h, src/lib-index/mailbox-list-index.h, src/lib-mail/istream-
	header-filter.h, src/lib-mail/mail-types.h, src/lib-mail/message-
	address.h, src/lib-mail/message-date.h, src/lib-mail/message-
	decoder.h, src/lib-mail/message-header-decode.h, src/lib-mail
	/message-header-parser.h, src/lib-mail/message-id.h, src/lib-mail
	/message-parser.h, src/lib-mail/message-part-serialize.h, src/lib-
	mail/message-search.h, src/lib-mail/message-send.h, src/lib-mail
	/message-size.h, src/lib-mail/quoted-printable.h, src/lib-
	mail/rfc822-parser.h, src/lib-ntlm/ntlm-byteorder.h, src/lib-ntlm
	/ntlm-des.h, src/lib-ntlm/ntlm-encrypt.h, src/lib-ntlm/ntlm-flags.h,
	src/lib-ntlm/ntlm-message.h, src/lib-ntlm/ntlm-types.h, src/lib-
	ntlm/ntlm.h, src/lib-otp/otp-dictionary.h, src/lib-otp/otp-hash.h,
	src/lib-otp/otp-parity.h, src/lib-otp/otp-parse.h, src/lib-
	otp/otp.h, src/lib-settings/settings.h, src/lib-sql/sql-api-
	private.h, src/lib-sql/sql-api.h, src/lib-storage/index/cydir/cydir-
	storage.h, src/lib-storage/index/cydir/cydir-sync.h, src/lib-
	storage/index/dbox/dbox-file.h, src/lib-storage/index/dbox/dbox-
	index.h, src/lib-storage/index/dbox/dbox-storage.h, src/lib-
	storage/index/dbox/dbox-sync.h, src/lib-storage/index/index-mail.h,
	src/lib-storage/index/index-sort.h, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-sync-changes.h, src/lib-
	storage/index/maildir/maildir-filename.h, src/lib-
	storage/index/maildir/maildir-keywords.h, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.h, src/lib-storage/index/maildir
	/maildir-uidlist.h, src/lib-storage/index/mbox/istream-raw-mbox.h,
	src/lib-storage/index/mbox/mbox-file.h, src/lib-storage/index/mbox
	/mbox-from.h, src/lib-storage/index/mbox/mbox-lock.h, src/lib-
	storage/index/mbox/mbox-md5.h, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/list/index-mailbox-list.h, src/lib-storage/list/mailbox-
	list-fs.h, src/lib-storage/list/mailbox-list-maildir.h, src/lib-
	storage/list/mailbox-list-subscriptions.h, src/lib-storage/list
	/subscription-file.h, src/lib-storage/mail-copy.h, src/lib-storage
	/mail-error.h, src/lib-storage/mail-namespace.h, src/lib-storage
	/mail-search.h, src/lib-storage/mail-storage-private.h, src/lib-
	storage/mail-storage.h, src/lib-storage/mailbox-list-private.h, src
	/lib-storage/mailbox-list.h, src/lib-storage/mailbox-tree.h, src/lib
	/array-decl.h, src/lib/array.h, src/lib/backtrace-string.h,
	src/lib/base64.h, src/lib/bsearch-insert-pos.h, src/lib/buffer.h,
	src/lib/close-keep-errno.h, src/lib/compat.h, src/lib/crc32.h,
	src/lib/data-stack.h, src/lib/env-util.h, src/lib/failures.h,
	src/lib/fd-close-on-exec.h, src/lib/fd-set-nonblock.h,
	src/lib/fdpass.h, src/lib/file-cache.h, src/lib/file-copy.h, src/lib
	/file-dotlock.h, src/lib/file-lock.h, src/lib/file-set-size.h,
	src/lib/hash.h, src/lib/hex-binary.h, src/lib/hex-dec.h, src/lib
	/hmac-md5.h, src/lib/home-expand.h, src/lib/hostpid.h,
	src/lib/imem.h, src/lib/ioloop-internal.h, src/lib/ioloop-iolist.h,
	src/lib/ioloop-notify-fd.h, src/lib/ioloop.h, src/lib/iostream-
	internal.h, src/lib/istream-internal.h, src/lib/istream-seekable.h,
	src/lib/istream-tee.h, src/lib/istream.h, src/lib/lib-signals.h,
	src/lib/lib.h, src/lib/macros.h, src/lib/md4.h, src/lib/md5.h,
	src/lib/mempool.h, src/lib/mkdir-parents.h, src/lib/mmap-util.h,
	src/lib/module-context.h, src/lib/module-dir.h,
	src/lib/mountpoint.h, src/lib/network.h, src/lib/nfs-workarounds.h,
	src/lib/ostream-crlf.h, src/lib/ostream-internal.h,
	src/lib/ostream.h, src/lib/primes.h, src/lib/printf-format-fix.h,
	src/lib/process-title.h, src/lib/randgen.h, src/lib/read-full.h,
	src/lib/restrict-access.h, src/lib/restrict-process-size.h, src/lib
	/safe-memset.h, src/lib/safe-mkdir.h, src/lib/safe-mkstemp.h,
	src/lib/sendfile-util.h, src/lib/seq-range-array.h, src/lib/sha1.h,
	src/lib/str-find.h, src/lib/str-sanitize.h, src/lib/str.h,
	src/lib/strescape.h, src/lib/strfuncs.h, src/lib/unichar.h, src/lib
	/unix-socket-create.h, src/lib/unlink-directory.h, src/lib/unlink-
	lockfiles.h, src/lib/utc-mktime.h, src/lib/utc-offset.h, src/lib
	/var-expand.h, src/lib/write-full.h, src/login-common/client-
	common.h, src/login-common/common.h, src/login-common/login-proxy.h,
	src/login-common/master.h, src/login-common/sasl-server.h, src
	/login-common/ssl-proxy.h, src/master/askpass.h, src/master/auth-
	process.h, src/master/capabilities.h, src/master/child-process.h,
	src/master/common.h, src/master/dict-process.h,
	src/master/dup2-array.h, src/master/listener.h, src/master/log.h,
	src/master/login-process.h, src/master/mail-process.h, src/master
	/master-login-interface.h, src/master/master-settings.h, src/master
	/ssl-init.h, src/master/syslog-util.h, src/plugins/acl/acl-api-
	private.h, src/plugins/acl/acl-api.h, src/plugins/acl/acl-backend-
	vfile.h, src/plugins/acl/acl-cache.h, src/plugins/acl/acl-plugin.h,
	src/plugins/convert/convert-plugin.h, src/plugins/convert/convert-
	storage.h, src/plugins/expire/auth-client.h, src/plugins/expire
	/expire-env.h, src/plugins/expire/expire-plugin.h, src/plugins/fts-
	lucene/fts-lucene-plugin.h, src/plugins/fts-lucene/lucene-wrapper.h,
	src/plugins/fts-squat/fts-squat-plugin.h, src/plugins/fts-squat
	/squat-trie-private.h, src/plugins/fts-squat/squat-trie.h,
	src/plugins/fts-squat/squat-uidlist.h, src/plugins/fts/fts-api-
	private.h, src/plugins/fts/fts-api.h, src/plugins/fts/fts-plugin.h,
	src/plugins/imap-quota/imap-quota-plugin.h, src/plugins/lazy-expunge
	/lazy-expunge-plugin.h, src/plugins/mail-log/mail-log-plugin.h,
	src/plugins/mbox-snarf/mbox-snarf-plugin.h, src/plugins/quota/quota-
	fs.h, src/plugins/quota/quota-plugin.h, src/plugins/quota/quota-
	private.h, src/plugins/quota/quota.h, src/plugins/trash/trash-
	plugin.h, src/plugins/zlib/istream-zlib.h, src/plugins/zlib/zlib-
	plugin.h, src/pop3-login/client-authenticate.h,
	src/pop3-login/client.h, src/pop3-login/pop3-proxy.h,
	src/pop3/capability.h, src/pop3/client.h, src/pop3/commands.h,
	src/pop3/common.h:
	Changed .h ifdef/defines to use <NAME>_H format.
	[e4eb71ae8e96]

	* src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-keywords.h, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-sync-
	index.c, src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	Changed *_deinit() APIs to take ** pointer and set it to NULL.
	[7f733ba453bf]

	* src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-keywords.h, src/lib-
	storage/index/maildir/maildir-storage.c:
	Added maildir_keywords_init_readonly() which can be used to read the
	keywords file from non-maildir mailboxes.
	[17ec931b51d7]

	* src/lib-index/mail-cache.c:
	Don't bother complaining about indexid changes. The real reason for
	the change was most likely logged already, and the "indexid changed"
	error just confuses people.
	[1deb160e5fbb]

2007-09-15  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	Crashfix if both imap and pop3 protocols weren't enabled.
	[ef2170079575]

	* dovecot-example.conf:
	Updated mailbox_idle_check_interval comments.
	[64c9cc85a1b4]

	* .hgtags:
	Added tag 1.1.alpha5 for changeset 77e556a67719
	[0aaf629373d1]

	* configure.in:
	Released v1.1.alpha5.
	[77e556a67719] [1.1.alpha5]

	* TODO:
	Updated
	[31f374bcbd31]

	* dovecot-example.conf, src/master/master-settings.c:
	Dropped default max_mail_processes to 512.
	[1eff337eade3]

	* src/master/mail-process.c:
	Use the default fd limit for mail processes.
	[ec5bb5ab7ac2]

	* src/master/master-settings.c:
	Error message fix.
	[91db6ee4de5e]

	* src/master/master-settings.c:
	Calculate how many log fds login+mail processes can use. If it's
	lower than the current fd limit, log a warning.
	[e41718b974d2]

	* src/master/main.c:
	Don't grow fd limit ourself.
	[08eaa53f1aaa]

	* src/master/login-process.c:
	Calculate needed fd count better. Make sure we have one unused fd
	available when exec()ing so it doesn't fail.
	[1b21dfee7bd7]

	* src/lib/restrict-process-size.c, src/lib/restrict-process-size.h:
	Removed restrict_raise_fd_limit().
	[1622e332c8ae]

	* dovecot-example.conf, src/auth/db-passwd-file.c, src/auth/db-passwd-
	file.h, src/auth/passdb-passwd-file.c, src/auth/userdb-passwd-
	file.c:
	Added username_format parameter for passwd-file passdb and userdb.
	[9e74c008484a]

	* src/lib-storage/index/cydir/cydir-save.c, src/lib-storage/index/dbox
	/dbox-save.c:
	set save_ctx.transaction=NULL so we don't accidentally try to use
	it.
	[777fede4d899]

	* src/lib-storage/index/maildir/maildir-save.c:
	Don't access freed memory. Caused crashes sometimes.
	[799b6c593cad]

	* src/imap/client.c:
	If connection closed because of EPIPE, log it as "Connection closed"
	instead of including "Broken pipe", which gets people worried.
	[c5cff3c6828a]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index.c:
	Fix ESTALE handling when reading main index.
	[ff48b008150f]

	* src/lib-index/mail-index-sync-update.c:
	write_seq_first/last wasn't updated correctly when appending
	messages, causing "messages_count too large" errors.
	[abbea4e5c128]

	* src/lib-index/mail-index-view.c:
	mail_index_view_clone() needs to copy inconsistency_id.
	[78b9315ed5ff]

	* src/lib-storage/index/index-mail.c:
	If view is inconsistent, keep mail->seq valid anyway.
	[15defb570164]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-map.c, src
	/lib-index/mail-index-private.h:
	fsck fixes now keyword header problems
	[1d993d28e12f]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-map.c, src
	/lib-index/mail-index-private.h:
	If extension header is broken, drop it when fscking.
	[9dde743dfbc1]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index.c:
	Make sure the extension name doesn't contain control characters. It
	most likely means the extension header is corrupted.
	[2c8b1d487728]

	* src/lib/str-sanitize.c:
	Convert also 0x80..0x9f characters to '?'
	[6d5c3ce9426c]

	* src/lib-index/mail-index-fsck.c:
	Code cleanup
	[950e34795fbc]

	* src/lib-index/mail-index-fsck.c:
	Code cleanups
	[3ea531c2bf63]

	* src/lib-index/mail-index-map.c:
	Crashfix when fscking.
	[12e12b15f6e3]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-map.c, src
	/lib-index/mail-index.h:
	Removed MAIL_INDEX_HDR_FLAG_FSCK. It's not used anymore.
	[b734f6cf4bd8]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index.c:
	Moved mail_index_map_parse_keywords() to mail-index-map.c
	[12d4b757b825]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-map.c, src
	/lib-index/mail-index-private.h, src/lib-index/mail-index-sync.c,
	src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-
	index.h:
	fsck won't fail anymore with "corrupted index", all problems are
	fixed. Added mail_index_fsck_locked().
	[29f427039e00]

	* src/lib-storage/index/index-mail.c:
	If view is inconsistent, show the mail as expunged.
	[9b9436231ce0]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index.c:
	fsck the index while it's being mapped.
	[fc2f5607108d]

	* src/lib-index/mail-index-map.c:
	If hdr.messages_count is too large, fix it with fsck instead of
	treating the index completely corrupted.
	[0a90044b42c9]

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	keywords.c, src/lib-index/mail-index-sync-private.h:
	Make sure extensions updates don't modify keywords.
	[06818dd6a952]

	* src/lib-index/mail-index.c:
	Drop also exclusive locks when closing index files (there shouldn't
	be any though).
	[f33ea6ff46ea]

	* src/lib-index/mail-index.c:
	NFS: If index has been deleted, close the index properly before
	reopening it.
	[8468e3babea2]

2007-09-11  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c:
	And a fix for last LDAP lookup changes.
	[b755957098cd]

2007-09-10  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c:
	Actually reconnect always if ldap_result() fails for any reason.
	There really aren't any other choices.
	[f7cc3723ad99]

	* src/auth/db-ldap.c:
	Reconnect if ldap_search() returns a failure related to connection
	problems. Also if ldap_result() doesn't return a connection related
	failure, don't reconnect.
	[a930c2ecd73c]

2007-09-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mailbox-list-index-sync.c:
	Fix for mmap_disable=yes
	[b5dd8d64b4ae]

	* src/lib-storage/index/maildir/maildir-storage.c:
	When creating mailboxes, set cur/new/tmp directories' group to
	dovecot-shared file's group.
	[1c90552923ba]

	* src/deliver/auth-client.c:
	Use mail_extra_groups setting.
	[dee75c83d6f4]

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c,
	src/master/login-process.c, src/master/master-settings-defs.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added ssl_cert_username_field setting.
	[7ad61f00ee55]

	* src/lib/module-dir.c:
	Instead of exit()ing directly if loading plugins fail, use i_fatal()
	so failure_callback can be called.
	[2b6e69bda3ec]

	* src/plugins/quota/quota-dirsize.c:
	If INBOX is a substring of already added path, don't assert-crash.
	Also fixed handling cases where parent directory was added while its
	multiple children were already added (probably never happened).
	[ad46cb956a0a]

	* src/deliver/deliver.c:
	Added -k parameter to preserve environment. Normally everything but
	TZ and HOME are dropped.
	[7f6c99dc1f17]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-lock.c, src
	/lib-index/mail-index-private.h, src/lib-index/mail-transaction-log-
	file.c, src/lib-index/mail-transaction-log-private.h, src/lib-index
	/mail-transaction-log.c:
	Replaced MAIL_INDEX_LOCK_SECS usage with cache/index/log specific
	defines which are common with dotlocks.
	[461ae76c84da]

	* src/lib-index/mail-index.c:
	Fixed opening indexes to memory.
	[c54c07f30a97]

	* src/deliver/auth-client.c, src/deliver/deliver.c:
	Fixed home directory handling which got broken by previous changes.
	[6bd13d514294]

2007-09-08  Timo Sirainen  <tss@iki.fi>

	* .hgtags:
	Added tag 1.1.alpha4 for changeset f4fa0970f855
	[a445f128744e]

	* configure.in:
	Released v1.1.alpha4.
	[f4fa0970f855] [1.1.alpha4]

	* src/imap/imap-sync.c:
	Fixed infinite loop if a transaction was seen for messages that
	weren't visible in this session yet.
	[08ee6385e7a9]

2007-09-02  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c, src/imap/cmd-append.c, src/imap/cmd-copy.c,
	src/imap/cmd-store.c, src/lib-index/mail-index-sync.c, src/lib-index
	/mail-index-transaction.c, src/lib-index/mail-index.h, src/lib-
	storage/index/dbox/dbox-sync-file.c, src/lib-storage/index/dbox
	/dbox-sync-rebuild.c, src/lib-storage/index/index-storage.c, src
	/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-sync-index.c, src/lib-storage/index/mbox/mbox-sync.c, src
	/lib-storage/mail-storage-private.h, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h, src/plugins/convert/convert-
	storage.c:
	Changed mail_keywords creation APIs to take mailbox/index instead of
	transaction.
	[8476d665530f]

	* src/deliver/deliver.c, src/imap/cmd-append.c, src/imap/cmd-copy.c,
	src/imap/cmd-store.c, src/imap/commands-util.c, src/imap/common.h,
	src/imap/main.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/mbox/mbox-sync-
	parse.c, src/lib-storage/mail-storage-private.h, src/lib-storage
	/mail-storage.c, src/lib-storage/mail-storage.h, src/plugins/convert
	/convert-storage.c:
	mailbox_keywords_create() checks keyword validity now and returns
	failure if any of them are invalid. Added
	mailbox_keywords_create_valid() that only drops invalid keywords.
	Removed mbox and IMAP-specific keyword checks, they all use the same
	checking now.
	[23c9ac999578]

	* src/lib-index/mail-index-transaction.c:
	mail_index_keywords_create*() now drops duplicates.
	[0f1a4b7b39a3]

	* src/lib-imap/imap-parser.c, src/lib-imap/imap-parser.h:
	Renamed IS_ATOM_SPECIAL() to IS_ATOM_SPECIAL_INPUT() and added a new
	IS_ATOM_SPECIAL() that contains all of the specials.
	[1d2b67440878]

	* src/lib-index/mail-index.c:
	Added assert against empty keyword.
	[e7f61751822e]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-view.c, src/lib-index/mail-
	index.c:
	Cleaned up keyword handling code.
	[75c814287334]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	keywords.c, src/lib-index/mail-index-sync-private.h, src/lib-index
	/mail-index-sync-update.c, src/lib-index/mail-index.c:
	Only index extension indexes are now called "ext_id". For map
	extension indexes use "map_ext_idx".
	[ef1c7b2acc10]

	* src/lib-index/mail-index-sync-ext.c:
	If extension introduction is broken, don't log errors about
	following extensions updates.
	[aeaaaaeb64a6]

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync-update.c:
	Complain about unknown extension introduction IDs in log only once
	per sync.
	[5dcd55d1a47f]

	* src/lib-index/mail-index-fsck.c:
	Don't bother complaining about changed log offsets if file also
	changed.
	[1829e8e32ddc]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Added asserts against uid_validity==0.
	[e45ba2950722]

	* src/lib-index/mail-index-map.c:
	Don't treat uid_validity=0 && next_uid!=1 as a corrupted index. fsck
	fixes it.
	[c76101b824ec]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-update.c:
	Check that header is still valid after syncing. If not, fsck.
	[702f13f44c5e]

2007-09-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	When initial index build wrote dovecot.index file, we assert-
	crashed.
	[adffeec04dcc]

	* src/lib-storage/index/dbox/Makefile.am, src/lib-storage/index/dbox
	/dbox-file.c, src/lib-storage/index/dbox/dbox-file.h, src/lib-
	storage/index/dbox/dbox-format.h, src/lib-storage/index/dbox/dbox-
	index.c, src/lib-storage/index/dbox/dbox-index.h, src/lib-
	storage/index/dbox/dbox-keywords.c, src/lib-storage/index/dbox/dbox-
	keywords.h, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox/dbox-
	storage.c, src/lib-storage/index/dbox/dbox-storage.h, src/lib-
	storage/index/dbox/dbox-sync-expunge.c, src/lib-storage/index/dbox
	/dbox-sync-file.c, src/lib-storage/index/dbox/dbox-sync-full.c, src
	/lib-storage/index/dbox/dbox-sync-rebuild.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox/dbox-
	sync.h, src/lib-storage/index/dbox/dbox-transaction.c, src/lib-
	storage/index/dbox/dbox-uidlist.c, src/lib-storage/index/dbox/dbox-
	uidlist.h:
	Initial commit for dbox redesign/rewrite. Currently supports only
	one message per file mode.
	[7b71ba1250e3]

	* src/lib-storage/index/mbox/mbox-save.c:
	Fixes to saving mails
	[301d0f8e4f91]

	* src/imap/cmd-append.c:
	If append fails because input EOF, disconnect the client with EOF
	reason.
	[bfb6aeddef9b]

	* src/lib-storage/index/mbox/mbox-save.c:
	Fixes to saving messages.
	[83357f65cca4]

2007-08-31  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	mail_index_transaction_sort_appends() fixed to work with keywords
	(dbox-only problem)
	[f2815306ccda]

	* src/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h, src/lib-storage/index/dbox/dbox-keywords.c, src/lib-
	storage/index/maildir/maildir-keywords.c, src/lib-storage/index/mbox
	/mbox-sync-parse.c:
	Removed autocreate parameter from mail_index_keyword_lookup(). Added
	a new mail_index_keyword_lookup_or_create().
	[a1c587d3d633]

	* src/lib-storage/index/mbox/mbox-storage.c:
	If syncing failed when closing mailbox, we didn't return error as we
	should have.
	[e6d16b1b5e81]

	* src/lib-index/mail-index-map.c:
	If v1.1 index is accessed with v1.0, avoid recent message counter
	errors.
	[d815c115ade6]

2007-08-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index.h, src
	/lib-index/mailbox-list-index-sync.c, src/lib-storage/index/cydir
	/cydir-sync.c, src/lib-storage/index/dbox/dbox-save.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/maildir
	/maildir-sync-index.c, src/lib-storage/index/mbox/mbox-sync.c, src
	/lib-storage/list/index-mailbox-list-sync.c:
	Renamed mail_index_sync_begin() to mail_index_sync_begin_to() and
	added a new mail_index_sync_begin() without seq/offset parameters.
	[aa4a78b3c626]

2007-08-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync.c,
	src/lib-index/mail-transaction-log.c:
	If we notice that dovecot.index.log gets deleted, make sure that
	dovecot.index gets written in next sync in case it was also deleted.
	[081fd0acddd2]

	* src/lib-index/mail-index.c:
	Error message change.
	[438346345893]

	* src/lib-storage/index/maildir/maildir-keywords.c:
	Ignore entries with empty keyword names.
	[7d8825366e80]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Error handling fixes.
	[29d249982282]

	* src/lib-index/mail-transaction-log.c:
	If transaction log is deleted under us, recreate it immediately.
	[b8b02d155599]

	* src/lib-index/mail-index-sync-update.c:
	Don't assert-crash if uidvalidity wasn't set in first sync.
	[3d7b93aef6b3]

	* src/lib-index/mail-index-sync-keywords.c:
	Added an assert
	[3d48109409bf]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index.c:
	Parse keywords from header immediately when mapping the index file.
	[1b0db9d04b2e]

	* src/lib-index/mail-index-sync-keywords.c:
	Log an error if empty keyword name is tried to be used.
	[4a6dd4e894b4]

	* src/lib-index/mail-index.c:
	Handle opening corrupted index files better.
	[8d9a156ec94e]

	* src/lib-index/mail-index.c:
	Don't allow empty keywords.
	[840bd34df909]

	* src/lib-index/mail-index-sync-keywords.c:
	If keyword ext record is missing, log an error instead of assert-
	crashing.
	[58b6fb965e62]

	* src/lib-index/mail-cache-compress.c:
	Minor memory usage optimizations.
	[c2c8ee636157]

	* src/imap/cmd-list.c:
	Don't crash if mailbox named INBOX is listed in prefixless
	namespace, but which doesn't have inbox=yes. Instead the mailbox is
	simply not listed.
	[5313cbcfccc6]

2007-08-24  Timo Sirainen  <tss@iki.fi>

	* src/deliver/auth-client.c, src/deliver/auth-client.h,
	src/deliver/deliver.c:
	Extra fields from userdb lookup should override everything. Fixed
	the code to work the same way as master process handles it, so there
	should be no more differences.
	[3cee177eced6]

	* src/lib/array-decl.h:
	Added string (char *) array type.
	[fcd14b4cf941]

	* src/lib/restrict-process-size.c:
	restrict_raise_fd_limit() fixes
	[5ebf96e37a39]

	* src/lib/restrict-process-size.c, src/lib/restrict-process-size.h:
	Added restrict_fd_limit() and restrict_raise_fd_limit()
	[c6d6ce742a82]

	* dovecot-example.conf, src/master/login-process.c, src/master/mail-
	process.c, src/master/main.c:
	Grow file descriptors to 64k at startup, and drop them for login and
	imap processes.
	[0e08960275f8]

	* src/pop3/client.c:
	Fix to last change: Don't continue if we can't get message's size.
	[05aabdc581b1]

	* src/pop3/client.c:
	Handle initial syncing errors better.
	[e84fad8d3987]

	* src/imap/client.c:
	Changed disconnection reason to "Connection closed"
	[15e10065a472]

	* src/imap/client.c:
	If read/write to client failed with some error, log it.
	[f8c9b1a93521]

2007-08-22  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/Makefile.am:
	Use sed instead of $(SED). sed should work everywhere anyway, and
	$(SED) for some reason doesn't work everywhere.
	[b44b090d7c07]

2007-08-22  cras  <cras@kaali>

	* src/imap/Makefile.am:
	unichar.o and message-decoder.o are no longer unused
	[941c435e18c9]

2007-08-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/list/mailbox-list-fs.c:
	mbox: Return INBOX path correctly for DIR type lookups.
	[b2e571ffb776]

2007-08-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c:
	Assert-crashfix when extension header was resized.
	[7c0268b12001]

	* src/lib-storage/list/mailbox-list-maildir-iter.c, src/lib-
	storage/list/mailbox-list-maildir.c, src/lib-storage/list/mailbox-
	list-maildir.h, src/lib-storage/register/Makefile.am:
	Added support for binc IMAP style IMAPdir. It doesn't support
	escaping, but should be good enough.
	[aa00e299dfe6]

	* src/master/main.c:
	--log-error improvements.
	[9e33d9b9905a]

	* src/lib-storage/index/cydir/cydir-save.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/mbox
	/mbox-save.c:
	Call mail_alloc/mail_free, not index_mail_alloc/index_mail/free
	directly.
	[a8d5d826318b]

	* src/master/login-process.c:
	Minor code cleanup
	[8bca8efebfcf]

	* src/lib/mempool-system.c:
	pool_system_realloc(): Moved malloc_usable_size() check before
	realloc() so that we don't assert-crash if realloc() shrinks memory.
	[7d82a232b5b0]

2007-08-15  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-search.c:
	Use UTF-8 as the default SEARCH charset.
	[6342c8cc76c7]

2007-08-14  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-create.c:
	CREATE ns_prefix/box/ didn't work right when namespace prefix
	existed.
	[f5782901930b]

2007-08-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c:
	Change "permanent" cache decisions to "temporary" when compressing.
	They'll get updated back to permanent later if needed.
	[3f6fadbe6888]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c:
	Drop fields that haven't been used for 30 days when compressing.
	[205ee38f10d1]

	* src/lib-index/mail-cache-lookup.c:
	Make sure we don't try to re-read cache fields when compressing.
	[30904b20782d]

	* src/util/idxview.c:
	Don't show extensions for records if their record size is 0.
	[10a5f61d9692]

	* src/util/idxview.c:
	Don't crash if cache record size is 0
	[aa8d0440b890]

	* src/util/idxview.c:
	Print cache header's fields in more human-readable format.
	[623639306046]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	mail.close() virtual function finishing.
	[2f960cea48b1]

	* src/lib-auth/auth-server-request.c:
	If sending auth request to dovecot-auth fails, don't crash.
	[b04d136f8174]

	* src/lib-storage/index/cydir/cydir-mail.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/maildir/maildir-
	mail.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-storage
	/mail-storage-private.h:
	Added mail.close() virtual function.
	[4a57baddc8b8]

	* .hgtags:
	Messed up, there's no repository state that matches 1.1.alpha3
	exactly.
	[79d9c1703b78]

	* .hgtags:
	Added tag 1.1.alpha3 for changeset 8e608aa06449
	[0c4ac3337c35]

	* configure.in:
	Released v1.1.alpha3
	[4600d2c51b9c]

	* src/auth/Makefile.am:
	Added missing userdb-static.h
	[c77c2e198d15]

	* src/plugins/mail-log/mail-log-plugin.c:
	typofix: "(null" -> "(null)"
	[2392908727b8]

	* dovecot-example.conf, src/master/master-settings.c:
	Disable mailbox list indexing by default for now.
	[2d5363433029]

	* src/master/master-settings.c:
	If mail_nfs_index=yes, give an error if mmap_disable=no /
	fsync_disable=yes.
	[5eb728db3fd5]

2007-08-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-view.c:
	Removed unused debug code.
	[ffe50f268e4e]

	* src/deliver/deliver.c, src/deliver/mail-send.c, src/imap/imap-fetch-
	body.c, src/imap/imap-fetch.c, src/imap/imap-thread.c, src/lib-
	storage/index/cydir/cydir-mail.c, src/lib-storage/index/dbox/dbox-
	mail.c, src/lib-storage/index/index-mail-headers.c, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-mail.h, src
	/lib-storage/index/index-search.c, src/lib-storage/index/index-
	sort.c, src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/mail-copy.c, src/lib-storage/mail-
	storage-private.h, src/lib-storage/mail-storage.h, src/lib-
	storage/mail.c, src/plugins/expire/expire-plugin.c,
	src/plugins/expire/expire-tool.c, src/plugins/fts/fts-storage.c,
	src/plugins/mail-log/mail-log-plugin.c, src/plugins/quota/quota-
	count.c, src/plugins/quota/quota-storage.c,
	src/plugins/quota/quota.c, src/plugins/trash/trash-plugin.c,
	src/pop3/client.c, src/pop3/commands.c:
	mail_*() APIs changed to return int and return the actual data as
	pointer. Changed some code to do error handling a bit better.
	[eb7c9d8ece54]

	* src/deliver/deliver.c, src/imap/imap-sync.c, src/lib-index/mail-
	index-view-sync.c, src/lib-index/mail-index.h, src/lib-storage/index
	/index-storage.h, src/lib-storage/index/index-sync.c, src/lib-
	storage/list/index-mailbox-list-sync.c, src/lib-storage/mail-
	storage-private.h, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h, src/plugins/convert/convert-storage.c, src/plugins
	/mbox-snarf/mbox-snarf-plugin.c, src/plugins/trash/trash-plugin.c,
	src/pop3/client.c:
	mail_index_view_sync_next() and mailbox_sync_next() returns now
	bool. Renamed void mailbox_index_view_sync_end() to int
	mailbox_index_view_sync_commit().
	[f52e7d1402b5]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index.h, src
	/lib-index/mailbox-list-index-sync.c, src/lib-storage/index/cydir
	/cydir-sync.c, src/lib-storage/index/dbox/dbox-sync.c, src/lib-
	storage/index/index-sync-changes.c, src/lib-storage/index/index-
	sync-changes.h, src/lib-storage/index/maildir/maildir-sync-index.c,
	src/lib-storage/index/mbox/mbox-sync.c, src/lib-storage/list/index-
	mailbox-list-sync.c:
	mail_index_sync_next() can't fail anymore.
	[ce83635191d4]

	* src/deliver/deliver.c, src/imap/cmd-store.c, src/imap/imap-
	expunge.c, src/imap/imap-fetch.c, src/imap/imap-sync.c, src/imap
	/imap-thread.c, src/lib-index/mail-cache-lookup.c, src/lib-index
	/mail-index-sync.c, src/lib-index/mail-index-transaction-view.c, src
	/lib-index/mail-index-transaction.c, src/lib-index/mail-index-view-
	private.h, src/lib-index/mail-index-view.c, src/lib-index/mail-
	index.h, src/lib-storage/index/cydir/cydir-save.c, src/lib-
	storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox/dbox-
	save.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-mail.h, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-sort.c, src/lib-storage/index/index-sort.h, src
	/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/list/index-mailbox-list-sync.c, src
	/lib-storage/list/index-mailbox-list.c, src/lib-storage/mail-
	storage-private.h, src/lib-storage/mail-storage.h, src/lib-
	storage/mail.c, src/plugins/acl/acl-mailbox.c, src/plugins/expire
	/expire-plugin.c, src/plugins/expire/expire-tool.c, src/plugins/fts
	/fts-storage.c, src/plugins/lazy-expunge/lazy-expunge-plugin.c,
	src/plugins/mail-log/mail-log-plugin.c, src/plugins/quota/quota-
	storage.c, src/plugins/trash/trash-plugin.c, src/pop3/commands.c:
	mail_index_lookup*() can't fail anymore. Changed several APIs not to
	return failure anymore.
	[5f66277bbe40]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h, src/lib-storage/index/index-search.c:
	Don't store data->rec. It may not stay usable.
	[b5a23c868935]

	* src/imap/cmd-append.c, src/imap/cmd-select.c, src/imap/imap-
	search.c, src/imap/imap-status.c, src/imap/imap-sync.c, src/imap
	/imap-thread.c, src/lib-index/mail-cache-compress.c, src/lib-index
	/mail-cache-decisions.c, src/lib-index/mail-index-map.c, src/lib-
	index/mail-index-private.h, src/lib-index/mail-index-sync-ext.c, src
	/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-transaction-view.c, src/lib-
	index/mail-index-view-private.h, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-index.h,
	src/lib-index/mailbox-list-index-sync.c, src/lib-storage/index/cydir
	/cydir-sync.c, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-sync-expunge.c, src/lib-storage/index/dbox
	/dbox-sync-full.c, src/lib-storage/index/dbox/dbox-sync.c, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-mail.c, src
	/lib-storage/index/index-search.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync-
	changes.c, src/lib-storage/index/index-sync.c, src/lib-storage/index
	/index-transaction.c, src/lib-storage/index/maildir/maildir-sync-
	index.c, src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-sync-parse.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/list/index-mailbox-list-sync.c, src
	/lib-storage/list/index-mailbox-list.c, src/lib-storage/mail-
	storage-private.h, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h, src/plugins/fts-squat/fts-backend-squat.c,
	src/plugins/fts/fts-storage.c, src/plugins/lazy-expunge/lazy-
	expunge-plugin.c:
	Removed explicit locking from views and maps. They were already
	locked all the time when they were used. Because of this change
	several functions can no longer fail, so they were changed to return
	void, and a lot of pointless error handling was removed.
	[913b188f4dd4]

	* src/plugins/mail-log/mail-log-plugin.c, src/plugins/quota/quota-
	storage.c:
	More transaction_commit() compile fixes.
	[bd67afb92ee5]

	* src/plugins/fts/fts-storage.c:
	Reverted last change and now the real compile fix..
	[df5c0e75c815]

	* src/plugins/lazy-expunge/lazy-expunge-plugin.c:
	Compile fix
	[cff0c129b3da]

	* src/plugins/fts/fts-storage.c:
	Compile fix
	[9ab5611495f0]

	* src/plugins/expire/expire-plugin.c:
	Compile fix
	[87c617482388]

	* src/plugins/acl/acl-mailbox.c:
	Removed rights checking from mailbox_get_status(). The rights were
	already checked when mailbox was opened.
	[ceab61d7c20a]

	* src/lib-index/mail-index.h:
	Updated mail_index_sync_begin() comments.
	[2a79d23ad98f]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/lib-
	storage/index/cydir/cydir-save.c, src/lib-storage/index/cydir/cydir-
	sync.c, src/lib-storage/index/cydir/cydir-sync.h, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-
	transaction.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h:
	mailbox_transaction_commit_get_uids() now returns also UIDVALIDITY.
	It's the only usable way to get it returned correctly. Removed
	maildir-specific mailbox_get_status() handling, it's supposed to
	return the current state of the mailbox, not the latest state. It
	was useful only for returning non-zero UIDVALIDITY for newly created
	mailboxes, and that's no longer needed.
	[3a1eed408cad]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Crashfix at startup
	[3fabc189d17c]

2007-08-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/cydir/cydir-save.c, src/lib-storage/index
	/index-mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/maildir/maildir-
	save.c, src/lib-storage/index/mbox/mbox-save.c:
	Cache received date, sent date, save date and physical size when
	saving mails if they're wanted.
	[0ee2b0691f3e]

	* src/auth/userdb-static.h:
	Forgot to add.
	[10acca6dd37d]

2007-08-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c:
	Don't break flag counters when appending to shared record maps.
	[7ecdd2a996cf]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-index-
	transaction-view.c, src/lib-index/mail-index-view-private.h, src
	/lib-index/mail-index-view.c, src/lib-index/mail-index.h:
	mail_index_ext_get_reset_id() takes now map parameters. Fixed it to
	work properly with transaction views.
	[15abc6d262cd]

	* src/imap/imap-fetch.c:
	Failure handling fix.
	[3c46b1c5121a]

	* src/lib-storage/mail-storage.c:
	If mailbox has transactions open while it's tried to be closed, die
	here instead of assert-crash later.
	[b238257f724c]

	* configure.in:
	Updated --with-gssapi help string to include yes|plugin.
	[f2b00d3996df]

	* src/lib-storage/index/maildir/maildir-mail.c:
	If received date or physical size fetching fails because mail was
	expunged, mark the mail expunged instead of failing with unknown
	error.
	[63b744cb99a4]

	* src/imap/imap-fetch.c:
	If FETCH failed internally, we could have sent broken output (")"
	lines).
	[2618805b3d94]

2007-08-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/mailbox-list.c, src/lib-storage/mailbox-list.h:
	Split mailbox_list_init() to _alloc() and _init(). _init() is called
	only after storage backend has overridden the wanted functions, so
	plugins can override them.
	[0c9b6ff6fb0b]

	* src/lib/ostream-file.c:
	Assert fix
	[4c48e42412ef]

	* src/lib/ostream-file.c:
	If we do multiple writev() calls and the last one fails, we
	shouldn't treat all of it as a failure because some data was already
	sent. Also added some more asserts.
	[28b9873da2cc]

	* src/plugins/convert/convert-storage.c:
	If both source and destination storage had the same separator, we
	changed the separators to alt_hierarchy_char.
	[f108845caaa1]

	* src/lib-sql/driver-pgsql.c:
	Memory leak fixes
	[27d9b2114266]

	* src/lib-sql/driver-pgsql.c:
	Timeout queued queries after a while if we can't connect to server.
	[3200be63749b]

	* src/lib-storage/index/mbox/mbox-sync.c:
	If we expunged the first message but there were no other changes, we
	might have not actually expunged it.
	[a5db1b4bc02c]

	* src/plugins/mbox-snarf/mbox-snarf-plugin.c:
	Crashfixes
	[2ebca5088938]

	* src/lib-storage/index/mbox/mbox-storage.c, src/lib-storage/list
	/mailbox-list-fs.c, src/lib-storage/mailbox-list.h:
	Added MAILBOX_LIST_FLAG_MAILBOX_FILES flag. If it's set and INBOX
	path is set, point index and control directories under the root
	directory instead.
	[c6b1d8515354]

	* src/master/master-settings-defs.c, src/master/master-settings.c,
	src/master/master-settings.h:
	Removed default_mail_env backwards compatibility setting.
	[d9b07b5eea4a]

	* src/auth/userdb-passwd.c, src/auth/userdb-static.c:
	userdb passwd supports now adding key=value fields to args. They can
	override settings found from passwd file. Typically you'd use this
	to override a home directory, but it's also possible to override
	uid/gid.
	[1cc70ab3482a]

	* src/auth/userdb-static.c:
	Minor cleanup
	[007eee01749f]

	* src/login-common/sasl-server.c:
	Updated "Maximum number of connections from user+IP exceeded" error
	message.
	[b2d6becbc1f5]

	* src/auth/auth-request.c, src/auth/auth-worker-client.c:
	Don't crash if blocking passdb doesn't support credential lookups.
	[f4739631ce87]

	* src/auth/mech-gssapi.c:
	Crashfix for failed GSSAPI requests.
	[40e324d83d2b]

	* src/auth/passdb-bsdauth.c, src/auth/passdb-pam.c, src/auth/passdb-
	vpopmail.c:
	Store cache_key via auth_cache_parse_key() which adds TABs between
	the %variables, making it safer.
	[17e056f924cb]

	* src/lib/sendfile-util.c:
	Solaris: Ignore also other errors (EINTR?) if some data was sent.
	[3a1ff50a57b7]

	* src/lib/sendfile-util.c:
	Solaris: We didn't handle EAGAIN correctly.
	[b24199c8612d]

2007-08-08  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c:
	AUTHENTICATE "" command should return BAD instead of silence.
	[458aa25822fb]

	* src/plugins/lazy-expunge/Makefile.am, src/plugins/lazy-expunge/lazy-
	expunge-plugin.c:
	Fixed to use hook_mail_namespaces_created so we work also with pop3.
	[ea9604a6cfd6]

	* src/lib-storage/mail-namespace.c, src/lib-storage/mail-namespace.h:
	Added hook_mail_namespaces_created.
	[aca5c234b71a]

	* src/deliver/deliver.c:
	deliver didn't ignore TABs the same way spaces were ignored.
	[8992a20c229f]

2007-08-07  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-winbind.c:
	One more pid fix.
	[616872f3710c]

	* .hgtags:
	Added tag 1.1.alpha2 for changeset 8d4fa6f0b7e6
	[14a529abc646]

	* NEWS, TODO, configure.in:
	Released v1.1.alpha2.
	[8d4fa6f0b7e6] [1.1.alpha2]

	* src/lib-sql/Makefile.am, src/plugins/quota/Makefile.am:
	Removed DISTFILES which caused sources not to be included in
	tarball.
	[30c77009ba73]

	* src/auth/mech-winbind.c:
	waitpid() fix
	[5cf1c1ae7dd8]

	* configure.in, src/imap/cmd-thread.c, src/imap/imap-thread.c,
	src/imap/imap-thread.h, src/imap/main.c:
	Moved back to non-indexed THREAD code. It'll be fixed after v1.1.
	Also X-REFERENCES2 threading is gone for now.
	[ad1b948c5fa2]

	* src/auth/mech-winbind.c:
	Removed bad comment.
	[0b4ec1687f3c]

	* src/auth/mech-winbind.c:
	And mark pid=-1 so restarting really works.
	[b1cfce4263a2]

	* src/auth/mech-winbind.c:
	waitpid() ntlm_auth workers so they won't be left as zombies.
	[315b954801f7]

	* src/auth/mech-winbind.c:
	Assert-crashfix.
	[336ad0e3c78f]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Recent flag handling fix.
	[4e352390abb7]

	* src/lib-index/mail-index-sync-ext.c:
	Assert-crashfix
	[895194c5aa2e]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-ext.c:
	mail_index_map_register_ext() now takes ext_offset instead of
	hdr_offset. hdr_offset is calculated from ext_offset. Both are
	stored to the ext struct.
	[e6b1432e353f]

	* src/lib-index/mail-index-map.c:
	mail_index_map_move_to_memory() lost header extensions.
	[01d09f75af4a]

	* src/auth/auth-master-connection.c:
	Do username checks and translations with userdb lookups.
	[c14b923977e5]

	* src/plugins/quota/Makefile.am:
	Compile fix when building outside source tree.
	[22060906360e]

	* dovecot-example.conf, src/auth/passdb-pam.c:
	PAM lookups are now always done in auth worker processes.
	[74df0c0743c4]

	* dovecot-example.conf, src/auth/auth-worker-server.c, src/master
	/auth-process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added auth_worker_max_request_count setting.
	[06743e1e4c13]

	* src/auth/passdb-pam.c:
	Make sure we don't crash if PAM message is NULL and debug is
	enabled.
	[91f9f6fb8276]

	* dovecot-example.conf, src/auth/passdb-pam.c:
	Added failure_show_msg=yes parameter to PAM. If set, the first line
	of PAM password query is shown to user if authentication fails. This
	is useful with pam_otp.
	[a9c934833374]

	* src/auth/auth-worker-client.c, src/auth/passdb-blocking.c:
	Pass extra_fields from auth worker to server also if authentication
	failed.
	[974066ba68a3]

	* src/auth/auth-worker-client.c, src/auth/otp-skey-common.c, src/auth
	/otp-skey-common.h, src/auth/passdb-blocking.c, src/auth/passdb-
	sql.c, src/auth/passdb.h:
	Changed set_credentials() callback to take a bool success instead of
	enum passdb_result.
	[e33a87152c41]

	* src/auth/passdb-pam.c:
	Code cleanups. Also if auth_debug is enabled, log PAM messages.
	[6162c80dc9b7]

	* src/auth/passdb-pam.c:
	Removed AUTH_PAM_USERPASS code, which was never used.
	[629249064287]

	* dovecot-example.conf, src/imap/client.c, src/imap/client.h, src/imap
	/cmd-idle.c, src/imap/common.h, src/imap/main.c, src/master/master-
	settings.c:
	Client is now never disconnected in IDLE because it hasn't sent
	anything. Removed outlook-idle workaround because it's no longer
	needed.
	[da3c8d825f5c]

	* dovecot-example.conf:
	Removed umask setting from example config file.
	[939e0ca61f11]

	* dovecot-example.conf:
	Removed mail_cache_fields and mail_never_cache_fields settings from
	example config file. It's unlikely anyone wants to (or should)
	change them.
	[6c7512333e2f]

	* dovecot-example.conf, src/master/master-settings.c:
	maildir_copy_with_hardlinks=yes is now the default.
	[23b486d0fe6d]

	* src/lib-storage/index/maildir/maildir-copy.c:
	Don't copy mails with hardlinks if source and destination file
	mode/gid are different.
	[3f6154a837c6]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	We didn't update flags to maildir filenames when maildir was fully
	synced.
	[65e12fa51d4d]

	* src/plugins/quota/quota-fs.c:
	Use quota roots with mount path even if we never see a storage for
	them. This is useful if e.g. INBOX is in different filesystem then
	other mails.
	[8ab01c7b2927]

	* src/plugins/quota/quota-fs.c:
	inode_per_mail is now a parameter. We don't use it automatically.
	[d93098194ed4]

	* src/plugins/quota/quota-fs.c:
	Removed autocreation of quota roots. Added mount=<path> parameter to
	map storages to quota roots.
	[1b01ff0180a5]

	* src/plugins/quota/quota-fs.c:
	Added user and group parameters which allow forcing user/group quota
	reporting.
	[4a8a19fea50d]

	* src/plugins/quota/quota.c:
	Crashfix
	[9d77a7d26f28]

	* configure.in, src/auth/Makefile.am, src/auth/mech-gssapi.c,
	src/auth/mech.c:
	Added --with-gssapi=plugin
	[c1d09af8bdda]

	* configure.in, src/auth/Makefile.am, src/auth/db-ldap.c,
	src/auth/passdb.c, src/auth/userdb.c:
	--with-ldap=plugin builds LDAP passdb and userdb support as a
	plugin.
	[4f6c4aeafafb]

	* src/auth/main.c:
	Plugin handling fixes.
	[a2891c9296ee]

	* configure.in:
	Updated --with-sql help string.
	[17fdcb09159b]

	* configure.in:
	Renamed --enable-sql-plugins to --with-sql=plugin
	[068df1748a57]

	* configure.in, src/lib-sql/Makefile.am:
	Added --enable-sql-plugins to build SQL drivers as plugins. Based on
	patch by Tomas Janousek.
	[0d86bb9cf286]

	* src/plugins/quota/Makefile.am:
	Added rquota_xdr.c dependency to quota-fs.c
	[0dda1f746d63]

2007-08-06  Timo Sirainen  <tss@iki.fi>

	* .hgignore:
	Added quota_xdr.c
	[7e7bae5bd99b]

	* src/dict/Makefile.am, src/dict/main.c:
	Load plugins from $moduledir/dict/.
	[6793d8d934a8]

	* src/auth/main.c:
	If version_ignore=yes, ignore plugin versions also.
	[141c3abcac56]

	* src/auth/Makefile.am, src/auth/auth-module.c, src/auth/auth-
	module.h, src/auth/auth.h, src/auth/main.c, src/auth/passdb.c,
	src/auth/password-scheme.c, src/auth/userdb.c:
	Changed plugin handling. We'll just load and call _init() functions
	for all plugins in $moduledir/auth/.
	[968430741daf]

	* src/auth/password-scheme.c, src/auth/password-scheme.h,
	src/util/dovecotpw.c:
	Added password_scheme_[un]register() and used it internally. Removed
	password_list_schemes(), instead made the scheme array public.
	[e609b4e3a35c]

	* src/auth/main.c, src/auth/passdb.c, src/auth/passdb.h,
	src/auth/userdb.c, src/auth/userdb.h:
	Added pass/userdb_register_module() functions and used them to
	register the build-in functions instead of having a predefined
	array.
	[7c81e6d848f6]

	* src/plugins/quota/quota-fs.c:
	Added support for group quotas.
	[9a3a7ad297cf]

	* src/plugins/quota/quota-fs.c, src/plugins/quota/quota-fs.h:
	Code cleanups.
	[685a6f165193]

	* src/plugins/quota/quota-fs.c:
	With maildir and cydir formats return inode limit as message count
	limit.
	[cacb72a465c1]

	* src/auth/mech-winbind.c:
	Removed unused include.
	[657931e0af80]

	* dovecot-example.conf, src/auth/mech-winbind.c, src/master/auth-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Renamed auth_winbind_helper to auth_winbind_helper_path.
	[593d2ab4df0d]

	* dovecot-example.conf, src/auth/Makefile.am, src/auth/mech-winbind.c,
	src/auth/mech.c, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added support for Samba's ntlm_auth helper. It's used for GSS-SPNEGO
	mechanism. If auth_ntlm_use_winbind=yes it's also used for NTLM
	mechanism. Patch by Dmitry Butskoy.
	[18f663e23c28]

	* src/lib/base64.c, src/lib/base64.h:
	Added t_base64_decode_str().
	[6b0fe0f93896]

	* src/imap/client.c:
	If client disconnects in the middle of sending command parameters,
	don't crash with "command didn't cancel itself" error.
	[5c6af3b74d5f]

	* dovecot-example.conf, src/lib-storage/index/mbox/mbox-lock.c:
	Added dotlock_try mbox lock.
	[66971adb55e5]

	* configure.in, src/plugins/quota/Makefile.am, src/plugins/quota
	/quota-fs.c:
	Build rquota_xdr.c with rpcgen from rquota.x.
	[abec53314897]

	* src/plugins/quota/quota-fs.c:
	Use authunix_create_default() with rquota. Patch by Steven Luo.
	[0f6d4f8dd587]

	* src/auth/db-ldap.c:
	Ignore spaces after commas in user_attrs and pass_attrs.
	[6c3788e03f7e]

	* dovecot-example.conf, src/auth/auth-cache.c, src/auth/auth-cache.h,
	src/auth/passdb-cache.c, src/master/auth-process.c, src/master
	/master-settings.c, src/master/master-settings.h:
	Added auth_cache_negative_ttl setting.
	[6c48466c23fa]

	* src/auth/auth-worker-client.c:
	Userdb prefetch didn't work with blocking passdbs.
	[370691a10003]

	* src/lib-index/mail-cache-lookup.c:
	Use mail_index_ext_get_reset_id() to get the current reset_id, so we
	get the correct one in case it has been updated for current
	transaction already. Also fixes an assert-crash in case the cache
	extension didn't yet even exist outside the transaction.
	[b31c368b150b]

	* src/lib-index/mail-index-dummy-view.c, src/lib-index/mail-index-
	transaction-view.c, src/lib-index/mail-index-view-private.h, src
	/lib-index/mail-index-view.c, src/lib-index/mail-index.h:
	Added mail_index_ext_get_reset_id() which returns the latest
	reset_id when using transaction views.
	[635b58fe8287]

	* src/lib/bsearch-insert-pos.c:
	Removed bad comment.
	[808c43283c98]

	* src/lib-index/mail-index-transaction.c:
	mail_index_seq_array_lookup() didn't return idx_r correctly always,
	which could have caused out-of-order mail_index_update_ext() calls
	to break. We'll use bsearch_insert_pos() now instead of our own
	duplicated code.
	[eb307524cf16]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h:
	mail_index_map_get_ext_idx() should return bool, not int.
	[28d1cfbbce6e]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-view-sync.c:
	Prevent copying record data when appending new messages.
	[606f3d9f2769]

2007-08-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c:
	DEBUG: compile fix
	[004534216202]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-fsck.c, src
	/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h, src
	/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-transaction.c, src/lib-index
	/mail-index-view-sync.c, src/lib-index/mail-index-view.c, src/lib-
	index/mail-index-write.c, src/lib-index/mail-index.c:
	Created a new struct mail_index_record_map which can be shared by
	multiple mail_index_maps. This avoids having to copy records when
	appending new messages.
	[6418139447fa]

2007-08-02  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream-file.c:
	Delayed lseek()/pwrite() fixes.
	[22398d619cac]

	* src/lib/ostream-file.c:
	Delay lseek()s and use pwrite() whenever possible.
	[48dbfdba4e24]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-worker-client.c, src/auth/auth-worker-
	server.c, src/auth/db-passwd-file.c, src/deliver/auth-client.c,
	src/deliver/deliver.c, src/deliver/duplicate.c, src/dict/dict-
	server.c, src/imap-login/client.c, src/imap/client.c, src/lib-auth
	/auth-server-connection.c, src/lib-dict/dict-client.c, src/lib-dict
	/dict-sql.c, src/lib-settings/settings.c, src/lib-
	storage/index/cydir/cydir-mail.c, src/lib-storage/index/dbox/dbox-
	file.c, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/mbox/mbox-file.c, src/lib-
	storage/list/subscription-file.c, src/lib/file-copy.c, src/lib
	/istream-file.c, src/lib/istream-seekable.c, src/lib/istream.c,
	src/lib/istream.h, src/login-common/login-proxy.c, src/login-
	common/master.c, src/master/auth-process.c, src/master/log.c,
	src/plugins/acl/acl-backend-vfile-acllist.c, src/plugins/acl/acl-
	backend-vfile.c, src/plugins/expire/auth-client.c, src/plugins/fts-
	squat/squat-test.c, src/plugins/trash/trash-plugin.c,
	src/pop3-login/client.c, src/pop3/client.c, src/util/rawlog.c:
	Renamed i_stream_create_file() to i_stream_create_fd().
	[896cc473c1f0]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-worker-client.c, src/auth/auth-worker-
	server.c, src/deliver/auth-client.c, src/deliver/duplicate.c,
	src/dict/dict-server.c, src/imap-login/client.c, src/imap/client.c,
	src/lib-auth/auth-server-connection.c, src/lib-dict/dict-client.c,
	src/lib-index/mail-cache-compress.c, src/lib-index/mailbox-list-
	index-sync.c, src/lib-storage/index/cydir/cydir-save.c, src/lib-
	storage/index/dbox/dbox-sync-expunge.c, src/lib-storage/index/dbox
	/dbox-uidlist.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	sync-rewrite.c, src/lib-storage/list/subscription-file.c, src/lib
	/file-copy.c, src/lib/ostream-file.c, src/lib/ostream.h, src/login-
	common/login-proxy.c, src/master/auth-process.c, src/master/login-
	process.c, src/plugins/acl/acl-backend-vfile-acllist.c,
	src/plugins/expire/auth-client.c, src/plugins/fts-squat/squat-
	trie.c, src/plugins/fts-squat/squat-uidlist.c,
	src/pop3-login/client.c, src/pop3/client.c, src/util/rawlog.c:
	Split o_stream_create_file() to _create_fd() and _create_fd_file().
	[c62f7ee79446]

	* src/lib-storage/index/cydir/cydir-save.c, src/lib-
	storage/index/maildir/maildir-save.c:
	Delay writing to output file when saving messages until output
	buffer is full.
	[fe1e6e895d8f]

	* configure.in, src/plugins/quota/Makefile.am, src/plugins/quota
	/quota-fs.c:
	Support for rquota with NFS mounts. Patch by HTK NetCommunication
	Oy.
	[078d9dde99c8]

	* src/lib-index/mail-cache.c:
	If index is in memory, don't try to unlink() cache file.
	[6e9b6468398f]

	* src/imap/imap-search.c:
	Last messageset changes broke FETCH *.
	[e458f915009e]

	* src/lib-mail/message-parser.c, src/lib-mail/message-parser.h:
	By default assume MIME message if Content-Type: exists even if Mime-
	Version: doesn't. MESSAGE_PARSER_FLAG_MIME_VERSION_STRICT disables
	this.
	[e18086698ebf]

2007-08-01  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-search.c:
	FETCH/STORE n:* should also give BAD if n > number of messages in
	mailbox.
	[f0d8c9056706]

	* src/imap/imap-search.c:
	FETCH/STORE n:* should give a BAD error if there are no messages in
	mailbox.
	[e87bfcbc490d]

	* src/imap-login/client.c, src/pop3-login/client.c:
	If STARTTLS failed because max. number of connections for process
	was reached, don't assert-crash.
	[fc7c4af3e870]

	* src/auth/db-ldap.c:
	Retrying delayed auth binds after LDAP server reconnection assert-
	crashed.
	[58144db52331]

2007-07-30  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-ldap.c:
	auth_bind=yes and empty auth_bind_userdn leaked memory.
	[e841f00d368c]

2007-06-29  Ben Winslow  <rain@bluecherry.net>

	* dovecot-example.conf:
	Better document the fact that pop3_uidl_format supports modifiers.
	[6d6f0e4bd20d]

2007-07-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c:
	Having =key=value in pass_attrs or user_attrs allows returning
	static key=value pairs.
	[a744ae38a9e1]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	src/auth/userdb-ldap.c:
	Removed deprecated pass_attrs and user_attrs configuration method.
	[668a768fc8fd]

	* src/auth/db-ldap.c:
	Changed default pass_attrs and user_attrs to use the new format.
	[45a12a1bd299]

	* doc/dovecot-ldap-example.conf, doc/dovecot-sql-example.conf:
	Use \ for splitting long values to multiple lines.
	[bc5fdab698e3]

	* src/lib-settings/settings.c:
	Support continuing lines with \
	[5ec02199ff4a]

	* src/auth/db-ldap.c, src/auth/userdb-ldap.c:
	LDAP crashfixes. Based on patch by Katsu Yamamoto.
	[d779b7220e23]

2007-07-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/cydir/cydir-mail.c:
	If physical size lookup fails, return (uoff_t)-1, not (time_t)-1.
	[705773edecfb]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-worker-client.c, src/auth/auth-worker-
	server.c, src/auth/db-passwd-file.c, src/deliver/auth-client.c,
	src/deliver/deliver.c, src/deliver/duplicate.c, src/dict/dict-
	server.c, src/imap-login/client.c, src/imap/client.c, src/imap/cmd-
	append.c, src/imap/imap-fetch-body.c, src/lib-auth/auth-server-
	connection.c, src/lib-dict/dict-client.c, src/lib-dict/dict-sql.c,
	src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-envelope.c, src
	/lib-index/mail-cache-compress.c, src/lib-index/mailbox-list-index-
	sync.c, src/lib-mail/istream-header-filter.c, src/lib-
	settings/settings.c, src/lib-storage/index/cydir/cydir-mail.c, src
	/lib-storage/index/cydir/cydir-save.c, src/lib-storage/index/dbox
	/dbox-file.c, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-sync-expunge.c, src/lib-storage/index/dbox
	/dbox-uidlist.c, src/lib-storage/index/index-mail-headers.c, src
	/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-uidlist.c,
	src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-file.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	sync-rewrite.c, src/lib-storage/list/subscription-file.c, src/lib
	/file-copy.c, src/lib/iostream-internal.h, src/lib/iostream.c,
	src/lib/istream-data.c, src/lib/istream-file.c, src/lib/istream-
	internal.h, src/lib/istream-limit.c, src/lib/istream-mmap.c, src/lib
	/istream-seekable.c, src/lib/istream-seekable.h, src/lib/istream-
	tee.c, src/lib/istream-tee.h, src/lib/istream.c, src/lib/istream.h,
	src/lib/ostream-crlf.c, src/lib/ostream-crlf.h, src/lib/ostream-
	file.c, src/lib/ostream-internal.h, src/lib/ostream.c,
	src/lib/ostream.h, src/login-common/login-proxy.c, src/login-
	common/master.c, src/master/auth-process.c, src/master/log.c,
	src/master/login-process.c, src/plugins/acl/acl-backend-vfile-
	acllist.c, src/plugins/acl/acl-backend-vfile.c, src/plugins/expire
	/auth-client.c, src/plugins/fts-squat/squat-test.c, src/plugins/fts-
	squat/squat-trie.c, src/plugins/fts-squat/squat-uidlist.c,
	src/plugins/trash/trash-plugin.c, src/plugins/zlib/istream-zlib.c,
	src/plugins/zlib/istream-zlib.h, src/plugins/zlib/zlib-plugin.c,
	src/pop3-login/client.c, src/pop3/client.c, src/util/rawlog.c:
	Removed memory pool parameter from iostreams. Default pool was
	almost always used, and the stream usually required destroying
	anyway so it didn't even make freeing memory easier.
	[6c0bfc35af03]

	* src/lib-storage/list/subscription-file.c:
	Don't use a memory pool, it's overkill here.
	[783d614b0db4]

2007-07-23  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	If save failed for non-first namespace, we got a wrong error
	message.
	[291135c986b3]

	* src/deliver/deliver.c:
	If Sieve script didn't save the message anywhere, we saved it to
	INBOX.
	[cd0f9be6f8ad]

	* src/lib-storage/index/cydir/cydir-storage.c:
	Files aren't valid cydir mailboxes. Also comment updates.
	[447849dcc156]

2007-07-21  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	If login_user == mail uid, we logged an error but didn't really
	prevent it.
	[327688eb425a]

2007-07-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-sort.c:
	Parse MIME encoded-words in mail address headers also.
	[9b0588ca3c10]

	* src/lib-storage/index/index-sort.c:
	Use i;unicode-casemap for sorting also.
	[bc0f8a8397a3]

	* src/lib/Makefile.am:
	Add unicodemap.pl to tarball, although it's not necessary.
	[9a847fc14abe]

	* src/lib-mail/message-decoder.c, src/lib-mail/message-decoder.h, src
	/lib-mail/message-header-decode.c, src/lib-mail/message-header-
	decode.h:
	Renamed ucase parameters to dtcase which is more correct.
	[fd9f6b4d846e]

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-charset/charset-utf8.h, src/lib-mail/message-decoder.c, src
	/lib-mail/message-header-decode.c, src/lib-mail/message-search.c:
	charset_to_utf8_begin() API change.
	[d01522d276f6]

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-charset/charset-utf8.h, src/lib-mail/message-decoder.c, src
	/lib-mail/message-header-decode.c:
	Use uni_utf8_to_decomposed_titlecase() to have proper case-
	insensitive UTF-8 comparing.
	[5f56b2eb32b3]

	* .hgignore:
	Ignore UnicodeData.txt also
	[9afe3fa4858d]

	* .hgignore, src/lib/Makefile.am, src/lib/unichar.c,
	src/lib/unichar.h, src/lib/unicodemap.pl:
	Added uni_ucs4_to_titlecase() and
	uni_utf8_to_decomposed_titlecase(). They use a unicharmap.c file
	generated from UnicodeData.txt.
	[04b9eb27283c]

	* src/lib/macros.h:
	Added N_ELEMENTS() macro.
	[6d2bee707053]

	* src/lib/bsearch-insert-pos.h:
	Added BINARY_NUMBER_SEARCH() macro.
	[32e229d89038]

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-charset/charset-utf8.h:
	Removed unused charset_to_utf8_string() and
	charset_to_ucase_utf8_string()
	[0d3583b02a32]

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.h:
	Removed CHARSET_RET_OUTPUT_FULL, it can't happen anymore.
	[b9c1336fd4e4]

	* src/lib-mail/message-search.c:
	Don't use charset_to_ucase_utf8_string() API.
	[60817aa6066d]

	* src/lib-mail/message-header-decode.c:
	Fixed message_header_decode_utf8() to return FALSE also for single
	ASCII/UTF-8 encoded-words.
	[d3299ed1332a]

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-charset/charset-utf8.h, src/lib-mail/message-decoder.c, src
	/lib-mail/message-header-decode.c:
	charset_to_utf8() isn't used anymore, so renamed
	charset_to_utf8_full() to it.
	[d86581f4a0c6]

	* src/lib-mail/message-header-decode.c, src/lib-mail/message-header-
	decode.h:
	message_header_decode_utf8() returns not TRUE if it actually changed
	something.
	[157e31742eeb]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.h, src/lib-storage/mail-storage-private.h, src/lib-
	storage/mail-storage.h, src/lib-storage/mail.c:
	Added mail_get_first_header_utf8() and mail_get_headers_utf8().
	[00d1a94a94c6]

	* src/lib-imap/imap-base-subject.c:
	Use message_header_decode_utf8() instead of implementing our own.
	[9607369b6bce]

	* src/lib-mail/message-decoder.c, src/lib-mail/message-header-
	decode.c, src/lib-mail/message-header-decode.h:
	Added message_header_decode_utf8(). Use it in message decoder
	instead of implementing the same thing.
	[841b052e269e]

	* src/lib-imap/imap-bodystructure.c, src/lib-mail/Makefile.am, src
	/lib-mail/message-content-parser.c, src/lib-mail/message-content-
	parser.h, src/lib-mail/message-decoder.c, src/lib-mail/message-
	parser.c, src/lib-mail/message-search.c, src/lib-
	mail/rfc822-parser.c, src/lib-mail/rfc822-parser.h:
	Removed message-content-parser. Instead added
	rfc822_parse_content_type() and rfc822_parse_content_param() to help
	parse such headers.
	[9214044ce1f1]

	* src/lib-mail/rfc822-parser.c:
	domain-literal parsing should have skipped LWSP after it.
	[6bc2995619f3]

	* src/lib-mail/rfc822-parser.h:
	Added comments
	[35d12c0cd7a7]

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-charset/charset-utf8.h, src/lib-mail/message-decoder.c:
	_charset_utf8_ucase() -> charset_utf8_ucase_write(),
	_charset_utf8_ucase_strdup() -> charset_utf8_ucase_strdup()
	[325667778ae3]

	* src/lib-mail/message-decoder.c, src/lib-mail/message-decoder.h, src
	/lib-mail/message-search.c, src/plugins/fts/fts-storage.c:
	Changed message_decoder_init_ucase() to message_decoder_init(bool
	ucase)
	[adbfce5bf7d9]

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-charset/charset-utf8.h, src/lib-imap/imap-base-subject.c, src
	/lib-mail/message-decoder.c:
	charset_to_utf8_begin() now takes bool ucase parameter. Changed
	charset_to_ucase_utf8*() to charset_to_utf8*().
	[e5451501ff2f]

	* configure.in:
	--with-passwd was used also for --with-nss
	[c83546491bad]

2007-07-19  Timo Sirainen  <tss@iki.fi>

	* NEWS:
	Updated
	[d0af61880c04]

	* .hgtags:
	v1.1.alpha1 tag was wrong after all, another try.
	[b705fea4b5e8]

	* src/lib-storage/list/Makefile.am:
	Added missing file
	[f12f794ed847]

	* .hgtags:
	Added tag 1.1.alpha1 for changeset 1338ba4aac1e
	[c5fda8e075c2] [1.1.alpha1]

	* NEWS, configure.in:
	v1.1.alpha1 released.
	[1338ba4aac1e]

	* TODO:
	Updated
	[8f79b333fc47]

	* src/lib-storage/index/mbox/mbox-save.c:
	Cache everything interesting while saving a message.
	[a019240a9df1]

	* src/lib-storage/index/index-sync.c:
	Fixes to handling recent flags. Also if DEBUG is enabled, scan
	through the recent flags array to make sure there aren't any
	expunged messages.
	[15f845e16a91]

	* src/lib/seq-range-array.c:
	seq_range_array_remove_range() sometimes didn't remove one sequence
	from the middle.
	[a7dca74c0978]

	* src/lib-index/mailbox-list-index-private.h, src/lib-index/mailbox-
	list-index-sync.c, src/lib-index/mailbox-list-index.c:
	mmap() mailbox list index only if it's at least 32kB
	[6805ccf0b82e]

	* src/lib-index/mailbox-list-index-sync.c:
	Don't write list index header if it hasn't changed.
	[a55ee2e3caac]

	* src/lib-index/mailbox-list-index-sync.c:
	Remove deleted records from sync_recs so that if we compress the
	index afterwards we don't add the deleted records back.
	[33d589af9933]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	Minor code cleanup
	[a9ad568ce598]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	Don't update maildir sync header if only sync time has changed, and
	that hasn't changed delayed-refresh state.
	[d5d3adb86e12]

	* src/lib-index/mailbox-list-index.c:
	Crashfix
	[877d861f2dd3]

	* src/lib-storage/index/maildir/maildir-storage.c:
	If mailbox is deleted while it's being created, don't log an error.
	[b6a477859a3c]

	* src/lib-index/mail-index-transaction.c:
	Fixes to MAIL_INDEX_TRANSACTION_FLAG_AVOID_FLAG_UPDATES handling.
	[b9f7eb84d4be]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-transaction-log-append.c:
	Keep flag updates separately from transaction.log_updates flag,
	because the flag updates array can become empty.
	[76da3b271bcf]

	* src/lib-index/mailbox-list-index-sync.c:
	Use MAIL_INDEX_SYNC_FLAG_AVOID_FLAG_UPDATES so we don't keep writing
	flag changes to transaction log.
	[1dac64778a3f]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index.h:
	Added MAIL_INDEX_TRANSACTION_FLAG_AVOID_FLAG_UPDATES and
	MAIL_INDEX_SYNC_FLAG_AVOID_FLAG_UPDATES flags to make
	mail_index_update_flags() not do anything if the flags in view
	already are those.
	[c8d7b9fd500e]

	* src/util/listview.c:
	Show file_seq
	[56f8a4dd819d]

	* src/imap/imap-thread.c, src/lib-index/mail-index-sync.c, src/lib-
	index/mail-index-transaction-private.h, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index.h, src/lib-index/mail-
	transaction-log-append.c, src/lib-storage/index/index-transaction.c,
	src/lib-storage/list/index-mailbox-list-sync.c:
	Changed mail_transaction_begin() API to take flags parameter instead
	of two booleans.
	[a19931ec66db]

	* src/lib-index/mailbox-list-index-sync.c:
	When rewriting a directory, make sure the write buffers are zeroed
	before doing anything.
	[7639a6df4acb]

	* src/lib-index/mailbox-list-index-sync.c, src/lib-index/mailbox-list-
	index.c:
	We can't check if list branch exists in mail_view by checking
	sync_size header. When compressing list index the sync_size check
	breaks, and we can't even fix it with file_seq checks or similar,
	because when reading there are no locks and the list file is
	recreated before changes to mail index are committed. So instead
	we'll just always check that uid < mail_view.next_uid before
	returning it.
	[f479a774a416]

	* src/lib-index/mailbox-list-index-private.h, src/lib-index/mailbox-
	list-index-sync.c, src/lib-index/mailbox-list-index.c:
	Added increasing file_seq field to list index.
	[e562c6359cd1]

	* src/lib/mountpoint.c:
	Removed special autofs check. Instead check ignore mount option and
	swap correctly. Use getextmntent() to find the wanted device instead
	of stat()ing everything.
	[cc8b6e73e830]

2007-07-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/cydir/cydir-storage.c:
	Removed some weird code, probably debugging..
	[00495c124ea0]

	* src/lib-storage/index/cydir/cydir-save.c, src/lib-storage/index
	/index-mail-headers.c, src/lib-storage/index/index-mail.h, src/lib-
	storage/index/maildir/maildir-save.c:
	Moved tee stream handling to index-mail code.
	[1b0ef7a74448]

	* src/lib-mail/message-parser.c:
	ref/unref stream when parsing it.
	[d62bddb414ef]

	* src/lib-index/mailbox-list-index-sync.c:
	minor code cleanup
	[c23d396f84b2]

	* src/lib-index/mailbox-list-index-sync.c:
	Add missing records to mail index.
	[1f0e71c833c3]

	* src/util/listview.c:
	Print prettier output
	[d212e2b8c5a4]

	* .hgignore, src/util/Makefile.am, src/util/listview.c:
	Added listview utility to show dovecot.list.index.uidmap's contents.
	[39e1a81be92c]

	* src/lib-index/mail-index-map.c:
	Another crashfix after mail_index_mark_corrupted()
	[2378d992c49b]

	* src/lib-index/mailbox-list-index-private.h, src/lib-index/mailbox-
	list-index.h:
	Moved mailbox_list_index_set_corrupted() to private .h file
	[f1f83c90fd3d]

	* src/lib-index/mailbox-list-index-sync.c, src/lib-storage/list/index-
	mailbox-list.c:
	Handle desync errors without marking mailbox list index corrupted,
	the problem is with mail index.
	[813c976ed476]

	* src/lib-index/mail-index-transaction.c, src/lib-index/mail-
	transaction-log-append.c:
	Don't crash if mail_index_reset() is the only change in transaction.
	[47536814b011]

	* src/lib-index/mail-index-map.c:
	Don't crash when mapping after mail_index_mark_corrupted()
	[8418a23cb3f4]

	* src/lib-index/mailbox-list-index-sync.c, src/lib-index/mailbox-list-
	index.c, src/lib-storage/list/index-mailbox-list.c:
	Handle uid validity changes a bit better.
	[461496644c67]

	* src/lib-index/mail-index-sync.c:
	Optimization: If FLAG_DROP_RECENT isn't set, don't bother
	calculating next_uid
	[c5919ea0cb33]

	* src/lib-storage/list/index-mailbox-list.c:
	Fallbacking to backend listing was broken.
	[bec0f5cc8388]

	* src/lib-index/mailbox-list-index-sync.c, src/lib-index/mailbox-list-
	index.c, src/lib-index/mailbox-list-index.h, src/lib-storage/list
	/index-mailbox-list.c:
	Changed mailbox_list_index_view_init() to return -1 if uid_validity
	doesn't match between mailbox list index and the view.
	[8576ce5d7fb4]

	* src/lib-index/mail-index-transaction.c:
	mail_index_transaction_get_next_uid(): If mail_index_reset() was
	called, don't use existing next_uid (and crash).
	[dc93705c4038]

	* src/lib-storage/list/index-mailbox-list.c:
	Optimization: Refresh index before opening view instead of syncing
	the opened view.
	[f5d87227d12c]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Handle multiple simultaneous DELETEs better.
	[bba5f170a565]

	* src/lib-storage/mail-storage.c:
	Added t_push/t_pop
	[16698620809a]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Deleting a mailbox was supposed to rename it to ..DOVECOT-TRASHED,
	not .DOVECOT-TRASHED
	[5d9e48e97f5a]

	* src/lib-settings/settings.c:
	If section opening fails, show the line where the last section was
	opened or closed.
	[dab02b1fc89d]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/maildir/maildir-sync.h, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/list/index-mailbox-list-sync.c, src
	/lib-storage/list/index-mailbox-list.h, src/lib-storage/mail-
	storage-private.h:
	Moved mailbox list index sync stamp checking and updating to
	storage-specific code.
	[8341db7a1698]

	* src/imap/imap-status.c, src/lib-storage/index/maildir/maildir-
	storage.c:
	Added t_push/t_pops to avoid wasting memory.
	[f42deb78f0e7]

	* src/lib-storage/list/index-mailbox-list.c, src/lib-storage/list
	/index-mailbox-list.h:
	Fixed mailbox list indexes to work properly with namespace prefixes.
	[f88fed67bca9]

	* src/lib-storage/list/index-mailbox-list.c, src/lib-storage/list
	/index-mailbox-list.h:
	Fixed mailbox list indexes to work properly with subscriptions
	[ca0770f7b1a8]

	* src/lib-index/mail-index-transaction.c:
	If a flag is added and then removed, remove it from the transaction
	completely.
	[07d08be5bbb8]

	* src/lib-index/mailbox-list-index-sync.c:
	Handle setting deleted mailboxes to nonexistent.
	[4d14254bc40a]

	* src/lib-storage/list/index-mailbox-list.c, src/lib-storage/list
	/index-mailbox-list.h:
	Sync mailbox list index completely at once, instead of in pieces and
	keeping the index locked while LIST replies are being returned.
	[b06dfb878783]

	* src/lib-storage/list/index-mailbox-list.c:
	If we're only listing subscriptions without flags, ignore mailbox
	indexes.
	[437dce5162c5]

	* src/lib-storage/list/index-mailbox-list.c:
	Fixed support for multiple patterns
	[d0787ca97a0c]

	* src/plugins/acl/acl-mailbox.c:
	Return mailbox as READ-WRITE only if mailbox has rights to expunge,
	insert or change shared flags. Return \* in PERMANENTFLAGS only if
	mailbox has write right.
	[e6f3f17da3e7]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync-index.c, src/lib-storage/mail-
	storage-private.h:
	Moved private_flags_mask to struct mailbox.
	[8a9b077d503e]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Removed unused code.
	[de9b604f0802]

	* dovecot-example.conf:
	quota_warning examples need to use %%, not %
	[252158d40baf]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c:
	If UIDVALIDITY lookup fails, don't show it as an error. It probably
	means that ACL plugin prevented the lookup because user had no READ
	rights.
	[1246c1c08742]

	* src/plugins/acl/acl-mailbox.c:
	Fail get_status() lookup if user has no READ right to the mailbox.
	[a4c03ced38c3]

	* src/imap/cmd-append.c:
	If UIDVALIDITY lookup fails, don't return failure to whole APPEND,
	just don't return APPENDUID.
	[f35ef260987c]

	* src/imap/cmd-copy.c:
	Get UIDVALIDITY after transaction was committed. It may have
	changed.
	[b407586a5107]

2007-07-17  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-mailbox.c:
	APPEND and COPY ignored s/t/w flag rights.
	[840fb333defd]

	* src/plugins/acl/acl-mailbox-list.c:
	If user didn't have "lookup" right to mailbox, "insert" right didn't
	work.
	[3ca063521d9a]

	* src/lib-storage/list/mailbox-list-subscriptions.c:
	List non-subscribed mailboxes only if at least one child mailbox
	isn't listed.
	[d9abe04fc9ae]

	* src/lib-index/mail-transaction-log-append.c:
	Removed extension intro caching, it doesn't currently work right.
	[99aace97fb4e]

	* src/lib-storage/index/index-sync.c:
	If a message was expunged that wasn't yet even visible to our view,
	it might have still been in recent flags array. Make sure it gets
	removed from there.
	[f2ab0b7e5ae6]

	* src/lib/seq-range-array.c, src/lib/seq-range-array.h:
	seq_range_array_remove_range() returns now how many sequences were
	removed.
	[fef4aad133dd]

	* src/lib/mountpoint.c:
	Skip over autofs entries. Patch by Mike Brudenell
	[3887591e7a54]

2007-07-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/maildir/maildir-
	sync-index.c, src/lib-storage/index/mbox/mbox-sync-private.h, src
	/lib-storage/index/mbox/mbox-sync.c:
	Fixes to recent handling. Now it should work properly.
	[cadb5b7cd919]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-map.c, src
	/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction-view.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index-view-sync.c, src/lib-index
	/mail-index-view.c, src/lib-index/mail-index.h, src/lib-mail/mail-
	types.h, src/lib-storage/index/cydir/cydir-save.c, src/lib-
	storage/index/cydir/cydir-sync.c, src/lib-storage/index/dbox/dbox-
	save.c, src/lib-storage/index/dbox/dbox-sync.c, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-status.c,
	src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-sync.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-sync-
	index.c, src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync.c,
	src/lib/seq-range-array.c, src/lib/seq-range-array.h,
	src/util/idxview.c:
	Recent flag handling rewrite. Still not perfect with maildir.
	[d911d943438e]

	* src/lib-index/mail-index-transaction-view.c:
	mail_index_lookup_uid_range() works now correctly when searching for
	newly appended messages.
	[5d3a941444f1]

	* src/lib-storage/list/mailbox-list-maildir-iter.c:
	Return INBOX with namespace prefix if we're not in INBOX namespace.
	[b6fe8568f207]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Fixes to handling appends and unexpunges.
	[dcaa8d5296a9]

	* src/imap/cmd-append.c:
	Get UIDVALIDITY after transaction has been commited. It may have
	changed.
	[61bf911dad91]

	* dovecot-example.conf, src/plugins/quota/quota-plugin.c,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota.c,
	src/plugins/quota/quota.h:
	Added quota warning commands. Based lightly on a patch by Nicolas
	Boullis.
	[6edca218d48a]

	* src/plugins/quota/quota.c:
	Allow non-default rule limits to be percentages of the default rule
	limit.
	[b272eff19a18]

	* src/plugins/quota/quota.c:
	Allow b/k/m/g/t in quota limits.
	[d22be94225b1]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Crashfixes to handling new messages.
	[10042803d65e]

	* src/lib-storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	Fixed reassigning new UIDs to more than one message.
	[68be663e79ec]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If uidlist gets deleted but indexes not, give UIDs to messages
	beginning from index's next_uid instead of from 1 and reassigning
	new UIDs soon.
	[3b260c6d9207]

	* src/lib/failures.c:
	If log flushing fails because of EINTR or EAGAIN, handle them
	instead of exiting.
	[23460b525442]

	* src/plugins/quota/quota-count.c, src/plugins/quota/quota-private.h,
	src/plugins/quota/quota.c:
	Don't set quota limits to transactions until they're needed.
	[001d25a650df]

2007-07-15  Timo Sirainen  <tss@iki.fi>

	* src/plugins/trash/trash-plugin.c:
	Added debug logging.
	[6074e9e6059d]

	* src/deliver/deliver.c, src/lib-storage/index/cydir/cydir-storage.c,
	src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-namespace.c, src/lib-storage
	/mail-storage-private.h, src/lib-storage/mail-storage.c, src/lib-
	storage/mail-storage.h, src/lib-storage/mailbox-list.c,
	src/plugins/convert/convert-storage.c:
	mail_storage.create() now returns error message string. Also fixed
	handling "/" and empty root paths.
	[56879cc53cec]

	* src/lib-index/mail-index.c:
	mail_index_move_to_memory(): Don't log an error if index fd is
	already closed
	[8da2881df0dc]

	* src/lib-storage/mail-namespace.c:
	Give better error messages if storage creation fails.
	[f40d16eed722]

	* src/master/master-settings.c:
	We no longer need empty pop3_uidl_format check.
	[b94fc6e80bae]

	* dovecot-example.conf, src/master/master-settings.c, src/pop3/main.c:
	Set pop3_uidl_format default to %08Xu%08Xv
	[12f6a19dc846]

	* src/imap/cmd-list.c:
	Added X-STATUS (..) return option to send STATUS replies to client
	for listed selectable mailboxes.
	[b148e4c41aa7]

	* src/imap/cmd-list.c:
	code cleanups
	[895b0b2b183e]

	* src/imap/Makefile.am, src/imap/cmd-status.c, src/imap/imap-status.c,
	src/imap/imap-status.h:
	Moved STATUS handling code to imap-status.[ch]
	[2d815150cf57]

	* configure.in:
	Added LIST-EXTENDED to capabilities. It should be fully working now.
	[1208344cc1df]

	* src/imap/cmd-list.c, src/lib-storage/list/mailbox-list-fs-iter.c,
	src/lib-storage/list/mailbox-list-maildir-iter.c, src/lib-
	storage/list/mailbox-list-subscriptions.c:
	Let lib-storage handle matching namespace prefixes as well.
	[92fabfda82f9]

	* src/lib-storage/list/mailbox-list-fs-iter.c:
	Avoid readdir()ing if the list of possible matches can be found from
	patterns.
	[d094e8c0123a]

	* src/lib-imap/imap-match.c:
	INBOX in "inbox/%" style pattern wasn't compared case-insensitively.
	[f0165a8b4323]

	* src/imap/cmd-subscribe.c:
	SUBSCRIBE/UNSUBSCRIBE was broken with namespace prefixes.
	[91c229e00772]

	* src/lib-storage/list/mailbox-list-maildir-iter.c, src/lib-
	storage/list/mailbox-list-subscriptions.c:
	Fixes to returning mailboxes
	[ed6c07975ccb]

	* src/imap/cmd-list.c:
	LSUB: If pattern doesn't end with %, don't show extra unsubscribed
	mailboxes
	[62f92a68fc72]

	* src/lib-imap/imap-match.c:
	Last change broke pattern matching pretty badly.
	[88f354c17ca5]

	* src/imap/cmd-list.c, src/lib-imap/imap-match.c, src/lib-imap/imap-
	match.h, src/lib-storage/list/index-mailbox-list.c, src/lib-
	storage/list/mailbox-list-fs-iter.c, src/lib-storage/list/mailbox-
	list-fs.h, src/lib-storage/list/mailbox-list-maildir-iter.c, src
	/lib-storage/list/mailbox-list-maildir.h, src/lib-storage/mailbox-
	list-private.h, src/lib-storage/mailbox-list.c, src/lib-storage
	/mailbox-list.h, src/plugins/acl/acl-mailbox-list.c:
	Added support for multiple mailbox list patterns.
	[cc1f4688a988]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.h:
	We didn't cache correctly headers that existed in cache file for
	other messages, but we weren't currently interested of.
	[9da1ec15340d]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h:
	mail_cache_lookup_iter_next() returned -1 if entry didn't exist,
	causing the first field for the record not to be added to cache.
	[7c1e6ea4bfab]

	* src/lib-index/mail-cache-transaction.c:
	mail_cache_add(): Update existing fields array so
	mail_cache_field_exists() works right.
	[6645e902b8a0]

	* src/lib-index/mail-cache-fields.c:
	When getting cache fields list, make sure cache file is opened.
	[6f66ce9491ad]

	* src/lib-index/mail-transaction-log-file.c:
	Code cleanup
	[16f91815c7ed]

	* src/lib-index/mail-index-view-sync.c:
	Added new assert
	[2d81847eb3e6]

	* src/lib-index/mail-index-view-sync.c:
	Assert change
	[5aaaed0457aa]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-transaction-log-append.c:
	If mail_index_ext_set_reset_id() is called, the transaction may go
	back to unchanged state and we don't want to write it to transaction
	log then.
	[5b4bf289b98d]

	* src/lib-index/mail-index-transaction.c:
	Last change didn't clear ext resizes right.
	[7a632ae07cea]

	* src/lib-index/mail-index-transaction.c:
	mail_index_ext_reset() and mail_index_ext_set_reset_id() need to
	clear ext header updates and resizes. mail_index_ext_set_reset_id()
	also needs to clear ext resets.
	[e047e5b19fbd]

	* src/lib-index/mail-transaction-log-file.c:
	Fixed "duplicate transaction log sequence" errors when we noticed
	that log file was recreated while we were trying to create it
	ourself.
	[00be53d8f076]

2007-07-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c:
	Syncing fix
	[2473829b42b2]

	* src/lib-index/mail-cache-compress.c:
	Make sure the file_seq always grows.
	[8964d1b2b78b]

	* src/lib-index/mail-cache-compress.c:
	need_compress_file_seq=0 nowadays when file doesn't exist, not -1.
	[c66c80b23f95]

	* src/lib-index/mail-transaction-log-append.c:
	If we're modifying just one extension record, don't write the ext
	intro twice.
	[ac382879b116]

	* src/lib-index/mail-transaction-log-append.c:
	When resetting extensions, the ext intro's reset_id must be the old
	one.
	[5dacddf4a88a]

	* src/lib/istream-tee.c:
	When all child streams are destroyed, make sure the main stream's
	offset is the same as the maximum child offset.
	[14a0630a4fa9]

	* src/lib-mail/message-parser.c:
	We wanted to read too many bytes when finding end boundary, which
	could have broken the parser.
	[1a7f5c04af1d]

2007-07-13  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	Compile without IPv6
	[42e56c396bfb]

	* src/deliver/smtp-client.c, src/imap/imap-search.c, src/login-
	common/master.c:
	compiler warning fixes
	[409dc8834651]

	* src/lib-index/mail-index-view.c:
	Compiler warning fix
	[f2b2dc3337cc]

	* src/lib/network.c:
	More union usage to avoid casting.
	[8ae4b8d78a25]

	* src/auth/auth-request.c, src/lib/network.c, src/lib/network.h:
	Changed struct ip_addr to use union for ipv4/ipv6 structs so we
	don't have to use casting.
	[74a6130211c2]

	* src/lib-index/mailbox-list-index-sync.c, src/lib-
	storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/mailbox-list.c, src/plugins/acl
	/acl-backend-vfile-acllist.c, src/plugins/acl/acl-backend-vfile.c,
	src/util/idxview.c:
	compiler warning fixes
	[272796cfee66]

	* src/lib-index/mail-transaction-log-append.c:
	mail_index_ext_set_reset_id() handling fix
	[3e7364f200aa]

	* src/lib/ioloop-notify-none.c:
	Compile fix.
	[d585d0c65834]

	* dovecot-example.conf, src/imap/client.c, src/imap/common.h,
	src/imap/main.c, src/master/master-settings-defs.c, src/master
	/master-settings.c, src/master/master-settings.h:
	Added imap_logout_format setting with default to bytes=%i/%o
	[57b70f64f997]

	* dovecot-example.conf, src/pop3/client.c:
	Added %i and %o for input/output bytes to pop3_logout_format.
	[433745f10290]

	* src/deliver/deliver.c:
	If Sieve plugin returns any errors, ignore them. Bounce the message
	only if message couldn't be saved anywhere.
	[28836909b3b0]

	* dovecot-example.conf, src/lib-storage/mail-storage.c, src/master
	/mail-process.c, src/master/master-settings-defs.c, src/master
	/master-settings.c, src/master/master-settings.h:
	Added mail_nfs_storage and mail_nfs_index settings.
	[38a73d870731]

	* src/lib-index/mail-index.c:
	Changed nfs setting conflict error handling
	[3a19830ab7f6]

	* src/lib-storage/index/index-storage.c, src/lib-storage/mail-
	storage.c, src/lib-storage/mail-storage.h:
	Added MAIL_STORAGE_FLAG_FSYNC_DISABLE and moved FSYNC_DISABLE
	environment handling elsewhere.
	[78fe45cdc192]

	* src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib-storage/index/mbox/mbox-sync.c:
	Flush NFS caches when needed.
	[b88278b5d8d3]

2007-07-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-storage.c, src/lib-storage/mail-
	storage.h:
	Added MAIL_STORAGE_FLAG_NFS_FLUSH_STORAGE and
	MAIL_STORAGE_FLAG_NFS_FLUSH_INDEX flags. Pass FLUSH_INDEX to index
	open flags.
	[fe9da9c92cf4]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-sync-update.c, src/lib-index
	/mail-cache.c, src/lib-index/mail-hash.c, src/lib-index/mail-index-
	lock.c, src/lib-index/mail-index-map.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index-write.c, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h, src/lib-index/mail-transaction-
	log-file.c, src/lib-index/mail-transaction-log.c, src/lib-index
	/mailbox-list-index-sync.c, src/lib-index/mailbox-list-index.c:
	Flush NFS caches when needed if MAIL_INDEX_OPEN_FLAG_NFS_FLUSH is
	enabled.
	[9fb9dc4d8df8]

	* src/lib/file-dotlock.c:
	Flush NFS attribute cache before stat()ing files.
	[2bc25f61431f]

	* src/lib/nfs-workarounds.c, src/lib/nfs-workarounds.h:
	Added nfs_flush_attr_cache() and nfs_flush_read_cache().
	[a290b84d144a]

	* src/lib/file-dotlock.c:
	Use nfs_safe_lstat() when dotlocking. Also use lstat() not stat()
	for checking how our file was created (probably doesn't ever really
	matter).
	[29770d8a013b]

	* src/lib/nfs-workarounds.c, src/lib/nfs-workarounds.h:
	Added nfs_safe_lstat()
	[885ed4d5c51d]

	* src/lib-storage/index/index-mail.c:
	Don't cache flags unless we want them.
	[0a6dd369afff]

	* src/lib-index/mail-cache-transaction.c:
	Make sure cache is opened when mail_cache_field_can_add() or
	mail_cache_field_want_add() is called.
	[731be87a2128]

	* src/lib-storage/index/maildir/maildir-save.c:
	Always create new mails to index transaction. If uidlist gets locked
	they're really committed, if not they'll discarded.
	[921bc18b164a]

	* src/lib-storage/index/maildir/maildir-save.c:
	Add ,W=<virtual size> to saved maildir filenames.
	[29d08e7bbf63]

	* src/lib-storage/index/cydir/cydir-save.c, src/lib-
	storage/index/maildir/maildir-save.c:
	Cache updater might not have seen all the input data producing
	broken data.
	[9bef18690777]

	* src/lib-storage/index/maildir/maildir-save.c:
	Don't require locking uidlist unless mail has keywords or we want to
	return UIDs to caller.
	[3e01ee1a2864]

	* src/lib-storage/index/maildir/maildir-storage.c:
	When status is returned, make sure we return correct
	uidvalidity/nextuid values from uidlist if index isn't up-to-date.
	[7aa61bb91ba3]

	* src/lib-index/mail-cache-transaction.c:
	If we couldn't add a new header field, don't crash.
	[33908f232e9a]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	One more UIDVALIDITY=0 fix
	[5513182aed67]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Make sure that uid < next_uid if uidlist version is 1.
	[5825961b9862]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	If uidlist isn't version 3, we have to recreate it instead of
	appending.
	[874428d05272]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	fd leak fix
	[fc75386a57ab]

	* src/lib-index/mail-cache-lookup.c:
	Fixes
	[ce960c33f663]

	* src/lib-index/mail-transaction-log-append.c:
	Fixes to handling reset_id changes.
	[b788251996e5]

	* src/lib-index/mail-transaction-log-file.c, src/lib-index/mail-
	transaction-log.c:
	Fixes
	[2b150b4b49df]

	* src/lib-index/mail-cache-fields.c:
	Some paranoia fixes for memory allocation. Don't access a mmaped
	variable directly in case it happens to change.
	[ba118a9eeb50]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h, src/lib-storage/index/maildir/maildir-mail.c:
	Store virtual sizes to dovecot-uidlist if we want to use them all
	the time. If nothing else than virtual size is wanted to be known
	(ie. POP3 or POP3-like IMAP client), don't bother updating cache
	file at all.
	[e9b5d3d33b95]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	Added support for updating uidlist record extensions.
	[49aebb3028f7]

	* src/imap/imap-fetch.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/mail-storage.h:
	Added MAIL_FETCH_NUL_STATE. Don't try to fetch cached flags now
	unless it's needed.
	[1a80f37a4a12]

	* src/lib-storage/index/index-storage.c, src/master/master-settings.c:
	Don't cache anything by default. flags aren't useful with pop3.
	[a0b3228be6d2]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-sync-update.c, src/lib-index/mail-cache-transaction.c, src
	/lib-index/mail-cache.c:
	Don't create cache file until something is actually being added to
	it.
	[7ebe0593f488]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index.h, src/lib-index/mail-
	transaction-log-append.c:
	Added mail_index_ext_set_reset_id().
	[19bc2a4b3669]

	* src/lib-index/mail-cache-lookup.c:
	Header lookups from cache returned always "doesn't exist".
	[ab487f1de905]

2007-07-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	Created a new extensible version 3 dovecot-uidlist file.
	[760f910004d9]

2007-07-11  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	Allow using --exec-mail imap/pop3 even if imap/pop3 isn't in
	protocols setting.
	[6c3c54dc67fc]

2007-07-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	maildir_uidlist_iter_next() should return bool, not int.
	[bf536b8dbc51]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Fixed UIDVALIDITY changed error when dovecot-uidlist file didn't
	exist but index already had UIDVALIDITY.
	[90de57daa0d4]

2007-07-09  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-notify-inotify.c:
	Listen for IN_DELETE_SELF too. Ignore EINVAL for inotify_rm_watch().
	[b985e2127a2d]

	* src/lib/ioloop.c:
	Delay initializing ioloop backend until it's needed.
	[8f1d94246a8f]

	* src/lib-storage/index/maildir/maildir-uidlist.c, src/lib/file-
	dotlock.c, src/lib/file-dotlock.h:
	If use_io_notify dotlock setting is enabled, use I/O notify loop for
	waiting dotlock deletion instead of just sleeping randomly.
	[805f2527a982]

	* src/lib-storage/index/index-mailbox-check.c, src/lib/ioloop-notify-
	dn.c, src/lib/ioloop-notify-inotify.c, src/lib/ioloop-notify-
	kqueue.c, src/lib/ioloop.h:
	Changed io_add_notify() API so that it can return "file doesn't
	exist" error.
	[772f4e8bd2a9]

	* src/master/main.c:
	Fixes
	[2133c966701a]

	* src/lib/ioloop-notify-kqueue.c:
	Don't prevent io_add_notify() from listening for files, since kqueue
	supports it.
	[9160d4bd8c0b]

	* src/lib-index/mail-transaction-log.c:
	Added asserts
	[181aa61c182a]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	dovecot-uidlist can now be updated by appending to it. It's
	recreated only if there have been enough expunged messages.
	[fdc7e47ccea3]

	* src/lib-storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	Handle next_uid changes better.
	[6ac8d6c93d34]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	Removed outdated FIXME comment
	[6371b2a7178f]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	minor cleanups
	[7cbeeb953b92]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-sync-index.c:
	minor cleanups
	[073dfd42d4e7]

	* src/lib-index/mail-index-transaction.c:
	We didn't commit transaction if it had only extension header
	updates.
	[6c5bc4f1558c]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync-index.c, src/lib-
	storage/index/maildir/maildir-sync.c:
	Store syncing information to maildir extension header instead of
	kludging them into base header. Also we're now using nanoseconds to
	check for changes if they're available.
	[b9865213da42]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Handle mailbox deletions while syncing silently.
	[095b3adc537b]

	* src/lib-index/mail-index-view-sync.c:
	We sometimes lost expunged messages. Added asserts to make sure it
	doesn't happen again.
	[2b6909d5de3e]

	* src/lib-storage/index/maildir/maildir-sync-index.c:
	If we see expunged messages coming back, log a warning and give them
	a new UID instead of marking the index corrupted.
	[ac05ec8c7171]

	* src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	Added maildir_uidlist_sync_remove()
	[239078f515a8]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	code cleanup
	[79513299d42c]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	minor cleanup
	[00bdb1f546d3]

2007-07-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/Makefile.am, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-sync-index.c, src/lib-storage/index/maildir/maildir-sync.c,
	src/lib-storage/index/maildir/maildir-sync.h:
	Moved index syncing code to its own file.
	[00c5e3cbeaf0]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	cleanup
	[cc439e4e99cb]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h:
	cleanup: s/maildir_uidlist_update()/maildir_uidlist_refresh()/
	[126b74419f52]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Don't use uidlist lock to update uidlist. Have a separate real
	dotlock for locking and create a .tmp file when we need to rewrite
	the uidlist. This makes the code cleaner and makes it possible to
	easily detect stale lock files.
	[525b449313a7]

	* src/imap/imap-sync.c:
	cleanup: s/fname/path/
	[d30fa36505fb]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	fd leak fix
	[171c3f89295c]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Sync index changes while iterating through uidlist entries. This
	avoids unnecessary (and broken) flag updates.
	[ae731dbf3a6f]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	If uidlist changes while it's being iterated, don't crash.
	[699356ffe549]

	* src/lib-storage/index/maildir/maildir-sync.c:
	s/sync_ctx/ctx/
	[53abd603e04b]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If readdir() or closedir() fails, return failure.
	[8bb5c7a69405]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Code cleanup
	[289f828591f7]

	* src/lib-storage/index/maildir/maildir-util.c:
	Removed unneeded includes
	[afea0be7e27c]

	* src/lib-storage/index/maildir/maildir-mail.c:
	Code cleanup
	[c5841e705567]

	* src/lib-storage/index/maildir/maildir-filename.c:
	Minor cleanups
	[2596602b6bd1]

	* src/lib-storage/index/maildir/maildir-save.c:
	When checking if destination temp file exists, if stat() failed with
	anything else than ENOENT, we got stuck infinitely.
	[47d0899be687]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-util.c:
	Moved maildir_create_tmp() to maildir-save. It's the only place
	where it's used.
	[81b3a22e6ce1]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-filename.c, src/lib-
	storage/index/maildir/maildir-filename.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-util.c:
	Renamed maildir_generate_tmp_filename() to
	maildir_filename_generate(). Also changed it to create the unique
	filename with time+usecs+pid, increasing usecs as needed. So there's
	no longer a process delivery counter.
	[62ceb6b2b20d]

	* src/lib-storage/index/maildir/maildir-filename.c, src/lib-
	storage/index/maildir/maildir-filename.h, src/lib-
	storage/index/maildir/maildir-uidlist.c:
	Added maildir_filename_sort_cmp() which sorts maildir filenames by
	time and microseconds. Use it for sorting newly seen files.
	[5d0827cd9839]

	* src/lib-storage/index/maildir/maildir-filename.c, src/lib-
	storage/index/maildir/maildir-filename.h, src/lib-
	storage/index/maildir/maildir-uidlist.c:
	Renamed maildir_cmp/hash to maildir_filename_base_cmp/hash.
	[0cef1d7a0ce3]

	* src/lib-storage/index/maildir/maildir-filename.c, src/lib-
	storage/index/maildir/maildir-filename.h, src/lib-
	storage/index/maildir/maildir-sync.c:
	maildir_filename_get_flags() returns void now.
	[3764697932ae]

	* src/lib-storage/index/Makefile.am:
	Added index-sync-changes.[ch]
	[025e92f4f75a]

	* src/lib-storage/index/maildir/Makefile.am, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-filename.c, src/lib-storage/index/maildir/maildir-
	filename.h, src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.h, src/lib-storage/index/maildir/maildir-sync.c,
	src/lib-storage/index/maildir/maildir-sync.h, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-util.c:
	Moved maildir filename related functions to maildir-filename.c
	[f29b93c0519c]

	* src/lib-storage/index/index-sync-changes.c, src/lib-storage/index
	/index-sync-changes.h, src/lib-storage/index/mbox/mbox-sync-
	private.h, src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Moved index sync record grouping from mbox to generic code.
	[54ef7dccdfc7]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-transaction-log-append.c:
	Implemented mail_index_update_header_ext()
	[3ec9ce7cd5e7]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-sync-ext.c:
	Don't crash if extension record size is 0.
	[a4c80b0ee22b]

	* src/util/logview.c:
	Show extension header updates.
	[cb5e25c3b300]

2007-07-05  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	%variables in plugin {} settings need to be expanded.
	[1b90285069f9]

2007-07-04  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-pam.c:
	Crashfix if PAM returns a reply but the process doesn't die.
	[f731198279eb]

	* src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	Removed unused MAILDIR_UIDLIST_SYNC_ORDERED flag.
	[36056f044f1f]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Leave uidlist fd open so we can check if uidlist has been rewritten
	from inode instead of relying on mtime changes. Removed utime() call
	for uidlist.
	[db959f0d94e3]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Changed record buffers to arrays.
	[989abd5017a4]

	* src/master/mail-process.c:
	Don't bother setting POP3 settings to IMAP processes and vice versa.
	[8117a34abdbd]

2007-07-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-util.c:
	Update tmp/ directory's atime+mtime with utime(NULL) so it works
	even if we're not the directory owner.
	[a4cd1f37d022]

	* dovecot-example.conf, src/login-common/main.c,
	src/master/Makefile.am, src/master/dup2-array.c,
	src/master/dup2-array.h, src/master/listener.c,
	src/master/listener.h, src/master/login-process.c,
	src/master/main.c, src/master/master-login-interface.h, src/master
	/master-settings.c, src/master/master-settings.h:
	Support listening multiple sockets. SIGHUP also doesn't anymore
	recreate listener sockets.
	[3f2eb1b9c555]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Don't auto-create INBOX if namespace doesn't have INBOX.
	[86f22b84e008]

	* src/lib-storage/list/mailbox-list-maildir-iter.c:
	In non-INBOX namespaces list INBOX if Maildir/cur exists.
	[f0685f6ec951]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	src/auth/userdb-ldap.c:
	Moved generic LDAP result iteration to db_ldap. It also supports now
	templates in values.
	[1c1dee40e495]

	* doc/dovecot-ldap-example.conf:
	user_global_uid/gid no longer exist.
	[526d1a860b13]

	* doc/auth-protocol.txt, src/auth/auth-request.c, src/auth/auth-
	request.h, src/lib-auth/auth-client.h, src/lib-auth/auth-server-
	request.c, src/login-common/sasl-server.c:
	Send local/remote ports to dovecot-auth. They're now in %a and %b
	variables.
	[40ce533c88f9]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log.c:
	Delete over 30 minutes old .log.2 files when opening indexes.
	[7b7ce27f2b13]

	* dovecot-example.conf, src/auth/passdb-passwd-file.c:
	Support changing default password scheme for passdb passwd-file.
	[3f3c12bfdba6]

	* src/auth/auth-request.c:
	If uidgid_file=<template_path> is set, the uid and gid are looked up
	by stat()ing the given path.
	[f7cdede45a88]

	* src/auth/auth.c:
	If no userdbs are defined, fallback to an empty static one.
	[f622396e03ef]

	* src/auth/userdb-static.c:
	Don't require having uid/gid.
	[a3bbf340694f]

	* dovecot-example.conf, src/master/mail-process.c, src/master/master-
	settings-defs.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added mail_uid and mail_gid settings.
	[933caa747d37]

	* src/auth/db-passwd-file.c, src/auth/userdb-passwd-file.c:
	Allow passwd-file ti contain empty uid/gid fields.
	[cda9824bab63]

	* src/auth/userdb.c:
	Allow uid/gid names that begin with numbers, as long as it's not
	completely a number.
	[5fa84de81413]

	* src/auth/userdb.c:
	minor fix
	[592a69a21b53]

	* src/auth/auth-master-connection.c, src/auth/auth-request-handler.c,
	src/auth/auth-request.c, src/auth/auth-request.h, src/auth/auth-
	worker-client.c, src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth
	/passdb-ldap.c, src/auth/userdb-blocking.c, src/auth/userdb-ldap.c,
	src/auth/userdb-nss.c, src/auth/userdb-passwd-file.c, src/auth
	/userdb-passwd.c, src/auth/userdb-prefetch.c, src/auth/userdb-sql.c,
	src/auth/userdb-static.c, src/auth/userdb-vpopmail.c,
	src/auth/userdb.h:
	Changed userdb callback API. Don't require uid/gid to be returned by
	userdb.
	[93bd157917ca]

	* src/master/mail-process.c:
	Fixed dump-capability crash at startup
	[4cf56bf92215]

	* configure.in, src/auth/Makefile.am, src/auth/userdb-nss.c,
	src/auth/userdb.c:
	Added userdb nss which currently supports glibc-compatible NSS
	modules.
	[c9b49ed99d28]

	* src/plugins/acl/acl-mailbox-list.c:
	Owner parameter wasn't set correctly. Take user's groups from
	acl_groups environment.
	[38ff50597e54]

2007-07-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c:
	Don't clone a map when expunging if all messages were already
	expunged.
	[cff069467884]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index-view-sync.c, src/lib-index/mail-index-view.c, src/lib-index
	/mail-index.c, src/lib-index/mail-transaction-log-file.c:
	mmaping works again properly. Changed to use private mmaps which are
	directly modified. The file is kept locked the whole time while it's
	being mmaped, so multi-process updates may be slower than necessary.
	[1b70ae186611]

	* src/lib/str.c:
	Implement str_vprintfa() by making vsnprintf() write directly to the
	string. This also avoids excessive memory usage with strings
	allocated from data stack.
	[092b9d3b7f97]

	* src/lib/network.c, src/lib/network.h:
	Added net_ip_hash().
	[22b300677807]

	* src/lib-index/mail-transaction-log-view.c:
	assertfix
	[c554a52f1b3d]

	* src/lib-index/mail-index-view-sync.c:
	If there are no expunges, sync to head map instead of keeping track
	of a cloned map.
	[7d1844cbfd98]

	* src/lib-index/mail-index-sync-ext.c:
	Fixed possible header breaking at extension header resize.
	[e5acd078fb41]

	* src/lib-index/mail-index-map.c:
	Fixed map cloning in the middle of syncing.
	[70bfd5adab79]

	* src/auth/mech-gssapi.c:
	And removed unneeded code.
	[159929f53161]

	* configure.in, src/auth/mech-gssapi.c:
	If __gss_userok() exists, use it to verify username. Patch by Peter
	Eriksson.
	[dfdedb187b26]

	* dovecot-example.conf:
	mail_max_userip_connections comment fixes
	[7a71ede9334b]

	* dovecot-example.conf, src/master/mail-process.c, src/master/master-
	settings-defs.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Changed mail_max_user_connections to mail_max_userip_connections.
	[123748453011]

	* src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Memory leak fix
	[93c00bc7dfea]

2007-07-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	transaction-view.c, src/lib-index/mail-index-view-private.h, src
	/lib-index/mail-index-view-sync.c, src/lib-index/mail-index-view.c:
	Removed view->hdr. Use view->map->hdr directly.
	[fd6ff4d9cab1]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-map.c, src
	/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index-view-private.h, src/lib-
	index/mail-index-view-sync.c, src/lib-index/mail-index-view.c, src
	/lib-index/mail-index-write.c, src/lib-index/mail-index.c, src/lib-
	index/mail-transaction-log-file.c:
	Rewrite index lock handling.
	[eca7e29dce0d]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-map.c, src
	/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	ext.c, src/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-
	index-sync-private.h, src/lib-index/mail-index-sync-update.c, src
	/lib-index/mail-index-view-private.h, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-index.c:
	mail_index_map now contains pointer to index, so all functions
	taking map parameter don't need index anymore.
	[d9f319a9d6e0]

	* src/lib-storage/list/mailbox-list-fs-iter.c:
	Don't crash when listing INBOX and not returning subscription flags.
	[2f9d38b82364]

	* src/lib-index/mail-index-sync-update.c:
	If we can do initial sync from .log file by reading less than 2k, do
	it instead of opening main index file.
	[fb91e7d729d1]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	Handle UIDVALIDITY changes by resetting index.
	[f8caf3c6a5a7]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index-write.c, src/lib-index/mail-
	index.h, src/lib-index/mail-transaction-log-append.c, src/lib-index
	/mail-transaction-log-file.c, src/lib-index/mail-transaction-log-
	private.h, src/lib-index/mail-transaction-log-view.c, src/lib-index
	/mail-transaction-log.c, src/lib-index/mail-transaction-log.h:
	Added support for resetting index.
	[a9df50952600]

	* src/imap/client.h, src/imap/cmd-select.c, src/imap/imap-sync.c:
	Disconnect client if UIDVALIDITY changes.
	[064aa8ff69c2]

2007-06-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c:
	Removed unneeded code.
	[55699bbeaec2]

	* dovecot-example.conf, src/imap-login/client-authenticate.c, src
	/login-common/master.c, src/login-common/master.h, src/login-common
	/sasl-server.c, src/master/child-process.c, src/master/child-
	process.h, src/master/dict-process.c, src/master/login-process.c,
	src/master/mail-process.c, src/master/mail-process.h,
	src/master/main.c, src/master/master-login-interface.h, src/master
	/master-settings-defs.c, src/master/master-settings.c, src/master
	/master-settings.h, src/master/ssl-init.c, src/pop3-login/client-
	authenticate.c:
	Initial implementation for mail_max_user_connections setting.
	[21e529b8a701]

	* src/login-common/main.c:
	Don't crash at exit if auth client was already freed.
	[9265c13c4103]

	* src/master/common.h, src/master/main.c:
	Removed validate_str(). It's not used anywhere.
	[7efc025c7e9f]

	* src/master/Makefile.am, src/master/auth-process.c, src/master/child-
	process.c, src/master/child-process.h, src/master/common.h,
	src/master/dict-process.c, src/master/dict-process.h, src/master
	/login-process.c, src/master/login-process.h, src/master/mail-
	process.c, src/master/mail-process.h, src/master/main.c, src/master
	/ssl-init.c, src/master/ssl-init.h:
	Moved child process handling to child-process.[ch]. The hash table
	now uses pointers to structures instead of a casted process type.
	This allowed removing another login-processes hash table.
	[f655c4d4a419]

	* src/lib-storage/list/mailbox-list-maildir-iter.c:
	crashfix
	[77a399a5eb2a]

2007-06-29  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c, src/lib-imap/imap-match.c, src/lib-storage/list
	/mailbox-list-fs-iter.c, src/lib-storage/list/mailbox-list-maildir-
	iter.c, src/lib-storage/list/mailbox-list-subscriptions.c:
	Use explicit IMAP_MATCH_* comparisons for imap_match() instead of
	assuming something about the values.
	[1983995ae243]

	* src/lib-imap/imap-match.c, src/lib-imap/imap-match.h:
	s/mask/pattern/
	[f4dac54df44e]

	* src/imap/cmd-list.c, src/lib-storage/list/index-mailbox-list.c, src
	/lib-storage/list/mailbox-list-fs-iter.c, src/lib-storage/list
	/mailbox-list-fs.c, src/lib-storage/list/mailbox-list-fs.h, src/lib-
	storage/list/mailbox-list-maildir-iter.c, src/lib-storage/list
	/mailbox-list-maildir.c, src/lib-storage/list/mailbox-list-
	maildir.h, src/lib-storage/mailbox-list-private.h, src/lib-storage
	/mailbox-list.c, src/lib-storage/mailbox-list.h:
	s/mask/pattern/ for mailbox listing.
	[978722ad6184]

	* src/lib-imap/imap-parser.h:
	Added IMAP_ARG_TYPE_IS_STRING()
	[4906791b8256]

	* src/lib-imap/imap-parser.c:
	imap_arg_string() should handle IMAP_ARG_LITERAL also.
	[5cd5f65a8dad]

	* src/imap/cmd-append.c, src/imap/cmd-fetch.c, src/imap/cmd-list.c,
	src/imap/cmd-sort.c, src/imap/cmd-status.c, src/imap/cmd-store.c,
	src/imap/imap-fetch-body.c, src/imap/imap-search.c, src/lib-imap
	/imap-bodystructure.c, src/lib-imap/imap-envelope.c, src/lib-imap
	/imap-parser.c, src/lib-imap/imap-parser.h, src/plugins/imap-quota
	/imap-quota-plugin.c:
	Changed imap-parser API to use standard arrays for lists instead of
	its own imap_arg_list struct.
	[9f869a7a3d73]

	* src/imap-login/client-authenticate.c, src/imap-login/client-
	authenticate.h, src/imap-login/client.c, src/imap/client.c,
	src/imap/client.h, src/imap/cmd-append.c, src/imap/cmd-expunge.c,
	src/imap/cmd-fetch.c, src/imap/cmd-list.c, src/imap/cmd-search.c,
	src/imap/cmd-sort.c, src/imap/cmd-status.c, src/imap/cmd-store.c,
	src/imap/cmd-thread.c, src/imap/commands-util.c, src/imap/commands-
	util.h, src/imap/imap-fetch-body.c, src/imap/imap-fetch.c, src/imap
	/imap-fetch.h, src/imap/imap-search.c, src/imap/imap-search.h, src
	/lib-imap/imap-bodystructure.c, src/lib-imap/imap-envelope.c, src
	/lib-imap/imap-parser.c, src/lib-imap/imap-parser.h, src/plugins
	/imap-quota/imap-quota-plugin.c:
	Added more consts to imap-parser API
	[d59ed6a31b66]

	* src/imap/cmd-list.c:
	LSUB \Noselect fix
	[fd21588ef7aa]

	* src/lib-storage/mailbox-tree.c:
	Don't add nonexistent/children flags automatically here.
	[8351aa73b4df]

	* src/imap/cmd-list.c:
	Parse LIST-EXTENDED parameters more correctly.
	[1d91d36e14a4]

	* src/lib-storage/list/mailbox-list-subscriptions.c, src/lib-
	storage/list/mailbox-list-subscriptions.h:
	Forgot to add in last mailbox list API commit.
	[f22a7228dab8]

2007-06-29  Andrey Panin  <pazke@donpac.ru>

	* src/auth/Makefile.am, src/auth/mech-login.c, src/auth/mech-plain.c,
	src/auth/plain-common.c, src/auth/plain-common.h:
	Factor out duplicated verify_callback() function.
	[0a08fa294c3b]

2007-06-29  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c, src/lib-storage/index/cydir/cydir-storage.c,
	src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/list/Makefile.am,
	src/lib-storage/list/mailbox-list-fs-iter.c, src/lib-storage/list
	/mailbox-list-maildir-iter.c, src/lib-storage/list/mailbox-list-
	maildir.c, src/lib-storage/mailbox-list.h, src/lib-storage/mailbox-
	tree.c, src/lib-storage/mailbox-tree.h, src/plugins/acl/acl-backend-
	vfile-acllist.c, src/plugins/acl/acl-mailbox-list.c,
	src/plugins/convert/convert-storage.c, src/plugins/quota/quota-
	count.c, src/plugins/quota/quota-maildir.c:
	Mailbox listing API changed to support more features. Used to
	implement support for half of LIST-EXTENDED.
	[1d73153584d2]

2007-06-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c:
	Don't access freed memory
	[496b7dad3938]

	* src/lib-index/mail-index.c:
	Memory and fd leak fix
	[f17d4bccd74d]

	* src/lib/printf-format-fix.c:
	Format fixing didn't work correctly.
	[0bf4ade47ce9]

	* dovecot-example.conf:
	Mention that flock doesn't work with NFS.
	[6303dc5e3997]

2007-06-28  root  <root@hurina>

	* src/master/main.c:
	Reordered initialization code. Capabilities are now dropped as soon
	as possible.
	[5d0aa827f130]

	* src/master/capabilities-posix.c:
	Preserve DAC_OVERRIDE capability. We may want to open any config/log
	files.
	[c1b32cd98e68]

2007-06-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c:
	And compile fix
	[3cb7ddfee63c]

	* src/lib-index/mail-index-sync.c:
	FIXME removal
	[b564f45c4d7b]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index-view-sync.c, src/lib-index/mail-index-write.c, src/lib-index
	/mail-index.c:
	Handle losing index file better. Handle fsck better.
	[e59892590a02]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index-map.c,
	src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	write.c, src/lib-index/mail-index.c, src/lib-index/mail-transaction-
	log-file.c, src/lib-index/mail-transaction-log-private.h, src/lib-
	index/mail-transaction-log.c, src/lib-index/mail-transaction-log.h:
	Handle indexid changes better.
	[4ea31bf18a56]

	* src/imap/cmd-list.c, src/imap/cmd-subscribe.c:
	Don't use subscriptions with hidden namespaces.
	[86282604e2f5]

	* src/lib-storage/mail-namespace.c:
	Namespace with empty prefix can have list=yes also
	[9f2a94a226f4]

2007-06-27  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-pam.c:
	FIXME comment update
	[e3693a057962]

	* src/lib/lib-signals.c:
	Allow registering signal handlers even before lib_signals_init() is
	called. The signals won't be effective until then though, unless
	they're ignored.
	[3f1d268f32f0]

	* src/lib/ioloop-notify-inotify.c:
	If inotify_init() fails with EMFILE, give an understandable error
	message.
	[498ef9bc33f1]

	* src/lib-index/mail-transaction-log-private.h:
	Removed debug #defines and changed log rotation size defaults.
	[9b4987348cf6]

	* src/imap/client.c, src/imap/client.h, src/imap/imap-sync.c:
	Fixes to handling command ambiguity. Don't allow any commands that
	handle messages be run while mailbox is being synced.
	[71176467310e]

	* src/imap/cmd-list.c:
	Handle listing flags correctly for all namespace prefixes.
	[e0b451e0c190]

	* src/lib-storage/mail-namespace.c, src/lib-storage/mail-namespace.h:
	Added mail_namespace_find_inbox() and
	mail_namespace_find_prefix_nosep()
	[f56a71347378]

	* src/imap/cmd-list.c:
	Fixes for last changes.
	[ab88a5e8ac95]

	* src/imap/cmd-list.c, src/imap/cmd-namespace.c, src/lib-storage/list
	/mailbox-list-fs-iter.c, src/lib-storage/list/mailbox-list-maildir-
	iter.c, src/lib-storage/mail-namespace.c, src/lib-storage/mail-
	namespace.h:
	Moved several namespace booleans to a flags field. Removed unused
	subscriptions boolean.
	[45735dd11f17]

	* src/imap/cmd-list.c, src/lib-storage/list/index-mailbox-list.c, src
	/lib-storage/list/mailbox-list-fs-iter.c, src/lib-storage/list
	/mailbox-list-fs.h, src/lib-storage/list/mailbox-list-maildir-
	iter.c, src/lib-storage/list/mailbox-list-maildir.c, src/lib-
	storage/list/mailbox-list-maildir.h, src/lib-storage/mailbox-list-
	private.h, src/lib-storage/mailbox-list.c, src/lib-storage/mailbox-
	list.h, src/plugins/acl/acl-backend-vfile-acllist.c, src/plugins/acl
	/acl-mailbox-list.c, src/plugins/convert/convert-storage.c,
	src/plugins/quota/quota-count.c, src/plugins/quota/quota-maildir.c:
	mailbox_list_iter_next() returns now const pointer.
	[ec09ad1d017f]

	* src/imap/cmd-list.c:
	Code cleanups
	[3704fe78f2f9]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-idle.c:
	Changes sent by IDLE shouldn't affect the client's inactivity
	timeout checking.
	[3fd09104fd77]

	* src/lib-storage/mail-namespace.c, src/lib-storage/mail-namespace.h:
	Store namespaces sorted by their prefix length.
	[c7f35a9beb0b]

	* src/imap/cmd-list.c:
	Code cleanups
	[6ae0dc6dc3b3]

	* src/imap/cmd-list.c, src/lib-storage/mail-namespace.c, src/lib-
	storage/mail-namespace.h:
	Make sure all listable namespaces use the same separator. If there's
	no ref or "" namespace, use that separator instead of INBOX's.
	[8416f66ac5ab]

2007-06-26  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-append.c:
	APPEND {0+} didn't eat the finishing CRLF.
	[3d14f363f921]

2007-06-25  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/imap/cmd-list.c, src/lib-storage/mail-
	namespace.c, src/lib-storage/mail-namespace.h, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added list setting to namespaces to control whether mailboxes in the
	namespace are visible with LIST command without giving the namespace
	prefix (eg. does LIST "" * show the mailboxes or not)
	[c192277a81b3]

	* src/imap/cmd-list.c:
	Put UW-IMAP emulation back after all
	[75e3aedc0568]

	* src/lib-storage/mail-namespace.c:
	Make sure there is exactly one inbox=yes namespace.
	[0d409ce8daae]

	* src/imap/cmd-list.c:
	Cleaned up LIST ref "" handling. Removed some UW-IMAPisms, they
	shouldn't be needed.
	[de3a087ea8d2]

2007-06-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-file.c:
	Better race condition fix for mmaped log files
	[e5da155f44c3]

	* src/lib-index/mail-transaction-log-file.c:
	Handle race conditions in mmap()ed transaction logs better.
	[0c0a829a9a63]

	* dovecot-example.conf, src/plugins/mail-log/mail-log-plugin.c:
	Added mail_log_events, mail_log_group_events and mail_log_fields
	settings to mail_log plugin.
	[ea050869097b]

2007-06-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c:
	Map the log files only after they've all been found. Otherwise we
	could have skipped some transactions from the end of non-head logs.
	[512f8982ae8b]

	* src/lib-index/mail-transaction-log-file.c:
	Log an error if non-head log file couldn't be synced to the next
	file's prev_file_offset position.
	[a250c1a48471]

	* src/lib-index/mail-transaction-log-file.c:
	Handle partial reads with mmap_disable=no correctly.
	[2a05cff7eca4]

	* src/lib-index/mail-transaction-log-append.c:
	Fixed in-memory indexes
	[e1347a122140]

2007-06-20  Andrey Panin  <pazke@donpac.ru>

	* src/master/Makefile.am, src/master/capabilities-posix.c,
	src/master/capabilities.h, src/master/main.c:
	Move POSIX capabilities dropping into separate function.
	[4f22660ffd33]

2007-06-10  Andrey Panin  <pazke@donpac.ru>

	* src/auth/auth-request-handler.c, src/auth/auth-request.c, src/auth
	/auth-request.h, src/auth/auth.c, src/auth/mech.c, src/auth/mech.h:
	Further const'ification of struct mech_module.
	[bdb16967be64]

2007-06-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-file.c:
	If read() returned a partial transaction, don't give an error
	because it could be just that kernel temporarily didn't return the
	expected data.
	[01c94fef3578]

	* src/lib-index/mail-transaction-log-file.c:
	If log offsets are broken, don't assert-crash.
	[b6cf05796f6d]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-view-sync.c:
	DEBUG: Verify header counters/lowwaters more often.
	[bcf58c66a099]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-write.c:
	Updating index file by overwriting changed parts didn't work
	correctly.
	[9493c7f1ebca]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Use CMP_ST_MTIME() instead of #ifdefing nanoseconds ourself.
	[92bc0a7580f6]

	* src/lib/compat.h:
	Added CMP_ST_MTIME() and CMP_ST_CTIME() macros that compare also
	nanoseconds if they're available.
	[2e6a977b1d6a]

2007-06-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-write.c:
	Don't rotate transaction log if log head sequence doesn't match the
	current synced log's sequence.
	[67cc6420c4e6]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	write.c:
	When updating dovecot.index file, write the header always.
	map->write_base_header now tells only if the file needs to be
	updated at all if nothing else has changed.
	[f61313136530]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index.h, src/lib-index/mailbox-list-
	index-sync.c, src/lib-storage/index/cydir/cydir-sync.c, src/lib-
	storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox/dbox-
	sync.c, src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/list/index-mailbox-
	list-sync.c:
	mail_index_sync_begin() takes now flags parameter instead of two
	booleans. Cleanups to recent handling.
	[b25c9ca2142b]

	* src/lib-index/mail-index-sync-update.c:
	Removed broken asserts
	[3d4344ad057c]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c:
	Update log_file_head_offset when replacing current syncing map.
	[a8926e90df2a]

	* src/lib-index/mail-index-sync.c:
	Log also the position in log file for sync errors.
	[5ce403e0ef56]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c:
	Handle corruption marking by unlinking dovecot.index file. Removed
	mail_index_write_base_header().
	[98d5e3bd4d13]

	* src/lib-index/mail-index-sync-update.c:
	If a forced syncing fails, it could be because of broken log file
	position. If it happens, fsck the index.
	[1af7024361e9]

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index.c:
	Keep index->map always usable, never NULL.
	[622ab4de7d66]

	* src/lib-index/mail-hash.c, src/lib-index/mail-index-map.c, src/lib-
	index/mail-index-private.h, src/lib-index/mail-index-sync-update.c,
	src/lib-index/mail-index-sync.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-index.c,
	src/lib-index/mail-transaction-log-file.c, src/lib-index/mailbox-
	list-index.c:
	Removed index->hdr. Use index->map->hdr instead.
	[002aa9bbfcb2]

	* src/lib-index/mail-index-view-sync.c:
	s/view_sync_area_find/view_sync_is_hidden/
	[433ae8a32506]

	* src/plugins/quota/quota-maildir.c:
	If maildirsize file is being rewritten while we're trying to do
	that, recalculate it later instead of failing with "Unknown quota
	error".
	[213b597e57de]

2007-06-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-view-private.h, src/lib-index/mail-index-view-sync.c,
	src/lib-index/mail-index-view.c:
	View's counters can no longer be unreliable or broken.
	[901a9ba8cff7]

	* src/lib-index/mail-index-view-sync.c:
	Removed more unneeded code.
	[35806800d2bd]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c:
	Removed no-appends specific code that's unneeded now.
	[98a3ab6f8404]

	* src/lib-index/mail-index.h:
	Give MAIL_INDEX_VIEW_SYNC_FLAG_NOEXPUNGES a non-zero value so it
	actually works
	[9ebd052d07b0]

	* src/imap/imap-sync.c:
	Fixed last change
	[401710b07708]

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index.h,
	src/lib-storage/index/index-sync.c, src/lib-storage/list/index-
	mailbox-list.c:
	mail_index_view_sync_begin() can now sync only all or all but
	expunges. Changed sync_type to be flags.
	[4dcb14706561]

	* src/lib-storage/index/index-sync.c, src/lib-storage/mail-storage.h:
	Removed MAILBOX_SYNC_FLAG_NO_NEWMAIL handling.
	[2f0d30828c14]

	* src/imap/imap-sync.c:
	Handle delay-newmail workaround completely in the IMAP code.
	[9e762641180d]

2007-06-17  Timo Sirainen  <tss@iki.fi>

	* src/pop3/client.c:
	Even if mailbox sync fails, commit the transaction so that cache
	file gets updated.
	[8008fbb660c1]

	* src/imap/imap-fetch.c:
	Always commit FETCH transaction to make sure cached data is
	committed.
	[7851879631ea]

	* src/imap/imap-fetch.c:
	We didn't update last_output timestamp with long fetches, causing
	Dovecot to idle-disconnect the client.
	[6074f59f91ba]

2007-06-16  Timo Sirainen  <tss@iki.fi>

	* COPYING, src/auth/password-scheme.c, src/lib/Makefile.am,
	src/lib/sha2.c, src/lib/sha2.h:
	Added support for SHA256. Based on patch by Jasper Slits.
	[2cba4c0f3b4f]

	* src/auth/password-scheme.c:
	SMD5 scheme was broken, it was using SHA1 constants.
	[f71e234d72e4]

	* src/lib-storage/mail-copy.c:
	Added missing error logging for i_stream_read()
	[69a95671da35]

	* src/lib-index/mail-index-sync-update.c:
	Don't update log_file_tail_offset in header until syncing is
	finished.
	[a380a5dc9307]

	* src/lib-index/mail-index-fsck.c:
	Do a bit better job with fscking.
	[0096aaf83731]

	* src/lib-index/Makefile.am, src/lib-index/mail-index-private.h, src
	/lib-index/mail-index-sync.c, src/lib-index/mail-index-write.c:
	Moved mail_index_write() to its own file.
	[929cc98ac04e]

	* src/lib-index/mail-index-sync.c:
	Don't mark the transaction log corrupted if some record inside it
	was broken. Changed the error message as well.
	[911b9f0cca13]

	* src/util/idxview.c:
	Updated to use the new head/tail headers
	[a230272b3f28]

	* src/lib-index/mail-cache-sync-update.c:
	Don't update cache record links if we know it's already been done.
	[18fb3f1fc41b]

2007-06-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	index-view.c, src/lib-index/mail-index.h, src/lib-index/mail-
	transaction-log-append.c, src/lib-index/mail-transaction-log-file.c,
	src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log.c, src/lib-index/mail-transaction-log.h:
	int/ext/mailbox sync offset changes: Combined mailbox and int
	offsets to "tail" offset and renamed ext offset to "head". This
	makes it clearer how they're supposed to be used.
	[420a386fa27a]

	* src/lib-index/mail-cache-lookup.c:
	Crashfix if cache is unusable.
	[25ec1a8ec702]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-
	transaction-log.h:
	Removed syncs_done array. Instead track appends and expunges
	separately. Also fixed handling no-appends in some situations.
	[c71f611bbffc]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c:
	Removed unused/unneeded code.
	[5378991bed09]

	* src/lib-index/mail-cache-sync-update.c:
	Handle cache sync updates without breaking, although in a bit non-
	optimal way for now.
	[702aa70c9f34]

	* src/lib-index/mail-index-view-sync.c:
	Assert-crashfixes to handling non-external expunges (broken by last
	changes)
	[bf9f97c09250]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	view-sync.c, src/lib-storage/index/cydir/cydir-sync.c, src/lib-
	storage/index/dbox/dbox-sync-expunge.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Treat non-external expunges as requests for expunging messages. If
	it's actually possible, mailbox syncing will then commit external
	expunges.
	[1fa32e040ea5]

2007-06-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-storage.c:
	Treat unknown errors as temporary errors.
	[7d9edc094ec7]

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync.c:
	Preserve mbox files' atime when saving/syncing.
	[7a57631e2d6c]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	When saving a message to maildir without dovecot-uidlist file, give
	the newly created uidlist file a non-zero uidvalidity.
	[05d06a1c0f0c]

	* src/lib-storage/index/mbox/mbox-storage.c:
	When trying to use mbox file as the root directory, give a nice
	error.
	[94161a726c8b]

	* src/lib-index/mail-cache-sync-update.c:
	Log an error if cache offset is tried to be updated with itself.
	[9f2e5701105f]

	* src/lib-index/mail-cache-compress.c:
	Code cleanup / optimization
	[615a8c31ff47]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache.c:
	Changed mail_cache_foreach() to be an iterator:
	mail_cache_lookup_iter_*()
	[b3ed52bbeca7]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	transaction.c, src/lib-index/mail-cache.h:
	s/field/field_idx/
	[5763c2548153]

	* src/lib-index/mail-cache-decisions.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c:
	Cache code cleanups
	[5f0832288007]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	transaction.c, src/lib/array-decl.h:
	Declare a global uint32_t array type.
	[4b5ce642957d]

	* src/lib-index/mail-cache-lookup.c:
	Make sure cache file is opened when looking up headers.
	[c341ded6a38a]

	* src/lib-index/mail-cache-lookup.c:
	Cache decisions weren't updated when doing header lookups.
	[e53cd8613542]

	* src/lib-index/mail-cache-lookup.c:
	Header lookup from cache could have returned garbage after headers
	in very rare conditions.
	[ae289a38b59a]

2007-06-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	transaction.c:
	Update day headers while committing appends.
	[c3e32c3fb2bf]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.h:
	Removed sync_mask parameter from mail_transaction_log_view_set().
	The user will now have to check the types itself.
	[7aab5d99fb45]

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	transaction-log-view.c:
	Compiler warning fixes
	[d9d047b743d5]

	* src/lib-index/mail-transaction-log-view.c:
	Fix for last change
	[0f5ece26eb4f]

	* src/lib-index/Makefile.am, src/lib-index/mail-index-sync-update.c,
	src/lib-index/mail-index-sync.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-transaction-log-view.c, src/lib-index
	/mail-transaction-util.c, src/lib-index/mail-transaction-util.h:
	Removed mail-transaction-util.[ch]. They're no longer needed.
	[c81b3cb0fb70]

	* src/lib-index/mail-transaction-log-view.c:
	Don't bother checking record sizes here. They're already checked
	elsewhere, and most records are variable sized so they can't even be
	checked here.
	[e0feb74cf46e]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-
	transaction-log-file.c, src/lib-index/mail-transaction-log-view.c:
	Don't assume that transaction record type is a bitmask in the
	transaction log file, even though it's internally used as such.
	[ad695be143ff]

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index.h,
	src/lib-storage/index/index-sync.c, src/lib-storage/list/index-
	mailbox-list.c:
	Changed mail_index_view_sync_begin() to take enum
	mail_index_view_sync_type. This limits how the view can be synced,
	but we couldn't handle before more than the 3 useful cases anyway.
	[9c53047d3b2c]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-
	transaction-log-view.c:
	Added more corruption detection code.
	[18d7a680ffae]

	* src/lib-index/mail-transaction-log-view.c:
	Variable name cleanup
	[5f4a7e932c4f]

	* src/lib-index/mail-transaction-log-view.c:
	Minor variable name cleanup
	[18202bbd0865]

	* src/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	transaction-log-view.c:
	Moved duplicated log record validation code to a single place.
	[8b481177965a]

	* src/lib-index/mail-index-sync.c:
	Broken UID ranges weren't checked early enough.
	[15199d6c9354]

	* src/lib-index/mail-transaction-log-file.c, src/lib-index/mail-
	transaction-log-private.h:
	Fixes to mail_transaction_log_file_map() error handling.
	[4a08705e97f5]

	* src/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log.c:
	Handle mail_transaction_log_file_map() == 0 failures.
	[11d39b7f07ff]

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log-
	file.c, src/lib-index/mail-transaction-log-private.h, src/lib-index
	/mail-transaction-log.c, src/lib-index/mail-transaction-log.h:
	mail_transaction_log_move_to_memory() can't fail anymore. Moved the
	code to
	-log-file.c.
	[dcf5dbb6a76a]

	* dovecot-example.conf:
	Updated passwd/shadow comments.
	[e07a4c8ad2d5]

	* doc/documentation.txt:
	Updated
	[950feba5248e]

	* dovecot-example.conf:
	Point to disable_plaintext_auth in auth mechanisms comment.
	[02727b2c2fe9]

2007-06-12  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	If save failed, log also the reason for it.
	[d4b7a25c814c]

	* src/master/mail-process.c:
	nfs check: If namespaces are defined, use the first one's location
	instead of mail_location.
	[c6cde7452a9f]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-sync.c:
	If new/ directory is lost when syncing, assume the mailbox was
	deleted and make the mailbox inconsistent (which disconnects the
	client).
	[7420a96ebc8f]

	* dovecot-example.conf:
	mail_location mbox comment update.
	[f63c99fe863c]

	* src/master/auth-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Master and client sockets have default paths now. Section name only
	needs to be uncommented now for the socket to be created.
	[afc4e8a7354a]

	* dovecot-example.conf, src/auth/userdb-vpopmail.c:
	Added quota_template parameter to userdb vpopmail.
	[4c62af215aca]

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-fs.c, src/plugins/quota/quota-maildir.c,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota.c:
	Allow backend-specific quota rules with backend=<string>. Support
	Maildir++ quota limit strings with Maildir++ backend.
	[4bf8438b497f]

	* src/plugins/quota/quota.c:
	Give an error if quota rule is missing ':'.
	[96b796e46d0e]

	* src/plugins/quota/quota.c:
	Allow bytes=n in quota rule definitions.
	[3c3159eb7175]

	* src/lib-imap/imap-date.h:
	Fixed comments.
	[d6a86d6367fe]

	* src/lib-imap/imap-date.c, src/lib-imap/imap-date.h:
	If utc_mktime() fails, it doesn't mean that the IMAP date was
	invalid. Instead the year is just too low or too high to fit to
	time_t. If this happens, use the lowest/highest allowed value
	instead of returning failure.
	[bbd2b811d3e6]

	* src/lib-index/mail-index.h:
	Added padding to struct mail_index_header so it's 64bit aligned with
	32bit systems also.
	[01b90449db90]

	* src/lib/printf-format-fix.c:
	Fix for %m handling
	[8be3bb396e3f]

	* src/lib-storage/index/maildir/maildir-save.c:
	Don't crash if saving runs out of disk space while in the middle of
	moving multiple files to new/ or cur/ directories and the already
	moved files had keywords.
	[90976e6d7e45]

	* src/master/main.c:
	When using --log-error, log also a warning and an error.
	[b929827ddbe9]

	* src/plugins/acl/acl-backend-vfile.c:
	Fix also ACL file stat() failing with EACCES.
	[54c7e74ec973]

	* src/plugins/acl/acl-backend-vfile.c:
	If dovecot-acl file can't be opened because of permission problems,
	treat it as if no-one has access to the mailbox.
	[49412bd6b931]

2007-06-11  Timo Sirainen  <tss@iki.fi>

	* src/master/ssl-init.c:
	Compile fix for building without SSL.
	[5845fccd55da]

	* configure.in:
	If crypt() is in libc, don't link -lcrypt even if it's found.
	[1034fcaffcce]

	* configure.in:
	Don't bother checking if cap_init() is in libc, it's always in
	libcap.
	[a28ab423949a]

	* configure.in:
	Simplify some checks with AC_SEARCH_LIBS()
	[c1f51c3510ca]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-lock.c,
	src/lib-index/mail-index-map.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	keywords.c, src/lib-index/mail-index-sync-private.h, src/lib-index
	/mail-index-sync-update.c, src/lib-index/mail-index-sync.c, src/lib-
	index/mail-index-view-private.h, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-index.c,
	src/lib-index/mail-index.h, src/lib-index/mail-transaction-log-
	append.c, src/lib-index/mail-transaction-log-file.c, src/lib-index
	/mail-transaction-log-private.h, src/lib-index/mail-transaction-log-
	view.c, src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-log.h, src/util/idxview.c:
	Initial commit for major index file code cleanup.

	 - dovecot.index file isn't anymore required to be updated when
	syncing.
	 - Getting the latest index file mapping is now done always by reading
	dovecot.index and then reading the latest changes from
	dovecot.index.log.
	 - mmap()ing dovecot.index file is slower than reading it, so it's not
	currently done unless the file is at 256kB. This may change though.
	 - Some things are still broken.
	[c2362f144f15]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Log an error if a message was expunged unexpectedly.
	[5a37076852d4]

	* src/lib-index/Makefile.am, src/lib-index/mail-transaction-log-
	file.c, src/lib-index/mail-transaction-log-private.h, src/lib-index
	/mail-transaction-log.c:
	Moved mail transaction log file related code to its own file.
	[d28185a3131a]

	* src/lib-index/Makefile.am, src/lib-index/mail-index-map.c, src/lib-
	index/mail-index-private.h, src/lib-index/mail-index.c:
	Moved mail index map related code to its own file.
	[0d2a6a7f2a1b]

	* AUTHORS, COPYING:
	Updated.
	[d36a14c37c22]

	* src/plugins/fts-squat/squat-trie.c:
	Fixed to work with the new unichar API
	[d7302155b97f]

	* src/lib/unichar.c, src/lib/unichar.h:
	Rewrote some code and cleaned up the API
	[8101787cdd1c]

	* src/lib/ioloop-kqueue.c, src/lib/ioloop-notify-kqueue.c:
	These files are MIT licensed nowadays.
	[ff5ba9cb6cd0]

	* AUTHORS, configure.in, src/lib/Makefile.am, src/lib/failures.c,
	src/lib/printf-format-fix.c, src/lib/printf-format-fix.h, src/lib
	/printf-upper-bound.c, src/lib/printf-upper-bound.h, src/lib/str.c,
	src/lib/strfuncs.c, src/lib/strfuncs.h:
	Require C99 compatible vsnprintf(). Removed
	printf_string_upper_bound() and replaced the code with
	printf_format_fix*() and vsnprintf().
	[09415e6a0892]

	* src/lib/buffer.c, src/lib/buffer.h:
	Added buffer_get_pool()
	[7577fb89916a]

	* src/lib/Makefile.am, src/lib/failures.c, src/lib/printf-format-
	fix.c, src/lib/printf-format-fix.h, src/lib/printf-upper-bound.c,
	src/lib/strfuncs.c, src/lib/strfuncs.h:
	Renamed printf_string_fix_format() to printf_format_fix() and moved
	it to its own file.
	[74e06273985b]

	* src/lib/failures.c:
	Use printf_string_fix_format() instead of
	printf_string_upper_bound() to convert %m and verify that %n isn't
	used.
	[2cde91fb7283]

	* src/lib/strfuncs.c:
	printf_string_fix_format() now panics if %n modifier is found.
	[922607d52fba]

2007-06-10  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-vpopmail.c:
	Compile fix
	[698da4fededa]

	* src/lib/istream.c, src/lib/network.c, src/lib/strfuncs.c:
	Removed some asserts that check if parameter is NULL. We can't check
	for all errors anyway, so a segfault is a good enough "assert".
	[e383a6b4f4da]

	* src/lib/network.c:
	Removed useless getnameinfo() call from net_gethostbyname()
	[f55afcf1ff7d]

	* src/lib/network.c:
	If getnameinfo() fails, use gai_strerror() as well to return the
	error string.
	[dc8d38798296]

2007-06-04  Timo Sirainen  <tss@iki.fi>

	* src/lib/macros.h:
	Added missing __attr_*__ macros for non-GCC compilers.
	[ca38eb4189e8]

2007-06-03  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/pop3-login/client.c:
	Check idle timeouts only when there are clients connected.
	[0021765627f3]

2007-05-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	compile fix for last change
	[2e1fed4f0138]

	* src/imap/cmd-append.c:
	Use more corking
	[c53d0698d56f]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Deleting symlinked maildirs didn't work.
	[c981e66cc78e]

2007-05-29  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-set-size.c:
	If we're using posix_fallocate(), make it allocate only from EOF to
	where we want, instead of from the beginning of the file which tries
	to look for holes inside the file.
	[052f000ad273]

	* src/lib-index/mail-index.c:
	Better implementation for mail_index_uint32_to_offset() and
	mail_index_offset_to_uint32().
	[a0e59849a03d]

2007-05-27  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	Don't expand %variables in mail setting coming from userdb.
	[1680709ec0a2]

2007-05-25  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-dotlock.c:
	Continuing the previous time difference commit..
	[b796701a6927]

	* src/lib/file-dotlock.c:
	Log a warning if filesystem's clock is +-30 different from the
	system clock (fix the previous wrong check).
	[3c026711c35b]

	* src/lib/file-dotlock.c:
	If created dotlock file's ctime is smaller than the current time
	(NFS server's clock is wrong), log a warning.
	[fdc30be3b5e5]

2007-05-24  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/deliver/deliver.c, src/deliver/deliver.h,
	src/deliver/mail-send.c:
	Added rejection_reason setting for deliver.
	[f18a7fd8ac9a]

	* src/lib-mail/istream-header-filter.c:
	If there's no message body, the final read() should return -1, not
	-2
	[6533e11eda80]

2007-05-23  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	If Dovecot is already running, complain about it instead of wiping
	out login_dir and causing the already running Dovecot to break.
	[b118198fbfa3]

	* src/lib-index/mail-transaction-log.c:
	Combined mail_transaction_log_file_add_to_head() to
	mail_transaction_log_file_add_to_list()
	[115d13bb1a47]

	* src/lib-index/mail-transaction-log-append.c:
	We don't need to get the hidden array position anymore.
	[42a62cd60308]

	* src/lib-index/mail-transaction-log-view.c, src/lib-index/mail-
	transaction-log.h:
	Added mail_transaction_log_view_is_last()
	[1273ce0585b3]

2007-05-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-append.c:
	Write transactions with two pwrite() calls instead of lots of tiny
	ones.
	[501aab713b0d]

	* Merge branch: When compressing cache file, update the cache file
	offsets using the existing sync transaction.
	[29764126e1a6]

	* src/lib-index/mail-index-transaction.c, src/lib-index/mail-index-
	view-private.h, src/lib-index/mail-index-view-sync.c, src/lib-index
	/mail-transaction-log-append.c:
	mail_index_view_add_hidden_transaction() takes now a whole area
	parameter so it has to be called only once for each transaction,
	instead of each for each transaction record.

	mail_index_view_add_synced_transaction() is no longer public.
	[965e401fcb7b]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache.h, src
	/lib-index/mail-index-sync.c:
	When compressing cache file, update the cache file offsets using the
	existing sync transaction.
	[9404d2c41cb2]

	* src/lib-index/mail-index-sync.c:
	Crashfix for error conditions
	[aff5fb7bb580]

	* src/lib-index/mail-index-sync.c:
	Sync transaction needs to be created later or we'll crash
	[e5f0e8cf6089]

	* src/lib-index/mail-index-transaction.c:
	Cleanups
	[b0754b4d187d]

	* src/plugins/quota/quota-storage.c:
	If mail_set_uid() returns failure, don't crash.
	[119ffb997eda]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Typofix: transction -> transaction
	[6c61d716274b]

	* src/lib-index/mail-index-transaction.c, src/lib-index/mail-index.h:
	Added mail_index_transaction_is_expunged()
	[bc3652a97a0f]

	* src/lib-index/mail-index-transaction.c, src/lib-index/mail-index.h:
	Typofix: transction -> transaction
	[caf10b68dad7]

	* src/lib-index/mail-index-transaction.c, src/lib-index/mail-index.h:
	Added mail_index_transaction_get_view()
	[648237c9ae76]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index.h, src/lib-index/mailbox-list-
	index-sync.c, src/lib-storage/index/cydir/cydir-sync.c, src/lib-
	storage/index/cydir/cydir-sync.h, src/lib-storage/index/dbox/dbox-
	save.c, src/lib-storage/index/dbox/dbox-sync.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/list/index-mailbox-list-sync.c:
	mail_index_sync_begin() returns now transaction directly so the
	syncing code doesn't need to create it. It's also automatically
	committed/rollbacked.
	[453128e12b11]

	* src/lib-index/mail-index-transaction.c, src/lib-index/mail-index.h:
	Added mail_index_transction_reset().
	[7274df228c04]

	* src/auth/mech.c:
	Declare extern struct mech_modules also const
	[209a71c37012]

2007-05-22  Andrey Panin  <pazke@donpac.ru>

	* src/auth/mech-anonymous.c, src/auth/mech-cram-md5.c, src/auth/mech-
	digest-md5.c, src/auth/mech-plain.c, src/auth/mech.c,
	src/auth/mech.h:
	Constify struct mech_module.
	[8591bc9961d9]

2007-05-22  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	If startup fails because of configuration problems, print "Invalid
	configuration in <path>"
	[e1b3043c0d90]

	* src/master/master-settings.c:
	Complain about missing pop3_uidl_format if pop3 is enabled.
	[21fbdc921152]

	* src/pop3/main.c:
	Changed pop3_uidl_format error message once again.
	[9fdd9c18c879]

	* src/lib/ioloop.c:
	Added wiki link to "time moved backwards" error.
	[d5212abd8d61]

2007-05-19  Timo Sirainen  <tss@iki.fi>

	* .cvsignore, doc/.cvsignore, doc/wiki/.cvsignore, src/.cvsignore,
	src/auth/.cvsignore, src/deliver/.cvsignore, src/dict/.cvsignore,
	src/imap-login/.cvsignore, src/imap/.cvsignore, src/lib-
	auth/.cvsignore, src/lib-charset/.cvsignore, src/lib-
	dict/.cvsignore, src/lib-imap/.cvsignore, src/lib-index/.cvsignore,
	src/lib-mail/.cvsignore, src/lib-ntlm/.cvsignore, src/lib-
	otp/.cvsignore, src/lib-settings/.cvsignore, src/lib-sql/.cvsignore,
	src/lib-storage/.cvsignore, src/lib-storage/index/.cvsignore, src
	/lib-storage/index/cydir/.cvsignore, src/lib-
	storage/index/dbox/.cvsignore, src/lib-
	storage/index/maildir/.cvsignore, src/lib-
	storage/index/mbox/.cvsignore, src/lib-storage/list/.cvsignore, src
	/lib-storage/register/.cvsignore, src/lib/.cvsignore, src/login-
	common/.cvsignore, src/master/.cvsignore, src/plugins/.cvsignore,
	src/plugins/acl/.cvsignore, src/plugins/convert/.cvsignore,
	src/plugins/expire/.cvsignore, src/plugins/fts-lucene/.cvsignore,
	src/plugins/fts-squat/.cvsignore, src/plugins/fts/.cvsignore,
	src/plugins/imap-quota/.cvsignore, src/plugins/lazy-
	expunge/.cvsignore, src/plugins/mail-log/.cvsignore, src/plugins
	/mbox-snarf/.cvsignore, src/plugins/quota/.cvsignore,
	src/plugins/trash/.cvsignore, src/plugins/zlib/.cvsignore,
	src/pop3-login/.cvsignore, src/pop3/.cvsignore, src/util/.cvsignore:
	We no longer need .cvsignore files.
	[0f708e4950af]

	* .hgignore, Makefile.am, autogen.sh:
	Mercurify the repository
	[69ca46114593]

2007-05-17  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/plugins/Makefile.am, src/plugins/mbox-
	snarf/.cvsignore, src/plugins/mbox-snarf/Makefile.am, src/plugins
	/mbox-snarf/mbox-snarf-plugin.c, src/plugins/mbox-snarf/mbox-snarf-
	plugin.h:
	Added mbox snarf plugin to move mails from /var/spool/mail to ~/mbox
	if it exists.
	[fbb4bdbbf374]

	* src/login-common/main.c, src/master/login-process.c, src/master
	/master-login-interface.h:
	Moved SSL listen fd to 4. stdout is now redirected to log.
	[2ed5abe3aaef]

2007-05-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb.c:
	If wanted scheme is "" (userdb static lookup), switch it to the
	actual scheme we got. This should make caching work right for those
	lookups.
	[139416ee311e]

	* src/lib-storage/index/cydir/cydir-mail.c:
	Fixed fetching physical/virtual size when it wasn't already in
	cache.
	[3e711b998274]

	* src/lib-storage/index/cydir/cydir-save.c:
	If saving is aborted, don't leave temporary files lying around.
	Update cache file while saving messages.
	[6b06a60d7e44]

	* src/lib-storage/index/cydir/cydir-save.c:
	Don't leak memory and file descriptors in appends. fsync() unless
	it's disabled.
	[950d7af6ed14]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index.c:
	If index file is shared locked while we're trying to exclusively
	lock it, don't wait 2 seconds for the lock. Also don't bother
	copying the index into a temp file when it's locked, do that only
	when it's being unlocked so it doesn't have to be written twice.
	[c46edae0e454]

	* dovecot-example.conf, src/lib-index/mail-cache.c, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/list/index-mailbox-
	list.c, src/master/mail-process.c, src/master/master-settings-
	defs.c, src/master/master-settings.c, src/master/master-settings.h:
	Removed mmap_no_write setting. The only OS requiring it is OpenBSD,
	so we're now forcing mmap_disable=yes with it instead.
	dovecot.index.cache file is the most important file to mmap(), but
	since this didn't work with mmap_no_write, there's not much point in
	keeping special code paths for minimal gains.
	[d1de7c486763]

	* src/lib-storage/index/index-mail-headers.c:
	Assert-crashfix in some conditions.
	[ebf443cae951]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	When recreating dovecot-uidlist file based on dovecot.index, we set
	next_uid value wrong if new messages had been added.
	[547c5d58aa08]

2007-05-15  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	If Return-Path doesn't contain user and domain, treat it as missing
	Return-Path.
	[e41accd3d6f1]

	* src/lib-storage/index/maildir/maildir-util.c:
	Handle symlinks pointing to nonexisting files better.
	[5f14caa1ed9b]

2007-05-14  Timo Sirainen  <tss@iki.fi>

	* TODO:
	updated
	[eba408782747]

	* src/lib-index/mail-index-lock.c:
	Log an error if pwrite_full() fails while overwriting index mapping.
	[85ae96fc1375]

2007-05-13  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c, src/auth/passdb-ldap.c, src/auth/passdb-
	sql.c, src/auth/password-scheme.c:
	Empty password doesn't anymore allow user to log in with any
	password, unless nopassword extra field is also set.
	[121af23cfc65]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	Moved index directory creation code to index_storage_alloc().
	[5ea33dbddbae]

	* src/lib-storage/list/index-mailbox-list.c, src/lib-storage/mailbox-
	list.c:
	Fixes for INDEX=MEMORY
	[a0310d7b6971]

	* dovecot-example.conf, src/deliver/deliver.c:
	Added quota_full_tempfail setting.
	[0d6cd7281aa7]

	* src/master/ssl-init-main.c:
	fix
	[9dd899f563fe]

	* src/lib-storage/index/cydir/cydir-mail.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/mail-error.h, src/lib-storage/mail-
	storage-private.h, src/lib-storage/mail.c:
	Added MAIL_ERROR_EXPUNGED. Set the error whenever expunged message
	is tried to be accessed.
	[a4e5053fb31a]

	* src/deliver/deliver.c, src/imap/cmd-fetch.c, src/imap/commands-
	util.c, src/imap/imap-search.c, src/lib-storage/Makefile.am, src
	/lib-storage/index/cydir/cydir-save.c, src/lib-storage/index/cydir
	/cydir-storage.c, src/lib-storage/index/dbox/dbox-save.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/dbox/dbox-
	uidlist.c, src/lib-storage/index/index-search.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-storage/index/mbox
	/mbox-file.c, src/lib-storage/index/mbox/mbox-lock.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-sync.c, src/lib-
	storage/list/mailbox-list-fs-iter.c, src/lib-storage/list/mailbox-
	list-fs.c, src/lib-storage/list/mailbox-list-maildir.c, src/lib-
	storage/list/subscription-file.c, src/lib-storage/mail-error.c, src
	/lib-storage/mail-error.h, src/lib-storage/mail-storage-private.h,
	src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h, src
	/lib-storage/mailbox-list-private.h, src/lib-storage/mailbox-list.c,
	src/lib-storage/mailbox-list.h, src/plugins/acl/acl-mailbox-list.c,
	src/plugins/acl/acl-mailbox.c, src/plugins/acl/acl-storage.c,
	src/plugins/convert/convert-storage.c, src/plugins/lazy-expunge
	/lazy-expunge-plugin.c, src/plugins/quota/quota-storage.c,
	src/plugins/quota/quota.c, src/pop3/client.c:
	Error handling rewrite.
	[f717fb4b31c0]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	storage/index/index-storage.c:
	Removed mail_index_get_last_error() and MAIL_INDEX_ERROR_*. All the
	index errors are internal errors.
	[0d8f6bfb9fdb]

	* src/imap/cmd-delete.c, src/imap/cmd-list.c, src/imap/cmd-rename.c,
	src/imap/commands-util.c, src/imap/commands-util.h, src/lib-storage
	/mail-storage.c, src/lib-storage/mail-storage.h:
	Removed mail_storage_set_list_error(). Handle the errors directly.
	[44db6ddd5a17]

	* src/imap/mail-storage-callbacks.c, src/lib-storage/mail-storage.h:
	Removed alert_no_diskspace callback. It wasn't used anywhere.
	[5f50bde79009]

	* src/lib-ntlm/ntlm-encrypt.c:
	cleanup
	[6f924ecdc154]

	* src/pop3/Makefile.am, src/pop3/client.c, src/pop3/mail-storage-
	callbacks.c:
	Removed empty mail storage callbacks.
	[f5a126edd902]

	* src/deliver/deliver.c, src/imap/cmd-fetch.c, src/imap/commands-
	util.c, src/imap/imap-search.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/plugins/convert/convert-storage.c, src/plugins/lazy-
	expunge/lazy-expunge-plugin.c, src/pop3/client.c:
	lib-storage doesn't need the ability to return syntax errors. They
	should be checked before lib-storage is called.
	[74d3236313c1]

	* src/util/dovecotpw.c:
	Fixed to use the new password scheme APIs
	[01e318d8304b]

	* src/lib-storage/index/index-search.c:
	Don't try to handle 0 in messagesets by returning a nice error
	message. They're already checked in the IMAP code.
	[8b97d6bbff35]

	* src/master/ssl-init.c:
	If ssl-parameters.dat has been updated externally, copy it to our
	base_dir.
	[03284c5091cf]

	* src/deliver/deliver.c:
	Added -e parameter to write rejection error to stderr and exit with
	EX_NOPERM instead of sending the rejection by executing sendmail.
	[86886a8fb0f1]

	* src/deliver/smtp-client.c:
	If sendmail_path was set in config file, it was cleared just before
	trying to execute it.
	[117ec208d66b]

	* src/master/main.c, src/master/ssl-init-main.c, src/master/ssl-
	init.c, src/master/ssl-init.h:
	When running multiple Dovecot instances, only one of them needs to
	regenerate ssl-parameters.dat.
	[b02af502bcd6]

	* src/lib-imap/imap-date.c:
	imap_parse_date() returns failure now if there's any extra data
	after the date.
	[945966bb18c2]

	* src/imap/cmd-search.c, src/imap/imap-search.c, src/lib-storage/index
	/index-search.c, src/lib-storage/mail-search.h:
	Parse search dates already in IMAP code.
	[6789ba80419b]

	* src/auth/Makefile.am, src/auth/auth-request.c, src/auth/auth-
	request.h, src/auth/auth-worker-client.c, src/auth/mech-apop.c,
	src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c, src/auth/mech-
	ntlm.c, src/auth/mech-otp.c, src/auth/mech-rpa.c, src/auth/mech-
	skey.c, src/auth/passdb-ldap.c, src/auth/passdb-passwd-file.c,
	src/auth/passdb.c, src/auth/passdb.h, src/auth/password-scheme-cram-
	md5.c, src/auth/password-scheme-ntlm.c, src/auth/password-scheme-
	rpa.c, src/auth/password-scheme.c, src/auth/password-scheme.h,
	src/auth/userdb-static.c:
	All password schemes can now be encoded with base64 or hex. The
	encoding is ".b64", ".base64" or ".hex" suffix in the scheme, eg.
	{plain.b64}.

	Password scheme verification function can now be set to NULL, in
	which case the verification is done by generating a new crypted
	password from given plaintext password and comparing it.
	[971050640e3b]

	* src/auth/mech-rpa.c:
	cleanup: use a bit less magic numbers
	[e9c43a73180c]

	* src/auth/password-scheme.c:
	Changed schemes_buf to schemes_arr array.
	[b676a52d365a]

	* src/auth/mech-cram-md5.c, src/auth/password-scheme-cram-md5.c,
	src/lib/hmac-md5.c, src/lib/hmac-md5.h:
	hmac-md5 API cleanups. Use arrays with MD5_RESULTLEN and
	CRAM_MD5_CONTEXTLEN sizes instead of pointers.
	hmac_md5_set_cram_context() takes a const array now.
	[8d8f8b31ac82]

	* src/auth/password-scheme.c:
	cleanup
	[36c8fbd896fc]

	* src/auth/auth-request.c, src/auth/auth-request.h, src/auth/auth-
	worker-client.c, src/auth/mech-apop.c, src/auth/mech-cram-md5.c,
	src/auth/mech-digest-md5.c, src/auth/mech-ntlm.c, src/auth/mech-
	otp.c, src/auth/mech-rpa.c, src/auth/mech-skey.c, src/auth/passdb-
	blocking.c, src/auth/passdb-ldap.c, src/auth/passdb-sql.c,
	src/auth/passdb.c, src/auth/passdb.h, src/auth/password-scheme.c,
	src/auth/password-scheme.h, src/auth/userdb-static.c:
	Removed enum passdb_credentials. Use scheme strings directly
	instead. This makes it possible to implement new mechanisms in
	plugins.
	[f8dc0bdb06a7]

2007-05-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c:
	Crashfix when saving mails
	[29ac17ec78ff]

	* src/imap/cmd-copy.c:
	We sent "Hang in there.." too early sometimes and checked it too
	often.
	[cf45e0fdcf52]

	* src/lib/file-dotlock.c:
	Give a better error message if dotlock is deleted immediately under
	us (or more likely an OS bug).
	[eb4902fc7693]

	* src/master/main.c:
	Print also Dovecot version with dovecot -n.
	[271c35971331]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Keyword characters weren't sorted in the maildir filename.
	[6c89106dee21]

	* src/lib-storage/index/maildir/maildir-storage.c:
	If we don't have write access to cur/ directory, treat the mailbox
	as read-only.
	[8d7ed4bf54c6]

	* src/auth/auth-request-handler.c, src/auth/auth-request.c, src/auth
	/auth-request.h:
	Changed auth_request->created to last_access and update it a bit
	more often. If there are slow authentications this could help avoid
	removing timeouted auth requests too early.
	[dad0e22b735a]

2007-05-09  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	%c wasn't exported to auth worker processes. Patch by Andrey Panin
	[e33158bc72b0]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Make sure uid_validity and next_uid aren't 0 in the uidlist header.
	[13cfb82736d7]

	* src/lib/mountpoint.c:
	Compile fix for Tru64.
	[790dec1815e0]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Updated error message.
	[1c4fd25893bd]

2007-04-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c:
	If we synced the mbox while saving the message (happens only with
	quota plugin loaded), we could have used a wrong append offset
	(calculated before sync) which caused "Unexpectedly lost From-line"
	errors, and depending on the sync either extra NUL lines or Content-
	Length header written over existing mails (quite unlikely).
	[ee2f0f1cd700]

	* src/lib-storage/index/mbox/mbox-save.c:
	If pop3_uidl_format=%m, it wasn't cached correctly when saving new
	messages (eg. with deliver). X-Delivery-ID wasn't used in the MD5
	sum, causing duplicates when POP3 recalculated the MD5 sum later.
	[071d9bc5a075]

2007-04-18  Timo Sirainen  <tss@iki.fi>

	* src/auth/userdb-ldap.c, src/auth/userdb-sql.c:
	s/User not found/Unknown user/ to be consistent
	[0d297d61d4d4]

2007-04-17  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Removed note about branch_1_0
	[9da09dcec39b]

	* src/plugins/expire/expire-plugin.c, src/plugins/trash/trash-
	plugin.c:
	Updated to support namespaces
	[1fd9616157e4]

	* src/lib-storage/mail-namespace.c, src/lib-storage/mail-namespace.h:
	Added mail_namespace_update_name()
	[36ebd0fe2076]

	* NEWS:
	updated from v1.0
	[94baeec6df73]

	* configure.in, src/imap/cmd-append.c, src/imap/cmd-copy.c:
	Implemented UIDPLUS extension.
	[0bc6ec4cddab]

	* src/lib-storage/index/cydir/cydir-save.c, src/lib-storage/index/dbox
	/dbox-save.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-transaction.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/mbox/mbox-save.c:
	Fixed mailbox_transaction_commit_get_uids() to actually work and not
	just crash.
	[9805becea644]

	* src/lib-storage/index/cydir/cydir-save.c, src/lib-storage/index/dbox
	/dbox-save.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-transaction.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/plugins/expire/expire-plugin.c,
	src/plugins/fts/fts-storage.c, src/plugins/lazy-expunge/lazy-
	expunge-plugin.c, src/plugins/quota/quota-storage.c:
	Added mailbox_transaction_commit_get_uids() which returns the UID
	range for saved/copied messages.
	[896845fbc4ed]

	* src/imap/cmd-list.c:
	fix
	[00aaa3ba21c0]

	* src/lib-storage/index/cydir/cydir-transaction.c, src/lib-
	storage/index/dbox/dbox-transaction.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-transaction.c, src/lib-
	storage/index/mbox/mbox-transaction.c:
	Map mailbox to mail_index_view, not to mail_index. Fixes crashes
	when the same mailbox was opened multiple times.
	[1b7edfc77e9f]

	* src/lib-index/mail-index-dummy-view.c, src/lib-index/mail-index-
	view.c:
	mail_index_view.module_contexts array wasn't initialized.
	[def1b9bd5466]

	* src/imap/commands.c, src/imap/commands.h, src/plugins/imap-quota
	/imap-quota-plugin.c:
	Added command flags parameter to command_register()
	[cce4074b7876]

	* src/lib-storage/list/mailbox-list-fs-iter.c, src/lib-storage/list
	/mailbox-list-maildir-iter.c, src/lib-storage/mail-namespace.c, src
	/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h, src
	/lib-storage/mailbox-list-private.h, src/lib-storage/mailbox-list.h,
	src/plugins/convert/convert-storage.c, src/plugins/quota/quota-
	storage.c:
	Removed HAS_INBOX and SHARED_NAMESPACE flags from mail storage and
	mailbox list flags. They can be directly taken from struct
	mail_namespace.
	[eb8dc8a79d5d]

	* src/plugins/imap-quota/imap-quota-plugin.c, src/plugins/quota/quota-
	dict.c, src/plugins/quota/quota-maildir.c, src/plugins/quota/quota-
	plugin.c, src/plugins/quota/quota-private.h, src/plugins/quota
	/quota-storage.c, src/plugins/quota/quota.c,
	src/plugins/quota/quota.h:
	Use sync_notify() callback to count expunges. This makes the
	calculation much more reliable than the previous method. Also did
	some API cleanups.
	[88307a648e0e]

	* src/lib-storage/mail-namespace.c:
	HAS_INBOX flag wasn't correctly set to namespaces.
	[64bdb703f6bd]

	* src/lib-storage/index/cydir/cydir-sync.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/dbox/dbox-storage.h, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/index/mbox/mbox-
	sync.c, src/lib-storage/mail-storage-private.h:
	Call sync_notify() once at the end of syncing. Allow accessing mails
	even while syncing, as long as it's safe to do so.
	[47274663a71c]

	* src/auth/passdb-ldap.c, src/auth/password-scheme.c, src/auth
	/password-scheme.h:
	Do scheme=MD5 password!=$1$.. -> PLAIN-MD5 change only with LDAP.
	[063b184597fa]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/cydir/cydir-sync.c, src/lib-storage/index/cydir/cydir-
	sync.h, src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-sync-expunge.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/maildir/maildir-storage.c, src
	/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	sync-private.h, src/lib-storage/index/mbox/mbox-sync-update.c, src
	/lib-storage/index/mbox/mbox-sync.c, src/lib-storage/mail-storage-
	private.h:
	Added sync_notify() callback to struct mail_storage. It's now called
	for expunges and flag/keyword changes (except with cydir).
	[24b751bc0995]

	* src/lib-dict/dict.c:
	Error message update
	[ead3e882c9c9]

	* src/lib-index/mailbox-list-index-sync.c, src/lib-storage/list/index-
	mailbox-list.c, src/lib-storage/list/index-mailbox-list.h:
	Mailbox list index fixes
	[3a3051d0e79b]

	* src/lib-imap/imap-match.h:
	comment updates
	[12b3d542146c]

2007-04-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c:
	Log an error and disconnect with unknown commands.
	[5c31d0c83258]

	* TODO:
	update
	[657406346288]

2007-04-12  Timo Sirainen  <tss@iki.fi>

	* src/plugins/convert/convert-storage.c:
	Don't create INBOX mailbox, so with maildir the maildirfolder file
	won't be created there.
	[54babfeab440]

	* src/auth/db-ldap.h:
	#define LDAP_DEPRECATED for now.
	[9f1d15aa9fce]

	* src/auth/db-ldap.c:
	Queue userdb lookup request until bind is finished (with
	auth_bind=yes).
	[522c50117d5d]

	* src/auth/passdb-ldap.c:
	Don't crash if doing non-plaintext ldap passdb lookup for unknown
	user.
	[ed1e0985b9ea]

2007-04-11  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/Makefile.am, src/plugins/acl/acl-api-private.h,
	src/plugins/acl/acl-api.c, src/plugins/acl/acl-api.h,
	src/plugins/acl/acl-backend-vfile-acllist.c, src/plugins/acl/acl-
	backend-vfile.c, src/plugins/acl/acl-backend-vfile.h,
	src/plugins/acl/acl-backend.c, src/plugins/acl/acl-cache.c,
	src/plugins/acl/acl-cache.h, src/plugins/acl/acl-mailbox-list.c,
	src/plugins/acl/acl-plugin.c, src/plugins/acl/acl-storage.c:
	Create dovecot-acl-list file that lists all mailboxes where non-
	owner has lookup right. Use the file when listing mailboxes in
	shared/public namespace.
	[71b5fd371b9a]

	* src/plugins/acl/acl-backend-vfile.c:
	Don't break if empty data was given
	[0e7a8c5c7c13]

	* src/lib-storage/list/index-mailbox-list.c, src/lib-storage/mailbox-
	list-private.h, src/lib-storage/mailbox-list.c, src/lib-storage
	/mailbox-list.h:
	Added mailbox_list_get_permissions() and MAILBOX_LIST_ITER_RAW_LIST.
	[3c8d3c722539]

	* src/lib-storage/mail-namespace.c:
	bugfix
	[9b6e50c4ae56]

	* src/lib-storage/mailbox-tree.c:
	Keep children/nochildren flags updated.
	[0639cfcf8fdb]

	* src/lib-storage/list/mailbox-list-maildir-iter.c, src/lib-storage
	/mailbox-tree.c, src/lib-storage/mailbox-tree.h:
	Moved mailbox_tree iteration code from maildir++ to common code, and
	rewrote it.
	[c03655b70b57]

	* src/plugins/acl/acl-backend-vfile.c:
	cache_secs fixes
	[76a3f60b243e]

	* src/plugins/acl/acl-api.h:
	cleanup
	[125a422edfda]

	* src/plugins/acl/acl-api.c, src/plugins/acl/acl-api.h:
	acl_object_list_deinit() now takes **iter parameter.
	[a930eb8d06ce]

	* src/lib/file-dotlock.c:
	Use safe_mkstemp() instead of doing it ourself.
	[a240e903841e]

	* src/lib/Makefile.am, src/lib/safe-mkstemp.c, src/lib/safe-mkstemp.h:
	Added safe_mkstemp().
	[8669dc1e4036]

	* src/lib/file-dotlock.c:
	Use lstat() instead of stat() to check if temporary file already
	exists.
	[7082bef9081e]

	* src/plugins/acl/acl-api-private.h, src/plugins/acl/acl-api.c,
	src/plugins/acl/acl-api.h, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/acl/acl-backend.c, src/plugins/acl/acl-mailbox-list.c,
	src/plugins/acl/acl-mailbox.c, src/plugins/acl/acl-plugin.h,
	src/plugins/acl/acl-storage.c:
	acl_backend is now tied to mailbox_list instead of mail_storage.
	[1216c0ebe492]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/mail-namespace.c, src/lib-storage/mail-namespace.h, src
	/lib-storage/mailbox-list-private.h, src/lib-storage/mailbox-list.c,
	src/lib-storage/mailbox-list.h:
	Added mailbox_list to struct mail_namespace. Added a few functions
	to get private data out of mailbox_list.
	[7d828d1b39ab]

	* src/lib-storage/list/mailbox-list-fs.c:
	cleanup
	[b3dd56440595]

	* dovecot-example.conf, src/plugins/acl/acl-backend-vfile.c:
	Added cache_secs parameter to vfile backend.
	[ebffd0ccd22a]

2007-04-10  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Typofix
	[fab24638eee7]

	* dovecot-example.conf, src/plugins/convert/convert-plugin.c,
	src/plugins/convert/convert-storage.c, src/plugins/convert/convert-
	storage.h, src/plugins/convert/convert-tool.c:
	Changed convert_skip_dotfiles to convert_skip_dotdirs.
	convert_skip_broken_mailboxes=yes is enough to skip non-mbox
	dotfiles.
	[7aa36ab24c3b]

	* dovecot-example.conf, src/plugins/convert/convert-plugin.c,
	src/plugins/convert/convert-storage.c, src/plugins/convert/convert-
	storage.h, src/plugins/convert/convert-tool.c:
	Added convert_skip_dotfiles and convert_alt_hierarchy_char settings.
	[c69786bd2017]

	* src/plugins/convert/convert-storage.c:
	Create destination storage before locking home directory, so home
	dir is created if it doesn't yet exist.
	[e607f517d08b]

2007-04-07  Timo Sirainen  <tss@iki.fi>

	* autogen.sh:
	fixes
	[b8dd889066ca]

	* src/plugins/convert/convert-storage.c:
	If directory for destination storage doesn't exist, create it.
	[435f61888541]

	* src/plugins/convert/convert-storage.c:
	Mailbox names weren't converted in subscription list.
	[eaea98799f5a]

2007-04-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Give "mbox file was modified while we were syncing" error only if we
	detect some problems in the mbox file. The check can't be trusted
	with NFS.
	[fd13f04e1fda]

	* src/login-common/ssl-proxy-openssl.c:
	Send list of CA names to client when using
	ssl_verify_client_cert=yes.
	[bad62bc7bafc]

2007-04-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	memory leak fixes
	[3b25d89caa93]

	* src/lib-mail/Makefile.am:
	typofix
	[aedfd6623f84]

	* src/lib-mail/Makefile.am, src/lib-mail/message-body-search.c, src
	/lib-mail/message-body-search.h, src/lib-mail/message-header-
	search.c, src/lib-mail/message-header-search.h, src/lib-mail
	/message-search.c, src/lib-mail/message-search.h, src/lib-
	storage/index/index-search.c:
	Removed message body/header searchers. They're now combined into one
	message-search.
	[94bc3fbdecd5]

	* src/lib-mail/message-decoder.c:
	Removed accidentally committed debug stuff
	[aee211178d23]

	* src/lib-mail/message-body-search.c, src/lib-mail/message-header-
	search.c:
	Use str_find_*() to perform the actual search.
	[2d601735ef93]

	* src/lib-mail/istream-header-filter.c, src/lib-mail/message-body-
	search.c, src/lib-mail/message-body-search.h, src/lib-mail/message-
	decoder.c, src/lib-mail/message-header-parser.c, src/lib-mail
	/message-header-parser.h, src/lib-mail/message-parser.c, src/lib-
	mail/message-parser.h, src/lib-storage/index/index-mail-headers.c,
	src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	search.c, src/lib-storage/index/mbox/mbox-sync-parse.c,
	src/plugins/fts/fts-storage.c:
	Header parser has now flags parameter to tell it how to handle
	linefeeds. Changed message parser's boolean parameter to enum as
	well.
	[5dee807e53cf]

	* src/lib-mail/message-header-parser.c:
	We didn't add CRs to full_value if original input had them.
	[baf3367d2450]

	* src/lib/Makefile.am, src/lib/str-find.c, src/lib/str-find.h:
	Added Boyer-Moore string searching.
	[f322edd67a4f]

	* src/lib-mail/message-decoder.c:
	Some data still wasn't uppercased
	[7b6511e67476]

	* src/lib-mail/message-header-parser.c:
	cleanup / minor optimization
	[c7c3855454cb]

	* src/lib-mail/message-header-decode.c:
	Rewrite/cleanup
	[2608b9e18bbb]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.h, src/lib-storage/index/index-search.c:
	Don't feed index_mail_parser headers while searching message bodies,
	unless we actually need something from there.
	[96f0b56489a2]

2007-04-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-body-search.c:
	cleanup
	[295e76b78063]

	* src/lib-mail/message-header-search.c:
	cleanup
	[7c62d66b3184]

	* src/lib-storage/index/index-search.c:
	fix
	[fec5b65282a2]

	* src/lib-mail/message-body-search.c, src/lib-mail/message-body-
	search.h:
	Use message-decoder instead of doing it ourself.
	[fbdf65a581b8]

	* src/lib-mail/message-decoder.c, src/lib-mail/message-decoder.h,
	src/plugins/fts/fts-storage.c:
	Renamed message_decoder_init() to message_decoder_init_ucase() and
	changed it to uppercase all the output.
	[518a77f3bf49]

	* src/lib-mail/message-decoder.c:
	Fix for base64 handling
	[93e9e081855a]

	* src/lib/base64.c, src/lib/base64.h:
	API change: Returns now 1 if ok, 0 if end of base64 marker found.
	[c46a29e0ea9d]

	* src/lib/base64.c:
	Skip trailing linefeeds/whitespace.
	[d1168da66050]

	* src/lib-storage/index/index-search.c:
	Don't handle TEXT searches in header searches. It's done later
	anyway.
	[65250cfebd74]

	* src/lib-mail/message-parser.c, src/lib-mail/message-parser.h, src
	/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c:
	Removed message_parse_from_parts(). Added
	message_parser_init_from_parts() instead. Searching code now uses it
	whenever possible.
	[6cd889c652b0]

	* src/lib-mail/message-body-search.c, src/lib-mail/message-body-
	search.h, src/lib-mail/message-header-search.c, src/lib-mail
	/message-header-search.h, src/lib-storage/index/index-search.c:
	Search API cleanups
	[d0caa9a44d1c]

	* src/lib-mail/message-body-search.c, src/lib-mail/message-body-
	search.h, src/lib-storage/index/index-search.c:
	Message body search API changed to init/search/deinit. Searching now
	builds the init structure only once instead of for every message.
	[9414946e1eb0]

	* src/lib-mail/message-header-decode.c:
	Minor optimization.
	[b7573b83f999]

	* src/lib-charset/charset-iconv.c:
	Cleanup
	[212bbdc55065]

	* autogen.sh:
	Fixed to work with POSIX sh.
	[e9745c1c4d14]

	* src/deliver/deliver.c, src/deliver/deliver.h, src/imap/Makefile.am,
	src/imap/client.c, src/imap/client.h, src/imap/cmd-create.c,
	src/imap/cmd-list.c, src/imap/cmd-namespace.c, src/imap/commands-
	util.c, src/imap/commands-util.h, src/imap/main.c,
	src/imap/namespace.c, src/imap/namespace.h, src/lib-
	storage/Makefile.am, src/lib-storage/mail-namespace.c, src/lib-
	storage/mail-namespace.h, src/lib-storage/mail-storage-private.h,
	src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h,
	src/plugins/convert/convert-storage.c, src/plugins/expire/expire-
	tool.c, src/plugins/lazy-expunge/lazy-expunge-plugin.c,
	src/pop3/client.c, src/pop3/client.h, src/pop3/main.c:
	Moved namespace handling to lib-storage. Beginnings of namespace
	support for non-IMAP parts of Dovecot.
	[4862cb37106c]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c:
	Minor optimization. If we just checked that the directory existed,
	don't mkdir() it.
	[e1e19a0db57d]

	* dovecot-example.conf, src/lib-storage/list/index-mailbox-list-
	sync.c, src/lib-storage/list/index-mailbox-list.c, src/master/mail-
	process.c, src/master/master-settings-defs.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added mailbox_list_index_disable setting.
	[21199280aa3b]

	* src/deliver/deliver.c:
	Load plugins before chrooting.
	[e57b685ad093]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/driver-sqlite.c, src/lib-sql/sql-api-private.h, src/lib-sql/sql-
	api.c, src/lib-sql/sql-api.h:
	Added sql_result_setup_fetch() which makes it easier to fetch rows
	into structures. Added sql_result_get_field_value_binary(), which is
	currently not implemented for MySQL.
	[72ee0521dfaf]

	* src/lib-sql/driver-pgsql.c:
	If trying to escape a string before being connected, connect first.
	[888916aeb353]

	* src/lib-sql/driver-pgsql.c:
	Don't send commit/rollback if nothing was done in the transaction.
	[1d2066223bb0]

	* src/lib-sql/driver-pgsql.c:
	If reply is received from server before going to ioloop, don't hang.
	[9f7f311260be]

	* src/plugins/quota/quota-dict.c:
	Recalculate quota if it's negative.
	[571c43d9080c]

	* src/auth/passdb-pam.c:
	Lowercase the PAM service name when calling with "args = *". Linux
	PAM did this internally already, but at least BSD didn't.
	[22f0e7b297d6]

	* src/auth/passdb-pam.c:
	Set PAM_RUSER.
	[6363c9c8c0e8]

	* src/auth/userdb-vpopmail.c:
	Call vset_lastauth()
	[c87340986664]

2007-04-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-ldap.c:
	Error message changed
	[3a8a3b2badab]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-util.c:
	Cleaned up maildir_create_tmp() a bit. It now also returns the
	filename instead of the whole path, as was originally intended.
	[befe6a6233c7]

2007-03-31  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mailbox-list.c:
	assert updates
	[61ef8b18a12c]

	* src/lib/var-expand.c, src/lib/var-expand.h:
	Added var_expand_table_build()
	[9b873c82bc88]

	* src/lib-storage/index/cydir/cydir-save.c:
	Removed unneeded code
	[40d3318b49d4]

	* src/lib/istream-data.c:
	fix
	[c44bb2b3994d]

	* src/lib/istream-file.c, src/lib/istream-internal.h,
	src/lib/istream.c, src/plugins/zlib/istream-zlib.c:
	Moved I_STREAM_MIN_SIZE to header
	[834118e5329f]

	* src/lib/istream-file.c, src/lib/istream-internal.h,
	src/lib/istream.c, src/plugins/zlib/istream-zlib.c:
	Moved i_stream_compress() to generic code
	[460d6aeee7af]

	* src/plugins/zlib/istream-zlib.c:
	Use the new generic istream functionality.
	[c19ab50e54ea]

	* src/lib/istream-data.c, src/lib/istream-file.c, src/lib/istream-
	internal.h, src/lib/istream-mmap.c, src/lib/istream.c:
	If istream implementation doesn't set set_max_buffer_size() or
	stat(), implement them ourself. Moved some generic code to istream.
	[b3999af65adb]

	* src/lib/mmap-util.h:
	marked mmap_get_page_size() constant.
	[64726e4be948]

	* src/lib/module-context.h:
	Compile fix
	[4cc6848dc73b]

	* src/lib/array.h:
	Use COMPILE_ERROR_IF_TYPES_NOT_COMPATIBLE() for validating the data
	type.
	[0c096f057e24]

	* src/auth/auth-request.c, src/auth/auth-request.h, src/auth/auth-
	worker-client.c, src/auth/db-sql.c, src/auth/db-sql.h, src/auth
	/mech-apop.c, src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c,
	src/auth/mech-ntlm.c, src/auth/mech-otp.c, src/auth/mech-rpa.c,
	src/auth/mech-skey.c, src/auth/passdb-sql.c, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/userdb-static.c:
	Reverted accidental commit. This code isn't ready yet.
	[769aaaee6821]

	* src/auth/db-ldap.c, src/auth/db-sql.c, src/lib-settings/settings.h,
	src/master/master-settings-defs.c, src/master/master-settings.c:
	Added type checks to setting defines.
	[331337b735c9]

2007-03-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/list/mailbox-list-fs-iter.c, src/lib-storage/list
	/mailbox-list-maildir-iter.c, src/lib-storage/mailbox-list.c:
	cleanup
	[b5404d36494f]

	* src/lib-storage/mailbox-list.c:
	cleanup
	[21ccc57946b8]

	* src/lib-storage/mailbox-list.c:
	Verify that mailbox name is valid before deleting it.
	[7df495c556ff]

	* src/lib-storage/list/mailbox-list-fs.c, src/lib-storage/list
	/mailbox-list-maildir.c, src/lib-storage/mailbox-list.c:
	Moved some common code to mailbox-list.c
	[402796d50c3e]

	* src/lib-storage/index/cydir/cydir-storage.h, src/lib-
	storage/index/cydir/cydir-transaction.c, src/lib-storage/index/dbox
	/dbox-storage.h, src/lib-storage/index/dbox/dbox-transaction.c, src
	/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-transaction.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/index/mbox/mbox-
	transaction.c:
	Changed *_transaction_created() to static.
	[35a54122b396]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage-private.h, src/lib-
	storage/mail-storage.c:
	Removed virtual mail_storage.get_last_error(). The implementation is
	always the same.
	[8e58322ef87e]

	* src/lib-storage/index/cydir/cydir-storage.h, src/lib-
	storage/index/dbox/dbox-storage.h, src/lib-storage/index/maildir
	/maildir-storage.h, src/lib-storage/index/mbox/mbox-storage.h:
	Removed unused macros
	[89fb28593639]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	cleaned up mailbox closing code
	[8141168f86e1]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	mailbox-check.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage-private.h, src/lib-
	storage/mail-storage.c:
	Moved notify settings to struct mailbox. Removed the parameters from
	notify_changes(), they're now set before calling it.
	[014236cf3dcc]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/mail-storage.c:
	mailbox_open/create: Moved the mailbox name validation and error
	clearing into common mail-storage.c
	[91b1f01b9307]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	sync.c, src/lib-storage/index/mbox/mbox-storage.c:
	Allow index_mailbox.is_recent() to be NULL if it's not needed.
	[56832d6557dc]

	* src/auth/auth-request.c, src/auth/auth-request.h, src/auth/auth-
	worker-client.c, src/auth/db-sql.c, src/auth/db-sql.h, src/auth
	/mech-apop.c, src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c,
	src/auth/mech-ntlm.c, src/auth/mech-otp.c, src/auth/mech-rpa.c,
	src/auth/mech-skey.c, src/auth/passdb-sql.c, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/userdb-static.c, src/lib-
	storage/index/cydir/cydir-storage.c, src/lib-storage/index/dbox
	/dbox-storage.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/mail-storage-private.h, src/lib-storage/mail-storage.c:
	Moved all storage destruction code to mail-storage.c and made
	destroy() optional. Removed set_callbacks(). Made autodetect()
	optional.
	[163b48489bc6]

	* src/deliver/deliver.c, src/imap/namespace.c, src/lib-
	storage/index/cydir/cydir-storage.c, src/lib-storage/index/dbox
	/dbox-storage.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/mail-storage-private.h, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h, src/plugins/convert/convert-
	storage.c, src/plugins/expire/expire-tool.c, src/pop3/main.c:
	Removed mail_storage_create_with_data(). mail_storage_create() with
	driver=NULL behaves the same way. Removed parameters from
	mail_storage.create(), they're now put into the storage structure
	before calling create().
	[08b42ced91a6]

	* src/lib-storage/index/cydir/cydir-storage.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/mail-storage-private.h, src/lib-storage/mail-storage.c:
	Added virtual mail_storage.alloc() function and changed create() to
	work differently.
	[105e0cd21036]

	* src/lib-storage/index/cydir/cydir-save.c, src/lib-
	storage/index/cydir/cydir-storage.c, src/lib-storage/index/cydir
	/cydir-storage.h, src/lib-storage/index/cydir/cydir-sync.c, src/lib-
	storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox/dbox-
	keywords.c, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox/dbox-
	storage.c, src/lib-storage/index/dbox/dbox-storage.h, src/lib-
	storage/index/dbox/dbox-sync-expunge.c, src/lib-storage/index/dbox
	/dbox-sync-full.c, src/lib-storage/index/dbox/dbox-sync.c, src/lib-
	storage/index/dbox/dbox-uidlist.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-keywords.c, src/lib-storage/index/maildir/maildir-mail.c,
	src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-util.c,
	src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/mail-storage-private.h:
	Removed struct index_storage abstraction. It's pointless.
	[78eaf595359c]

	* configure.in, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/cydir/.cvsignore, src/lib-
	storage/index/cydir/Makefile.am, src/lib-storage/index/cydir/cydir-
	mail.c, src/lib-storage/index/cydir/cydir-save.c, src/lib-
	storage/index/cydir/cydir-storage.c, src/lib-storage/index/cydir
	/cydir-storage.h, src/lib-storage/index/cydir/cydir-sync.c, src/lib-
	storage/index/cydir/cydir-sync.h, src/lib-storage/index/cydir/cydir-
	transaction.c:
	Added a simple cydir mail storage backend. It trusts index files
	completely: if the indexes are gone, the mailbox starts completely
	empty and overwriting the existing mail files. So probably not a
	good idea to use this in production yet.
	[daca7ed634c0]

	* dovecot-example.conf:
	Added a note about dovecot -n
	[b0951692c45c]

	* configure.in, src/lib/file-set-size.c:
	Use posix_fallocate() if possible. Also did minor optimizations to
	the implementation.
	[3660736f8163]

2007-03-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/list/mailbox-list-fs.c:
	Grow initial pool size
	[3eaa301305fa]

	* src/lib/ostream-crlf.c:
	stream_errno wasn't updated with errors in crlf stream.
	[3c4aad29f392]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-
	transaction-private.h, src/lib-index/mail-index-transaction.c, src
	/lib-index/mail-index-view-private.h, src/lib-index/mail-index.c,
	src/lib-index/mail-index.h:
	Better type safety to module_contexts arrays. Already fixed some
	bugs.
	[a0a1432bb4e8]

	* src/lib-storage/index/maildir/maildir-mail.c:
	Fix for 64bit systems
	[0c74fc2e814e]

	* dovecot-example.conf:
	OS X's Mail v2.1 (at least) no longer breaks without delay-newmail.
	[3f1eb49a8555]

	* src/imap/imap-thread.c, src/lib-storage/index/dbox/dbox-storage.c,
	src/lib-storage/index/dbox/dbox-storage.h, src/lib-
	storage/index/dbox/dbox-transaction.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-transaction.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/maildir/maildir-transaction.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/index/mbox/mbox-transaction.c, src/lib-
	storage/list/index-mailbox-list-sync.c, src/lib-storage/list/index-
	mailbox-list.c, src/lib-storage/list/index-mailbox-list.h, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mailbox-list-private.h, src/lib-storage/mailbox-list.c,
	src/lib/Makefile.am, src/lib/module-context.h,
	src/plugins/acl/Makefile.am, src/plugins/acl/acl-mailbox-list.c,
	src/plugins/acl/acl-mailbox.c, src/plugins/acl/acl-plugin.h,
	src/plugins/acl/acl-storage.c, src/plugins/expire/expire-plugin.c,
	src/plugins/fts-lucene/Makefile.am, src/plugins/fts-lucene/fts-
	backend-lucene.c, src/plugins/fts-lucene/fts-lucene-plugin.c,
	src/plugins/fts-lucene/fts-lucene-plugin.h, src/plugins/fts-
	squat/Makefile.am, src/plugins/fts/Makefile.am, src/plugins/fts/fts-
	storage.c, src/plugins/lazy-expunge/lazy-expunge-plugin.c,
	src/plugins/mail-log/mail-log-plugin.c, src/plugins/quota/quota-
	private.h, src/plugins/quota/quota-storage.c,
	src/plugins/trash/Makefile.am, src/plugins/zlib/zlib-plugin.c:
	Better type safety to module_contexts arrays. Already fixed some
	bugs.
	[7a6db5ec047d]

	* src/lib/macros.h:
	Added HAVE_TYPEOF, COMPILE_ERROR_IF_TRUE() and
	COMPILE_ERROR_IF_TYPES_NOT_COMPATIBLE() macros.
	[bca896b09c7a]

	* src/imap/cmd-delete.c, src/imap/cmd-rename.c, src/lib-
	storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox/dbox-
	storage.c, src/lib-storage/index/dbox/dbox-storage.h, src/lib-
	storage/index/dbox/dbox-sync-expunge.c, src/lib-storage/index/dbox
	/dbox-sync-full.c, src/lib-storage/index/dbox/dbox-uidlist.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/list/index-mailbox-list-sync.c, src
	/lib-storage/list/mailbox-list-fs-iter.c, src/lib-storage/list
	/mailbox-list-fs.c, src/lib-storage/list/mailbox-list-maildir-
	iter.c, src/lib-storage/list/mailbox-list-maildir.c, src/lib-storage
	/mail-storage-private.h, src/lib-storage/mail-storage.c, src/lib-
	storage/mail-storage.h, src/lib-storage/mailbox-list-private.h, src
	/lib-storage/mailbox-list.c, src/lib-storage/mailbox-list.h,
	src/plugins/acl/acl-mailbox-list.c, src/plugins/acl/acl-mailbox.c,
	src/plugins/acl/acl-storage.c, src/plugins/lazy-expunge/lazy-
	expunge-plugin.c, src/plugins/mail-log/mail-log-plugin.c,
	src/plugins/quota/quota-plugin.c, src/plugins/quota/quota-plugin.h,
	src/plugins/quota/quota-storage.c, src/plugins/quota/quota.c:
	Moved delete/rename operations to mailbox_list API. Fixed
	mbox/maildir to work with either fs/maildir++ directory layout. They
	can be changed by appending :LAYOUT=fs|maildir++ to mail_location.
	[beabd433cdae]

2007-03-28  Timo Sirainen  <tss@iki.fi>

	* src/util/rawlog.c:
	Fixed to work with chrooting
	[04404fd54cf6]

	* src/master/mail-process.c:
	When using chrooting, force the home directory to have '/' prefix so
	it's not treated as relative.
	[ce1e1fab1e1d]

	* src/lib/restrict-access.c:
	After chrooting try to chroot to $HOME instead of to /. If home
	doesn't exist or chrooting fails there, fallback to /.
	[3a7ec48f8808]

	* dovecot-example.conf:
	Added a note about namespaces working only with IMAP.
	[208c4fe8e1c9]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If we find duplicate hard links which haven't changed for 30 secs,
	unlink() one of the filenames.
	[293bc7d1062f]

	* doc/wiki/Makefile.am.in:
	.txt files weren't included in the tarball
	[041c4185273e]

	* autogen.sh, configure.in, doc/Makefile.am, doc/USE-WIKI-INSTEAD,
	doc/documentation.txt, doc/variables.txt, doc/wiki/.cvsignore,
	doc/wiki/Makefile.am.in, dovecot-example.conf:
	Added documentation to doc/wiki/. autogen.sh downloads them from
	dovecot.org if they don't exist. Changed wiki links in dovecot-
	example.conf to point to the doc/wiki/ directory instead.
	[9d36800df1ae]

	* src/lib-mail/message-parser.c:
	yet another fix
	[d9b7957a7255]

	* dovecot-example.conf, src/auth/auth.c, src/auth/auth.h, src/auth
	/mech-gssapi.c, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added auth_gssapi_hostname setting.
	[c5401a8f4679]

	* src/imap/cmd-list.c:
	LIST "" "" should return something even if we don't have a namespace
	with empty prefix. Use INBOX namespace's separator then.
	[97f9bdbe924d]

2007-03-27  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	/dev/null was opened too late.
	[2704fc574e70]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Disable index files if index directory can't be created.
	[bbb7b3d57593]

	* src/login-common/sasl-server.c:
	If authentication fails for any reason, reset waiting_auth_reply.
	[bd1be5cb3985]

	* src/login-common/sasl-server.c:
	Update waiting_auth_reply early enough, so that if client does
	another authentication after a failed one it can send the input
	before waiting for server's initial reply.
	[f768041d91e6]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	Potential crashfix
	[6f5ff9a7554f]

2007-03-26  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c, src/master/master-settings.c:
	Before unlinking auth sockets at startup, try connecting to them
	first to see if there's anyone listening (another Dovecot process).
	If there is, kill ourself.
	[2b4fa90860dd]

	* src/imap/cmd-idle.c:
	crashfix
	[712409f6d4d3]

	* src/lib-index/mail-index.c:
	If mail_index_move_to_memory() fails, make sure the future calls to
	it also will fail.
	[c8bb83980ff7]

	* src/auth/passdb-passwd.c, src/auth/passdb-shadow.c:
	Verify the password with auth_request_password_verify() so passwd
	and shadow can be used as master and deny passdbs.
	[088b4934a8f0]

	* src/auth/passdb-pam.c:
	removed unneeded include
	[8845275a763a]

	* dovecot-example.conf:
	Added a note about dirsize's slowness with maildir.
	[20ee7c039604]

	* src/deliver/mail-send.c:
	If we couldn't send a bounce because of a missing Return-Path
	header, just return success instead of failing with EX_TEMPFAIL.
	[f5a179e4f405]

	* src/deliver/deliver.c:
	If storage creation failed, exit with EX_TEMPFAIL instead of
	EX_CONFIG.
	[72aaf2069aa3]

	* src/deliver/deliver.c:
	INBOX fallbacking with -n wasn't working.
	[448901e76f93]

	* src/imap/cmd-search.c:
	Send search result in one write()
	[2500d126f865]

	* src/lib-mail/message-decoder.c:
	fixes
	[01c63c0adc3b]

	* src/lib-storage/index/mbox/mbox-storage.c:
	added missing #include
	[3a3e1b234858]

	* src/plugins/fts-squat/squat-trie.c, src/plugins/fts-squat/squat-
	uidlist.c:
	Write to files in larger blocks
	[ca182382e346]

	* src/imap/cmd-search.c:
	crashfix
	[b50399a48c5a]

	* src/lib/ioloop.c:
	Don't crash when timeouts have leaked
	[e429b50d10a3]

	* src/plugins/fts-squat/squat-trie.c:
	Fixes to utf-8 input
	[8d837913b66b]

	* src/deliver/deliver.c:
	failure callback was still set too late.
	[22e2a1eef74b]

	* src/imap/client.c, src/imap/cmd-append.c:
	hang fix after appends
	[4ba74fec49a4]

2007-03-25  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-squat/squat-trie.c, src/plugins/fts-squat/squat-
	uidlist.c:
	fixes
	[3ec03a4c0f26]

	* src/plugins/fts/fts-storage.c:
	crashfix
	[874210e30dba]

	* src/auth/auth-request.c:
	If "nopassword" is set, don't crash if password is non-NULL. However
	give an error if the password is non-empty.
	[79187982328f]

	* src/lib-mail/message-parser.c:
	Fixes
	[bea1e1bab54a]

	* src/lib-mail/message-decoder.c:
	Don't try to access output variable's contents. They are undefined
	at least in the first call.
	[73032525bca0]

	* src/lib-index/mail-index-transaction.c:
	Don't read/write outside boundaries if the extension data's size
	isn't divisible with 32bit.
	[b9580d02084b]

	* src/imap/cmd-search.c:
	minor cleanup
	[2847c8f771a8]

	* src/lib-storage/index/maildir/maildir-util.c:
	File's group could have been wrong with shared mailboxes
	[d3a89872744e]

	* src/plugins/fts-lucene/lucene-wrapper.cc:
	Fixes
	[82d6f9673c05]

	* src/plugins/fts/fts-api-private.h, src/plugins/fts/fts-api.c,
	src/plugins/fts/fts-api.h, src/plugins/fts/fts-storage.c:
	Don't crash if another search is started while we're still building
	the index for the first search.
	[22d04968449a]

	* src/lib-storage/index/index-transaction.c:
	crashcheck
	[fd57e9c99846]

	* src/lib-storage/index/maildir/maildir-save.c:
	Crashfix
	[c7a3410a8f1f]

	* src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins/fts-lucene
	/lucene-wrapper.cc, src/plugins/fts-lucene/lucene-wrapper.h:
	Create a locks directory under the lucene-indexed directory. Detect
	and delete stale locks. Fixed expunges to work.
	[72c91dc78fad]

	* src/lib-index/mail-cache-transaction.c:
	compile fix
	[94ace1b42ad9]

	* src/util/.cvsignore:
	updated
	[37e87dbdcae6]

2007-03-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-keywords.c:
	When adding new keywords, update the index file atomically so the
	keywords won't break if we crash in the middle of the header update.
	[9be95726e29f]

	* src/lib-index/mail-index-private.h:
	cleanup
	[730156248978]

	* src/lib-storage/index/maildir/maildir-sync.c:
	comment/duplicate link handling fixes.
	[3a0964ac3a5c]

2007-03-23  Timo Sirainen  <tss@iki.fi>

	* src/util/idxview.c:
	Try to avoid crashes a bit harder with broken cache files.
	[3b5269ad21d2]

	* src/lib-storage/index/dbox/dbox-save.c:
	minor cleanup
	[124e2e48c1f8]

	* src/lib-storage/index/maildir/maildir-copy.c:
	comment update
	[344ae496ee7e]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	When saving/copying mails, we must not do any sorting based on the
	filename to saved mails when they're added to uidlist, otherwise
	they could be saved to index with wrong UID.
	[434047e53586]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If duplicate links are found, rename() one over the other to get rid
	of it.
	[9a8402768b42]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Avoid infinite looping when buggy filesystems.
	[0c8705aad54c]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If saving to maildir causes flag/expunge syncs, don't crash.
	[4eeec560df01]

	* src/lib-index/mail-cache-transaction.c:
	If we update the fields list in header, it's committed immediately
	so if the transaction gets rollbacked, don't overwrite the already
	committed header.
	[00645e05ae96]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c:
	Last fix broke creating new uidlists.
	[ce1bfc98df29]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	If a broken X-UID header was found with a value larger than last
	seen X-UID (eg. empty mbox) but less than the expected UID value, we
	gave "UID inserted in the middle of mailbox" error.
	[783670f8a118]

	* src/master/mail-process.c:
	Fixed NFS check again with chroots
	[bf4a85a47901]

	* src/lib/home-expand.c, src/lib/home-expand.h:
	Added home_expand_tilde()
	[284f2994ea5f]

	* doc/Makefile.am, doc/dovecot-ldap-example.conf, doc/dovecot-
	ldap.conf, doc/dovecot-sql-example.conf, doc/dovecot-sql.conf,
	dovecot-example.conf:
	Renamed dovecot-sql/ldap.conf to dovecot-sql/ldap-example.conf. make
	install now installs them to sysconfdir.
	[2a6ff0bbc932]

	* src/master/mail-process.c:
	If chdir() failed, we still gave wrong reason
	[8b5844d257e7]

2007-03-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	~ in mbox root path wasn't expanded early enough
	[7e0f9862b524]

	* dovecot-example.conf, src/auth/passdb-passwd.c, src/auth/passdb-
	shadow.c:
	Added blocking=yes setting for passdb passwd and shadow also.
	[ba8da13e71da]

	* dovecot-example.conf:
	Removed security warnings from auth-master socket. They're not
	actually true. The clients can only look up userdb data, which is
	practically the same thing as what they can find from /etc/passwd
	(with system users of course).
	[0e64feabb0d2]

	* src/master/mail-process.c:
	Use alarm() to make sure that chdir() returns in 30 seconds (NFS..).
	Also if chdir() failed, we could have used wrong errno in the
	checks.
	[678621b6f1e0]

	* src/lib/mempool-system-clean.c:
	Actually use MEM_ALIGN_SIZE to get the alignment right
	[61255eb991c3]

	* src/lib/mempool-system-clean.c:
	Use 64bit alignment always
	[512cea8832e5]

	* src/lib/mempool-system-clean.c:
	Crashfix for systems without malloc_usable_size()
	[21dd8ade1300]

	* configure.in:
	Check if struct stat has tv_nsec fields
	[94f043494a12]

2007-03-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Check if mbox has been modified externally before doing any
	dangerous writes. Also changed the old "space needed changed
	unexpectedly" assert to a more informative panic.
	[d217ad85984c]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Changed assert to more informative panic message.
	[ccc83c11f0e2]

	* src/master/mail-process.c:
	NFS check + chroots broke home directory for the first login.
	[56cb17817e06]

	* dovecot-example.conf, src/auth/auth-master-connection.c, src/auth
	/userdb-static.c:
	If doing a plain userdb lookup with userdb static, verify the user's
	existence from passdb first, unless allow_all_users=yes
	[fdcea7e3cf0c]

	* src/deliver/auth-client.c:
	FAIL reply doesn't necessarily have parameters. Don't give "BUG:
	Unexpected input" if that happens.
	[c1d53e221cb2]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	If uidlist is deleted and we set the uidvalidity from the index
	file, set also next_uid.
	[e897aaa24cdd]

	* src/imap/cmd-copy.c, src/lib-storage/index/maildir/maildir-sync.c,
	src/lib-storage/mail-storage.h:
	When copying/syncing a lot of mails, send "* OK Hang in there"
	replies to client every 15 seconds so it doesn't just timeout the
	connection.
	[7d45edb81fe4]

	* src/imap/client.c:
	Keep better track of client->last_output timestamp.
	[fab770c51321]

2007-03-20  Timo Sirainen  <tss@iki.fi>

	* src/util/Makefile.am, src/util/idxview.c, src/util/logview.c:
	Added idxview and logview to dump index/cache/log file contents.
	[a42014a7d8be]

2007-03-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	If uidlist file doesn't exist but index files do, resync the maildir
	to create the uidlist.
	[35f18edd5f17]

2007-03-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-auth/auth-client.c, src/lib-auth/auth-client.h, src/login-
	common/main.c:
	Call auth_client_reconnect() when the last client has disconnected
	to make sure all the memory used by the auth connections get
	cleared.
	[8e2d0438d4ac]

	* src/login-common/main.c:
	Enable data_stack_set_clean_after_pop() for login processes
	[235433e7d9c2]

	* src/lib/data-stack.c, src/lib/data-stack.h:
	Added data_stack_set_clean_after_pop()
	[9e86dbe68663]

	* src/login-common/ssl-proxy-openssl.c:
	Make OpenSSL memory allocations go through system_clean_pool.
	[bde589bd09d4]

	* src/imap-login/client.c, src/login-common/login-proxy.c, src/login-
	common/main.c, src/login-common/master.c, src/login-common/ssl-
	proxy-gnutls.c, src/login-common/ssl-proxy-openssl.c,
	src/pop3-login/client.c:
	Set login process's default_pool to system_clean_pool. Changed some
	default_pool usages to system_pool directly where the cleaning
	doesn't matter.
	[4d358f3b7e3a]

	* configure.in:
	Committed accidentally a bit too many changes
	[e724f1e61592]

	* src/auth/auth-master-listener.c, src/dict/dict-server.c,
	src/lib/network.c, src/lib/network.h, src/login-common/main.c,
	src/master/auth-process.c, src/master/login-process.c:
	net_listen_unix() API changed a bit. -1 is now returned for errors
	that can be ignored (remote closed the socket) and -2 for everything
	else.
	[a977ad033903]

	* src/lib/lib.c:
	Removed imem_init()
	[ac0ef8053692]

	* configure.in, src/lib/Makefile.am, src/lib/imem.c, src/lib/imem.h,
	src/lib/mempool-system-clean.c, src/lib/mempool-system.c,
	src/lib/mempool.h:
	Added system_clean_pool. default_pool is now set statically, so it
	can be changed before calling lib_init(). Use malloc_usable_size()
	if it's available for asserts and for implementing
	system_clean_pool.
	[48fe4fe9ef64]

	* src/lib/failures.c, src/lib/failures.h:
	Added i_set_failure_prefix()
	[e83bf216cec2]

2007-03-17  Timo Sirainen  <tss@iki.fi>

	* src/pop3/main.c:
	We defaulted plugin_dir to <moduledir>/imap instead of /pop3.
	[2cdd0f128825]

	* src/lib/file-dotlock.c:
	If dotlock is newer than 2 seconds, don't bother reading PID from it
	and checking if the process still exists. It most likely does.
	[0f352077f789]

	* src/lib/file-dotlock.c:
	Log "kept it for n seconds", not -n seconds.
	[19338f65fa9a]

	* src/deliver/deliver.c:
	Ignore -m "" parameter. Added -n option to not autocreate the
	mailbox. If saving to given mailbox fails, fallback to saving to
	INBOX.
	[5220d4e6690d]

2007-03-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	Crashfix with nonsorted appends
	[d8de9ddaf9cb]

	* src/lib-index/mail-transaction-log.c:
	When marking transaction log corrupted, set indexid=0 instead of
	version=0. Version setting worked too, but indexid=0 makes it log a
	"marked corrupted" error message.
	[0c9cfac8119a]

	* src/lib-index/mail-transaction-log.c:
	Creating initial transaction log file leaked memory, created the
	file twice and caused potential locking problems.
	[7ca3a28d3191]

	* src/auth/auth-worker-server.c, src/lib-auth/auth-server-
	connection.c:
	If net_connect_unix() fails, assume also that ECONNREFUSED may be a
	temporary failure. It can happen if we exceeded the listener's
	backlog.
	[c9e8eaacef6d]

	* configure.in:
	Link dovecot-auth always with -lcrypto if it's needed for crypt().
	It could possibly be used with any passdb, so don't bother doing it
	only for a few of them.
	[e39ce58a463b]

	* src/lib-index/mailbox-list-index-sync.c:
	deleted_space wasn't being calculated, so the index was never
	compressed.
	[063c892d0439]

	* src/lib-index/mailbox-list-index-sync.c:
	We didn't always expunge deleted mailboxes from mail index.
	[da77f5dd7854]

	* src/lib-index/mailbox-list-index-private.h, src/lib-index/mailbox-
	list-index-sync.c, src/lib-index/mailbox-list-index.c:
	More desyncing fixes
	[cdf39128dd91]

	* src/lib/istream-tee.c:
	Crashfix: Underlying stream's data pointer may change even if we
	didn't have to read more data.
	[4e13ca0f2f87]

	* src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins/fts-lucene
	/lucene-wrapper.cc, src/plugins/fts-lucene/lucene-wrapper.h,
	src/plugins/fts-squat/fts-backend-squat.c, src/plugins/fts/fts-api-
	private.h, src/plugins/fts/fts-api.c, src/plugins/fts/fts-api.h,
	src/plugins/fts/fts-storage.c:
	Separate headers and body in building and searching. Added support
	for Lucene to index/search them separately.
	[acd4ed841b01]

2007-03-15  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-lucene/lucene-wrapper.cc:
	Don't call addDocument() after each block.
	[b7c4d7e2cc8c]

	* src/imap/cmd-list.c:
	Last change caused LIST replies to have extra spaces
	[469799904802]

	* src/plugins/acl/acl-plugin.c, src/plugins/expire/expire-plugin.c,
	src/plugins/mail-log/mail-log-plugin.c, src/plugins/zlib/zlib-
	plugin.c:
	Remove redundant "extern" declarations. Patch by Max Kellermann
	[40bd57129083]

	* src/lib/bsearch-insert-pos.c:
	Optimization. Patch by Max Kellermann
	[40ec903ae306]

	* src/lib-index/mailbox-list-index-sync.c, src/lib-storage/index/dbox
	/dbox-keywords.c, src/lib-storage/index/dbox/dbox-uidlist.c, src
	/lib-storage/index/index-sort.c, src/lib/bsearch-insert-pos.c,
	src/lib/bsearch-insert-pos.h, src/plugins/fts-squat/squat-trie.c:
	bsearch_insert_pos() API changed. Patch by Max Kellermann
	[109ca861405f]

	* src/login-common/master.c, src/login-common/ssl-proxy-openssl.c:
	Replace some string literals with non-const static buffers to avoid
	compiler warnings. Patch by Max Kellermann
	[79ea613496aa]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-
	bodystructure.h:
	Make imap_bodystructure_write() parameter constant. Patch by Max
	Kellermann
	[8d9234a26a3f]

	* src/auth/main.c, src/deliver/deliver.c, src/imap/main.c, src/master
	/mail-process.c, src/master/main.c, src/pop3/main.c:
	Fixes to handling log prefixes. imap/pop3 processes now log the
	mail_log_prefix even when started with --exec-mail.
	[55260092b094]

	* src/lib/failures.c:
	i_set_failure_file() no longer automatically appends ": " to log
	prefixes.
	[1a3cdab55b7b]

	* src/imap/client.c:
	Fixed infinite looping in some conditions
	[e505fa0cecdc]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-internal.h, src/lib/ioloop-
	kqueue.c, src/lib/ioloop-poll.c, src/lib/ioloop-select.c,
	src/lib/ioloop.c:
	If poll()/etc. timeouts, we didn't handle time timeouts immediately
	but called poll()/etc again with zero timeout and then handled the
	timeouts.
	[1dcd1631f06e]

	* src/lib-storage/index/index-storage.c:
	Check for the index destroy timeouts a bit less often.
	[a065a71da7d7]

	* src/lib/ioloop.c:
	If timeout wait time was less than 1 millisecond, we wasted CPU
	calling poll() (or whatever) with zero timeout multiple times until
	the millisecond had passed. Now we round the waits up to next
	millisecond.
	[239ccb49852c]

	* src/master/mail-process.c:
	Make processes created with --exec-mail log to the configured
	location.
	[0c92499643ec]

	* src/lib/failures.c:
	Added missing LF from error message
	[4fff090bee9e]

	* src/imap/cmd-append.c:
	Crashfix
	[f2a0b8a10086]

	* src/lib-index/mailbox-list-index-private.h, src/lib-index/mailbox-
	list-index-sync.c, src/lib-index/mailbox-list-index.c, src/lib-index
	/mailbox-list-index.h, src/lib-storage/list/index-mailbox-list-
	sync.c, src/lib-storage/list/index-mailbox-list.c, src/lib-
	storage/list/index-mailbox-list.h:
	Fixed desyncing problems with mail index and mailbox list index.
	[4d3294c59939]

	* src/lib-index/mail-index.c, src/lib-index/mailbox-list-index-sync.c,
	src/lib-index/mailbox-list-index.c:
	Error handling fixes
	[5c8f84bc07b1]

	* src/plugins/convert/convert-storage.c:
	INBOX wasn't converted.
	[00ca0fdc703c]

	* src/lib-storage/list/index-mailbox-list.c:
	Error handling crashfix
	[7c1090fbbc63]

	* src/lib-index/mailbox-list-index.c:
	Error handling fixes
	[2d53914a4520]

	* src/lib-index/mail-cache.c:
	Error handling crashfix
	[0fc29ba873f1]

	* src/lib-storage/mailbox-list.c:
	Create index/control dirs if they don't exist
	[3a3906587641]

	* src/lib-index/mailbox-list-index.c:
	Crashfix
	[4bc257a1874e]

	* src/lib-storage/index/maildir/maildir-storage.c:
	If mailbox is deleted under us while we're also deleting it, handle
	it without logging an error message.
	[78102067b3f5]

	* src/lib-index/mailbox-list-index-sync.c, src/lib-storage/mailbox-
	tree.c:
	Marked memory pools growing
	[7d0469858e6d]

	* src/imap/cmd-list.c:
	Use less memory when listing lots of mailboxes
	[ce59b45431fb]

	* src/lib-index/mailbox-list-index-sync.c:
	fix
	[f17cd7735f8d]

	* src/lib-index/mail-transaction-log.c:
	Don't give "Unexpected garbage at EOF" error if we don't see a full
	transaction header's worth of data. It could be just that another
	process is in the middle of writing the first header.
	[5d1c8fd5a83e]

2007-03-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	Error handling crashfix
	[09b5de33144e]

	* dovecot-example.conf:
	blocking=yes setting was accidentally added to passdb passwd instead
	of userdb passwd.
	[b02f3ec21baf]

	* src/lib-index/mail-index-sync-ext.c:
	If new extension was introduced while we had already expunged some
	messages in the sync, we cleared existing expunge/sync extension
	contexts, which probably caused assert-crash.
	[912213be8e8a]

	* src/lib-storage/list/index-mailbox-list.c:
	If we fail opening/creating the mailbox list indexes, don't crash.
	[7782f0be811d]

	* src/imap/cmd-list.c, src/lib-storage/index/maildir/maildir-sync.c,
	src/lib-storage/index/mbox/mbox-sync.c:
	Added casts to some enums to avoid compiler warnings.
	[1e2b2b3f18e3]

	* src/auth/userdb-passwd-file.c:
	Reverted the last change, it was originally correct after all.
	[1c6c3d9494fb]

	* src/lib-mail/message-parser.c:
	Fixes to counting MIME part sizes
	[43d3955ce03f]

	* src/auth/userdb-passwd-file.c:
	Don't expand %variables in extra fields, let dovecot master do that.
	[afcb29d8faff]

	* src/lib-index/mail-index-view-sync.c:
	View syncing fixes
	[70fea9bab837]

	* src/auth/auth-request.c:
	If unknown user was found from auth cache, we returned an invalid
	value instead of USERDB_RESULT_USER_UNKNOWN.
	[db232a079106]

	* src/lib-storage/index/mbox/mbox-sync-private.h:
	uint8_t:1 is GCC extension, changed back to using unsigned int:1
	although it takes a bit more memory now.
	[3dd58ee1f74b]

	* src/auth/userdb-vpopmail.c:
	Compile fix
	[4df292d2404d]

2007-03-13  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-create.c:
	If trying to create <mailbox><real separator>, give an error instead
	of working like <virtual separator>.
	[937afbbf61b2]

	* src/imap/commands-util.c, src/imap/commands-util.h:
	Added client_find_namespace(). Handle virtual != real hierarchy
	separators better. Give an error if real separator is tried to be
	used in the mailbox name.
	[143c5942e392]

	* src/plugins/trash/trash-plugin.c:
	compiler warning fix
	[67b8d61c988f]

	* src/imap/cmd-append.c:
	Logout crashfix in some conditions.
	[542967561249]

	* src/lib/ioloop-notify-none.c:
	Fix for building without notify
	[59d84c7c2411]

	* src/deliver/mail-send.c:
	Don't add rejection mails to duplicate database. They're never
	looked up from there.
	[d66365659530]

2007-03-12  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	If maildirsize file contains only the header, recalculate the quota.
	[5252f735e67f]

	* src/plugins/convert/convert-storage.c:
	Mailbox name conversion wasn't done for directories.
	[cf3d2b1eb7cb]

2007-03-11  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	failure_exit_callback hook was set too late, so if log opening
	failed it exited with wrong exit code.
	[41b80786c06f]

	* src/auth/db-passwd-file.c:
	If passwd-file wasn't found, don't crash.
	[9b3029f06521]

	* src/lib-index/mail-index-view-sync.c:
	DEBUG crashfix
	[f9b1c0f5bff4]

	* src/lib-index/mail-transaction-log-append.c:
	If we can't rotate log file because there's no disk space, don't
	abort appending the transaction.
	[be68f8b64aee]

	* src/lib-storage/index/mbox/mbox-storage.c:
	If anything (syncing) fails because there's not enough disk space,
	give user a nice error message instead of internal error.
	[8a88f44c2151]

	* src/lib-index/mail-index-lock.c:
	Delete copy-lock file instead of rename()ing it if we've moved to
	in-memory indexes.
	[bf90ba82e2db]

	* src/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log.c:
	If write to transaction log fails, we may later need to truncate the
	file so that after the write there won't be garbage after it.
	[a09da370923d]

	* src/imap/cmd-append.c:
	Use a larger initial pool size for keywords.
	[6ba1cd2580ee]

	* src/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log-private.h:
	If transaction log grows larger than 1MB, rotate it even if it was
	created less than 5 minutes ago.
	[8f9af66ee313]

	* src/lib-storage/index/maildir/maildir-save.c:
	If o_stream_send_istream() fails with ENOSPC/EDQUOT, don't log a
	critical error but just give user a "not enough disk space" error.
	[a8317e816609]

	* src/lib-storage/index/mbox/mbox-save.c:
	o_stream_seek() may do buffer flushing internally and cause errors.
	Do flushing manually before seeking so that we don't confuse the
	errors. Also did some code cleanups.
	[2712ba108fba]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	o_stream_seek() call was missing error handling.
	[7370f768f71c]

	* src/imap/cmd-append.c:
	Another failure handling fix
	[6f481d465b0f]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index.c, src/lib-index/mail-transaction-log-append.c, src/lib-index
	/mail-transaction-log-view.c, src/lib-index/mail-transaction-log.h:
	If we run out of disk space, move to in-memory indexes.
	[d569caa88a66]

	* src/imap/cmd-append.c:
	When using MULTIAPPEND and LITERAL+ and message saving failed, we
	stopped parsing client input too early (for subsequent appends after
	the failure) which caused BAD replies.
	[be3d55491b37]

	* src/imap/imap-fetch-body.c:
	If mail was in CR+LF format in the disk and we used sendfile() call,
	but the call couldn't send everything, we hanged.
	[56535cb50a09]

	* src/lib/ostream.h:
	Updated o_stream_send_istream() comments
	[49efad884ed1]

2007-03-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	When moving index file to memory, change the filename to be "(in-
	memory index)".
	[7641e625fbd5]

	* src/lib-index/mail-index.c:
	Rotating in-memory transaction log crashed
	[9cdfd66cf5cc]

	* src/lib-index/mail-index.c:
	mmap_disable=yes crashes with recent changes.
	[82b4a055e109]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	view-sync.c:
	View syncing fixes.
	[239fe5057748]

	* src/lib-index/mail-index-view-sync.c:
	cleanups
	[6664699c1f2d]

	* src/lib-index/mail-index-sync-update.c:
	View log file offset fix
	[164190404359]

	* src/lib-index/mail-index-view-sync.c:
	We skipped some external transactions that shouldn't have been
	skipped. The logic for figuring out if flags are unreliable was also
	a bit broken.
	[debb7be008dc]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	comment update
	[02a4228a921b]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c:
	Cleaned up the code a bit. Fixed sync rewrite crashing with pseudo
	mails.
	[0dc6b54bb6aa]

	* src/lib-storage/index/mbox/mbox-transaction.c:
	After saving mails we didn't update last-uid header in X-IMAP[base]
	if lazy writes were used.
	[d7bd3f80c6f2]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	When parsing X-IMAP[base] header and its last-uid field is too low,
	mark it as needing rewrite.
	[169b5e67d307]

	* dovecot-example.conf, src/auth/passdb-pam.c:
	PAM service name supports variables now.
	[8384f797c0fc]

	* doc/variables.txt:
	Added %m and %c to dovecot-auth.
	[bf40ec268264]

	* doc/dovecot-ldap.conf, doc/dovecot-sql.conf:
	Added wiki links.
	[70d972264186]

	* src/auth/auth-request.c, src/auth/auth-request.h:
	Added %c variable which expands to "secured" with SSL/TLS/localhost.
	[0d72eb2ed8af]

	* src/auth/db-passwd-file.c, src/auth/mech-gssapi.c, src/auth/passdb-
	bsdauth.c, src/auth/passdb-cache.c, src/auth/passdb-checkpassword.c,
	src/auth/passdb-pam.c, src/auth/passdb-passwd.c, src/auth/passdb-
	shadow.c, src/auth/passdb-sia.c, src/auth/passdb-vpopmail.c,
	src/auth/userdb-passwd.c, src/auth/userdb-prefetch.c, src/auth
	/userdb-vpopmail.c:
	Added more debug logging.
	[228eacfb2647]

	* src/plugins/mail-log/mail-log-plugin.c:
	Log the mailbox name, unless it's INBOX.
	[1fffd36401eb]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c:
	When rewriting the first message we could have written next-uid
	field wrong.
	[c073fad758d5]

2007-03-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log-view.c:
	cleanups
	[d66f62eb69b3]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c:
	Don't set log sync position right after extension introduction,
	unless it's at the end of the file. This should fix some "Extension
	reset without intro prefix" errors.
	[005d73928f8f]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Yet another try at fixing this piece of code. The mbox code is way
	too complex and could use better comments..
	[46e3249aa15b]

	* src/plugins/imap-quota/imap-quota-plugin.c:
	When returning mailbox name with GETQUOTAROOT, return the original
	name instead of the converted storage name.
	[535ff7687388]

	* doc/dovecot-ldap.conf:
	Added tls setting.
	[d9def64349d7]

	* src/auth/auth-request.c:
	Added %m = mechanism name
	[c1d7e9493f08]

	* src/lib-sql/driver-pgsql.c:
	Fixed to work with new ioloop code
	[24c2eb87f4d0]

	* src/auth/main.c, src/deliver/deliver.c, src/dict/main.c,
	src/imap/main.c, src/login-common/main.c, src/master/main.c,
	src/plugins/convert/convert-tool.c, src/plugins/expire/expire-
	tool.c, src/pop3/main.c, src/util/rawlog.c:
	Removed pool parameter from io_loop_create()
	[784dc7224718]

	* src/lib/Makefile.am, src/lib/ioloop-epoll.c, src/lib/ioloop-
	internal.h, src/lib/ioloop-iolist.c, src/lib/ioloop-iolist.h,
	src/lib/ioloop-kqueue.c, src/lib/ioloop-notify-dn.c, src/lib/ioloop-
	notify-fd.c, src/lib/ioloop-notify-fd.h, src/lib/ioloop-notify-
	inotify.c, src/lib/ioloop-notify-kqueue.c, src/lib/ioloop-poll.c,
	src/lib/ioloop-select.c, src/lib/ioloop.c, src/lib/ioloop.h:
	Various cleanups to ioloop code.
	[12ac5f685814]

2007-03-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log.c,
	src/lib-index/mail-transaction-log.h:
	If index file is corrupted, recreate transaction log file instead of
	trying to reuse it.
	[c1ef15c1a1fa]

	* src/lib/failures.c:
	Moved errno preserving to i_error/i_warning/i_info from the failure
	handler, so each failure handler doesn't have to do that itself.
	[38fed1d06f20]

	* dovecot-example.conf:
	Added note about ssl_require_client_cert in ssl_verify_client_cert
	comments.
	[b6be3258cf9d]

	* src/lib-mail/message-parser.c:
	And more fixes
	[aeb72263352d]

2007-03-07  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Added LoginProcess wiki link.
	[b931a7d3c576]

	* src/lib/ioloop.c:
	Added a comment about the time moving backwards code.
	[8bdbb0b17ae2]

	* src/lib/ioloop-select.c:
	Cleanups. Moved static variables inside ioloop context so it works
	with multiple ioloops.
	[5ff2dd975f5a]

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync.c:
	Keep track of the mbox dirty state better. Also when moving mails
	inside an mbox without changing the file's size, make sure the
	file's mtime changes even if it means sleeping for a second.
	[117c9fd0b633]

	* src/lib-storage/index/mbox/mbox-sync.c:
	minor cleanups
	[18a9e82f6f48]

	* src/lib/istream-file.c:
	Removed caching from i_stream_stat(). The changes could be important
	in mbox syncing.
	[0f1208e2df7b]

	* src/lib/ioloop.c:
	Don't die if "time moved backwards" sleep is interrupted.
	[78553445a036]

	* src/lib-index/mail-transaction-log.c:
	Fixed last change: Don't crash now when rotating non-locked log..
	[6761b2a46ec3]

	* src/lib-index/mail-transaction-log-append.c:
	If write fails with "not enough space" error, log it instead of
	silently handling it.
	[660763f5e75a]

	* src/lib-index/mail-transaction-log.c:
	Don't crash when rotating locked in-memory log file.
	[f107ddd56550]

	* src/auth/auth-request.c:
	Fixed a crash when non-plaintext mechanism used auth_cache.
	[359a8f31aa9b]

	* src/login-common/sasl-server.c:
	After calling sasl_callback() the client may be destroyed already.
	Don't try to modify it.
	[7e26736a9fba]

	* src/lib-sql/driver-pgsql.c:
	t_push/t_pop the callback.
	[f5c23985f946]

	* src/lib-sql/driver-pgsql.c:
	Queueing code was somewhat broken and caused queries to get lost.
	[60ba59991beb]

2007-03-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c:
	Added assert.
	[1f737b6e911b]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction-view.c, src/lib-index/mail-index-transaction.c:
	When adding mails to index in non-sorted UID order and then using
	mail_index_get_header(), the next_uid field could have been wrong.
	[3bccf203fa91]

	* src/plugins/convert/convert-storage.c:
	Log errors given by storage. Convert hierarchy separators in mailbox
	names.
	[7838ae62b1e6]

	* src/lib-storage/index/index-storage.c:
	If moving to memory fails, make sure we open the index with create
	flag set.
	[aca6d339de01]

	* src/lib-index/mail-index-sync-update.c:
	When we were syncing in-memory maps, we still should have updated
	the log file offsets because other views could have used them.
	[0a45db96e288]

	* src/lib-index/mail-index.c:
	comment cleanup
	[c3ab7e621fa6]

	* src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Don't crash if user_attrs or pass_attrs is empty. It means all the
	attributes are returned.
	[b6bbf42908a6]

	* src/lib/ioloop.c:
	If time moves backwards only max. 5 seconds, sleep instead of
	killing ourself.
	[685a2d213438]

	* src/imap/cmd-list.c:
	With namespace prefixes LSUB prefix.* listed INBOX.INBOX.
	[c8a82d0fb443]

	* src/deliver/deliver.c, src/deliver/deliver.h, src/deliver/smtp-
	client.c:
	Keep only TZ and HOME environments when calling sendmail.
	[7fbdcce95982]

	* src/plugins/quota/quota-maildir.c:
	comment typofix
	[0d2d526dcf8f]

	* src/plugins/quota/quota-maildir.c:
	If maildirsize contained NUL bytes at the beginning of the line
	(could happen with NFS), we stopped parsing the file at that point
	instead of rebuilding it.
	[940b9849057b]

	* configure.in:
	Changed --with-headers to --enable-header-install
	[3a915bf1b390]

	* Makefile.am:
	fix
	[085e7b7d56f5]

	* dovecot-example.conf:
	Updated valid_chroot_dirs and mail_chroot comments.
	[9914a148eea1]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c:
	When syncing huge maildirs check once in a while if we need to
	update dovecot-uidlist.lock so that another process won't decide
	that it's stale and overwrite it. Check more often when moving mails
	from new/ to cur/.
	[4e9d345df846]

	* src/lib-index/mail-transaction-log.c:
	Don't try to fsck index file in error conditions if it's not yet
	opened.
	[2969edccb9b0]

	* src/lib-index/mail-index.c:
	Check index file's endianess earlier, otherwise we'll complain about
	other problems.
	[0866a2b60b2b]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	X-UID brokeness fixing was worse than ever.
	[6d4c18b51495]

	* src/deliver/Makefile.am, src/deliver/deliver.c:
	While parsing the input stream ignore the mbox hidden headers so
	that eg. X-IMAP header won't cause us to crash.
	[b77a67169fc5]

2007-03-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/list/mailbox-list-fs.c:
	Don't allow using "foo/." or "foo/.." in the masks. Although that
	shouldn't really matter.
	[d5695e137ea4]

	* src/imap/cmd-append.c:
	Don't crash if mail saving fails.
	[f5fdc9dd1023]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib/istream-limit.c, src/lib/ostream-
	crlf.c:
	Keep stream_errno updated in filter streams.
	[be4fb0976c1d]

	* src/imap/client.h:
	Removed unused rawlog flag.
	[7c9894f2bf7c]

2007-02-28  Timo Sirainen  <tss@iki.fi>

	* src/plugins/mail-log/mail-log-plugin.c:
	Fixed deleted/undeleted logging.
	[f33e5ce7a73c]

	* src/lib/ioloop.c:
	If time moves backwards, kill ourself.
	[c0d7aeedea81]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	If next_uid field gets to 2^31-1, handle it without crashing by
	creating a new uidvalidity and renumbering the UIDs (although it
	requires selecting the mailbox twice, first time to get index file
	deleted).
	[71e110813d7b]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	The previous broken X-UID header fixing code was still broken...
	[bc9e3c507ec3]

	* configure.in, src/master/Makefile.am, src/master/main.c:
	Drop privileges if libcap is found. Patch by David (lists
	edeca.net).
	[8920e744dac4]

2007-02-27  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-plain.c:
	Don't crash with invalid PLAIN input.
	[d93207ff2280]

2007-02-25  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-alloconly.c:
	alloconly pool: pool_unref() shouldn't set the pool pointer to NULL
	unless refcount=0.
	[2bf812efe6a3]

2007-02-23  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	If prefix.INBOX has children and we're listing under prefix.%, don't
	drop the prefix.
	[3e54aa4039bc]

2007-02-22  Timo Sirainen  <tss@iki.fi>

	* Makefile.am, configure.in, dovecot-config.in.in,
	src/auth/Makefile.am, src/deliver/Makefile.am, src/imap/Makefile.am,
	src/lib-auth/Makefile.am, src/lib-charset/Makefile.am, src/lib-
	dict/Makefile.am, src/lib-imap/Makefile.am, src/lib-
	index/Makefile.am, src/lib-mail/Makefile.am, src/lib-
	settings/Makefile.am, src/lib-sql/Makefile.am, src/lib-
	storage/Makefile.am, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/dbox/Makefile.am, src/lib-
	storage/index/maildir/Makefile.am, src/lib-
	storage/index/mbox/Makefile.am, src/lib-storage/list/Makefile.am,
	src/lib/Makefile.am, src/pop3/Makefile.am:
	Added --with-headers configure option to install .h files.
	[e77e4457d95c]

	* src/imap/client.c:
	assert-crashfix
	[f1b735b905f3]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c:
	cleanup
	[840d177c468f]

	* src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h:
	KEEP_LOCK: When using dotlock, touch it every 10 seconds.
	[7b0749edc553]

	* src/plugins/fts-squat/Makefile.am:
	Added missing .h file
	[7da5b23bed2d]

	* src/lib-storage/index/maildir/Makefile.am, src/master/Makefile.am:
	Files were missing from dist tarballs.
	[6bea418b9db7]

	* src/lib-dict/Makefile.am, src/lib-otp/Makefile.am:
	Some files weren't being added to dist tarball
	[ee745eee4d9c]

	* src/lib/macros.h:
	warn_unused_result attribute exists only with gcc 4.0 and later.
	[6d103b3b3cc5]

	* src/plugins/trash/trash-plugin.c:
	Fixed priority handling.
	[7ec060a7c29f]

	* src/plugins/trash/trash-plugin.c:
	Fixes for handling multiple storages.
	[519ab252f1a3]

	* src/plugins/trash/trash-plugin.c:
	Minor memory allocation optimizations.
	[9dd18b285223]

	* src/auth/password-scheme.c, src/deliver/deliver.c, src/dict/main.c,
	src/imap/main.c, src/lib/module-dir.c, src/lib/module-dir.h,
	src/pop3/main.c:
	Don't compare to PACKAGE_VERSION in lib/ core directly, rather make
	module_dir_load() have the version string as parameter. Plugin
	version checks can be skipped with version_ignore=yes.
	[a7627141ec7f]

	* src/plugins/acl/acl-plugin.c, src/plugins/convert/convert-plugin.c,
	src/plugins/expire/expire-plugin.c, src/plugins/fts-lucene/fts-
	lucene-plugin.c, src/plugins/fts-squat/fts-squat-plugin.c,
	src/plugins/fts/fts-plugin.c, src/plugins/imap-quota/imap-quota-
	plugin.c, src/plugins/lazy-expunge/lazy-expunge-plugin.c,
	src/plugins/mail-log/mail-log-plugin.c, src/plugins/quota/quota-
	plugin.c, src/plugins/trash/trash-plugin.c, src/plugins/zlib/zlib-
	plugin.c:
	Added <plugin_name>_version string.
	[24f4a959a24c]

	* src/lib/module-dir.c:
	If module contains a <module_name>_version string, fail if it
	doesn't match PACKAGE_VERSION.
	[47e393c4eb4b]

	* src/lib/ostream.c:
	If o_stream_send_istream() fails, make sure errno is set to
	outstream.stream_errno.
	[68808a3021b0]

	* src/lib-storage/index/maildir/maildir-save.c:
	cleanup
	[52389cd2c474]

	* src/lib-index/mail-cache-transaction.c:
	Crashfix in error conditions.
	[922672fcdfdc]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	If uidlist locking fails because of a timeout, given timeout error
	message to user instead of internal error.
	[8e8b1ad19ad1]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	When using KEEP_LOCK, the mbox/uidlist file must be locked before
	index file is opened. Otherwise we can end up in a deadlock.
	[2f9ac504ee77]

	* src/pop3/client.c:
	If INBOX can't be opened, give better error messages. The reason is
	never "INBOX doesn't exist for user".
	[bbe25ef34f03]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c:
	If KEEP_LOCK is set and we timeout, don't crash.
	[53719357e0e4]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-storage.h, src/lib-storage/index/dbox/dbox-
	uidlist.c, src/lib-storage/index/dbox/dbox-uidlist.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	If pop3_lock_session=yes, update maildir/dbox uidlist lock file
	every 10 seconds so it won't be treated as a stale lock.
	[db7b28a3ffbd]

	* src/auth/passdb-pam.c:
	PAM dead-child timeout function was called 1000 times too often.
	[7811499148ef]

2007-02-20  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-fs.c:
	Linux quota v1 apparently returns current quota in kilobytes, not
	bytes as v2.
	[a911767f89c0]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	If authentication failed but it still returns proxy, don't do the
	proxying.
	[723cf9d39692]

	* src/master/master-settings.c:
	dovecot -n/-a dumps now also dict/plugin settings.
	[b3e8f4fbab3e]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Rewriting still wasn't replacing broken X-UID headers correctly
	always, causing assert-crashes.
	[55009a9c917a]

2007-02-19  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	proxy and nologin was broken in last changes.
	[3516e9856179]

	* src/auth/passdb-blocking.c:
	Removed unused variable
	[633e7e319f87]

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-storage.h:
	Drop X-Delivery-ID header when saving the message.
	[5dfa745c0622]

	* src/lib-storage/index/mbox/mbox-save.c:
	If pop3_uidl_format=%m, add a unique X-Delivery-ID header to all
	saved mails. Without it it's possible to get duplicate UIDLs which
	some clients don't handle all that well. (eg. mail sent to two
	accounts where one is alias to another will get the exact same
	Received/Delivered-To headers with Postfix)
	[b11b55f8912a]

	* src/deliver/deliver.c:
	Get pop3_uidl_format even if it's inside protocol pop3 {}
	[cc8b33172a86]

2007-02-17  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Added AC_CACHE_CHECK()s to all AC_TRY_RUN and AC_RUN_IFELSE checks
	so that cross compiling is possible.
	[04bdc7c83854]

	* src/auth/mech-plain.c:
	If authorization and authentication IDs are the same, and both
	contain the master user, the master login failed.
	[c549f65d5f24]

	* src/auth/auth-request.c:
	auth_request_set_fields(): Don't crash with empty fields.
	[39d3fca337a5]

2007-02-16  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota.c:
	If we have multiple namespaces with identical locations, add only
	one such storage so the quota doesn't get duplicated.
	[93bca0881892]

	* src/plugins/quota/quota-maildir.c:
	We were relying on the limits in maildirsize file instead of using
	the quota_rule limits.
	[e0ec43583be5]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c:
	Fixed some wrong "uid-last unexpectedly lost" errors.
	[2141e1f58c04]

	* src/lib/module-dir.c:
	Don't crash at deinit if no modules are loaded.
	[627a085dac39]

	* src/plugins/trash/trash-plugin.c:
	Although messages were expunged, the expunges weren't counted in
	that same transaction and the APPEND failed.
	[aa9b1fec1c21]

	* src/plugins/trash/trash-plugin.c:
	If trash mailbox couldn't be opened, don't crash later either.
	[df22aec605b7]

	* src/lib/module-dir.c:
	module_dir_init() was calling the init() functions in reverse order.
	[644342a79f15]

	* src/auth/checkpassword-reply.c:
	If USER environment is set, return it in "user" field and not
	"userdb_user". Also don't require that the USER environment exists.
	[facdf5823359]

	* src/auth/passdb-checkpassword.c:
	Use auth_request_set_fields() to set the fields returned by
	checkpassword script instead of auth_stream_import()ing directly
	into extra_fields. This way checkpassword can set special extra
	fields.
	[b9cb27ecee98]

	* src/auth/auth-request.c, src/auth/auth-request.h, src/auth/passdb-
	blocking.c, src/auth/passdb-cache.c:
	Added auth_request_set_fields() and used it instead of duplicating
	the code in multiple places.
	[83f361144a8a]

	* src/auth/checkpassword-reply.c:
	Don't crash if USER or HOME environment is missing. Allow HOME
	environment not to exist.
	[3dc493d152ac]

	* src/imap/cmd-append.c:
	APPEND ate all CPU if client didn't send the message fast enough.
	[59604f7d92e8]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	If authentication fails and we've already destroyed the client,
	don't go io_add()ing the client anywhere.
	[16240711734e]

	* src/login-common/sasl-server.c:
	Make sure we crash if we're trying to call sasl_callback() too many
	times.
	[892b8f1c1916]

	* src/auth/password-scheme.c, src/deliver/deliver.c, src/dict/main.c,
	src/imap/main.c, src/lib/module-dir.c, src/lib/module-dir.h,
	src/pop3/main.c:
	module_dir_load() doesn't call init() functions anymore. Added a new
	module_dir_init() which does it. This way imap/pop3 can load the
	modules before chrooting and initialize them after.
	[7f2c39d7a2cc]

	* src/plugins/trash/trash-plugin.c:
	If trash mailbox can't be opened, don't crash.
	[6b0032df7008]

	* src/auth/auth-worker-client.c:
	Blocking passdbs didn't work as masterdbs.
	[7cf93253317d]

	* src/lib-index/mail-cache.c:
	Allocate cache file's size amount of memory for the file cache so it
	doesn't have to grow it constantly while reading the file.
	[3eecde9cbea4]

	* src/lib/file-cache.c, src/lib/file-cache.h:
	Made file_cache_set_size() public.
	[0851c6e96852]

2007-02-15  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	Don't bother trying to save the mail twice into the default mailbox
	(eg. if it's over quota).
	[5a0506cb73c5]

	* dovecot-example.conf:
	Cleaned up the log_file and info_log_file comments.
	[ce0a73d564f3]

	* src/deliver/deliver.c:
	Hook all exit()s and if the exit code is one of Dovecot's own
	FATAL_* ones, replace them with EX_TEMPFAIL.
	[8c0c4b524d84]

	* src/lib/failures.c, src/lib/failures.h:
	Added i_set_failure_exit_callback()
	[4c570d6484b7]

	* src/lib/ioloop.c:
	Delay initializing I/O notify backend until the first notify is
	added. Non-IMAP processes never need notifies.
	[2d1f02635ccf]

	* src/imap-login/imap-proxy.c, src/pop3-login/pop3-proxy.c:
	Don't crash if the remote server disconnects before we're logged in.
	[20302f49eda3]

	* src/master/auth-process.c:
	Do the delayed login process starting also after SIGHUPing.
	[89aec9ce88bc]

	* src/master/auth-process.c, src/master/auth-process.h, src/master
	/login-process.c:
	Start auth processes immediately at startup, not after one second
	delay. Don't try to start any login processes before at least one
	auth process has sent back a handshake.
	[86625faa49b5]

	* src/pop3/commands.c:
	RSET: Don't rollback the transaction if LAST is enabled (there's no
	point, because all the seen flags are removed anyway).
	[1a7359d6a774]

	* src/auth/auth-request.c, src/auth/passdb-cache.c, src/auth/passdb.c:
	If looking up credentials for NULL passwords, return "scheme not
	available" instead of assert-crashing.
	[b2070dffa074]

	* src/imap/main.c:
	mail_debug=yes: Log also home directory.
	[cbc8f65d887b]

	* src/imap/cmd-append.c:
	If we've a mailbox selected and we're appending to another mailbox,
	we got extra FLAGS/PERMANENTFLAGS change notifications.
	[c4fab2513f50]

	* src/auth/auth-cache.c, src/auth/auth-cache.h, src/auth/auth-
	request.c:
	If user is changed with "user=x" in extra_fields, cache the entry
	with the original username instead of with the changed username.
	[172fb23d3c8f]

	* src/auth/auth-request.c:
	Removed assert. "pass" field is allowed to be in extra_fields.
	[142726697f29]

	* src/auth/auth-request.c, src/auth/auth-request.h:
	Special extra_fields weren't saved to auth cache. This was
	especially problematic for allow_nets which was ignored if the user
	was already in cache.
	[9b1a90eddfd0]

	* src/auth/passdb-cache.c:
	If last login was valid and the current one wasn't, we returned "not
	found from cache" but extra_fields still had been modified, which
	could have caused crashes later.
	[365ff0cfd03f]

2007-02-14  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-dict.c:
	Don't break if current quota value is negative.
	[97193e15d688]

	* src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/list/subscription-file.c:
	fsync() subscriptions file and maildir-keywords before rename()ing
	them.
	[fb1ebc2c7c49]

	* src/pop3/commands.c:
	If UIDL command can't get the UID, die instead of not returning
	anything and still replying "OK".
	[0b7be87efd7c]

	* src/lib-storage/index/mbox/mbox-save.c:
	When saving a message to an empty mbox file, write X-IMAPbase header
	so the UID doesn't change.
	[e008f09dc3c9]

2007-02-13  Timo Sirainen  <tss@iki.fi>

	* doc/Makefile.am:
	Removed deleted .txt file.
	[2d21b5020994]

2007-02-12  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/auth/userdb-passwd.c:
	Added blocking=yes setting to userdb passwd.
	[419b206fd10c]

	* dovecot-example.conf, src/auth/passdb-pam.c:
	Added blocking=yes to PAM passdb to use auth workers instead of
	forking a new process for each lookup.
	[cf996f8e9c89]

	* src/auth/passdb-pam.c:
	If PAM child process hasn't responded in two minutes, send KILL
	signal to it.
	[e4acabdc0de0]

	* src/master/mail-process.c:
	When running dump-capability, don't do stderr_close_shutdown since
	it could break and make epoll_ctl() return with EPERM.
	[7144aff70f33]

	* doc/Makefile.am, doc/USE-WIKI-INSTEAD, doc/auth.txt,
	doc/configuration.txt, doc/design.txt, doc/index.txt, doc/mail-
	storages.txt, doc/multiaccess.txt, doc/nfs.txt:
	Removed the old and wrong .txt files.
	[c2af4ee1f25e]

2007-02-07  Timo Sirainen  <tss@iki.fi>

	* src/plugins/mail-log/mail-log-plugin.c:
	Don't crash with expunging mails with non-existing message-id
	header.
	[02f7ce1e75f6]

2007-02-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	Removed fsync() call. It doesn't really provide any data integrity
	guarantees, and it could make the performance worse.
	[6d60ec110746]

	* src/imap/client.c:
	Don't crash if client disconnects in the middle of sending a command
	line.
	[0c89a2f72f86]

	* src/imap/client.c:
	hangfix
	[7413b8e0d765]

	* src/lib-index/mail-index-sync-update.c:
	We could have skipped transactions completely (broken a few
	revisions ago).
	[92ce1b337b50]

	* src/lib-mail/message-parser.c:
	Inifinite looping fixes
	[c72eb76e4173]

	* src/lib-mail/message-parser.c:
	Fixes
	[daf87522bce4]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-idle.c, src/imap/cmd-search.c:
	Command handling fixes.
	[ce804b173797]

	* src/lib-mail/message-parser.c:
	Fixes.
	[312c701f453a]

	* src/imap/cmd-uid.c:
	Don't crash with unknown UID commands.
	[1363ddcaca29]

	* src/lib-mail/istream-header-filter.c:
	_read() could have returned "need more data" in wrong situations,
	which could have caused problems later.
	[ddbc89221c26]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib/istream-data.c, src/lib/istream-file.c,
	src/lib/istream-limit.c, src/lib/istream-mmap.c, src/lib/istream.c,
	src/lib/istream.h, src/plugins/zlib/istream-zlib.c:
	Added istream->blocking setting. It's now used to assert-crash early
	if a blocking stream unexpectedly returns "need more data".
	[81394e71f92a]

	* src/auth/passdb-blocking.c, src/login-common/sasl-server.c:
	Assert-crashfixes
	[342429974bf5]

2007-02-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	If namespace has a prefix and inbox=no, don't list prefix.inbox if
	it happens to exist when listing for %.
	[ffd9df333232]

	* configure.in:
	Don't use nonportable grep -q.
	[050549cfaa25]

	* src/pop3/client.c:
	Commit the transaction even if client didn't QUIT so cached data
	gets saved.
	[f8c2cf9e3267]

	* src/master/master-settings-defs.c:
	mail_log_max_lines_per_sec was declared as string.
	[deb7c9e2406a]

	* doc/dovecot-sql.conf:
	Added an example of how to concat() user and domain.
	[b15c7ccb4671]

2007-02-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c:
	crashfix
	[d75d8a0cb231]

	* dovecot-example.conf, src/master/mail-process.c, src/master/master-
	settings-defs.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added mail_log_max_lines_per_sec setting.
	[176c28ad604c]

	* src/pop3/Makefile.am:
	Make sure str-sanitize.o is linked so mail_log plugin works.
	[55bebf61cfdd]

	* src/lib-index/mail-index-view.c:
	Another lookup_uid_range() seq2 bugfix/crashfix.
	[89bf4b47bc61]

	* src/lib-storage/index/index-mail.c:
	Minor optimization
	[c319af74c252]

	* src/lib-index/mail-cache-transaction.c:
	If cache file wasn't opened yet when flushing a transaction, the
	changes weren't written to the file. Also fixes a "invalid record
	size" bug which could have happened when transaction flush failed.
	[cce9bab229d7]

2007-02-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c:
	Setting flags other than seen/deleted was broken.
	[8a274bc9498c]

2007-01-30  Timo Sirainen  <tss@iki.fi>

	* doc/variables.txt:
	Added a note about %E not needed with SQL queries.
	[891acb3e5749]

2007-01-28  Timo Sirainen  <tss@iki.fi>

	* src/pop3/client.c:
	If mailbox initialization failed, log an error instead of just
	telling about it to the client.
	[d73a97cc0ea7]

2007-01-27  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Added --log-error command line option.
	[04b467f23400]

2007-01-26  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request-handler.c, src/auth/mech-rpa.c, src/auth
	/passdb-checkpassword.c, src/imap/imap-sync.c, src/lib-auth/auth-
	server-request.c, src/lib-index/mail-transaction-log-view.c, src
	/lib-index/mail-transaction-log.c, src/lib-storage/index/index-
	mail.c, src/lib/lib-signals.c, src/login-common/main.c, src/master
	/login-process.c, src/master/ssl-init-openssl.c, src/plugins/quota
	/quota-maildir.c, src/pop3/commands.c, src/util/rawlog.c:
	Cleanups and minor fixes
	[18559c7e3a15]

	* src/auth/mech-apop.c:
	Verify the APOP input before passing it to sscanf() to make sure
	it's NUL-terminated.
	[caa07c0dbb56]

	* src/lib/hash.c:
	Optimization: Hash compression didn't remove NULL nodes from roots.
	[37e3fac0aa2f]

	* src/lib/istream-seekable.c:
	cleanup
	[68076557b05d]

	* src/auth/auth-request-handler.c:
	code cleanup
	[dd4c4a0c0aae]

2007-01-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-storage.c:
	crashfix
	[68b0ef27bc6a]

	* src/lib-storage/index/maildir/maildir-transaction.c:
	If save_commit_pre() fails, rollback the transaction.
	[aba0bc3338c9]

	* src/imap/imap-thread.c:
	Memory leak fix
	[0074574b9d2c]

	* src/lib-index/mail-index-view.c:
	lookup_uid_range(): Last change could have caused the returned seq2
	to be too high, causing all kinds of problems.
	[979d7c7b1400]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Error handling fixes
	[e0b83da1e12f]

	* src/imap/imap-fetch-body.c:
	If we disconnect the client because message ended unexpectedly, log
	an error.
	[e3e8f01b4899]

	* src/plugins/quota/quota-private.h, src/plugins/quota/quota.c:
	If mail_debug is enabled, log configured quota rules
	[16e09d2777af]

	* src/master/main.c:
	If we see exit for unknown child process, log an error but don't
	crash. If net_listen() fails with EINTR, try again unless it was
	interrupted by INT/TERM signal.
	[acafdee84537]

	* src/master/mail-process.c:
	fsync_disable wasn't sent to mail processes
	[639b4361f46a]

	* src/lib/array.h:
	Removed disable-asserts-specific array_idx(). It didn't work if
	array's element_size was different than sizeof(element type).
	[d0b50249e816]

	* src/lib-storage/index/mbox/mbox-mail.c:
	If we can't find the mail from dirty mbox even after syncing, fail
	with error instead of looping forever.
	[fc4722a1687b]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	When verifying a mail's location in dirty mbox with invalid X-UID
	headers that weren't yet rewritten, we would trust the X-UID header
	and cause the verification to fail. Now we trust it only if it's
	valid, otherwise fallback to MD5 sum of the header.
	[5b4678cd68dc]

2007-01-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-view.c:
	Crashfix
	[030a7f7b708c]

	* src/master/mail-process.c:
	If exec() fails, don't close 0..3 fds before logging the error.
	There's really no point, and it closes the logging fd so the exec()
	error can't be logged.
	[836a7d11f8df]

	* src/plugins/quota/quota-maildir.c:
	Fixed a file descriptor leak.
	[3cc5ec8549c0]

	* src/auth/auth-request.c:
	If auth_cache was enabled and userdb returned "user unknown"
	(typically only deliver can do that), we crashed.
	[005ad2165d08]

	* src/plugins/fts-squat/squat-trie-private.h, src/plugins/fts-squat
	/squat-trie.c:
	Some bugfixes. Moved header struct to a separate file.
	[65a4e1e61555]

	* src/lib-storage/list/index-mailbox-list-sync.c:
	Crashfix
	[e58fb950c20d]

2007-01-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c:
	"View synchronization from transaction log failed": Log also the
	index filename.
	[8e3161c5bd6c]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-view-sync.c:
	Some mmap_disable=no fixes. Some debug additions. Some generic index
	fixes.
	[fe88d9c80638]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Made one more fsync() optional with fsync_disable.
	[db3f662588a4]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-sync.c:
	Log a warning when we're starting fsck. Log error before calling
	fsck.
	[fbcc7ca636d5]

	* src/lib-index/mail-index-sync-update.c:
	cleanups
	[0cdded0843ca]

	* src/plugins/acl/acl-backend-vfile.c:
	If control_dir wasn't specified, we complained about ACL file
	existing in it.
	[f1a57c233db1]

	* src/lib-index/mail-index.c:
	Fix for last check
	[0cc8f8fb18f3]

	* src/lib-index/mail-index.c:
	cleanups
	[baa0e9f60a24]

	* src/lib-index/mail-index.c:
	mmap_disable=yes: Verify that header_size and messages_count are low
	enough so we don't try to allocate too much memory.
	[2a6b6575b421]

2007-01-22  Timo Sirainen  <tss@iki.fi>

	* autogen.sh:
	Removed -f option from autoreconf, since it overwrites our INSTALL
	file.
	[d86ee13688d5]

	* src/lib-storage/index/maildir/maildir-copy.c:
	maildir_copy_with_hardlinks=yes could have caused "Duplicate file in
	uidlist" errors. The fix slows it down a bit though, the files are
	now always first hardlinked to tmp/ and later rename()d from there
	to cur/ or new/.
	[20bcdc161e71]

	* src/lib-index/mail-index-transaction.c, src/lib-
	storage/index/maildir/maildir-save.c:
	Added asserts
	[359bfdd06b27]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	Restore sync_ctx->next_uid to original value when beginning a
	rewrite. This could fix some problems with broken UIDs causing
	crashes.
	[0f410e51e36f]

	* src/lib-storage/index/mbox/mbox-sync.c:
	If mbox had broken UIDs and we didn't rewrite them, don't mark the
	index as being synced.
	[38adf005146b]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	If message had one invalid X-UID and another valid X-UID, we still
	marked the valid one with uid_broken=TRUE.
	[831fa7e4caa0]

	* src/lib-index/mail-index-sync-keywords.c:
	Removed accidentally committed debug assert.
	[eef4cdd5df99]

	* src/deliver/deliver.c:
	If config file contained quoted "value", the quotes weren't
	stripped. syslog_facility wasn't converted from name to numeric
	value.
	[167c602ef8b4]

2007-01-21  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	If log_timestamp isn't uncommented in dovecot.conf, use the default.
	[1acb3b558c3f]

	* src/login-common/login-proxy.c, src/login-common/login-proxy.h:
	Forgot to commit for the "log proxy destination" change.
	[5c0a5cf4626d]

2007-01-19  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c:
	Moved dovecot-acl file from control dir to mail directory, except
	with mboxes. If the file still exists in control dir, Dovecot kills
	itself (rather than give full access to the mailbox).
	[e92b4ad15b70]

	* src/imap-login/imap-proxy.c, src/pop3-login/pop3-proxy.c:
	Log the proxy destination host:port.
	[f2cc68a3a198]

	* src/imap/cmd-status.c:
	Doing a STATUS for unknown storage shouldn't return with "needs more
	data" from the function.
	[151fb7a170c5]

	* src/deliver/deliver.c:
	Ignore empty parameters. "Unknown argument: xx" printed wrong
	argument. Patch by Jan Srzednicki
	[1e5b5484c603]

	* src/lib-index/mailbox-list-index-sync.c:
	Fixed index updating when mailboxes were deleted.
	[6eb476100897]

	* src/lib/failures.c:
	If we can't open the log file, write the error to stderr instead of
	relying on the existing fatal handler which may not do anything.
	[c14b0e20ff63]

	* src/plugins/Makefile.am:
	Forgot to add mail-log here.
	[aa0927730b5c]

	* src/auth/db-ldap.c:
	Removed accidentally committed debugging code.
	[b307bb3ec598]

	* src/auth/auth-request.c:
	auth cache: If passdb didn't provide the password, we used the user-
	given plaintext password, but we cached it with wrong scheme unless
	the passdb's default scheme was plain.
	[953f02db95dc]

	* src/auth/auth-master-connection.c, src/auth/auth-master-
	connection.h, src/auth/auth-request-handler.c, src/auth/auth.c,
	src/auth/db-ldap.h, src/auth/main.c, src/auth/userdb-ldap.c:
	Several fixes to handling deinitialization without crashing.
	[b2921478f94f]

	* src/auth/db-ldap.c, src/auth/passdb-ldap.c:
	Do ldap_bind() only when there are no requests waiting, and don't do
	anything until ldap_bind() has finished. This fixes several problems
	with auth_bind=yes.
	[d7198e2682c6]

	* src/auth/auth-request.c:
	If request fails with internal failure, don't crash if auth cache is
	disabled.
	[df93cf66022a]

2007-01-18  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Allow --with-vpopmail=path specify the vpopmail_home path.
	[80f0ee36e905]

	* configure.in, src/plugins/mail-log/.cvsignore, src/plugins/mail-
	log/Makefile.am, src/plugins/mail-log/mail-log-plugin.c, src/plugins
	/mail-log/mail-log-plugin.h:
	Added mail_log plugin to log various mail operations. Currently it
	logs mail copies, deletions, expunges and mailbox deletions.
	[1b28e0434d85]

	* src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-util.c:
	Saved mails and dovecot-keywords file didn't set the group from
	dovecot-shared file.
	[612b5c358d2e]

	* dovecot-example.conf, src/lib-storage/index/index-storage.c, src
	/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/mbox/mbox-file.c, src/lib-
	storage/index/mbox/mbox-lock.c, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/master/mail-process.c, src/master
	/master-settings-defs.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Removed mail_read_mmaped setting. It's a pretty useless setting and
	apparently it can also be buggy.
	[b6b2b1d98f42]

	* src/lib-storage/list/index-mailbox-list.c:
	Cleanups
	[8661cc109e90]

	* src/lib/ioloop-notify-inotify.c:
	If inotify_add_watch() fails with ESTALE, don't log an error.
	[b4adc5bc7f2b]

	* src/master/master-settings.c:
	base_dir doesn't need to be group-readable, don't force it.
	[75c9fe0e0005]

	* src/lib-index/mail-index.c:
	Memory pool size changes
	[774c965ac79a]

	* src/lib-index/mail-cache-compress.c:
	debug: Don't bother warning about cache compressions. It has lived
	its usefulness.
	[787ead060fe3]

	* src/lib/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib
	/mempool-system.c, src/lib/mempool-unsafe-datastack.c,
	src/lib/mempool.h:
	Don't keep the memory pool virtual functions in the pool structure
	itself, rather access them via a pointer to a shared virtual
	function struct. Reduces memory usage a bit.
	[d7e064f77f79]

	* src/lib/buffer.c:
	cleanup
	[1f4216e1d060]

	* src/lib-imap/imap-parser.c, src/lib-index/mail-index.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/list/mailbox-list-maildir.c:
	Use larger default pool sizes
	[a8a274b4c87c]

	* src/lib-index/mail-hash.c:
	Compiler warning fixes
	[bf78471d6198]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	keywords.c, src/lib-index/mail-index-sync-private.h, src/lib-index
	/mail-index-sync-update.c, src/lib-index/mail-index.c:
	Keywords were sometimes being re-added to the index even while they
	already existed, causing the record size to bloat.
	[2c60e03d2bf6]

2007-01-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c:
	Don't rename() .log to .log.2, because it temporarily loses the log
	file. Use unlink() + link() instead.
	[623ed4a5339b]

	* src/lib-index/mail-index-view-sync.c:
	unreliable_flags wasn't always set correctly, which caused "xxx
	counter wrong" errors and such.
	[ac2be98ea811]

	* src/lib-index/mail-index-fsck.c:
	cleanup
	[595dcb33802f]

	* src/lib/ioloop-notify-dn.c:
	Disable dnotify silently if it's not supported by the kernel. We
	were missing one check.
	[9b8c3efa85ec]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c, src/lib-index/mail-transaction-log-
	view.c, src/lib-index/mail-transaction-log.c:
	Fixes to error handling paths.
	[987397c331d7]

	* src/lib-index/mail-index-sync-ext.c:
	A new "extension introduction" in transaction log could have left
	some existing views to contain an invalid mapping where it contained
	the new extension, but with a wrong record_size.
	[874dede81cc1]

	* src/lib-index/mail-transaction-log.c:
	And now really fix the log rotation race.
	[aa4ff7a9c3f7]

	* src/lib-index/mail-cache.c:
	Make sure file_seq isn't zero in cache file header.
	[59b04ed146a9]

2007-01-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log.c:
	Fixed a race condition in transaction log rotation, which could have
	caused log data to be overwritten.
	[6c76ed030b60]

	* src/lib-index/mail-index-sync-update.c:
	cleanup
	[f1431e82375d]

	* src/lib-index/mail-index.c:
	Make sure that extensions don't point outside allocated record size.
	[257512aaa8f3]

	* src/lib-storage/list/subscription-file.c, src/plugins/fts-squat
	/squat-trie.c, src/plugins/fts-squat/squat-uidlist.c:
	Compiler warning fixes
	[8c1433eb2ba9]

	* configure.in, src/lib-storage/index/maildir/maildir-storage.c, src
	/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-util.c:
	When opening maildir, check if tmp/'s atime is over 8h old. If it
	is, delete old files in it. However if atime - ctime > 36h, it means
	there's nothing to be deleted so the scanning isn't done then. We
	update atime if filesystem is mounted with noatime.
	[06b281c1f543]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c:
	Added some extra checks/asserts
	[5ea657b6d83c]

	* src/lib-index/mail-index-view.c:
	UID -> seq lookup: Optimize UID=1 and UID=<next_uid>-1 cases.
	[37e0b70b8926]

	* src/auth/db-ldap.c:
	Last change for making ldap_bind() error handling better was
	actually broken.
	[129aa779a7f8]

	* src/auth/auth-request-handler.c, src/auth/auth-stream.c, src/auth
	/auth-stream.h, src/auth/passdb-blocking.c, src/auth/userdb-
	prefetch.c:
	extra_fields == NULL and empty extra_fields (reset after each passdb
	lookup) should be treated the same. Fixes some assert crashes.
	[7a8f68b0cc31]

2007-01-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c:
	We could have synced external transactions multiple times, causing
	corrupted view errors.
	[13db2cd1ae94]

	* src/lib-index/mail-index-view-sync.c:
	View syncing could have caused some transactions to be synced
	multiple times in some situations.
	[327d82f579a2]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h:
	Removed file offset caching from mail_cache_foreach(). It didn't
	work correctly when cache file was just compressed, and caused
	"cache file corrupted" errors.
	[82747a8b0b8b]

	* src/lib-mail/message-parser.c:
	CR removing from parsed mails didn't work properly for multipart
	mails.
	[c0a9bab3fc32]

	* autogen.sh:
	Copy config.rpath before running autoreconf.
	[d410ee18ae93]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	Grow the initial pool sizes a bit.
	[53d69594ee04]

2007-01-09  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	Delete all auth-worker.* files from Dovecot's base_dir when
	starting.
	[f37c7895eb8f]

	* src/lib-mail/message-body-search.c:
	When searching MIME body headers, make sure we don't go out of
	bounds with broken MIME messages and cause assert-crash.
	[b76f864f0e0b]

	* src/auth/db-ldap.c:
	If ldap_bind() fails directly, log the "ldap server down" errors
	more nicely.
	[cfef56a6bf4a]

2007-01-07  Timo Sirainen  <tss@iki.fi>

	* src/auth/userdb-blocking.c:
	We sent extra "OK" to master, causing it to think it was the
	username.
	[1a5a408923f3]

2007-01-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c:
	Don't assert-crash if a command is waiting in queue after we've
	disconnected the client for some reason.
	[b7daf0849f27]

	* src/util/rawlog.c:
	Added -i and -o options to rawlog to restrict logging to only input
	or output.
	[62bbe686dc30]

	* src/plugins/lazy-expunge/lazy-expunge-plugin.c:
	If index/control dirs were different than the maildir, deleting
	mailboxes didn't move their contents correctly.
	[d45c13b90629]

2007-01-04  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-cache.c:
	Changed assert so it doesn't give a compiler warning with 32bit
	systems.
	[e4afafbb963b]

	* autogen.sh:
	Comment out the configurable dir environments.
	[786556485e91]

	* .cvsignore:
	Added config.rpath
	[6acd005ad980]

	* autogen.sh:
	Rewrite. Use autoreconf now. Also copy config.rpath from gettext's
	directory.
	[12d853120b45]

	* src/login-common/main.c:
	Crashfix
	[7179db893d3e]

	* src/login-common/main.c:
	Don't keep a connection open to dovecot-auth when we're only
	proxying.
	[5088f394fa72]

	* src/lib-storage/list/mailbox-list-fs.c, src/lib-storage/list
	/mailbox-list-maildir.c:
	mail_full_filesystem_access=yes: Fixed handling mailboxes beginning
	with ~.
	[c2a4ea08d681]

	* src/lib/home-expand.c, src/lib/home-expand.h:
	Added home_try_expand()
	[0caa09cc3edb]

2006-12-31  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	We crashed if auth cache was disabled. Patch by Andrey Panin.
	[8089e7461519]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index.c:
	Minor locking fix/cleanups.
	[118db9212f77]

	* src/lib-index/mail-index-view-sync.c:
	If we didn't sync everything in the view, we could have synced some
	transactions multiple times causing different kinds of problems.
	[173c5ea4a7c4]

2006-12-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-uidlist.c, src/lib/mempool-
	alloconly.c, src/lib/mempool.h:
	debug: MEMPOOL_GROWING prefix in alloconly pool names means that
	when the memory pool needs to be grown, there's no need to log a
	warning.
	[8e88ecc64563]

	* src/lib-storage/index/maildir/maildir-keywords.c:
	Grow default pool size
	[b51777b0834c]

	* src/lib/fd-close-on-exec.c:
	debug: OSX leaks an fd from gettimeofday(), ignore it. Also cleaned
	up the code a bit.
	[8d2efdb73816]

2006-12-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	view.c:
	If there are transactions left while unlocking, don't unlock. Also
	added some next_uid debugging.
	[a9babc1b3c65]

	* src/lib-storage/index/index-status.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-sync.c, src/lib-storage/index
	/index-transaction.c:
	Reversed last change. Doing it another way.
	[4d947423c82f]

	* src/lib-storage/index/index-status.c, src/lib-storage/index/index-
	sync.c, src/lib-storage/index/index-transaction.c:
	Call mail_index_view_unlock() only when all transactions are
	finished.
	[1bc48cee6420]

	* src/master/main.c:
	If ssl_disable=yes, don't bother resolving ssl_listen. Also if
	listen or ssl_listen resolving fails, log if it was listen or
	ssl_listen setting that caused the error.
	[4654603f24f6]

	* src/imap/cmd-fetch.c, src/imap/imap-fetch-body.c, src/imap/imap-
	fetch.c, src/imap/imap-fetch.h:
	When client fetches message data that has already been expunged,
	reply with dummy NIL and such values for the message. Don't
	disconnect the client anymore.
	[ec41129cd0ef]

	* src/imap/imap-fetch.c:
	Removed accidentally committed TEXTSIZE FETCH parameter.
	[0103df03b5d4]

	* src/lib/ioloop-poll.c:
	If we get POLLNVAL, disable events completely for the io so we don't
	just loop forever.
	[0c93af60fa9d]

	* src/master/mail-process.c:
	Forgot to send dotlock_use_excl to mail processes..
	[d3b8fcc72c69]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-storage.h, src/lib-storage/index/dbox/dbox-
	sync-expunge.c, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-storage/index/mbox
	/mbox-lock.c:
	More dotlock_use_excl uses.
	[5c18ac362f65]

	* dovecot-example.conf, src/deliver/duplicate.c, src/lib-index/mail-
	cache.c, src/lib-index/mail-hash.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	src/lib-index/mail-transaction-log.c, src/lib-index/mailbox-list-
	index-private.h, src/lib-index/mailbox-list-index.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/list/subscription-
	file.c, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/lib-storage/mailbox-list.h, src/master/master-
	settings-defs.c, src/master/master-settings.c, src/master/master-
	settings.h, src/plugins/convert/convert-storage.c, src/plugins/quota
	/quota-maildir.c:
	Added dotlock_use_excl setting.
	[1baf9dd3fc40]

	* src/lib-storage/index/maildir/maildir-save.c:
	Use rename() instead of link() + unlink() when moving a mail from
	tmp/ to new/.
	[1104fc097321]

	* src/lib-auth/auth-client.c, src/lib-auth/auth-server-connection.h:
	If no auth sockets are found in 10 seconds, kill ourself.
	[5df66ce64c0c]

	* src/master/main.c, src/master/master-settings.c, src/master/master-
	settings.h:
	-n and -a parameters shouldn't be deleting auth sockets.
	[9246d9308caa]

	* src/plugins/acl/acl-api-private.h, src/plugins/acl/acl-api.c,
	src/plugins/acl/acl-backend-vfile.c, src/plugins/acl/acl-backend.c,
	src/plugins/acl/acl-plugin.c:
	If debug is enabled, log some debugging messages. Also cleaned up
	the code bit, and made "acl = vfile" not require ":" after the
	"vfile".
	[3ed0749731d2]

	* src/deliver/Makefile.am, src/deliver/deliver.c, src/master/master-
	settings-defs.c, src/master/master-settings.c:
	deliver was treating boolean settings set to "no" as if they were
	"yes" (usually they were supposed to be commented out)
	[b13c7888563c]

2006-12-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-otp/otp-hash.c:
	s/swab/swab_uint32/. swab() already exists in libc and it may
	conflict.
	[7d8d82d0e5e5]

2006-12-22  Timo Sirainen  <tss@iki.fi>

	* src/lib/failures.c:
	s/Backtrace/Raw backtrace/
	[e13de4a0bf90]

2006-12-22  Timo Sirainen  <timo.sirainen@movial.fi>

	* dovecot-example.conf, src/lib-storage/index/maildir/maildir-copy.c,
	src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h, src/master/mail-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added maildir_copy_preserve_filename setting.
	[4714befe2604]

2006-12-22  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Changed maildir_copy_with_hardlinks setting's description to be much
	more positive. It'll probably be set to yes by default in v2.0.
	[4ba6b31ae15e]

2006-12-21  Timo Sirainen  <tss@iki.fi>

	* src/util/dovecotpw.c:
	argv[] isn't unused.
	[e73c1354e263]

	* src/util/dovecotpw.c:
	getopt() return value should be stored into int, not into char.
	Fixes PowerPC Linux where char is unsigned.
	[e98e43994c0e]

	* src/imap/cmd-append.c:
	Don't crash after append.
	[8fd9913adad8]

2006-12-21  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/auth/auth-cache.c, src/auth/auth-request.c, src/auth/auth-
	request.h, src/auth/userdb-ldap.c, src/auth/userdb-passwd-file.c,
	src/auth/userdb-passwd.c, src/auth/userdb-sql.c, src/auth/userdb-
	vpopmail.c, src/auth/userdb.h:
	Authentication cache caches now also userdb data. Code by Tommi
	Saviranta.
	[f0cc5486696e]

2006-12-21  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	auth_cache_size comment updated. It no longer has problems with
	identical usernames in different databases.
	[8bc6aeec99d9]

	* src/auth/userdb-sql.c:
	"Password query" -> "User query" in error messages.
	[e8f92337ed5a]

	* src/lib/module-dir.c:
	If the module dir doesn't exist, die only if we were given a list of
	modules to load. Otherwise fail silently.
	[67561e996a00]

	* src/auth/passdb.c:
	Fix
	[048bac106793]

	* src/plugins/fts/fts-storage.c:
	If indexing takes over 10 seconds, start giving estimates about when
	it's finished.
	[16dd9aa9d275]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-storage/index
	/index-search.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/mail-storage-private.h:
	Moved storage callbacks to struct mail_storage. If searching takes
	over 10 seconds, start giving estimates about when it's ready.
	[a959d4208b54]

	* src/plugins/fts/fts-storage.c:
	Don't build indexes just for header lookups.
	[66c1578edc0e]

	* src/plugins/fts-squat/squat-test.c, src/plugins/fts-squat/squat-
	trie.c:
	Cleanups and fixes
	[8be1ce6cfeec]

	* src/plugins/fts/fts-storage.c:
	Make indexing non-blocking. Optimize also header searches.
	[460d589403d0]

	* src/lib/module-dir.c:
	Give an error if there are duplicate files for a single module. Also
	if the module directory can't be opened, die immediately.
	[cc9832968e8e]

	* src/lib/array-decl.h:
	Defined a universal const_string array type.
	[51e2a2adc141]

	* src/imap/cmd-x-cancel.c:
	Forgot to add
	[0caa14813235]

2006-12-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-search.c, src/lib-storage/index/index-search.c, src
	/lib-storage/mail-search.c, src/lib-storage/mail-search.h,
	src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins/fts-squat
	/fts-backend-squat.c, src/plugins/fts/fts-api-private.h,
	src/plugins/fts/fts-storage.c:
	Added support for X-BODY-FAST and X-TEXT-FAST SEARCH arguments. FTS
	plugin now allows loading two backends: exact and fast. Fast backend
	(Lucene) can be used to optimize only those searches, while exact
	backend (Squat) can be used to optimize normal BODY and TEXT
	searches as well.
	[b382b21409b5]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-uid.c,
	src/imap/commands.c, src/imap/commands.h:
	If running commands in parallel would cause ambiguity, run them
	sequentially.
	[f612d2086448]

	* src/imap/cmd-status.c:
	If STATUS command is done for a selected mailbox, don't sync it.
	This could have caused lost EXPUNGEs among other lost replies..
	[76aa8a360c2f]

	* src/imap/Makefile.am, src/imap/client.c, src/imap/client.h, src/imap
	/cmd-append.c, src/imap/cmd-fetch.c, src/imap/cmd-idle.c, src/imap
	/cmd-list.c, src/imap/cmd-search.c, src/imap/cmd-sort.c, src/imap
	/cmd-thread.c, src/imap/cmd-uid.c, src/imap/commands.c,
	src/imap/commands.h, src/imap/imap-fetch.c, src/imap/imap-fetch.h,
	src/imap/imap-sync.c, src/lib-storage/index/dbox/dbox-storage.c, src
	/lib-storage/index/index-search.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h:
	Dovecot is now able to execute multiple commands at the same time.
	Practically this means commands: FETCH, LIST, SEARCH and syncing
	output for all commands. For example it's possible that doing two
	FETCH commands at the same time makes their output mixed together.

	Non-blocking SEARCH is done by doing search for 20 mails at a time,
	and then checking if another command is pending.

	Also added X-CANCEL <tag> command to cancel running commands.
	[ff2272c228cc]

	* src/lib/ostream-file.c:
	Delay setting the TCP cork until something is actually sent to the
	network.
	[e3539fafe74f]

	* src/plugins/quota/quota-count.c:
	Compiler warning fix
	[4936071e7a96]

	* src/lib-index/mail-hash.c:
	Removed debugging #if 0.
	[13f793a3051d]

	* src/lib-storage/index/index-sort.c:
	Compiler warning fix
	[f768dd773e6b]

	* src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins/fts-lucene
	/lucene-wrapper.cc, src/plugins/fts-lucene/lucene-wrapper.h,
	src/plugins/fts/fts-api.c:
	Fixed filtering to work with Lucene. Generic FTS code now implements
	the filtering if the backend doesn't.
	[5ffaf2d47671]

	* src/plugins/fts-squat/squat-uidlist.c:
	Use seq_range_array_remove_range() instead of slowly iterating
	ourself.
	[44a0e7606f7a]

	* src/lib/seq-range-array.c, src/lib/seq-range-array.h:
	Added seq_range_array_remove_range()
	[f38f3f11a93f]

	* src/plugins/fts-squat/squat-uidlist.c:
	Actually the code wasn't unneeded, put it back and actually execute
	it now.
	[59ce1d6c0b8c]

	* src/plugins/fts-squat/squat-uidlist.c:
	Removed unneeded code
	[8a5985446cce]

	* src/lib-index/mailbox-list-index-private.h, src/lib-index/mailbox-
	list-index-sync.c, src/lib-index/mailbox-list-index.c, src/lib-
	storage/list/index-mailbox-list.c:
	Compress list index when its deleted space amount gets too high.
	Also fixed several bugs.
	[791c9c8d3a02]

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache.c:
	Prefix COMPRESS_* defines with MAIL_CACHE_.
	[bb4ec18672fe]

	* src/imap/imap-thread.c, src/lib-index/mail-hash.c, src/lib-index
	/mail-hash.h:
	Fixes to hash compression and 1:n search.
	[ac0bafad331b]

	* src/pop3/main.c:
	"Set pop3_uidl_format in config file" may be easier to understand..
	[30c7deb0aca7]

	* dovecot-example.conf:
	Updated pop3_uidl_format comments.
	[15fd97d86693]

	* src/imap-login/client-authenticate.c, src/login-common/common.h,
	src/pop3-login/client-authenticate.c:
	"Plaintext authentication disabled" -> "Plaintext authentication
	disallowed on non-secure connections"
	[98780639b190]

	* configure.in:
	Added THREAD=X-REFERENCES2 capability.
	[c1965cbf5c87]

	* src/imap/imap-thread.c:
	Optimize also 1:n seqset searches. Fixed also a case where we failed
	too early when trying to find a Message-ID for a crc32.
	[a3955deadc1d]

	* src/imap/cmd-thread.c, src/imap/imap-thread.c, src/imap/imap-
	thread.h, src/lib-index/mail-hash.c, src/lib-index/mail-hash.h:
	Implemented X-REFERENCES2 threading. Two differences to standard
	REFERENCES: Sort root nodes by the newest mail in the thread, and
	don't do base subject merging.
	[050355eeff5d]

	* src/lib-storage/index/index-storage.c:
	Fix
	[b25483838ab8]

	* src/lib-index/mail-index.c:
	If mail_index_move_to_memory() was called before index file was
	opened, we didn't properly mark it as "in-memory".
	[d54145736f99]

2006-12-17  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/lib-index/mail-cache-compress.c, src/lib-
	index/mail-cache-transaction.c, src/lib-index/mail-hash.c, src/lib-
	index/mail-index-lock.c, src/lib-index/mail-index-private.h, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	storage/index/dbox/dbox-uidlist.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-sync.c, src/master
	/master-settings.c, src/master/master-settings.h:
	Added fsync_disable setting. Also added missing fsync()ing to dbox
	when saving mails.
	[2f9173e103fd]

	* src/plugins/quota/quota-maildir.c:
	Fixed a file descriptor at deinit.
	[5d00d8a7888e]

2006-12-17  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/lazy-expunge/lazy-expunge-plugin.c:
	Fixes
	[651605333987]

2006-12-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.h:
	maildir_file_do() takes uid, not seq..
	[1dd790222797]

2006-12-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c, src/auth/auth-worker-client.c,
	src/auth/passdb.c, src/auth/passdb.h, src/auth/password-scheme.c:
	Changed the default naming for password schemes: HMAC-MD5 -> CRAM-
	MD5. MD5
	-> MD5-CRYPT. The old names still work for backwards compatibility.
	[25597644067a]

2006-12-16  Timo Sirainen  <timo.sirainen@movial.fi>

	* configure.in, dovecot-example.conf, src/plugins/Makefile.am,
	src/plugins/lazy-expunge/.cvsignore, src/plugins/lazy-
	expunge/Makefile.am, src/plugins/lazy-expunge/lazy-expunge-plugin.c,
	src/plugins/lazy-expunge/lazy-expunge-plugin.h:
	Added lazy expunge plugin.
	[dea1c8fa53f4]

2006-12-16  Timo Sirainen  <tss@iki.fi>

	* src/imap/namespace.c, src/imap/namespace.h:
	Added namespace_find_prefix().
	[b08e63f6dcfd]

	* src/imap/imap-thread.c:
	Compiler warning fix
	[a922fce151d8]

	* src/plugins/convert/Makefile.am, src/plugins/expire/Makefile.am,
	src/plugins/fts-lucene/Makefile.am, src/plugins/fts-
	squat/Makefile.am, src/plugins/fts/Makefile.am, src/plugins/imap-
	quota/Makefile.am, src/plugins/quota/Makefile.am,
	src/plugins/trash/Makefile.am, src/plugins/zlib/Makefile.am:
	Changed the plugin filename numbering (ie. the ordering in which the
	plugins are loaded). This doesn't change anything for current
	plugins, but future plugins will need this change so they can get
	themselves loaded between specific plugins.
	[e66dc3774099]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib/compat.h:
	Added EDESTDIREXISTS() macro, and changed rename() calls to use it.
	[5ea3e08af1e2]

	* src/lib-storage/index/maildir/maildir-storage.c:
	rename and delete operations didn't touch control directory if it
	was different from maildir or index dir.
	[94c302ea79bd]

2006-12-15  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-master-listener.c, src/auth/auth-worker-
	client.c, src/auth/auth-worker-server.c, src/auth/db-ldap.c,
	src/auth/db-sql.c, src/auth/passdb-checkpassword.c, src/auth/passdb-
	pam.c, src/auth/passdb-sql.c, src/auth/userdb-sql.c, src/deliver
	/auth-client.c, src/dict/dict-server.c, src/imap-login/client-
	authenticate.c, src/imap-login/client.c, src/imap-login/client.h,
	src/imap-login/imap-proxy.c, src/imap/client.c, src/imap/client.h,
	src/imap/cmd-append.c, src/imap/cmd-idle.c, src/imap/imap-fetch-
	body.c, src/imap/imap-fetch.c, src/imap/imap-fetch.h, src/imap/imap-
	thread.c, src/lib-auth/auth-client.c, src/lib-auth/auth-server-
	connection.c, src/lib-sql/driver-pgsql.c, src/lib-sql/sql-api.h, src
	/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mailbox-check.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/maildir/maildir-
	copy.c, src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/lib/ioloop-notify-inotify.c, src/lib/ioloop-notify-
	kqueue.c, src/lib/ostream-file.c, src/login-common/login-proxy.c,
	src/login-common/ssl-proxy-gnutls.c, src/login-common/ssl-proxy-
	openssl.c, src/master/auth-process.c, src/master/auth-process.h,
	src/master/dict-process.c, src/master/log.c, src/master/login-
	process.c, src/master/master-settings.c, src/plugins/expire/auth-
	client.c, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/client.h,
	src/pop3-login/pop3-proxy.c, src/pop3/client.c, src/util/rawlog.c:
	Replaced void *context from a lot of callbacks with the actual
	context type. Also added/fixed some context type checks.
	[5b4c9b20eba0]

	* src/auth/auth-request-handler.h, src/imap/imap-fetch.c, src/imap
	/imap-fetch.h, src/lib-auth/auth-client.c, src/lib-auth/auth-
	client.h, src/lib-auth/auth-server-request.c, src/lib-index/mail-
	cache-lookup.c, src/lib-index/mail-cache-private.h, src/lib-index
	/mail-hash.h, src/lib-index/mail-index-private.h, src/lib-index
	/mail-index.c, src/lib-mail/istream-header-filter.h, src/lib-mail
	/message-content-parser.c, src/lib-mail/message-content-parser.h,
	src/lib-mail/message-header-decode.c, src/lib-mail/message-header-
	decode.h, src/lib-mail/message-header-parser.h, src/lib-mail
	/message-parser.h, src/lib-settings/settings.h, src/lib-sql/sql-
	api.h, src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-storage/mail-search.h,
	src/lib-storage/mailbox-list.c, src/lib-storage/mailbox-list.h,
	src/lib/lib-signals.c, src/lib/lib-signals.h, src/lib/macros.h, src
	/login-common/login-proxy.h:
	Type safe callbacks weren't as easy as I thought. Only callback(void
	*context) can be handled generically. Others can be handled
	specially, but only if all the parameters are pointers, otherwise
	eg. int parameter can be replaced with long without compiler giving
	any warnings.
	[0c3c948412c5]

	* src/lib-auth/auth-client.c:
	And remove a bit more code.
	[ab47138f5c8f]

	* src/lib-auth/auth-client.c, src/lib-auth/auth-client.h, src/lib-auth
	/auth-server-connection.c, src/lib-auth/auth-server-connection.h:
	Removed support for external I/O loop. The point was originally that
	this library could be used by external software to talk to dovecot-
	auth, but nowadays it's much easier to just implement the
	authentication protocol.
	[f98ee68ab23f]

	* src/auth/auth-request-handler.c, src/auth/auth-request-handler.h,
	src/auth/db-ldap.c, src/auth/db-sql.c, src/auth/main.c,
	src/deliver/deliver.c, src/deliver/mail-send.c, src/dict/main.c, src
	/imap-login/client.c, src/imap/cmd-append.c, src/imap/imap-fetch.c,
	src/imap/imap-fetch.h, src/imap/imap-thread.c, src/imap/main.c, src
	/lib-auth/auth-client.c, src/lib-auth/auth-client.h, src/lib-auth
	/auth-server-request.c, src/lib-imap/imap-bodystructure.c, src/lib-
	index/mail-cache-lookup.c, src/lib-index/mail-cache-private.h, src
	/lib-index/mail-cache.c, src/lib-index/mail-hash.c, src/lib-index
	/mail-hash.h, src/lib-index/mail-index-private.h, src/lib-index
	/mail-index.c, src/lib-mail/istream-header-filter.c, src/lib-mail
	/istream-header-filter.h, src/lib-mail/message-body-search.c, src
	/lib-mail/message-content-parser.c, src/lib-mail/message-content-
	parser.h, src/lib-mail/message-decoder.c, src/lib-mail/message-
	header-decode.c, src/lib-mail/message-header-decode.h, src/lib-mail
	/message-header-parser.c, src/lib-mail/message-header-parser.h, src
	/lib-mail/message-parser.c, src/lib-mail/message-parser.h, src/lib-
	settings/settings.c, src/lib-settings/settings.h, src/lib-sql/sql-
	api.c, src/lib-sql/sql-api.h, src/lib-storage/index/index-mail.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/mail-search.c, src/lib-storage/mail-
	search.h, src/lib-storage/mailbox-list.c, src/lib-storage/mailbox-
	list.h, src/lib/ioloop-notify-dn.c, src/lib/ioloop.c,
	src/lib/ioloop.h, src/lib/lib-signals.c, src/lib/lib-signals.h,
	src/lib/macros.h, src/lib/ostream.c, src/lib/ostream.h, src/login-
	common/login-proxy.c, src/login-common/login-proxy.h, src/login-
	common/main.c, src/master/main.c, src/pop3-login/client.c,
	src/pop3/main.c:
	Added context parameter type safety checks for most callback APIs.
	[204d7edc7cdc]

2006-12-13  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-squat/squat-trie.c:
	Handle broken UTF8
	[92f7f19c8c58]

	* src/plugins/fts-squat/squat-trie.c, src/plugins/fts-squat/squat-
	trie.h:
	Only ASCII texts were actually indexed. Now UTF-8 input is properly
	converted to UTF-16 which is indexed.
	[5e604d6f391e]

	* src/plugins/fts-lucene/lucene-wrapper.cc:
	Removed utf8_strlen_n() here and used the one from unichar.h
	[632f56aee275]

	* src/lib/Makefile.am, src/lib/unichar.c, src/lib/unichar.h:
	Added unichar_t UCS-4 type and some ucs4/utf8 functions.
	[c98008a7e9b7]

	* src/plugins/fts-squat/squat-trie.c:
	Optimization.
	[07a038b57946]

	* src/plugins/fts-squat/squat-trie.c:
	Use realloc instead of alloc+free.
	[30834ce4362f]

2006-12-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mailbox-list-index-private.h, src/lib-index/mailbox-
	list-index-sync.c, src/lib-index/mailbox-list-index.c, src/lib-
	storage/list/index-mailbox-list.c:
	Mailbox list index works now with mmap_disable=yes.
	[3d00a9636393]

	* src/lib-index/mail-index-view.c:
	If looked up record contains UID=0, mark the index corrupted.
	[95594bcf13ab]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-
	transaction.c, src/lib-storage/index/maildir/maildir-storage.c, src
	/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	sync.c:
	Make sure the mailbox is opened when transaction is started (fixes
	deliver). Also did some other API cleanups, mailbox index opening
	can't fail anymore.
	[24afafbfe47b]

	* src/lib-storage/list/index-mailbox-list-sync.c:
	Don't crash with indexes disabled.
	[f82adecdca19]

	* src/lib-index/mail-index-lock.c:
	Don't crash with in-memory indexes
	[2a6a5335d3c3]

	* src/deliver/Makefile.am, src/deliver/deliver.c,
	src/plugins/convert/Makefile.am, src/plugins/convert/convert-tool.c,
	src/plugins/expire/Makefile.am, src/plugins/expire/expire-tool.c,
	src/pop3/Makefile.am, src/pop3/main.c:
	Only imap binary was actually working.
	[6ab2712f1a93]

	* src/plugins/fts-squat/squat-trie.c:
	64bit and big endian fixes
	[cb3b4153136c]

	* src/plugins/fts-squat/squat-uidlist.c:
	Don't break if we indexed only one message.
	[a4a299175237]

	* src/lib-mail/message-decoder.c, src/lib-storage/index/index-
	storage.c:
	Memory leak fixes
	[c3e15280e4cb]

	* src/plugins/fts-squat/squat-trie.c, src/plugins/fts-squat/squat-
	uidlist.c:
	Another try at memory reduction / leak fixes
	[463a4ebba685]

	* src/plugins/fts-squat/squat-trie.c, src/plugins/fts-squat/squat-
	uidlist.c, src/plugins/fts-squat/squat-uidlist.h:
	Memory leak fixes. Also when building a large mailbox flush once in
	a while to free memory.
	[ae2114f11a0e]

2006-12-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-decoder.c:
	Fixes
	[902d24d14932]

	* src/plugins/fts/fts-storage.c:
	Don't waste memory in data stack.
	[8a09d03e6628]

	* src/plugins/fts-squat/fts-backend-squat.c, src/plugins/fts-squat
	/squat-trie.c, src/plugins/fts-squat/squat-uidlist.c, src/plugins
	/fts-squat/squat-uidlist.h:
	Added support for mmap_disable=yes and several other fixes.
	[d8adbe93c969]

	* src/plugins/fts/fts-storage.c:
	Delay calling fts_backend_init() until first transaction is created.
	By that time the mailbox has been synced and things like uidvalidity
	can be looked up.
	[969cf7a88c25]

	* src/lib/file-lock.c:
	Forgot to remove debugging abort() call
	[53ac6f2c1242]

	* src/auth/auth-master-connection.c, src/auth/auth-request-handler.c,
	src/auth/auth-request.c, src/auth/auth-request.h, src/auth/auth-
	worker-client.c, src/auth/userdb-blocking.c, src/auth/userdb-ldap.c,
	src/auth/userdb-passwd-file.c, src/auth/userdb-passwd.c, src/auth
	/userdb-prefetch.c, src/auth/userdb-sql.c, src/auth/userdb-static.c,
	src/auth/userdb-vpopmail.c, src/auth/userdb.h:
	We treated internal userdb lookup errors as "user unknown" errors.
	In such situations this caused deliver to think the user didn't
	exist and the mail get bounced.
	[4ec6a4def05b]

2006-12-07  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-squat/fts-backend-squat.c, src/plugins/fts-squat
	/squat-test.c, src/plugins/fts-squat/squat-trie.c, src/plugins/fts-
	squat/squat-trie.h, src/plugins/fts-squat/squat-uidlist.c,
	src/plugins/fts-squat/squat-uidlist.h:
	Fixes
	[b0ada6e57b07]

2006-12-06  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-squat/fts-backend-squat.c, src/plugins/fts-squat
	/squat-test.c, src/plugins/fts-squat/squat-trie.c, src/plugins/fts-
	squat/squat-trie.h, src/plugins/fts-squat/squat-uidlist.c,
	src/plugins/fts-squat/squat-uidlist.h:
	Fixes. Should be pretty much working now.
	[88a91d9a867b]

	* src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins/fts/fts-
	api-private.h, src/plugins/fts/fts-api.c, src/plugins/fts/fts-api.h,
	src/plugins/fts/fts-storage.c:
	Added lock/unlock backend operations.
	[63d3b76e44fe]

	* src/deliver/deliver.c, src/imap/namespace.c, src/lib-index/mail-
	cache-compress.c, src/lib-index/mail-cache-private.h, src/lib-index
	/mail-cache.c, src/lib-index/mail-hash.c, src/lib-index/mail-index-
	lock.c, src/lib-index/mail-index-private.h, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h, src/lib-index/mail-transaction-
	log-private.h, src/lib-index/mail-transaction-log.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/list/index-mailbox-list.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/lib-storage/mailbox-list.c, src/lib-storage/mailbox-
	list.h, src/lib/file-lock.c, src/lib/file-lock.h,
	src/plugins/convert/convert-storage.c, src/plugins/expire/expire-
	tool.c, src/pop3/main.c:
	Lock handling changes. Everything goes through file-lock API now and
	there's only a single enum listing the different lock methods. This
	change exposed some unneeded (or possibly even wrong?) unlock calls
	in index file handling which were fixed.
	[f1d77064884c]

	* src/lib-storage/list/index-mailbox-list-sync.c:
	Don't crash with in-memory indexes
	[0a4d36ec74a4]

2006-12-05  Timo Sirainen  <tss@iki.fi>

	* src/login-common/sasl-server.c:
	proxy=y logins can't log in either.
	[e39397cf0915]

2006-12-03  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/imap-proxy.c, src/pop3-login/pop3-proxy.c:
	Fixed crash with proxying.
	[32e2b35e3aac]

	* src/auth/auth-request.c, src/auth/password-scheme.c:
	Don't crash if plain-md5, plain-md4 or sha1 password is invalid and
	we're not using digest-md5 authentication..
	[07bdc78ce38e]

	* dovecot-example.conf:
	Updated dict quota examples.
	[a922f89a9e92]

	* src/plugins/quota/Makefile.am, src/plugins/quota/quota-count.c,
	src/plugins/quota/quota-dict.c, src/plugins/quota/quota-private.h,
	src/plugins/quota/quota.c:
	dict quota: If dictionary doesn't yet contain the quota, calculate
	it by going through all mails in all mailboxes.
	[e92b3eaab490]

	* src/lib-storage/mail-storage.c:
	Don't call mail_storage_created hook twice.
	[60071a98281c]

	* src/auth/passdb-pam.c:
	Set default_pass_scheme so that cache_key works instead of just
	assert-crashing.
	[3066b42c4b98]

	* src/lib/restrict-access.c:
	restrict_gid_first/last wasn't working correctly for non-primary
	groups. Also restrict_gid_first=0 caused failures if user had 0 in
	non-primary groups.
	[1120c8b667e5]

	* src/lib/file-cache.c:
	If mremap_anon() fails, don't leak/crash.
	[4ec6ceb0934a]

	* src/lib/file-cache.c:
	Check against offset/size overflows.
	[a69ab82d7346]

	* src/lib-storage/index/maildir/maildir-keywords.c:
	Use dovecot-shared file's mode also when creating dovecot-keywords
	file.
	[29d665ef8787]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-kqueue.c:
	s/array_get_modifyable/array_get_modifiable/
	[d13324a8e242]

	* configure.in, src/auth/mech-gssapi.c:
	Some systems have gssapi elsewhere than gssapi/gssapi.h. So check
	also plain gssapi.h. Based on patch by Chris Wakelin
	[bddfbc560857]

	* doc/variables.txt, src/login-common/client-common.c, src/login-
	common/client-common.h, src/login-common/main.c:
	Added %a=local port and %b=remote port variables for
	login_log_format_elements.
	[a688269c0dd4]

	* dovecot-example.conf, src/plugins/convert/convert-plugin.c,
	src/plugins/convert/convert-storage.c, src/plugins/convert/convert-
	storage.h, src/plugins/convert/convert-tool.c:
	Create storages with MAIL_STORAGE_FLAG_NO_AUTOCREATE flag so we
	don't keep recreating the old storage and converting it all the
	time. Also added convert_skip_broken_mailboxes flag.
	[87ae4d41bc10]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage.h:
	Added MAIL_STORAGE_FLAG_NO_AUTOCREATE flag which silently fails
	storage creation if the root directory doesn't exist. Otherwise the
	root dir is created.
	[92c0994a1fcf]

	* src/login-common/sasl-server.c:
	Uppercase the auth mechanism name so it's always uppercased in logs.
	[69a2b3d5f00d]

	* doc/variables.txt:
	Added smtp and deliver to %s explanation and changed IMAP/POP3 to
	lowercase.
	[32514e2d9670]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	Changed the service name from uppercase IMAP/POP3 to lowercase
	imap/pop3 so they're consistent with smtp/deliver.
	[f75041ec22ba]

2006-12-01  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/plugins/Makefile.am, src/plugins/fts-
	squat/.cvsignore, src/plugins/fts-squat/Makefile.am, src/plugins
	/fts-squat/fts-backend-squat.c, src/plugins/fts-squat/fts-squat-
	plugin.c, src/plugins/fts-squat/fts-squat-plugin.h, src/plugins/fts-
	squat/squat-test.c, src/plugins/fts-squat/squat-trie.c, src/plugins
	/fts-squat/squat-trie.h, src/plugins/fts-squat/squat-uidlist.c,
	src/plugins/fts-squat/squat-uidlist.h:
	Added "squat" full text search indexer backend. Its name and basic
	ideas originate to Cyrus's squat index, but Dovecot's implementation
	is completely different and it supports incremental updates.

	Still a bit broken and lacks locking, but I wanted to get this into
	CVS now.
	[5bc593f1a8f6]

	* src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins/fts/fts-
	api-private.h, src/plugins/fts/fts-api.c, src/plugins/fts/fts-api.h,
	src/plugins/fts/fts-storage.c:
	Added fts_backend_expunge_finish() virtual backend function.
	[09b9b1e8f73d]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-storage-private.h:
	Removed get_mailbox_control_dir and get_mailbox_index_dir virtual
	functions from mail_storage, since they're already in
	mailbox_list.get_path(). Updated mbox to override that function to
	return index/control dirs with the ".imap/" in the middle.
	[3de63f9313a9]

	* src/plugins/convert/Makefile.am:
	Fixed dependencies
	[68edda84b056]

	* src/plugins/convert/Makefile.am, src/plugins/convert/convert-tool.c:
	Don't #include a .c file. Figured out another way to do it.
	[5255476a24b5]

2006-11-27  Timo Sirainen  <tss@iki.fi>

	* src/util/gdbhelper.c:
	Ignore SIG32 signal.
	[0c540b6a0551]

2006-11-26  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-thread.c, src/lib-index/mail-hash.c, src/lib-index
	/mail-hash.h:
	Resize the hash when needed. Also other fixes and cleanups.
	[7f2fee02b07c]

	* src/deliver/deliver.c, src/imap/Makefile.am, src/imap/cmd-list.c,
	src/imap/common.h, src/imap/imap-sync.c, src/imap/imap-thread.c,
	src/imap/main.c, src/imap/namespace.c, src/lib-index/Makefile.am,
	src/lib-index/mailbox-list-index-private.h, src/lib-index/mailbox-
	list-index-sync.c, src/lib-index/mailbox-list-index.c, src/lib-index
	/mailbox-list-index.h, src/lib-storage/index/dbox/dbox-storage.c,
	src/lib-storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox
	/dbox-transaction.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-sync.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-sync.h, src/lib-storage/index/maildir/maildir-
	transaction.c, src/lib-storage/index/maildir/maildir-util.c, src
	/lib-storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/index/mbox/mbox-transaction.c, src
	/lib-storage/list/Makefile.am, src/lib-storage/list/index-mailbox-
	list-sync.c, src/lib-storage/list/index-mailbox-list.c, src/lib-
	storage/list/index-mailbox-list.h, src/lib-storage/list/mailbox-
	list-fs-iter.c, src/lib-storage/list/mailbox-list-fs.c, src/lib-
	storage/list/mailbox-list-fs.h, src/lib-storage/list/mailbox-list-
	maildir-iter.c, src/lib-storage/list/mailbox-list-maildir.c, src
	/lib-storage/list/mailbox-list-maildir.h, src/lib-storage/mail-
	storage-private.h, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h, src/lib-storage/mailbox-list-private.h, src/lib-
	storage/mailbox-list.c, src/lib-storage/mailbox-list.h, src/lib-
	storage/mailbox-tree.c, src/lib-storage/register/Makefile.am,
	src/plugins/convert/convert-storage.c, src/plugins/trash/trash-
	plugin.c, src/pop3/client.c, src/pop3/common.h, src/pop3/main.c:
	Mailbox list indexing and related changes. Currently works only with
	maildir and mmap_disable=no. This allows doing STATUS to synced
	mailboxes without opening their index files at all.
	[967de900c73a]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	transaction.c:
	Don't break if extension record size isn't divisible with 32bit.
	[7f250cd01843]

2006-11-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-interface.h:
	Auth request timeout needs to be larger than login process timeout,
	which was just increased.
	[f358d1c28b9c]

2006-11-24  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/pop3-login/client.c:
	Increase allowed pre-login idle timeout from 1 minute to 3 minutes.
	This allows the user to type the password more slowly, although I
	haven't heard this causing problems for anyone.
	[5cb424ffa365]

2006-11-22  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-fs.c, src/plugins/quota/quota-maildir.c,
	src/plugins/quota/quota.c, src/plugins/quota/quota.h:
	Bytes and kilobytes were somewhat mixed up everywhere. Also fixes a
	compiling problem.
	[a0ba02928787]

2006-11-20  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	chdir() now gives error only if error is something else than ENOENT.
	Also with debugging enabled log if the home isn't found.
	[57955b19a35d]

2006-11-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c:
	Compile fix
	[57c5e40e26dd]

	* src/lib/backtrace-string.c:
	Handle backtrace_symbols() returning NULL without errors (out of
	memory).
	[c04ecbc7bdc8]

	* configure.in, src/lib/Makefile.am, src/lib/backtrace-string.c,
	src/lib/backtrace-string.h, src/lib/failures.c:
	Since getting core dumps can be sometimes difficult, if we now do
	abort() ourself, we first log the backtrace. This works at least
	with Linux and Solaris.
	[a0a38a306c17]

	* src/lib/file-cache.c:
	And accidentally reverted the first buffer overflow fix in the
	second commit..
	[b8a9a0fd65c5]

	* src/lib/ostream-file.c, src/lib/ostream.c:
	If connection is closed while buffer is being flushed in uncorking,
	don't assert-crash.
	[2ccd3ad66e29]

	* src/lib/file-cache.c:
	And another off-by-one buffer overflow fix.
	[b2bd93ec9c10]

	* src/lib/file-cache.c:
	Off-by-one buffer overflow fix. The code gets executed only with
	mmap_disable=yes when it's reading cache file.
	[b702fdebf627]

	* src/auth/passdb-checkpassword.c:
	Handle vpopmail's nonstandard exit codes.
	[f36357d3969d]

	* src/auth/auth-request.c:
	When invalid character is found from username, say what character it
	is in the log message. Also with auth_debug=yes log the whole
	username (sanitized).
	[679c9326741c]

2006-11-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-keywords.c:
	If we can't open dovecot-keywords file, don't crash.
	[cf97623a0aeb]

	* src/imap/cmd-idle.c:
	When mailbox changes are noticed and they're sent to client, cork
	before doing it so each command isn't sent in a separate packet.
	(this was done in branch_1_0 already, but forgot to commit to HEAD)
	[9ea62a9720ec]

	* src/imap/client.c:
	Added asserts
	[7e50162a378c]

	* src/imap/cmd-idle.c:
	If syncing finished with an error and client had disconnected, we
	assert-crashed in io_add().
	[a642d3df700f]

	* src/lib/compat.c:
	my_strncasecmp() was broken.
	[830cb3af6623]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c:
	Reference counting fixes. Fixes an assert crash when closing the
	index.
	[7cc1b8fec8ab]

	* src/login-common/ssl-proxy-openssl.c:
	Call ssl_step() at startup instead of ssl_handshake(). If the first
	input packet was sent along with the handshake, we hanged.
	[966f7b3fb03c]

	* configure.in:
	Enable -Wstrict-aliasing=2 with gcc 4.
	[53ff1a59cdd5]

	* src/auth/auth-request.c:
	Added __attr_format__
	[66287003e3cc]

	* src/lib/lib-signals.c:
	Assert fix
	[d52b14f80242]

	* src/auth/passdb-checkpassword.c, src/deliver/smtp-client.c, src/lib-
	imap/imap-parser.c, src/lib-imap/imap-parser.h, src/lib-mail
	/istream-header-filter.c, src/lib-storage/list/mailbox-list-
	maildir.c, src/lib/istream-tee.c, src/lib/mempool-system.c,
	src/master/mail-process.h, src/util/dovecotpw.c:
	Added some noreturn attributes and fixed warnings caused by them.
	[414c0c45040e]

	* src/lib-storage/mail-storage-private.h:
	const fix
	[4b54fc2cb12a]

	* src/lib/macros.h:
	Define __attrs_used__ if the compiler actually supports attributes.
	[d972f9e2902e]

	* src/lib/failures.c:
	Added some __attr_format__ attributes to functions.
	[b5c0d95bf892]

	* src/pop3-login/client.c:
	More const fixes
	[b0f6726975ca]

	* src/lib-imap/imap-envelope.c:
	const fixes
	[24f60fa451f2]

	* src/util/dovecotpw.c:
	Don't redeclare optarg and optind. They should be in unistd.h in all
	new enough systems.
	[38753229afaf]

	* src/auth/db-ldap.c, src/auth/mech-plain.c, src/imap/namespace.h, src
	/lib-imap/imap-bodystructure.c, src/lib-imap/imap-quote.c, src/lib-
	imap/imap-quote.h, src/lib-settings/settings.c, src/plugins/quota
	/quota-private.h, src/pop3/client.c:
	Cleanup: Don't put string literals into non-const pointers.
	[8ac2a2d27364]

	* src/plugins/acl/acl-mailbox-list.c:
	Fixed to actually work.
	[fc29abb75b01]

	* src/lib-storage/mail-storage.c, src/lib-storage/mailbox-list.c:
	Fixes
	[2fb76f235a43]

	* src/lib-storage/index/mbox/mbox-storage.c:
	mbox uses "fs" mailbox listing, not "maildir++" (forgot to remove
	after testing).
	[a3d4ba8838de]

2006-11-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/list/Makefile.am:
	Forgot to add
	[2b138c94a57f]

	* src/imap/namespace.c:
	Set HAS_INBOX flag.
	[712050440ca7]

	* src/lib-storage/subscription-file/.cvsignore:
	Not needed anymore
	[d513d2ec434f]

	* src/plugins/acl/acl-mailbox-list.c:
	Forgot to add.
	[af1c6c3f674a]

	* configure.in, src/deliver/Makefile.am, src/imap/Makefile.am,
	src/imap/cmd-list.c, src/imap/cmd-subscribe.c, src/imap/commands-
	util.c, src/imap/main.c, src/lib-storage/Makefile.am, src/lib-
	storage/index/dbox/Makefile.am, src/lib-storage/index/dbox/dbox-
	list.c, src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-storage.h, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/Makefile.am, src/lib-storage/index/maildir
	/maildir-list.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/mbox/Makefile.am, src/lib-storage/index/mbox/mbox-
	list.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/list/.cvsignore,
	src/lib-storage/list/mailbox-list-fs-iter.c, src/lib-storage/list
	/mailbox-list-fs.c, src/lib-storage/list/mailbox-list-fs.h, src/lib-
	storage/list/mailbox-list-maildir-iter.c, src/lib-storage/list
	/mailbox-list-maildir.c, src/lib-storage/list/mailbox-list-
	maildir.h, src/lib-storage/list/subscription-file.c, src/lib-
	storage/list/subscription-file.h, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/lib-storage/mailbox-list-private.h, src/lib-storage
	/mailbox-list.c, src/lib-storage/mailbox-list.h, src/lib-storage
	/mailbox-tree.h, src/lib-storage/register/.cvsignore, src/lib-
	storage/register/Makefile.am, src/lib-storage/subscription-
	file/Makefile.am, src/lib-storage/subscription-file/subscription-
	file.c, src/lib-storage/subscription-file/subscription-file.h,
	src/plugins/acl/Makefile.am, src/plugins/acl/acl-plugin.c,
	src/plugins/acl/acl-plugin.h, src/plugins/acl/acl-storage.c,
	src/plugins/convert/Makefile.am, src/plugins/convert/convert-
	storage.c, src/plugins/expire/Makefile.am, src/plugins/quota/quota-
	maildir.c, src/pop3/Makefile.am:
	Initial code for separation of mailbox accessing and directory
	layout handling. It's not yet possible to change the default layouts
	though.
	[93bc9770f938]

2006-11-15  Timo Sirainen  <tss@iki.fi>

	* src/lib/array.h:
	Removed extra ';'
	[ef3e7ba494bc]

2006-11-13  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c:
	Solaris LDAP compiling fix.
	[63ed4f00f6e1]

2006-11-12  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	If user has a home directory, but we can't chdir() there, log an
	error (but don't fail).
	[3c92ff93e241]

	* src/deliver/mail-send.c:
	Handle fwrite() failure early.
	[223566aa2969]

	* src/lib-storage/index/mbox/mbox-sync.c:
	If ftruncate() fails in error handling (it really shouldn't), log an
	error about it anyway.
	[f28a55aae24a]

	* dovecot-example.conf:
	Added otp and skey to supported mechanisms list.
	[723cd21a56f8]

	* src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/plugins/acl/acl-
	backend-vfile.c, src/plugins/quota/quota-maildir.c:
	Fixed some warnings with older gccs.
	[53b73f19a652]

	* doc/auth-protocol.txt, src/auth/auth-master-connection.c:
	Removed "DIE" command from auth protocol. It wasn't implemented, and
	I'm not sure if it's such a good idea anyway.
	[f24a1e1c8310]

	* src/master/master-settings.c:
	Minor fix
	[84058cf85f90]

	* configure.in, src/Makefile.am, src/auth/Makefile.am, src/auth/mech-
	otp.c, src/auth/mech-skey.c, src/auth/mech.c, src/auth/otp-skey-
	common.c, src/auth/otp-skey-common.h, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/password-scheme-otp.c, src/auth
	/password-scheme.c, src/auth/password-scheme.h, src/lib-
	otp/.cvsignore, src/lib-otp/Makefile.am, src/lib-otp/otp-
	dictionary.c, src/lib-otp/otp-dictionary.h, src/lib-otp/otp-hash.c,
	src/lib-otp/otp-hash.h, src/lib-otp/otp-parity.c, src/lib-otp/otp-
	parity.h, src/lib-otp/otp-parse.c, src/lib-otp/otp-parse.h, src/lib-
	otp/otp.h, src/util/Makefile.am:
	Added OTP and S/KEY authentication mechanisms. Patch by Andrey
	Panin.
	[c04189d77a59]

	* src/util/.cvsignore:
	Added gdbhelper
	[5f42c304d99f]

	* src/plugins/imap-quota/imap-quota-plugin.c, src/plugins/quota/quota-
	plugin.c, src/plugins/quota/quota-plugin.h, src/plugins/quota/quota-
	storage.c, src/plugins/trash/trash-plugin.c:
	s/quota/quota_set/ so we don't conflict with the quota symbol
	already present in Mac OS X.
	[49c9e7588de4]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index.c:
	Removed code which is never called.
	[23f63cd499ee]

	* src/lib-index/mail-index-sync.c:
	Don't crash if syncing breaks.
	[985420783b85]

	* src/deliver/Makefile.am:
	Removed str-sanitize.o from unused_objects list because we do use it
	nowadays.
	[752c309641db]

	* src/auth/passdb-ldap.c:
	Don't try to use ldap_bind() with empty passwords, since Windows
	2003 AD skips password checking with them and just returns success.
	[29e996bf4b1a]

	* src/auth/passdb-ldap.c:
	Cleanups, extra assert
	[7be447e805da]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/login-common/master.c, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c:
	Fixed potential problems with client disconnecting while master was
	handling the login.
	[c6d77f917d12]

	* src/auth/passdb-ldap.c:
	auth_bind=yes crashfix
	[cc4a6f2ddf32]

	* doc/variables.txt, src/lib/var-expand.c:
	Fixed zero padding handling and documented it. %0.1n shouldn't
	enable it, and it really shouldn't stay for the next %variable.
	-sign also shouldn't stay for the next variable.
	[385b77e37f1f]

	* src/imap/client.c:
	Don't crash if client disconnected while IDLEing.
	[62f534a0fd68]

	* src/imap/cmd-idle.c:
	If mailbox is changed while syncing is being done, and the second
	sync's changes aren't fully sent to the client, we hanged (quite
	rare I think).
	[65bbeb211a30]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c:
	Code cleanup
	[a18fa2b4bf06]

	* src/lib-index/mail-transaction-log-view.c:
	Memory/fd leak fix
	[86b8b9e45c30]

2006-11-08  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	Don't bother logging "syscall failed: EOF" messages. No-one cares
	about them.
	[db7983ff23b8]

	* src/auth/auth-request.c, src/auth/auth-request.h, src/auth/auth-
	worker-client.c, src/auth/auth.c, src/auth/db-sql.c, src/auth/db-
	sql.h, src/auth/mech-anonymous.c, src/auth/mech-apop.c, src/auth
	/mech-cram-md5.c, src/auth/mech-digest-md5.c, src/auth/mech-
	gssapi.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth
	/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.h, src/auth
	/passdb-blocking.c, src/auth/passdb-blocking.h, src/auth/passdb-
	bsdauth.c, src/auth/passdb-checkpassword.c, src/auth/passdb-ldap.c,
	src/auth/passdb-pam.c, src/auth/passdb-passwd-file.c, src/auth
	/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth/passdb-sia.c,
	src/auth/passdb-sql.c, src/auth/passdb-vpopmail.c,
	src/auth/passdb.h:
	Added auth_request_set_credentials() to modify credentials in passdb
	and implemented it for SQL passdb. Added passdb_need_set_credentials
	boolean to mechanisms to indicate that it's required (OTP will need
	it). Patch by Andrey Panin.
	[2c1cc5bbc260]

	* src/lib/mempool.h:
	Updated pool_alloconly_create_clean() comment
	[e55f5f2dbb2c]

	* src/lib/mempool-alloconly.c, src/lib/mempool.h:
	Added pool_alloconly_create_clean() to create an alloconly pool
	which clears the memory it uses before freeing it.
	[11001523027f]

	* src/auth/auth-cache.c, src/auth/auth-cache.h:
	Add auth_cache_remove() function which will be used by OTP code to
	evict old entries from auth cache. Patch by Andrey Panin.
	[fc291a997b03]

	* src/lib/sha1.h:
	Make it possible to take address of sha1_result() function.
	[055deed128b7]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log.c:
	Don't leak opened .log.2 transaction logs.
	[1dc7ffa3c669]

	* dovecot-example.conf:
	Comment updates, wiki link updates.
	[7abf3fbcda90]

2006-11-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	When verifying the header, check that next_uid is larger than last
	message's UID.
	[22b11dd2da09]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c:
	Saving mails could have skipped over transactions, which caused
	different kinds of problems.
	[615b7738a62f]

	* src/imap/client.c:
	Crashfix at quit
	[5cd0924c8031]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c:
	Handle LDAP requests while being disconnected more correctly.
	[d36a5df3f492]

	* src/imap-login/client.c, src/imap-login/imap-proxy.c,
	src/pop3-login/client.c, src/pop3-login/pop3-proxy.c:
	Memory leak fix
	[7576055e5377]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/imap-proxy.c, src/login-common/client-common.h, src
	/login-common/sasl-server.c, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/pop3-proxy.c:
	Crashfixes and more asserts. Mostly related to use of
	AUTHENTICATE/AUTH commands.
	[88c29111fcee]

	* src/lib-auth/auth-server-connection.c:
	Reduce memory usage in case we read a lot of auth replies at once.
	[e67acfeb2fd5]

	* src/imap-login/imap-proxy.c:
	If client disconnects before logging into remote server is complete,
	don't crash/leak memory.
	[4e99f8e7e9bd]

	* src/auth/auth-request-handler.c:
	Missing TAB before "pass" broke proxying.
	[f7fa27e435ef]

	* src/lib/istream-file.c, src/lib/istream-mmap.c, src/lib/ostream-
	file.c:
	When i/ostream is closed, change the fd to be -1 so it won't be
	accidentally used.
	[b96086a311a9]

	* src/lib/ioloop-epoll.c:
	Free all the used memory when destroying the ioloop.
	[7673830076ef]

	* src/auth/db-ldap.h:
	Remove sasl_props from here too.
	[2ab821630a45]

2006-11-05  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	If we're executing as a normal system user, get the HOME environment
	from passwd if it's not set. This makes it possible to run deliver
	from .forward.
	[8bbed82738ec]

	* src/lib-storage/index/index-fetch.h:
	This file hasn't been used for a long time.
	[9bc48d105ac5]

	* src/master/master-settings.c:
	If both mail_location and default_mail_env are set in the config
	file, give an error.
	[ca5e7977512d]

	* doc/dovecot-ldap.conf:
	Comment updates
	[557368033389]

	* doc/dovecot-ldap.conf, doc/dovecot-sql.conf:
	Added comments that the files should be owned by root and 0600. Some
	cleanups to dovecot-ldap.conf.
	[79bcc076e3fb]

	* src/auth/auth-request-handler.c:
	Don't send "pass" back if it's already set, or if it's not known.
	[2fc38c1e48c4]

	* dovecot-example.conf:
	Added missing imap_capability setting.
	[8df9c973dcc3]

	* src/auth/auth-request.c:
	If proxy is returned, set also no_login automatically, since it's
	always wanted in such case anyway.
	[28b76a225e54]

	* src/lib/printf-upper-bound.c:
	Removed some unneeded state keeping.
	[1cf3a7567434]

	* src/master/master-settings.c:
	default_mail_env fallbacking was broken with --exec-mail.
	[188481077cde]

	* src/lib/mountpoint.c:
	Compile fix
	[22e40b2c1c60]

2006-11-04  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-ldap.c:
	Fixes to auth_bind.
	[e2493679cd0a]

	* src/auth/db-ldap.c:
	Fixes
	[aadf124d273f]

	* src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Do better logging.
	[c02b31f07299]

	* src/auth/db-ldap.c:
	Don't call ldap_parse_sasl_bind_result() in ldap_bind()'s callback.
	We're not doing SASL authentication.
	[2b899c97de29]

	* src/plugins/trash/trash-plugin.c:
	Trash plugin was completely broken before.
	[5fb199ed254a]

	* src/lib/module-dir.c:
	Call deinit() for all modules first before unloading them.
	[e46eb913bcee]

	* src/lib-index/mail-hash.c:
	Compiler warning fix
	[5b92d300941f]

	* src/lib/network.c, src/lib/network.h, src/master/main.c:
	Changed ips_count to unsigned int in net_gethostbyname(). Also
	removed duplicated API comments from network.c.
	[7ee0bb1b2d97]

	* src/lib/lib.h:
	Include stddef.h always to make NULL expand correctly in Solaris.
	[757f5dce4f21]

	* src/auth/db-ldap.c:
	Cleanup
	[8f4eb963446c]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c:
	Crashfixes
	[62a5d2c10ecd]

	* doc/dovecot-ldap.conf, src/auth/db-ldap.c, src/auth/db-ldap.h,
	src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	LDAP code changes: If auth binds are used, bind back to the default
	dn before doing a search. Otherwise it could fail if user gave an
	invalid password. Initial binding is now also done asynchronously.
	Reconnecting to LDAP server wasn't working with auth binds. Use
	pass_attrs even with auth_bind=yes since it may contain other non-
	password fields also. Updated dovecot-ldap.conf to contain sasl_bind
	settings and reflect these changes.
	[deccf9e1aebc]

	* src/master/login-process.c:
	inetd logins kept crashing dovecot master.
	[0a1fa29ac87f]

	* src/auth/auth-request-handler.c:
	If passdb returned only userdb_ prefixed extra fields, don't add an
	extra TAB to the auth client's OK reply.
	[1d042234c9f9]

	* src/auth/userdb.c:
	Error message string update.
	[0bc1ca74c2f5]

2006-11-03  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-kqueue.c, src/lib/ioloop-notify-kqueue.c:
	Removed compiler warnings with NetBSD.
	[fd0d7e9e0e72]

	* configure.in, src/lib/mountpoint.c:
	Added support for statvfs(), which is what the newer BSDs use.
	[6789961fe02e]

	* src/lib-ntlm/ntlm-message.c:
	Use i_toupper()
	[186dcdb5ec68]

	* src/master/login-process.c:
	Error message fix for 64bit systems.
	[f032a5d2bc0d]

	* src/lib-storage/index/index-storage.c:
	Fix
	[88430a415d7d]

2006-11-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-checkpassword.c:
	Give TCPLOCALIP and TCPREMOTEIP and PROTO=TCP environments to
	checkpassword binary so we're UCSPI (and vchkpw) compatible.
	[3dff9907f00b]

	* src/auth/passdb-ldap.c, src/auth/passdb-sql.c:
	Non-plaintext authentication didn't work with sql as passdb. Cleaned
	up the same code for LDAP also.
	[bd702f6cac23]

	* src/deliver/mail-send.c:
	When sending rejects, don't include Content-Type in the rejected
	mail's headers.
	[4bafe1657571]

	* src/imap/cmd-list.c:
	If we had only prefixed namespaces and we listed for "%", INBOX's
	flags weren't correct and it wasn't shown at all with LSUB.
	[5ac887e3a53d]

	* src/deliver/deliver.c:
	Make mail_debug=yes work with deliver too.
	[80afcbfce92a]

	* src/deliver/deliver.c:
	Added -f parameter to usage help.
	[4710a0429914]

	* src/lib-mail/message-address.h:
	Comment update
	[4490f823a160]

	* src/deliver/deliver.c:
	Don't crash with -f "". Changed the default from envelope to be
	MAILER-DAEMON.
	[af8caaba0f67]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	Compiling fix
	[1c685d8bb60b]

	* src/deliver/auth-client.c:
	If we can't get auth user reply in a minute log timeout error and
	quit.
	[921d365e6bca]

	* src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache.h:
	If cache file contains broken field type or decision type mark the
	cache corrupted instead of assert-crashing later.
	[b0cf3e4d6c96]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Last changes broke it badly.
	[688c9c14b20d]

2006-11-01  Timo Sirainen  <tss@iki.fi>

	* src/lib/data-stack.h, src/lib/imem.h, src/lib/macros.h,
	src/lib/mempool.h, src/lib/strfuncs.h:
	Use malloc attribute for the most commonly used memory and string
	allocation functions. Use warn_unused_result attribute for reallocs.
	[b0daeec3d416]

	* src/lib/failures.c, src/lib/failures.h, src/lib/imem.h,
	src/lib/macros.h, src/lib/str.h, src/lib/strfuncs.h:
	Added sentinel GCC attribute to *_strconcat() functions. Added
	format printf-attribute to vprintf-type functions.
	[1995cb3763db]

	* src/lib-storage/index/mbox/mbox-sync.c:
	compiling fix
	[b0d21acf9689]

2006-10-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	Crashfix
	[392c7d4605be]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c:
	Last keyword pool clearing optimization broke the keywords if we had
	to move mails around in the file.
	[79edf40cc2f9]

2006-10-25  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins/fts-lucene
	/lucene-wrapper.cc, src/plugins/fts-lucene/lucene-wrapper.h:
	Add support for expunges.
	[fd469f910aa7]

	* src/plugins/fts/fts-api-private.h, src/plugins/fts/fts-api.c,
	src/plugins/fts/fts-api.h, src/plugins/fts/fts-storage.c:
	ADd support for expunges
	[1acce53d423e]

	* src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins/fts-lucene
	/lucene-wrapper.cc, src/plugins/fts-lucene/lucene-wrapper.h:
	Fixes and cleanups
	[4adb9ce21304]

	* src/plugins/fts/fts-api-private.h, src/plugins/fts/fts-api.c,
	src/plugins/fts/fts-api.h, src/plugins/fts/fts-storage.c:
	Added fts_backend_get_last_uid() which is first used to check if
	build_init() needs to be called.
	[70ca205ce6f1]

	* src/plugins/fts-lucene/lucene-wrapper.cc:
	Some fixes.
	[12584631dc42]

	* src/plugins/fts-lucene/fts-backend-lucene.c, src/plugins/fts-lucene
	/fts-lucene-plugin.c, src/plugins/fts-lucene/fts-lucene-plugin.h,
	src/plugins/fts-lucene/lucene-wrapper.cc, src/plugins/fts-lucene
	/lucene-wrapper.h:
	Create only a single index into INBOX's index dir. Did several
	fixes. However still a bit buggy.
	[d0e37ed08bdb]

	* src/plugins/fts/fts-api-private.h, src/plugins/fts/fts-api.c,
	src/plugins/fts/fts-api.h, src/plugins/fts/fts-storage.c:
	Let FTS backend init function take a struct mailbox instead of path.
	[d2693511dd33]

	* src/lib-mail/message-decoder.c:
	Don't crash with unknown charsets
	[e3534695b58a]

	* src/plugins/fts-lucene/lucene-wrapper.cc:
	Our field length was set to way too small value. For query keys use
	key* by default, or "key key2" if it contains spaces. If the query
	parser anyway gives an error, don't bother logging it unless DEBUG
	is enabled.
	[556ecac10eec]

	* src/lib-mail/message-header-parser.c:
	Remember hdr->middle for the header's whole lifetime.
	[65d8b4e537c6]

2006-10-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-lock.c:
	flock isn't anymore the default locking method, so don't bother
	giving a special error message if it fails.
	[ff75a802b191]

2006-10-17  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-worker-client.c, src/auth/passdb-blocking.c:
	Fixes to handling blocking passdb (ie. MySQL) failures. It ignored
	any non-password related checks, such as allow_nets.
	[3bfd724bb37a]

	* doc/variables.txt:
	default_mail_env -> mail_location.
	[7c7faac6d801]

	* dovecot-example.conf, src/lib-storage/index/mbox/mbox-storage.c:
	Use the name "mail root directory" to describe where the non-INBOX
	mbox mailboxes are and describe what it is in the config file.
	[11f080e5eff4]

	* dovecot-example.conf, src/deliver/deliver.c, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Renamed default_mail_env to mail_location. Keep the default_mail_env
	working anyway for backwards compatibility.
	[190a66df2f82]

2006-10-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-settings/settings.c:
	Handle the last line even if it doesn't end with LF.
	[779bd2a6dcc1]

	* src/lib/network.c:
	Fix net_ipv6_mapped_ipv4_convert() to be actually portable.
	[9e4cc68b71b2]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync-
	rewrite.c, src/lib-storage/index/mbox/mbox-sync.c:
	Fixes to handling CRLF linefeeds in mboxes.
	[8ae46b72a460]

	* dovecot-example.conf:
	Added a warning about nss_ldap.
	[ad68cb8119e1]

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c:
	Don't allow SSLv2 by default.
	[abf9a1234b99]

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c:
	Updates to ssl_ca_file and ssl_username_from_cert comments in
	dovecot-example.conf. Added better logging for "Invalid
	certificate". Patch by HenkJan Wolthuis (hj wolthuis kaw nl)
	[07afd19bc53e]

	* src/auth/passdb-bsdauth.c:
	Don't check password field ourself. There's no point doing that and
	some backends won't even return the password.
	[aade653ff6c3]

	* doc/variables.txt, src/lib/var-expand.c:
	Added %D modified to return "sub.domain.org" as
	"sub,dc=domain,dc=org" (for LDAP queries). Patch by Andrey Panin.
	[c28892e80d6c]

2006-10-15  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-blocking.c:
	If blocking passdb (ie. MySQL) didn't return any extra fields, we
	didn't notice username changes and we didn't cache the password.
	[7728291a7f52]

	* src/auth/passdb-vpopmail.c:
	Added support for non-plaintext authentication for vpopmail if it
	returns plaintext passwords. Based on patch by Remi Gacogne
	(rgacogne aquaray com).
	[a6abe149c2a4]

	* src/auth/passdb-passwd-file.c:
	If auth cache is enabled and %vars are used in passwd-file path, get
	the non-username part of the cache key from the path.
	[2eefb4eb14a4]

	* src/auth/auth-request.c:
	Don't even try to verify password with deny=yes passdbs.
	[80023f898ddd]

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index.h,
	src/lib-storage/index/index-sync.c:
	Try to avoid sending duplicate/useless flag updates.
	[764bd841e0ae]

	* src/lib/seq-range-array.c, src/lib/seq-range-array.h:
	seq_range_exists() can take a const pointer to the array.
	[c8b565e87966]

	* src/auth/auth-cache.c, src/auth/auth-request.c:
	auth cache didn't work properly with multiple passdbs.
	[ba802ac3b743]

	* src/auth/auth-request.c:
	When matching allowed_nets IPs, convert IPv6-mapped-IPv4 addresses
	to actual IPv4 addresses first.
	[dc5875c28aac]

	* src/lib/network.c, src/lib/network.h:
	Added net_ipv6_mapped_ipv4_convert().
	[4f1df4b90500]

	* src/deliver/auth-client.c:
	Use mail_chroot setting.
	[b60a8aec99ed]

	* doc/auth-protocol.txt, src/auth/auth-request-handler.c:
	Require that the "resp" parameter for AUTH command is the last.
	[bc071307fc2a]

	* src/lib-storage/index/mbox/mbox-save.c:
	Filter out "From " lines from headers. There's no reason they should
	exist in there and they'll cause problems.
	[cc110cb8c56b]

	* src/lib-index/mail-cache-transaction.c:
	Fix to delayed cache file opening, cached data might have been lost.
	[cd2db88396e1]

	* src/auth/mech-digest-md5.c:
	If unknown QoP value is received, log what it is.
	[a03b3c16d724]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction-private.h, src/lib-index/mail-index-transaction.c, src
	/lib-index/mail-index-view-private.h, src/lib-storage/index/dbox
	/dbox-transaction.c, src/lib-storage/index/maildir/maildir-
	transaction.c, src/lib-storage/index/mbox/mbox-transaction.c:
	After saving messages the mailbox wasn't synced, which caused
	deliver to treat the mailbox as unsynced and not update the indexes.
	[6272561fa12d]

	* src/lib-storage/index/maildir/maildir-mail.c:
	Compile fix
	[5587c9345e39]

	* src/lib-index/Makefile.am:
	And removed the rest of the mailbox-list-index* too..
	[e6feeacdd4b6]

	* src/lib-index/Makefile.am:
	mailbox-list-index wasn't supposed to be committed yet.
	[d7e0a56d4cc5]

	* src/lib-mail/message-content-parser.c:
	We didn't skip whitespace after '=' in parameters, which caused the
	parameter's value to be empty.
	[cc743c18b128]

	* src/lib-mail/message-parser.c:
	message_parser_parse_next_block() returned body part wrong for first
	header in MIME blocks, which caused problems.
	[f5bef033a9ac]

	* src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/mbox
	/mbox-mail.c:
	We added received date as time_t instead of uint32_t which crashed
	with 64bit systems.
	[b7ff8c64c436]

2006-10-14  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/pop3-login/client.c:
	Reference counting fix
	[830cee5ef3c0]

	* src/master/login-process.c, src/master/login-process.h,
	src/master/main.c:
	Reference counter fixes
	[5372b92be174]

	* src/imap-login/client.c, src/imap-login/imap-proxy.c, src/login-
	common/login-proxy.c, src/pop3-login/client.c,
	src/pop3-login/pop3-proxy.c:
	Reference counter fixing for client while it's being used in login
	proxy. Fixes crashes.
	[d84a7bd63862]

	* src/master/login-process.c:
	Cleanup
	[654aa0e9075b]

	* src/lib/sha1.h:
	Let's be nice and work with older libmysqlclient libraries.
	[4cd8792b5fcb]

	* src/lib/ioloop-epoll.c:
	Don't pass uninitialized data in epoll data struct's union to
	kernel. Doesn't matter that much, but keeps valgrind happy.
	[fd10404f5965]

2006-10-13  Timo Sirainen  <tss@iki.fi>

	* src/master/login-process.c:
	Deinit crashfix.
	[e4d7d01b0784]

	* src/imap-login/client.c, src/login-common/ssl-proxy-openssl.c,
	src/pop3-login/client.c:
	New asserts / cleanup
	[881ed99266a2]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Clear the keywords pool for each mail, so we don't waste memory.
	Also we can shrink the initial pool size.
	[ebbc7cd727cd]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c:
	Handle moving to memory failures better so we won't crash in some
	situations.
	[d021f2b0ded2]

	* src/master/login-process.c:
	Make sure we don't kill login processes that haven't yet even sent
	their initialization event. Also added another sanity check.
	[885bef091d1a]

	* src/master/log.c:
	Don't crash in log deinitialization.
	[60ae03cf7412]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Adding space to header could have broken things. This fixes at least
	"X-IMAPbase uid-last unexpectedly lost in mbox file" errors.
	[66d3f064ba40]

	* dovecot-example.conf, src/auth/auth-cache.c, src/auth/auth-cache.h,
	src/auth/auth-request.c, src/auth/passdb-cache.c:
	auth_cache: Try to handle changing passwords automatically: If
	password verification fails, but the last one had succeeded, don't
	use the cache. This works only with plaintext auth.
	[3b49b9ec87dc]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h:
	Don't use time_t anymore in cache file. uint32_t is large enough and
	makes cache files compatible between 32bit and 64bit systems.
	[a2a9b6a92831]

	* src/lib-index/mail-index.h, src/lib-storage/index/index-storage.c:
	Removed MAIL_INDEX_OPEN_FLAG_FAST. It wasn't being used, and we
	probably want to have that as a default anyway.
	[c27fdb8c61d6]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c:
	Delay opening the cache file until it's actually needed.
	[df8de2e47fb5]

	* src/lib-index/Makefile.am, src/lib-index/mail-cache-fields.c:
	When registering fields, if they were already exited in the cache
	file mark the cache file corrupted.
	[35d9433de1ca]

	* src/lib-index/mail-cache.c:
	If time_t or uoff_t size had changed, we returned -1 instead of
	FALSE, which broke the check later..
	[f189a1724f55]

	* src/deliver/auth-client.c, src/deliver/deliver.c:
	Don't require home directory to be given. If debug is enabled, log
	what we get from dovecot-auth.
	[3da6580bb0ed]

2006-10-12  Timo Sirainen  <tss@iki.fi>

	* src/master/login-process.c:
	If login process dies before initialization, stall creation of them
	instead of completely shutting down.
	[2fe8f6a0bc5b]

2006-10-11  Timo Sirainen  <tss@iki.fi>

	* src/master/log.c:
	When shutting down do one last read from log fds to see if there's
	something waiting. Also set log fd to be non-blocking.
	[4ff5080c5325]

	* src/login-common/master.c, src/master/login-process.c, src/master
	/master-login-interface.h:
	Send inode number in login requests and verify that they match.
	[a3d6a3462745]

	* src/lib/mountpoint.c, src/lib/mountpoint.h:
	Handle ENOENT silently and return 0.
	[93a6d2194c5d]

2006-10-09  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	Increase default address sanitizer pool size
	[5f467dc79a19]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h:
	If the mail environment data contains mail format prefix, don't do
	any kind of autodetection. Practically this means that
	mbox:/var/mail/user doesn't work anymore.
	[6c607dbab732]

	* configure.in:
	Detect C++ compiler because fts-lucene has C++ code.
	[613983147a3c]

	* src/auth/password-scheme-md5crypt.c, src/auth/password-scheme-rpa.c,
	src/auth/password-scheme.c:
	Based on password length detect if it's hex-encoded or sha1-encoded.
	Also use MD[45]_RESULTLEN macros instead of hardcoded 16 value.
	[47add4b664af]

	* src/lib/md4.c, src/lib/md4.h:
	Added MD4_RESULTLEN macro.
	[c0464c4a2ee3]

	* src/lib/md5.c, src/lib/md5.h:
	Added MD5_RESULTLEN macro.
	[0448f2fa8349]

	* src/master/log.c:
	Fix
	[67c067409634]

	* src/master/login-process.c:
	If login process sends wrong state information, restart it.
	[f5772851ac91]

	* src/imap/cmd-list.c:
	Handle INBOX-prefixed namespaces better. Avoid duplicate INBOX
	replies if namespace prefix is given.
	[47531abcf691]

	* configure.in, src/auth/Makefile.am, src/auth/passdb-sia.c,
	src/auth/passdb.c:
	Tru64 SIA authentication support. Patch by Simon L Jackson (simon
	jackson carringbush net)
	[689a02ca02d3]

2006-10-08  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c, src/deliver/mail-send.c:
	Log all mail saves and save failures.
	[0af548f101f8]

	* src/deliver/deliver.c:
	Added -f parameter to specify the envelope sender which is used in
	mbox From-lines.
	[630e6121fb8d]

	* src/lib-imap/imap-envelope.c, src/lib-mail/message-address.c, src
	/lib-mail/message-address.h, src/lib-storage/index/index-search.c,
	src/lib-storage/index/index-sort.c:
	Added fill_missing parameter to message_address_parse() which
	specifies if missing mailbox and domain should be returned as
	MISSING_MAILBOX and MISSING_DOMAIN or just as empty strings.
	[210bb1ff0e6e]

	* src/master/mail-process.c:
	Expand home directory in mail env if it exists as eg.
	"mbox:~:INBOX=.." or as the last character
	[5e94f1332189]

	* src/lib/imem.c, src/lib/imem.h, src/lib/lib.c, src/lib/mempool.h:
	Added p_free_and_null() and did some cleanups.
	[9de853d23279]

2006-09-25  Timo Sirainen  <tss@iki.fi>

	* src/master/login-process.c:
	And remove debugging code..
	[35ecfba4ab39]

	* src/master/login-process.c, src/master/login-process.h:
	SIGHUP caused memory corruption
	[f5d53a684856]

	* src/master/login-process.c:
	If fd_read() returns EAGAIN, ignore it.
	[9dc62b7594de]

2006-09-23  Timo Sirainen  <tss@iki.fi>

	* src/imap/commands.c, src/imap/commands.h:
	Use array_t in commands buffer.
	[0d24ee6b4ccd]

2006-09-22  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-gssapi.c:
	POP3 service name is "pop" with GSSAPI.
	[fc5ae043fdcc]

	* dovecot-example.conf:
	Comment about protocols=none.
	[60a081e2a1dc]

	* src/master/master-settings.c:
	Allow "protocols = none".
	[4a0c4d5d6735]

	* src/deliver/deliver.c:
	%i didn't work.
	[97c9db4980fc]

	* src/auth/db-ldap.c:
	"Can't connect to server" message's host was wrong if uris setting
	was used.
	[5beb1fe35e52]

2006-09-20  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-sql.conf:
	More explanation of the "user" field in pass_query.
	[b09e8ca4b142]

2006-09-18  Timo Sirainen  <tss@iki.fi>

	* src/plugins/fts/fts-storage.c:
	Fix
	[1febe4a45c36]

	* configure.in, src/plugins/Makefile.am, src/plugins/fts-
	lucene/.cvsignore, src/plugins/fts-lucene/Makefile.am, src/plugins
	/fts-lucene/fts-backend-lucene.c, src/plugins/fts-lucene/fts-lucene-
	plugin.c, src/plugins/fts-lucene/fts-lucene-plugin.h, src/plugins
	/fts-lucene/lucene-wrapper.cc, src/plugins/fts-lucene/lucene-
	wrapper.h:
	--with-lucene now enables lucene full text search indexing. Note
	that using it breaks IMAP RFC. It also seems to have problems
	finding texts that have special characters in them, such as email
	addresses.

	You can anyway enable it by loading fts and fts_lucene plugins and
	setting fts=lucene in plugin section.
	[446646de0c4a]

	* src/imap/Makefile.am:
	Added message-decoder.o here for now until it's used within the
	binary.
	[f66c874602a4]

	* src/plugins/fts/fts-storage.c:
	Fixes to indexing
	[3111cf26ecac]

	* src/plugins/fts/fts-api-private.h, src/plugins/fts/fts-api.c,
	src/plugins/fts/fts-api.h, src/plugins/fts/fts-storage.c:
	API updates and some fixes
	[a1621235f405]

	* src/lib-storage/mail-storage.c:
	mail_storage_get_mailbox_index_dir() wrapper function was missing
	[3c05b1f71ce6]

2006-09-17  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-thread.c, src/lib-index/mail-index-transaction.c, src
	/lib-index/mail-index-view.c, src/lib-index/mail-index.c:
	Memory leak fixes
	[b0966236fda7]

	* src/plugins/quota/quota-private.h:
	Removed quota_set_error() prototype as well
	[c9bdfaa2e2cf]

	* src/plugins/quota/quota-fs.c:
	Removed quota_set_error() calls.
	[bdfc03178263]

	* src/imap/imap-thread.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/mail-storage.h:
	mail_set_uid() now returns 0 = expunged, 1 = ok.
	[84ee1092021f]

	* src/lib-storage/index/maildir/maildir-sync.c:
	maildir_storage_sync_force() crashed if called from mail index
	sync/expunge callbacks.
	[2c033ffc8f6f]

	* src/imap/imap-thread.c:
	Crashfixes
	[287178dedc27]

	* src/plugins/fts/fts-api.c, src/plugins/fts/fts-storage.c:
	Fixed to use new array API.
	[6e9ace0e1940]

	* configure.in, src/plugins/Makefile.am, src/plugins/fts/.cvsignore,
	src/plugins/fts/Makefile.am, src/plugins/fts/fts-api-private.h,
	src/plugins/fts/fts-api.c, src/plugins/fts/fts-api.h,
	src/plugins/fts/fts-plugin.c, src/plugins/fts/fts-plugin.h,
	src/plugins/fts/fts-storage.c:
	Added full text search plugin framework. Still missing support for
	handling expunges. Also it could use better logic with more complex
	SEARCH queries to figure out when the FTS index should be used.
	[48a16f1254b5]

	* src/lib-mail/Makefile.am, src/lib-mail/message-decoder.c, src/lib-
	mail/message-decoder.h:
	Added message-decoder to decode message's contents into readable
	UTF-8.
	[61e0fe257a83]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-storage-
	private.h:
	Moved some search parameters to public struct mail_search_context
	and added module_contexts array.
	[71b3570946f8]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.h:
	Added mail_storage_get_mailbox_index_dir().
	[baaf62ced3d0]

2006-09-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-charset/charset-utf8.h:
	Added charset_is_utf8() and charset_to_ucase_utf8_full().
	[e6cb9f75b76a]

	* src/lib-index/mail-hash.c:
	Error string fix
	[2415f43b1dcf]

	* src/lib-mail/message-parser.h:
	Removed unused flag and added comment.
	[20e2bc758c24]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction.c, src/lib-storage/index/index-mail.c, src/lib/array.h,
	src/lib/module-dir.c, src/plugins/trash/trash-plugin.c:
	Don't allow giving NULL parameter to array_get() or
	array_get_modifiable().
	[444edc8abef9]

	* src/lib/array-decl.h, src/lib/array.h:
	Some more array changes. v and v_modifiable are now pointer-to-
	pointers so that they can actually be used to access the array's
	contents directly. Only array_idx() uses this currently though, and
	only if asserts are disabled.
	[664011f3b1fb]

2006-09-11  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-ldap.conf:
	hosts doesn't default to localhost anymore.
	[40e3583001ad]

2006-09-10  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Boehm GC seems to be working now. Removed the broken-warning.
	[ab77182ddf94]

	* src/lib/data-stack.c:
	GC optimization
	[65b56dd915cb]

	* src/lib/data-stack.c, src/lib/mempool-alloconly.c, src/lib/mempool-
	system.c:
	Fixes for using GC
	[fc07c947eed9]

	* src/auth/auth-master-listener.c, src/auth/userdb-static.c, src/dict
	/dict-server.c, src/imap/commands-util.c, src/imap/imap-fetch.c,
	src/imap/imap-thread.c, src/lib-dict/dict.c, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	index-sync-ext.c, src/lib-index/mail-index-sync.c, src/lib-index
	/mail-index-transaction.c, src/lib-index/mail-index-view-sync.c, src
	/lib-index/mail-index-view.c, src/lib-index/mail-index.c, src/lib-
	sql/driver-mysql.c, src/lib-sql/sql-api.c, src/lib-
	storage/index/dbox/dbox-keywords.c, src/lib-storage/index/dbox/dbox-
	save.c, src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-sync-full.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/index-mail-headers.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/index-sort.c, src/lib-
	storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/mbox
	/mbox-sync-parse.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c, src/lib-storage/mail-
	storage.c, src/lib/array.h, src/lib/ioloop-epoll.c, src/lib/ioloop-
	kqueue.c, src/lib/module-dir.c, src/lib/seq-range-array.c,
	src/master/mail-process.c, src/master/master-settings.c,
	src/plugins/acl/acl-backend-vfile.c, src/plugins/acl/acl-cache.c,
	src/plugins/expire/expire-env.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota.c, src/plugins/trash/trash-plugin.c:
	Replaced ARRAY_CREATE() macro with [ipt]_array_init() macros. The
	macro has no side effects so it might as well be lowercased.
	[bf4e98a0de3f]

	* src/lib-dict/dict-sql.c:
	Fixed atomic_inc() to work correctly with shared keys.
	[6964aa1c1898]

	* src/auth/auth-master-listener.c, src/auth/userdb-static.c, src/dict
	/dict-server.c, src/imap/commands-util.c, src/imap/imap-fetch.c,
	src/imap/imap-thread.c, src/lib-dict/dict.c, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	index-sync-ext.c, src/lib-index/mail-index-sync.c, src/lib-index
	/mail-index-transaction.c, src/lib-index/mail-index-view-sync.c, src
	/lib-index/mail-index-view.c, src/lib-index/mail-index.c, src/lib-
	sql/driver-mysql.c, src/lib-sql/sql-api.c, src/lib-
	storage/index/dbox/dbox-keywords.c, src/lib-storage/index/dbox/dbox-
	save.c, src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-sync-full.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/index-mail-headers.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/index-sort.c, src/lib-
	storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/mbox
	/mbox-sync-parse.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c, src/lib-storage/mail-
	storage.c, src/lib/array.h, src/lib/ioloop-epoll.c, src/lib/ioloop-
	kqueue.c, src/lib/module-dir.c, src/lib/seq-range-array.c,
	src/master/mail-process.c, src/master/master-settings.c,
	src/plugins/acl/acl-backend-vfile.c, src/plugins/acl/acl-cache.c,
	src/plugins/expire/expire-env.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota.c, src/plugins/trash/trash-plugin.c:
	Removed type parameter from ARRAY_CREATE since it's not needed
	anymore.
	[e92ae6d532f9]

2006-08-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/driver-mysql.c:
	Save queries within transaction in a linked list and send them
	separately, instead of using one big string with ';' separator,
	which didn't work with everyone..
	[ec2bc538dcad]

	* src/lib-dict/dict-sql.c:
	Fixes. select/where fields were used in wrong order
	[98991f3699c6]

2006-08-26  Timo Sirainen  <tss@iki.fi>

	* src/lib/hash.c:
	Initial hash table size was always 109 even though the initial_size
	parameter was higher.
	[bd1da3473e44]

	* src/lib/ioloop-notify-kqueue.c:
	Fix 100% CPU usage looping when a vnode change event came but it was
	never untriggered. Patch by Rui Lopes (rgl ruilopes com)
	[4061c612a402]

	* src/deliver/duplicate.c:
	When reading the duplicate entries, the timestamp wasn't saved so
	the entry was lost afterwards.
	[6e5fe029ca82]

2006-08-24  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Updated pop3's mail_executable comment
	[364c9179bb46]

2006-08-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	And actually fix it instead of leaving it commented out...
	[65bedef534ea]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Rename was a bit broken if the new name began with the old name
	[1b8b9516bc28]

	* src/lib-storage/index/index-mail-headers.c:
	Grow index_header_lookup_ctx pool initial size.
	[26bbf71e9b5e]

2006-08-22  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-checkpassword.c:
	If master db has extra fields set, send them to checkpassword in
	environment.
	[62e735bfb00d]

2006-08-18  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-notify-inotify.c:
	Compiler warning fix
	[30416fa0bdeb]

	* src/lib/ioloop.c:
	io_add_notify() didn't set refcount so io_remove() crashed for it.
	[8e1c05006f2d]

2006-08-17  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-checkpassword.c:
	Crashfix
	[c25c0ae8f1f0]

	* src/lib/ioloop-kqueue.c:
	Reference IOs before calling timeout handlers, in case they call
	io_remove().
	[4644b3038b9a]

	* src/lib/ioloop-internal.h, src/lib/ioloop-kqueue.c,
	src/lib/ioloop.c, src/lib/ioloop.h:
	OK, so the original kqueue code wasn't actually broken, but it could
	have been made much simpler. Updated comments in ioloop.h about
	IO_READ and IO_ERROR usage.
	[40b353def38c]

	* src/master/main.c:
	Cleanup + handle dup() failure.
	[3bb3d5ad254f]

	* src/lib/ioloop-kqueue.c:
	Fixes
	[afbe8e85e5d6]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-kqueue.c:
	Fixes
	[6dd7388db4a8]

2006-08-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	Non-plaintext auth: If auth_debug_passwords=yes, show looked up
	credentials.
	[ba4f580c5ec7]

	* src/lib/ioloop-kqueue.c, src/lib/ioloop-notify-kqueue.c:
	Compiling fixes
	[2092114ebdff]

	* src/lib/Makefile.am, src/lib/ioloop-epoll.c, src/lib/ioloop-
	internal.h, src/lib/ioloop-iolist.c, src/lib/ioloop-iolist.h,
	src/lib/ioloop-kqueue.c, src/lib/ioloop-notify-kqueue.c, src/lib
	/ioloop-poll.c:
	Rewrote much of the kqueue code. It didn't work correctly if there
	were both input and output I/O handlers added for the same file
	descriptor. The code works now very much like epoll code. Did also
	several cleanups.
	[8d977716f449]

	* configure.in:
	Use notify=kqueue automatically only if ioloop=kqueue.
	[046b985ed767]

	* configure.in:
	Changed --enable-debug's description.
	[79dd8a12fa05]

	* src/login-common/client-common.c, src/login-common/ssl-proxy-
	openssl.c, src/login-common/ssl-proxy.c, src/login-common/ssl-
	proxy.h:
	If SSL/TLS handshake didn't finish, show "TLS handshaking" instead
	of "TLS" in logout line.
	[cbbe2377f591]

2006-08-11  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-checkpassword.c, src/auth/passdb-pam.c:
	Set SIGCHLD handler in init, not in preinit when lib_signals_init()
	hasn't yet been called.
	[5955b411cfb4]

	* src/master/mail-process.c:
	Check log_creaate_pipe() and dup() return values and handle
	failures.
	[7661242c3bb6]

	* configure.in:
	eval doesn't need to have its parameters quoted. The previous \"
	quoting was broken with POSIX shells (and autoconf 2.60 now sets
	POSIX mode to non-bash/zsh shells also where this was previously
	working wrong). So, all in all this should fix OpenBSD compiling
	problems.
	[32f5df3de2d1]

	* src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c:
	Show number of actually expunged messages in logout message, instead
	of number of messages marked as deleted.
	[aa9109a17db6]

	* configure.in, src/plugins/quota/quota-fs.c:
	Check for XFS quota also from xfs/xqm.h
	[a54558861acc]

	* src/auth/passdb-checkpassword.c, src/auth/passdb-pam.c:
	Use SIGCHLD handler to check for killed child processes instead of a
	timeout loop.
	[6012b0978d2c]

	* src/deliver/deliver.c:
	Set umask from dovecot.conf, or default to 0077.
	[5d725c24d5a0]

	* src/lib-storage/index/mbox/mbox-save.c:
	After saving a mail with index being in synced state, update the
	sync_stamp and sync_size fields in the index so that it actually
	stays synced.
	[8b9933470cf8]

	* dovecot-example.conf:
	Updated login_max_connections comment.
	[c8177c854d65]

	* src/imap-login/client.c, src/imap-login/imap-proxy.c, src/login-
	common/client-common.h, src/login-common/common.h, src/login-
	common/main.c, src/pop3-login/client.c, src/pop3-login/pop3-proxy.c:
	Fixes for handling near-full connection queues.
	[507088c0d511]

2006-08-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	Create maildirfolder file when creating new maildirs.
	[4d2c4bb02c81]

	* doc/variables.txt, src/lib/var-expand.c:
	Negative offsets count from the end of the string. Patch by Johannes
	Berg.
	[fc58084df7b5]

	* src/auth/passdb-ldap.c:
	If password query returns userdb_ prefixed fields (ie. for userdb
	prefetch) but not userdb_uid or userdb_gid, add them based on the
	global uid/gid settings.
	[3da066d844ea]

	* src/master/master-settings.c:
	Allow empty protocols line when using --exec-mail.
	[b008e75f650a]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	We got into infinite loops if trying to open a 2 byte sized file as
	mbox.
	[9430af7b0744]

	* src/master/master-settings.c:
	Allow base_dir to point to a symlink.
	[d59ab08a6b6a]

	* src/auth/main.c, src/dict/main.c, src/imap/main.c, src/login-
	common/main.c, src/master/main.c, src/master/master-settings.c,
	src/master/master-settings.h, src/pop3/main.c:
	Require that master's version number matches the child's, unless
	version_ignore=yes. Usually it's an accidental installation problem
	if the version numbers don't match.
	[d1c0514754d5]

	* configure.in, src/plugins/quota/quota-fs.c, src/plugins/quota/quota-
	fs.h:
	Put back specific checks for struct dqblk.dqb_curblocks vs curspace.
	The removal broke compiling for some OSes such as OSX.
	[ef71b2fdd433]

	* configure.in:
	Updated --with-notify description.
	[2643a46322a6]

	* src/lib/ioloop-notify-dn.c:
	Silently disable dnotify if kernel doesn't support RT signals,
	instead of just dying.
	[592a720e8857]

2006-08-07  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	Don't crash if SSL is disabled.
	[11e9f405d18e]

	* src/deliver/deliver.c, src/lib-storage/index/index-storage.c, src
	/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib-storage/index/mbox/istream-raw-mbox.h,
	src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/mail-
	storage.h:
	Added MAILBOX_OPEN_MBOX_ONE_MSG_ONLY flag for mailbox_open() which
	makes it ignore all but the first From-line in a mbox. This kludge
	is required for deliver which builds a temporary mbox stream from
	the input. Later it should be fixed to use some plain-mailbox format
	instead of mbox.
	[2eb8af6f1285]

	* src/plugins/quota/quota-fs.c:
	Default _LINUX_QUOTA_VERSION to 1 instead of 2, since older Linux v1
	sys/quota.h didn't define it at all.
	[912e6d3053e8]

	* src/imap/cmd-list.c:
	When listing INBOX from inbox=yes namespace, don't insert the
	namespace prefix
	[ca9eaace800a]

	* src/imap/cmd-list.c:
	Fixes to handling INBOX in LIST.
	[5ab638aafc7b]

	* src/lib-storage/mail-storage.h:
	MAILBOX_LIST_INBOX flag conflicted with MAILBOX_LIST_CHILDREN flag,
	causing problems.
	[10f241586a28]

	* src/lib-storage/index/dbox/dbox-list.c, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/mbox
	/mbox-list.c:
	Handle reference parameter more like UW-IMAP: If it doesn't begin
	with separator, just use it as a prefix to mask. I'm not sure where
	I got the earlier rules..
	[50b2a7b1991d]

2006-08-06  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	Don't show INBOX if reference parameter is given.
	[58f353b9915a]

	* src/master/mail-process.c, src/master/master-settings.c:
	Run imap dump-capability process only after all the settings have
	been verified to be correct. Added checks against trying
	mail_drop_priv_before_exec=yes and chrooting, since we can't exec
	the imap process if that's done. Fixed NFS check with chrooting.
	[61990aea02bc]

	* src/login-common/main.c:
	Changed max_connections default value to be 1, not that it should
	matter.
	[3d2526a5f384]

	* src/login-common/ssl-proxy-openssl.c:
	Minor cleanup, but more importantly last commit message didn't say
	that the SSL proxy rewrite was once again reverted to the original
	one, but with SSL_pending() fix from the new one. Hopefully this
	will finally work with everyone.
	[93e62d5d12e4]

	* dovecot-example.conf, src/imap-login/client.c, src/login-
	common/common.h, src/login-common/login-proxy.c, src/login-common
	/login-proxy.h, src/login-common/main.c, src/login-common/master.c,
	src/login-common/master.h, src/login-common/ssl-proxy-openssl.c, src
	/login-common/ssl-proxy.c, src/login-common/ssl-proxy.h, src/master
	/login-process.c, src/master/login-process.h, src/master/main.c,
	src/master/master-login-interface.h, src/master/master-settings.c,
	src/master/master-settings.h, src/pop3-login/client.c:
	Fixes to login process handling, especially with
	login_process_per_connection=no. Removed login_max_logging_users
	setting since it was somewhat weird in how it worked. Added
	login_max_connections to replace it with
	login_process_per_connection=no, and with =yes its functionality is
	now within login_max_processes_count.
	[9d9e72374164]

2006-08-04  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	When mailbox changes are noticed and they're sent to client, cork
	before doing it so each command isn't sent in a separate packet.
	[555c27e58cb1]

	* src/plugins/acl/acl-cache.c:
	Crashfix
	[24377a486de5]

	* src/plugins/acl/acl-api-private.h, src/plugins/acl/acl-api.c,
	src/plugins/acl/acl-backend.c:
	If .DEFAULT file exists in global ACL root directory, use it as the
	default ACLs for all mailboxes.
	[e3f963c1773e]

2006-08-03  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	If master login failed because of non-password failure (eg.
	allow_nets) don't continue the authentication to non-master passdbs.
	[dee19849654b]

	* src/auth/auth-request.c:
	If we logged in with IPv6 address and allow_nets contained IPv4
	address, we assert-crashed.
	[92199dcb4018]

	* src/auth/auth-request-handler.c:
	When logging in as master user, send it as "master_user" field to
	master among other userdb fields.
	[d83f2a6e1f45]

	* src/auth/passdb-checkpassword.c:
	Call io_remove() before closing the fd.
	[9eefd9c4619a]

	* configure.in, src/plugins/quota/quota-fs.c, src/plugins/quota/quota-
	fs.h:
	Added --with-linux-quota configure option to specify which Linux
	quota version to use. Don't bother looking into struct dqblk to see
	if curblocks or curspace field exists, we can figure it out from the
	quota version. If quotactl() returns EINVAL, it could have been
	because wrong quota version was used, so give a friendly message
	suggesting to look at
	--with-linux-quota.
	[f598896bb40a]

2006-08-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction-view.c:
	And fix for previous change..
	[0ffb6fa11744]

	* src/lib-index/mail-index-transaction-view.c:
	Transaction view: mail_index_get_header() returns now updated
	next_uid field after appends.
	[74212d11b6b5]

	* src/lib-storage/index/mbox/mbox-save.c:
	We wrote mail bodies through raw output stream, instead of the one
	that made sure that CR+LF linefeeds were as configured.
	[4c2155f3d72b]

2006-07-31  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	s/expire-mails/expire-tool/
	[38f9daea3279]

	* src/plugins/convert/Makefile.am, src/plugins/expire/Makefile.am:
	Install expire-tool and convert-tool to libexec dir.
	[7ad90caaf34f]

	* src/plugins/expire/expire-tool.c:
	Compile fix
	[da7c51c193e2]

2006-07-31  Timo Sirainen  <timo.sirainen@movial.fi>

	* configure.in, dovecot-example.conf, src/plugins/Makefile.am,
	src/plugins/expire/.cvsignore, src/plugins/expire/Makefile.am,
	src/plugins/expire/auth-client.c, src/plugins/expire/auth-client.h,
	src/plugins/expire/expire-env.c, src/plugins/expire/expire-env.h,
	src/plugins/expire/expire-plugin.c, src/plugins/expire/expire-
	plugin.h, src/plugins/expire/expire-tool.c:
	Initial import of expire plugin code. Seems to work with at least
	one user. :)
	[99699cf9df43]

	* src/imap/imap-thread.c, src/lib-index/mail-hash.c, src/lib-index
	/mail-hash.h:
	Delay creating thread index file until THREAD command is used for
	the first time.
	[706c0cb1c821]

2006-07-31  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-master-connection.c:
	Debug: Don't log empty error when writing "master out" debug lines.
	[9202ffe3d5c5]

	* src/lib-dict/dict-db.c:
	Fixed dictionary iteration.
	[da2d2146a419]

	* src/dict/dict-server.c, src/lib-dict/dict-client.c:
	dict proxy: Dictionary iteration was broken.
	[4be4c887deb7]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h:
	index_mail_cache_add() was used with lib-storage's internal indexes
	for most of the received date, physical size and virtual size cache
	additions. This may have caused all kinds of trouble, but since it
	went unnoticed this long perhaps not..
	[ed489df90232]

2006-07-30  Timo Sirainen  <timo.sirainen@movial.fi>

	* configure.in, src/deliver/deliver.c, src/dict/Makefile.am,
	src/dict/main.c, src/imap/main.c, src/lib-dict/.cvsignore, src/lib-
	dict/Makefile.am, src/lib-dict/dict-client.c, src/lib-dict/dict-
	client.h, src/lib-dict/dict-db.c, src/lib-dict/dict-private.h, src
	/lib-dict/dict-sql.c, src/lib-dict/dict.c, src/lib-dict/dict.h,
	src/pop3/main.c:
	Berkeley DB dict support is now enabled only when using --with-db
	configure option.
	[e661182eab75]

	* src/dict/dict-cache.c, src/dict/dict-cache.h, src/dict/dict-
	server.c, src/lib-dict/Makefile.am, src/lib-dict/dict-client.c, src
	/lib-dict/dict-client.h, src/lib-dict/dict-db.c, src/lib-dict/dict-
	private.h, src/lib-dict/dict-sql.c, src/lib-dict/dict.c, src/lib-
	dict/dict.h, src/plugins/quota/quota-dict.c:
	Dictionary changes: Added support for defining value's type. Key is
	still always a string. Added support for sorting the iteration
	replies. Added dict_unset(). Added Berkeley DB support. Most of the
	code written by Tianyan Liu.
	[aa2f73a4df26]

2006-07-30  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-dict.c:
	DEBUG: Show username also in debug line.
	[2ee97af8c99f]

	* src/plugins/quota/quota-fs.c, src/plugins/quota/quota-maildir.c,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota.c,
	src/plugins/quota/quota.h, src/plugins/trash/trash-plugin.c:
	Changes to make trash plugin working again.
	[511f1f5c76fa]

2006-07-30  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/imap-quota/imap-quota-plugin.c:
	Fixes to make it compile again.
	[f91f3bcb7939]

2006-07-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-client.c:
	Delay sending the transaction begin command to server until the
	first modification is actually done. If no modifications are done,
	there's no need for commit/rollback command either.
	[b5d4c1e9a492]

	* src/lib-dict/dict-private.h, src/lib-dict/dict-sql.c, src/lib-
	dict/dict.c:
	If invalid key is given to dict_set() or dict_atomic_inc() fail the
	whole transaction in commit. Keep track of changes that are actually
	done, so if nothing has changed in transaction don't even bother to
	commit it.
	[3f808dd8f568]

	* src/lib-dict/dict.c:
	dict_atomic_inc(): Do nothing if diff parameter is 0.
	[96f0677c2bca]

2006-07-30  Timo Sirainen  <timo.sirainen@movial.fi>

	* dovecot-example.conf, src/plugins/quota/quota-dict.c,
	src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-fs.c,
	src/plugins/quota/quota-maildir.c, src/plugins/quota/quota-plugin.c,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota-
	storage.c, src/plugins/quota/quota.c, src/plugins/quota/quota.h:
	Added support for multiple quota roots, rules and storages. The
	configuration has changed, userdb now needs to return "quota_rule"
	settings instead. Much of the code changes were done by Tianyan Liu.
	[e5e79558ac2d]

2006-07-24  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	Don't count "." and ".." directory sizes to quota. After rewriting
	maildirsize file keep its fd open so that we can later update it.
	Patch by Alexander Zagrebin
	[807217630d80]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c:
	Restore data stream's offset after it has been internally changed,
	so that it doesn't have much visible effect on the stream returned
	by mail_get_stream(). The buffered data will still be lost, but this
	should help with the most common use cases.
	[ebf140ebdb06]

	* src/login-common/ssl-proxy-openssl.c:
	Use SSL_pending() to figure out if we should call SSL_read() again.
	Otherwise it breaks..
	[025ffc5a3643]

	* src/login-common/ssl-proxy-openssl.c:
	Don't constantly re-read ssl-parameters.dat. Make sure that in input
	handler we read everything that SSL_read() has buffered so we don't
	get stuck.
	[886d7af1f38d]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Don't crash if sync needs to be rollbacked.
	[b13ba5e40c4c]

	* src/lib-storage/index/dbox/dbox-mail.c:
	Slightly improved error message.
	[b7b64b98866b]

	* src/lib-storage/index/dbox/dbox-save.c:
	When saving a mail with initial keywords, lock the uidlist before
	doing anything with the file's header.
	[0d465504c18a]

	* src/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-index-
	sync-update.c:
	In some conditions a keyword could have been added to the index
	twice. Also a few cleanups.
	[a7178fbf4697]

2006-07-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-uidlist.c:
	Memory/fd leak fixes
	[14864c643427]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	When saving new mails, append the changes to uidlist file, but only
	when doing so doesn't temporarily move the file's mtime backwards.
	[896a2a638fd4]

	* src/lib-index/mail-index-sync-update.c:
	If header counters got broken when updating internal views, say it
	clearly in error messages instead of saying they're broken in the
	files themselves.
	[33391d888ea7]

	* src/lib-storage/index/dbox/dbox-sync.c:
	Fixes to writing flags
	[d907f885c5bc]

	* src/lib-storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/dbox/dbox-uidlist.c:
	Fixes for pop3_lock_session=yes. Wasn't as easy as I thought. :)
	[584634886fe6]

	* src/lib-index/mail-index.c:
	Small memory usage optimization.
	[bcc5d4dc5400]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/dbox/dbox-uidlist.c, src/lib-storage/index/dbox/dbox-
	uidlist.h:
	Make pop3_lock_session work with dbox.
	[e3157540a801]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c:
	If we find unexpected messages from dbox, rebuild index files to fix
	the problem.
	[2042d9eb455b]

2006-07-11  Timo Sirainen  <tss@iki.fi>

	* src/imap/Makefile.am, src/imap/imap-thread.c, src/imap/imap-
	thread.h, src/imap/main.c:
	THREAD command handling is now done through a hash index file. This
	speeds up the threading most of the time when the thread hash
	exists.

	With in-memory indexes the hash is kept in memory, but it gets the
	same benefits for subsequent THREAD commands as long as the mailbox
	is kept open.
	[e2cbc10c94f4]

	* src/lib-index/Makefile.am, src/lib-index/mail-hash.c, src/lib-index
	/mail-hash.h:
	Added code to support hash table index files.
	[5c4060661fb4]

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache-sync-
	update.c, src/lib-index/mail-cache.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-
	index-sync-private.h, src/lib-index/mail-index-sync-update.c, src
	/lib-index/mail-index.c:
	Added support for calling expunge handler for an extension even if
	the extension isn't used in the opened index file. Added context-
	parameter to the callback function. If the function returns -1, the
	sync is failed.
	[56d17f2e1d66]

	* src/lib-storage/mail-storage-private.h, src/lib-storage/mail-
	storage.c:
	Added hook_mailbox_opened to make it easier to hook all mailbox
	opens.
	[3d2be769d887]

	* src/lib-mail/Makefile.am, src/lib-mail/message-id.c, src/lib-mail
	/message-id.h:
	Added message_id_get_next() to return the next valid Message-ID from
	a string of Message-IDs.
	[1489be4d7b26]

	* src/lib/Makefile.am, src/lib/crc32.c, src/lib/crc32.h:
	Added crc32 calculation functions.
	[1e73f144cd84]

2006-07-08  Timo Sirainen  <tss@iki.fi>

	* doc/variables.txt:
	Example fix: %Lp -> %Ls
	[bc604c6071c3]

2006-07-05  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	dovecot -n and -a: Print the config file path before parsing it so
	if there are errors you can see what file is being used.
	[eb1e7932ade6]

	* dovecot-example.conf:
	Comment updates
	[d2c14175a509]

2006-07-04  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Updated namespace separator's comments.
	[e2521ee11147]

2006-07-03  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	--with-ioloop=auto changed to --with-ioloop=best
	[f60b07bd5fa7]

2006-07-03  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/index-mail.c:
	Crashfix: Added missing date.save field.
	[8b48d760b41e]

2006-07-02  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	mail_cache_min_mail_count is supposed to be an integer, not a
	string.
	[57a3f4c5194b]

	* src/master/master-settings.c:
	Added missing t_pop().
	[e0a8ac269fbb]

	* configure.in:
	Don't use epoll/kqueue by default unless --with-ioloop=auto is
	given. They're not necessarily as stable.
	[4b01707d6cbe]

	* src/master/main.c:
	If something in io_loop_create() failed, we logged the error to
	/dev/null.
	[e414beaf1473]

	* src/lib/failures.c:
	If writing to log file fails, restore errno before %m is used.
	Although the log writing most likely fails anyway at that point, but
	at least strace logs show it right. :)
	[504c137a3b32]

	* src/master/main.c:
	List -n and -a in short help. Fixes to --build-options.
	[3a3ef25c62ab]

	* src/login-common/ssl-proxy-openssl.c:
	Second try with SSL proxy rewrite. Did some fixes since last try.
	[1ff1603403de]

	* src/plugins/imap-quota/imap-quota-plugin.c:
	If there is no quota for the user, GETQUOTAROOT leaked memory
	[5811b2c183fd]

	* src/master/auth-process.c:
	anonymous_username setting wasn't being passed to auth process.
	[05b2b20881b5]

	* src/login-common/ssl-proxy-openssl.c:
	If verbose_ssl=yes set ssl_info_callback and print any alerts and
	BIO errors.
	[a939ee143a96]

2006-07-01  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-close.c, src/imap/imap-expunge.c, src/pop3/commands.c:
	Don't try to expunge messages if the mailbox is read-only. It'll
	just cause our index files to go out of sync with the real mailbox
	and cause errors.
	[c22b5134455a]

	* src/lib/mountpoint.c:
	mountpoint_get() returned broken mount_path and type with BSDs.
	[e3310e19c6f3]

	* src/plugins/quota/quota-fs.c:
	BSD's quotactl() wants a file path, not a device path.
	[ce47b2f84cdb]

	* dovecot-example.conf, src/imap-login/client.c,
	src/pop3-login/client.c:
	Removed hardcoded 127.* and ::1 IP checks. Instead just check that
	local IP matches remote IP to assume the connection is secure.
	[eaab43f6f65f]

	* src/auth/db-passwd-file.c:
	Don't require valid uid/gid fields if passwd-file isn't being used
	as a userdb.
	[50861235f77f]

	* src/lib-sql/driver-pgsql.c:
	Try to handle failures better.
	[ac58b71b88d0]

	* src/master/main.c:
	Print the used configuration file's path with -n and -a.
	[b7eaddfbcaad]

	* src/auth/auth-client-connection.c, src/auth/auth.h, src/auth/passdb-
	ldap.c:
	Moved the <hidden> string into a macro. Hide the password also from
	LDAP replies.
	[193f524562ca]

	* src/lib-storage/index/maildir/maildir-save.c:
	Messages' received time wasn't saved properly when saving/copying
	multiple messages at a time. Also if using quota plugin the S= size
	was only set for the first saved file, and even that was wrong.
	[de27599764c1]

	* src/lib-storage/index/maildir/maildir-mail.c:
	mail_get_physical_size() was broken with non-committed mails, which
	broke quota plugin.
	[ce727f4e53e5]

	* src/lib/file-copy.c:
	Try to preserve file's mode and group when copying it.
	[80943d914681]

	* src/master/mail-process.c:
	If namespace's location field wasn't set, the default location was
	supposed to be used.
	[de5163f16d8c]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/driver-sqlite.c, src/lib-sql/sql-api-private.h, src/lib-sql/sql-
	api.c, src/lib-sql/sql-api.h:
	sql_escape_string() should return const char *, not char *.
	[3e196acd60b7]

2006-06-30  Timo Sirainen  <tss@iki.fi>

	* src/lib/safe-mkdir.c:
	safe_mkdir() should return 1 always when it creates a new directory,
	even if it changes the group/permissions when doing it.
	[fa7353daa44f]

2006-06-29  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Added tpop3d's pop3_uidl_format.
	[9577a99b7fef]

2006-06-29  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/dbox/dbox-mail.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/index-mail.h, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/mail-storage-private.h, src/lib-
	storage/mail-storage.h, src/lib-storage/mail.c:
	Added mail_get_save_date() and some cleanups.
	[fce5140fbe0b]

2006-06-28  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	Allow log_path settings in config file to be empty without trying to
	use empty files then.
	[a75da1185a18]

2006-06-28  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-index/mail-index-dummy-view.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction-view.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index-view-private.h, src/lib-
	index/mail-index-view.c, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-storage/Makefile.am, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/dbox/dbox-
	storage.h, src/lib-storage/index/dbox/dbox-transaction.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-transaction.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-transaction.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/index/mbox/mbox-transaction.c, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c:
	Beginnings of joining mail-storage API more closely to mail-index,
	so that mail-index could be directly used if needed. Currently only
	transactions are joined.
	[85fcdb478608]

	* src/lib/array.h:
	Added array_idx_clear().
	[66fc4c35a8de]

2006-06-28  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-master-listener.c, src/auth/auth-master-listener.h,
	src/auth/auth-request-handler.c, src/auth/auth-worker-server.c,
	src/auth/mech-gssapi.c, src/auth/userdb-static.c, src/dict/dict-
	server.c, src/imap/client.h, src/imap/cmd-list.c, src/imap/commands-
	util.c, src/imap/commands-util.h, src/imap/commands.c, src/imap
	/imap-fetch.c, src/imap/imap-fetch.h, src/lib-auth/auth-client.c,
	src/lib-dict/dict.c, src/lib-imap/imap-base-subject.c, src/lib-index
	/mail-cache-compress.c, src/lib-index/mail-cache-lookup.c, src/lib-
	index/mail-cache-private.h, src/lib-index/mail-cache-transaction.c,
	src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	ext.c, src/lib-index/mail-index-sync-private.h, src/lib-index/mail-
	index-sync-update.c, src/lib-index/mail-index-sync.c, src/lib-index
	/mail-index-transaction-private.h, src/lib-index/mail-index-
	transaction-view.c, src/lib-index/mail-index-transaction.c, src/lib-
	index/mail-index-view-private.h, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-index.c,
	src/lib-index/mail-index.h, src/lib-index/mail-transaction-log-
	append.c, src/lib-mail/mail-types.h, src/lib-mail/message-body-
	search.c, src/lib-mail/message-header-search.c, src/lib-sql/driver-
	mysql.c, src/lib-sql/sql-api-private.h, src/lib-sql/sql-api.c, src
	/lib-storage/index/dbox/dbox-keywords.c, src/lib-storage/index/dbox
	/dbox-save.c, src/lib-storage/index/dbox/dbox-storage.h, src/lib-
	storage/index/dbox/dbox-sync-expunge.c, src/lib-storage/index/dbox
	/dbox-sync-full.c, src/lib-storage/index/dbox/dbox-sync.c, src/lib-
	storage/index/dbox/dbox-sync.h, src/lib-storage/index/dbox/dbox-
	uidlist.c, src/lib-storage/index/dbox/dbox-uidlist.h, src/lib-
	storage/index/index-mail-headers.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/index-mail.h, src/lib-storage/index
	/index-sort.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/maildir/maildir-
	keywords.c, src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-sync-parse.c, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync-
	rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/lib/array-decl.h, src/lib/array.h, src/lib/buffer.c,
	src/lib/buffer.h, src/lib/ioloop-epoll.c, src/lib/istream.c,
	src/lib/istream.h, src/lib/lib.h, src/lib/module-dir.c, src/lib/seq-
	range-array.c, src/lib/seq-range-array.h, src/lib/str.c,
	src/lib/str.h, src/master/mail-process.c, src/master/master-
	settings.h, src/plugins/acl/acl-backend-vfile.c, src/plugins/acl
	/acl-cache.c, src/plugins/acl/acl-mailbox.c, src/plugins/acl/acl-
	plugin.h, src/plugins/quota/quota-dirsize.c, src/plugins/quota
	/quota-private.h, src/plugins/quota/quota-storage.c,
	src/plugins/quota/quota.c, src/plugins/trash/trash-plugin.c,
	src/plugins/zlib/zlib-plugin.c:
	Array API redesigned to work using unions. It now provides type
	safety without having to enable DEBUG, as long as the compiler
	supports typeof(). Its API changed a bit. It now allows directly
	accessing the array contents, although that's not necessarily
	recommended. Changed existing array usage to be type safe in a bit
	more places. Removed array_t completely. Also did
	s/modifyable/modifiable/.
	[1a35d53c18fc]

	* src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-util.c:
	Don't break if mailbox path contains ':' characters.
	[14b10f7ea70e]

	* TODO:
	Updated
	[a2d8624f8f2e]

	* src/plugins/quota/quota-fs.c:
	Attempting to fix quota block calculations to be correct.
	[cf334cc732e7]

	* src/lib-storage/index/maildir/maildir-list.c:
	We could have skipped INBOX if there wasn't .INBOX directory.
	[0a615e0aa04d]

	* src/imap/Makefile.am, src/imap/main.c, src/master/mail-process.c,
	src/pop3/Makefile.am, src/pop3/main.c:
	Changed the mail_plugins/mail_plugin_dir settings to be passed as
	the same environments. If MAIL_PLUGIN_DIR environment isn't given,
	use the built-in default.
	[6d0ca893eab8]

2006-06-27  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c, src/lib-storage/mail-storage.c:
	MAIL_STORAGE_FLAG_KEEP_HEADER_MD5 flag was supposed to be set if
	pop3_uidl_format contained %m. Added it now to
	mail_storage_parse_env() so it's used everywhere.
	[13350093fa1b]

	* src/lib-sql/driver-sqlite.c:
	Escape ' with '' instead of with \'.
	[d0d04db8e7a6]

	* configure.in:
	Don't try to use any weird _syscall()s when detecting epoll.
	[a01337f6509a]

2006-06-26  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Fix kqueue notify checking.
	[9eee24bf2960]

	* src/lib-storage/index/maildir/maildir-storage.c:
	If dovecot-shared file exists in the Maildir++ root, use the file's
	mode and gid when creating mailboxes under it.
	[0c6a11afec00]

	* src/master/ssl-init.c:
	Don't leak a file descriptor when regenerating ssl-parameters.dat
	[be9c2d069995]

	* src/lib-storage/index/index-search.c:
	Searching (storing, fetching) with sequence sets containing commas
	was broken
	[12b5fbb3a05c]

2006-06-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	Don't crash when different search conditions reduce the search range
	so that minimum sequence becomes larger than maximum..
	[00db36e1b734]

	* src/plugins/acl/acl-backend.c:
	Don't crash when checking "owner" ACLs with shared namespaces.
	[a0066aa9678b]

2006-06-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	We assert-crashed in wrong conditions.
	[2b7254c5809c]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c:
	Fixes to handling CR+LF linefeeds.
	[ccd102aef7ad]

	* src/auth/passdb-passwd-file.c:
	When using non-plaintext authentication with passdb passwd-file we
	didn't support extra_fields and we crashed if password scheme wasn't
	explicitly specified in the passwd-file.
	[7fd600d3f719]

	* configure.in:
	fix
	[8916e7dd60c6]

2006-06-20  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/index-search.c:
	Don't crash if seqset restrictions caused no messages to be
	searched.
	[c13d8fe698f8]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-search.c:
	NOT condition wasn't handled correctly in SEARCH.
	[2461061327ed]

	* src/auth/passdb-checkpassword.c:
	If checkpassword lookup failed, we crashed. auth_debug logged
	checkpassword's exit_status wrong.
	[94b3bb847f39]

	* src/auth/passdb-checkpassword.c:
	Return value 1 from checkpassword can mean either password mismatch
	or unknown user. Treat it as password mismatch instead of as unknown
	user.
	[c58659bf7ca5]

2006-06-19  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-copy.c:
	If destination file already existed, we didn't overwrite it with
	link() copying.
	[94dc3f73ffb9]

	* src/auth/db-ldap.c:
	Prefer sasl/sasl.h. Require SASL v2, otherwise disable it.
	[ffafc8583e06]

	* configure.in, src/auth/db-ldap.c, src/auth/db-ldap.h:
	Check for sasl.h and sasl/sasl.h existence and use the one that's
	found. If neither is found, disable support for LDAP SASL.
	[b8089cf41c96]

2006-06-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-ntlm/ntlm-des.c:
	Don't include stdint.h directly.
	[227733bbe607]

	* src/auth/Makefile.am, src/deliver/Makefile.am, src/dict/Makefile.am,
	src/imap/Makefile.am, src/pop3/Makefile.am:
	Added -export-dynamic.
	[b6ece4ed0343]

	* configure.in:
	Fixes to io notify detection. Patch by Marcus Rueckert
	[26d18749f718]

	* configure.in:
	Include linux/unistd.h instead of asm/unistd.h when checking for
	epoll.
	[c46c02c7e602]

	* src/lib-storage/index/maildir/maildir-mail.c:
	If requested mail isn't found from uidlist, mark the mail as
	expunged.
	[f1888ce91702]

	* src/auth/auth-request.c:
	auth_debug: If allow_nets is given, print debug messages when
	matching
	[1174e508593d]

	* src/auth/db-passwd-file.c:
	extra_args field was ignored if the passwd-file wasn't also used as
	a userdb.
	[c38157eefd1e]

2006-06-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c:
	Crashfix if mail's data is fetched in specific order (I'm not sure
	how to reproduce this though, but the crash has happened to others)
	[fa7ae95c125b]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Removed assert. In normal situations it doesn't happen and in error
	cases (cached offset is invalid) it causes a crash.
	[1eda19d6f1a7]

	* src/imap-login/client-authenticate.c:
	Don't crash if the initial response isn't given for AUTHENTICATE..
	[fc135e4c169e]

	* configure.in, src/auth/db-ldap.c, src/auth/db-ldap.h:
	Added TLS support for LDAP if the library supports it.
	[b91816cd1d16]

	* src/auth/mech-anonymous.c, src/auth/mech-apop.c, src/auth/mech-cram-
	md5.c, src/auth/mech-digest-md5.c, src/auth/mech-login.c, src/auth
	/mech-ntlm.c, src/auth/mech-plain.c, src/auth/mech-rpa.c,
	src/auth/mech.c, src/auth/mech.h:
	Added mech_generic_auth_internal() and mech_generic_auth_free()
	functions and used them wherever possible to reduce code
	duplication. Patch by Andrey Panin.
	[9017db478693]

	* src/plugins/acl/Makefile.am, src/plugins/convert/Makefile.am,
	src/plugins/quota/Makefile.am, src/plugins/trash/Makefile.am:
	mkdir_p doesn't accept multiple directories in some systems, so do
	it one at a time. This also cleans up the code.
	[96d9947fde60]

	* src/lib-storage/index/mbox/mbox-save.c:
	If saved mail's body doesn't end with LF, add it ourself.
	[521d07f9c247]

	* configure.in, src/imap-login/client-authenticate.c:
	Added support for SASL-IR extension.
	[a2420b745cd5]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	If mbox headers have CRLF linefeeds, handle them properly instead of
	corrupting the headers.
	[46710be9f4bf]

	* src/lib-mail/message-header-parser.c, src/lib-mail/message-header-
	parser.h:
	Added crlf_newline flag to header parser, which is set if the header
	ended with CR+LF instead of LF.
	[6744d3eb4113]

	* src/master/master-settings.c:
	Changed the created state dir's default permissions to be 0750.
	Although this doesn't currently really matter.
	[9c9dec4901d9]

	* configure.in, src/master/Makefile.am, src/master/master-settings.c,
	src/master/ssl-init.c:
	Added --with-statedir configure option which defaults to
	localstatedir/lib/dovecot. ssl-parameters.dat is permanently stored
	in that directory and copied to login_dirs from there.
	[2e4857a2b858]

	* src/lib/Makefile.am, src/lib/file-copy.c, src/lib/file-copy.h:
	Added file_copy().
	[18c7c5215b53]

	* src/auth/db-ldap.c, src/auth/password-scheme.c:
	Compiler warning fixes and some coding style cleanups.
	[fe17f63521ea]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib/compat.h:
	Handle EMLINK and EPERM errors the same way as EXDEV when handling
	hardlink failures. Added ECANTLINK() macro for this.
	[76e2177be0bf]

	* src/lib-storage/index/maildir/maildir-storage.c:
	When renaming a mailbox's subfolders, read the list of them first
	into memory to avoid the possibility of readdir() skipping some of
	the mailboxes.
	[e1c32d917934]

	* src/auth/auth-request.c:
	If multiple passdbs were configured and we tried to authenticate as
	user which was in more than one of them with different passwords, we
	gave "multiple passwords not supported" error.
	[8846e6be0e02]

	* src/auth/auth-request-handler.c:
	Fixed memory leak in error handling.
	[10cdcfe98cfc]

	* dovecot-example.conf, src/plugins/trash/trash-plugin.c:
	Removed hardcoded trash plugin configuration paths. Added
	information about it to dovecot-example.conf
	[593523f53500]

	* src/lib-auth/auth-server-request.c:
	Check that initial response doesn't contain invalid characters. Give
	better error message in case that happens.
	[932a70c17a48]

	* src/imap/commands-util.c:
	Fixes to checking if mailbox name is valid. In case mailbox name is
	invalid, put it through str_sanitize() before giving it in an error
	message.
	[3e74b2b09ed1]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	Don't go fixing duplicate maildir filenames without properly
	checking that they really are such.
	[5cbabd4ccd9c]

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log.c:
	Handle transaction log deletions silently. Handle whole index
	directory deletions silently (the most common cases anyway).
	[208194b3742a]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage-private.h, src/lib-
	storage/mail-storage.c:
	When creating a mailbox, limit the number of hierarchies (to 20) and
	the length of the mailbox name within a hierarchy (to 200).
	[3f9b7d2a7c60]

	* src/lib-index/mail-index.c:
	mail_index_move_to_memory(): Don't break if the index is already in
	memory. Fixes mbox_min_index_size.
	[0462137fa4ce]

	* dovecot-example.conf, src/dict/dict-server.c, src/lib-dict/dict-
	client.h, src/master/dict-process.c, src/master/dict-process.h,
	src/master/log.c, src/master/log.h, src/master/main.c, src/master
	/master-settings.c, src/master/master-settings.h:
	Instead of passing URIs directly to dictionary server, it now
	accepts only named dictionaries which are configured in config file.
	SIGHUPing master now restarts dict server.
	[9928ebb54719]

	* src/plugins/quota/quota-dict.c:
	Don't crash if dict_lookup() didn't return success.
	[ed8e49b0a4ae]

	* src/lib-sql/driver-mysql.c:
	Escaping a string crashed if we weren't connected to mysql.
	[ec5a8b1523a3]

	* src/dict/main.c:
	Make sure the process dies when the master process dies.
	[f0ac35961ae2]

2006-06-16  Timo Sirainen  <tss@iki.fi>

	* src/deliver/auth-client.c:
	If USER query doesn't return non-zero uid and gid, give a nice error
	message.
	[16b28625cb79]

	* src/master/auth-process.c, src/master/login-process.c, src/master
	/mail-process.c, src/master/main.c, src/master/master-settings.c:
	Settings parser nowadays returns "" instead of NULL when it reads an
	empty value from config file (due to some good reason I
	unfortunately didn't write to commit message and can't remember
	anymore). Fixed a lot of existing checks which checked for empty
	strings with NULL instead of "" checks.
	[af61031c746f]

	* configure.in, src/plugins/quota/quota-fs.c:
	Added support for XFS disk quotas. Patch by Pawel Jarosz
	[670dd15edbf3]

	* configure.in:
	Better detection for ioloop and notify methods. Patch by Roy Marples
	[e23469650c85]

	* src/lib-dict/dict-client.c:
	Fixes
	[2c4a39afea07]

	* src/lib-sql/driver-mysql.c:
	Fixes to handling database updates.
	[a8979ba36c74]

	* dovecot-example.conf:
	Default mail_plugin_dir was wrong for lda.
	[dc1f912bbf10]

	* COPYING, src/auth/mech-apop.c, src/auth/mech-gssapi.c, src/auth
	/mech-login.c, src/auth/mech-ntlm.c, src/auth/mech-rpa.c, src/lib-
	ntlm/ntlm-byteorder.h, src/lib-ntlm/ntlm-encrypt.c, src/lib-ntlm
	/ntlm-flags.h, src/lib-ntlm/ntlm-message.c, src/lib-ntlm/ntlm-
	types.h, src/lib/hmac-md5.c, src/lib/ioloop-epoll.c:
	Relicensed dovecot-auth to MIT.
	[f8d37e26a2b3]

	* src/auth/password-scheme.c:
	Added PLAIN-MD4 password scheme. Patch by Andrey Panin.
	[8ca061f80b41]

	* src/lib/md4.c, src/lib/md5.c:
	MD4 was broken with 64bit systems. Added a few x86-64 optimizations.
	Patch by Andrey Panin
	[7eef9a1c51c4]

	* src/lib-ntlm/ntlm-byteorder.h:
	X68_64 CPU can do little-endian accesses itself. This patch updates
	ntlm-byteorder.h to reflect this fact. Patch by Andrey Panin.
	[70f95d997c3b]

	* src/lib-ntlm/ntlm-des.c:
	Replaced LGPL licensed DES implementation with MIT licensed one
	taken from PuTTY SSH client. Patch by Andrey Panin.
	[15d3681fdecc]

	* src/auth/mech-login.c:
	Support initial SASL response with LOGIN mechanism. Patch by Anders
	Karlsson
	[25b6b670656d]

	* src/lib/module-dir.c:
	Handle errors more correctly. Fixes problems with some OSes.
	[364d9c7563df]

	* src/master/main.c:
	We broke if ssl_listen wasn't explicitly set in config file. Patch
	by Jonathan C. Broome
	[4fa4d1d299d3]

	* src/auth/auth-request.c, src/auth/passdb-pam.c, src/auth/passdb.h:
	If password is expired, give "Password expired" error. Currently
	works only with PAM. Also added "unknown user" PAM return value
	handling.
	[96fd7a3f9bfe]

	* TODO:
	Updated
	[936e90b7d525]

	* src/dict/dict-server.c:
	Minor error message update
	[de1704b2bb97]

	* src/lib-dict/dict-sql.c:
	Fixes to SQL update statements
	[b931db01be6c]

	* src/plugins/quota/quota-dict.c:
	Don't return "no quota" even though current quota for user doesn't
	exist yet.
	[bf23e6cc6623]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Crashfix in error cases
	[f98c5b8ca59d]

	* src/lib-dict/dict-client.c:
	Fixes to dict proxy
	[51a1d0fbbc94]

	* src/lib-dict/dict-client.c:
	t_pop() calls were missing from some error handling paths
	[763401b5b344]

	* dovecot-example.conf:
	Updated LDA's default auth_socket_path
	[5f0d649c26c3]

	* dovecot-example.conf:
	Updated postmaster_address and hostname setting descriptions.
	[74bde164ae1b]

	* dovecot-example.conf:
	Changed default postmaster_address to @example.com
	[ed35a04c34fe]

	* src/auth/passdb-pam.c:
	Set PAM_TTY.
	[6671ed33b99c]

	* dovecot-example.conf:
	Added protocol lda section and did some other cleanups
	[fde5c7704ee2]

	* dovecot-example.conf:
	s/login_process_per_use/login_process_per_connection/
	[4e0890fa0bbe]

	* dovecot-example.conf:
	Moved around settings and added some main groups to them, hopefully
	making it easier to find them.
	[7b18bb6b6450]

	* dovecot-example.conf:
	Moved the socket listen example into auth default instead of having
	its own auth block, which confused people.
	[92ad9dbcde85]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-
	transaction-log-append.c:
	We used "already synced log positions in view" array to store
	locations of committed hidden transactions. They however weren't
	really synced, which caused some problems. Added a separate "hidden
	sync log positions" array for them which is handled differently.
	[414cd456e7de]

	* dovecot-example.conf, src/auth/passdb-pam.c:
	Don't call pam_setcred() unless setcred=yes PAM passdb argument was
	given.
	[ffb59f920018]

	* src/imap/cmd-subscribe.c:
	If tb-extra-mailbox-sep workaround was enabled, subscribing was
	broken unless the namespace had empty prefix.
	[0726c68f0ef9]

	* src/master/main.c:
	If running from inetd, don't try to open/close listener sockets when
	receiving SIGHUP.
	[3af32babd71b]

	* src/imap/imap-expunge.c:
	If mailbox_search_deinit() fails, we leaked a bit of memory.
	[bcad3ae8778c]

	* src/master/login-process.c:
	Starting pop3 processes from inetd started actually imap processes
	after login.
	[3e542f308cb5]

	* src/login-common/ssl-proxy-openssl.c:
	Updates to ssl_verify_client_cert: Check CRLs. If auth_verbose=yes,
	log invalid sent certificates. If verbose_ssl=yes, log even the
	valid certificates. When using the username from the certificate,
	use CommonName. Based on patch by HenkJan Wolthuis
	[d57c83c64b20]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/maildir/maildir-util.c,
	src/plugins/quota/Makefile.am, src/plugins/quota/quota-maildir.c:
	Add ",S=size" to maildir filenames when quota plugin is loaded with
	Maildir++ backend.
	[61cc7e40bec6]

	* src/auth/db-sql.c:
	s/ldap/sql/ in error message
	[a916c98dc910]

	* configure.in, src/Makefile.am:
	Enabled building deliver
	[4d4c649ac106]

	* configure.in:
	Whitespace cleanup for --help. Don't enable GSSAPI support by
	default.
	[2dc5f48ff4ee]

	* src/deliver/Makefile.am, src/deliver/auth-client.c, src/deliver
	/auth-client.h, src/deliver/deliver.c, src/deliver/deliver.h,
	src/deliver/duplicate.c, src/deliver/duplicate.h, src/deliver/mail-
	send.c, src/deliver/mail-send.h, src/deliver/smtp-client.c,
	src/deliver/smtp-client.h:
	Moved all the non-Sieve code from dovecot-lda in here and rewrote
	parts of it to be cleaner. The Sieve code can now be run as a plugin
	from dovecot-sieve CVS module.

	Includes also all fixes to this code from branch_1_0.
	[a73d2867f6e1]

	* INSTALL:
	Removed most of the content and added links to Wiki instead.
	[5fe316cdd8a6]

	* src/lib-index/mail-cache-fields.c:
	If cache field's size is wrong, rebuild the cache file instead of
	crashing sometimes later.
	[f5d9c2b4d118]

	* src/lib-storage/index/maildir/maildir-list.c:
	If file begins with ".nfs", stat() it always to see if it's a
	directory since it may be a temporary file created by kernel.
	[34179afd158a]

	* .cvsignore, Makefile.am, configure.in, dovecot-config.in, dovecot-
	config.in.in:
	dovecot-config now contains module_dir
	[407e6c620d70]

	* doc/mkcert.sh:
	If cert/key directories don't exist, exit immediately instead of
	just priting the errors.
	[b668848fff11]

	* AUTHORS:
	Some updates
	[9bba948e502a]

	* src/lib/primes.c:
	Minor coding style changes. Removed GLib copyrights as the only
	thing left from the original code is the prime number list.
	[31e87bda1362]

	* src/plugins/convert/convert-storage.c:
	Convert subscriptions also.
	[858ca16c704b]

	* src/lib-storage/index/dbox/dbox-format.h:
	Changed subscriptions filename to just "subscriptions".
	[3f6e11e5ed2d]

	* src/plugins/quota/quota.c:
	Don't return NULL error so we don't crash in some systems.
	[7d00a60df882]

2006-06-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-format.h, src/lib-storage/index/dbox
	/dbox-save.c:
	Added save_time field into dbox mails.
	[2e9ec468197d]

2006-06-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-dict/dict-sql.c:
	Use sql_escape_string() instead of str_escape()
	[6dba897351bb]

2006-06-12  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/master/mail-process.c:
	dovecot --exec-mail ext <binary path> now reads the default settings
	from configuration file, puts them to environment and executes the
	given binary.
	[23394b3a7879]

	* src/lib-index/mail-index-transaction-view.c:
	mail_index_lookup() and mail_index_lookup_full() returns now 0 if
	the mail has been expunged within the transaction.
	[8bfdd3928097]

	* src/lib/strfuncs.c, src/lib/strfuncs.h:
	Added p_strsplit_free()
	[2428e6821eb4]

2006-06-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-file.h, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox/dbox-
	storage.h, src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-sync-full.c, src/lib-storage/index/dbox
	/dbox-sync.c:
	Allow reading saved mails which haven't been committed yet (ie. make
	quota plugin work).
	[b445c43d5472]

2006-06-11  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-fs.c, src/plugins/quota/quota-maildir.c,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota-
	storage.c, src/plugins/quota/quota.c, src/plugins/quota/quota.h:
	If size of the mail was known before saving started, we allocated
	the quota twice for it.
	[823648215520]

2006-06-11  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-dict.c:
	Get the quota limits from plugin parameters instead of from the
	dictionary itself. Added support for message count limits. Other
	cleanups.
	[72361670eaab]

2006-06-11  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/quota/quota-storage.c:
	Update quota when deleting a mailbox.
	[79e7c206a75c]

2006-06-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c:
	Handle i_stream_stat() better.
	[dbae2347dcdb]

	* src/master/main.c, src/master/master-settings.c:
	If ssl_listen setting was empty in config file, startup failed with
	"Can't resolve address" error.
	[e228a9efd35d]

	* src/lib-index/mail-cache.c:
	Crashfix
	[95b0ce55fa4b]

	* src/lib-storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox
	/dbox-uidlist.c, src/lib-storage/index/dbox/dbox-uidlist.h:
	If mail's size is known beforehand, select the dbox file so that the
	saving won't grow file larger than dbox_rotate_size.
	[36587f382562]

	* src/lib-storage/index/dbox/dbox-save.c:
	Saving to multiple files within a transaction was broken.
	[af09f5b2ce04]

	* src/lib-storage/index/dbox/dbox-mail.c, src/lib-storage/index/dbox
	/dbox-sync-full.c, src/lib-storage/index/dbox/dbox-uidlist.c:
	Several dbox fixes backported from branch_1_0
	[f693898fee3b]

	* src/plugins/convert/convert-storage.c:
	Create destination INBOX always uppercased.
	[928f9082a322]

	* README:
	Added a note about using mailing list for questions.
	[5d2849b6cb90]

	* src/auth/db-ldap.c, src/auth/db-ldap.h:
	Added support for SASL binding. Patch by Geert Jansen
	[31a28cd0b020]

	* src/pop3/Makefile.am:
	Link mountpoint.o manually to get mountpoint_get() included into
	binary, so quota plugin can use it.
	[0cb50c985ac6]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	Don't cause whitespace offsets to break if some headers before it
	were removed (eg. extra X-IMAPbase headers)
	[59785a02e715]

	* src/master/master-settings.c, src/master/master-settings.h:
	Fix for non-C99 compilers.
	[2a3e17f3a5dc]

	* src/master/mail-process.c:
	NFS check wasn't working if chrooting was used.
	[101a7b10bd02]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Don't allow "." and ".." mailbox names/masks.
	[03e427774958]

	* src/imap/Makefile.am, src/imap/cmd-authenticate.c, src/imap/cmd-
	login.c, src/imap/commands.c, src/imap/commands.h:
	Removed LOGIN and AUTHENTICATE command handlers completely. They're
	only valid in non-authenticated state and there's really no point in
	having them here anymore.
	[d301901c20a5]

	* src/lib-index/mail-index.c:
	Keep track of write_atomic and write_seq_first/last while copying
	memory mappings. This is important with mmap_disable=yes because the
	maps can later be written to index file, and if this information is
	wrong the file is being updated wrong..
	[2cb75f2e25c6]

	* src/lib/sendfile-util.c:
	Linux's sendfile() returns 0 when remote has closed connection.
	Convert it to EPIPE.
	[d593e3094256]

	* src/lib/mempool-alloconly.c:
	base_size variable isn't really needed in the pool when DEBUG isn't
	used. With DEBUG enabled, check when clearing the pool that the
	allocated memory is completely cleared, ie. that no-one wrote out of
	bounds to it.
	[1a662a902b24]

	* src/lib/ioloop-kqueue.c:
	Fixed "Unrecognized event" errors that occurred with IO_ERROR. Patch
	by Vaclav Haisman
	[eb8f869a1126]

	* src/lib/file-dotlock.c:
	If dotlock creation timeouts, unlink() the temp file we used
	[b0c4e02d715b]

	* src/lib/file-dotlock.c:
	When checking if we want to override dotlocks, don't use the file-
	to-be-locked file's mtime if it's higher than current time.
	[f92485c7bbd7]

	* src/lib/file-dotlock.c:
	Using file_dotlock_touch() caused Dovecot to think the dotlock had
	been modified by someone else.
	[ce3c09a75b87]

	* src/plugins/convert/Makefile.am:
	Added library dependencies to work correctly for convert-tool.
	[b33e92f80392]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	dbox_rotate_size checking was wrong.
	[3bb4f35b99d4]

2006-06-08  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/imap/cmd-sort.c, src/imap/imap-sort.c, src/lib-
	storage/index/Makefile.am, src/lib-storage/index/dbox/dbox-
	storage.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-search.c, src/lib-storage/index/index-sort.c, src/lib-
	storage/index/index-sort.h, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h:
	Changed mail-storage API to do the mail sorting internally.
	Optimized it internally to keep a 32bit sort_id field in index for
	each used primary sort condition. Practically this should mean less
	disk I/O, memory and CPU usage when SORT command is used.
	[5f03738219a6]

2006-06-07  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-fetch.c:
	If FETCH fails because client disconnects in the middle of it,
	return "Disconnected" error message instead of "unknown error".
	[a9498883f44c]

2006-06-05  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c, src/login-common/sasl-
	server.c, src/login-common/sasl-server.h, src/pop3-login/client-
	authenticate.c:
	IMAP: Reply with tagged BAD if authentication is aborted because
	client sent "*" or something else that was a client error.

	If authentication failed for any reason, the error message was
	always "Authentication failed". In case of client errors or if auth
	process gave an error message, it should have been that instead.
	[0e10b01960a0]

2006-06-02  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Check for existence of PQescapeStringConn() in PostgreSQL library.
	Forgot to commit earlier.
	[3eeceb1156ad]

2006-05-31  Timo Sirainen  <tss@iki.fi>

	* src/master/ssl-init-openssl.c:
	Reversed last change. Instead handle DH_generate_parameters() call's
	failure.
	[dacf4dc615ec]

	* src/master/ssl-init-openssl.c:
	Give a nicer error message if i2d_DHparams() returns 0, which
	apparently it does in some cases.
	[2e4639fd3c7c]

2006-05-31  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	With some NFS implementation DELETE failed if ..DOVECOT-TRASHED
	directory already existed
	[339ca5b4a3f2]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c:
	Close index files before trying to unlink the index directory
	[e4650b4f4e5a]

2006-05-31  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-cache.c, src/auth/auth-request.c, src/auth/auth-
	request.h, src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/db-
	passwd-file.c, src/auth/db-sql.c, src/auth/passdb-sql.c, src/auth
	/userdb-sql.c:
	Escape SQL strings using sql_escape_string(). Fixes the problems
	with PostgreSQL.
	[4fc637010202]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/driver-sqlite.c, src/lib-sql/sql-api-private.h, src/lib-sql/sql-
	api.c, src/lib-sql/sql-api.h:
	Added sql_escape_string()
	[1a98cb709395]

2006-05-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/driver-mysql.c:
	Use array instead of buffer for storing connections.
	[539a2dcd92b4]

	* src/lib/istream-internal.h, src/lib/istream.h, src/lib/nfs-
	workarounds.h:
	Include <sys/stat.h> before using struct stat, because some systems
	may use a macro to define struct stat to something else.
	[5f1069459a07]

	* src/imap/client.c:
	Added assert against NULL reason for client_disconnect().
	[c78bd7fb7ce8]

	* src/lib-storage/index/index-storage.c:
	Don't return NULL error messages.
	[823f6515ffdc]

2006-05-30  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/acl/acl-backend-vfile.c, src/plugins/acl/acl-cache.c,
	src/plugins/acl/acl-cache.h:
	Don't check ACL file's timestamp changes more often than once in a
	second.
	[58a7882ba128]

	* src/plugins/acl/acl-backend-vfile.c:
	NULL-terminate the parsed rights
	[1cb59399b395]

	* src/imap/cmd-append.c:
	Compile fix
	[a10701f11246]

	* src/auth/mech-digest-md5.c:
	Compiler warning fix
	[b5b0e98b1d98]

2006-05-30  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-cache.c:
	We were caching the EOF block wrongly in some situations.
	[9f5cdfb282a0]

	* src/lib-index/mail-index-sync-update.c:
	Memory leak fix for last update and some other cleanups
	[ae0d876d98f5]

	* src/lib-index/mail-cache-sync-update.c, src/lib-index/mail-cache.c,
	src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index.c:
	We were updating index->map also when syncing views.
	[22b54c007b91]

	* src/lib-index/mail-index-sync-ext.c:
	When extension data is being reset, recreate the index file to make
	sure that other processes notice the reset_id change. Fixes cache
	file corruption complaints around the time it's being compressed.
	[7e1acaa7e76b]

	* src/lib-storage/index/dbox/dbox-sync.c:
	Removing and resetting keywords could have operated on wrong file's
	keyword list.
	[b0ebcefc1967]

	* src/lib-imap/imap-bodystructure.c:
	BODYSTRUCTURE -> BODY translation was missing CRLF after literal.
	[92bf418b8a60]

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	keywords.c, src/lib-index/mail-index-sync-private.h, src/lib-index
	/mail-index-sync-update.c, src/lib-index/mail-index-sync.c:
	If we're synchronizing a view (and not index itself) from
	transaction log, give a different error message and don't mark the
	file corrupted.
	[ca5008de2921]

	* src/lib-index/mail-index.c:
	If syncing from transaction log fails, fallback to re-reading the
	index file (and more importantly, try to avoid crashing in assert..)
	[19a0864deb4e]

	* src/imap/cmd-append.c:
	If connection closes while appending, we crashed in some situations.
	[c8af5a2492c5]

	* src/lib-storage/index/dbox/dbox-format.h, src/lib-storage/index/dbox
	/dbox-list.c, src/lib-storage/index/dbox/dbox-storage.c:
	Renamed Mails -> dbox-Mails to make it less likely to conflict with
	user-created mailbox.
	[7e8bd7301461]

	* src/lib-storage/index/dbox/dbox-keywords.c:
	Fix for handling keywords
	[6fd56bf3f3be]

2006-05-16  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/dbox/dbox-mail.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/index-mail.h, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/mail-storage-private.h, src/lib-
	storage/mail-storage.h, src/lib-storage/mail.c:
	Added mail_set_uid() to select a mail by UID.
	[bd519db7f6e5]

2006-05-15  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/imap/imap-thread.c:
	Minor cleanup / memory reducement fix
	[c7bcc970bf19]

	* src/auth/mech-digest-md5.c:
	Trying to use subsequent authentication crashed.
	[011f7c2b0ed0]

2006-05-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-settings/settings.c:
	Read empty string settings as "", not NULL.
	[68b2a69b80b1]

	* src/lib/mountpoint.c:
	Minor cleanup: Switch hardcoded /etc/mnttab in Solaris to use MNTTAB
	macro
	[455b8162e0a9]

2006-05-09  Timo Sirainen  <tss@iki.fi>

	* src/pop3-login/client-authenticate.c:
	If PASS command is given (after unsuccessful USER) with plaintext
	auth disabled, give proper error message instead of "No username
	given".
	[b8fd29a53d47]

2006-05-09  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/imap/cmd-append.c, src/lib-storage/index/dbox/dbox-save.c, src
	/lib-storage/index/dbox/dbox-storage.h, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/maildir/maildir-
	copy.c, src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-copy.c, src/lib-storage/mail-storage-private.h, src
	/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h,
	src/plugins/acl/acl-mailbox.c, src/plugins/quota/quota-private.h,
	src/plugins/quota/quota-storage.c:
	Changed mailbox_save_*() API a bit: Moved the struct mail *dest_mail
	to save_init() instead of being in save_finish(). This way you can
	request wanted fields from the mail while it's being saved.

	With maildir the message is being parsed at the same time as it's
	being saved, and the results are stored into cache file.
	[7112aad504ae]

	* src/lib-mail/message-parser.c, src/lib-mail/message-parser.h:
	Some fixes and added message_parser_set_crlfs().
	[bd99e8f5e3ac]

	* src/lib/Makefile.am, src/lib/istream-tee.c, src/lib/istream-tee.h:
	Added tee-istream, which can be used to create multiple readable
	input streams from one input stream.
	[662578b5ae22]

	* src/lib-mail/message-parser.c, src/lib-mail/message-parser.h:
	Added message_part to struct message_block and some cleanups.
	[75d5843153f1]

	* src/lib/istream-seekable.c:
	If parent stream's read() returned -2, we returned -1 instead of the
	-2.
	[b3fa08c14747]

2006-05-08  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/index-mail.c:
	Some more cleanups
	[56f4b7ee6c2f]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	Cleanups and minor logic changes as to what should be cached.
	[d7dd2f20c15c]

	* src/lib-index/mail-cache-transaction.c, src/lib-index/mail-cache.h:
	Added mail_cache_field_want_add() and mail_cache_field_can_add()
	[8fd5dfa271ef]

2006-05-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail.c:
	Strings should be freed with str_free(), not p_free().
	[327abd67380d]

2006-05-08  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-mail/Makefile.am, src/lib-mail/message-header-parser.c, src
	/lib-mail/message-header-parser.h, src/lib-mail/message-parser.c,
	src/lib-mail/message-parser.h, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-search.c:
	Rewrote the message bodystructure parser to allow parsing from non-
	blocking streams. Also did a couple of API changes and cleanups.
	[fd315deac28f]

2006-05-08  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Note about this being unstable CVS branch
	[bd93316b078b]

	* TODO:
	Update
	[d5381941feea]

2006-05-05  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-connection.c:
	If authentication client does something bad, don't crash the whole
	process (clean NULL-pointer-write crash).
	[cfe9e58be252]

	* src/auth/auth-worker-client.c:
	Don't send extra TABs to auth worker server, they break it.
	[4f742c7f7948]

	* src/lib/module-dir.c:
	Fix for building without modules
	[f7d281db12e6]

2006-05-04  Timo Sirainen  <tss@iki.fi>

	* src/auth/main.c, src/deliver/deliver.c, src/dict/main.c,
	src/imap/main.c, src/login-common/main.c, src/master/main.c,
	src/pop3/main.c:
	Use lib_signals_ignore() for signals we really want ignored.
	[545a747d0347]

	* src/lib/lib-signals.c, src/lib/lib-signals.h:
	And s/lib_signals_ignore_signal/lib_signals_ignore/
	[ec4782b057f0]

	* src/lib/lib-signals.c, src/lib/lib-signals.h:
	Added lib_signals_ignore_signal() and made lib_signals_set_handler()
	with NULL handler not restart syscall.
	[5bc987dc62a8]

	* src/lib-storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/dbox/dbox-sync.h:
	s/dbox_sync_if_changed/dbox_sync_is_changed/
	[a767dd4fafb0]

	* src/lib-storage/index/dbox/dbox-sync.c:
	Keep track of recent flags.
	[706c978c7c7d]

	* src/lib-index/mail-index-sync.c:
	If only changes were recent-flag updates, we didn't write them to
	index.
	[f17622d1d927]

2006-05-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c:
	Don't compress cache file if it was just compressed by another
	process.
	[9c3f19110538]

	* src/lib-index/mail-index-sync-update.c:
	When removing recent-flags with mmap_disable, the flags weren't
	actually removed which caused broken recent counter errors. Also
	added more checks not to update counters if they're already known to
	be broken.
	[524a584f2302]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Fix
	[be915546ce49]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-view-private.h, src/lib-index/mail-index-view-sync.c,
	src/lib-index/mail-index-view.c:
	Index header's seen/recent/deleted counters weren't always correct
	after syncing a view. This caused some problems with recent SEARCH
	optimizations, eg. EXPUNGE not always working.
	[b9a7a9592f43]

	* src/lib-index/mail-index-transaction.c:
	Fixes to updating keywords
	[07c10799434e]

2006-05-02  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	When requesting quota resource, don't return it if it's unlimited.
	Also treat 0 quota limits also in plugin parameters as unlimited.
	[e05768db2fd7]

	* src/plugins/imap-quota/imap-quota-plugin.c:
	Don't add extra spaces to reply if some of the resources aren't
	really found.
	[4fa5cda580db]

	* src/pop3/main.c:
	Built-in pop3_logout_format default wasn't updated.
	[f58c8751cacf]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	Offset update fix
	[edd923a44ef7]

2006-05-02  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h:
	Adding mail to index while saving it had a race condition. Fixing it
	required a bit larger changes. Switched uidlist/index locking order
	so that uidlist is now locked first.
	[3c8b191b0019]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index.c:
	mmap_disable: When syncing in-memory index from transaction log, we
	didn't skip external transactions which were already been in our in-
	memory mapping, causing "Append with UID n, but next_uid = m"
	errors.
	[20e6d554d3fe]

	* src/plugins/acl/acl-backend-vfile.c:
	Letter ACLs were wrong.
	[789b586d9015]

2006-04-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync.c:
	And more generic error fix..
	[304e4e4410b9]

	* src/lib-storage/index/dbox/dbox-mail.c, src/lib-storage/index/dbox
	/dbox-sync.c:
	Error fixes
	[c31d7c833d5c]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Fixes
	[dd22380b0fc0]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-uidlist.c:
	Error message fixes
	[81ec8a2fbea9]

	* src/plugins/quota/Makefile.am:
	Install the quota plugin also for POP3.
	[8ac54879ca92]

	* src/pop3/common.h, src/pop3/main.c:
	hook_mail_storage_created: Make it compatible with imap and lda by
	not taking a pointer to pointer to storage.
	[8bf51d76a01d]

	* src/master/mail-process.c:
	Don't validate uid/gid when executing imap for dump-capability
	[58d4413314a4]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Fix
	[8bd6ee717880]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c:
	Fixes / cleanup
	[9cf143e90327]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	More fixes.
	[83322a523c91]

2006-04-25  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log.c,
	src/lib-storage/index/maildir/maildir-uidlist.c, src/lib/nfs-
	workarounds.c, src/lib/nfs-workarounds.h:
	Added nfs_safe_stat() to transparently work around ESTALE with
	stat().
	[abdef9d86a94]

2006-04-24  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/master/master-settings.c:
	dump-capability wasn't working if dovecot wasn't run as root.
	[8736c4deb253]

	* src/plugins/quota/quota-maildir.c:
	Accidentally reverted 0-is-unlimited-quota change in last commit.
	[606144f4e407]

	* src/lib-storage/index/index-search.c:
	Fix for last changes. We didn't handle properly non-sequential
	messageset ranges.
	[b900a7257555]

	* src/lib-index/mail-index-view-sync.c:
	When beginning to sync from old view, don't keep the old header
	completely, because there may have been some important new changes.
	Copy only the message counts and such manually now. Fixes an error
	message when sometimes adding keywords.
	[833f9217c1d6]

	* src/lib-index/mail-index.c:
	Added assert
	[2af75b0379bb]

	* src/lib-index/mail-index-transaction.c:
	Fixed crash while updating keywords (broken by recent changes).
	[53e1edf215e0]

2006-04-22  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	Fixed a buffer overflow if maildirsize was over 5120 bytes long.
	Luckily almost no-one used maildir++ quota yet and the bug is highly
	unlikely to be exploitable anyway.
	[a3f9089faadb]

	* src/master/mail-process.c:
	Fixed last broken commit
	[4d9706112af4]

2006-04-21  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	NFS check should be done only once at startup, not every time.
	[9f8493a8cd65]

2006-04-21  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/quota/quota-maildir.c:
	0 values in maildirsize means unlimited.
	[e7ff0eced559]

2006-04-21  Timo Sirainen  <tss@iki.fi>

	* src/imap/Makefile.am:
	Link mountpoint.o manually to get mountpoint_get() included into
	binary, so quota plugin can use it.
	[46f3a7a3eaef]

	* src/master/mail-process.c:
	If mail environment is "", don't use it.
	[096b5a271614]

	* src/master/mail-process.c:
	Don't crash in NFS check if using mail path autodetection
	[59d5370a330f]

2006-04-20  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-dotlock.c:
	Fixed last change: added missing '/' back
	[044889ec438e]

	* dovecot-example.conf:
	Changed example dovecot-auth-client path also to /var/run/dovecot
	[e53deec5e422]

	* dovecot-example.conf:
	Changed auth-master example socket to /var/run/dovecot/auth-master
	again. Nowadays /var/run/dovecot is world-rx so it's a better place
	for it.
	[ca14a26d28b4]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox/dbox-
	uidlist.c:
	Fixes
	[67f6d3afa5a5]

	* src/lib/file-dotlock.c:
	file_dotlock_get_lock_path() doesn't return the path from data stack
	anymore. Also changed the internal logic to use less data stack as
	well.
	[96f3908b7c34]

	* src/lib/seq-range-array.c:
	Fix for seq_range_array_remove()
	[ec7e56827ea8]

2006-04-20  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/dbox/dbox-mail.c:
	If dbox mail is lost, synchronize the dbox instead of just
	refreshing index (it's not enough).
	[b56fa3e45dba]

2006-04-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	If we sorted appended messages, we weren't sorting extensions and
	keywords so they were mapped to wrong messages (dbox-only problem,
	keywords not yet fixed by this change).
	[9c8a79d36bb0]

	* src/lib-storage/index/dbox/dbox-storage.c:
	Fixed memory leaks
	[4141aae720fe]

2006-04-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-full.c:
	Fixes
	[581b5a12c7b7]

2006-04-18  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/dbox/dbox-sync-full.c:
	Don't assert-crash if first mail is expunged and we're doing a full
	sync.
	[dde86781168f]

2006-04-17  Timo Sirainen  <tss@iki.fi>

	* src/plugins/acl/acl-backend-vfile.c:
	If storage separator is '/', it's possible that we're trying to open
	a directory as an ACL file. If that happens, use dir/.DEFAULT file
	as the ACL file instead.
	[38a5e4396091]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If maildir is readonly, don't complain about rename() failing to
	move mails from new/ to cur/.
	[fa135b615b01]

	* src/lib-storage/index/mbox/mbox-file.c:
	Don't try to call utime() for mbox if it's readonly, it'll just
	fail.
	[def18c75ced2]

2006-04-14  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/imap/main.c, src/login-common/common.h,
	src/login-common/main.c, src/master/login-process.c, src/master
	/mail-process.c, src/master/mail-process.h, src/master/main.c,
	src/master/master-settings.c, src/master/master-settings.h,
	src/pop3-login/client-authenticate.c:
	If we have plugins set and imap_capability unset, figure out the
	IMAP capabilities automatically by running imap binary at startup.
	The generated capability list isn't updated until Dovecot is
	restarted completely, so if you add or remove IMAP plugins you
	should restart.
	[c3ded5b815aa]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-storage/index
	/index-search.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage-private.h:
	Optimized searching a bit for cases where we can restrict search
	range by simply looking at sequence sets. Also optimized some
	deleted/seen flag searches where no results would be found. Added
	search_next_update_seq() virtual method which allows plugins to
	restrict the search range (eg. allowing indexed text search
	plugins).
	[6ac0d63b297f]

	* src/lib/mountpoint.c:
	Clear mountpoint struct even in error cases.
	[a00c5d4915f3]

	* src/lib/mountpoint.c:
	mtab path is /etc/mnttab with Solaris
	[de4609242c8a]

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-sync.c:
	If mailbox was opened with readonly-flag, don't really force it.
	Fixes EXAMINE box + APPEND box.
	[a47df521d4fa]

	* src/plugins/quota/quota-fs.c:
	quotactl() parameters were backwards for BSDs and AIX.
	[26e028337e1e]

	* src/dict/Makefile.am:
	Added RAND_LIBS
	[c75fb8c60672]

	* src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Unless nfs_check=no or mmap_disable=yes, check for the first login
	if the user's index directory exists in NFS mount. If so, refuse to
	run. This is done only on first login to avoid constant extra
	overhead.
	[19fc27f57b0c]

	* src/lib/mountpoint.c:
	memset() the returned structure, just in case.
	[1fb345878e1b]

	* src/plugins/quota/quota-fs.c, src/plugins/quota/quota-fs.h:
	Use mountpoint_get() instead of doing it ourself.
	[a3dc87033d2f]

	* src/lib/Makefile.am, src/lib/mountpoint.c, src/lib/mountpoint.h:
	Added mountpoint_get() for looking up a path's mount point
	information.
	[e6d38617efdf]

	* src/auth/auth-master-listener.c, src/auth/auth-master-listener.h,
	src/auth/main.c:
	Deinitialization crashfixes.
	[f97b4052dd81]

	* src/auth/auth-worker-client.c:
	Don't crash if no extra arguments were given to auth worker request.
	[8cc6595a9b43]

	* src/lib-storage/index/mbox/mbox-storage.c:
	MBOX_MIN_INDEXED_SIZE -> MBOX_MIN_INDEX_SIZE so it actually works
	[1f4114fe2896]

2006-04-13  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c, src/pop3/main.c:
	Destroy client connection at deinit before unloading modules.
	[32b5045f8d80]

	* src/plugins/quota/quota-dirsize.c:
	When using multiple namespaces, don't count each of them if they're
	using the same storage backend.
	[85efed60baef]

	* src/plugins/quota/quota-dirsize.c:
	Count INBOX also if it's outside the default mail directory.
	[b58eedd18662]

	* src/auth/db-ldap.c:
	If LDAP library didn't have ldap_initialize() function, we always
	complained about the URI settings.
	[92b572fbb88a]

	* src/master/mail-process.c:
	pop3_lock_session setting wasn't transferred to pop3 process
	[dc5d40160d1b]

2006-04-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-save.c:
	Crashfix when saving fails before even opening the file
	[cd28396bf83a]

	* src/lib-storage/index/dbox/dbox-storage.c, src/master/mail-
	process.c:
	dbox settings in config file didn't work, and the defaults were also
	a bit broken.
	[4eaaef28cc38]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/dbox/dbox-uidlist.c:
	dbox fixes
	[513aa0df39ee]

	* src/lib-storage/index/dbox/dbox-save.c:
	Truncate dbox file immediately if saving is aborted.
	[c0b27c24c098]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c:
	Removed accidentally committed debugging code
	[ab19d3e38f2d]

	* src/lib/seq-range-array.c:
	seq_range_array_remove(): Don't crash if array is empty.
	[1ba7983b814c]

	* src/lib-storage/index/dbox/Makefile.am, src/lib-storage/index/dbox
	/dbox-format.h, src/lib-storage/index/dbox/dbox-list.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/dbox/dbox-
	storage.h:
	Moved dbox data structures to dbox-format.h which can be easily
	included from elsewhere.
	[8982857c24fa]

	* src/lib-storage/index/dbox/dbox-save.c:
	ftruncate() the file after mail has been appended. We might have
	reused some existing aborted mail in there.
	[b3251beec0d3]

	* src/lib-storage/index/dbox/dbox-storage.c:
	When creating index directories, create also the Mails directory.
	[ca0a649dbb61]

	* src/imap/cmd-append.c:
	Don't crash if client disconnects while appending message.
	[8686345192e8]

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth.c,
	src/auth/auth.h, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added auth_username_format setting.
	[3f27bf7832a2]

	* src/lib/module-dir.c, src/lib/module-dir.h:
	Allow giving module names in non-basename form.
	[32dd28f96dce]

	* NEWS, configure.in:
	And 1.0.beta7..
	[cda5c90cae57]

	* dovecot-example.conf, src/imap/main.c, src/master/mail-process.c,
	src/master/master-settings.c, src/master/master-settings.h,
	src/pop3/main.c:
	Added shutdown_clients setting to control if existing imap/pop3
	processes should be killed when master is.
	[773c4becceae]

	* src/auth/auth-request.c:
	Master login fixes, PLAIN authentication was still broken..
	[d38dd6312be1]

	* NEWS, TODO, configure.in:
	Released 1.0.beta6.
	[be4b893275a8]

	* doc/variables.txt, src/lib/var-expand.c:
	%M modifier returns string's MD5 sum. Patch by Ben Winslow
	[baa2f72e4010]

	* src/pop3-login/client.c:
	Add a space between POP3 greeting and APOP challenge
	[147d53a049ee]

	* src/lib/var-expand.c:
	%U modifier was actually lowercasing the string. Patch by Ben
	Winslow
	[86fa00c163dc]

2006-04-10  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	And add -lm also to LIBS when checking if -lmysqlclient works..
	[22bc42a33b79]

	* configure.in:
	libmysqlclient needs also -lm
	[f1cd4665f82d]

	* INSTALL:
	Updated GNUTLS information.
	[ed7d77a89b17]

2006-04-09  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-notify-dn.c:
	Make sure errno is restored when exiting SIGRT signal handler.
	[d39ac5712d2e]

	* src/auth/passdb-ldap.c:
	Fixed non-plaintext password lookups from LDAP. Patch by Lior Okman.
	[cf02b2fbcb7a]

	* src/lib-storage/index/mbox/mbox-lock.c:
	fcntl locking: Don't print error if we're only trying to lock
	(instead of waiting) and it failed.
	[7a4c7a12da9e]

	* dovecot-example.conf, src/master/master-settings.c, src/master
	/master-settings.h, src/pop3/client.c, src/pop3/common.h,
	src/pop3/main.c:
	Added pop3_lock_session setting.
	[690c72358cd5]

	* src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/index/mbox/mbox-storage.h, src/lib-storage/mail-
	storage.h:
	Added MAILBOX_OPEN_KEEP_LOCKED flag to mailbox opening and
	implemented it for mbox and maildir. It keeps the mailbox locked the
	whole time until mailbox_close() is called.
	[e2edd333c473]

	* src/plugins/quota/quota-fs.c:
	Fixed calculation overflows
	[2e418435b460]

	* src/lib/ioloop.h:
	IO_ERROR and IO_NOTIFY had conflicting values.
	[49e024519e22]

	* src/imap/main.c, src/pop3/main.c:
	When master dies (by closing log file descriptor), kill ourself
	also.
	[b10fa8ba01ca]

	* src/master/auth-process.c, src/master/login-process.c:
	If master process runs out of file descriptors, try to handle it
	more nicely than getting into infinite loop.
	[f60d73c96618]

	* src/master/mail-process.c:
	If %h is used but home directory isn't given by userdb, use
	"/HOME_DIRECTORY_USED_BUT_NOT_GIVEN_BY_USERDB" as the home
	directory.
	[674f328d5fdd]

	* src/auth/auth-request.c, src/auth/userdb-prefetch.c:
	Allow prefetch userdb to exist nicely with other userdbs.
	[bdf68bc43354]

	* dovecot-example.conf:
	Updated mechanism list. Added link to MasterPassword in wiki.
	[469a60254c79]

	* configure.in:
	Unbreak last sqlite change
	[13665379afa8]

	* configure.in:
	Print the SQL drivers we're building.
	[c2ae6dc37a19]

	* configure.in:
	Added lib64 directory to mysql/pgsql checks. Removed all special
	lib/include directory handling from SQLite checks (it should usually
	exist in default paths I think).
	[08aef9a8e22c]

	* configure.in:
	SQLite include/libdir fixing
	[4a023bede75e]

	* src/auth/auth-request.c:
	The login and master usernames were reversed when using
	master_user_separator (now the order is UW-IMAP compatible).
	[52a2e6f35acf]

	* src/auth/auth-request.c:
	Master login attempts weren't logged if no master passdbs were
	defined.
	[68c2ad5e4f85]

	* src/master/main.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added -a and -n parameters to dovecot to dump all/nondefault
	settings. A bit ugly code, but it'll do until the whole config
	handling gets rewritten in Dovecot 2.0.
	[f9a6381adbe3]

	* src/auth/db-passwd-file.c:
	Don't crash if passwd-file has entries without passwords.
	[1cbaed584eb8]

2006-04-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	If master login username is the same as the normal username, we
	don't want to treat it as master user. Fixes authentication with
	some clients.
	[f7731e6eec7e]

2006-04-07  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth.c:
	auth_verbose_debug_passwords=yes always sets now
	auth_verbose_debug=yes, and auth_verbose_debug=yes also sets
	auth_verbose=yes.
	[c942211332a5]

2006-04-06  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/quota/quota-maildir.c:
	Fixes. Added storage and messages parameters to quota plugin
	parameter. If given, they specify the master quota limits, so if
	maildirsize has different limits Dovecot will replace them. If
	maildirsize doesn't exist and Dovecot doesn't have limits, Maildir++
	quota is disabled for the user.
	[8a61b892bd60]

2006-04-06  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-maildir.c:
	Return value of get_resource() was wrong, which caused quota
	reporting not to work.
	[80eeec535031]

2006-04-04  Timo Sirainen  <tss@iki.fi>

	* NEWS, TODO, configure.in:
	1.0.beta5 released
	[66d6fd7c368e]

	* src/login-common/ssl-proxy-openssl.c:
	Reverted back for now.
	[c12bb541f925]

2006-04-02  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-fs.c:
	stat() the mount point paths instead of the devices to find out
	where the mount point is.
	[f309f5d124dc]

	* NEWS:
	update
	[632b3117aecc]

	* NEWS, TODO, configure.in:
	1.0.beta4 released
	[9198a457f022]

	* src/login-common/ssl-proxy-openssl.c:
	Rewrite. Hopefully works better.
	[60583fb75d9e]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If mailbox is opened in non-readonly state and there are mails in
	new/, make sure they get moved to cur/ so that their recent-state
	gets removed.
	[63d6890803b3]

	* src/pop3-login/client.c:
	Same STARTTLS flush callback fix as with imap-login.
	[5071c561c455]

	* src/imap-login/client.c:
	Output flush handler wasn't unset after STARTTLS, which could have
	caused STARTTLS to be done again (it was unlikely to be ever set
	though).
	[e65a7848e9e4]

	* src/login-common/login-proxy.c:
	Show client IP properly also with SSL connections.
	[8df011c2cdc4]

	* src/lib/ostream-file.c:
	If output flush callback closed the stream, don't add another flush
	I/O handler to it even if there would still be something to flush.
	[9e5af78ea530]

	* src/deliver/deliver.c:
	Use mail_storage_parse_env(), even though this code doesn't even
	compile now..
	[f63ff46276a8]

	* dovecot-example.conf, src/lib-storage/mail-storage.c, src/master
	/master-settings.c:
	Changed the default lock_method back to fcntl. flock seems to be
	broken in some systems..
	[c9afd13cf2d5]

2006-04-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-list.c:
	Hide also "." and ".." when listing mboxes
	[162d643ee89b]

	* dovecot-example.conf, src/master/master-settings.c,
	src/pop3/client.c:
	Replaced %T and %R with %p and %b. %R was already used by string-
	reversion, so uppercase letters should now be reserved for modifiers
	to avoid this in future..
	[b66da5c1a94b]

	* src/lib-storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-storage.h:
	Don't hide all .files when listing mboxes, only .imap and
	.subscriptions. Moved the hardcoded ".imap" strings into a define.
	[273ae8a1a58a]

	* src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h:
	When deleting a maildir, rename it to ..DOVECOT-TRASHED, and assume
	only that directory to be safe to be deleted, instead of all ..dirs.
	When deleting maildir with absolute path, don't do renaming at all
	but delete it directly.
	[9d95aad9e9a7]

	* src/lib-storage/index/mbox/mbox-lock.c:
	If we can't lock mbox file, mark those errors as temporary so LDA
	treats them as temporary errors instead of bouncing.
	[d358e0f0fd18]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-storage.h, src/lib-storage/index/dbox/dbox-sync-expunge.c, src
	/lib-storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox
	/dbox-uidlist.c, src/lib-storage/index/dbox/dbox-uidlist.h:
	Fixes and cleanups.
	[d1c27abc6ebc]

	* src/lib/file-dotlock.c:
	Added some t_push/t_pop calls
	[770c06dc9adb]

	* src/lib/seq-range-array.c:
	Removal didn't work properly from beginning/end if the range
	contained only a single sequence.
	[d7e169797e3e]

2006-03-31  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-passwd-file.c:
	Don't break if password contains '[' characters.
	[07ee079dcf0d]

	* src/lib-index/mail-cache-fields.c:
	Don't crash with "can't allocate 0 bytes of memory" if there are
	zero fields in cache file.
	[9662de8fc649]

2006-03-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox/dbox-
	sync.h, src/lib-storage/index/dbox/dbox-uidlist.c:
	Some fixes to get dbox code working better. Still needs some work
	though..
	[988a8ef1deea]

2006-03-27  Timo Sirainen  <timo.sirainen@movial.fi>

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth.c,
	src/auth/auth.h, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added auth_master_user_separator setting which allows giving the
	master username inside the normal username.
	[e1774d677536]

2006-03-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c:
	Keep \Seen flags privately only in indexes with shared mailboxes.
	[d29677c59dc5]

	* src/lib-storage/index/maildir/maildir-save.c:
	Saving (or copying) multiple mails at a time caused all but the
	first mail to be left to tmp/.
	[c4bdc1b1aac5]

	* src/auth/auth.c:
	Changed "no user databases" error to be hopefully more easier to
	understand.
	[085bffbdd1b1]

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth.c,
	src/auth/auth.h, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Removed master_no_passdb setting. Added pass setting which can be
	used to do the same thing, and other things. Now setting pass=yes to
	a passdb continues to next passdb if the lookup succeeded. This
	allows eg. requiring the user to be in multiple passdbs, or doing a
	username conversion before running the actual userdb, etc.
	[77e10f1d2cb2]

	* src/auth/db-passwd-file.c, src/auth/db-passwd-file.h:
	Allow empty uid/gid fields, they're required if we want to set extra
	fields for passdb. Also removed some unused code.
	[25204e1faeb6]

	* src/lib/ioloop.c:
	Timers weren't called always properly when they should have.
	[99b17f13cc1e]

	* configure.in, src/lib/randgen.c:
	If /dev/urandom didn't exist and we used OpenSSL's random number
	generator, it wasn't seeded properly at startup. Patch by Vilmos
	Nebehaj.
	[321469dcb8fb]

	* src/lib/ioloop-kqueue.c:
	Added more debugging information for handling unexpected events.
	Patch by Václav Haisman
	[ffbcfa5791e6]

2006-03-07  Timo Sirainen  <timo.sirainen@movial.fi>

	* doc/auth-protocol.txt:
	Fixed outdated information: ssl-valid-cert -> valid-client-cert
	[0c11f0b05e19]

2006-03-06  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Added ACL plugin comments and updated quota comments.
	[59883de6c516]

	* src/plugins/acl/acl-backend-vfile.c:
	Global ACL dir is now optional.
	[8d37f7d2ec40]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-idle.c, src/imap/cmd-logout.c, src/pop3/client.c,
	src/pop3/client.h, src/pop3/commands.c:
	Log a line when IMAP client disconnects with a reason why it
	happened. Changed the reason strings also a bit with POP3.
	[904c53275e83]

	* src/imap/cmd-idle.c:
	cleanup
	[2fe0d3ab89c9]

2006-03-06  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.h:
	Support accessing saved mails that haven't been committed yet (fixes
	quota for maildir).
	[03e14e3a4610]

	* src/plugins/quota/quota-maildir.c:
	Fixes to updating maildirsize.
	[840d6403ef09]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/maildir/maildir-transaction.c:
	Merged save-copying and hardlink-copying code so that hardlink-
	copying updates indexes immediately.
	[ae38c59ddf60]

	* src/lib-storage/index/maildir/maildir-util.c:
	If maildir_do() failed with "racing" error, return -1.
	[f4cd3e942678]

	* src/imap/cmd-copy.c:
	mailbox_copy() might fail because mail was expunged. Treat that case
	differently.
	[1a526a5017f4]

	* src/imap/namespace.c:
	Add MAIL_STORAGE_FLAG_SHARED_NAMESPACE for private namespaces.
	[029dd4ab2765]

	* src/lib-storage/index/maildir/maildir-mail.c:
	Cleanup
	[43a03c8a6f01]

	* src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-fs.c,
	src/plugins/quota/quota-maildir.c, src/plugins/quota/quota-
	private.h, src/plugins/quota/quota.c:
	Cleanups.
	[61fc347bcceb]

	* src/plugins/quota/Makefile.am, src/plugins/quota/quota-dict.c,
	src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-
	maildir.c, src/plugins/quota/quota-private.h,
	src/plugins/quota/quota.c:
	Maildir++ quota support.
	[07c3a801c3dc]

2006-03-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c:
	Added t_push/t_pop
	[cce51b1b5d00]

2006-03-01  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/imap-quota/imap-quota-plugin.c, src/plugins/quota/quota-
	dict.c, src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-
	fs.c, src/plugins/quota/quota-plugin.c, src/plugins/quota/quota-
	private.h, src/plugins/quota/quota-storage.c,
	src/plugins/quota/quota.c, src/plugins/quota/quota.h,
	src/plugins/trash/trash-plugin.c:
	Quota API redesign. Still not perfect, but better than before. Quota
	backends no longer need to be told where the mails exist. fs backend
	doesn't work correctly with multiple partitions (if you've multiple
	namespaces).
	[51306837698b]

2006-02-28  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/plugins/acl/acl-api-private.h, src/plugins/acl/acl-api.c,
	src/plugins/acl/acl-backend-vfile.c, src/plugins/acl/acl-backend.c,
	src/plugins/acl/acl-cache.c, src/plugins/acl/acl-cache.h,
	src/plugins/acl/acl-storage.c:
	Don't keep acl_objects permanently in memory. Moved cache validity
	information into cache records. Some other cleanups and fixes.
	[ed4f01bb4701]

	* configure.in, src/plugins/Makefile.am:
	Added acl.
	[dcee3dadef51]

2006-02-28  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Added link to QuickConfiguration.
	[81d56edc16c8]

	* dovecot-example.conf:
	Added notes about changing ports and about /etc/pam.d/dovecot
	[89c94b5ac90e]

	* Makefile.am:
	Removed dovecot.spec*
	[b033db13c2e0]

2006-02-27  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/auth/auth-request.c, src/auth/auth-request.h:
	Added "allow_nets" extra field. If set, the user can log in only
	from within the given networks (hope the code is correct...)
	[265655f270df]

	* src/plugins/acl/.cvsignore, src/plugins/acl/Makefile.am,
	src/plugins/acl/acl-api-private.h, src/plugins/acl/acl-api.c,
	src/plugins/acl/acl-api.h, src/plugins/acl/acl-backend-vfile.c,
	src/plugins/acl/acl-backend.c, src/plugins/acl/acl-cache.c,
	src/plugins/acl/acl-cache.h, src/plugins/acl/acl-mailbox.c,
	src/plugins/acl/acl-plugin.c, src/plugins/acl/acl-plugin.h,
	src/plugins/acl/acl-storage.c:
	Added initial support for ACLs. Currently supports reading the ACLs
	from files. Since no proper support for shared folders exist yet,
	this is mostly intended to be used only for preventing users from
	fully accessing the mailboxes they'd otherwise have full access to.
	It anyway does support "master user" having different ACLs to
	mailboxes.
	[73573b9ecb00]

	* src/lib-storage/index/dbox/dbox-list.c, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/mbox
	/mbox-list.c, src/lib-storage/mail-storage-private.h, src/lib-
	storage/mail-storage.h:
	Moved mailbox_list_flags to struct mailbox_list_context so plugins
	can see the flags more easily.
	[7f48190f868f]

	* src/lib/strfuncs.c, src/lib/strfuncs.h:
	Added strcmp_p and bsearch_strcmp.
	[bd7aafc736eb]

2006-02-26  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/auth/password-scheme.c, src/dict/main.c,
	src/imap/main.c, src/lib/module-dir.c, src/lib/module-dir.h,
	src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h, src/pop3/main.c:
	Replaced mail_use_modules and mail_modules settings with
	mail_plugins and mail_plugin_dir. Now instead of loading all plugins
	from the directory, you'll have to give a list of plugins to load.
	If the plugin couldn't be loaded, the process exits instead of just
	ignoring the problem (this is important with ACL plugin).
	[dadc6e2cccb8]

	* src/imap/imap-fetch-body.c, src/imap/imap-fetch.c, src/imap/imap-
	fetch.h, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/index-sync.c, src/lib-
	storage/index/maildir/maildir-keywords.c:
	Memory leak fixes
	[cd701884900c]

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log.c,
	src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-storage
	/subscription-file/subscription-file.c:
	If we reach the NFS_ESTALE_RETRY_COUNT, give an ESTALE error message
	as well.
	[7e6acdd8d18d]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/subscription-file/subscription-
	file.c, src/lib/Makefile.am, src/lib/nfs-workarounds.c, src/lib/nfs-
	workarounds.h, src/lib/safe-open.c, src/lib/safe-open.h:
	Renamed safe-open.* to nfs-workarounds.*, safe_open() to
	nfs_safe_open() and added a new global NFS_ESTALE_RETRY_COUNT which
	everyone uses instead of defining their own.
	[cd3d26cf124a]

	* src/auth/auth-master-connection.c, src/auth/auth-worker-server.c,
	src/auth/db-passwd-file.c, src/deliver/deliver.c, src/dict/dict-
	server.c, src/imap/client.c, src/lib-dict/dict-client.c, src/lib-
	dict/dict-sql.c, src/lib-imap/imap-bodystructure.c, src/lib-imap
	/imap-envelope.c, src/lib-index/mail-cache-compress.c, src/lib-mail
	/message-body-search.c, src/lib-settings/settings.c, src/lib-
	storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox/dbox-
	sync-expunge.c, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/index-mail-headers.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/mbox/mbox-file.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/subscription-file/subscription-file.c, src/lib/istream.c,
	src/lib/istream.h, src/lib/ostream.c, src/lib/ostream.h, src/login-
	common/login-proxy.c, src/login-common/master.c, src/master/auth-
	process.c, src/master/log.c, src/plugins/trash/trash-plugin.c,
	src/pop3/client.c, src/util/rawlog.c:
	Added i_stream_destroy() and o_stream_destroy() and used them
	instead of
	*_stream_unref() where possible. Fixes at least one problem with
	io_remove() being called after socket was closed, which caused
	problems with epoll.
	[71b8faa84ec6]

2006-02-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/driver-mysql.c:
	If connecting with UNIX socket, print the UNIX socket path instead
	of (null).
	[d6c15318e730]

	* configure.in, dovecot.spec.in:
	Removed dovecot.spec. It's not being kept up-to-date anyway and it's
	probably broken for half the rpm based distributions.
	[1f319d46f0dd]

	* src/lib-index/mail-index.c:
	mail_index_open(): If index is already open, return 1 instead of 0
	so the caller won't think it failed..
	[96ae9c096bde]

	* src/plugins/quota/quota-fs.c:
	Compiler warning fix
	[30ad1815cf1e]

	* configure.in:
	One more Q_QUOTACTL check fix..
	[a3090ba7429c]

	* configure.in:
	And fix for Q_QUOTACTL check..
	[f3e7ee9630d0]

	* configure.in, src/plugins/quota/quota-fs.c, src/plugins/quota/quota-
	fs.h:
	Support Solaris's ioctl(Q_QUOTACTL).
	[f60237ad2edd]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-search.c:
	Last memory leak fix actually started crashing.
	[788f5caab763]

2006-02-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-keywords.c, src/lib-storage/index/dbox/dbox-sync-expunge.c,
	src/lib-storage/index/dbox/dbox-sync.c:
	Fixes
	[1197d5a84bee]

	* src/plugins/quota/quota-fs.c:
	Added comment
	[4158edcd2bf2]

	* src/plugins/quota/quota-fs.c:
	Define MNTTYPE_SWAP and MNTTYPE_IGNORE ourself if they're not
	defined.
	[7bac8d6bf26d]

	* src/auth/mycrypt.c:
	Fixed AIX compile
	[b1fa11d4a346]

	* configure.in:
	Unbreak last accidental change..
	[f4807accc1d5]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-mail.c, src/lib-storage/index/dbox/dbox-storage.h, src/lib-
	storage/index/dbox/dbox-sync-expunge.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/dbox/dbox-uidlist.c:
	Fixes
	[caddc57d1f61]

	* configure.in:
	If size_t and ssize_t exist but we can't figure out their type,
	don't redefine them.
	[f7ff79c3189b]

	* src/auth/auth-request.c, src/auth/auth-request.h:
	Digest-MD5 logins didn't work if passdb changed username.
	[f83d7d14b999]

	* src/lib-index/mail-index.c:
	If transaction log opening fails, don't crash when trying to move it
	to memory.
	[94b3363165c8]

	* src/lib-index/mail-index-sync.c:
	Crashfix
	[ba8185cce4d4]

	* src/auth/passdb.h:
	And one more comma removal
	[af596f6df432]

	* configure.in, src/plugins/quota/quota-fs.h:
	configure was actually checking always only sys/quota.h. Also added
	jfs/quota.h check for AIX.
	[41cb3921d869]

	* configure.in:
	Don't print error if pkg-config isn't found.
	[2fa6dc0e0e27]

	* src/auth/auth-client-interface.h, src/lib-auth/auth-client.h:
	More comma removals
	[9e2a96d7e9ae]

	* src/lib-ntlm/ntlm-types.h, src/lib-sql/sql-api.h:
	Removed extra commas from end of enum lists.
	[20e742b83a79]

	* src/auth/mech-digest-md5.c:
	If no realms are given in configuration file, advertise an empty
	realm. Also if realms are given and client sends an invalid realm,
	write the realm to log.
	[29afb0f7665f]

2006-02-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index-view-
	sync.c, src/lib-storage/index/index-search.c:
	Memory leak fixes
	[5819e0190400]

2006-02-22  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/imap/cmd-append.c, src/lib-storage/index/dbox/dbox-save.c, src
	/lib-storage/index/dbox/dbox-storage.h, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.h, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/mail-copy.c, src
	/lib-storage/mail-storage-private.h, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h, src/plugins/quota/quota-dict.c,
	src/plugins/quota/quota-dirsize.c, src/plugins/quota/quota-fs.c,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota-
	storage.c, src/plugins/quota/quota.c, src/plugins/quota/quota.h:
	mailbox_save_init() supports now returning failure. Quota plugin now
	checks if mail is too large in mailbox_save_init() hook. APPEND
	fails before giving "+ OK" reply if mailbox_save_init() failed.

	Also fixed some APPEND failure cases where the next command was
	eaten away.
	[da1d65e064f8]

	* src/lib/module-dir.c:
	Modules were loaded in inverse order..
	[ec4061662609]

	* src/auth/auth-request.c:
	Multiple password database error prints now the passdb name that
	caused it.
	[dabe100f3c38]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/lib-
	storage/index/dbox/dbox-list.c, src/lib-storage/index/dbox/dbox-
	storage.c, src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-list.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/plugins/convert/convert-storage.c,
	src/plugins/quota/quota-plugin.c, src/plugins/zlib/zlib-plugin.c:
	Make life easier for plugins:
	 - Added MAILBOX_OPEN_SAVEONLY flag for mailbox_open(), which is set
	when mailbox is opened only for append/copy
	 - Added a couple of MAIL_STORAGE_ERR_* string defines that should be
	used when giving visible errors to clients
	 - Added failed-flag for mailbox_list_context, which plugins can
	directly set to make mail_storage_mailbox_list_deinit() return
	failure
	 - Added mail_storage_get_mailbox_path() and
	mail_storage_get_mailbox_control_dir() to return locations for
	mailbox directories

	Also be more strict when validating mailbox names.
	[9d7420b0e1ef]

	* src/auth/auth-worker-client.c:
	Fixed passdb credential lookups to work again with blocking passdbs.
	[c0d093d8b8e5]

2006-02-22  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop.h:
	Removed extra comma at end of enum list
	[fcd4c3281559]

2006-02-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-sync.c:
	Update message_count only after expunge sends are finished or we'll
	get to infinite loop (broken in last commit).
	[6d80874fd704]

	* src/login-common/login-proxy.c:
	and fix for last cleanup..
	[3531cc5270b5]

	* src/login-common/login-proxy.c:
	Minor cleanups
	[bb6a724a3396]

	* src/auth/db-passwd-file.c, src/auth/db-passwd-file.h, src/auth
	/passdb-passwd-file.c, src/auth/userdb-passwd-file.c:
	If passwd-file is being used as userdb, complain immediately if some
	entries don't have userdb information. Also some other cleanups and
	crashfix for today's earlier changes.
	[335ac59efffd]

2006-02-20  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/auth/db-passwd-file.c, src/auth/db-passwd-file.h, src/auth
	/passdb-passwd-file.c, src/auth/userdb-passwd-file.c:
	Updated passwd-file format to allow specifying any key=value fields.
	Since the value fields may contain ':' characters, this changes the
	file format a bit. Previously the last two fields were "flags" and
	"mail". Flags has been empty for last 3 years however, so the new
	format is used if the flags field contains something. In that case
	there is no separate mail field, it can instead be specified by
	adding userdb_mail=<mail> parameter.
	[b533c52196e3]

	* src/auth/auth-request.h:
	Added comment
	[7dbfff239206]

	* src/auth/checkpassword-reply.c, src/auth/passdb-checkpassword.c:
	Allow checkpassword program to send extra parameters to Dovecot.
	EXTRA environment contains a list of environment variables that are
	passed to Dovecot.
	[7140f09b464f]

	* src/auth/passdb-checkpassword.c:
	Pass LOCAL_IP, REMOTE_IP, SERVICE and MASTER_USER in environment to
	checkpassword.
	[357175e274b4]

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth-
	request.h, src/auth/auth-worker-client.c, src/auth/auth.c,
	src/auth/auth.h, src/auth/mech-plain.c, src/auth/passdb-blocking.c,
	src/auth/passdb.c, src/auth/passdb.h, src/master/auth-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added support for "master users" who can log in as other people.
	Currently works only with SASL PLAIN authentication by giving it
	authorization ID string.
	[faf83f3e19b5]

2006-02-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-storage.c:
	s/Maildir/dbox/
	[9bdd186d7b7d]

	* src/lib-storage/index/dbox/dbox-storage.c:
	Fixed dbox autodetection and removed unused code.
	[513318832fb6]

	* src/lib-imap/imap-bodystructure.c:
	BODYSTRUCTURE -> BODY conversion was broken with mails containing
	message/rfc822 parts.
	[0e7a9b0aa8c3]

2006-02-18  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index.c:
	Added some locking related asserts, comments and when replacing
	index file, open it immediately into memory (seemed to work before
	too, though).
	[20c335412d7d]

2006-02-17  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-storage/index/index-mail.c:
	Fetching BODY/BODYSTRUCTURE with header fields caused Dovecot to
	unneededly open the mails and parse their headers, if everything was
	already in cache.
	[d4c02d132a32]

	* src/imap/cmd-append.c:
	If client disconnected or gave too long APPEND command line, we
	didn't properly deinitialize saving, which could have caused
	partially written mails with mbox, or files left lying in tmp/ with
	maildir.
	[7d7b0f427d68]

2006-02-16  Timo Sirainen  <timo.sirainen@movial.fi>

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-private.h, src
	/lib-index/mail-index-sync-keywords.c, src/lib-index/mail-index-
	view.c, src/lib-index/mail-index.c, src/lib-index/mail-transaction-
	log.c, src/lib-storage/index/maildir/maildir-keywords.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-storage
	/subscription-file/subscription-file.c, src/lib/Makefile.am, src/lib
	/file-cache.c, src/lib/safe-open.c, src/lib/safe-open.h:
	Try to handle ESTALE NFS errors the best way we can.
	[b19ccbaa3802]

2006-02-16  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Removed -Wstrict-aliasing=2 since it gives errors with older gccs
	[2f26567685ff]

2006-02-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	Allow creating mailbox names with '*' and '%' characters. They don't
	break anything anyway.
	[d7d87f1de71d]

2006-02-14  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-ntlm.c, src/auth/mech-rpa.c, src/imap/imap-sort.c, src
	/lib-index/mail-cache-fields.c, src/lib-index/mail-index-sync-
	update.c, src/lib-ntlm/ntlm-byteorder.h, src/lib-ntlm/ntlm-
	message.c, src/lib-storage/index/dbox/dbox-file.c, src/lib/buffer.c,
	src/lib/module-dir.c, src/lib/write-full.c:
	While casting const pointers to something else, the const was often
	unneededly dropped out in the middle of casts.
	[fcfd44f56b04]

	* src/imap-login/client.h, src/lib-index/mail-index-private.h,
	src/pop3-login/client.h:
	Removed duplicated function declarations.
	[19dad76ef68d]

	* configure.in, src/lib/fd-close-on-exec.c, src/lib/network.c:
	Enable -Wstrict-aliasing=2 warning and fixed a couple of warnings it
	gave.
	[989dd95aa8b9]

	* src/auth/auth-request.c, src/auth/auth-stream.c, src/auth/passdb-
	ldap.c, src/auth/passdb-sql.c, src/auth/userdb-ldap.c, src/auth
	/userdb-sql.c, src/auth/userdb-static.c, src/master/mail-process.c:
	Check that we don't pass around key=value pairs with empty keys.
	[e2d267e6f930]

	* src/lib/env-util.c:
	Out of memory may not be the only reason putenv() fails. In OSX it
	seems to fail if "=value" is given.
	[0d3dd32999a0]

	* src/imap/main.c:
	PREAUTH banner should show the capability from capability_string in
	case some plugins had changed that already.
	[4aeb58dc4f18]

	* src/plugins/convert/Makefile.am:
	Fixed installing
	[f406248b1b9f]

	* configure.in:
	Added --with-sql option to build with SQL userdb/passdb but without
	any built-in SQL drivers.
	[bf0357107349]

2006-02-14  Timo Sirainen  <timo.sirainen@movial.fi>

	* configure.in:
	Building with SQL support replaced passdb list with userdbs.
	[d8c1e641b435]

	* src/lib/Makefile.am, src/lib/close-keep-errno.c, src/lib/close-keep-
	errno.h, src/lib/network.c, src/lib/unlink-directory.c:
	Moved dupliated close_save_errno() code to public close_keep_errno()
	function.
	[323c09be5f00]

	* dovecot-example.conf, src/lib-storage/index/mbox/mbox-lock.c,
	src/master/master-settings.c:
	Updated mbox_dotlock_change_timeout default value to 120. Also the
	mbox default timeout values were wrong when not starting Dovecot via
	master process.
	[6519f3c7bd63]

	* src/imap/mail-storage-callbacks.c:
	Flush the output while writing the "will override lock file"
	messages, so that the output will actually be sent instead of just
	left in buffer.
	[fbff841d532a]

2006-02-13  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-sync.c:
	Don't notify client about changes in messages it hasn't yet even
	been notified about.
	[4e1a816a82a1]

2006-02-12  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-ldap.conf:
	Added uris setting.
	[97a328354a13]

	* src/auth/db-ldap.c:
	Check that uris and hosts settings are correct.
	[0e8f0647504b]

	* configure.in:
	Give error if --with-storages or --without-storages is used without
	parameters. Assume --with-sql-drivers means all drivers are wanted.
	[450ee12c2e26]

	* src/auth/mech-gssapi.c:
	Crashfix. Patch by Mark Davies
	[10d1c3301b87]

2006-02-11  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	When using --exec-mail, don't care if protocols line is empty.
	[de08c05c75cb]

2006-02-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/Makefile.am:
	Still wasn't working with Solaris shell. Fix by Chris Wakelin
	[5ca67bbe93fd]

	* src/lib/ioloop-epoll.c:
	Fix by Jakob Hirsch
	[ebda90c2b911]

2006-02-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/Makefile.am:
	Some shells don't like empty for loops
	[421d844e884d]

	* src/lib-index/mail-cache-fields.c:
	Don't register cache fields twice. Fixes "duplicate field in header"
	errors.
	[f1e29736e60d]

	* src/lib-index/mail-index-sync.c:
	Ignore if cache compression fails.
	[9d1bb677c5ca]

	* configure.in, src/plugins/Makefile.am,
	src/plugins/convert/Makefile.am:
	Build fixes
	[e7df415a97f1]

	* NEWS:
	Updated
	[cbca2fc5ca97]

	* TODO, configure.in:
	1.0beta3 released.
	[becee8ae64a6]

2006-02-07  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-pam.c:
	Call io_remove() earlier.
	[198ad9bf81d2]

	* src/plugins/imap-quota/imap-quota-plugin.c:
	Advertise the QUOTA capability if the plugin is loaded.
	[12ff7067ce62]

	* src/master/ssl-init-main.c:
	Fix building without ssl support
	[04958ae9a2e3]

	* src/lib/module-dir.c:
	Fix to comparing plugin names which begin with "lib".
	[0c26c7f25b9c]

	* src/lib-dict/dict-client.c:
	LF wasn't sent at the end of all commands.
	[e2e6919c6c4d]

2006-02-05  Timo Sirainen  <tss@iki.fi>

	* src/master/.cvsignore, src/master/Makefile.am, src/master/common.h,
	src/master/main.c, src/master/ssl-init-main.c, src/master/ssl-
	init.c, src/master/ssl-init.h:
	Added ssl-build-param binary to build the ssl-parameters.dat. This
	way dovecot master binary doesn't anymore need to be linked with SSL
	libraries, and the process title is also clearer.
	[e93e39326ae1]

	* src/lib/module-dir.c, src/lib/module-dir.h:
	Added module_dir_deinit().
	[ab1a0a377851]

	* src/lib/ioloop.c:
	Don't crash if we couldn't add I/O notifier.
	[9099825aac9a]

	* src/pop3-login/client-authenticate.c:
	cleanup
	[dd389a881380]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-uidlist.c:
	Dotlock fixes
	[38c352bb7bb7]

	* src/lib-storage/index/dbox/dbox-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	Limit maximum mailbox name length while creating them.
	[882ec6cc5970]

	* src/plugins/convert/convert-storage.c:
	Call file_dotlock_touch() once in a while so other process won't
	override the conversion lock.
	[565e3040a9f5]

	* src/lib/file-dotlock.c, src/lib/file-dotlock.h:
	Added file_dotlock_touch() for updating lock file's timestamp.
	[15c48c43cc75]

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache.c, src
	/lib-index/mail-transaction-log.c, src/lib-storage/index/dbox/dbox-
	sync.c, src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/mbox/mbox-lock.c, src/lib-storage/subscription-file
	/subscription-file.c, src/lib/file-dotlock.c, src/lib/file-
	dotlock.h, src/plugins/convert/convert-storage.c:
	Removed immediate_stale_timeout and changed the stale_timeout
	behavior to check both dotlock and the file it protects, and
	overwrite the lock file whenever neither of them have been modified
	for stale_timeout seconds (ie. also immediately if their timestamps
	are old enough).
	[0d64f8888dcd]

	* src/lib-storage/index/dbox/dbox-file.c:
	Don't break if keyword_count is for some reason 0 in dbox file.
	[90638cc0d4e4]

	* src/lib-storage/index/index-sync.c:
	Keyword comparing still didn't work perfectly when there were no
	keywords. This caused some extra unnecessary keyword changes.
	[f209b3fc77e4]

	* src/auth/passdb-pam.c:
	If error message from PAM was over ~500 bytes, we crashed. Probably
	never happened. Also use PIPE_BUF instead of hardcoded 512 bytes.
	[6f21ccb60df4]

	* src/imap/imap-sort.c:
	Minor cleanup / comment update
	[dcd4e8ccd639]

2006-02-02  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Updated plugin section
	[7272c083dca8]

	* dovecot-example.conf, src/master/dict-process.c, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added plugin {} section to dovecot.conf for passing extra
	environment variables to mail processes.
	[9de8bce1077e]

	* src/plugins/convert/Makefile.am:
	Forgot to add
	[10db5f23d3f0]

	* src/plugins/convert/convert-storage.c:
	And a few fixes
	[fec2e36ddb3b]

	* configure.in, src/plugins/convert/.cvsignore, src/plugins/convert
	/convert-plugin.c, src/plugins/convert/convert-plugin.h,
	src/plugins/convert/convert-storage.c, src/plugins/convert/convert-
	storage.h, src/plugins/convert/convert-tool.c:
	Added "mail storage conversion" plugin. It can be used with IMAP,
	POP3 and/or LDA to convert one complete mail storage to another
	format. Also included a convert-tool command line tool to do it
	manually. Currently doesn't support preserving UID/UIDVALIDITY.
	[a506ee4ec31e]

	* src/imap/namespace.c, src/lib-storage/mail-storage.c, src/lib-
	storage/mail-storage.h, src/pop3/main.c:
	Moved mailbox flag and lock method parsing to lib-storage.
	[539a58176e7b]

	* src/imap/cmd-search.c, src/imap/imap-expunge.c, src/pop3/client.c:
	Don't bother checking if mailbox_search_init() returns NULL. It
	never does.
	[23e76fc59a35]

	* configure.in, src/plugins/Makefile.am:
	If zlib.h isn't found, don't try to build the zlib plugin.
	[884da753caba]

2006-01-31  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-save.c:
	Write keywords when appending mails.
	[93449dc37434]

	* src/dict/Makefile.am, src/dict/dict-cache.c, src/dict/dict-cache.h,
	src/dict/dict-server.c, src/dict/main.c, src/lib-dict/dict-client.c,
	src/lib-dict/dict-private.h, src/lib-dict/dict-sql.c, src/lib-
	dict/dict.c, src/lib-dict/dict.h, src/plugins/quota/quota-dict.c,
	src/plugins/quota/quota.c:
	Dictionary takes now a username parameter, which is used for private
	queries. Made dict-sql use "insert .. on duplicate key update"
	syntax, which unfortunately doesn't work with PostgreSQL yet.
	[6fabe878c46d]

	* src/master/main.c:
	Added missing "dict" to process names
	[19dcfd289610]

	* src/lib-sql/driver-pgsql.c:
	Make sure queued queries and timeout get freed when deinitializing.
	Send the first query immediately after connected to pgsql instead of
	waiting for 5 seconds.
	[5b2640d48aa2]

2006-01-29  Timo Sirainen  <tss@iki.fi>

	* src/plugins/zlib/Makefile.am:
	Link with zlib.
	[7dc2460ff0b7]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/imap-sync.c:
	And the final fix for APPEND hangs ;)
	[ccab957a03b3]

	* src/imap/cmd-append.c, src/imap/imap-sync.c:
	And one more fix for append hang..
	[9f607c5685fd]

	* src/lib/ioloop-poll.c:
	If DEBUG is enabled, make sure the fd is still open when removing
	the I/O handler.
	[3a2d31358d55]

	* src/auth/auth-master-connection.c, src/auth/auth-master-listener.c,
	src/auth/auth-worker-server.c, src/auth/passdb-checkpassword.c,
	src/deliver/deliver.c, src/dict/dict-server.c, src/imap/client.c,
	src/imap/client.h, src/lib/ostream-file.c, src/login-common/main.c,
	src/login-common/master.c, src/login-common/ssl-proxy-gnutls.c, src
	/login-common/ssl-proxy-openssl.c, src/master/auth-process.c,
	src/master/dict-process.c, src/pop3/client.c, src/pop3/client.h:
	Call io_remove() before closing the fd. It's required by kqueue.
	[aeb424e64f24]

	* src/lib/ioloop-internal.h, src/lib/ioloop-notify-dn.c, src/lib
	/ioloop-notify-inotify.c, src/lib/ioloop-notify-kqueue.c,
	src/lib/ioloop.c:
	Cleanups: Make io_remove() do the linked list updating also for
	notify handlers. Removed notify_context from struct io, and moved it
	to a new struct inotify_io.
	[ef5595d6ddec]

	* src/lib/ioloop-kqueue.c, src/lib/ioloop-notify-kqueue.c,
	src/lib/ioloop.c:
	kqueue updates. Patch by Vaclav Haisman
	[3e9b43d0cd80]

	* src/lib-storage/index/dbox/dbox-save.c, src/lib-storage/index/dbox
	/dbox-transaction.c, src/lib-storage/index/dbox/dbox-uidlist.c, src
	/lib-storage/index/dbox/dbox-uidlist.h:
	When appending, update sync_stamp in index so that dbox won't get a
	full resync.
	[8f0ff62befd3]

	* src/lib-storage/index/dbox/Makefile.am, src/lib-storage/index/dbox
	/dbox-file.c, src/lib-storage/index/dbox/dbox-file.h, src/lib-
	storage/index/dbox/dbox-keywords.c, src/lib-storage/index/dbox/dbox-
	keywords.h, src/lib-storage/index/dbox/dbox-mail.c, src/lib-
	storage/index/dbox/dbox-storage.h, src/lib-storage/index/dbox/dbox-
	sync-full.c, src/lib-storage/index/dbox/dbox-sync.c, src/lib-
	storage/index/dbox/dbox-uidlist.c:
	Support storing keywords in dbox files. Doesn't yet work while
	saving.
	[a52c36c51ff2]

2006-01-28  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c, src/imap-login/client.c,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.c:
	If client disconnected while we were trying to send authentication
	continuation to it, we crashed.
	[295af5c1cce6]

	* src/imap-login/client.c, src/pop3-login/client.c:
	Added asserts
	[99ed24b66363]

	* src/lib-index/mail-cache-transaction.c:
	Changed reservations buffer to array.
	[d9a7ad93ddde]

	* src/auth/auth-request-handler.c:
	If authentication client disconnects while it still has pending
	requests, don't crash (got broken in the large pointer-change
	commit).
	[d7a0354861b8]

	* dovecot-example.conf:
	Removed "1.0" version number.
	[f504dbc84d38]

	* src/lib-sql/Makefile.am:
	"make dist" didn't include sources.
	[374ff0d56803]

	* src/imap/cmd-append.c:
	Last APPEND-fix left connection always stuck afterwards.
	[4b6f9e5f7f09]

2006-01-27  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Make --without-sql-drivers work properly
	[795cc9739eb3]

	* src/lib-sql/driver-sqlite.c:
	Cleanups.
	[5b21fb41d14d]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-sqlite.c:
	Fixed memory leaks
	[d7051c7a0200]

	* INSTALL:
	Add directories where they need to be compiled.
	[a5c559c847cc]

	* configure.in:
	Handle --without-sql-drivers
	[e7aff159a0d3]

	* INSTALL, configure.in, src/auth/main.c, src/lib-dict/dict-sql.c, src
	/lib-sql/.cvsignore, src/lib-sql/Makefile.am, src/lib-sql/driver-
	mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql/driver-sqlite.c,
	src/lib-sql/sql-api-private.h, src/lib-sql/sql-api.c, src/lib-sql
	/sql-api.h:
	Added support for dynamically building SQL drivers.
	[cbe5c6772e0d]

2006-01-26  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-append.c:
	If there had been enough sync changes while APPEND was being done,
	we never reset flush callback to _client_output, which could have
	caused hangs later.
	[a490e6657329]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Boolean changes broke istream_raw_mbox_is_valid_from() when it hit
	unexpected EOF. So broken Content-Length headers at the end of files
	gave "file size unexpectedly shrinked in mbox" errors.
	[08a302d3e525]

	* src/master/ssl-init.c:
	Ignore gid of ssl-parameters.dat. It may not be what we expect, and
	since we create it world-readable, it doesn't really matter anyway.
	[1357dd2c5b02]

2006-01-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-checkpassword.c:
	Allow parameters to be passed to checkpassword.
	[8ccd711c93db]

	* src/auth/passdb-checkpassword.c:
	Don't crash if unknown child exits.
	[f55438f449ba]

2006-01-24  Timo Sirainen  <tss@iki.fi>

	* src/master/ssl-init.c:
	Fix building without OpenSSL.
	[5f86377d3683]

2006-01-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/driver-sqlite.c:
	Compiler warning fix. Patch by Marcus Rueckert
	[8e827b05047b]

2006-01-22  Timo Sirainen  <tss@iki.fi>

	* doc/securecoding.txt:
	Added something about setting freed pointers to NULL.
	[51406aaccb46]

	* NEWS, configure.in:
	1.0.beta2 released
	[863a3fcac7b2]

	* src/master/ssl-init.c:
	Fix for SSL parameters getting regenerated constantly
	[aebf37667655]

	* configure.in, src/lib/compat.h:
	Include sys/mkdev.h with UnixWare for major() and minor()
	[b079a386a2f7]

	* configure.in:
	And fix for uoff_t checks..
	[d37797a229c3]

	* src/auth/passdb-cache.h, src/lib-imap/imap-util.h:
	Removed unneeded enum declarations.
	[64269f05bf38]

	* configure.in, src/lib/compat.h:
	If uoff_t type already exists, use it (UnixWare has it).
	[49a1a979959e]

	* src/lib-auth/auth-client.c:
	UnixWare creates sockets as fifos. Allow that..
	[0c863c21025c]

	* src/lib-auth/auth-client.c:
	If we don't have any auth sockets, don't say we're connected to it.
	[b7da6fac35a3]

	* src/auth/userdb-vpopmail.c:
	Compile fix
	[c8f7e92f77da]

	* README:
	Removed code section and did some updates.
	[19c42027b621]

	* src/lib-index/mail-index-lock.c:
	Don't break with INDEX=MEMORY and lock_method=dotlock
	[8297377a569b]

	* src/lib-sql/driver-sqlite.c:
	Forgot to add in sqlite patch.
	[e9d45ec624cb]

	* src/auth/auth-client-connection.c:
	Removed assert, since it may happen and crash dovecot-auth.
	[344e4a729318]

	* src/master/master-settings.c:
	Fix for 0777 check
	[51cd47679f05]

	* src/master/master-settings.c:
	Make base_dir world-readable, not world-writable.
	[382f0aafc2bf]

	* configure.in, doc/dovecot-sql.conf, src/lib-sql/Makefile.am, src
	/lib-sql/sql-api-private.h, src/lib-sql/sql-api.c,
	src/master/main.c:
	SQLite support. Patch by Jakob Hirsch.
	[b967ffb7e3a6]

	* dovecot-example.conf, src/auth/auth-client-connection.c, src/auth
	/auth-request.c, src/auth/auth-request.h, src/auth/auth.c,
	src/auth/auth.h, src/auth/passdb-cache.c, src/auth/passdb-ldap.c,
	src/auth/passdb-passwd-file.c, src/auth/passdb-sql.c, src/auth
	/passdb-vpopmail.c, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added auth_debug_passwords setting. If it's not enabled, hide all
	password strings from logs.
	[40a461d554e6]

	* src/master/main.c, src/master/ssl-init.c, src/master/ssl-init.h:
	Added --build-ssl-parameters option to build them.
	[ae292bd41926]

	* src/auth/passdb-pam.c:
	Removed #ifdef PAM_RHOST, it should be everywhere
	[3c10e68ceb7c]

	* src/auth/userdb-vpopmail.c:
	Domain part was dropped from usernames.
	[6860c4654b03]

2006-01-19  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	ssl_parameters_regenerate is int, not str.
	[84f90b0c66b1]

	* src/auth/db-ldap.c, src/auth/db-sql.c:
	Settings' default listing wasn't ended properly, which could have
	caused dovecot-auth to crash at startup (depending on used
	compiler).
	[af15aab60ff1]

	* dovecot-example.conf, src/lib-index/mail-index.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added mbox_min_index_size setting.
	[fc0b638330a4]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h:
	Fixed mail_index_move_to_memory() to work better and made it public
	[3a2fe49912f3]

	* src/lib-index/mail-index-lock.c:
	Don't try to write to index file if it's in memory.
	[3b0f9be42126]

	* dovecot-example.conf, src/lib-storage/index/index-mail-headers.c,
	src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h, src/lib-storage/index/index-storage.c, src/lib-storage/index
	/index-storage.h, src/lib-storage/index/maildir/maildir-mail.c, src
	/lib-storage/index/mbox/mbox-mail.c, src/master/mail-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added mail_cache_min_mail_count setting.
	[411f20e72a8f]

2006-01-18  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c, src/auth/db-sql.c:
	Give a clear error message if SQL/LDAP configuration file path was
	left empty.
	[afe21b6d4b68]

2006-01-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	Error handling / compiler warning fix
	[fc69c8b9439a]

	* src/lib/hash.c, src/lib/hash.h:
	size_t -> unsigned int. It's enough.
	[51db9cedc120]

	* src/lib/ioloop-notify-inotify.c:
	Changed linux/inotify* includes to sys/inotify.h (I thought I had
	done this already).
	[b694c27ad1a8]

2006-01-16  Timo Sirainen  <tss@iki.fi>

	* TODO, configure.in:
	1.0 beta1 released
	[9f8d69605d4b]

	* src/master/ssl-init.c:
	Added a note about SSL parameter regeneration finishing.
	[b284f9e5c4f7]

	* dovecot-example.conf:
	Removed ssl_parameters_file setting.
	[0e47f412e3aa]

2006-01-15  Timo Sirainen  <tss@iki.fi>

	* src/master/login-process.c, src/master/main.c, src/master/master-
	settings.c, src/master/master-settings.h, src/master/ssl-init.c,
	src/master/ssl-init.h:
	Put ssl-parameters file into login directory so it still can be
	accessed even if login process is chrooted.
	[0ae5f5b468b7]

	* src/master/master-settings.c:
	Fix base_dir permissions if it exists
	[7ee2fc733bf6]

	* src/master/master-settings.h:
	mail_max_keyword_length is integer, not boolean.
	[bc5b6b89a76b]

	* src/master/ssl-init.c:
	Add a note about DH parameters being generated for the first time.
	[3bbd7ba3315e]

	* src/master/main.c:
	When starting with --exec-mail, keep USER and HOME environments and
	clear the rest.
	[9dc2f8f0eb59]

	* src/master/mail-process.c:
	Don't crash if username is NULL (shouldn't happen though)
	[7aea43511bac]

	* src/imap/cmd-idle.c:
	IDLE: Handle disconnection differently (and maybe we won't crash
	anymore)
	[5c047d58a67d]

	* src/master/ssl-init.c:
	If ssl_parameters_regenerate=0, don't regenerate it if it's
	otherwise ok.
	[f777ef3a79ca]

	* src/master/ssl-init.c:
	If SSL parameters file is empty, unlink it
	[1a036356a752]

	* src/master/dict-process.c:
	Disable dict server for now
	[1e37fad03602]

	* src/auth/db-passwd-file.c, src/auth/db-passwd-file.h, src/auth
	/passdb-passwd-file.c, src/auth/userdb-passwd-file.c:
	If debug is enabled, tell how many users are found from passwd-file
	whenever it's read.
	[2d0859490a2f]

	* src/master/askpass.c, src/master/askpass.h:
	Forgot to add in last commit
	[6658a000051d]

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c,
	src/master/Makefile.am, src/master/common.h, src/master/login-
	process.c, src/master/main.c, src/master/master-settings.c,
	src/master/master-settings.h:
	Added support for password protected SSL private keys. The password
	can be given in dovecot.conf, or when dovecot is started with -p
	parameter.
	[c7462001227b]

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c,
	src/master/master-settings.c, src/master/ssl-init-openssl.c,
	src/master/ssl-init.c:
	Generate DH parameters and use them. Changed default regeneration
	time to 1 week.
	[650701d41cdf]

	* dovecot-example.conf:
	Added a note about auth_debug also storing users' passwords in logs.
	[f95146a34af9]

	* configure.in:
	Include sys/inotify.h instead of linux/inotify.h. Patch by Marcus
	Rueckert
	[598be05460f5]

	* src/master/dict-process.c:
	Create dict-server socket to base_dir.
	[b624b687fe13]

	* src/util/gdbhelper.c:
	Create the gdbhelper log file only after process has died.
	[c3dc9cedce78]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c:
	Added some checks and better logging for figuring out why (*seq !=
	0) assert happens.
	[434d74a67a81]

	* src/lib/ioloop-notify-inotify.c:
	Fixed
	[2602b791b6c3]

2006-01-14  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Default SSL is OpenSSL, not GNUTLS.
	[ea56e9296b5b]

	* src/lib-index/mail-index-sync.c:
	Error handling fix
	[d194896d58e6]

	* src/auth/auth-cache.c, src/auth/auth-cache.h, src/auth/auth-client-
	connection.c, src/auth/auth-client-connection.h, src/auth/auth-
	master-connection.c, src/auth/auth-master-connection.h, src/auth
	/auth-master-listener.c, src/auth/auth-master-listener.h, src/auth
	/auth-module.c, src/auth/auth-module.h, src/auth/auth-request-
	handler.c, src/auth/auth-request-handler.h, src/auth/auth-request.c,
	src/auth/auth-request.h, src/auth/auth-worker-client.c, src/auth
	/auth-worker-client.h, src/auth/auth-worker-server.c,
	src/auth/auth.c, src/auth/auth.h, src/auth/db-ldap.c, src/auth/db-
	ldap.h, src/auth/db-passwd-file.c, src/auth/db-passwd-file.h,
	src/auth/db-sql.c, src/auth/db-sql.h, src/auth/main.c, src/auth
	/mech-gssapi.c, src/auth/passdb-cache.c, src/auth/passdb-
	checkpassword.c, src/auth/passdb-ldap.c, src/auth/passdb-pam.c,
	src/auth/passdb-passwd-file.c, src/auth/passdb-sql.c,
	src/auth/passdb.c, src/auth/password-scheme.c, src/auth/userdb-
	ldap.c, src/auth/userdb-passwd-file.c, src/auth/userdb-sql.c,
	src/auth/userdb.c, src/dict/dict-cache.c, src/dict/dict-server.c,
	src/dict/main.c, src/imap-login/client-authenticate.c, src/imap-
	login/client.c, src/imap-login/imap-proxy.c, src/imap/client.c,
	src/imap/cmd-append.c, src/imap/cmd-close.c, src/imap/cmd-copy.c,
	src/imap/cmd-delete.c, src/imap/cmd-idle.c, src/imap/cmd-list.c,
	src/imap/cmd-logout.c, src/imap/cmd-search.c, src/imap/cmd-select.c,
	src/imap/cmd-status.c, src/imap/cmd-store.c, src/imap/cmd-
	unselect.c, src/imap/imap-expunge.c, src/imap/imap-fetch-body.c,
	src/imap/imap-fetch.c, src/imap/imap-sort.c, src/imap/imap-sync.c,
	src/imap/imap-thread.c, src/imap/main.c, src/imap/namespace.c, src
	/lib-auth/auth-client.c, src/lib-auth/auth-client.h, src/lib-auth
	/auth-server-connection.c, src/lib-auth/auth-server-connection.h,
	src/lib-auth/auth-server-request.c, src/lib-charset/charset-iconv.c,
	src/lib-charset/charset-utf8.c, src/lib-charset/charset-utf8.h, src
	/lib-dict/dict-client.c, src/lib-dict/dict-sql.c, src/lib-
	dict/dict.c, src/lib-dict/dict.h, src/lib-imap/imap-base-subject.c,
	src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-envelope.c, src
	/lib-imap/imap-match.c, src/lib-imap/imap-match.h, src/lib-imap
	/imap-parser.c, src/lib-imap/imap-parser.h, src/lib-index/mail-
	cache-compress.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-index/mail-index-private.h, src/lib-index/mail-
	index-sync-update.c, src/lib-index/mail-index-sync.c, src/lib-index
	/mail-index-transaction-private.h, src/lib-index/mail-index-
	transaction-view.c, src/lib-index/mail-index-transaction.c, src/lib-
	index/mail-index-view-sync.c, src/lib-index/mail-index-view.c, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-index
	/mail-transaction-log-view.c, src/lib-index/mail-transaction-log.c,
	src/lib-index/mail-transaction-log.h, src/lib-mail/istream-header-
	filter.c, src/lib-mail/message-body-search.c, src/lib-mail/message-
	header-search.c, src/lib-mail/message-header-search.h, src/lib-mail
	/message-parser.c, src/lib-mail/message-parser.h, src/lib-
	settings/settings.c, src/lib-sql/driver-mysql.c, src/lib-sql/driver-
	pgsql.c, src/lib-sql/sql-api.c, src/lib-sql/sql-api.h, src/lib-
	storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox/dbox-
	list.c, src/lib-storage/index/dbox/dbox-save.c, src/lib-
	storage/index/dbox/dbox-sync-expunge.c, src/lib-storage/index/dbox
	/dbox-sync.c, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/index-mail-headers.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/index-mailbox-check.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-sync.c, src/lib-storage/index/index-
	transaction.c, src/lib-storage/index/maildir/maildir-keywords.c, src
	/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/mbox/istream-raw-mbox.c,
	src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-list.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/mail-copy.c, src/lib-storage/mail-
	storage.c, src/lib-storage/mail-storage.h, src/lib-storage/mail.c,
	src/lib-storage/subscription-file/subscription-file.c,
	src/lib/buffer.c, src/lib/buffer.h, src/lib/file-cache.c, src/lib
	/file-cache.h, src/lib/hash.c, src/lib/hash.h, src/lib/ioloop-
	notify-dn.c, src/lib/ioloop.c, src/lib/ioloop.h, src/lib/istream-
	limit.c, src/lib/istream-seekable.c, src/lib/istream.c,
	src/lib/istream.h, src/lib/lib-signals.c, src/lib/module-dir.c,
	src/lib/module-dir.h, src/lib/ostream-crlf.c, src/lib/ostream-
	file.c, src/lib/ostream.c, src/lib/ostream.h, src/lib/str.c,
	src/lib/str.h, src/login-common/login-proxy.c, src/login-
	common/main.c, src/login-common/master.c, src/login-common/ssl-
	proxy-openssl.c, src/master/auth-process.c, src/master/dict-
	process.c, src/master/log.c, src/master/login-process.c,
	src/master/main.c, src/master/ssl-init.c, src/plugins/imap-quota
	/imap-quota-plugin.c, src/plugins/quota/quota-storage.c,
	src/plugins/trash/trash-plugin.c, src/plugins/zlib/zlib-plugin.c,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.c,
	src/pop3-login/pop3-proxy.c, src/pop3/client.c, src/pop3/commands.c,
	src/pop3/main.c, src/util/rawlog.c:
	deinit, unref, destroy, close, free, etc. functions now take a
	pointer to their data pointer, and set it to NULL. This makes
	double-frees less likely to cause security holes.
	[928229f8b3e6]

	* src/lib/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib
	/mempool-system.c, src/lib/mempool-unsafe-datastack.c,
	src/lib/mempool.h:
	pool_unref(): set the pool pointer to NULL, so if we're trying to
	unref it twice we'll do a clean crash.
	[bf0a03691989]

	* src/imap/imap-thread.c:
	THREAD crashed if no search matches were found.
	[0d0fad3fb5e9]

	* src/imap/cmd-list.c, src/imap/namespace.c, src/imap/namespace.h:
	Fixes to returning namespace root with "" mask.
	[a291d41bc50d]

	* src/imap/cmd-list.c:
	Cleaned up and added comments. Also added some kludging so that
	listing namespace prefix itself with and without trailing separator
	works.
	[e5abc07d843f]

	* src/lib-imap/imap-quote.h:
	Fixed macro to put parameter in ()
	[a8fef45677ba]

	* src/lib-storage/index/index-search.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/plugins/quota/quota-storage.c:
	Compiler warning fixes and one real fix for int -> bool changes.
	[31d8f49b1a34]

	* doc/securecoding.txt:
	Small updates: Added note about array API and updates to data stack.
	[b054cd10ceaa]

	* src/imap/client.c, src/imap/client.h:
	Don't crash if closing with signal while IDLEing.
	[2506e4077e7a]

	* src/dict/Makefile.am:
	Compile fix
	[099ea3b43ee2]

	* src/lib-dict/Makefile.am, src/lib-dict/dict-client.h, src/master
	/dict-process.c:
	Don't use hardcoded /var/run/dovecot in dict-server path, but
	PKG_RUNDIR/dict-server.
	[0fc7e4bdcaaf]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	Use longer line wrapping with X-IMAP, X-IMAPbase and X-Keywords
	headers since UW-IMAP doesn't like the wrapping.
	[398c3890a632]

	* src/Makefile.am:
	automake warning fixed
	[9696b88ae610]

	* src/imap/client.c:
	Added assert
	[c1bf2b79eb7f]

	* src/util/gdbhelper.c:
	Use "bt full" for printing backtrace.
	[749d42902341]

	* dovecot-example.conf, src/util/Makefile.am, src/util/gdbhelper.c:
	Added gdbhelper binary.
	[6124ca416a6c]

2006-01-13  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/auth/auth-cache.c, src/auth/auth-cache.h, src/auth
	/auth-client-connection.c, src/auth/auth-master-connection.c,
	src/auth/auth-master-listener.c, src/auth/auth-master-listener.h,
	src/auth/auth-request-handler.c, src/auth/auth-request-handler.h,
	src/auth/auth-request.c, src/auth/auth-request.h, src/auth/auth-
	worker-client.c, src/auth/auth.c, src/auth/auth.h,
	src/auth/common.h, src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth
	/db-passwd-file.c, src/auth/db-passwd-file.h, src/auth/main.c,
	src/auth/mech-apop.c, src/auth/mech-cram-md5.c, src/auth/mech-
	digest-md5.c, src/auth/mech-ntlm.c, src/auth/mech-rpa.c, src/auth
	/passdb-bsdauth.c, src/auth/passdb-cache.c, src/auth/passdb-cache.h,
	src/auth/passdb-pam.c, src/auth/passdb-passwd.c, src/auth/passdb-
	shadow.c, src/auth/passdb.h, src/auth/password-scheme.c, src/auth
	/password-scheme.h, src/auth/userdb-ldap.c, src/auth/userdb-
	prefetch.c, src/auth/userdb.h, src/imap-login/client-authenticate.c,
	src/imap-login/client-authenticate.h, src/imap-login/client.c, src
	/imap-login/client.h, src/imap/client.c, src/imap/client.h, src/imap
	/cmd-append.c, src/imap/cmd-authenticate.c, src/imap/cmd-
	capability.c, src/imap/cmd-check.c, src/imap/cmd-close.c, src/imap
	/cmd-copy.c, src/imap/cmd-create.c, src/imap/cmd-delete.c, src/imap
	/cmd-examine.c, src/imap/cmd-expunge.c, src/imap/cmd-fetch.c,
	src/imap/cmd-idle.c, src/imap/cmd-list.c, src/imap/cmd-login.c,
	src/imap/cmd-logout.c, src/imap/cmd-lsub.c, src/imap/cmd-
	namespace.c, src/imap/cmd-noop.c, src/imap/cmd-rename.c, src/imap
	/cmd-search.c, src/imap/cmd-select.c, src/imap/cmd-sort.c, src/imap
	/cmd-status.c, src/imap/cmd-store.c, src/imap/cmd-subscribe.c,
	src/imap/cmd-thread.c, src/imap/cmd-uid.c, src/imap/cmd-unselect.c,
	src/imap/cmd-unsubscribe.c, src/imap/commands-util.c, src/imap
	/commands-util.h, src/imap/commands.c, src/imap/commands.h, src/imap
	/imap-expunge.c, src/imap/imap-expunge.h, src/imap/imap-fetch-
	body.c, src/imap/imap-fetch.c, src/imap/imap-fetch.h, src/imap/imap-
	search.c, src/imap/imap-search.h, src/imap/imap-sort.c, src/imap
	/imap-sync.c, src/imap/imap-sync.h, src/imap/imap-thread.c,
	src/imap/namespace.c, src/lib-auth/auth-client.c, src/lib-auth/auth-
	client.h, src/lib-auth/auth-server-connection.c, src/lib-auth/auth-
	server-connection.h, src/lib-auth/auth-server-request.c, src/lib-
	auth/auth-server-request.h, src/lib-charset/charset-iconv.c, src
	/lib-charset/charset-utf8.c, src/lib-charset/charset-utf8.h, src
	/lib-dict/dict-client.c, src/lib-dict/dict-private.h, src/lib-dict
	/dict-sql.c, src/lib-dict/dict.c, src/lib-dict/dict.h, src/lib-imap
	/imap-base-subject.c, src/lib-imap/imap-base-subject.h, src/lib-imap
	/imap-bodystructure.c, src/lib-imap/imap-bodystructure.h, src/lib-
	imap/imap-date.c, src/lib-imap/imap-date.h, src/lib-imap/imap-
	envelope.c, src/lib-imap/imap-envelope.h, src/lib-imap/imap-match.c,
	src/lib-imap/imap-match.h, src/lib-imap/imap-parser.c, src/lib-imap
	/imap-parser.h, src/lib-imap/imap-quote.c, src/lib-imap/imap-
	quote.h, src/lib-index/mail-cache-compress.c, src/lib-index/mail-
	cache-lookup.c, src/lib-index/mail-cache-transaction.c, src/lib-
	index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-index/mail-
	index-fsck.c, src/lib-index/mail-index-lock.c, src/lib-index/mail-
	index-private.h, src/lib-index/mail-index-sync-ext.c, src/lib-index
	/mail-index-sync-private.h, src/lib-index/mail-index-sync-update.c,
	src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction-private.h, src/lib-index/mail-index-transaction.c, src
	/lib-index/mail-index-view-private.h, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-index.c,
	src/lib-index/mail-index.h, src/lib-index/mail-transaction-log-
	append.c, src/lib-index/mail-transaction-log-private.h, src/lib-
	index/mail-transaction-log-view.c, src/lib-index/mail-transaction-
	log.c, src/lib-index/mail-transaction-log.h, src/lib-mail/istream-
	header-filter.c, src/lib-mail/istream-header-filter.h, src/lib-mail
	/message-address.c, src/lib-mail/message-body-search.c, src/lib-mail
	/message-body-search.h, src/lib-mail/message-content-parser.c, src
	/lib-mail/message-content-parser.h, src/lib-mail/message-date.c, src
	/lib-mail/message-date.h, src/lib-mail/message-header-decode.c, src
	/lib-mail/message-header-decode.h, src/lib-mail/message-header-
	search.c, src/lib-mail/message-header-search.h, src/lib-mail
	/message-parser.c, src/lib-mail/message-parser.h, src/lib-mail
	/message-part-serialize.c, src/lib-mail/message-send.c, src/lib-mail
	/message-send.h, src/lib-mail/message-size.c, src/lib-mail/message-
	size.h, src/lib-ntlm/ntlm-encrypt.c, src/lib-ntlm/ntlm-message.c,
	src/lib-ntlm/ntlm-message.h, src/lib-ntlm/ntlm.h, src/lib-
	settings/settings.c, src/lib-settings/settings.h, src/lib-sql
	/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-
	storage/index/dbox/dbox-list.c, src/lib-storage/index/dbox/dbox-
	mail.c, src/lib-storage/index/dbox/dbox-save.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/dbox/dbox-
	storage.h, src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox/dbox-
	sync.h, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/index-mail-headers.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/index-mailbox-check.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/index-
	sync.c, src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h,
	src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-file.c, src/lib-storage/index/mbox/mbox-file.h, src/lib-
	storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox/mbox-
	lock.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-md5.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h, src
	/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync-update.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/index/mbox/mbox-transaction.c, src
	/lib-storage/mail-search.c, src/lib-storage/mail-search.h, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/lib-storage/mailbox-tree.c, src
	/lib-storage/mailbox-tree.h, src/lib-storage/subscription-file
	/subscription-file.c, src/lib-storage/subscription-file
	/subscription-file.h, src/lib/array.h, src/lib/buffer.c,
	src/lib/buffer.h, src/lib/compat.h, src/lib/data-stack.c, src/lib
	/data-stack.h, src/lib/fd-close-on-exec.c, src/lib/fd-close-on-
	exec.h, src/lib/fd-set-nonblock.c, src/lib/fd-set-nonblock.h,
	src/lib/file-dotlock.c, src/lib/file-dotlock.h, src/lib/hash.c,
	src/lib/hash.h, src/lib/hex-binary.c, src/lib/ioloop-epoll.c,
	src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-inotify.c, src/lib
	/ioloop-poll.c, src/lib/ioloop.c, src/lib/ioloop.h, src/lib/istream-
	data.c, src/lib/istream-file.c, src/lib/istream-internal.h, src/lib
	/istream-limit.c, src/lib/istream-mmap.c, src/lib/istream-
	seekable.c, src/lib/istream.c, src/lib/istream.h, src/lib/lib-
	signals.c, src/lib/lib-signals.h, src/lib/mempool-alloconly.c,
	src/lib/module-dir.c, src/lib/module-dir.h, src/lib/network.c,
	src/lib/network.h, src/lib/ostream-crlf.c, src/lib/ostream-file.c,
	src/lib/ostream-internal.h, src/lib/ostream.c, src/lib/ostream.h,
	src/lib/printf-upper-bound.c, src/lib/restrict-access.c, src/lib
	/restrict-access.h, src/lib/restrict-process-size.h, src/lib/seq-
	range-array.c, src/lib/seq-range-array.h, src/lib/strfuncs.c,
	src/lib/strfuncs.h, src/lib/unlink-directory.c, src/lib/unlink-
	directory.h, src/lib/var-expand.c, src/login-common/client-common.c,
	src/login-common/client-common.h, src/login-common/common.h, src
	/login-common/main.c, src/login-common/master.c, src/login-
	common/master.h, src/login-common/sasl-server.c, src/login-common
	/ssl-proxy-gnutls.c, src/login-common/ssl-proxy-openssl.c, src
	/login-common/ssl-proxy.c, src/login-common/ssl-proxy.h, src/master
	/auth-process.c, src/master/common.h, src/master/log.c, src/master
	/login-process.c, src/master/mail-process.c, src/master/mail-
	process.h, src/master/main.c, src/master/master-login-interface.h,
	src/master/master-settings.c, src/master/master-settings.h,
	src/master/ssl-init.c, src/master/syslog-util.c, src/master/syslog-
	util.h, src/plugins/imap-quota/imap-quota-plugin.c,
	src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-fs.c, src/plugins/quota/quota-private.h,
	src/plugins/quota/quota-storage.c, src/plugins/quota/quota.c,
	src/plugins/quota/quota.h, src/plugins/trash/trash-plugin.c,
	src/plugins/zlib/istream-zlib.c, src/plugins/zlib/zlib-plugin.c,
	src/pop3-login/client-authenticate.c, src/pop3-login/client-
	authenticate.h, src/pop3-login/client.c, src/pop3-login/client.h,
	src/pop3/client.c, src/pop3/commands.c, src/pop3/common.h,
	src/pop3/main.c, src/util/rawlog.c:
	Added "bool" type and changed all ints that were used as booleans to
	bool.
	[55df57c028d4]

	* src/auth/passdb-pam.c:
	Compiler warning fix
	[ea1571f17b96]

	* src/lib/ioloop-poll.c:
	Cleanup + removed compiler warnings with 64bit systems
	[398dcca97d24]

	* src/auth/passdb-pam.c:
	Check write()'s return value
	[0d5d42c49b51]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Compiler warning fix
	[b52ea344e872]

	* src/dict/dict-server.c, src/lib-dict/dict-client.c, src/lib-
	storage/index/dbox/dbox-uidlist.c:
	Small (compiling) fixes
	[2e5c34fe9634]

	* autogen.sh:
	Call autoheader earlier
	[d3342c78ed44]

2006-01-12  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	Fixes to handling namespace prefixes.
	[b97de2e354bd]

	* src/master/dict-process.c, src/master/dict-process.h:
	Forgot to add in last commit.
	[8ce85fb481aa]

	* src/master/master-settings.c:
	/var/run/dovecot can be world-readable. Default to it, and don't try
	to force any modes to it. All files and directories under it are
	already protected properly.
	[fee060a82236]

	* src/dict/dict-server.c, src/dict/dict-server.h, src/dict/main.c,
	src/master/Makefile.am, src/master/auth-process.c,
	src/master/common.h, src/master/main.c:
	Start dict server automatically when a client tries to connect to
	it.
	[b3e18b51c205]

2006-01-11  Timo Sirainen  <tss@iki.fi>

	* src/dict/dict-cache.c, src/dict/dict-server.c, src/lib-dict/dict-
	client.c:
	Fixes to dict proxy.
	[72606d5256b8]

	* src/lib/ioloop-notify-dn.c:
	Dnotify crashed if we tried to use multiple I/O loops.
	[4fa8e287486e]

	* src/lib-sql/driver-pgsql.c:
	Added assert
	[c00cbfdc71ef]

	* src/lib-dict/dict-sql.c:
	Fixed parsing configuration file.
	[8d2028705702]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-mail.c:
	Handle unexpectedly breaking mboxes better without crashing.
	[5703f0516342]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	Added new assert was wrong in last assert-crashfix, so we still kept
	crashing to the new assert..
	[145b9742b741]

	* src/lib-storage/index/dbox/dbox-mail.c, src/lib-storage/index/dbox
	/dbox-uidlist.c:
	Use CR+LF linefeeds always so that physical size = virtual size.
	[223ceff28fc3]

	* dovecot-example.conf, src/lib-storage/index/dbox/dbox-storage.c, src
	/lib-storage/index/dbox/dbox-storage.h, src/lib-storage/index/dbox
	/dbox-uidlist.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added dbox_rotate_min_size and fixed rotation checks.
	[18a786df5815]

2006-01-09  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c:
	try_alloc: Handle mail_get_physical_size() failures.
	[93959452e17e]

	* configure.in:
	Removed deliver until it's working again
	[37b54ccbb961]

	* src/Makefile.am:
	dict was missing
	[273fcae9ffba]

2006-01-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	"Free space offset" wasn't updated when headers were moved around,
	causing assert crashes.
	[6b9e9d614c9a]

2006-01-07  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-ldap.conf, src/auth/db-ldap.c, src/auth/db-ldap.h,
	src/auth/passdb-ldap.c:
	Added fast authbinding and auth_bind_userdn setting. Patch by Geff
	<boing@boing.com>
	[935f12d0d2fe]

	* src/lib-storage/index/mbox/mbox-from.c:
	Handle "Thu, 9 Nov 2002 22:33:52" style timestamps also.
	[b48d071d4ea5]

	* src/imap/cmd-idle.c:
	When idling, send an OK message every two minutes to break
	NAT/firewall timeouts.
	[e0881596af32]

	* src/lib-storage/index/mbox/mbox-list.c:
	Comment update
	[073d3f73db51]

	* src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-list.c:
	Keep atime < mtime if mbox has recent messages and we're keeping
	them. Rely on this for setting \UnMarked flag for LIST replies.
	[8cd2673e4eb5]

	* src/lib-index/mail-index-lock.c:
	fix
	[309605c0a7fb]

	* src/lib-storage/index/index-sync.c:
	Crashfix to last keyword compare update
	[3a03da46d884]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-lock.c, src
	/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log.c, src/lib-index/mail-transaction-log.h:
	Beginnings of fallbacking to in-memory indexes when write fails with
	"out of disk space" error.
	[318c70c1d4ec]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-sync.c,
	src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index.c,
	src/lib-index/mail-transaction-log-view.c, src/lib-index/mail-
	transaction-log.c, src/lib-index/mail-transaction-log.h:
	Handle missing/broken transaction logs better. Handle broken sync
	position in index header better.
	[76f4be7ae499]

2006-01-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index.c:
	Minor cleanups
	[1a4d3c25feb8]

	* src/lib-index/mail-index-lock.c:
	Added "(see lock_method setting in config file)" for flock() not
	supported error too.
	[385139d2b082]

	* src/lib-index/mail-transaction-log-append.c:
	Hidden transaction changes weren't hiding everything. This resulted
	STORE +FLAGS.SILENT not being silent always.
	[78692225c2ab]

	* src/lib-index/mail-index-view.c, src/lib-index/mail-index.h:
	mail_index_ext_get_size() hadn't been implemented even though it was
	in mail-index.h. Implemented it and changed
	mail_index_lookup_keywords() to use it.
	[eba704899933]

	* src/lib-index/mail-index-view.c:
	We had been shared-locking index unnecessarily for quite a while
	when using not-up-to-date views.
	[7c32107d18c2]

	* src/imap/cmd-idle.c:
	Recent changes broke IDLE when no mailbox was opened.
	[20430dbf04d4]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	index.h, src/lib-storage/index/index-sync.c:
	Changed mail_index_view_sync_next() to return struct
	mail_index_view_sync_rec records which only contain the type and UID
	range. Makes it clearer that the caller won't get anything else, and
	flag updates now don't need to update add_flags/remove_flags fields.
	[a983412e1976]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h, src/lib-index/mail-transaction-
	log-append.c:
	Comment updates, small cleanups and optimizations.
	[3e756ea0474b]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c:
	Converted some buffers to arrays.
	[48a2d15ae0c4]

	* src/lib-storage/index/index-sync.c:
	Make it compile..
	[5ba04396479d]

	* src/lib-index/mail-index.h, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/index-sync.c, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/mbox/mbox-sync.c:
	We assumed that keyword index arrays were always sorted. This isn't
	always the case. Caused unneeded keyword updates.
	[c8b2ed2c9961]

	* AUTHORS:
	Minor update
	[ec0119de5aa2]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c, src/lib-index/mail-index.c,
	src/lib-index/mail-index.h:
	Moved uoff_t and time_t compatibility checks to cache file, since
	they're not needed for index/log. Only index file incompatibility
	check is now endianess flag.
	[61f0e1fe9b55]

	* src/lib-index/mail-index.c:
	Comment updates and minor cleanups
	[6758c0f3c318]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	ext.c, src/lib-index/mail-index.c:
	Moved expunge handlers to mail_index_registered_ext.
	[dc560ef2654b]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	ext.c, src/lib-index/mail-index-transaction-view.c, src/lib-index
	/mail-index-transaction.c, src/lib-index/mail-index.c, src/lib-index
	/mail-transaction-log-append.c:
	Cleanup: Created mail_index_registered_ext which is used for
	index->extensions array. Put sync_handler to it and removed
	sync_handlers array.
	[575c79a0aabc]

2006-01-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/dbox-sync-full.c:
	Read flags properly from header when syncing
	[7574c66f1cc7]

	* src/lib-storage/index/dbox/dbox-mail.c:
	Handle moved mails properly
	[dd9849b6977d]

	* dovecot-example.conf, src/lib-storage/index/dbox/dbox-storage.c, src
	/lib-storage/index/dbox/dbox-storage.h, src/lib-storage/index/dbox
	/dbox-uidlist.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added dbox_rotate_size and dbox_rotate_days settings.
	[74289963b8a7]

	* src/lib-storage/index/dbox/dbox-file.c, src/lib-storage/index/dbox
	/dbox-storage.h, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/dbox/dbox-uidlist.h:
	Added rotation by number of days since file was created.
	[2881f7e79098]

2006-01-04  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c:
	If append command failed because input line was too long (highly
	unlikely), we didn't properly reset flush callback.
	[03a2ff05bd12]

2006-01-02  Timo Sirainen  <tss@iki.fi>

	* src/Makefile.am, src/deliver/deliver.c:
	Deliver binary is out of date, dovecot-lda should be used for now.
	[4ed2033584b2]

	* src/master/master-settings.c, src/master/master-settings.h:
	Ignore "protocol lda" section.
	[00d6d460966c]

	* src/lib-index/mail-cache-transaction.c:
	Don't fdatasync() cache file. It's not all that important.
	[8ec5b5955235]

	* src/lib-index/mail-index-lock.c:
	And fix to mmap_disable=yes optimization.
	[e2e75fc037ed]

	* src/lib-index/mail-index-sync-update.c:
	typofix
	[de3a73257e78]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	keywords.c, src/lib-index/mail-index-sync-update.c:
	Don't rewrite index file every time with mmap_disable=yes.
	[5d090d03f2b5]

	* src/lib/strfuncs.c:
	t_strarray_join() was broken with input longer than 63 bytes (good
	thing we didn't use it in any important places). Patch by Johan
	Kiviniemi.
	[ae629e747baf]

2006-01-01  Timo Sirainen  <tss@iki.fi>

	* src/lib/strfuncs.c:
	Fix for last change in *_strsplit_spaces().
	[1e3ed6636bfe]

	* src/auth/passdb-passwd-file.c:
	Don't crash if password is empty
	[f91a8dd9c4ec]

	* dovecot-example.conf:
	There's no "userdb pam".
	[0420cf130a20]

2005-12-31  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/plugins/Makefile.am, src/plugins/zlib/.cvsignore,
	src/plugins/zlib/Makefile.am, src/plugins/zlib/istream-zlib.c,
	src/plugins/zlib/istream-zlib.h, src/plugins/zlib/zlib-plugin.c,
	src/plugins/zlib/zlib-plugin.h:
	Added zlib plugin
	[68e7519ebd90]

	* src/lib-mail/istream-header-filter.c:
	Grow default pool size
	[87793c933996]

	* src/lib/ioloop.c, src/lib/ioloop.h:
	Export current_ioloop globally.
	[be1bac1dd005]

	* src/lib-storage/index/mbox/mbox-storage.c:
	In-memory indexes are kept also in index-storage's cache, so we need
	to free them the normal way (probably changed this some time ago).
	[1a80323df9c1]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Removed X-UIDL after all from hide list. Updated comment + small
	cleanup.
	[c4efa2acbf7c]

	* src/lib-mail/message-body-search.c, src/lib-mail/message-body-
	search.h, src/lib-storage/index/index-search.c:
	Allow message_body_search() to return "message_part is broken"
	error. If it happens, clear cache and try again with parsed
	message_part.
	[e6c42de08336]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't send X-UIDL header to clients.
	[93658528c5de]

	* src/lib-dict/dict-client.c, src/lib-dict/dict-client.h:
	Forgot to add
	[0b3f3323e460]

	* src/dict/dict-server.c:
	unlink stale socket
	[e8275a1555d5]

	* src/dict/dict-server.c, src/dict/main.c:
	Small fixes
	[785321049f51]

	* src/dict/dict-server.c, src/dict/main.c:
	Cleanup
	[70a9d66adc97]

	* src/imap/Makefile.am, src/imap/main.c, src/pop3/Makefile.am,
	src/pop3/main.c:
	Register proxy dictionary support and link libdict. Currently it's
	used only by quota plugin, but later it'll be useful for more
	things..
	[0120998fb2d9]

	* dovecot-example.conf, src/imap/main.c, src/pop3/main.c:
	Clarify that workaround lists are space separated. But allow commas
	as well..
	[b412da0eb27c]

	* src/dict/.cvsignore, src/dict/Makefile.am, src/dict/dict-cache.c,
	src/dict/dict-cache.h, src/dict/dict-server.c, src/dict/dict-
	server.h, src/dict/main.c, src/lib-dict/Makefile.am, src/lib-dict
	/dict-private.h, src/lib-dict/dict-sql.c, src/lib-dict/dict.c, src
	/lib-dict/dict.h, src/plugins/quota/quota-dict.c:
	Added dictinary lookup server and a "proxy" dict implementation to
	talk to it.
	[40600601502e]

	* configure.in:
	No GNU_SOURCE checks. We don't want them (I think).
	[f4698c4b0668]

2005-12-30  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-fs.h:
	stdio.h needs to be included before mntent.h or sys/mnttab.h
	[b423e18e4c7f]

	* configure.in:
	Cleanups and some more kqueue stuff
	[beeae4f17615]

	* configure.in:
	Forgot to add kqueue and kevent function checks
	[1a1f8789415a]

	* configure.in, src/lib/Makefile.am, src/lib/ioloop-notify-kqueue.c:
	Added kqueue notification support. Patch by Vaclav Haisman
	[c67f77647a6e]

	* src/lib/ioloop-kqueue.c:
	Fix IO_ERROR behaviour. Patch by Vaclav Haisman
	[d996a407aa4b]

	* configure.in:
	Check that gssapi/gssapi.h exists before using it.
	[0128534525d8]

	* Makefile.am, configure.in:
	Added --with-docs parameter to specify if documentation should be
	installed. Wanted for at least FreeBSD's NOPORTDOCS option. Patch by
	Robin Breathe
	[e87a8db60d25]

	* src/lib/strfuncs.c:
	*_strsplit_spaces() was skipping only space separators, while it
	should have skipped all (like its API comments said).
	[91689264d812]

	* src/imap/cmd-idle.c:
	Don't crash if client disconnected in IDLE. If mailbox had been
	changed before IDLE was started, show the changes immediately. If
	more changes happened to mailbox while we were sending older changes
	to client, we crashed.
	[39c293635875]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Accidentally had changed !partial-check to partial-check. Because of
	this external expunges weren't always noticed and there might have
	been some errors about UIDs being invalid.
	[0cae3268c8af]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.h, src/lib-storage/index/maildir/maildir-sync.c:
	maildir_copy_with_hardlinks works again.
	[8321e6191275]

	* src/lib-storage/index/maildir/maildir-save.c:
	Minor optimization.
	[d55568224be6]

	* src/master/auth-process.c:
	Added comment
	[faca306e691a]

	* src/auth/passdb-ldap.c:
	cleanup
	[fbadb37f28e4]

	* doc/dovecot-ldap.conf, src/auth/auth-request.c, src/auth/auth-
	worker-client.c, src/auth/auth.c, src/auth/db-ldap.c, src/auth/db-
	ldap.h, src/auth/passdb-ldap.c, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/userdb-ldap.c:
	Added authentication bind support. Patch by J.M. Maurer. Also
	cleaned up the LDAP code a bit and made it possible for passdbs to
	disable lookup_credentials in runtime.
	[4b6d962485b9]

	* src/lib-storage/index/mbox/mbox-mail.c:
	If mbox offsets are dirty and the mbox is write-locked (eg. copying
	mails to box), we got to infinite loop.
	[697fe3d1643d]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Extra assert
	[064843fae9da]

2005-12-29  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	Changed default auth socket path
	[394a8a4d564d]

2005-12-28  Timo Sirainen  <tss@iki.fi>

	* src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-private.h:
	Make dirsize backend read the directory only once at the beginning
	of transaction. Added some more variables to struct
	quota_transaction_context so dict and quota backends can both use it
	directly.
	[c96f2e532b9d]

	* src/auth/auth.c, src/auth/mech-anonymous.c, src/auth/mech-apop.c,
	src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c, src/auth/mech-
	gssapi.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth
	/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.h:
	Removed need_passdb from mechanism definitions.
	passdb_need_plain/credentials is enough to know that. Also give a
	better error message if no passdbs are set and a mechanism requires
	passdb.
	[395bc6e93222]

2005-12-25  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-append.c, src/imap/cmd-check.c, src/imap/cmd-copy.c,
	src/imap/cmd-expunge.c, src/imap/cmd-fetch.c, src/imap/cmd-idle.c,
	src/imap/cmd-noop.c, src/imap/cmd-search.c, src/imap/cmd-sort.c,
	src/imap/cmd-store.c, src/imap/cmd-thread.c, src/imap/imap-sync.c,
	src/imap/imap-sync.h:
	UID STORE command must return UID parameter in FETCH replies.
	[ce76b6b8ff11]

	* dovecot-example.conf, src/auth/passdb-pam.c:
	PAM: Changed -session to session=yes to be more consistent with
	other parameters. Check that invalid parameters aren't given. Added
	a few examples to configuration file.
	[852274ab176d]

	* src/imap/client.c, src/imap/cmd-append.c, src/imap/cmd-idle.c:
	IDLE: Sending "DONE" + next command in same TCP packet caused the
	next command not to be executed until yet another command came
	(which usually didn't happen).
	[454863612b5c]

2005-12-24  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/plugins/quota/quota-fs.c, src/plugins/quota/quota-
	fs.h:
	Fixed to work with struct dqblk.dqb_curspace also which is
	apparently the new Linux-way to do it.
	[4d44a337ac08]

2005-12-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/dbox/Makefile.am, src/lib-storage/index/dbox
	/dbox-file.c, src/lib-storage/index/dbox/dbox-sync-full.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox/dbox-
	sync.h, src/lib-storage/index/dbox/dbox-uidlist.c, src/lib-
	storage/index/dbox/dbox-uidlist.h:
	When index files (dovecot.index and dbox index) aren't synced with
	each others do a full sync.
	[ef482c909771]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c:
	Allow appending mails in wrong UID order. Sort them internally when
	committing.
	[cd2d1de1255f]

	* src/lib-index/mail-index-sync.c:
	ext_offsets can be higher than int_offsets, so check its validity
	instead before starting syncing.
	[f18a7d8ba375]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Fixes
	[d216077076b8]

	* src/lib/Makefile.am, src/lib/bsearch-insert-pos.c, src/lib/bsearch-
	insert-pos.h:
	Added bsearch_insert_pos(). Similar to bsearch(), but if value isn't
	found, returns the position where it would be inserted.
	[23c401a76dc9]

	* src/lib-storage/index/dbox/dbox-uidlist.c:
	Use binary search for finding entries
	[5fcf8e16ba8c]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-uidlist.c:
	Use DBOX_MAIL_FILE_PREFIX macro
	[1c830ec05cb5]

	* src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox/dbox-
	sync.h:
	Write flag changes to dbox files.
	[ca188c8f1457]

2005-12-14  Timo Sirainen  <tss@iki.fi>

	* src/lib/module-dir.c, src/plugins/imap-quota/Makefile.am,
	src/plugins/quota/Makefile.am, src/plugins/trash/Makefile.am:
	Load plugins in sorted order. Prefixed plugins with nn_ set their
	order.
	[d531130a0e4d]

	* src/lib-dict/dict.c, src/lib-dict/dict.h:
	API changes
	[aea926f980b8]

	* configure.in, src/plugins/quota/Makefile.am, src/plugins/quota
	/quota-fs.c, src/plugins/quota/quota-fs.h,
	src/plugins/quota/quota.c:
	quotactl() quota checking support
	[768770a01733]

	* src/plugins/imap-quota/imap-quota-plugin.c, src/plugins/imap-quota
	/imap-quota-plugin.h:
	Init/deinit function names were wrong
	[b752272e6355]

	* AUTHORS, configure.in, src/lib/Makefile.am, src/lib/ioloop-kqueue.c:
	Added kqueue support. Patch by Vaclav Haisman.
	[194295062e5e]

	* src/auth/passdb.c, src/auth/userdb.c:
	Give a few helpul suggestions with "Unknown passdb/usedb driver"
	errors.
	[1649ca519b7d]

2005-12-12  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-select.c:
	Compile fix
	[68a49ef45dfc]

2005-12-11  Timo Sirainen  <tss@iki.fi>

	* src/lib/module-dir.c:
	If we see libplugin.so, initialize it with plugin_init(), not
	libplugin_init().
	[b1bc70f5862c]

	* configure.in:
	Don't allow giving invalid notify methods in --with-notify
	[840cc63e439b]

	* TODO, configure.in:
	Alpha5 release
	[d362e79fdb97]

	* src/lib-dict/Makefile.am, src/plugins/imap-quota/Makefile.am,
	src/plugins/quota/Makefile.am, src/plugins/trash/Makefile.am:
	Added missing header files. Fixed plugin install hooks to use
	DESTDIR.
	[146a924333aa]

	* src/master/syslog-util.c:
	Some syslog facilities aren't defined everywhere. Put #ifdefs around
	them.
	[dc84dc2d0e9a]

2005-12-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/driver-mysql.c:
	fix
	[8c0efcbc3146]

	* src/lib-sql/driver-pgsql.c:
	fix
	[23ac50bedc47]

	* doc/dovecot-ldap.conf, doc/dovecot-sql.conf, dovecot-example.conf:
	Added some more information about prefetch userdb.
	[ab929802ad6c]

	* configure.in, src/Makefile.am, src/plugins/.cvsignore,
	src/plugins/Makefile.am, src/plugins/imap-quota/.cvsignore,
	src/plugins/imap-quota/Makefile.am, src/plugins/imap-quota/imap-
	quota-plugin.c, src/plugins/imap-quota/imap-quota-plugin.h,
	src/plugins/quota/.cvsignore, src/plugins/quota/Makefile.am,
	src/plugins/quota/quota-dict.c, src/plugins/quota/quota-dirsize.c,
	src/plugins/quota/quota-plugin.c, src/plugins/quota/quota-plugin.h,
	src/plugins/quota/quota-private.h, src/plugins/quota/quota-
	storage.c, src/plugins/quota/quota.c, src/plugins/quota/quota.h,
	src/plugins/trash/.cvsignore, src/plugins/trash/Makefile.am,
	src/plugins/trash/trash-plugin.c, src/plugins/trash/trash-plugin.h:
	Added beginnings of plugin infrastructure. TODO: These could be
	optionally compiled into binaries with some configure options.

	Added quota plugin and a new trash plugin. Not very well tested.
	[732b62dc1976]

	* configure.in, src/Makefile.am, src/lib-dict/.cvsignore, src/lib-
	dict/Makefile.am, src/lib-dict/dict-private.h, src/lib-dict/dict-
	sql.c, src/lib-dict/dict-sql.h, src/lib-dict/dict.c, src/lib-
	dict/dict.h:
	Added dictionary API and implementation for SQL. It's meant for
	looking and modifying key=value pairs. In future we may need to use
	this for many different things, but for now it's only used by quota-
	dict plugin.
	[d67092398377]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/sql-api-private.h, src/lib-sql/sql-api.c, src/lib-sql/sql-api.h:
	Added support for transactions and synchronous SQL queries.
	[3dd0ab18d8da]

	* src/lib-storage/index/index-transaction.c, src/lib-storage/mail-
	storage-private.h:
	Added module_contexts to transactions.
	[ba95b4cd33aa]

2005-12-06  Timo Sirainen  <tss@iki.fi>

	* src/pop3/main.c:
	Don't allow pop3_uidl_format without at least one valid %var in it.
	[b1fa09b19b86]

	* src/pop3/commands.c:
	Make pop3_reuse_xuidl setting actually work. Patch by grant beattie.
	[74b27d1e17a4]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Fixed broken index directory creation change
	[bdeac77a4127]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	src/auth/userdb-ldap.c:
	If LDAP lookup fails because connection gets closed, try retrying it
	again after reconnect.
	[0a7beabfe332]

	* src/auth/passdb-checkpassword.c:
	Added better logging
	[fd0df9ddd688]

	* src/auth/main.c:
	Deinitialize userdbs/passdbs first, so they can still generate auth
	failure replies without crashing.
	[86e1a19b0a9e]

	* src/auth/auth-request.c, src/auth/passdb-cache.c:
	Don't crash if cache key isn't set but cache is enabled.
	[64ed35c97678]

	* src/imap/cmd-idle.c:
	If DONE was sent while output was still being sent to clients, we
	didn't deinitialize syncing properly. That output mustn't get lost
	anyway, so now DONE isn't accepted until all output is sent.
	[de92177c8113]

	* dovecot-example.conf:
	mailbox_idle_check_interval comment updated
	[ad1e6b8a5109]

2005-12-03  Timo Sirainen  <tss@iki.fi>

	* src/master/syslog-util.c, src/master/syslog-util.h:
	Forgot to add in syslog_facility commit
	[cf8933dabc95]

2005-12-02  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/auth/main.c, src/imap/main.c, src/login-
	common/main.c, src/master/Makefile.am, src/master/main.c, src/master
	/master-settings.c, src/master/master-settings.h, src/pop3/main.c:
	Added syslog_facility setting to config file.
	[d22c883021da]

	* src/lib-index/mail-index-transaction.c:
	mail_index_keywords_create_from_indexes(): Don't crash with 64bit
	systems if there are only 0 keywords.
	[17492616f363]

	* doc/dovecot-ldap.conf:
	Comment changes to reflect the new way to configure pass_attrs and
	user_attrs (which has been there for months already, the old way
	still works too).
	[eed9f0930756]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-transaction.c:
	Logic/comments cleanups. Keep uidlist locked a bit shorter time.
	[d46abb12934a]

2005-11-28  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/dbox/.cvsignore, src/lib-
	storage/index/dbox/Makefile.am, src/lib-storage/index/dbox/dbox-
	file.c, src/lib-storage/index/dbox/dbox-file.h, src/lib-
	storage/index/dbox/dbox-list.c, src/lib-storage/index/dbox/dbox-
	mail.c, src/lib-storage/index/dbox/dbox-save.c, src/lib-
	storage/index/dbox/dbox-storage.c, src/lib-storage/index/dbox/dbox-
	storage.h, src/lib-storage/index/dbox/dbox-sync-expunge.c, src/lib-
	storage/index/dbox/dbox-sync.c, src/lib-storage/index/dbox/dbox-
	sync.h, src/lib-storage/index/dbox/dbox-transaction.c, src/lib-
	storage/index/dbox/dbox-uidlist.c, src/lib-storage/index/dbox/dbox-
	uidlist.h:
	Initial implementation of Dovecot's own high performance file
	format, named dbox. Currently relies heavily on index files to work,
	and isn't able to rebuild them if they're lost. This will be fixed
	soon. Not tested much yet in general.
	[fd0986477809]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Minor error handling fix
	[13b968e8e16e]

2005-11-25  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	"userdb prefetch" should be commented out by default.
	[c62c573560c1]

	* src/lib/Makefile.am, src/lib/hex-dec.c, src/lib/hex-dec.h:
	Added decimal <-> hex string translation functions.
	[599cd2c5d512]

	* src/lib-index/mail-index-transaction.c, src/lib/Makefile.am, src/lib
	/seq-range-array.c, src/lib/seq-range-array.h:
	Moved seq_range_*() functions to more generic ones in lib/.
	[821035fdc9f6]

	* src/lib/file-dotlock.c, src/lib/file-dotlock.h:
	Added file_dotlock_get_lock_path()
	[9680bd9e6346]

2005-11-20  Timo Sirainen  <tss@iki.fi>

	* src/pop3/main.c:
	Changed "pop3_uidl_format not set" error message.
	[1c50dc060e68]

2005-11-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	MAILBOX_OPEN_NO_INDEX_FILES flagfix.
	[123d9ec53bb7]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't create index directory if we're not using index files
	[8a613c365447]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Using MAILBOX_OPEN_NO_INDEX_FILES caused crashes in deinitialization
	[8f38c99146fc]

2005-11-04  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream.h:
	API description update
	[fd00b618679d]

2005-11-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Assert change
	[789c01f91c1f]

	* src/lib-storage/index/mbox/mbox-sync.c:
	We could have assert-crashed when expunging messages.
	[ba6a93bb21b9]

2005-10-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-auth/auth-server-connection.c:
	Give error message if auth server didn't return mechanism list.
	[c278d40d99e7]

	* src/imap-login/client.c, src/imap-login/client.h:
	If capability is sent in greeting, don't send it before we have
	received authentication capabilities from auth process.
	[2422546e3c44]

	* configure.in:
	MIT kerberos v1.2 (and older) doesn't work with us.
	[561e81dfa20b]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	If mail had more extra space in X-UID header than in X-Keywords
	header (but X-Keywords existed), we broke when rewriting it.
	[83b65734e32e]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Make sure we are seeked to correct position if using the last mail's
	mail_ctx directly.
	[736583a848a9]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	We were handling wrapped X-IMAPbase and X-Keywords headers very
	badly.
	[50e6aeff6b6d]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	Handle duplicate keywords in X-Keywords header properly
	[e9742e1f3741]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	We added LF+TAB unneededly at the beginning of each X-Keywords
	header.
	[5ca6f0751346]

	* src/lib-index/mail-index-sync-ext.c:
	Growing extension headers broke other extensions, unless it was the
	first extension. Meaning adding keywords caused crashes.
	[5b7087ba4118]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Set mail_ctx=NULL always after doing something for the last mail,
	even if we didn't rewrite its headers. Otherwise internal state
	breaks and we'll crash.
	[b358ee31b5ea]

	* src/lib-mail/message-body-search.c:
	Added an assert
	[0353f93f57bc]

	* src/lib-mail/message-part-serialize.c:
	Validate deserialization better.
	[1e1beaff9207]

	* src/auth/auth-request.c, src/auth/mech-apop.c, src/auth/mech-
	gssapi.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth
	/mech-plain.c, src/auth/mech-rpa.c:
	Use a bit larger initial pool sizes
	[4f8598b0ca62]

	* src/auth/auth-cache.c, src/auth/auth-cache.h, src/auth/passdb-
	ldap.c, src/auth/passdb-sql.c:
	cache_key was set wrong for sql/ldap passdbs, so auth_cache was
	completely broken with them
	[12d00d9ceb6e]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Don't crash with empty mboxes
	[b4fac5616c03]

	* src/master/login-process.c:
	Comment update
	[162ad2307710]

	* src/master/login-process.c:
	Don't call initgroups() at the start of login processes.
	[e167b71e37e3]

	* doc/variables.txt, src/master/mail-process.c:
	Added %i for UID
	[5595ed76d4c9]

	* src/auth/main.c, src/deliver/deliver.c, src/imap/main.c,
	src/pop3/main.c:
	Ignore SIGALRM signal. We don't want to crash when it happens.
	[8b68997d6e34]

	* src/lib-index/mail-cache-transaction.c:
	mail_cache_delete(): Make sure we don't get to infinite loop if
	cache records contain a loop.
	[1e6af9a000e6]

2005-10-27  Timo Sirainen  <tss@iki.fi>

	* doc/variables.txt, src/auth/auth-request.c:
	%w contains now password
	[629ffe1a3874]

	* configure.in:
	typofix
	[1b86be09b41e]

	* src/lib/ioloop-epoll.c:
	And even more log verbosity
	[dd71819db08e]

	* src/lib/ioloop-epoll.c:
	Added more verbosity to epoll_ctl() failure messages.
	[59b8ac4c031e]

	* AUTHORS, configure.in, dovecot-example.conf, src/auth/Makefile.am,
	src/auth/auth.c, src/auth/mech-anonymous.c, src/auth/mech-apop.c,
	src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c, src/auth/mech-
	gssapi.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth
	/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	src/auth/mech.h, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added GSSAPI support. Patch by Jelmer Vernooij and some fixes by
	pod@herald.ox.ac.uk
	[28cca6317829]

	* src/auth/auth-request.c:
	Non-plaintext authentication and passdb cache didn't work together.
	Patch by Andrey Panin.
	[0207808033ad]

	* src/lib/network.c:
	Use read() instead of recv() in net_receive(), so it works even with
	non-sockets. We weren't using any recv()'s flags anyway, so it
	shouldn't matter.
	[771cd6776d4b]

	* src/lib-storage/index/mbox/mbox-lock.c:
	Having "dotlock fcntl" locking assert-crashes if dotlock file
	already exists.
	[475c1fe28dad]

	* dovecot-example.conf:
	Added a note to Solaris users about lock_method.
	[3ba5ee54fa3c]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	if message was only 0-1 bytes, we skipped the whole message which
	caused crashes
	[bae46114f240]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	When rewriting mbox, don't parse the last message again. We already
	have its contents in mail_ctx, so pass it over to rewriter so it can
	reuse it. This fixes also a crash when last message's header ended
	unexpectedly and mbox file was grown (the added NULs were treated as
	the last message's headers).
	[6f58deb34e8a]

	* src/lib-mail/message-parser.c:
	If message header ends unexpectedly, return it anyway instead of
	ignoring it completely.
	[617213ed79b5]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	If mbox file contains only single LF, treat it as an invalid mbox
	file instead of breaking later.
	[bcefda9b7745]

	* src/lib-storage/index/mbox/mbox-sync.c:
	When updating pseudo mail, we also tried to update it as the first
	mail in index file. Normally it shouldn't have mattered, but if
	there were no mails in mailbox it caused a crash.
	[0bca23bf1b71]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	When expunging the first mail that has X-IMAPbase header and moving
	it to next mail, make sure the X-UID header gets appended after
	X-IMAPbase header. Otherwise UIDs of all mails will change.
	[9dd3cdef8644]

2005-10-20  Timo Sirainen  <tss@iki.fi>

	* src/lib/compat.h:
	#ifdef TRU64 -> __osf__
	[b18e05b0170d]

	* configure.in, src/lib/compat.h:
	Include inttypes.h with Tru64 to get uint32_t etc. types defined.
	[77135b9e26b5]

	* TODO, configure.in:
	1.0alpha4
	[81e73a6714c1]

	* src/auth/auth-request.c, src/auth/auth-request.h, src/auth/auth-
	worker-client.c, src/auth/passdb-ldap.c, src/auth/passdb-sql.c:
	If passdb returned NULL password (ie. no password needed), it wasn't
	cached correctly.
	[09b5e002ad8a]

2005-10-19  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	nologin/proxy are now always in boolean format, ie. without any
	"=Y".
	[c9f1bd1e1ec2]

	* configure.in, dovecot-example.conf, src/auth/Makefile.am, src/auth
	/userdb-passdb.c, src/auth/userdb-prefetch.c, src/auth/userdb.c:
	Renamed userdb passdb to prefetch.
	[b7569a6a4ada]

	* src/auth/passdb-blocking.c:
	Blocking passdb didn't set nologin/proxy/nodelay flags for the
	request.
	[b381c9b899a2]

	* src/lib/ostream-file.c:
	Revert previous "cleanup" which broke things.. Added a comment.
	[1f4b4387595b]

2005-10-16  Timo Sirainen  <tss@iki.fi>

	* src/pop3/main.c:
	Complain about missing pop3_uidl_format also if it's empty
	[9bdf25784ac2]

	* src/pop3/commands.c:
	Don't send duplicate lines in LIST command when buffer is full.
	[6d485bf73429]

	* src/lib-storage/index/mbox/mbox-save.c:
	Instead of crashing when trying to copy mails within same mailbox,
	give an error message to user.
	[247501e81026]

	* dovecot-example.conf, src/master/master-settings.c, src/pop3/main.c:
	pop3_uidl_format is now required to be explicitly set. There is no
	default anymore.
	[a745511d591e]

	* src/deliver/deliver.c:
	Added -m parameter to store mail to non-INBOX mailbox without Sieve
	scripting.
	[f2d65601097c]

	* dovecot-example.conf:
	Added a warning about multiple passdbs to auth_cache_size.
	[7a04c13af9bc]

	* src/auth/auth-request.c, src/auth/auth-worker-client.c, src/auth
	/userdb-ldap.c, src/auth/userdb-passdb.c, src/auth/userdb-passwd-
	file.c, src/auth/userdb-passwd.c, src/auth/userdb-sql.c, src/auth
	/userdb-static.c, src/auth/userdb-vpopmail.c, src/auth/userdb.c,
	src/auth/userdb.h:
	Separated userdb_module's interface and the actual data struct. Now
	it's possible to have multiple userdbs of same type but with
	different settings.
	[fc4622b1c1ef]

	* src/auth/auth-cache.c, src/auth/auth-cache.h, src/auth/auth-
	request.c, src/auth/auth-worker-client.c, src/auth/auth.c, src/auth
	/db-ldap.c, src/auth/db-passwd-file.c, src/auth/db-passwd-file.h,
	src/auth/passdb-bsdauth.c, src/auth/passdb-checkpassword.c, src/auth
	/passdb-ldap.c, src/auth/passdb-pam.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-sql.c, src/auth/passdb-vpopmail.c, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/userdb-passwd-file.c:
	Separated passdb_module's interface and the actual data struct. Now
	it's possible to have multiple passdbs of same type but with
	different settings.
	[0c10475d9968]

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/passdb-
	bsdauth.c, src/auth/passdb-pam.c, src/auth/passdb-passwd-file.c,
	src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth/passdb-
	vpopmail.c:
	Make auth caching work with non-sql/ldap passdbs too.
	[fda241fa5d77]

	* src/auth/auth-request.c, src/auth/auth-worker-client.c, src/auth
	/passdb-blocking.c, src/auth/passdb-cache.c, src/auth/passdb-
	cache.h, src/auth/passdb-ldap.c, src/auth/passdb-passwd-file.c,
	src/auth/passdb-sql.c, src/auth/passdb.c, src/auth/passdb.h:
	Fixes and cleanups to credentials handling. Also fixed auth caching
	to work more correctly in case of internal failures.
	[62fc6883faeb]

	* src/lib/failures.c:
	Don't crash if reopening log file without separate info log file.
	[9adec8bb8a53]

	* src/lib/ostream-file.c:
	Cleanup
	[d408296d9a5d]

2005-10-15  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-sync.c:
	When output buffer got full while sending syncing changes, we sent
	the last change twice to client. This was bad if extra EXPUNGEs got
	sent..
	[440137d72ca0]

	* src/lib/ostream-file.c:
	Removed accidentally committed debug errors.
	[a2d7da8ad64e]

2005-10-12  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream-crlf.c:
	Type mismatch fixes
	[8484001f1584]

	* src/auth/passdb-pam.c, src/lib-index/mail-transaction-log-view.c,
	src/lib/ioloop-notify-dn.c:
	Fixed some printf-type mismatches
	[8c63af0ab91a]

2005-10-11  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Added compatibility warning about mail_save_crlf.
	[2c19efe2ddb6]

2005-10-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib-storage/index/mbox/mbox-sync.c, src/lib
	/istream-data.c, src/lib/istream-file.c, src/lib/istream-internal.h,
	src/lib/istream-limit.c, src/lib/istream-mmap.c, src/lib/istream-
	seekable.c, src/lib/istream.c, src/lib/istream.h, src/lib/ostream-
	file.c:
	Added exact parameter to i_stream_stat()
	[7af5162d934c]

2005-10-07  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-cache.c:
	Added some more verbosity to cache lookups.
	[f50496e14ac8]

	* src/auth/auth-request.c:
	We were caching failed blocking requests wrong.
	[81180ca12997]

	* src/auth/auth-cache.c:
	Don't crash with SIGUSR2 if auth cache hasn't seen any hits
	[6a94b8412638]

	* src/auth/main.c:
	Don't crash with SIGHUP/SIGUSR2 if auth_cache isn't used
	[5207179e47de]

	* src/lib-storage/index/mbox/mbox-storage.c:
	If mbox root directory doesn't exist, create it instead of just
	giving error message.
	[aab106e80c3c]

	* src/imap/cmd-copy.c, src/lib-storage/index/maildir/maildir-copy.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-storage
	/mail-copy.c, src/lib-storage/mail-copy.h, src/lib-storage/mail-
	storage-private.h, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h:
	Added flags and keywords parameters to mailbox_copy() in case
	they're wanted to be changed while copying.
	[3de464cb604f]

2005-10-05  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-master-connection.c:
	Added "master out" debugging also for USER queries from master (ie.
	from deliver)
	[e06617e148fc]

	* src/auth/userdb-static.c:
	Don't crash if there are keys without =value part in static userdb
	template.
	[35a6bc4876e4]

	* src/auth/userdb.c:
	Don't crash if we have blocking userdb but non-blocking passdb.
	[4e55969a6a93]

2005-10-04  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c, src/imap/namespace.c, src/pop3/main.c:
	And lock_method fixes..
	[e30f6e541c2f]

	* dovecot-example.conf, src/deliver/deliver.c, src/imap/namespace.c,
	src/lib-index/mail-index-lock.c, src/master/master-settings.c,
	src/pop3/main.c:
	Default lock_method to flock instead of fcntl. This is at least
	useful for not allowing Dovecot's indexes to be used accidentally
	with wrong settings in NFS mounted partitions.
	[08b768956051]

2005-10-01  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth-
	request.h, src/auth/auth.c, src/auth/auth.h, src/auth/passdb-
	blocking.c, src/auth/passdb-bsdauth.c, src/auth/passdb-passwd.c,
	src/auth/passdb-shadow.c, src/lib-auth/auth-client.h, src/lib-auth
	/auth-server-request.c, src/login-common/sasl-server.c, src/login-
	common/ssl-proxy-openssl.c, src/login-common/ssl-proxy.c, src/login-
	common/ssl-proxy.h, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added ssl_username_from_cert setting. Not actually tested yet..
	[c12df370e1b2]

	* src/lib/ioloop-notify-dn.c:
	Fixed fd leak
	[377f69be914f]

	* src/master/mail-process.c:
	If user's home directory is a non-directory (eg. /dev/null) fallback
	to /tmp without error message.
	[1e053e5e160d]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't break if mail root directory is '/'.
	[277906fcc8ea]

	* src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h:
	Don't try to check for notifications when mbox was opened from input
	stream.
	[fe63974d6365]

2005-09-30  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream.c:
	i_stream_stat() should return NULL for closed istreams
	[7a9ae11167de]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib/istream-data.c, src/lib/istream-file.c,
	src/lib/istream-internal.h, src/lib/istream-limit.c, src/lib
	/istream-mmap.c, src/lib/istream-seekable.c, src/lib/istream.c,
	src/lib/istream.h:
	Added i_stream_seek_mark() and used it
	[e05a1af4bbc7]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/mail-storage.h:
	Added MAILBOX_OPEN_NO_INDEX_FILES flag and made streamed mboxes by
	default also indexed.
	[571336db01f4]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-sync-update.c, src/lib-index/mail-cache-transaction.c, src
	/lib-index/mail-cache.c:
	Unlocking cache file can also corrupt it since it modifies it. Added
	a return value for it and checks to handle the failure. Fixes a
	crash in some error situations.
	[c0e35566dd14]

	* src/lib-index/mail-index-lock.c:
	Don't leak alarm() with in-memory indexes
	[68ab7800d735]

2005-09-29  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	And don't crash at exit..
	[04e62fc6230f]

2005-09-28  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c:
	ioloop needs to be created before setting signals or we crash
	[d53d0de2ffbb]

2005-09-27  Timo Sirainen  <tss@iki.fi>

	* src/lib/compat.h, src/lib/ostream-file.c:
	Use IOV_MAX instead of UIO_MAXIOV when available.
	[085ebc6e341c]

	* src/lib-storage/index/maildir/Makefile.am, src/lib-
	storage/index/mbox/Makefile.am:
	Removed lib-index/mbox and lib-index/maildir includes. They don't
	exist anymore.
	[b402cc8a5d44]

2005-09-25  Timo Sirainen  <tss@iki.fi>

	* src/lib/Makefile.am, src/lib/fd-set-nonblock.c, src/lib/fd-set-
	nonblock.h, src/lib/ioloop-notify-dn.c, src/lib/network.c:
	Added fd_set_nonblock() and changed net_set_nonblock() to use it.
	[3ae2df67459c]

	* src/auth/auth-cache.c, src/auth/main.c, src/deliver/deliver.c,
	src/imap/main.c, src/lib/lib-signals.c, src/lib/lib-signals.h, src
	/login-common/main.c, src/master/main.c, src/pop3/main.c:
	Implemented new signal handling framework, which makes handling
	signals much easier.
	[3360cc019737]

	* src/lib/strfuncs.c:
	*_strsplit_spaces(): Ignore trailing spaces.
	[86ddbe18538c]

	* src/lib/ostream-file.c, src/lib/ostream-internal.h,
	src/lib/ostream.c, src/lib/ostream.h:
	Changed iov_count to be unsigned int, it's large enough. Added
	overflow-flag which gets sent if send() failed to both send and
	buffer the given data.
	[a16f27ce2eda]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib/lib.c, src/lib/lib.h:
	Removed null4 and replaced the few uses of it with
	buffer_append_zero().
	[904849549eac]

	* src/lib/hash.c, src/lib/hash.h:
	Added hash_copy() and added some consts
	[906b87e236bf]

	* src/lib/strfuncs.c, src/lib/strfuncs.h:
	Added p_strsplit(), p_strsplit_spaces() and strarray_remove()
	[0a885029543b]

	* src/lib/ioloop-poll.c:
	minor cleanup
	[67703a43b23f]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-poll.c, src/lib/ioloop-
	select.c, src/lib/ioloop.h:
	Added IO_ERROR condition that we can watch now.
	[c4c1b538d8d0]

2005-09-24  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-epoll.c:
	Don't leak epoll fd to child processes. Memory allocations were
	wrong for 64bit systems. Changed the code to use array_t.
	[c64473977187]

	* src/auth/db-passwd-file.c:
	When passwd-file has %d, drop domain names from username lookups
	only if %d was given without any modifiers.
	[5d92a45fc751]

	* dovecot-example.conf:
	imap.deny -> dovecot.deny
	[24d9c17b4cb6]

	* dovecot-example.conf, src/auth/auth-request.c, src/auth/auth.c,
	src/auth/auth.h, src/auth/passdb.c, src/auth/passdb.h, src/master
	/auth-process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added deny password databases.
	[ea2266d0a07f]

	* src/auth/db-passwd-file.c:
	Read also users without password.
	[b86d4c76efdf]

	* src/login-common/main.c, src/master/login-process.c:
	Several fixes to make running from inetd working again
	[a2dd3d895e00]

	* src/auth/auth-request.c, src/auth/auth-request.h:
	If passdb lookup fails with internal error, try other passdbs anyway
	before returning internal failure.
	[8a8352cda514]

	* src/auth/userdb-blocking.c:
	If blocking userdb lookup fails, don't crash. Also we shouldn't stop
	trying other userdbs then.
	[c533051d19cd]

	* src/lib-index/mail-index-sync-ext.c:
	Resizing header left header offsets broken and usually assert-
	crashed while doing it.
	[9d2345ba4e30]

	* src/lib-index/mail-index-private.h:
	Added some comments
	[36e1899b109b]

	* src/imap/cmd-append.c:
	Call o_stream_uncork() after sending "+ OK", so it gets to client
	more quickly.
	[c6ebda431efa]

	* src/imap/client.c:
	client_send_line(): Try flushing output immediately if buffer gets
	full.
	[edc6e213048f]

2005-09-23  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	alpha3
	[33e3b0899b47]

	* dovecot-example.conf:
	Added a warning about auth-master socket permissions
	[0229cb5e4384]

	* dovecot-example.conf:
	Changed /var/run/dovecot/auth-master to /var/run/dovecot-auth-master
	[3e737ed2f57b]

	* src/auth/main.c:
	Increased count of UNIX socket listener backlogs to 64.
	[aeb53e34d1f4]

	* src/lib-mail/rfc822-parser.c:
	Parse obs-phrase correctly. Patch by Chris Wakelin
	[71472bab2cbb]

2005-09-18  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Added information about userdb passdb.
	[4d2ee2274c70]

	* configure.in, src/auth/mycrypt.c:
	And more changes to get _XPG6 stuff working right
	[f1b407e8debb]

	* src/auth/mycrypt.c:
	Add _XPG6 macro if needed..
	[fa4cbca22d26]

	* src/imap/imap-fetch-body.c, src/imap/imap-search.c:
	Compiler warning fixes
	[5434d427df49]

	* src/lib/file-dotlock.c:
	compiler warning fix
	[69f731759776]

	* configure.in:
	Added check for _XPG6 macro for crypt().
	[340e1b87c27b]

	* src/master/main.c:
	Added --build-options parameter. Patch by Andrey Panin
	[fead84acb13c]

	* src/lib-storage/index/maildir/maildir-save.c:
	typofix in error message
	[1c90049a2ec8]

	* src/lib-storage/index/maildir/maildir-save.c:
	If o_stream_send_istream() fails, write an error to log.
	[1a1f0ec613d6]

	* src/imap/cmd-append.c:
	If client input was closed unexpectedly, don't treat it as index
	error.
	[2cb7ebd43e8c]

	* src/lib-storage/index/mbox/mbox-lock.c:
	Don't hide error message if fcntl() fails with EAGAIN/EACCES
	[1eb7b2ad1ac0]

	* src/login-common/ssl-proxy-openssl.c:
	Don't require private key to be RSA
	[b686c8bbcd6f]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Partial syncs caused index's next_uid to be updated even if the new
	mails weren't added to index. That caused some UID corruption
	errors.
	[a45208fe7c83]

	* src/lib-index/mail-index.c:
	When creating a new index file, mark its log offsets so that the
	possibly existing log file is completely synced. This caused marking
	index to be corrupted to be quite useless since the same problem was
	again brought back from the .log file.
	[bfa542369fdc]

	* src/imap-login/client.c, src/pop3-login/client.c:
	Make sure corking is removed before calling ssl_proxy_new()
	[cb143fc37b58]

	* src/login-common/ssl-proxy-openssl.c:
	Cork/uncork the SSL socket when writing. Reduces latency a lot.
	[748ee6f41fc1]

	* src/lib-storage/index/maildir/maildir-sync.c:
	We were forcing a maildir resync when it hadn't changed at all.
	[09565508b8ba]

	* src/master/master-settings.c:
	Default to ssl_disable=no always, even if SSL isn't compiled in. If
	SSL isn't compiled in and ssl_disable=no, complain immediately.
	[a0f99c5a6961]

	* src/lib/network.c:
	s/SOL_TCP/IPPROTO_TCP/
	[51d30414b8bd]

2005-09-16  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-dotlock.c:
	If dotlock is overwritten/deleted, say in the error message how long
	we kept the lock.
	[827c7137fd78]

2005-09-11  Timo Sirainen  <tss@iki.fi>

	* TODO, configure.in:
	alpha2 released
	[e1888f3d3423]

	* doc/variables.txt:
	Added %R and %H documentation
	[08ee6a4ed96e]

	* src/lib/var-expand.c:
	Added 'R' reverse modifier.
	[85e509808c30]

	* src/lib/var-expand.c:
	Fix to hash modifier handling
	[bb648f016990]

	* src/imap/cmd-search.c, src/lib-imap/imap-bodystructure.c, src/lib-
	imap/imap-parser.h, src/lib-mail/message-header-search.c,
	src/pop3-login/client-authenticate.c:
	Compiler warning fixes
	[b871cd1dc60c]

	* src/lib-imap/imap-bodystructure.c:
	"stack frame changed" crashfix
	[6ea104e75c3d]

	* src/auth/userdb-vpopmail.c:
	Compile fix
	[1b2d685d1660]

	* dovecot-example.conf:
	s/login_process_per_user/login_process_per_connection/
	[1081888c1407]

	* src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h, src/pop3/commands.c, src/pop3/common.h,
	src/pop3/main.c:
	Added pop3_reuse_xuidl setting. Patch by Chris Wakelin
	[58e3fa234ef4]

2005-09-01  Timo Sirainen  <tss@iki.fi>

	* src/lib/var-expand.c:
	Added 'H' hash modifier.
	[0355b805cd4c]

2005-08-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c:
	assert fix
	[2b167cc13887]

2005-08-28  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-dotlock.c, src/lib/file-dotlock.h:
	Support creating locks with O_EXCL.
	[d3f246330d37]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Compiler warning fix
	[505a5f3f3857]

	* src/lib-storage/index/mbox/mbox-from.c:
	Timezones in From-lines weren't handled correctly.
	[ce873eed7b21]

	* dovecot-example.conf:
	Change mail setting in static userdb not to use %h since it doesn't
	work.
	[7faf81f89cab]

	* src/lib-index/mail-cache-transaction.c:
	We could have written corrupted data to cache file if it had just
	been compressed. Also did some other cleanups.
	[3533923e786f]

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Try harder to notice bugs
	[bf294d77e1ec]

2005-08-27  Timo Sirainen  <tss@iki.fi>

	* src/pop3/commands.c:
	Fix
	[bfd47c33c46d]

	* src/pop3/commands.c:
	If more mail comes after we have synced ourself initially, don't
	access/show the new mails. For example UIDL could have shown more
	than needed, and it may have expunged the new mails when quitting.
	[ca22e27202b2]

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log.c:
	Index creation was racy.
	[6170e2e5992a]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index.c,
	src/lib-index/mail-transaction-log.c:
	When refreshing transaction log while trying to find new log file,
	don't recreate the log file if it wasn't found or was corrupted.
	Things have already broken at that point and recreating it could
	cause recurseive mail_index_map() call with mmap_disable=yes.

	Also added more assert()s to check that we don't try to recursively
	call mail_index_map().
	[afe8ab9072f0]

	* src/lib-index/mail-index-fsck.c:
	Call mail_index_map() with force=TRUE parameter. Required if
	mmap_disable=yes, otherwise we'd be fscking our internal index built
	using transaction log.
	[4b9957c31e1f]

	* src/lib-index/mail-cache.c:
	Don't try refresh index file while locking it. It just slows down
	things, is rarely useful and may break sometimes with
	mmap_disable=yes. Also we were calling it after
	mail_index_view_open() so it wasn't even working..
	[aa071f73382c]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-transaction-
	log.c:
	More error message fixing
	[6a1ea27a4256]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	decisions.c, src/lib-index/mail-cache-lookup.c, src/lib-index/mail-
	index-lock.c, src/lib-index/mail-index.c, src/lib-index/mail-
	transaction-log.c:
	Removed fcntl() text from some locking error messages, because if
	lock_method=flock, it was done using flock().. Also did several
	s/it's/its/ in comments and one error message.
	[65dc45982df9]

2005-08-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	Error message update
	[6fbdd79b32a5]

	* src/lib-index/mail-index-sync-keywords.c:
	We didn't add the ending NUL character in keyword name, which caused
	more or less random failures.
	[3c5eb0649d5a]

2005-08-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync-update.c:
	X-IMAPbase's uid-last offset was remembered wrong in some cases.
	Added also an extra assert.
	[63ac77faeac8]

	* src/lib-storage/index/mbox/mbox-from.c:
	Allow day field to contain only a single digit without preceding
	zero/space.
	[2909b1c2fddf]

	* src/lib-storage/mail-storage.c:
	If autodetection failed, give an error message so we don't just get
	"Failed to create storage with data .."
	[b954a513257f]

2005-08-18  Timo Sirainen  <tss@iki.fi>

	* src/lib/network.c:
	Don't log extra bind() errors for net_listen_unix() either
	[0b6539bc22b9]

	* src/lib-storage/index/maildir/maildir-copy.c:
	Disable hardlink copying until it's fixed
	[f1ecf7ee63db]

	* TODO:
	update
	[d597feda0c5e]

	* src/lib-index/mail-transaction-log-append.c:
	Removed fsync() call when appending to transaction log file. It's
	not all that important and just slows down.
	[ca2121e0d582]

	* TODO:
	update
	[3cc9212b1c66]

2005-08-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	We weren't properly checking if X-IMAPbase header was seen when we
	parsed X-UID header. Could cause assert-crash while rewriting.
	[0ddbfc6aa2d7]

2005-08-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail.c:
	If mail_get_stream() is called when stream had already been used and
	seeked to non-start, it calculated the header/body sizes wrong.
	[7a94871543f5]

	* configure.in:
	Forgot to commit parts of the inotify patch
	[261d98a81d74]

	* src/lib/network.c:
	net_listen(): Print bind() errors only if it's not EADDRINUSE. Also
	do the same for listen().
	[5ff3b88db948]

	* src/imap/imap-sort.c, src/lib-storage/index/mbox/mbox-sync.c:
	If UID lookup doesn't return any sequences, don't crash
	[6da16ce12b14]

	* src/master/main.c:
	The master process itself also needs the TZ environment
	[08b3e3fd0bc5]

	* src/lib-storage/index/index-mailbox-check.c, src/lib-storage/index
	/index-storage.h, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib/ioloop-internal.h,
	src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-inotify.c, src/lib
	/ioloop-notify-none.c, src/lib/ioloop.c, src/lib/ioloop.h:
	New inotify code and notify API change. Patch by Johannes Berg
	[a9be1824403b]

2005-08-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-auth/auth-server-connection.c:
	If UNIX socket connection fails with EAGAIN, try again for a while.
	[3ec5c6665bec]

	* src/auth/auth-worker-server.c:
	If auth worker socket isn't created yet when we try to connect to
	it, try for 5 seconds before aborting. (previous fix didn't work)
	[4f7427a5be61]

	* src/lib/module-dir.c:
	If DEBUG environment is set, module_load_dir() now prints some
	debugging
	[c506ec006de5]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h:
	Recursive maildir uidlist syncs caused assert crashes. Also did some
	cleanups.
	[e9695ec7925b]

	* src/auth/userdb-passdb.c:
	Removed accidentally committed debugging change
	[e963246c0981]

	* src/auth/userdb-static.c:
	Added missing t_pop() call. static userdb was broken.
	[e8541dcd0c74]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-poll.c, src/lib/ioloop-
	select.c, src/lib/ioloop.c:
	If we leaked a t_pop() call, tell where it happened
	[56df153e9f65]

2005-08-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-stream.c, src/auth/auth-stream.h:
	Accidentally committed earlier parts of changes to authentication
	streams, which tries to make sure that no TABs or LFs are sent in
	any values to mess up things. This commit now finishes it..
	[0bcee5d7da39]

2005-08-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c:
	Fixed a hang if parsed header was already cached.
	[8ac16ccc3c73]

	* src/lib-storage/index/index-storage.c:
	Don't try to use cached index if it doesn't exist anymore.
	[67179bfce30f]

	* src/lib/network.c:
	Added some more error messages. Also if net_connect_ip() gives my_ip
	parameter and it can't be given to bind(), don't silently ignore it.
	[d1ed3b3548db]

	* src/master/master-settings.c:
	Section closing wasn't done properly. Patch by Tom Alsberg
	[3d9667c5b133]

	* src/lib-storage/index/mbox/mbox-sync.c:
	If mbox file growing failed, truncate it back to original size so
	extra NUL chars aren't left at the end of it.
	[3ccf9db0d117]

	* doc/auth-protocol.txt, doc/index.txt, src/auth/Makefile.am, src/auth
	/auth-master-connection.c, src/auth/auth-request-handler.c, src/auth
	/auth-request.c, src/auth/auth-request.h, src/auth/auth-worker-
	client.c, src/auth/passdb-blocking.c, src/auth/passdb-
	checkpassword.c, src/auth/passdb.h, src/auth/userdb-blocking.c,
	src/auth/userdb-ldap.c, src/auth/userdb-passdb.c, src/auth/userdb-
	passwd-file.c, src/auth/userdb-passwd.c, src/auth/userdb-sql.c,
	src/auth/userdb-static.c, src/auth/userdb-vpopmail.c,
	src/auth/userdb.c, src/auth/userdb.h, src/imap/client.h, src/imap
	/cmd-idle.c, src/lib-imap/imap-parser.h, src/lib-mail/message-
	parser.h, src/lib-sql/sql-api.h, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h, src/lib-storage/subscription-file/subscription-
	file.h, src/lib/file-cache.h, src/lib/istream.h, src/lib/read-
	full.h, src/lib/strfuncs.c, src/lib/write-full.h, src/login-common
	/ssl-proxy-gnutls.c, src/login-common/ssl-proxy.h:
	s/occured/occurred/
	[e2fe8222449d]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	Don't crash in some situations with broken X-UID headers.
	[7addee16b026]

2005-07-29  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-connection.c, src/auth/auth-request-handler.c,
	src/auth/auth-request-handler.h:
	Removed unused code
	[c444e76648e8]

	* src/imap/cmd-fetch.c, src/imap/commands-util.c, src/imap/imap-
	search.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/pop3/client.c:
	Added separate "temporary error" flag for
	mail_storage_get_last_error().
	[46bfbbcc3c54]

2005-07-24  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Preserve TZ environment to child processes so timezones aren't lost
	with AIX.
	[71b0ccba8cf3]

2005-07-23  Timo Sirainen  <tss@iki.fi>

	* src/imap/commands-util.c, src/imap/commands-util.h, src/imap/imap-
	sync.c:
	Send untagged FLAGS / PERMANENTFLAGS replies if keywords list
	changed.
	[1c9f3264f2fc]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't even open mbox file when changing flags and
	mbox_lazy_writes=yes
	[31b5b232c783]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Error handling fix, more debugging and a new assert
	[4d3be62d9db9]

	* src/lib-storage/index/index-mail.c:
	If header wasn't already parsed when opening mail, we read the whole
	message as its header and left body empty. Happened with maildir.
	[83c0a3e62722]

2005-07-22  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	ssl_cipher_list setting needs to be uppercased ALL:!LOW or it won't
	work (there was no problem unless the setting was uncommented).
	[d6d8cdd9b0fa]

	* dovecot-example.conf, src/imap/cmd-subscribe.c:
	Updated behavior of tb-extra-mailbox-sep
	[2910fde2725d]

	* dovecot-example.conf:
	Update about PAM -session.
	[5cec18e2ddd1]

	* src/auth/passdb-pam.c:
	Open/close PAM session if -session option is given. Patch by Pasi
	Sj�m.
	[b85c96ba56df]

	* src/auth/password-scheme.c:
	digest_md5_generate(): If username isn't given, give an error
	message instead of crashing. Mostly to avoid crashing with dovecotpw
	utility.
	[5bec038753f5]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Reverted accidental commit.
	[c17e810208a6]

	* dovecot-example.conf, src/imap/cmd-delete.c, src/imap/cmd-
	subscribe.c, src/imap/common.h, src/imap/main.c:
	Added tb-extra-mailbox-sep IMAP workaround.
	[0e05687892dc]

	* src/auth/db-passwd-file.c, src/auth/db-passwd-file.h, src/auth
	/passdb-passwd-file.c, src/auth/userdb-passwd-file.c:
	Added support for variables in passwd-file path.
	[ee0e39cf4ca5]

	* src/lib-mail/message-header-search.c:
	Try to compare strings even if charset conversion failed.
	[c727a35c9602]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/userdb-ldap.c:
	user_global_uid and user_global_gid settings weren't working. Also
	changed them to now allow named user/group.
	[5e78500f1aee]

	* src/login-common/client-common.c:
	We printed "SSL" to log for localhost connections. Use "secured"
	instead.
	[51ffafcee2b8]

	* src/lib-storage/index/mbox/mbox-lock.c:
	added extra assert for checking deadlocks
	[98cf57713f0a]

	* src/lib-storage/index/maildir/maildir-save.c:
	Fix potential deadlocking while saving messages.
	[35be29ba348d]

2005-07-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/mbox/mbox-list.c:
	Give error message if mailbox listing fails. Don't crash with mbox
	if .subscriptions file couldn't be opened.
	[910620d1e19e]

	* src/lib-index/mail-index.c:
	Check that record alignmentation is actually used correctly. If not,
	recreate the index.
	[872218271484]

2005-07-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-address.c:
	If address doesn't have a name, return it as NULL instead of "".
	This fixes problems with some clients. Patch by Chris Wakelin
	[51bf11f92c07]

2005-07-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c:
	Keep record size divisible with maximum wanted extension field
	alignment.
	[5ed3f06cd1b8]

	* src/lib-index/mail-cache-fields.c:
	mail_cache_register_get_list(): Allocate the returned strings also
	from given pool to make sure they don't get changed.
	[7cab5dc6a0cd]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.h:
	Header caching was more or less broken.
	[3cc5229f1560]

	* src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-inotify.c:
	Set close-on-exec flags for opened file descriptors.
	[ab0fc2c1d8e1]

2005-07-12  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body.c:
	Several fixes to FETCHing MIME body parts. [n.MIME] was completely
	broken.
	[2dbd7232d7df]

	* src/lib-mail/message-parser.c:
	Boundary line could have been included in next message part's
	headers.
	[937ae4aec137]

	* doc/dovecot-ldap.conf, doc/dovecot-sql.conf:
	Updates
	[16db33dd1bfd]

	* src/lib-imap/imap-parser.h:
	And removed the other added atom-specials as well..
	[f9a0db1ac3e8]

	* src/lib-imap/imap-parser.h:
	Removed ']' from atom-specials because our FETCH BODY[] handling
	fails then..
	[249a15abd572]

	* src/lib/ioloop-notify-inotify.c:
	Compile fix
	[a511aa565020]

	* src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-inotify.c:
	If dnotify/inotify isn't in kernel, handle the errors silently and
	without leaking.
	[b3e135c37f06]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Notification was added to maildir root always, not to the actual
	mailbox that was being selected. Patch by Johannes Berg.
	[5f23ce0fee04]

	* src/lib/ioloop-epoll.c, src/lib/ioloop-internal.h, src/lib/ioloop-
	poll.c, src/lib/ioloop-select.c:
	data -> context/ctx naming convention replaces
	[84a4f150bd00]

	* configure.in, src/lib/Makefile.am, src/lib/ioloop-internal.h,
	src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-inotify.c, src/lib
	/ioloop-notify-none.c, src/lib/ioloop.c:
	Added inotify patch by Johannes Berg and did some restructuring to
	ioloop notify internals.
	[465c465c66be]

	* src/lib-imap/imap-parser.c, src/lib-imap/imap-parser.h:
	Updated IS_ATOM_SPECIAL() list and moved it to header file.
	[2d631ab1d90e]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	Try to prevent some broken keyword names.
	[33ec07ee3bcd]

	* src/lib-storage/index/index-fetch.h:
	Removed commented code.
	[3ec1032a4b69]

	* src/imap/cmd-select.c, src/lib-storage/index/index-status.c, src
	/lib-storage/mail-storage.h:
	Removed no-diskspace flag from status reply. It wasn't working and
	we're going to be using alert_no_diskspace callback anyway when it
	does work properly.
	[043466594f88]

	* src/lib/Makefile.am:
	Missing array-decl.h
	[b92ec14d29ef]

	* src/lib/lib.h, src/lib/sendfile-util.c:
	Include just "config.h", not "../../config.h". The absolute path
	breaks compiling elsewhere than source tree. It was earlier added to
	avoid some global config.h files, but those shouldn't exist..
	[bb88b67d72b2]

	* src/lib/compat.c:
	Added comment about config.h hack
	[ed186c6bbfd8]

	* src/auth/db-ldap.c, src/auth/db-passwd-file.c, src/auth/db-sql.c,
	src/auth/passdb-bsdauth.c, src/auth/passdb-checkpassword.c, src/auth
	/passdb-ldap.c, src/auth/passdb-pam.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-sql.c, src/auth/passdb-vpopmail.c, src/auth/userdb-ldap.c,
	src/auth/userdb-passdb.c, src/auth/userdb-passwd-file.c, src/auth
	/userdb-passwd.c, src/auth/userdb-sql.c, src/auth/userdb-static.c,
	src/auth/userdb-vpopmail.c:
	Removed direct config.h including. I'm not sure why it was done
	before, probably to reduce compile times a few milliseconds. Ugly
	anyway..
	[9096b7957413]

	* src/imap/imap-search.c:
	'*' wasn't working in non-SEARCH messagesets.
	[d4eb5d9ee704]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c:
	Store new/ directory's timestamp in sync_size header in index
	(kludgy..). Fixed saving message into empty and non-synced
	mailboxes.
	[db29cc6754d5]

	* src/lib-storage/index/mbox/mbox-save.c:
	Keywords weren't saved to index while saving.
	[138e242c53c9]

2005-07-04  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-master-listener.c, src/imap/commands-
	util.c, src/imap/imap-fetch.c, src/lib-index/mail-cache-lookup.c,
	src/lib-index/mail-cache-transaction.c, src/lib-index/mail-cache.c,
	src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-sync-
	keywords.c, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-sync.c, src/lib-index/mail-index-transaction-view.c, src
	/lib-index/mail-index-transaction.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-index.c,
	src/lib-index/mail-transaction-log-append.c, src/lib-storage/index
	/index-mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-keywords.c,
	src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c, src
	/lib-storage/mail-storage.c, src/lib/array-decl.h, src/lib/array.h,
	src/lib/lib.h, src/master/mail-process.c:
	Moved array declaration to array-decl.h and include it in lib.h. So
	array.h needs to be now included to use any array_*() functions.
	[346a494c2feb]

	* src/imap/client.c, src/pop3/client.c:
	Call t_push/t_pop around client command execution function, so if
	client sends multiple commands at once we don't waste memory.
	[7e39590da48a]

	* src/auth/auth-worker-server.c:
	If auth worker socket isn't created yet when we try to connect to
	it, try for 5 seconds before aborting.
	[3e1d7dffb3a2]

	* src/imap/imap-search.c, src/lib-storage/index/index-search.c:
	Moved sequence set range checks to imap-specific code, so that
	SEARCH can accept sequence sets with sequence being larger than
	number of messages in mailbox.
	[b75125eced7f]

2005-07-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail.c:
	Fetching message parts or virtual size from cache didn't work
	correctly and could have crashed.
	[c058c73776cc]

	* src/lib-storage/index/index-mail.c:
	If mail_cache_field_exists() returns -1, we can't assume the field
	can be used..
	[163f6efa6a0e]

	* src/lib-storage/index/mbox/mbox-save.c:
	Cache mail headers when saving mails to mbox. We should cache
	everything, but this is a start..
	[0661239a7034]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.h:
	Mark *all* non-found headers that are registered in cache file as
	non-found at the end of header parsing.
	[693baa083a79]

	* src/lib-storage/index/index-mail.c:
	Don't crash if hdr.message-id isn't set in cache file.
	[19daba35107a]

	* src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache.h:
	Added mail_cache_register_get_list() to get a list of all registered
	fields in cache file.
	[b7ce2532250a]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-
	bodystructure.h:
	Added imap_bodystructure_is_plain_7bit()
	[e8cbf3ae00db]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	Added MAIL_CACHE_FLAG_TEXT_PLAIN_7BIT_ASCII to compress simple BODY
	and BODYSTRUCTURE replies into a single flag + message parts. Also
	did other cleanups.
	[8dbce791a1cc]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h, src/lib-
	storage/index/maildir/maildir-mail.c:
	Try to be a bit smarter about when to parse header/body.
	[0c264f105899]

	* src/lib-index/mail-index-sync-ext.c:
	Don't crash if extension array isn't initialized for index map.
	[b5885ba96ec8]

	* src/lib-storage/index/index-mail-headers.c:
	Don't store headers into cache file if they are already there.
	[5ec00b12f4db]

	* src/lib-mail/istream-header-filter.c:
	If we seek back to beginning of headers, don't call callback again
	for headers where it was already called for.
	[e04d4a496a0b]

2005-07-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-transaction.c:
	Saving messages crashed
	[8a175fd7e6e0]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Assert/cleanup
	[f140acbe46b4]

2005-07-01  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib/printf-upper-bound.c, src/lib/sha1.c:
	Bad endianess fix. It required that LITTLE_ENDIAN and BIG_ENDIAN
	were already defined. Rather use WORDS_BIGENDIAN which configure
	already sets.
	[09a585f5ad4b]

2005-06-30  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib/printf-upper-bound.c, src/lib/sha1.c:
	Define I_BYTE_ORDER macro ourself because BYTE_ORDER can't seem to
	be relied on. Fixes SHA1 giving wrong checksums at least in
	Solaris/sparc.
	[211f0c9588c2]

	* TODO:
	updated
	[5c92b51f2b38]

	* src/lib/buffer.c, src/lib/buffer.h:
	Added buffer_update_const_data().
	[5f83939aab50]

	* src/lib-index/mail-index-transaction.c:
	Keyword changes weren't converted properly from sequences to UIDs.
	[ae213c3b4190]

	* src/lib-storage/index/maildir/Makefile.am, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-keywords.c, src/lib-storage/index/maildir/maildir-
	keywords.h, src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h,
	src/lib-storage/index/maildir/maildir-util.c:
	Keywords are stored in maildir filename and maildir-keywords file
	(backwards compatible with 0.99.x's .customflags file)
	[96de02ea7482]

2005-06-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c:
	Merge changes from multiple index sync records into one before
	actually renaming maildir files.
	[113c888cdca1]

2005-06-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-transaction.c, src/lib-index/mail-
	index.c, src/lib-storage/index/index-mail.c, src/lib/array.h:
	Renamed array_modifyable_*() functions. I could never remember how
	they were named.
	[74475a126e2f]

	* src/auth/auth-worker-server.c:
	Compiler warning fix
	[82170d8364d3]

	* src/imap/cmd-append.c:
	crashfix
	[d4bde07451c4]

	* src/imap/cmd-append.c:
	Yet another try at fixing APPEND.
	[877fa3d04313]

	* src/pop3/client.c, src/pop3/commands.c:
	Don't treat known commands with (somewhat) invalid parameters as
	"bad commands" causing disconnection. Only unknown commands.
	[7888394f2985]

	* src/lib-mail/istream-header-filter.c:
	EOF change fix. Should finally properly fix APPEND.
	[2280ed0a9812]

	* src/imap/cmd-append.c:
	Yet another APPEND fix.
	[6beadbe3fc0d]

2005-06-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Fixed breakage caused by CRLF-support.
	[22d4fd7fd436]

	* src/imap/cmd-append.c:
	APPEND was broken because of recent eof-change in istream-limit.
	[2cb42efa44f6]

2005-06-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c:
	We didn't notice if messages were deleted directly from new/.
	[3c51658d6846]

	* src/lib-storage/index/maildir/maildir-sync.c:
	If we have rename()d more than 5 files from new/ to cur/, rescan the
	directory again to make sure we didn't skip any files.
	[6f7ce690358e]

	* src/lib-index/mail-cache-sync-update.c:
	mail_cache_delete() wasn't actually being called for expunged mails,
	so cache file kept growing without ever being compressed.
	[3a98900070ee]

	* src/lib-storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	When syncing mbox, update MD5 sum for mail if it changes. If we need
	MD5 sum but it's zero, resync mbox to get it.
	[d517de69f693]

	* src/auth/auth-request-handler.c, src/auth/auth-request.c, src/auth
	/auth-worker-client.c, src/auth/passdb-blocking.c:
	Last change caused user-given passwords to be cached, and later the
	password used instead of the real one (ie. login once with correct
	password, then you could login using whatever password as long as
	user is cached). Clearly not good. Did several changes to make sure
	this can't happen again.
	[079ec5c2d665]

2005-06-15  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c, src/auth/passdb-cache.c:
	Auth cache wasn't working if password wasn't given (ie. didn't work
	for proxying).
	[27fb8c9202e2]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Handle CR+LF linefeeds
	[ae472460757b]

	* src/lib-index/mail-index-transaction.c:
	Another empty-keyword-list fix with 64bit systems
	[2f823f8fd1d6]

	* src/lib-index/mail-index-transaction.c:
	mail_index_keywords_create() crashed with 64bit systems and not
	exactly correct with 32bit systems either, if it was given empty
	list of keywords.
	[7091a2e5a52c]

2005-06-14  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	If username changes, log the change if debugging is enabled.
	[3f7575e43202]

	* src/auth/passdb-pam.c:
	Allow PAM to modify username.
	[81ebb30e5ea5]

	* src/auth/auth-worker-server.c:
	Destroying auth workers leaked fd.
	[4233ba7f57b6]

2005-06-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-content-parser.c:
	Fixed parsing multiple parameters
	[12640d81175d]

2005-06-10  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-limit.c:
	Set stream->eof immediately after we have read up to our limit.
	[61ea539ee5f1]

2005-06-09  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-sql.c, src/auth/db-sql.h, src/auth/passdb-sql.c,
	src/auth/userdb-sql.c:
	Don't connect to SQL database in main dovecot-auth process if we're
	using workers to do it.
	[28be9a80908e]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/sql-api-private.h, src/lib-sql/sql-api.c, src/lib-sql/sql-api.h:
	Added sql_connect() to do explicit connecting. sql_init() no longer
	does.
	[c624ffa9e6f0]

	* src/lib-sql/driver-mysql.c:
	Make MySQL connect abort in 10 seconds if it can't connect.
	[d1b0dfa6572b]

	* src/lib/lib-signals.c:
	Ignore SIGALRM, but not with SIG_IGN as it causes syscalls to
	restart.
	[b97914e7c941]

	* src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-storage.h:
	Use macros when using W and S extras too.
	[37bbed99b90b]

	* src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-util.c:
	Replaced ':' and ',' character usages with #defines, so they can be
	changed easily if needed.
	[b0bdf32564b7]

	* src/lib/restrict-access.c:
	32bit UID/GIDs were truncated
	[27312b7941e9]

2005-06-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-cache.c:
	Count cache hits and misses, report them on SIGUSR2.
	[4e36a99268dd]

	* src/auth/auth-worker-client.c, src/auth/auth-worker-client.h,
	src/auth/main.c:
	Auth workers were leaking memory for each request. Fixed also a few
	invalid memory accesses at deinitialization.
	[c2497d4c60c9]

2005-06-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Added assert
	[b0b83a2fba69]

	* src/lib-storage/index/index-mail.c:
	Don't pass NULL date to message_date_parse(). It crashes nowadays.
	[27d15196e53e]

	* doc/variables.txt:
	Update for login_log_format_elements setting.
	[77ad773054dd]

	* doc/dovecot-ldap.conf, doc/dovecot-sql.conf:
	Don't list password schemes in the files. They just get out of date.
	[a9b623236dd3]

2005-06-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/Makefile.am, src/lib-mail/message-tokenize.c, src/lib-
	mail/message-tokenize.h:
	Removed message-tokenizer code. All code using it was finally
	replaced with rfc822-parser API.
	[4748506a4095]

	* src/imap/imap-thread.c:
	Changed Message-ID parser to use rfc822-parser API.
	[9bdf82fd33e1]

	* src/lib-imap/imap-bodystructure.c:
	Make Content-Language parser use rfc822-parser API.
	[f484ad51ad9f]

	* src/lib-mail/message-date.c:
	Make date parser use rfc822-parser API.
	[1f378ca8d95d]

	* src/lib-mail/message-content-parser.c:
	Skip initial LWSP
	[f93a32d1c6b0]

	* src/lib-mail/message-content-parser.c:
	Converted MIME Content-* header parser to use rfc822-parser API.
	[ce3b55886a1e]

	* src/lib-mail/rfc822-parser.c, src/lib-mail/rfc822-parser.h:
	Added rfc822_parse_mime_token() to rfc822-parser API.
	[e64f8694b3f3]

2005-05-29  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c:
	Changed output handler to work a bit differently to avoid useless
	io_remove/io_add calls.
	[513abd166949]

	* src/lib/ostream-file.c:
	Set output I/O handler after output callback if needed.
	[c19d6448f856]

	* src/lib/network.c:
	Don't return random data if net_getpeername() or net_getsockname()
	is used for non-inet/inet6 socket.
	[ddfa507bb74f]

2005-05-28  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-worker-server.c:
	If all auth workers have died, don't complain and fail but just
	create and use the new process.
	[c8777e7773f8]

	* src/auth/auth-worker-client.c:
	If worker process has been idle for 10 minutes, make it kill itself.
	[97b996dd5942]

	* src/auth/auth-request.c:
	auth_request_set_field() shouldn't save password to extra_fields.
	Fixes a crash with auth_cache enabled and at least with SQL/LDAP
	passdbs.
	[2db396230881]

	* src/lib/istream-seekable.c:
	Seekable stream was broken after its memory limit was reached and it
	started using temporary file.
	[a176b7d20895]

	* src/lib/ostream-file.c:
	Don't remove output handler if flush_pending is still set after
	callback.
	[5573554dce0c]

	* src/pop3/client.c:
	Small optimization
	[30099e1ccf97]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Call i_stream_sync() a bit more often, especially before checking
	file size to make sure it's not cached. Changed an assert to
	critical error.
	[2e7359e17b4c]

2005-05-25  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream-file.c:
	Don't forget o_stream_set_flush_pending() call if it's called in
	flush callback which returns 1.
	[e8c0736ec5be]

2005-05-24  Timo Sirainen  <tss@iki.fi>

	* src/pop3/client.c:
	Code cleanup. Removed useless previous "fix".
	[d01de9d362c1]

2005-05-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	Keyword resets were written using sequences to transaction log,
	which caused keyword breakages.
	[0a4769c38183]

	* src/deliver/deliver.c:
	Parse also pop3_uidl_format setting for %m case, so we know to save
	the MD5 sum while parsing mbox.
	[70c200deddf7]

	* src/pop3/commands.c:
	If we couldn't get UIDL, also write error to log.
	[814ba0c6877f]

	* src/pop3/commands.c:
	RSET command wasn't working right
	[bfb2658a2616]

2005-05-17  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-master-connection.c, src/auth/auth-request.c:
	Master connection's USER command was leaking memory (with deliver
	binary).
	[e4b84d82c685]

	* src/lib/imem.c, src/lib/strfuncs.c, src/lib/strfuncs.h:
	If p_malloc() used data stack (with DEBUG enabled it might have
	written a warning about growing memory pool), p_strconcat() gave
	corrupted reply. It also didn't work correctly if the given pool was
	a data stack.

	Also made i_strconcat() to be sure it doesn't break if
	default_pool's p_malloc() for some reason would some day use data
	stack.
	[fe4a297379fc]

2005-05-14  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/imap-login/client-authenticate.c, src
	/imap-login/client.c, src/login-common/client-common.c, src/login-
	common/client-common.h, src/login-common/common.h, src/login-
	common/main.c, src/login-common/sasl-server.c, src/master/login-
	process.c, src/master/mail-process.c, src/master/master-settings.c,
	src/master/master-settings.h, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3/client.c, src/pop3/client.h,
	src/pop3/commands.c, src/pop3/common.h, src/pop3/main.c:
	Added configurable logging for login process. Added configurable
	pop3 logout string. Based on a patch by Andrey Panin.
	[3b75956d20c4]

	* src/lib-storage/index/mbox/mbox-sync.c:
	We didn't keep dirty flag state long enough.
	[bfba2219b586]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	last-uid fix
	[f3696949cb7c]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync-update.c:
	uid-last offset change fixes.
	[91cc142dd4a2]

	* src/lib-index/mail-cache.c:
	Pointers into file cache may change as a result of
	file_cache_write().
	[bf654e4789a1]

	* src/lib-index/mail-cache-lookup.c:
	Error handling fixes
	[f8bf5e2a7fb0]

	* src/lib/file-cache.c:
	Optimizations
	[6334d2ef2ba5]

	* src/lib/file-cache.c:
	still wrong..
	[aac83c891ff9]

	* src/lib/file-cache.c:
	fix
	[7172331c2a7e]

	* src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-transaction.c, src/lib-index
	/mail-cache.c:
	Whenever writing to cache file, also updated file_cache. Fixes
	problems with mmap_disable=yes.
	[9e2abc4c341c]

	* src/lib/file-cache.c, src/lib/file-cache.h:
	Added file_cache_write() to update cached memory area.
	[8b2dd340e16d]

2005-05-13  Timo Sirainen  <tss@iki.fi>

	* src/lib/network.c:
	if using IPv6, bind both on the IPv4 and IPv6 addresses if
	IPV6_V6ONLY is defined. Patch by Marco d'Itri
	[690dcc51cdc1]

	* src/pop3/client.c:
	Fixed output getting stuck when transmit buffer was full.
	[7e046c4cba1f]

2005-05-11  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-cache.c:
	Cache bitmask was still used wrong, maybe now..
	[4bb8af354951]

	* src/lib/file-cache.c:
	Cache decisions were completely wrong for file sizes larger than
	32kB.
	[9f841114991d]

2005-05-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	Fix to mmap_disable=yes syncing
	[b4a462cc8737]

	* src/lib-index/mail-transaction-log.c:
	Delete transaction log.2 file if we detect it's corrupted.
	[1069b25164d1]

	* src/auth/passdb-vpopmail.c:
	Don't replace request->user with vpw->pw_name. It drops domain part
	and causes userdb lookup to fail.
	[06fc33bcfa28]

	* src/auth/passdb-vpopmail.c:
	Compile fix
	[548499249451]

	* src/auth/mycrypt.c:
	No, #define _XPG6 was after all pre-Solaris10 hack...
	[90d28c4c0199]

2005-05-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/mycrypt.c:
	Added comment
	[545e79f8605b]

	* src/lib-index/mail-index-view.c:
	Added assert
	[9bd37fc2ce36]

	* src/auth/mycrypt.c:
	No, The _XPG6 define is still needed with final Solaris 10 release..
	[6dc8f3e572ee]

	* src/master/auth-process.c:
	Make auth worker processes work with chroot enabled.
	[5cb55f703d9b]

	* src/imap-login/client.c, src/pop3-login/client.c:
	STARTTLS was broken
	[8df4cfb22171]

	* src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Added some error handling code to prevent assert crashes.
	[455b4a29166c]

	* src/imap/cmd-expunge.c, src/imap/imap-sync.c, src/lib-index/mail-
	index-view-sync.c:
	Removed SYNC_FAST_FLAG from EXPUNGE command. Changed delay-newmail
	workaround to also delay EXPUNGE notifications, otherwise things
	break. Changed index to force this with assert.
	[d6723f532d26]

	* src/pop3/commands.c:
	If we couldn't fetch header MD5/filename for UIDL, abort instead of
	giving invalid UIDL.
	[2d8874b023ea]

2005-05-03  Timo Sirainen  <tss@iki.fi>

	* src/lib/failures.c, src/lib/imem.h:
	Added i_free_and_null() macro and first use case.
	[02479b3894cc]

	* src/lib/mempool-alloconly.c:
	Compiler warning fix without DEBUG.
	[ab3b9ed3a1a5]

2005-04-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	If data inside headers was moved within the first mail, we might
	have gotten "uid-last unexpectedly lost" error.
	[683ca23b94f7]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h:
	Check broken flag counter values every time when updating them.
	Added fsck-flag to index header, if it's set do fsck when opening
	index and when syncing.
	[286cc0cd888a]

	* src/pop3/client.c:
	Connection could have gotten stuck sometimes, doing nothing until
	idle timeout happens.
	[75cfcf7736a7]

	* src/lib-index/mail-transaction-log-view.c:
	Added offsets to log file corruption error messages
	[63fc076992bf]

	* src/lib-index/mail-transaction-log.c:
	Updated timeouts
	[2af6d96e4134]

	* src/lib-storage/index/index-storage.c:
	Don't require notify_ok/notify_no callbacks to be set. Fixes crash
	in deliver when mbox locking messages were supposed to be shown.
	[2fb11d57a734]

	* src/lib-storage/index/mbox/mbox-save.c:
	Crashfix for some failure handling.
	[34dea04a191e]

2005-04-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	If mbox has a pseudo mail, we skipped message updates in partial
	syncs.
	[12ee3c0ee2c9]

2005-04-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	transaction-util.c, src/lib-index/mail-transaction-util.h:
	Expunge code cleanups.
	[8e093a2cc8db]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't always sync full mbox if first message is the pseudo mail.
	[5b6d91616e08]

	* src/lib-index/mail-index-sync.c, src/lib-storage/index/index-mail.c,
	src/lib-storage/index/index-storage.c:
	Compiler warning fixes when DEBUG enabled.
	[09457ba69253]

	* src/lib/array.h:
	Still more changes to how typeof() is used. Now it finally seems to
	be working nicely.
	[239520983a32]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-transaction-log-
	private.h, src/lib-index/mail-transaction-log-view.c, src/lib-index
	/mail-transaction-log.c:
	Minor error checking fixes.
	[43d4aad84752]

	* src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-sync-private.h, src
	/lib-storage/index/mbox/mbox-sync.c:
	If we see mbox offsets break, don't invalidate whole index but
	rather force resyncing.
	[fa9fd105fae3]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Don't try to handle UIDVALIDITY changes nicely after all. It causes
	problems when within same transaction there are two different set of
	UIDs being used.
	[9c8220dfde7c]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c:
	If uid-last isn't actually updated while rewriting first message,
	don't assume it is. Fixes bogus "uid-last changed" errors.
	[5cf828dbcd32]

	* doc/auth-protocol.txt, src/auth/auth-master-connection.c, src/auth
	/auth-request-handler.c, src/auth/auth-request.c, src/auth/auth-
	request.h, src/auth/auth-worker-client.c, src/deliver/deliver.c:
	USER auth command requires now service parameter and supports also
	others parameters. Fixes a crash in dovecot-auth with deliver+mysql.
	[e5ce49c8524a]

	* src/lib/ostream-file.c:
	Try to flush output before uncorking
	[b47043d0d131]

	* src/imap/client.c, src/imap/imap-fetch-body.c, src/lib/ostream-
	crlf.c, src/lib/ostream-file.c, src/lib/ostream-internal.h,
	src/lib/ostream.c, src/lib/ostream.h, src/pop3/client.c:
	o_stream_uncork() was previously always setting IO_WRITE handler
	even if there was no reason for it. This was relied on in imap/pop3
	code when a handler could just send as much data as it can without
	actually buffering anything.

	So, removed the IO_WRITE handler forcing. It's only set if there's
	actually data in buffer or if flush_pending is set (via
	o_stream_set_flush_pending() or by returning 0 from flush callback
	handler).

	All in all, a minor optimization.
	[a3a72d5bdfce]

	* src/lib-storage/index/mbox/mbox-sync.c:
	If X-UIDs hadn't yet been written, we resynced everything after the
	first message we had to sync.
	[ae6f1b54cd59]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Dirty flags weren't being updated correctly. Caused the same
	messages to be rewritten over and over again, or skipping some
	messages causing lost flag changes.
	[9eaead79577c]

2005-04-23  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-alloconly.c:
	Remove compiler warnings with non-DEBUG.
	[4cbb7b67bc98]

	* src/imap/cmd-create.c:
	Don't do invalid memory accesses if trying to create empty mailbox
	name.
	[87edfd6d5151]

	* src/lib/istream-seekable.c:
	Allow non-first streams also to have pending data.
	[98da89360e81]

	* src/lib/istream-seekable.c:
	Fixes.
	[7ca646fc4107]

	* src/Makefile.am:
	Also use the --without-deliver option to not build it :)
	[e29f61128b51]

	* configure.in:
	Added --with-deliver option.
	[fdac6810fe64]

	* configure.in, src/login-common/Makefile.am, src/master/Makefile.am:
	Added --with-rundir configure option.
	[ce0733b39311]

	* src/deliver/deliver.c:
	save_mail() returns 0 if successful, not if failed..
	[5949ce51755b]

	* src/lib-storage/index/index-search.c:
	Don't call index_mail_parse_header() twice when searching headers.
	Caused assert-crashes.
	[38eaa792c405]

	* src/auth/passdb-ldap.c:
	LDAP passdb finally should work again.
	[2a8ff9cbb50b]

	* src/auth/passdb-ldap.c:
	Added more LDAP debugging.
	[2e153b23b830]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index.h, src/lib-index/mail-
	transaction-log-append.c, src/lib-storage/index/maildir/maildir-
	sync.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	If UIDVALIDITY changes, don't invalidate the whole index. Just
	expunge all existing messages and update uidvalidity/nextuid fields.
	Now we don't have to re-login when this happens.
	[49071cc19102]

	* src/lib-index/mail-index-sync-update.c:
	When removing recent flags, we didn't update the recent flag count
	in header.
	[be9bf789a1d4]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c:
	index.log file is now rotated to .index.log.2 file. When log file is
	missing, it's used if the wanted log is in it.
	[0403596c93fd]

	* src/auth/auth-master-listener.c:
	Crashfix
	[850e150beec8]

	* src/auth/auth-request.c, src/auth/mech-anonymous.c, src/auth/mech-
	apop.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth/mech-
	plain.c, src/auth/mech-rpa.c:
	Grow default auth_request pools to 512 bytes per request.
	[04867ddac911]

	* src/lib-index/mail-transaction-log.c:
	Don't crash if dotlock replacing failed.
	[a19268b76093]

	* src/lib-index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-
	index/mail-transaction-log.c:
	s/PREFIX/SUFFIX/ for .cache and .log filename suffixes..
	[62d31be5ae60]

2005-04-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	Error message fix.
	[ced373b587a9]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Fixes to expunging first mail.
	[3f0c6ed4a950]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	When first message was expunged we might have gotten "uid-last
	unexpectedly lost" errors.
	[2fbb6e7ca781]

	* src/lib/mkdir-parents.c:
	Ignore if mkdir() returns ENOSYS. It probably means we tried to
	mkdir a (NFS) mount point.
	[3cd4ae5f1210]

2005-04-21  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-worker-client.c:
	We weren't sending proxy's password back with blocking passdb.
	[1de641419e81]

	* src/auth/passdb-sql.c:
	Allow password field to be NULL. Needed with proxies.
	[0bd02518613a]

2005-04-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c:
	Crashfix in error conditions
	[46ca6b941177]

	* src/auth/Makefile.am, src/auth/auth-client-connection.c, src/auth
	/auth-client-connection.h, src/auth/auth-master-connection.c,
	src/auth/auth-master-connection.h, src/auth/auth-master-listener.c,
	src/auth/auth-master-listener.h, src/auth/auth-request-handler.c,
	src/auth/auth-request-handler.h, src/auth/auth-request.h,
	src/auth/main.c:
	Allow multiple master connections for a single listener.
	[3f090bcaffcc]

	* src/auth/auth-master-connection.c, src/auth/auth-master-
	connection.h, src/auth/main.c:
	Exit only if all master connections are lost, not only if one of
	them is.
	[38754475d3b6]

2005-04-17  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	src/auth/userdb-ldap.c:
	If both userdb and passdb used LDAP the later one was overriding
	first one's attribute names.
	[aebed9a9edac]

	* src/imap/cmd-list.c:
	LSUB was returning namespace prefixes.
	[cccb5c6ba946]

	* src/lib-index/mail-transaction-log-view.c:
	If transaction log file is lost, mark the index inconsistent. Later
	we should try to autocreate the missing log files..
	[c8c7a12d2922]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't break with empty mbox files when we're not delay-writing and
	the mailbox hasn't always been empty.
	[64814c4d5c7c]

	* src/imap/imap-sort.c:
	Don't crash if SORT elements don't contain headers.
	[701526ef703f]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-search.c:
	Don't even try to allow searching zero number of headers.
	[dd19f2e8575f]

	* src/lib-storage/mail-search.c:
	Some possible fix for HEADER searches and cleanup
	[23fceec1e5c9]

	* src/imap/imap-fetch-body.c:
	Don't allow FETCH BODY[HEADER.FIELDS ()], ie. empty list.
	[361ce931354e]

	* src/lib/ioloop-poll.c:
	If we get POLLNVAL, call the callback anyway so it hopefully gets
	rid of the condition.
	[ed7e4f7a2315]

	* src/lib-storage/index/index-mail-headers.c:
	Raised initial pool sizes.
	[b596431525d3]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log-append.c:
	mmap_disable=yes: Transaction log might have been rotated before
	everything was committed to index.
	[c2b8904dc21b]

	* src/lib-index/mail-index-sync-update.c:
	If we're updating only log_file_ext_offset but log file sequence has
	changed, update log_file_int_offset also to beginning of next file.
	Fixes assert in mail_transaction_log_view_set().
	[98923db29e39]

2005-04-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth.c, src/lib-index/mail-index.c, src/lib-sql/driver-
	mysql.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib/env-util.c, src/master/master-settings.c:
	Raised initial pool sizes.
	[4600e247da86]

	* src/lib/buffer.h:
	Added BUFFER_APPROX_SIZE which can be used to approximately
	calculate the memory used by buffer struct itself.
	[f8472ced34c0]

	* src/auth/userdb-passwd.c:
	Try to detect buggy NSS implementations.
	[6448d35f8349]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't assert-crash with 0-byte sized "mboxes".
	[611ae3edc1fe]

2005-04-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail.c:
	Don't return void.
	[f82f434a9fdc]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Removed extra 0-initializers from struct storage initializers. They
	used to be there because -W gave warnings with gcc, but newer
	versions seem to be silent as long as C99 style member initializers
	are used. Also fixes a compiling problem with some non-gcc
	compilers.
	[92dd47097bc8]

	* src/lib-storage/index/index-mail-headers.c:
	mail_get_headers() and mail_get_first_header() returned headers with
	"name:" prefix if they weren't in cache file.
	[1fae8494f8f7]

	* src/master/mail-process.c:
	Send all unrecognized parameters from userdb to imap/pop3 processes.
	Useful for passing plugin parameters.
	[47437871d879]

2005-04-11  Timo Sirainen  <tss@iki.fi>

	* src/pop3/main.c:
	We weren't calling mail_storage_init() at startup so we crashed.
	[def87e4ad3a5]

2005-04-10  Timo Sirainen  <tss@iki.fi>

	* src/lib/array.h:
	ARRAY_CREATE() macro fix. Wasn't working in all situations.
	[ed782bb26632]

	* configure.in, dovecot-config.in:
	Added
	[451a38ca83bb]

2005-04-08  Timo Sirainen  <tss@iki.fi>

	* src/lib/array.h:
	Added ARRAY_DEFINE_EXTERN().
	[21f30709ead8]

	* src/lib-storage/mail-storage.c:
	Linked list -> array
	[6d5f47f5b05b]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	Since we always parse the first message now, there's no need ever to
	do sync_restart.
	[bbb22ca660e0]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-list.c, src
	/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-storage/index/mbox
	/mbox-file.c, src/lib-storage/index/mbox/mbox-lock.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Created mbox_storage and maildir_storage.
	[2c72492dfd91]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-transaction.c, src/lib-storage/index/maildir/maildir-
	uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-storage/index/mbox
	/mbox-file.c, src/lib-storage/index/mbox/mbox-file.h, src/lib-
	storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox/mbox-
	lock.h, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-sync-parse.c, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync-
	rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/index/mbox/mbox-
	transaction.c:
	Moved mbox/maildir-specific variables from struct index_mailbox to
	mbox_mailbox and maildir_mailbox.
	[b698ae839a18]

	* src/auth/mech-plain.c, src/lib-index/mail-cache-fields.c, src/lib-
	index/mail-cache-lookup.c, src/lib-index/mail-cache.h, src/lib-index
	/mail-index-view-sync.c, src/lib-index/mail-index.h, src/lib-mail
	/istream-header-filter.c, src/lib-mail/istream-header-filter.h, src
	/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-sync.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h:
	Several size_t -> unsigned int changes. Try to keep "unsigned int"
	for counters, size_t for actual memory range sizes.
	[df372eecc5d0]

	* src/lib-index/mail-cache-transaction.c:
	buffer -> array
	[f022867fb58d]

	* src/lib-imap/imap-parser.c:
	Removed element_count variable, it's not used anymore.
	[b9717fe3bcf3]

	* src/lib-mail/message-address.c:
	local-part in message address can be quoted-string as well.
	[7892e3febad6]

	* src/auth/auth-request.c, src/auth/passdb-cache.c:
	Don't crash if cache is enabled and we're caching more than just
	password.
	[859c4ffd514e]

	* src/auth/passdb-ldap.c, src/auth/passdb-sql.c:
	Don't crash if password lookup failed.
	[9860bab7b7e3]

	* src/auth/auth-request.c, src/auth/auth-request.h, src/auth/passdb-
	cache.c, src/auth/passdb-ldap.c, src/auth/passdb-sql.c:
	Try to keep scheme always included in auth_request->passdb_password.
	[36db3285f4a7]

	* src/lib-index/mail-cache.c:
	Don't crash at mail_cache_lock() if mail_cache_map() fails.
	[55bc96b23bc1]

	* src/imap/cmd-status.c:
	STATUS command was replying with wrong hierarchy separator if it
	wasn't default one.
	[ae58b4d08de2]

	* src/lib/strfuncs.c:
	t_strarray_join() wasn't actually marking the memory allocated that
	it was returning from data stack. So it might have returned garbage.
	[23d49122f015]

	* src/lib-index/mail-index-transaction.c:
	If keyword was set for message whose seq != uid, we broke index.
	[354bfcbc01d3]

	* src/lib-mail/istream-header-filter.c:
	Don't panic in stat(). o_stream_send_istream() wants to know the
	file size. It settles for "unknown" fine, so return that.
	[10d67baec28f]

	* src/auth/passdb-vpopmail.c:
	Compile fix.
	[beaa5ff9d86a]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c:
	Large mbox code cleanups, especially related to X-IMAP/X-IMAPbase
	header handling. uid-next field is updated now every time while
	syncing.

	If partial syncing failed, we weren't re-requesting all sync records
	from index, which could have caused some changes to be lost, and
	possibly caused some index corruption errors later on.

	Several other more or less possible problems fixed.
	[cb62447e3e75]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index.h:
	Added mail_index_sync_reset() to restart syncing from beginning.
	[98e3001ca527]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	Non-Recent Status-flag wasn't updated correctly.
	[fb34cde02ac8]

	* src/lib-storage/index/mbox/mbox-save.c:
	Don't crash while saving message if keywords aren't given..
	[f1134d265a9d]

	* src/lib-storage/index/index-storage.c:
	Last cleanup broke opening mailboxes completely.
	[74f5843576d0]

2005-04-03  Timo Sirainen  <tss@iki.fi>

	* src/deliver/deliver.c, src/imap/namespace.c, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/pop3/client.c, src/pop3/main.c:
	Moved several getenv()s from lib-storage to main code. deliver
	binary was missing several getenvs..
	[6a179bf1272e]

	* dovecot-example.conf, src/imap/common.h, src/imap/imap-fetch-body.c,
	src/imap/main.c:
	Removed tb-negative-fetch workaround. It shouldn't be needed anymore
	because of the FETCH ordering changes.
	[9ea318f232e0]

	* doc/dovecot-sql.conf:
	Added information about "user" column.
	[4fb1a08bfa11]

	* src/auth/auth-request.c, src/auth/auth-worker-client.c, src/auth
	/passdb-blocking.c, src/auth/passdb-bsdauth.c, src/auth/passdb-
	passwd-file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c,
	src/auth/passdb-vpopmail.c:
	passdb can now change the username that was used to log in. This is
	mostly useful to support case-insensitive username lookups.
	[92c16e82b806]

	* src/auth/auth-worker-client.c:
	Auth workers weren't working correctly with more than one
	passdb/userdb.
	[c18ab708f71c]

	* src/deliver/deliver.c:
	Compile fix for recent mailbox_open() API change.
	[c29326c157da]

	* src/imap/client.h, src/imap/cmd-append.c, src/imap/cmd-select.c,
	src/imap/commands-util.c, src/imap/commands-util.h, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index-sync-keywords.c, src
	/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index-view.c, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-index
	/mail-transaction-log-append.c, src/lib-storage/index/index-mail.c,
	src/lib-storage/index/index-mail.h, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c, src/lib-storage/mail-
	storage.h, src/lib/array.h:
	Keywords are now stored in X-Keywords headers in mbox. Did several
	related API changes to get better performance.
	[a2943c050571]

2005-04-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-private.h, src/lib/array.h:
	Added ARRAY_DEFINE_PTR() which needs to be used instead of
	ARRAY_DEFINE() for pointers.
	[f5a1c3f7fd72]

	* src/lib/buffer.c, src/lib/buffer.h:
	Added buffer_cmp().
	[fb9eee567307]

	* src/imap/imap-fetch-body.c:
	Fetching partial headers crashed because of recent changes.
	[3544d971e7da]

2005-03-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h,
	src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Recent flag handling cleanups. Added some comments.
	[3b820e59610e]

	* src/imap/imap-sort.c:
	SORT might have crashed just before finishing.
	[c913cf1dfb08]

	* src/imap/imap-sort.c, src/imap/imap-thread.c, src/lib-storage/index
	/index-mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/index-search.c,
	src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/mbox/mbox-mail.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.h, src/lib-storage/mail.c:
	Renamed mail_get_header() to mail_get_first_header() and
	mail_gets_headers() to mail_get_header_stream(). Added new
	mail_get_headers() which returns NULL-terminated string list of all
	found headers.
	[ff47e78ad717]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h:
	Changed some buffers to arrays.
	[e7166e2f8b9b]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't crash when closing streamed mbox.
	[3957eece913f]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-select.c,
	src/imap/cmd-status.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-file.c, src/lib-
	storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/pop3/client.c:
	Added input stream parameter to mailbox_open(). With mbox it now
	allows opening a read-only mbox using a stream.
	[6491dab63e54]

	* src/lib/Makefile.am, src/lib/istream-seekable.c, src/lib/istream-
	seekable.h:
	Added istream-seekable, which allows combining multiple input
	streams and creating a single seekable stream out of them.
	[f104e4197ac1]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache.c, src
	/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync.c, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log-private.h, src/lib-index/mail-transaction-log.c:
	In-memory indexes work again. Just pass dir as NULL to
	mail_index_alloc().
	[40b4ba3c55b8]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync-
	rewrite.c, src/lib-storage/index/mbox/mbox-sync.c:
	i_stream_sync() replaced istream_raw_mbox_flush(). Use
	i_stream_stat() instead of fstat() directly. Now we have the
	possibility to use istreams as read-only mboxes.
	[9a08cf5e5f61]

	* src/lib-mail/istream-header-filter.c, src/lib/istream-data.c,
	src/lib/istream-file.c, src/lib/istream-internal.h, src/lib/istream-
	limit.c, src/lib/istream-mmap.c, src/lib/istream.c,
	src/lib/istream.h, src/lib/ostream-file.c:
	Replaced i_stream_get_size() with i_stream_stat(). Added
	i_stream_sync().
	[b79853b4b005]

	* src/lib/istream-internal.h, src/lib/istream.c, src/lib/istream.h:
	i_stream_next_line() works now even if the stream buffer can't be
	directly modified.
	[a6af023db10d]

2005-03-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c, src/lib/istream-data.c,
	src/lib/istream-file.c, src/lib/istream-limit.c, src/lib/istream-
	mmap.c, src/lib/istream.h:
	Added seekable variable to struct istream.
	[904a268921af]

2005-03-27  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-alloconly.c:
	Changed alloconly pools to call malloc() only once when creating the
	pool. Pool names aren't used anymore without DEBUG. Don't
	immediately double the pool's initial size for the first allocated
	block.
	[889a584bd953]

	* configure.in, src/lib/compat.c, src/lib/compat.h:
	Added setegid() emulation for HP-UX.
	[2f57438d9542]

	* configure.in:
	oops, broke fd pass check completely
	[f6eb50f0d2c0]

	* configure.in:
	Make sure "whether fd passing works" check doesn't get stuck (HP-UX
	fix).
	[d20aee22af6a]

	* src/lib/Makefile.am, src/lib/buffer.c, src/lib/istream-file.c,
	src/lib/mempool.c, src/lib/mempool.h, src/lib/ostream-file.c:
	Added pool_get_exp_grown_size(). Use it for buffers, istreams and
	ostreams when buffer needs to grow. Optimizes memory usage a bit.
	[06f9da4ff7a5]

	* src/lib/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib
	/mempool-system.c, src/lib/mempool-unsafe-datastack.c,
	src/lib/mempool.h:
	Added p_get_max_easy_alloc_size().
	[6396b4c0a721]

	* src/lib/data-stack.c, src/lib/data-stack.h:
	Added t_get_bytes_available().
	[8508869ab276]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync.c,
	src/lib-index/mail-index-transaction.c, src/lib-index/mail-index.c,
	src/lib-index/mail-index.h:
	Changed keywords_buf to array. Added mail_index_sync_get_keywords().
	[f778bd8b228f]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	Changed mails and syncs buffers to arrays.
	[b85a96766a15]

2005-03-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-ntlm.c:
	Fixes incorrect error message and adds missing hex_to_binary()
	return value check. Patch by Andrey Panin.
	[bb7282d1e2da]

	* src/auth/mech-rpa.c:
	Proper realm support for RPA. Now RPA will use auth_realms and
	auth_default_realm configuration parameters instead of my_hostname
	variable. Patch by Andrey Panin.
	[e2d7f1db71e3]

	* src/auth/auth-worker-client.c:
	Previous blocking passdb patch fixed APOP only. Fixing others now.
	Patch by Andrey Panin.
	[ce26413ea766]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Blank line was missing at the end of the created pseudo mail.
	s/dummy/pseudo/ to be more consistent.
	[2d19bc073996]

	* src/lib-mail/message-address.c:
	Skip LWSP at the beginning of address.
	[43d862951f90]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-private.h, src
	/lib-index/mail-index.c:
	Added sync/sync_lost/expunge handler unregistering, and also do
	that. Fixes crash with mmap_disable=yes when reopening mailbox.
	[f6e0d1826645]

2005-03-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	Array code changes broke setting old_data_r in
	mail_index_update_ext(). This kept breaking cache file.
	[f3c1a9a32a8e]

	* src/lib-index/mail-index.c:
	mail_index_write_base_header() didn't update the header in memory
	with mmap_disable=no. It's used only with error correction, so after
	failure trying to reopen index failed every time.
	[e38e04c7c67c]

	* src/lib-storage/index/mbox/mbox-save.c:
	If want_mail = TRUE for mbox_save_init() and we sync the mbox, we'll
	have to open a new view to get the next_uid or it might not be
	updated.
	[af8fc972fe95]

	* src/lib-index/mail-index-view-sync.c:
	Added assert.
	[0220c7d37fc8]

	* src/imap/cmd-append.c:
	Eat away the finishing empty line if APPEND failed so we don't send
	"* BAD" error to client.
	[b9e8420d979a]

	* src/lib-index/mail-transaction-log.c:
	If transaction log record size is too large, mark the file
	corrupted.
	[746c309e366c]

2005-03-18  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	We weren't returning "root name" properly with LIST <ref> "".
	[23e5925c48dd]

	* src/imap/imap-fetch-body.c, src/imap/imap-fetch.c, src/imap/imap-
	fetch.h:
	Send buffered fetch items to client first. Fixes kmail and
	Thunderbird issues..
	[8632ec8486c6]

	* src/lib-index/mail-transaction-log-append.c:
	Compiler warning fix
	[929091768426]

	* src/lib/array.h:
	ARRAY_SET_TYPE() in non-DEBUG-mode was giving errors with older gccs
	if it was used at the beginning of a function (function can't start
	with ";").
	[e3f6748c59ba]

2005-03-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-worker-client.c, src/auth/passdb.c, src/auth/passdb.h:
	Non-plaintext blocking passdb authentication wasn't working. Patch
	by Andrey Panin.
	[69b056a3657f]

	* src/auth/db-ldap.c, src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	LDAP crashfixes.
	[eb840633c9bf]

	* src/lib-storage/index/mbox/mbox-mail.c:
	get_physical_size() was crashing if mbox hadn't been opened yet.
	[4f3e4c8e458f]

2005-03-15  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-status.c,
	src/imap/commands-util.c, src/imap/commands-util.h:
	mailbox_name_equals() renamed to mailbox_equals(), which also now
	checks that mail storages match. Fixes problems with copying
	messages from one namespace to another between identically named
	mailboxes.
	[2715077f9c3e]

	* src/deliver/deliver.c, src/imap/cmd-append.c, src/imap/cmd-copy.c,
	src/imap/cmd-search.c, src/imap/cmd-store.c, src/imap/common.h,
	src/imap/imap-expunge.c, src/imap/imap-fetch-body.c, src/imap/imap-
	fetch.c, src/imap/imap-fetch.h, src/imap/imap-sort.c, src/imap/imap-
	sync.c, src/imap/imap-thread.c, src/imap/main.c,
	src/imap/namespace.c, src/lib-storage/Makefile.am, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-mail.h, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-transaction.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-transaction.c, src/lib-
	storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/index/mbox/mbox-
	transaction.c, src/lib-storage/mail-copy.c, src/lib-storage/mail-
	copy.h, src/lib-storage/mail-storage-private.h, src/lib-storage
	/mail-storage.c, src/lib-storage/mail-storage.h, src/lib-
	storage/mail.c, src/lib-storage/proxy-mail-storage.c, src/lib-
	storage/proxy-mail-storage.h, src/lib-storage/proxy-mail.c, src/lib-
	storage/proxy-mail.h, src/lib-storage/proxy-mailbox.c, src/lib-
	storage/proxy-mailbox.h, src/pop3/client.c, src/pop3/commands.c:
	Major mail-storage API changes. It's now a bit cleaner and much more
	plugin friendly. Removed proxy_mailbox* stuff, they were difficult
	to use and there's now much easier way to replace them.
	[923ff19873d4]

	* src/lib/array.h:
	Added ARRAY_INIT for initializing array_t in structs.
	[b5fd010a4454]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/mail-storage.h:
	Include transaction pointer in struct mail.
	[605c71410c67]

	* configure.in:
	Limit TIME_T_MAX_BITS to 40.
	[6400a517f087]

2005-03-14  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	listen port comment updates. Patch by Reuben Farrelly.
	[0ddbe4de5a84]

	* dovecot-example.conf, src/imap/cmd-fetch.c, src/imap/common.h,
	src/imap/imap-sync.c, src/imap/main.c, src/lib-storage/index/index-
	sync.c, src/lib-storage/mail-storage.h:
	Renamed oe6-fetch-no-newmail workaround to delay-newmail and changed
	it to work more like the name says: only newmail notifications are
	skipped and not only for FETCH command.
	[c8fffa286b6a]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	index.h, src/lib-index/mail-transaction-util.c, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/maildir/maildir-
	sync.c:
	mail_index_sync_next() now returns keyword updates (now only thing
	left to do is to fix maildir and mbox syncing to use them).
	[391a1064872e]

	* src/auth/mycrypt.c:
	Remove #define _XPG6 after all. It was used to avoid #error in
	Solaris 10 pre-release, but now it breaks the compile in 10 final...
	[2661cfd533c0]

	* src/lib-mail/message-address.c:
	If mailbox name was missing from message address, we didn't set it
	to MISSING_MAILBOX as we should have, which caused crashing if the
	field was tried to be SEARCHed. Also cleaned up the code a bit.
	[2bf86099376e]

	* src/lib-storage/index/mbox/mbox-sync.c:
	When writing the dummy message after all messages were expunged from
	mbox, the UIDVALIDITY value was set to 0 if X-IMAP/X-IMAPbase header
	wasn't read. This caused the next parsing to treat the header
	invalid and didn't recognize it as dummy message.
	[a9a5a399a027]

2005-03-13  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/Makefile.am, src/deliver/.cvsignore,
	src/deliver/Makefile.am, src/deliver/deliver.c:
	Added initial version of Dovecot LDA.
	[938f948651f1]

	* src/auth/passdb-pam.c, src/lib/data-stack.c, src/lib/ioloop-epoll.c,
	src/lib/mempool-alloconly.c, src/lib/mempool-system.c, src/lib
	/process-title.c, src/lib/restrict-access.c:
	If we run out of memory, exit with FATAL_OUTOFMEM status instead of
	dumping core. Also changed a few other i_panic() calls to others.
	[cb285bd5d8c9]

	* src/master/auth-process.c:
	Don't give NULL parameters to printf's %s format. Fixes crash with
	Solaris and some others.
	[b6faacb023a0]

	* src/lib/array.h:
	#ifdefs were wrong, we need both __GNUC__ and DEBUG to do type
	checking. Added new ARRAY_TYPE_CHECKS macro which can also be
	defined manually to enable it.
	[b426b1d58296]

	* src/lib-index/mail-index-transaction-view.c, src/lib-index/mail-
	index-transaction.c:
	ARRAY_ARG_SET_TYPE() -> ARRAY_SET_TYPE()
	[10532f156263]

	* src/lib/array.h:
	Renamed ARRAY_ARG_SET_TYPE() to ARRAY_SET_TYPE() and updated
	comments.
	[d5935326e06f]

2005-03-12  Timo Sirainen  <tss@iki.fi>

	* src/lib/array.h:
	Updated example code, it was using older API..
	[d0adece8a6a0]

	* src/auth/auth-request.c:
	Crashfix. Patch by Andrey Panin.
	[2ff790d5d9e2]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-
	index-sync-keywords.c, src/lib-index/mail-index-sync-private.h, src
	/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction-view.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index-view.c, src/lib-index/mail-
	index.c, src/lib-index/mail-transaction-log-append.c:
	Changed many buffers to arrays. Cleans up the code a lot.
	[0df3f5d71958]

	* src/lib/Makefile.am, src/lib/array.h, src/lib/lib.h:
	Added dynamic array implementation. When compiling with gcc and
	DEBUG enabled, gcc checks type safety at compile time.
	[ba17b6e45193]

	* src/lib/buffer.c, src/lib/buffer.h:
	Minor cleanup: added _r suffix to used_size pointer parameters.
	[f80be7e73f71]

	* src/lib/lib.h:
	extern was missing from null4 declaration.
	[e73a0ef9c2c0]

	* src/lib-index/mail-index-view-sync.c:
	Code cleanups
	[aa83063864c7]

2005-03-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c:
	Space reservation fixes and cleanups.
	[31313e1fe036]

2005-03-07  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-master-connection.c, src/auth/auth-request.c, src/auth
	/auth-request.h, src/auth/auth-worker-client.c:
	Handle USER requests from master connections.
	[3089083e1d47]

	* src/auth/auth-worker-client.c, src/auth/userdb-blocking.c:
	Blocking userdb: Don't break if user wasn't found.
	[c59506c04088]

	* dovecot-example.conf, src/auth/auth-master-connection.c, src/auth
	/auth-request.c, src/auth/auth-request.h, src/auth/auth-worker-
	client.c, src/auth/auth.c, src/auth/auth.h, src/auth/main.c,
	src/auth/passdb-blocking.c, src/auth/passdb.c, src/auth/passdb.h,
	src/auth/userdb-blocking.c, src/auth/userdb-blocking.h,
	src/auth/userdb.c, src/auth/userdb.h, src/master/auth-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Replaced userdb/passdb settings with blocks so it's possible to give
	multiple ones. Plaintext password mechanisms now support handling
	multiple passdbs, but others don't yet. Also fixed a few memory
	leaks.
	[16ea551957ed]

	* src/lib-storage/index/index-storage.c:
	Don't return value from void function.
	[818c75139ac7]

2005-03-05  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c, src/master/master-settings.h:
	Give more understandable error message if imap/pop3 listen ports
	conflict.
	[ef3a07e0a634]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c, src
	/lib-index/mail-transaction-log.h:
	Several transaction log cleanups and fixes.
	[ef16bb8091aa]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c:
	Assert if mail_index_map() is called recursively.
	[c620532e7bc8]

	* src/lib-index/mail-transaction-log-append.c:
	When rotating log, we locked index and tried to use its header. We
	didn't call mail_index_map() however to update the header..
	[845c49350468]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c:
	Some error handling path crashfixes.
	[95d2d8d5958b]

	* src/lib-index/mail-index-sync-update.c:
	We might have skipped transaction log records when syncing if log
	file was just rotated.
	[eec0c605e78f]

	* src/lib-index/mail-cache-transaction.c:
	Cache file space reservation assertfix.
	[5d6656a798e5]

	* src/lib/file-dotlock.c:
	If we failed to lock the dotlock, don't try to close the file twice.
	[091821cac480]

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log-
	append.c, src/lib-index/mail-transaction-log-view.c, src/lib-index
	/mail-transaction-log.c, src/lib-index/mail-transaction-log.h:
	We could have gone past the transaction log view's boundaries if log
	was just rotated. Plus other transaction log cleanups, fixes and new
	asserts.
	[d137899ea853]

	* src/auth/auth-cache.c:
	auth_cache_insert(): Don't remove expired nodes just because they're
	expired. Before inserting a node, make sure it doesn't already exist
	(expired).
	[b951764080cc]

	* src/auth/auth-request-handler.c, src/auth/auth-request.c, src/auth
	/auth-request.h, src/auth/passdb-blocking.c, src/auth/passdb-
	cache.c, src/auth/passdb-cache.h:
	Added state variable for auth_request and several assertions to make
	sure the state is always valid. Fixed assert crash when a user
	having cached passdb entry expired tried to authenticate.
	[8a3b57385eca]

	* src/lib-index/mail-transaction-log.c:
	hdr_size fix
	[42e1e9dbf19e]

	* src/lib-index/mail-transaction-log-append.c, src/lib-index/mail-
	transaction-log.c, src/lib-index/mail-transaction-log.h:
	Added versioning to transaction log header. Added create_stamp to
	its header and it's not used to determine if the transaction log
	should be rotated, not the last time the log was updated. So now if
	the log is over 128kB, it's rotated as soon as it's at least 5
	minutes old.
	[ec17099a6490]

2005-03-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-worker-client.c, src/auth/auth-worker-client.h,
	src/auth/auth-worker-server.c, src/auth/auth-worker-server.h,
	src/auth/passdb-blocking.c, src/auth/passdb-blocking.h, src/auth
	/userdb-blocking.c, src/auth/userdb-blocking.h:
	Forgot to add for blocking passdb/userdb workers..
	[62f8366cb89c]

2005-03-01  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-cache.c, src/auth/auth-cache.h, src/auth/auth-
	request.c, src/auth/passdb-cache.c, src/auth/passdb-cache.h:
	Fallback to using expired records from auth cache if database
	lookups fail.
	[97f53e0cce63]

	* dovecot-example.conf, src/auth/Makefile.am, src/auth/auth-master-
	connection.c, src/auth/auth-master-connection.h, src/auth/auth-
	request-balancer-child.c, src/auth/auth-request-balancer-worker.c,
	src/auth/auth-request-balancer.h, src/auth/auth-request-handler-
	balancer.c, src/auth/auth-request-handler-default.c, src/auth/auth-
	request-handler.c, src/auth/auth-request-handler.h, src/auth/auth-
	request.c, src/auth/auth-request.h, src/auth/auth.c,
	src/auth/auth.h, src/auth/common.h, src/auth/main.c, src/auth
	/passdb-bsdauth.c, src/auth/passdb-checkpassword.c, src/auth/passdb-
	ldap.c, src/auth/passdb-pam.c, src/auth/passdb-passwd-file.c,
	src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth/passdb-
	sql.c, src/auth/passdb-vpopmail.c, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/userdb-ldap.c, src/auth/userdb-passdb.c,
	src/auth/userdb-passwd-file.c, src/auth/userdb-passwd.c, src/auth
	/userdb-sql.c, src/auth/userdb-static.c, src/auth/userdb-vpopmail.c,
	src/auth/userdb.h, src/master/auth-process.c, src/master/common.h,
	src/master/main.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Restructuring of auth code. Balancer auth processes were a bad idea.
	Usually the balancer itself took as much CPU as the actual workers
	because it acted as a proxy.

	Now auth worker means different thing: they're used to execute
	blocking passdb and userdb queries. Currently just MySQL (PAM and
	checkpassword in TODO).
	[e6a487d80288]

	* src/lib/Makefile.am, src/lib/unix-socket-create.c, src/lib/unix-
	socket-create.h:
	Added unix_socket_create().
	[07a1726b7e6b]

2005-02-27  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request.c:
	Last changes broke proxying when user was in auth cache.
	[da9e4ffef09f]

	* src/lib-sql/sql-api.c:
	Forgot the actual sql_get_flags() function.
	[8a4c6f0491ab]

	* src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/sql-api-private.h, src/lib-sql/sql-api.h:
	Added sql_get_flags() function, currently returning only
	SQL_DB_FLAG_BLOCKING.
	[5d6787582410]

	* src/auth/auth-request-handler-default.c, src/auth/auth-request.c,
	src/auth/auth-request.h, src/auth/db-ldap.c, src/auth/passdb-
	bsdauth.c, src/auth/passdb-cache.c, src/auth/passdb-cache.h,
	src/auth/passdb-checkpassword.c, src/auth/passdb-ldap.c, src/auth
	/passdb-pam.c, src/auth/passdb-passwd-file.c, src/auth/passdb-
	passwd.c, src/auth/passdb-shadow.c, src/auth/passdb-sql.c, src/auth
	/passdb-vpopmail.c, src/auth/passdb.c, src/auth/passdb.h, src/auth
	/userdb-ldap.c, src/auth/userdb-passdb.c:
	Moved cache handling from sql/ldap-specific code to generic auth-
	request code. Did some small optimizations on the way.
	[6a3254e3c3de]

2005-02-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request-balancer-child.c:
	Added assert
	[42d18b4e5047]

2005-02-12  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/master/mail-process.c:
	If setpriority() is found, allow userdb set mail processes' priority
	by returning nice parameter.
	[852d010a4563]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-request-handler-default.c, src/auth
	/auth-request.c, src/auth/auth-request.h, src/auth/db-ldap.c,
	src/auth/db-ldap.h, src/auth/passdb-cache.c, src/auth/passdb-ldap.c,
	src/auth/passdb-sql.c, src/auth/userdb-ldap.c, src/auth/userdb-
	passdb.c, src/auth/userdb-passwd-file.c, src/auth/userdb-passwd.c,
	src/auth/userdb-sql.c, src/auth/userdb-static.c, src/auth/userdb-
	vpopmail.c, src/auth/userdb.h, src/master/mail-process.c:
	userdb can now return extra parameters to master. Removed special
	handling of home/mail wherever possible, they're just regular extra
	parameters now. LDAP passdb and static userdb can return extra
	parameters now.
	[8849f2e380d1]

	* src/imap/cmd-append.c:
	Don't crash if client disconnects in the middle of APPEND. The last
	fix was incorrect.
	[7eb1995f5a27]

2005-02-11  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-fetch.c, src/imap/imap-fetch.c, src/imap/imap-fetch.h:
	If UID FETCH notices in the middle of fetching that message is
	expunged, don't fail but just don't return all the data.
	[13dbff915a1a]

2005-02-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c:
	cache growing crashfix
	[9abab33f1262]

2005-02-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	lstat() the root directory before trying to mkdir() it.
	[55a36d3793e4]

	* src/lib-storage/index/maildir/maildir-storage.c:
	code cleanup
	[c16260eab83f]

	* src/auth/userdb-vpopmail.c:
	compile fixes
	[a6e0776ac938]

	* src/auth/mech-rpa.c:
	Realm fixes. Patch by Andrey Panin
	[400624966554]

	* src/lib-index/mail-index-sync.c:
	Keyword reset crashfix
	[cf00d5631c2a]

	* src/lib-index/mail-index-transaction.c:
	Don't crash with empty keyword lists.
	[d0981562a9a3]

	* src/lib-index/mail-transaction-log-append.c:
	forgot to add
	[d9327a3dbf97]

	* src/lib-index/mail-index.c:
	Don't allow duplicate extension names in index header.
	[6c7d463eaf1e]

2005-02-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/Makefile.am, src/lib-index/mail-index-sync.c, src/lib-
	index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log.c:
	Moved code into mail-transaction-log-append.c
	[9a8bf1c86699]

	* src/imap/cmd-select.c, src/imap/cmd-unselect.c:
	Don't try to access closed mailbox after the closing gives an error.
	[941e381733a8]

	* dovecot-example.conf:
	Added a reminder about needing a default namespace.
	[33cbe3dec3b8]

	* src/auth/passdb-sql.c:
	Fixes credentials retrieving from sql passdb. Patch by Andrey Panin.
	[c9889006321d]

	* dovecot-example.conf:
	small updates
	[2bac730c250f]

2005-02-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-authenticate.c, src/imap/cmd-capability.c, src/imap
	/cmd-check.c, src/imap/cmd-close.c, src/imap/cmd-copy.c, src/imap
	/cmd-create.c, src/imap/cmd-delete.c, src/imap/cmd-examine.c,
	src/imap/cmd-expunge.c, src/imap/cmd-fetch.c, src/imap/cmd-idle.c,
	src/imap/cmd-list.c, src/imap/cmd-login.c, src/imap/cmd-logout.c,
	src/imap/cmd-lsub.c, src/imap/cmd-namespace.c, src/imap/cmd-noop.c,
	src/imap/cmd-rename.c, src/imap/cmd-search.c, src/imap/cmd-select.c,
	src/imap/cmd-sort.c, src/imap/cmd-status.c, src/imap/cmd-store.c,
	src/imap/cmd-subscribe.c, src/imap/cmd-thread.c, src/imap/cmd-uid.c,
	src/imap/cmd-unselect.c, src/imap/cmd-unsubscribe.c, src/imap
	/commands-util.c, src/imap/commands-util.h, src/imap/commands.h,
	src/imap/imap-fetch-body.c, src/imap/imap-fetch.c, src/imap/imap-
	fetch.h, src/imap/imap-search.c, src/imap/imap-search.h, src/imap
	/imap-sort.c, src/imap/imap-sort.h, src/imap/imap-sync.c, src/imap
	/imap-sync.h, src/imap/imap-thread.c, src/imap/imap-thread.h:
	Moved command-specific variables from struct client to struct
	client_command_context and changed code to use it.
	[61abed5f7864]

	* src/lib-index/mail-index-dummy-view.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-view-private.h:
	Keep index pointer in dummy views.
	[9810fafd04ff]

	* src/imap/client.h, src/imap/commands-util.h, src/imap/commands.h:
	cleanups
	[b813612188d3]

	* src/imap/cmd-append.c, src/imap/cmd-store.c, src/lib-index/mail-
	index-private.h, src/lib-index/mail-index-sync-keywords.c, src/lib-
	index/mail-index-sync-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index.h, src/lib-index/mail-transaction-
	log.c, src/lib-index/mail-transaction-log.h, src/lib-index/mail-
	transaction-util.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/mail-copy.c, src/lib-storage/mail-storage-private.h,
	src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h, src
	/lib-storage/proxy-mailbox.c:
	Internal changes in how keywords are handled. struct mail_keywords
	isn't automatically freed anymore, added *_keywords_free() for that.
	[fbe844061fe2]

2005-02-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c:
	cleanups / minor fixes
	[0383923d4759]

2005-02-01  Timo Sirainen  <tss@iki.fi>

	* src/pop3-login/client-authenticate.c, src/pop3/capability.h:
	Don't advertise USER capability if we're not allowing plaintext
	authentication.
	[bf8bc07e546e]

	* configure.in:
	-gnu99 was set again after it was optionally set..
	[d1e5f7ca0f20]

2005-01-31  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-sync.c:
	Recent flags weren't being removed from index causing needless
	syncing.
	[ac9793c61f29]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	cleanup
	[c1840ac9fda6]

	* src/lib/file-dotlock.c:
	Inode info wasn't saved when using file_dotlock_open() so
	file_dotlock_delete() thought it was overridden and didn't delete
	it.
	[3281674159b5]

	* src/imap/cmd-append.c:
	And a non-crashing fix.
	[e139dcb1744d]

	* src/imap/cmd-append.c:
	Don't crash if client disconnects in the middle of APPEND.
	[d14b7e7943c3]

	* src/lib-index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-
	index/mail-index.c:
	Don't complain about cache indexid changing when recreating index.
	[1ea614abead3]

2005-01-30  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/pop3-login/client.c:
	compile fix
	[ff8cb5728395]

	* src/auth/userdb-passwd-file.c:
	userdb passwd-file wasn't working. Patch by Joseph Tam.
	[b5c20f0a9649]

	* src/login-common/main.c:
	inetd startup wasn't working. Patch by Magnus Holmgren.
	[4868d061794c]

	* src/lib-storage/index/maildir/maildir-storage.c:
	If maildir-shared exists in the Maildir root, copy it for each
	created mailbox.
	[6446a730f7d1]

	* src/imap-login/client.c, src/pop3-login/client.c:
	Treat ::ffff:127.* addresses as secure as well.
	[122ddc6cc9f5]

2005-01-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-ext.c:
	Don't crash when extension header is resized and there are
	extensions after it.
	[c663b234cfcb]

2005-01-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c:
	optimization.
	[314df8f53731]

	* src/lib-index/mail-index-transaction.c:
	one more fix
	[e5a75a7c4ffd]

	* src/lib-index/mail-index-transaction.c:
	still not right
	[9a1ae6bc01f4]

	* src/lib-index/mail-index-transaction.c:
	and more fixing..
	[8ea8ff089ae3]

	* src/lib-index/mail-index-transaction.c:
	fix
	[eea18691435e]

	* src/lib-index/mail-index-transaction.c:
	fixes
	[fd973ec62103]

	* src/lib-index/mail-index-transaction.c:
	extra assert to make sure struct mail_keywords isn't tries to be
	used between multiple indexes.
	[c358df7edc35]

	* src/lib-index/mail-index-transaction.c:
	fix
	[eb0293fbcccf]

2005-01-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/Makefile.am, src/lib-index/mail-index-dummy-view.c,
	src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-transaction.c, src/lib-index/mail-
	index-view-private.h:
	Instead of using separate transaction sorting code for syncing, just
	put the data from transactions into a temporary transaction and read
	it from there.
	[7c7299d1acfe]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index.h:
	Added mail_index_update_flags_range() and optimized the non-range
	version as well.
	[2f53b73b3ea6]

	* src/pop3/commands.c:
	\Seen flag wasn't actually being set with RETR.
	[b5731614206e]

	* src/lib-index/mail-transaction-log.h:
	Added padding field explicitly for struct
	mail_transaction_flag_update. It was done before anyway by compiler.
	[b1eaafa49f53]

2005-01-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	When all mails have been expunged, write dummy message.
	[566558dcc228]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	Don't allow X-UID headers larger than current next-uid.
	[bb426c8a8c3f]

2005-01-17  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	The actual fix for last commit..
	[38fa28004689]

	* src/imap/imap-sync.c:
	FETCH deinitialization wasn't done properly
	[adb1a574215b]

2005-01-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-transaction-log-private.h, src/lib-
	index/mail-transaction-log.c, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/mbox/mbox-lock.c, src/lib-storage/subscription-file
	/subscription-file.c, src/lib/file-dotlock.c, src/lib/file-
	dotlock.h:
	Changed dotlocking API.
	[9c4aa309dbac]

	* src/lib-index/mail-index-sync-ext.c, src/lib-index/mail-index.c:
	Added asserts
	[f58ff8ec50c4]

	* src/lib-index/mail-index-transaction.c:
	Removed assert which crashed us every time we were setting flags to
	messages in non-increasing order (could be done only with POP3).
	[82e025ea6989]

	* src/lib-index/mail-cache.c:
	When we detect cache corruption, just mark the cache as unusable
	instead of immediately closing the file and unmapping. It's too
	difficult to keep track of all the possible ways in which that can
	break and cause "bad file descriptor" errors and maybe crashes..
	[f2f03044b6b2]

	* src/lib-index/mail-index-transaction.c:
	crashfix
	[0507efd4eaee]

	* src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Fixes by Kazuo Moriwaka
	[6269725cce58]

	* src/imap/imap-fetch.c:
	FETCH BODY[] wasn't setting \Seen flag.
	[395d7b248caa]

	* src/auth/password-scheme-md5crypt.c:
	MD5crypt was broken with 64bit systems.
	[fdec0a4ca1d1]

2005-01-15  Timo Sirainen  <tss@iki.fi>

	* src/lib/sendfile-util.c:
	Don't call sendfile() if count=0. With FreeBSD this fixes an assert
	crash.
	[80f7ea6aa94c]

	* configure.in:
	Don't use -std=gnu99 if gcc doesn't support it.
	[3ba362513202]

	* src/lib-index/mail-index-transaction.c:
	static -> dynamic keyword buffer. It's not actually possible to know
	the minimum needed size for the buffer beforehand.
	[65b2d1ec3596]

2005-01-13  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	Change effective GID as well before trying chdir() to mail
	directory.
	[8f254acc036c]

	* src/auth/db-ldap.c, src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Move default filters/attrs to setting defaults rather than check it
	from code. Also fixes a crash.
	[d78e9a31b6d8]

	* src/lib-mail/message-parser.c:
	MIME boundary parsing fix.
	[ff153dc3910a]

	* src/lib-mail/rfc822-parser.c:
	Quoted strings were parsed wrong.
	[e8a2f4358ca6]

	* configure.in:
	Give -std=gnu99 option to gcc.
	[0704b595c873]

2005-01-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c, src/lib-index/mail-
	transaction-log.c:
	Fixed crashes with keywords code when copying/saving many mails.
	[ac3f22f49695]

	* src/pop3-login/client-authenticate.c:
	Don't allow multiple PASS commands after a USER command. Patch by
	Andrey Panin.
	[a171aa34f0e8]

2005-01-11  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-ldap.conf, src/auth/passdb-ldap.c, src/auth/userdb-
	ldap.c:
	Support variables in LDAP base setting.
	[441759ac4f6a]

	* TODO:
	sorted things
	[769e2e2bf1d5]

2005-01-10  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-store.c, src/lib-index/mail-index-private.h, src/lib-
	index/mail-index-sync-keywords.c, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index.c, src/lib-
	index/mail-index.h, src/lib-index/mail-transaction-log.c, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-mail.h, src
	/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/lib-storage/proxy-mail.c, src/lib-
	storage/proxy-mailbox.c:
	Keyword fixes.
	[66c44404f9a1]

	* src/lib-storage/index/maildir/maildir-sync.c:
	don't allocate memory from data stack uselessly.
	[73944f902165]

2005-01-09  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-request-handler-default.c:
	We were supposed to remove userdb_* fields from auth reply, but
	instead we removed everything else.
	[873ce1b9747e]

	* src/master/auth-process.c, src/master/log.c, src/master/log.h,
	src/master/login-process.c, src/master/mail-process.c:
	Disable log throttlong for auth process, and for login processes if
	login_process_per_connection=no.
	[a20882c4f092]

	* src/pop3-login/pop3-proxy.c:
	If login failed, send it as "-ERR [IN-USE]" rather as IMAP's "*
	BYE"..
	[620a00db2c7c]

	* src/auth/auth-request-handler-default.c:
	memory leak fix
	[423af565a8b9]

	* src/auth/auth-master-connection.c:
	Don't close balancer listener after one worker has connected..
	[f2671cf166da]

	* src/master/auth-process.c:
	Don't send balancer listener fd to auth workers.
	[b76fed3280be]

	* src/auth/main.c:
	fix
	[fbfd3e691bc5]

	* src/auth/Makefile.am, src/auth/auth-client-connection.c, src/auth
	/auth-master-connection.c, src/auth/auth-master-connection.h,
	src/auth/auth-request-balancer-child.c, src/auth/auth-request-
	balancer-worker.c, src/auth/auth-request-balancer.h, src/auth/auth-
	request-handler-balancer.c, src/auth/auth-request-handler-default.c,
	src/auth/auth-request-handler.c, src/auth/auth-request-handler.h,
	src/auth/auth.c, src/auth/auth.h, src/auth/common.h,
	src/auth/main.c, src/auth/mech.h, src/master/auth-process.c:
	Changed the way multiple auth processes are handled. It no longer
	uses a pid appended to socket name but instead there's a balancer
	process which proxies the requests to worker processes.
	[eb46a5dee02d]

	* src/lib/network.c:
	Use nonblocking connecting for unix sockets.
	[8d15fea729c2]

	* src/auth/main.c, src/lib/network.c, src/lib/network.h, src/login-
	common/master.c, src/master/auth-process.c, src/master/main.c:
	Added backlog parameter for net_listen*().
	[9cb91ed5a110]

	* src/auth/Makefile.am, src/auth/auth-client-connection.c, src/auth
	/auth-client-connection.h, src/auth/auth-master-connection.c,
	src/auth/auth-master-connection.h, src/auth/auth-request-handler.c,
	src/auth/auth-request-handler.h, src/auth/auth-request.c, src/auth
	/auth-request.h, src/auth/main.c, src/auth/mech-apop.c, src/master
	/auth-process.c:
	Moving code around.
	[3feb38ff17f5]

	* src/auth/common.h, src/auth/main.c, src/auth/mech-apop.c,
	src/pop3-login/client.c:
	Require a valid timestamp in APOP challenge.
	[7e0caae73c59]

2005-01-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-connection.c, src/auth/auth-request.c, src/auth
	/auth-request.h, src/auth/mech-anonymous.c, src/auth/mech-apop.c,
	src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c, src/auth/mech-
	login.c, src/auth/mech-ntlm.c, src/auth/mech-plain.c, src/auth/mech-
	rpa.c, src/auth/mech.h:
	Another try with API cleanup.
	[289a98ba5d95]

	* src/auth/auth-client-connection.c, src/auth/auth-request.c, src/auth
	/auth-request.h, src/auth/mech-anonymous.c, src/auth/mech-apop.c,
	src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c, src/auth/mech-
	login.c, src/auth/mech-ntlm.c, src/auth/mech-plain.c, src/auth/mech-
	rpa.c, src/auth/mech.h:
	API cleanup
	[c7db6b291daa]

	* doc/auth-protocol.txt, src/auth/auth-client-connection.c, src/auth
	/auth-client-connection.h:
	Removed SERVICE command. It's quite useless extra state to keep
	around.
	[305ac76afcda]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-request.c, src/auth/auth-request.h,
	src/auth/auth.c, src/auth/auth.h, src/auth/common.h, src/auth/db-
	passwd-file.c, src/auth/main.c, src/auth/mech-anonymous.c, src/auth
	/mech-apop.c, src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c,
	src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth/mech-plain.c,
	src/auth/mech-rpa.c, src/auth/passdb-bsdauth.c, src/auth/passdb-
	cache.c, src/auth/passdb-checkpassword.c, src/auth/passdb-ldap.c,
	src/auth/passdb-pam.c, src/auth/passdb-passwd-file.c, src/auth
	/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth/passdb-sql.c,
	src/auth/passdb-vpopmail.c, src/auth/passdb.c, src/auth/userdb-
	ldap.c, src/auth/userdb-passdb.c, src/auth/userdb-passwd.c, src/auth
	/userdb-sql.c, src/auth/userdb-vpopmail.c, src/auth/userdb-
	vpopmail.h, src/auth/userdb.c:
	Added auth_request_log_*().
	[131151e25e4b]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/auth-request.c, src/auth/auth-request.h,
	src/auth/mech-apop.c, src/auth/mech-cram-md5.c, src/auth/mech-
	digest-md5.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth
	/mech-plain.c, src/auth/mech-rpa.c, src/auth/passdb.h,
	src/auth/userdb.h:
	Cleanups.
	[b01a8fa09f94]

2005-01-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h, src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/mbox/mbox-mail.c:
	mail->expunged field wasn't actually set. Now it's always set if
	wanted_fields contains message header or body.
	[4c92f9eae613]

	* src/auth/passdb.c, src/auth/passdb.h, src/auth/userdb.c,
	src/auth/userdb.h:
	Moved extern userdb/passdb declarations to .c files.
	[34c1cf646467]

	* src/auth/Makefile.am, src/auth/auth-client-connection.c, src/auth
	/auth-client-connection.h, src/auth/auth-master-connection.c,
	src/auth/auth-master-connection.h, src/auth/auth-request.c, src/auth
	/auth-request.h, src/auth/auth.c, src/auth/auth.h,
	src/auth/common.h, src/auth/main.c, src/auth/mech-anonymous.c,
	src/auth/mech-apop.c, src/auth/mech-cram-md5.c, src/auth/mech-
	digest-md5.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth
	/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	src/auth/mech.h, src/auth/passdb.c, src/auth/passdb.h,
	src/auth/userdb.c, src/auth/userdb.h:
	Reorganized the code to have less global/static variables.
	[29d83a8bb50d]

	* src/auth/Makefile.am, src/auth/auth-cache.c, src/auth/auth-client-
	connection.c, src/auth/auth-master-connection.c, src/auth/auth-
	request.c, src/auth/auth-request.h, src/auth/main.c, src/auth/mech-
	anonymous.c, src/auth/mech-apop.c, src/auth/mech-cram-md5.c,
	src/auth/mech-digest-md5.c, src/auth/mech-login.c, src/auth/mech-
	ntlm.c, src/auth/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	src/auth/mech.h, src/auth/userdb.h:
	Split auth_request* functions from mech.c to auth-request.c
	[2d33734b16d5]

	* src/auth/checkpassword-reply.c, src/auth/passdb-checkpassword.c:
	userdb = passdb works now with checkpassword passdb.
	[a0fbf92b41c3]

	* configure.in, src/auth/Makefile.am, src/auth/auth-client-
	connection.c, src/auth/userdb-passdb.c, src/auth/userdb.c,
	src/auth/userdb.h:
	Added "passdb" userdb. It works only if passdb gives all the
	information needed for userdb. For example with SQL you can use "..
	uid AS userdb_uid, gid AS userdb_gid, home AS userdb_home .." in
	password_query.
	[5e2e4cdbfe2e]

	* src/auth/passdb-ldap.c, src/auth/userdb-ldap.c, src/lib/strfuncs.c,
	src/lib/strfuncs.h:
	Renamed strarray_join() to t_strarray_join() and made it not to
	crash..
	[42c1ca1f7a45]

	* src/lib-auth/auth-server-request.c:
	If connection to auth server is lost, reply with temp error.
	[4242c19c8617]

	* src/imap-login/client-authenticate.c, src/login-common/common.h,
	src/pop3-login/client-authenticate.c:
	If authentication failed because of temporary failure, show
	different error message to clients.
	[08c640bdf749]

	* doc/auth-protocol.txt, src/auth/auth-client-connection.c, src/auth
	/mech-anonymous.c, src/auth/mech-apop.c, src/auth/mech-cram-md5.c,
	src/auth/mech-digest-md5.c, src/auth/mech-login.c, src/auth/mech-
	ntlm.c, src/auth/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	src/auth/mech.h, src/auth/passdb-ldap.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-sql.c, src/auth/passdb.c, src/auth/passdb.h:
	Make FAIL reply contain "temp" parameter if the authentication
	failed because of temporary internal error. Also cleaned up the auth
	code a bit.
	[052f3a5743af]

	* src/lib-auth/auth-server-request.c:
	typofix
	[3e5faae6f10b]

	* src/login-common/sasl-server.c:
	cleanup
	[90ac3ec026cf]

	* src/lib-sql/driver-mysql.c:
	removed debugging info
	[6994f6e8be2b]

	* src/imap-login/imap-proxy.c, src/pop3-login/pop3-proxy.c:
	proxy: When we can't connect to remote server, show "Temporary login
	failure." error to client instead of internal error.
	[a5dbe1e56c07]

	* src/lib-sql/driver-mysql.c:
	Mysql driver supports connecting to multiple servers by giving
	multiple host= parameters in connect string. The queries are sent
	round robin, and if the query fails because of lost connection for
	one server it's retried on next one.
	[1d005cdce6ec]

	* src/lib-sql/driver-mysql.c:
	Check if mysql_fetch_row() returns error.
	[ced4abfdb2f9]

	* doc/dovecot-sql.conf:
	Removed moin.cgi/ from Wiki reference, it's not needed anymore.
	[b1efe06092ac]

	* src/util/rawlog.c:
	rewrote rawlog code. it's now fully asynchronous which could make it
	a bit faster, and it should also fix some hangs with it. Timestamps
	are written now only with IMAP.
	[83034650fef4]

	* src/login-common/login-proxy.c:
	s/proxy/server/ for variables describing remote server.
	[7f503848533e]

	* TODO:
	updated
	[12fc3c22ffe8]

	* src/lib-mail/message-parser.c:
	We didn't handle properly missing boundaries.
	[89c49afa57fd]

2005-01-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-body-search.c:
	When searching inside MIME part headers, we were using wrong charset
	for the search key. It was already in UTF-8.
	[c35e02d5724a]

	* src/lib-storage/index/index-mail-headers.c:
	mail->get_header() was pretty broken. This affected SORT/THREAD.
	[ccfd78cc07cc]

	* src/lib-mail/message-address.c:
	Allow giving data stack pool for message_address_parse()
	[2d4630db33fd]

	* src/auth/db-passwd-file.c, src/auth/userdb-ldap.c, src/auth/userdb-
	sql.c, src/auth/userdb-static.c, src/auth/userdb.c,
	src/auth/userdb.h:
	If UID or GID isn't numeric, look it up from passwd/group.
	[8b80b69938f0]

	* src/auth/userdb-ldap.c:
	Keep auth_request around so it can be used in error messages.
	[4455da56ad87]

	* src/lib/file-dotlock.c:
	Use random_fill_weak() when creating dotlock file names.
	[933b65191ca3]

	* src/auth/main.c, src/lib/randgen.c, src/lib/randgen.h:
	Added random_fill_weak() and make random_init() always initialize
	srand() with a seed from random_fill().
	[50acbcc7e4d8]

	* src/imap/imap-sort.c, src/lib-imap/imap-envelope.c, src/lib-
	mail/Makefile.am, src/lib-mail/message-address.c, src/lib-mail
	/message-address.h, src/lib-mail/rfc822-parser.c, src/lib-
	mail/rfc822-parser.h, src/lib-storage/index/index-search.c:
	Added rfc822 parser which will probably replace message_tokenizer at
	some point. Rewrote address parsing with the new parser. This fixes
	various bugs in it.
	[d6910d273852]

	* src/lib/strfuncs.c, src/lib/strfuncs.h:
	Added strarray_join().
	[2f7ffdcd7d67]

	* src/pop3/Makefile.am, src/pop3/mail-storage-callbacks.c:
	lib-imap isn't needed in includes.
	[2beaee54e942]

	* src/auth/auth-master-connection.c, src/auth/passdb-ldap.c, src/auth
	/passdb-sql.c, src/auth/passdb-vpopmail.c, src/auth/userdb-ldap.c,
	src/auth/userdb-sql.c:
	Added authentication debugging logging.
	[fcecff14e470]

2005-01-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Don't break if line begins with NUL. Don't return -2 as long as
	underlying stream is returning more data (don't just retry once).
	[6f1ea1c7212f]

2004-12-29  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c, src/pop3/main.c:
	Print effective uid/gid when mail_debug is enabled.
	[de1b904c4df2]

	* dovecot-example.conf, src/imap/namespace.c, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-list.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/mail-storage-private.h, src/lib-storage
	/mail-storage.c, src/lib-storage/mail-storage.h, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h, src/pop3/main.c:
	Added mail_debug setting. Moved full_filesystem_access from global
	variable to flag in mail_create*() functions.
	[146897976cfa]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Added assert
	[bf6a77e42151]

	* src/lib-imap/imap-util.h:
	compiler warning fix
	[2c923618fb3b]

	* doc/mail-storages.txt:
	Fixes.
	[1f92f41addea]

	* doc/Makefile.am, doc/USE-WIKI-INSTEAD:
	Added.
	[166916ab6b1b]

	* dovecot-example.conf:
	Added wiki references.
	[16183e87beaf]

	* dovecot-example.conf, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Removed maildir_check_content_changes setting. The feature hasn't
	existed for a long time.
	[7321b943b34e]

	* dovecot-example.conf:
	Updated comments.
	[80f7050c8bb5]

	* src/lib-storage/index/mbox/mbox-sync.c:
	we synced one message more than necessary when we were applying
	changes.
	[44c5e8c50ad4]

	* src/imap/commands-util.c:
	Don't create empty keyword lists.
	[8939c2d75a89]

	* src/lib-index/mail-transaction-log.c:
	Don't crash if keyword update doesn't actually have any keywords
	set.
	[9d1b05604dd9]

	* src/auth/password-scheme.c:
	comment cleanup.
	[f2d7d6dcedd7]

2004-12-28  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	Updated mail_cache_fields and mail_never_cache_fields comments.
	[b987319c7ce3]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	Removed "mail.uid". It's not used and will not be used.
	[d81d15553644]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Added assert.
	[eaf1778d41f5]

2004-12-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-view-sync.c:
	Flag updates got lost if there were internal flag updates in same
	transaction.
	[43685e7aa7b1]

	* src/imap/commands-util.c, src/imap/commands-util.h:
	const fixes
	[044b478e72e6]

	* src/imap/cmd-append.c, src/imap/cmd-store.c, src/imap/commands-
	util.c, src/imap/commands-util.h, src/imap/imap-fetch.c, src/imap
	/imap-fetch.h, src/imap/imap-sync.c, src/lib-imap/imap-util.c, src
	/lib-imap/imap-util.h, src/lib-index/Makefile.am, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index-sync-keywords.c, src
	/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction-private.h, src/lib-index/mail-index-transaction.c, src
	/lib-index/mail-index-view-sync.c, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-transaction-log.c, src/lib-index/mail-transaction-log.h,
	src/lib-index/mail-transaction-util.c, src/lib-mail/mail-types.h,
	src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h, src/lib-storage/index/index-search.c, src/lib-storage/index
	/index-status.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-util.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c, src
	/lib-storage/mail-copy.c, src/lib-storage/mail-storage-private.h,
	src/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h, src
	/lib-storage/proxy-mail.c, src/lib-storage/proxy-mailbox.c,
	src/pop3/client.c, src/pop3/commands.c:
	Initial support for keywords. Syncing to mbox/maildir doesn't work
	yet.
	[61c8d205d887]

	* src/imap/mail-storage-callbacks.c:
	Removed unused include.
	[bd60ceddab2f]

	* src/lib/strfuncs.c, src/lib/strfuncs.h:
	Added strarray_length().
	[f23e9957544f]

2004-12-22  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	pop3_enable_last setting wasn't actually being passed to pop3
	process. Patch by Andrey Panin.
	[b4891c3917eb]

2004-12-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-from.c:
	Support "quoted spaces" in From-line sender's local-part. Postfix at
	least may write these..
	[f71446dc9b38]

2004-12-20  Timo Sirainen  <tss@iki.fi>

	* src/auth/main.c, src/master/auth-process.c:
	Fixes for using socket listen { .. } in auth sections.
	[ea37520d92e3]

	* src/lib-mail/message-body-search.c, src/lib-mail/message-header-
	search.c:
	Memory leak fix + crashfixes. Found and fixes by Kazuo Moriwaka
	[2a7355f6ebff]

	* src/lib-storage/index/mbox/mbox-lock.c:
	Fix crashes when handling stale dotlocks.
	[2ec32b88c123]

	* src/lib-index/mail-index-sync-update.c:
	comment update
	[8f8a95e06479]

	* src/lib-index/mail-index-sync-update.c:
	still not right :)
	[afbedc8fc88e]

	* src/lib-index/mail-index-sync-update.c:
	Again, don't crash if there are no expunge handlers..
	[496c28357ae6]

	* src/lib-index/mail-index-sync-ext.c:
	If there are no extensions, don't crash while expunging.
	[a41e1f9b9b14]

	* configure.in:
	Don't use GNUTLS unless explicitly specified. It's not working
	currently anyway..
	[60a172e62d11]

	* src/imap/imap-search.c:
	Don't try to uppercase search strings. It breaks some character
	sets.
	[95fad52fec69]

	* configure.in, src/lib/compat.c, src/lib/compat.h:
	If strtoull() isn't supported, fallback to strtouq(). If that's not
	found either, use our own implementation.
	[9f765960fca6]

2004-12-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.h:
	Warning fix for cygwin.
	[d86d770ffb85]

	* src/lib-index/mail-cache-transaction.c:
	Type changes, was probably broken with 64bit systems.
	[288a0d56c846]

	* src/lib-index/mail-cache-private.h:
	mail_cache_decision_*() prototypes were wrong.
	[1d328531c466]

	* src/lib/mmap-util.c:
	my_madvise() wasn't returning anything.
	[7e1fdbdaf465]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	In some cases we may have crashed if header didn't end with LF+LF.
	[c64674a0a92a]

	* dovecot-example.conf, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/maildir/maildir-mail.c, src/lib-storage/mail-
	storage.h, src/pop3/commands.c, src/pop3/common.h, src/pop3/main.c:
	Added %f pop3_uidl_format for maildir. Patch by Andrey Panin.
	[9219e788d774]

	* src/util/dovecotpw.c:
	Include libgen.h only if it exists.
	[de524f4a1075]

	* src/auth/db-ldap.c, src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Fixed crashing due to free()ing too much.
	[1ed01cfed3a9]

	* src/imap/imap-search.c:
	SEARCH UNKEYWORD wasn't working.
	[2c92a14458e6]

	* src/lib-index/mail-index-sync-ext.c:
	Don't crash if last extension in record needs padding.
	[3c192eebd919]

	* src/imap/imap-fetch-body.c:
	MIME part header fetches weren't working correctly.
	[ca4341dbde8a]

	* src/lib-mail/istream-header-filter.c:
	Seeking backwards to headers wasn't working.
	[57f91991f4ca]

2004-12-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c:
	Don't call bsearch() with zero member count, it crashes in Solaris.
	[83c791a0b6d9]

2004-12-17  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream-file.c:
	Go back to the version before recent changes. It was correct all the
	time.
	[76d0e16d45e6]

	* src/lib-storage/index/index-storage.h:
	Added mbox_writeonly variable, forgot in last commit.
	[d1a2c39d1b50]

	* src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-sync.c:
	Named pipes are now treated as write-only mboxes.
	[51a05fd00324]

2004-12-16  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream-file.c:
	o_stream_send_istream() was broken and could have just caused
	copying to be done infinitely filling up disk.
	[f1e67917a669]

	* src/lib-auth/auth-server-request.c:
	Fix when using multiple auth processes.
	[3fb1808e7bff]

	* src/lib/istream-limit.c:
	Added assert.
	[c20a64efd608]

	* src/lib/ostream-crlf.c:
	LF-stream might have counted the bytes wrong in certain situations,
	causing it to skip more data from input than it should have. Caused
	hangs sometimes when APPENDing into mbox.
	[3dedde6646c5]

	* src/lib/ostream-file.c:
	Stream copying skipped too much input if the output buffer wasn't
	empty when it was called.
	[ac10b761f179]

	* src/lib-auth/auth-server-request.c:
	Crashfix
	[65e28b1be20e]

2004-12-15  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c:
	Deinitialize pending command only if it's actually executing. Fixes
	crash if client disconnected while command was only half sent.
	[10d1fd8d0865]

	* src/lib-storage/index/mbox/mbox-save.c:
	If mbox isn't synced, don't try to set message's md5sum because it
	just crashes..
	[982e7432276f]

	* src/lib/var-expand.c:
	Added support for multiple modifiers. Added %X = hex modifier.
	Prefixing width value with '0' adds '0'-padding to the string if
	it's smaller than width.
	[4a6788997812]

	* dovecot-example.conf, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.h,
	src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h, src/pop3/client.c, src/pop3/client.h,
	src/pop3/commands.c, src/pop3/common.h, src/pop3/main.c:
	Added pop3_uidl_format setting.
	[96a4ab34c8f1]

	* src/auth/auth-cache.c, src/lib/var-expand.c, src/lib/var-expand.h:
	Auth cache key was built wrong if any modifiers were used for %vars.
	Added var_get_key() function which skips over any modifiers and
	returns the actual key.
	[c59fd95ad3ee]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync.c:
	Removed X-UIDL header handling. It's not actually used.
	[8ef9f3d640e0]

	* src/lib-storage/index/mbox/mbox-save.c:
	If we want MD5 sums in indexes, mail saving should also add them.
	[32cc9186d8eb]

	* src/lib-storage/index/mbox/Makefile.am, src/lib-storage/index/mbox
	/mbox-md5.c, src/lib-storage/index/mbox/mbox-md5.h, src/lib-
	storage/index/mbox/mbox-sync-md5.c, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h:
	Reorganized mbox md5 summing code so it doesn't require sync context
	anymore.
	[7c4238c78aee]

	* src/auth/auth-cache.c:
	When building cache key, use each %key only once, more wastes only
	memory. This was mostly needed for more complex SQL queries where
	same key could be used multiple times.
	[1f7bcbb09f90]

	* src/lib-auth/auth-server-connection.c, src/lib-auth/auth-server-
	connection.h:
	Connect to available auth sockets by round robin.
	[e2876940968e]

	* src/master/auth-process.c:
	If login_process_per_connection=no, create a separate listener
	socket for each auth process, so a single long running login process
	can talk to multiple auth processes for load distribution.
	[cad3a8913d4a]

	* src/lib-index/mail-cache-fields.c:
	Check for duplicate fields in header.
	[2ab037df6cf3]

	* dovecot-example.conf, src/lib-storage/index/index-storage.h, src
	/lib-storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/index/mbox/mbox-transaction.c,
	src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Added mbox_very_dirty_syncs setting.
	[b31f48d152c4]

2004-12-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	Continuing last header-md5 commit..
	[7ea6705240b3]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/mbox-sync-parse.c, src/lib-storage/index/mbox/mbox-sync.c:
	Always register the header-md5, but use separate variable to figure
	out if it should actually be used.
	[89fd53e406dd]

	* src/lib-storage/index/mbox/Makefile.am, src/lib-storage/index/mbox
	/mbox-sync-md5.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src
	/lib-storage/index/mbox/mbox-sync-private.h:
	Moved mbox header MD5 summing code into separate file so it's easily
	changed.
	[e032167a05ca]

2004-12-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c:
	If log file sequences get broken, complain instead of crashing.
	[c0bdb35277fc]

	* src/lib-storage/index/mbox/mbox-sync.c:
	A few extra asserts.
	[d048ef0a67f2]

2004-12-09  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-master-connection.c, src/auth/mech.c, src/auth/mech.h:
	When master looked for auth request, it didn't check if the
	authentication was yet finished, so auth client could have fooled
	master by beginning authentication without finishing it. Login
	processes didn't allow users to do this though, so no real problem.
	[155386b3149d]

	* src/master/master-settings.c:
	Don't change login dir permissions if using external auth.
	[41a4ea8496d6]

2004-12-08  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-create.c:
	CREATE dir/ wasn't working.
	[b9d1e0262568]

	* src/lib-storage/index/mbox/mbox-storage.h:
	Changed mbox header padding back to 50. It was 5 for debugging
	(probably shouldn't have been committed).
	[d05f419978b2]

	* src/auth/mech.c, src/auth/mech.h:
	Requests in failed response queue could still be found from request
	queue and destroyed again. This made it possible to crash dovecot-
	auth by sending more authentication data than was expected.
	[2f0fd2e7ab89]

2004-12-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	Added assert
	[cd257e96a370]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Fixed mbox corruption in certain situations. Added more asserts to
	catch similiar problems if there still happens to be any.
	[d5ee1bbd15f0]

	* src/lib-index/Makefile.am, src/lib-index/mail-index-sync-ext.c, src
	/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-sync-
	update.c:
	Moved extension syncing code to separate file.
	[9dc7a7b06781]

	* src/lib-index/mail-index-sync-update.c:
	Sync contexts are always of type struct mail_index_sync_map_ctx.
	[ce8ff2279fb2]

	* dovecot-example.conf, src/pop3/commands.c, src/pop3/common.h,
	src/pop3/main.c:
	Added oe-ns-eoh workaround.
	[546214c0e6e9]

	* src/lib-index/mail-transaction-log.c:
	Crashfix for mmap_disable=yes.
	[93cdd2b92650]

	* src/lib-index/mail-cache-compress.c:
	mail_cache_merge_bitmask() was broken, cache compression could have
	crashed or produced broken results.
	[30110ac226a7]

	* src/lib-index/mail-cache-compress.c:
	Cache compression didn't work with lock_method = dotlock.
	[05ae72649fd0]

	* src/lib/file-dotlock.c:
	If pid in dotlock file is same as ours, assume a stale lock file.
	[0e7a0e204f5d]

	* src/imap/client.c:
	Added assert
	[a519f183bacf]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	storage.h:
	mail_deinit() wasn't used anymore.
	[06413236d3b1]

2004-12-06  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech.c:
	Crashfix for passdb cache. Patch by Andrey Panin.
	[e9d9fb39cf9e]

	* src/auth/passdb-cache.c:
	Cached passwords didn't return scheme correctly. Patch by Andrey
	Panin.
	[cd436a43dfd3]

	* src/auth/mech.c, src/auth/passdb.c:
	Mechanism list / passdb compatibility checking wasn't working
	because we were checking it before any mechanisms were initialized.
	[6a6e794bb6d3]

	* src/auth/passdb-bsdauth.c, src/auth/passdb-checkpassword.c, src/auth
	/passdb-ldap.c, src/auth/passdb-pam.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-sql.c, src/auth/passdb-vpopmail.c, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/userdb-ldap.c, src/auth/userdb-passwd-
	file.c, src/auth/userdb-passwd.c, src/auth/userdb-sql.c, src/auth
	/userdb-static.c, src/auth/userdb-vpopmail.c, src/auth/userdb.c,
	src/auth/userdb.h:
	Added name variable for userdb_module and passdb_module and changed
	their initialization a bit.
	[c7d426f8cb58]

2004-12-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache.c, src
	/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-transaction-log.c:
	lock_method=dotlock doesn't crash anymore while trying to modify
	cache file. We didn't previously deal with any fatal errors that
	fcntl/flock locking could have given but assumed that the locking
	succeeded.
	[89ab5c72430d]

	* src/lib-index/mail-index.c:
	Changed assert() to friendly human readable message.
	[0e1481357fbb]

	* src/lib-index/mail-index.c:
	mmap_disable=yes: when we're syncing index by reading transaction
	log, update map header's log file offsets so our checks that use
	them actually work.
	[00b78082cd50]

	* src/lib-index/mail-index.c:
	mmap_disable=yes: if mail_index_map() is called while syncing make
	sure we don't read past what is already synced into index.
	[bc8ff03715b2]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index.c:
	Added more asserts.
	[43deb226d769]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-lock.c, src
	/lib-index/mail-index-private.h, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/mbox
	/mbox-mail.c:
	Renamed mail_index_refresh() to mail_index_reopen_if_needed(). Added
	public mail_index_refresh() which makes sure index is fully
	refreshed at the time. Added mbox code to call it after mbox is
	locked to avoid using old mbox offsets.
	[57f975a9b63b]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index.c:
	Don't try to fsck when we're modifying index. It could have happened
	with corrupted transaction logs.
	[0b72e95cd3ae]

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache-sync-
	update.c, src/lib-index/mail-cache.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index.c:
	Added "sync lost" handlers which are called with mmap_disable=yes
	when index file is re-read without going through all of the
	transaction log.
	[c3ae75597952]

	* src/lib-index/mail-cache-sync-update.c, src/lib/file-cache.c,
	src/lib/file-cache.h:
	Changed file_cache_invalidate()'s size argument to uoff_t type.
	[6ec86fd705a6]

	* src/lib-index/mail-index-sync-update.c:
	Expunge sync handlers were using wrong extension contexts. This may
	have caused cache->locked asserts.
	[461bd8486083]

2004-12-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c:
	Don't crash with assert if transaction log was truncated
	unexpectedly.
	[3fc80d3ae8de]

	* src/lib-index/mail-index-fsck.c:
	If index is completely broken, don't try to fsck it since we'll just
	crash.
	[15e8ea839bf9]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache.c:
	Locking fixes and cleanups
	[ba9062032877]

	* src/pop3/commands.c:
	RETR: Don't bother adding \Seen flag to message if it's already
	there.
	[3470bb04fb57]

	* src/pop3/client.c:
	Timeout changes. Default idle timeout is now 10 minutes instead of
	30 minutes. Also before if client didn't read our output we didn't
	timeout it until after 16 hours (should have been one minute,
	changed it to 10min as well).
	[6e2129a4a595]

2004-12-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	Make sure index is reopened if it's marked corrupted.
	[c035583b4839]

	* src/lib-index/mail-cache-sync-update.c:
	Don't crash if we failed to lock cache file.
	[f7e3283137db]

2004-11-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-update.c:
	broken fix for sync handler deinitializing..
	[0e6ecb9d06e0]

	* src/lib-index/mail-index-sync-update.c:
	Sync handlers weren't always deinitialized with correct parameters.
	[52000679a7aa]

	* src/lib-index/mail-index.c:
	With mmap_disabled=no the index header wasn't always updated causing
	various problems.
	[fadf33c24902]

2004-11-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index.c:
	Wrong extension sync_handler might have been called if index
	extensions didn't match current map's extensions.
	[a5eda271256f]

	* src/lib-index/mail-cache.c:
	Don't write to closed cache file
	[9b772db4503d]

	* src/lib-index/mail-index-sync-update.c:
	Added assert
	[3cc0a992ac7d]

	* src/lib-index/mail-index-transaction-view.c:
	If extension data changes was actually found from transaction view,
	it was returned wrong. Caused problems with cache file.
	[7039fc53b4c8]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-transaction.c:
	Crashfixes for reading corrupted cache files.
	[e657c7874962]

	* src/lib/file-cache.c:
	Don't crash if trying to read more than INT_MAX bytes. Just silently
	allow it.
	[d1780331ad04]

	* src/auth/mech-ntlm.c, src/auth/mech-rpa.c:
	Initial response support for NTLM and RPA. Patch by Andrey Panin.
	[25bc79e67271]

	* src/lib-index/mail-cache-transaction.c:
	Make sure we don't try to write to cache file when it's already
	closed (could happen if it was corrupted).
	[37b81e395f00]

	* src/lib-index/mail-index.c:
	mmap_disable=yes fixes.
	[cd293e5e6a71]

	* src/lib-index/mail-index-sync-update.c:
	We were accessing map which was potentially already freed.
	[e491b5d1a73a]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	index.c:
	Changed mail_index_map_to_memory() to mail_index_map_clone(). Even
	if the index is already in memory, we wish to copy it instead of
	just raising refcount. Fixes some problems with mmap_disable=yes.
	[f2c2b17d7659]

	* src/lib-index/mail-cache-sync-update.c:
	Don't crash if cache is unusable.
	[1a9e4676196d]

	* src/lib-index/mail-index-sync-update.c:
	Don't mark map to be written into disk if we're syncing a view and
	not index.
	[f4eaf629bea3]

	* src/lib-index/mail-cache.c:
	Cache sync handler wasn't registered correctly so it broke with
	mmap_disable=yes.
	[ef0b296ad4dd]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Give UIDVALIDITY for empty mboxes too.
	[8fa07cbfd68e]

	* src/lib-index/mail-index-sync-update.c:
	Still need to update view->hdr..
	[b909bce742bf]

	* src/lib-index/mail-index-sync-update.c:
	sync_ext_reorder() sometimes added too much data to buffer.
	[1e0d71e67315]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction-view.c, src/lib-index/mail-index-transaction.c, src/lib-
	index/mail-index-view-private.h, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-index.h,
	src/lib-storage/index/index-sync.c, src/lib-storage/index/mbox/mbox-
	sync.c:
	Removed view->messages_count, view->hdr.messages_count is enough.
	Also fixes assert crash in mail_index_bsearch_uid().

	Renamed .._get_message_count() to get_messages_count() to be more
	consistent.
	[642ba9cd3dac]

	* src/lib-index/mail-index-sync-update.c:
	added assert
	[bd8f47bda4c7]

	* src/lib-index/mail-index.c:
	mail_index_write_base_header() doesn't crash anymore if index
	mapping is in memory. Recent changes broke it.
	[1022caefca74]

2004-11-28  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/pop3-login/client.c:
	Don't destroy client structure immediately when sending line fails.
	Fixes some writes to freed memory.
	[872172ffd005]

2004-11-26  Timo Sirainen  <tss@iki.fi>

	* src/login-common/master.c:
	fix
	[d22205c4539d]

2004-11-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	UID FETCH * gave error message with empty mailbox.
	[1a05764af1e0]

	* src/master/main.c:
	crashfix
	[cf678778b1fa]

	* src/pop3-login/client.c:
	Username given in USER was was not freed when destroying client.
	[90697bb3c368]

	* src/lib-index/mail-index.c:
	When we actually read index file's header make sure it gets copied
	to memory so log file offsets get updated.
	[305476a6f8ed]

2004-11-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index.c:
	Avoid re-reading index file with mmap_disable=yes.
	[51be21fc2c9d]

	* src/lib-index/mail-transaction-log.c:
	When committing transaction, don't do index locking unless we really
	want to try rotating the log file.
	[e7d6ae64fd68]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.h, src
	/lib-storage/index/maildir/maildir-sync.c:
	mail_index_refresh() isn't public anymore,
	mail_index_view_open_locked() works better for the purpose.
	[fd431866c674]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	decisions.c, src/lib-index/mail-index-transaction-view.c, src/lib-
	index/mail-index-view-private.h, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.h, src/lib-storage/index/index-mail.c, src
	/lib-storage/index/index-search.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Changed mail_index_get_header() to return the header as return value
	because it can't fail anymore.
	[62d53b49110d]

	* src/lib-storage/index/index-sync.c:
	recent flag fixes
	[aad29dd2c1c5]

	* src/lib-storage/index/index-sync.c:
	recent flag fixes
	[10d88ed22df0]

	* src/lib-storage/index/maildir/maildir-save.c:
	APPEND/COPY was broken with maildir.
	[51982771ba4c]

	* src/lib-index/mail-index-sync.c:
	If we synced external transactions at the beginning of index sync,
	we have to reopen the syncing view so it shows the latest updates.
	[c1b4d0e7dff0]

	* src/login-common/master.c:
	Don't access freed memory.
	[70ce8c45e86b]

	* src/master/auth-process.c, src/master/common.h, src/master/login-
	process.c, src/master/mail-process.c, src/master/main.c, src/master
	/master-settings.c:
	Allow running all executables with parameters.
	[634cf6aa34d1]

2004-11-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync.c,
	src/lib-index/mail-index-view-sync.c, src/lib-index/mail-index.c,
	src/lib-index/mail-transaction-log-view.c:
	Avoid re-reading index file with mmap_disabled=yes. Instead sync it
	by reading transaction log file.
	[1880f191278a]

	* src/imap/imap-sync.c, src/lib-index/mail-index-lock.c, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index-sync-update.c, src
	/lib-index/mail-index-sync.c, src/lib-index/mail-index-transaction-
	private.h, src/lib-index/mail-index-transaction-view.c, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index-view-
	private.h, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	index-view.c, src/lib-index/mail-index.c, src/lib-index/mail-
	transaction-log.c:
	Update view's header only after syncing the view. This and other
	changes fix several view syncing problems and crashes.
	[173a0296e81d]

	* src/lib-storage/index/index-search.c:
	We didn't give error if trying to search message by sequence in an
	empty mailbox.
	[1f5201e660c1]

	* src/lib-index/mail-transaction-log-view.c:
	When view was synced without expunges, we didn't actually sync the
	expunges later anymore.
	[dda3fe468ea3]

2004-11-12  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Make SIGUSR1 reopen log files.
	[bd3f5358de8b]

	* src/lib/lib-signals.c, src/lib/lib-signals.h:
	Add signal counters to USR1 and USR2 signals too.
	[f2718224c9e9]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log.c, src/lib-storage/index/maildir
	/maildir-storage.c:
	dovecot-shared file was supposed to show permissions/gid for files
	created in the maildir, but it didn't work for indexes.
	[aa93c7216722]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c:
	APPEND was using all CPU.
	[904c31d74acc]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index-view-
	private.h, src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	src/lib-index/mail-transaction-log.c, src/lib-storage/index/index-
	transaction.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	sync.c:
	Allow specifying to transaction if it's external. Make mail saving
	transactions external to avoid problems with uids.
	[3cb483d565a6]

2004-11-11  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-ntlm.c, src/lib-ntlm/ntlm-message.c:
	allow LM authentication for older (Win9x) clients which do not pass
	NTLM response in type 3 message. fixes crash in dovecot-auth (empty
	credentials could be passed to hex_to_binary function if NTLM2 was
	negotiated). Patch by Andrey Panin
	[78dc2381f3af]

	* src/imap/cmd-fetch.c:
	Make sure fetching gets deinitialized properly if connection closes
	in the middle of it.
	[90f2ac2d16df]

	* src/lib-index/mail-index-sync-update.c:
	crashfix
	[0f485075ba8f]

2004-11-09  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c, src/pop3/main.c:
	Make sure imap or pop3 processes cannot be started from inetd.
	[72f28a4b964d]

2004-11-08  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib/compat.c, src/lib/compat.h:
	Check for libgen.h and if it's not found, use my_basename(). Also
	my_seteuid() didn't actually replace seteuid() before if it didn't
	exist.
	[c0e2a38b7647]

	* src/lib-index/mail-index-sync-update.c:
	crashfix
	[d72a03773b2f]

	* src/lib/Makefile.am, src/lib/byteorder.c, src/lib/byteorder.h:
	Removed byteorder.* files. They're not used anymore.
	[2f00acfc6bc2]

	* src/lib-index/mail-cache-sync-update.c, src/lib-index/mail-cache.c,
	src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-view-sync.c, src/lib-index/mail-index.c:
	Cache invalidating needed to hook into view syncing as well.
	[d2daf90c79f1]

	* src/lib/file-cache.c:
	Use madvise(MADV_DONTNEED) for invalidated pages to free memory.
	[316756b50150]

	* src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache-
	transaction.c, src/lib-index/mail-cache.c:
	More correct file cache invalidating.
	[d416b6d0a7ee]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache-lookup.c, src/lib-index/mail-
	cache-private.h, src/lib-index/mail-cache-sync-update.c, src/lib-
	index/mail-cache-transaction.c, src/lib-index/mail-cache.c,
	src/lib/Makefile.am, src/lib/file-cache.c, src/lib/file-cache.h:
	Cache file works now with mmap_disable=yes. Still needs a few
	optimizations.
	[bf1e718e7370]

2004-11-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-decisions.c:
	mark decision changes dirty so when we're trying to write them to
	disk, we don't actually just forget them..
	[604e9488a61b]

	* src/lib-index/mail-index-lock.c:
	Crashfix
	[890e1deba03e]

	* src/lib-index/mail-index-fsck.c:
	Allow calling mail_index_fsck() with log locked.
	[f922505b5ade]

	* src/lib-index/mail-transaction-log.c:
	fsck index if transaction log is found to be corrupted.
	[6a8c73bfbcad]

	* src/lib-index/mail-index-sync-update.c:
	Added extra checks to avoid crashes with corrupted transaction log.
	[8b0c2bb2459f]

	* src/auth/mech-digest-md5.c:
	DIGEST-MD5 was broken.
	[48539b255f0c]

	* src/lib-mail/message-body-search.c:
	Use dynamic buffer. Probably fixes some "buffer full" crashes.
	[ddedbc9bf433]

	* src/lib/buffer.c:
	Print pool name for "buffer full" errors.
	[3ecf8b2dfab0]

	* src/lib-index/mail-index.c:
	Removed assert, it's allowed to happen
	[b4a46746eb52]

2004-11-06  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-cache.c:
	print info about cache clearing
	[76a4ecb71b86]

	* src/auth/auth-cache.c:
	SIGHUP now clears cache.
	[0e0682b3167b]

	* src/lib/lib-signals.c, src/lib/lib-signals.h, src/master/main.c:
	Changed lib_signal_hup to lib_signal_hup_count.
	[e0db9324e799]

	* src/lib-index/Makefile.am, src/lib-index/mail-cache-compress.c, src
	/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-private.h,
	src/lib-index/mail-cache-sync-update.c, src/lib-index/mail-cache-
	transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index-sync-private.h, src/lib-index
	/mail-index-sync-update.c, src/lib-index/mail-index-transaction-
	private.h, src/lib-index/mail-index-transaction-view.c, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index-view-
	private.h, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	index-view.c, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h, src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-log.h, src/lib-index/mail-transaction-util.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	sync.c:
	Removed cache_offset from mail_index_record and changed it to use
	extension instead. Added possibility to register sync and expunge
	handlers for extensions. Changed the way extension resets work: all
	extension updates which were committed without having seen the reset
	are ignored.
	[512dd7d76cdc]

2004-11-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-logout.c:
	warning fix
	[a05dfa1d878b]

	* src/auth/auth-cache.c:
	fix
	[190778cbf865]

2004-11-04  Timo Sirainen  <tss@iki.fi>

	* src/pop3-login/pop3-proxy.c:
	Check that PASS replies with OK.
	[4e5b1a1494c5]

2004-11-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	Last fix was wrong..
	[9099bb8ee151]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	line updating was broken
	[90181a803762]

	* src/lib-storage/index/mbox/mbox-sync.c:
	idx_seq wasn't properly set when we were seeking into UID which
	doesn't exist anymore. this sometimes caused valid records to be
	deleted from index which caused mbox sync errors.
	[68e1fabc7b06]

2004-11-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-sync.c:
	oops
	[8fcedb2551c8]

	* src/lib-storage/index/mbox/mbox-sync.c:
	error message fix
	[495718afaa10]

	* src/auth/auth-client-connection.c:
	Crashfix in some error conditions
	[cbf3b2890cad]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Cleanups
	[0db10c307f05]

	* src/auth/userdb-ldap.c, src/auth/userdb-sql.c:
	And more leak fixes..
	[696fe2f5152c]

	* src/auth/passdb-ldap.c, src/auth/passdb-sql.c:
	Fixed memory leaks.
	[b66dd3188e6a]

	* src/auth/auth-cache.c, src/lib-sql/driver-mysql.c:
	memory leak fixes
	[1da885e2b04f]

	* src/lib/str.c, src/lib/str.h:
	Added str_free_without_data().
	[aae2a75b0997]

2004-10-29  Timo Sirainen  <tss@iki.fi>

	* src/pop3-login/client-authenticate.c:
	typofix: advertise auth=plain only with disable_plaintext_auth = yes
	[62908cbe2299]

2004-10-28  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c:
	another proxy crashfix
	[0fe39d90ee15]

	* src/imap-login/client.c, src/pop3-login/client.c:
	crashfixes
	[42a86c987c78]

2004-10-27  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.h, src/imap-login/imap-proxy.c,
	src/pop3-login/client.h, src/pop3-login/pop3-proxy.c:
	Keep proxy_user stored until proxy is destroyed.
	[39c315e7697d]

2004-10-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c:
	Don't show extra LFs in lines longer than input buffer size.
	[c921f1e0e517]

	* src/lib-storage/index/mbox/mbox-sync.c:
	still not right
	[a500a6bba13b]

	* src/lib-storage/index/mbox/mbox-sync.c:
	one more expunge fix..
	[5b19bcd5bb28]

	* src/lib-storage/index/mbox/mbox-sync.c:
	expunge logic still wrong. maybe now?
	[909ac8c9039d]

	* src/lib-storage/index/mbox/mbox-sync.c:
	last fix was wrong
	[f71de5c12419]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Expunge sync fix
	[d1bae4aa3f80]

	* src/lib-index/mail-cache.c:
	fix.
	[e1043732c987]

	* src/lib-storage/index/mbox/mbox-sync-private.h:
	cleanup
	[811945597b6a]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c:
	restart partial syncs correctly. and cleanups.
	[e3572b0651f7]

2004-10-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	one more major version change fix
	[645b8442b519]

	* src/lib-index/mail-index.c:
	More rebuilding fixes with mmap_disable=yes
	[431f677bc0b9]

	* src/lib-index/mail-index.c:
	Rebuild broken index files with mmap_disabled=yes too..
	[43bab10e060d]

	* src/lib-index/mail-index.c:
	Handle major version changes silently even if the file isn't large
	enough to contain full expected header.
	[280c933983a9]

	* src/lib-index/mail-index.c:
	Don't crash if mmap_disable=yes and index is broken.
	[b6f8303575b3]

	* Makefile.am:
	config.rpath isn't supposed to be here..
	[f3e7ce34721f]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-sync.c, src/lib-index/mail-index-view-sync.c, src/lib-
	index/mail-index-view.c, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log-view.c, src/lib-
	index/mail-transaction-log.c:
	Use separate sync offsets for internal/external transactions.
	Pending external transactions are committed into index at the
	beginning of syncing, internal ones aren't.
	[bea9c88c8763]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c:
	Always protect maildir syncing with uidlist lock. Before we only
	tried to do it and if it failed, we went ahead and just didn't sync
	any new messages. That however could have caused files to be lost
	temporarily due to race conditions between readdir() and rename().
	[a758a5b542bb]

	* src/lib/restrict-access.c:
	getgroups() was used wrongly before and caused problems if there
	were lots of groups. Patch by Jeff Rife.
	[cc27696fb36d]

2004-10-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Don't crash to asserts
	[166bb07246ef]

	* src/lib-index/mail-transaction-log.c:
	fix
	[ed85b5a62e06]

	* src/lib/buffer.c:
	buffer_insert() and buffer_insert_zero() didn't work correctly when
	it used to append data.
	[b85473a4df1b]

2004-10-23  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-logout.c:
	Send the "* BYE Logging out" before closing mailbox.
	[572f29f4fa22]

2004-10-22  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-sql.conf, src/auth/passdb-sql.c:
	Make it more clear that password query must return a "password"
	named field.
	[4481384a4fba]

	* src/auth/passdb-cache.c:
	Don't try to free cache if it doesn't exist.
	[253fae0aa95f]

	* doc/Makefile.am, doc/auth-protocol.txt:
	Dovecot authentication protocol v1.0
	[74517c34a687]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/lib-auth/auth-server-connection.c, src/master
	/auth-process.c:
	Separate major/minor version with TAB instead of dot in VERSION.
	[0b1bef51f207]

	* src/auth/mech-ntlm.c, src/lib-ntlm/ntlm-message.c, src/lib-
	ntlm/ntlm.h:
	support OEM encoding in NTLM messages. Patch by Andrey Panin.
	[48250919bbc4]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	More expunge/rewrite fixes.
	[ad3fcccca2bb]

2004-10-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-transaction.c:
	Don't access freed memory.
	[535e3e2d230e]

	* dovecot-example.conf, src/master/master-settings.c:
	mail_log_prefix was using old %p, changed it to %s..
	[100ecc609dd1]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	rewrite fixes
	[c686e724aba6]

	* src/lib-index/mail-index-view-sync.c:
	Crashfix
	[bbfb6a094bb1]

	* dovecot-example.conf:
	mysql/pgsql -> sql
	[bdfccd54a077]

	* src/lib/buffer.c:
	Don't return values from void functions.
	[7cf652f2a33a]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-idle.c:
	IDLE used 100% CPU.
	[3f7d4af90ec1]

	* src/lib/ioloop-notify-none.c:
	cleanup
	[be9a3a706b7a]

	* dovecot-example.conf, src/auth/Makefile.am, src/auth/auth-cache.c,
	src/auth/auth-cache.h, src/auth/mech.c, src/auth/mech.h, src/auth
	/passdb-cache.c, src/auth/passdb-cache.h, src/auth/passdb-ldap.c,
	src/auth/passdb-passwd-file.c, src/auth/passdb-sql.c,
	src/auth/passdb.c, src/auth/passdb.h, src/master/auth-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added simple LRU cache for auth requests. Currently only for sql
	passdb.
	[54b29901a793]

	* doc/variables.txt, src/auth/mech.c, src/master/mail-process.c:
	Changed %p (protocol) -> %s (service). Also changed %P (pid) -> %p.
	Hopefully people weren't using these much yet :)
	[322b580e0eb4]

	* configure.in, src/auth/Makefile.am, src/imap-login/Makefile.am,
	src/imap/Makefile.am, src/lib-auth/Makefile.am, src/lib-
	charset/Makefile.am, src/lib-imap/Makefile.am, src/lib-
	index/Makefile.am, src/lib-mail/Makefile.am, src/lib-
	ntlm/Makefile.am, src/lib-settings/Makefile.am, src/lib-
	sql/Makefile.am, src/lib-storage/Makefile.am, src/lib-
	storage/index/Makefile.am, src/lib-
	storage/index/maildir/Makefile.am, src/lib-
	storage/index/mbox/Makefile.am, src/lib-
	storage/register/Makefile.am, src/lib-storage/subscription-
	file/Makefile.am, src/login-common/Makefile.am,
	src/master/Makefile.am, src/pop3-login/Makefile.am,
	src/pop3/Makefile.am, src/util/Makefile.am:
	Upgrades to autoconf 2.5 and automake >1.4.
	[fb7f862194b5]

	* config.rpath:
	This is a generated file. Shouldn't be in cvs.
	[913f6db2dffc]

2004-10-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	Removed special Maildir/.INBOX directory. Indexes are now stored in
	maildir root.
	[1472e409c299]

	* src/lib-mail/istream-header-filter.c:
	Don't crash if no headers are given (fixes FETCH BODY[n.MIME]
	crashing)
	[19a6ff9fed58]

	* dovecot-example.conf, src/imap/common.h, src/imap/imap-fetch-body.c,
	src/imap/main.c:
	Added tb-negative-fetch workaround.
	[7cc03b8278a8]

	* src/auth/auth-master-connection.c, src/master/auth-process.c:
	Put SPID back, it's needed for standalone dovecot-auth.
	[b12e61e55c01]

	* src/auth/auth-master-connection.c, src/imap-login/client.c,
	src/imap/client.c, src/lib/ostream-file.c, src/lib/ostream-
	internal.h, src/lib/ostream.c, src/lib/ostream.h, src/login-common
	/login-proxy.c, src/pop3-login/client.c, src/pop3/client.c:
	Changed ostream's flush callback to have return value which can tell
	if there are more bytes to be sent even if there is none in output
	buffer itself. Fixes FETCH commands which used
	o_stream_send_istream() getting stuck.
	[02c0b8d532c2]

	* src/imap/imap-fetch-body.c:
	input->eof && o_stream_send_istream() == 0 isn't a correct way to
	check if all is sent. Use i_stream_have_bytes_left() instead.
	[c6f128e5520b]

	* src/lib/istream.c, src/lib/istream.h:
	Added i_stream_have_bytes_left().
	[f322b24da429]

	* src/imap-login/client.c, src/imap-login/client.h, src/imap-login
	/imap-proxy.c:
	Fixes.
	[ce98a0248ea1]

	* src/imap-login/imap-proxy.c, src/login-common/login-proxy.c,
	src/pop3-login/pop3-proxy.c:
	Logging changes.
	[9aaa737f8215]

	* src/pop3-login/pop3-proxy.c:
	Use USER/PASS instad for AUTH PLAIN. Also don't require "+OK" to
	have parameters.
	[fc4b1ec1b3ef]

2004-10-19  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Don't advertise LISTEXT capability. It's still a draft which changes
	constantly.
	[12ac68531a3a]

	* src/imap-login/client.c, src/pop3-login/client.c,
	src/pop3-login/pop3-proxy.c:
	crashfixes
	[717f8579f1df]

	* src/auth/auth-client-connection.c:
	Don't crash with invalid auth client input.
	[31154fd63ca8]

	* src/auth/auth-client-connection.c, src/auth/auth-client-
	connection.h, src/auth/mech-rpa.c, src/auth/mech.c, src/auth/mech.h,
	src/auth/passdb-pam.c, src/auth/passdb-vpopmail.c, src/lib-auth
	/auth-client.h, src/lib-auth/auth-server-request.c, src/login-common
	/sasl-server.c, src/login-common/sasl-server.h:
	s/protocol/service/ in authentication
	[e44a84dc947c]

	* src/lib-storage/index/index-mailbox-check.c:
	If we can't add file to I/O notify list, close the fd so we don't
	leak. Fixes IDLE leaking fds with all but Linux.
	[4ff5b3e8ee51]

	* src/login-common/master.c, src/master/login-process.c, src/master
	/master-login-interface.h:
	Added version to login <-> master communication as well.
	[1fd55b4341b9]

	* src/master/auth-process.c:
	We didn't send VERSION handshake to auth process.
	[b85e7c414f06]

	* src/auth/auth-client-connection.c, src/auth/auth-client-
	connection.h:
	If auth client sends broken input and we disconnect it, wait for a
	while before disconnecting to avoid flooding.
	[dc309a440bbe]

	* src/auth/Makefile.am, src/auth/auth-client-connection.c, src/auth
	/auth-client-connection.h, src/auth/auth-client-interface.h,
	src/auth/auth-master-connection.c, src/auth/auth-master-
	connection.h, src/auth/auth-master-interface.h, src/lib-auth/auth-
	server-connection.c, src/lib-auth/auth-server-connection.h,
	src/master/auth-process.c:
	Added VERSION command and checking to authentication protocol.
	[150f8151c971]

	* src/master/log.c:
	Log flushing fixes.
	[e6e73d1db27c]

	* TODO:
	updated
	[689e4235681f]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/imap-login/imap-proxy.c, src/imap-login
	/imap-proxy.h, src/login-common/common.h, src/login-common/login-
	proxy.c, src/login-common/login-proxy.h, src/pop3-login/client-
	authenticate.c, src/pop3-login/client.c, src/pop3-login/client.h,
	src/pop3-login/pop3-proxy.c, src/pop3-login/pop3-proxy.h:
	More smart IMAP and POP3 proxies. Now if remote login fails, it just
	destroys the proxy and allows trying another username which can go
	elsewhere. Also now replies with the same old "Authentication
	failed" error message instead of showing remote server's failure
	message.
	[e624a9ad6a30]

	* src/auth/auth-client-connection.c, src/lib-auth/auth-server-
	request.c, src/login-common/sasl-server.c:
	Use reason=xx field in FAIL to report the error message instead of
	separate field.
	[7ac5ee00278c]

	* configure.in:
	Use -lz always with mysql. Our previous check wasn't really working
	because the later -lz check used cached failure.
	[24c128e54337]

2004-10-18  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-sql.conf:
	comment update
	[b69f441e3fa6]

	* src/auth/passdb-sql.c:
	Don't require boolean flags to be 'Y' for yes, only to be non-NULL.
	[0058f0b70402]

	* src/auth/auth-client-connection.c, src/auth/mech.h, src/auth/passdb-
	sql.c, src/imap-login/Makefile.am, src/imap-login/client-
	authenticate.c, src/imap-login/client.c, src/imap-login/client.h,
	src/imap-login/imap-proxy.c, src/imap-login/imap-proxy.h, src/login-
	common/Makefile.am, src/login-common/login-proxy.c, src/login-common
	/login-proxy.h, src/login-common/main.c, src/login-common/sasl-
	server.c, src/pop3-login/Makefile.am, src/pop3-login/client-
	authenticate.c, src/pop3-login/client.c, src/pop3-login/client.h,
	src/pop3-login/pop3-proxy.c, src/pop3-login/pop3-proxy.h:
	Added IMAP and POP3 proxying support.
	[d344be0bb70f]

	* src/lib/restrict-access.c:
	We failed with "Can't drop root group privileges" if root's gid
	wasn't 0. This happened often with Solaris. Thanks to Gregory Bond
	for figuring out.
	[54dfccbe7f11]

	* configure.in, src/imap-login/client-authenticate.c, src/imap-
	login/client.c, src/lib-auth/auth-server-request.c, src/login-common
	/sasl-server.c, src/login-common/sasl-server.h, src/pop3-login
	/client-authenticate.c, src/pop3-login/client.c:
	Implemented support for LOGIN-REFERRALS using "referral" and
	"reason" parameters from auth server.
	[26a091f3add6]

	* src/auth/auth-client-connection.c, src/auth/mech.c, src/auth/mech.h,
	src/auth/passdb-sql.c:
	Authentication OK and FAIL replies can now contain extra fields from
	passdb. Implemented this for sql passdb. Special fields are
	"nologin" (user can't actually login) and "nodelay" (don't delay
	failure replies).
	[428bba43a387]

	* src/auth/mech-rpa.c:
	Didn't work with asynchronous passdb.
	[3cc4ebb5f42d]

	* src/pop3-login/client-authenticate.c, src/pop3-login/client.c,
	src/pop3-login/client.h:
	tls/secured variables are in common client structure. Plaintext
	logins didn't work because of this when disable_plaintext_auth =
	yes, even if SSL was used.
	[ab14dffd0e91]

2004-10-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-transaction-private.h, src
	/lib-index/mail-index-transaction.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-log.h, src/lib-index/mail-transaction-util.c, src/lib-
	index/mail-transaction-util.h:
	New way of handling extension introductions in transaction log.
	[a1c7e92c1839]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c, src/lib-index/mail-
	index.c:
	Removed mmap() memory area protections. They weren't always set
	correctly. Also grsec crashed with them anyway.
	[f96a7b2d1c52]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-transaction-log.c:
	Write transactions into index at the beginning of syncing if there's
	appends or external changes.
	[9ad220ac86c3]

	* src/pop3-login/client-authenticate.c:
	If login fails with internal failure, show it to client as -ERR [IN-
	USE]
	[19b9266f720e]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-transaction.c:
	Unlock uidlist file only after appends are written to transaction
	log.
	[34aeee65368d]

2004-10-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-sql/sql-api.c:
	warning fix when not compiled with any sql drivers
	[b0e039ad5717]

	* src/lib/ostream-file.c:
	Growing output buffer size broke the data inside it.
	[9cd5d91509bb]

	* src/lib/macros.h:
	i_unreached(): show also file and line number in error message
	[13c70c53cb55]

	* configure.in, doc/Makefile.am, doc/dovecot-mysql.conf, doc/dovecot-
	pgsql.conf, doc/dovecot-sql.conf, src/Makefile.am,
	src/auth/Makefile.am, src/auth/auth-master-connection.c, src/auth
	/db-mysql.c, src/auth/db-mysql.h, src/auth/db-pgsql.c, src/auth/db-
	pgsql.h, src/auth/db-sql.c, src/auth/db-sql.h, src/auth/passdb-
	mysql.c, src/auth/passdb-pgsql.c, src/auth/passdb-sql.c,
	src/auth/passdb.c, src/auth/passdb.h, src/auth/userdb-mysql.c,
	src/auth/userdb-pgsql.c, src/auth/userdb-sql.c, src/auth/userdb.c,
	src/auth/userdb.h, src/lib-sql/.cvsignore, src/lib-sql/Makefile.am,
	src/lib-sql/driver-mysql.c, src/lib-sql/driver-pgsql.c, src/lib-sql
	/sql-api-private.h, src/lib-sql/sql-api.c, src/lib-sql/sql-api.h:
	Created generic asynchronous SQL API and implemented MySQL and
	PostgreSQL drivers. MySQL is implemented synchronously because it's
	API doesn't provide async way to do it.

	Replaced pgsql and mysql userdb/passdb with generic sql
	userdb/passdb.
	[3c3ac12be307]

	* src/auth/mech.c:
	extra assert
	[cc35dc9b9cdf]

	* src/master/auth-process.c:
	t_pop() leakfix
	[3a195d649a73]

2004-10-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	Try to create the whole directory structure up to root_dir if it
	doesn't exist.
	[c835f7e5e0e4]

	* src/lib/ostream-file.c:
	Don't use sendfile() for files, even with Linux. 2.6 kernels don't
	support it anymore and I'm not sure anymore if it fully worked with
	2.4 either.
	[63fb0678a7d6]

	* src/login-common/Makefile.am:
	missing sasl-server.h
	[0aaf1fec427c]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Fixed error message
	[a71c11890f34]

	* src/lib-index/mail-cache-transaction.c:
	Holes in cache file were broken
	[1e65e0684377]

	* src/lib-index/mail-transaction-log.c:
	Log syncing fixes
	[bf2bdf2dd9ae]

	* src/lib-storage/index/index-mail.c:
	Don't crash even if view is inconsistent.
	[2e81cd0a9acd]

2004-10-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	expunge fix
	[1c4b1e78ffc5]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	If rewriting began with expunged data areas, we didn't overwrite
	them which left garbage into mbox and broke things.
	[2cada6a7f3eb]

	* src/imap/imap-fetch.c:
	Don't insert extra space before "* n FETCH"
	[192da9681e1b]

	* src/lib/sendfile-util.c:
	FreeBSD fix
	[95fd6024e1e2]

2004-10-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	fix
	[20faabfb838b]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Added asserts
	[ebcb45283c70]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c:
	Auth protocol fix
	[da392e6e473b]

	* src/login-common/client-common.c:
	forgot to add
	[134ad6e8cd42]

	* src/auth/Makefile.am, src/auth/auth-client-connection.c, src/auth
	/auth-client-connection.h, src/auth/auth-client-interface.h,
	src/auth/auth-master-connection.c, src/auth/auth-master-
	connection.h, src/auth/auth-master-interface.h, src/auth/mech-
	anonymous.c, src/auth/mech-apop.c, src/auth/mech-cram-md5.c,
	src/auth/mech-digest-md5.c, src/auth/mech-login.c, src/auth/mech-
	ntlm.c, src/auth/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	src/auth/mech.h, src/auth/userdb.h, src/imap-login/client-
	authenticate.c, src/lib-auth/auth-client.h, src/lib-auth/auth-
	server-connection.c, src/lib-auth/auth-server-connection.h, src/lib-
	auth/auth-server-request.c, src/lib-auth/auth-server-request.h, src
	/login-common/sasl-server.c, src/login-common/sasl-server.h,
	src/master/auth-process.c, src/master/auth-process.h,
	src/master/common.h, src/master/login-process.c, src/master/mail-
	process.c, src/master/mail-process.h, src/pop3-login/client-
	authenticate.c:
	Changed dovecot-auth protocol to ASCII based. Should be easier now
	to write replacement server if needed by someone. Also cleaned
	up/made more consistent auth code. The new code could still use some
	cleaning though..
	[0f31778d3c34]

	* src/pop3/client.c:
	Crashfix
	[25113dcc9705]

2004-10-11  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c, src/lib-storage/mail-
	storage.c:
	Changed the "internal error" message, once again. Hopefully this is
	finally clear enough for people to actually understand to look at
	the logs.
	[e2ce951fa8e6]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/login-common/Makefile.am, src/login-common
	/auth-common.c, src/login-common/auth-common.h, src/login-common
	/client-common.h, src/login-common/sasl-server.c, src/login-common
	/sasl-server.h, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/client.h:
	Login process cleanups. Share more authentication code between
	pop3/imap.
	[9b9d9c164a31]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Make sure nothing is buffered in mbox stream when syncing.
	[69c521ecf570]

	* src/imap/cmd-append.c:
	Handle failures without crashing
	[b63b4080c6b2]

	* src/imap/imap-fetch.c:
	Don't send extra ")" line with bad FETCH parameters.
	[eef378c0c07d]

	* src/lib-index/mail-index-sync.c:
	Don't go trying to updating index, if there's nothing to update.
	[26d266d8a2bb]

	* src/lib/file-dotlock.c:
	Check that dotlock PID exists even if we don't do stale lock
	timeouting.
	[486a5dbbc9c8]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Crashfix in error condition.
	[8c82376938a8]

	* dovecot-example.conf, src/master/master-settings.c:
	Enable outlook-idle workaround by default.
	[8ba8f672dc3e]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-transaction-
	log.c:
	typofixes
	[ccd07e584938]

2004-10-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-transaction.c:
	Don't lock/unlock mbox separately for each message. Drop the lock
	only at the end of the transaction.
	[0b4d8354737a]

	* dovecot-example.conf, src/lib-index/mail-cache.c, src/lib-index
	/mail-index-lock.c, src/lib-index/mail-index-private.h, src/lib-
	index/mail-index-view.c, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log.c, src/lib-
	storage/index/index-storage.c, src/master/mail-process.c, src/master
	/master-settings.c, src/master/master-settings.h:
	Replaced fcntl_locks_disable with lock_method, so it's now possible
	to use flock() to lock indexes.
	[12b503fbb8af]

	* src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c:
	Use only a single transaction for the whole duration of pop3
	session. Avoids constant locking/unlocking the indexes.
	[8c5bcd6585a4]

	* src/auth/db-mysql.c:
	Compile fix
	[4ec77eca761d]

	* src/lib/file-dotlock.c:
	Write host:pid into lock file *before* link()ing it into real lock
	file.
	[b0474af863ab]

	* dovecot-example.conf, src/auth/mech.c, src/master/mail-process.c,
	src/master/master-settings.c, src/master/master-settings.h,
	src/pop3/client.c, src/pop3/commands.c, src/pop3/common.h,
	src/pop3/main.c:
	Renamed pop3_mails_keep_recent to pop3_no_flag_updates which
	includes not updating seen-flag.
	[f8adc5cb2508]

	* src/auth/auth-client-connection.c, src/auth/mech.c:
	Fix some potential crashes
	[f5b135533197]

	* configure.in, src/auth/Makefile.am, src/auth/mech-cyrus-sasl2.c,
	src/auth/mech.c, src/auth/mech.h, src/lib-index/mail-index-view.c,
	src/master/auth-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Removed Cyrus SASL code completely. It hasn't worked for ages (if
	ever?) and there's not much point in having it anyway.
	[9d83aecdcfd7]

2004-10-09  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	If FETCH failed immediately, we sent back extra ")" line.
	[ca9d5d046f23]

	* src/lib-index/mail-index.c:
	Copying mapping to memory didn't copy some fields which could have
	caused problems (especially "lost transaction log file .. seq 1")
	[b81a60004612]

	* src/lib-storage/index/index-sync.c, src/lib-storage/index/mbox/mbox-
	sync.c:
	Recent flag fixes
	[6ed287e7a31c]

	* src/lib-storage/index/mbox/mbox-lock.c:
	Don't close mbox file stream unless we're actually using mmap.
	Avoids extra read()s.
	[e11ac6ab7470]

	* src/pop3/client.c, src/pop3/commands.c:
	Buffer more in memory before sending RETR replies.
	[c710572d7075]

2004-10-08  Timo Sirainen  <tss@iki.fi>

	* src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c:
	Delay writing seen flags to mailbox.
	[d2e899bb6f5b]

	* src/lib/ostream-file.c:
	Don't do anything in cork() if stream is closed.
	[ebc72e393388]

	* src/lib-storage/index/mbox/mbox-sync.c:
	fix
	[e3206b95ec0f]

	* src/auth/auth-master-connection.c, src/auth/main.c, src/auth/mech-
	cram-md5.c, src/auth/mech-digest-md5.c, src/auth/mech-rpa.c,
	src/auth/mech.c, src/auth/passdb-checkpassword.c, src/auth/password-
	scheme-rpa.c, src/auth/password-scheme.c, src/imap-login/client-
	authenticate.c, src/imap/cmd-sort.c, src/imap/commands-util.c,
	src/imap/commands.c, src/imap/imap-fetch.c, src/imap/imap-sort.c,
	src/lib-auth/auth-client.c, src/lib-auth/auth-server-connection.c,
	src/lib-auth/auth-server-request.c, src/lib-charset/charset-utf8.c,
	src/lib-imap/imap-base-subject.c, src/lib-index/mail-cache-
	compress.c, src/lib-index/mail-cache-fields.c, src/lib-index/mail-
	cache-lookup.c, src/lib-index/mail-cache-transaction.c, src/lib-
	index/mail-cache.c, src/lib-index/mail-index-sync.c, src/lib-index
	/mail-index-transaction.c, src/lib-index/mail-index-view-sync.c, src
	/lib-index/mail-index-view.c, src/lib-index/mail-index.c, src/lib-
	index/mail-transaction-log.c, src/lib-mail/istream-header-filter.c,
	src/lib-mail/message-body-search.c, src/lib-mail/message-parser.c,
	src/lib-mail/quoted-printable.c, src/lib-ntlm/ntlm-encrypt.c, src
	/lib-ntlm/ntlm-message.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-sync.c, src/lib-storage/index/maildir/maildir-uidlist.c, src
	/lib-storage/index/mbox/mbox-sync.c, src/lib-storage/mail-search.c,
	src/lib/base64.c, src/lib/base64.h, src/lib/buffer.c,
	src/lib/buffer.h, src/lib/hex-binary.c, src/lib/hex-binary.h,
	src/lib/ostream-crlf.c, src/lib/str.c, src/pop3-login/client-
	authenticate.c:
	Buffer API change: we no longer support limited sized buffers where
	writes past limit wouldn't kill the process. They weren't used
	hardly anywhere, they could have hidden bugs and the code for
	handling them was too complex.

	This also changed base64 and hex-binary APIs.
	[f1e9f3ec8135]

	* src/lib-index/mail-index-sync.c:
	group multiple recent flag updates together
	[bd250ef1c09a]

	* src/lib/buffer.c:
	buffer_insert* were broken
	[21bb4bb2ca39]

	* configure.in, src/lib/compat.c, src/lib/compat.h:
	Add seteuid() wrapper for HP-UX
	[20dcf58cc05c]

	* src/lib-storage/index/index-mail.c:
	cache_flags were being updated constantly.
	[7209877f49a0]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Remove recent-flags even if flags are dirty.
	[28693bf81196]

	* src/lib-index/mail-transaction-log-view.c:
	Don't complain about corruption when there is none.
	[d6f25d0e104a]

	* src/lib-index/mail-transaction-log-view.c:
	fix
	[1e7b3a1db07f]

2004-10-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c:
	Added asserts
	[5b07b6fd9bf8]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	fix
	[479680ed12ee]

	* src/pop3-login/client-authenticate.c:
	Advertise all SASL mechanisms in old-style SASL discovery. Patch by
	Andrey Panin.
	[55308ec89931]

	* src/lib/ioloop-epoll.c:
	Missing error checking in epoll_create(). Patch by Andrey Panin
	[f3edd5e3c371]

	* src/auth/mech-ntlm.c:
	fix endianness problem, patch by Andrey Panin
	[e9699fe883a4]

2004-10-06  Timo Sirainen  <tss@iki.fi>

	* src/pop3/client.c:
	assert
	[f2b10efd15aa]

	* src/pop3/commands.c:
	Make sure fetching is uninitialized always. Do full read/write
	syncing when expunging.
	[7b24c608f225]

2004-10-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	crashfix
	[ba7cd618d916]

	* src/auth/mech-ntlm.c, src/lib-ntlm/ntlm-encrypt.c, src/lib-ntlm
	/ntlm-encrypt.h, src/lib-ntlm/ntlm-message.c:
	NTLM2 authentication support. Patch by Andrey Panin
	[1065a557516b]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/login-common/common.h, src/login-
	common/main.c, src/master/login-process.c, src/pop3-login/client-
	authenticate.c, src/pop3-login/client.c, src/pop3-login/client.h:
	auth_verbose now affects imap/pop3 login processes too. Every
	authentication attempt by client is logged. Also fixed replies in
	AUTHENTICATE/AUTH commands when it was aborted by client.
	[46f879c46b45]

	* src/auth/mech.c:
	Use the library function for username string sanitization.
	[7b50711a168d]

	* src/lib/Makefile.am, src/lib/str-sanitize.c, src/lib/str-sanitize.h:
	Added string sanitization functions.
	[631611c2d6e6]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't loop forever if sync record UIDs don't exist anymore.
	[606c79327434]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Bringing some sanity into mbox rewrites. Fixes expunge crashes and
	reduces writes.
	[482e1a1fe2ce]

	* src/lib-storage/index/index-mail-headers.c:
	Don't crash if fetching ENVELOPE for expunged message.
	[6e0a7083a880]

2004-10-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index.h, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/mbox/mbox-sync.c:
	When we had dirty messages, we kept resyncing the whole mailbox
	constantly.
	[52352a5859e4]

2004-10-03  Timo Sirainen  <tss@iki.fi>

	* src/pop3/commands.c:
	"UIDL <message>" was broken.
	[7979984b6276]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index.c, src/lib-index/mail-index.h, src
	/lib-index/mail-transaction-log-view.c, src/lib-index/mail-
	transaction-log.c, src/lib-index/mail-transaction-log.h, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync.c:
	Index extensions can now specify record alignment, and it's possible
	to resize header and records. Fixes mbox crashes with some 64bit
	systems.
	[d41c42a7bf1e]

	* src/lib/buffer.c, src/lib/buffer.h:
	Added buffer_insert_zero()
	[f25f48725d95]

	* src/lib-storage/index/mbox/mbox-file.c:
	Give error message instead of crashing if mbox offset is lost.
	[d6c8faedc775]

	* src/imap/imap-fetch.c, src/imap/imap-fetch.h:
	If fetching fails, finish sending the untagged FETCH reply
	correctly.
	[48df7f95fa4a]

2004-10-01  Timo Sirainen  <tss@iki.fi>

	* src/login-common/main.c, src/login-common/ssl-proxy-gnutls.c, src
	/login-common/ssl-proxy-openssl.c, src/login-common/ssl-proxy.c:
	Show clear error messages if --ssl is tried to be used but it's not
	builtin/enabled.
	[8f7b01c29bcb]

	* src/auth/passdb-vpopmail.c:
	Cleanup - we don't need mycrypt.h anymore
	[f5726706dc56]

2004-09-29  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-cram-md5.c:
	Allow spaces in username.
	[cf94f1dc1ec5]

2004-09-28  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-close.c:
	Don't crash if CLOSEing without open mailbox.
	[542edc7f6091]

	* src/imap/cmd-fetch.c, src/imap/imap-fetch-body.c, src/imap/imap-
	fetch.c, src/imap/imap-fetch.h, src/lib-imap/imap-parser.c:
	BODY.PEEK[HEADER.FIELDS (...)] list is allowed to contain strings
	and literals. We didn't handle them correctly before.
	[60d33cf81c8e]

2004-09-27  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/imap-login/client.c, src/login-
	common/common.h, src/login-common/main.c, src/master/login-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h, src/pop3-login/client.c:
	Added login_greeting and login_greeting_capability settings.
	[857f5f7b512b]

	* dovecot-example.conf:
	Added example namespace with comments.
	[5f2c5b65b0cd]

2004-09-26  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech.c:
	Don't allow empty usernames. Solaris PAM seems to eat all memory
	with them.
	[e2b8702fcdf6]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-transaction-private.h, src/lib-index/mail-index-
	transaction-view.c, src/lib-index/mail-index-transaction.c, src/lib-
	index/mail-index-view-private.h, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-transaction-log-view.c, src/lib-index/mail-transaction-
	log.c, src/lib-index/mail-transaction-log.h, src/lib-index/mail-
	transaction-util.c, src/lib-index/mail-transaction-util.h, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/mbox/mbox-
	file.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync.c:
	Renamed "extra record info" and variations of it to "extension" or
	"ext" in short.
	[3b70ddb51771]

	* src/imap/cmd-append.c:
	If message was APPENDed with LITERALPLUS and it failed for some
	reason (eg. mailbox didn't exist), we didn't consume the following
	message but instead treated it as commands.
	[e24c801dbc09]

2004-09-24  Timo Sirainen  <tss@iki.fi>

	* src/lib/restrict-access.c:
	updated error messages
	[242bb128d493]

	* src/lib-storage/index/mbox/mbox-sync.c:
	fix
	[9ef0bcd23ee7]

	* src/lib-storage/index/mbox/mbox-sync.c:
	crashfix
	[1c29c91c6228]

	* dovecot-example.conf:
	Updated mbox_dirty_syncs and mbox_lazy_writes comments.
	[0ba82d7a5aba]

	* src/imap/cmd-check.c, src/imap/cmd-logout.c, src/imap/cmd-select.c,
	src/imap/imap-expunge.c, src/lib-storage/index/mbox/mbox-storage.c,
	src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/index/mbox/mbox-
	transaction.c, src/lib-storage/mail-storage.h, src/pop3/client.c:
	Split sync_flag_full into sync_flag_full_read and _write. Closing
	mailbox now always writes changes.
	[ccf563859be5]

	* src/lib-index/mail-index-sync-update.c:
	hdr_flag_have_dirty wasn't set if dirty flags were set in appends.
	[f54b0f04c628]

	* src/lib-storage/index/mbox/mbox-sync.c:
	If only mbox timestamp changes, do a full sync.
	[cecf6f5a0d80]

	* dovecot-example.conf, src/lib-storage/index/mbox/mbox-sync-
	private.h, src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync-update.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added mbox_lazy_writes setting.
	[add94f9aa9e1]

	* src/imap/cmd-logout.c, src/imap/cmd-select.c:
	Do full syncing at logout, not at select.
	[0d585c330c18]

2004-09-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	mail_index_map_to_memory() didn't resize record if mapping was
	already in memory.
	[b1f91349d216]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	Handle UIDVALIDITY changes. When partial syncing, make sure UIDs of
	new mails are larger than existing ones. If partial syncing fails,
	we need to rollback the transaction.
	[33ad1877ca6d]

	* src/lib-index/mail-index-transaction.c:
	Don't break if same mail is expunged multiple times.
	[fd607e2be4a9]

	* src/lib/ostream-file.c:
	When corked, don't limit buffer size to optimal_block_size. Fixes
	problems with some command replies not being sent completely with
	IMAP, or crashes with pop3.
	[b89f471a0e04]

	* src/lib-storage/index/mbox/mbox-sync.c:
	If MBOX_SYNC_FLAG_FULL is given, make sure we remove dirty syncing.
	[4a708855a533]

	* src/imap/imap-fetch-body.c:
	Error message update
	[2b5d4de3d827]

2004-09-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-ntlm/ntlm-encrypt.c:
	compiler warning fix
	[b522b7cea776]

	* src/lib/sendfile-util.c:
	Warning fix with Solaris.
	[dd015282fbdf]

	* dovecot-example.conf:
	comment updates
	[3b24284e4e36]

	* src/lib/file-dotlock.c:
	Re-read the PID from lock file every time before checking if it
	exists, because it may have changed.
	[ec6cd5dcf618]

2004-09-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	storage/index/maildir/maildir-storage.c:
	Get index file mode and GID from dovecot-shared file.
	[9b78674428f5]

	* src/auth/main.c:
	finish the preinit change..
	[ec268f32e69e]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/db-mysql.c,
	src/auth/db-mysql.h, src/auth/db-pgsql.c, src/auth/db-pgsql.h,
	src/auth/passdb-bsdauth.c, src/auth/passdb-checkpassword.c, src/auth
	/passdb-ldap.c, src/auth/passdb-mysql.c, src/auth/passdb-pam.c,
	src/auth/passdb-passwd-file.c, src/auth/passdb-passwd.c, src/auth
	/passdb-pgsql.c, src/auth/passdb-shadow.c, src/auth/passdb-
	vpopmail.c, src/auth/passdb.c, src/auth/passdb.h, src/auth/userdb-
	ldap.c, src/auth/userdb-mysql.c, src/auth/userdb-passwd-file.c,
	src/auth/userdb-passwd.c, src/auth/userdb-pgsql.c, src/auth/userdb-
	static.c, src/auth/userdb-vpopmail.c, src/auth/userdb.c,
	src/auth/userdb.h:
	Added preinit() call to userdb/passdbs, which is called before
	dropping privileges. init() is called after. SQL/LDAP now parses the
	config file in preinit, but does the actual connecting only in
	init(). This fixes LDAP crashing at startup.
	[cc2e39912eb3]

	* src/lib/ostream-file.c:
	If we couldn't send any bytes, don't reset buffer's full-flag.
	[a17d7463a4dc]

2004-09-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body.c:
	signed vs. unsigned warning fix
	[64e22d5c2829]

	* src/auth/passdb-bsdauth.c:
	warning fix
	[6285910d68a5]

	* src/auth/mech.c:
	type fixes
	[6ffc83f8b91e]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c:
	signed vs. unsigned comparision fixes
	[664e9001183e]

	* src/lib-index/mail-index-transaction.c, src/lib-index/mail-
	transaction-log.c:
	type fixes
	[663fc1f2aaf5]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-index-
	transaction.c, src/lib-storage/index/index-search.c, src/lib-
	storage/index/mbox/istream-raw-mbox.c:
	Memory leak fixes
	[e357ebb3137b]

	* src/imap/client.c, src/imap/cmd-fetch.c, src/imap/imap-fetch.c:
	cleanups
	[66cad846df36]

2004-09-18  Timo Sirainen  <tss@iki.fi>

	* src/lib/network.c:
	net_connect() should be nonblocking (currently unused in Dovecot)
	[a307ddd22a3a]

2004-09-17  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body.c:
	Allow buffering of output stream when sending message body, to avoid
	tons of write() calls if CRs have to be inserted.
	[f7bad0650b25]

	* src/util/rawlog.c:
	don't loop waiting for input, if it didn't come for some reason.
	[417f835dfcab]

2004-09-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/Makefile.am:
	fix
	[ff227b5c625d]

	* src/imap/imap-fetch-body.c:
	Make sure we disconnect if mail input is finished unexpectedly.
	[e69519ea4682]

	* src/lib/ostream-file.c:
	o_stream_send_istream() was buggy if input stream's offset wasn't 0
	or if sendfile() couldn't be used. Fixes problems with sending large
	mails.
	[b847d8650282]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Remove size==(uoff_t)-1 handling because it never happens.
	[a87abc14de35]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache.c:
	Fix for circular record list detection, we can't use data stack for
	buffer.
	[ec5601f71ba0]

	* src/lib-index/mail-cache-lookup.c:
	Make sure we don't get into infinite loops while reading cache.
	[519b768e5f2f]

2004-09-15  Timo Sirainen  <tss@iki.fi>

	* src/auth/password-scheme-cram-md5.c, src/lib/file-dotlock.c:
	compiler warning fixes
	[1c8410c8f602]

	* src/auth/mech-apop.c, src/auth/mech-rpa.c, src/auth/mech.c, src
	/imap-login/client-authenticate.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/proxy-mailbox.c, src/login-common/ssl-proxy-
	openssl.c, src/pop3-login/client-authenticate.c:
	Compiler warning fixes and cleanups
	[6ba9dcff11b9]

	* src/lib/base64.c, src/lib/base64.h, src/lib/sha1.c, src/lib/sha1.h:
	Change src from unsigned char* toi void* so callers don't have to do
	casting always.
	[59059ea978b2]

	* src/lib-index/mail-index-transaction-view.c:
	don't return void types
	[f806d35be249]

	* src/lib/istream.c, src/lib/istream.h:
	i_stream_read_data(): return 0 if i_stream_read() returned 0.
	[a2b910e21225]

2004-09-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	Don't crash if matching fails and we don't have header md5 sums
	saved.
	[babebc7ec9b1]

2004-09-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail.c:
	We re-cached internaldate every time again, but never used it.
	[e9f98454abec]

	* src/lib-index/mail-cache-compress.c:
	bitmask merging code was corrupting the cache file
	[0157839e3c78]

	* src/login-common/main.c, src/pop3-login/client.c:
	Replaced timestamp in APOP challenge with 128 bits of randomness.
	[033d2fd1cd38]

	* dovecot-example.conf, src/master/master-settings.c, src/master
	/master-settings.h, src/pop3/client.c, src/pop3/client.h,
	src/pop3/commands.c, src/pop3/common.h, src/pop3/main.c:
	Added pop3_enable_last setting to enable deprecated LAST command.
	[c6cc163344c3]

	* src/lib-index/mail-cache-compress.c:
	fix
	[f4f793129402]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-private.h:
	ID mapping fixes.
	[ce8647d94bfc]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index.c:
	Fix buffer_set_used_size crashes.
	[a9599d2f1af6]

	* src/lib/buffer.c, src/lib/buffer.h:
	Added buffer_write_zero and buffer_append_zero.
	[b14bbcf002d9]

	* src/lib-index/mail-transaction-log-view.c:
	Don't check extra updates data_id validity if we're just skipping
	over them.
	[13930bda8b69]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-transaction-log.c:
	We didn't include extra_rec_updates at checking if transaction had
	changed anything, and so they didn't necessarily get written to
	transaction log. This broke mbox offsets sometimes.
	[4448b82016bb]

	* src/lib-index/mail-transaction-log.c:
	Don't rotate log file if it's not fully synced
	[2ed8d5c1ecaf]

2004-09-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	cleanups
	[25db7c237229]

	* src/lib-mail/istream-header-filter.c:
	seek fix
	[2844c33a1be9]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-index-sync-
	update.c:
	a few more cache fixes
	[8ab92fe191c9]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c:
	Last from offset sync fix broke everything. Another try.
	[664c732ae195]

	* src/lib-index/mail-index-transaction.c:
	added assert
	[71a0b646fd28]

	* src/lib-index/mail-index-transaction.c:
	added asserts
	[4ac7ab1e6db2]

	* src/lib-index/mail-transaction-util.c:
	more extra intro fixes
	[108c94c2ffae]

	* src/lib-storage/index/mbox/mbox-sync.c:
	fix
	[441b4749241f]

	* src/lib-index/mail-transaction-log.c:
	Make sure MAIL_TRANSACTION_EXTRA_INTRO is 4 byte padded, otherwise
	it crashes.
	[7e47cf7a55bb]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache-transaction.c, src/lib-index
	/mail-index-sync-update.c:
	Use global null4[] now.
	[9c6238e7a394]

	* src/lib/lib.c, src/lib/lib.h:
	Added null4[] variable.
	[cc0a22b08e4f]

	* src/lib-storage/index/mbox/mbox-sync.c:
	From offsets were updated incorrectly sometimes.
	[9987c8d5a129]

	* src/lib-index/mail-index-transaction.c:
	More "cache file reopened" fixes
	[548dc4251583]

	* src/lib-index/mail-cache-transaction.c:
	extra asserts
	[0f7327288390]

	* src/lib-index/mail-transaction-log.c:
	if there's pending cache_reset in log file make sure appended
	records don't have invalid cache_offsets.
	[859dddfed80c]

	* src/lib-index/mail-cache-transaction.c:
	one more "cache file reopened" fix.
	[2568be07706f]

	* src/lib-index/mail-cache-transaction.c:
	Don't crash when cache isn't usable.
	[18cddf71996a]

	* src/lib-index/mail-cache-transaction.c, src/lib-index/mail-index-
	sync-update.c:
	More fixes to make sure we don't write buffered data to cache file
	after it's been reopened.
	[db059dc5d5c8]

	* dovecot-example.conf, src/imap/common.h, src/imap/main.c, src/master
	/mail-process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Removed mailbox_check_interval completely. It wasn't currently
	implemented, and most (all?) clients which would benefit from it
	support IDLE anyway.
	[b49d2ed4951a]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Report INBOX as existing always, even if it doesn't yet exist in
	disk. Fixes COPYing messages to INBOX when it didn't yet exist in
	disk.
	[96f454eb52c2]

	* src/lib-index/mail-cache-transaction.c:
	If cache file was recreated the buffered transaction changes were
	written into the new file which may have corrupted it.
	[6c03f22b2489]

	* src/lib-index/mail-cache-fields.c:
	minor fix
	[5edda9783458]

	* src/lib-storage/index/maildir/maildir-list.c:
	INBOX fixes for maildir too
	[1c7a73a05778]

	* src/imap/cmd-list.c:
	Don't force showing INBOX when listing only subscribed mailboxes.
	[4e18abf93a6d]

	* src/imap/cmd-list.c, src/lib-storage/index/mbox/mbox-list.c, src
	/lib-storage/mail-storage.h:
	Added MAILBOX_LIST_INBOX flag. Do the special cased INBOX handling
	only if it's set.
	[3a9a34bc0d05]

	* src/lib-storage/index/mbox/mbox-list.c:
	Make sure we return always one correct INBOX list entry.
	[1b69b6e6f0a6]

	* src/lib-storage/index/mbox/mbox-sync.c:
	When there's nothing to do to sync mbox, still commit index syncing
	instead of rollbacking because it may need to sync index internally.
	[7ba2e2d89536]

	* src/lib-index/mail-cache-transaction.c:
	Before adding new fields to cache file, make sure they weren't
	already added by re-reading the header after file is locked.
	[6bff38d73dd3]

2004-09-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log-view.c:
	minor fix for error message
	[bd0ffdd2afde]

	* src/lib-index/mail-transaction-log-view.c:
	Crashfix with corrupted log files.
	[70d79fd923c7]

	* src/lib-storage/index/mbox/mbox-sync.c:
	fix
	[7abae2dc0498]

	* src/lib-mail/message-part-serialize.c, src/lib-mail/message-part-
	serialize.h, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/mbox/mbox-
	storage.c:
	Removed all "unreliable headers" handling code. With mbox we
	actually handle only virtual header sizes everywhere.
	[39d944735147]

	* src/lib-mail/istream-header-filter.c:
	Seeking was broken if header hadn't been read yet.
	[b88b34d95c7b]

	* src/lib-mail/message-part-serialize.c, src/lib-mail/message-part-
	serialize.h, src/lib-storage/index/index-mail.c:
	When using cached message_parts, update the header size with mbox
	since it may change. Fixes BODY[1] etc. fetches giving corrupted
	replies.
	[a86d97c69e8f]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c:
	cleanups
	[b0ab37ee418a]

	* src/lib-index/mail-cache-transaction.c:
	If we detect cache corruption, try to avoid printing tons of "bad
	file descriptor" error messages for writes.
	[9c76f91ba94c]

	* src/lib-index/mail-cache-lookup.c:
	Added debugging
	[fe4b0f597c38]

2004-09-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c:
	fix
	[4b948cda1138]

2004-09-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c:
	fix for last fix..
	[4bc0a68a9b72]

	* src/lib-mail/message-parser.c:
	Fixes for handling headers longer than input buffer.
	[6dfc352ec61b]

	* src/lib/istream.c:
	i_stream_read_data(): return -1 if we didn't read more data, even if
	buffer has some.
	[d10ad1e5a5aa]

2004-09-06  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-epoll.c:
	forgot to commit
	[829e683fd894]

	* src/lib/ioloop-notify-dn.c:
	Ignore SIGIO which gets sent if queue gets full. Also other small
	fixes/cleanups.
	[cc2127b799c5]

	* src/lib-storage/index/maildir/maildir-sync.c:
	cleanup
	[372d4b90c076]

	* configure.in, src/lib/Makefile.am, src/lib/ioloop-poll.c:
	Added epoll support if --with-ioloop=epoll is given. Patch by Andrey
	Panin.
	[554f1324a435]

2004-09-05  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-notify-dn.c:
	Drop F_NOTIFY before setting F_SETSIG back to SIGIO, otherwise we
	might get SIGIO and get ourself killed.
	[69f1ba731c84]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	fix
	[6c802bcb957e]

	* src/lib-storage/index/maildir/maildir-util.c:
	comment fix
	[db11e7936888]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	"UIDs not ordered in file" errors could have occured sometimes
	wrongly.
	[e14c2a36a0a2]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't allow renaming mailboxes under INBOX.
	[15be925bd1c8]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	sync.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction-view.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index-view-private.h, src/lib-
	index/mail-index-view-sync.c, src/lib-index/mail-index-view.c, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-index
	/mail-transaction-log-view.c, src/lib-index/mail-transaction-log.c,
	src/lib-index/mail-transaction-log.h, src/lib-index/mail-
	transaction-util.c, src/lib-index/mail-transaction-util.h, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync.c:
	Save extra record/header infos into index file permanently.
	[5752e5ac88f0]

	* src/lib/buffer.c:
	buffer_reset() was broken..
	[a815a495f1c8]

	* src/master/master-settings.c:
	"Corrected permissions for base directory" warning message printed
	wrong directory if base dir was changed in config file.
	[fef8ddd5fe52]

2004-09-04  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-create.c:
	CREATE was broken if namespace prefixes were set. Patch by Andreas
	Fuchs.
	[8319dd235b7b]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h, src/lib-storage/index/index-storage.c, src/lib-storage/index
	/index-storage.h:
	Cache field indexes are cache file specific, not globals.
	[ad139af4ac12]

	* src/lib-storage/index/index-mail.c:
	Use uint32_t for getting mail_cache_flags.
	[eb2e47c8139c]

	* src/imap/imap-fetch-body.c:
	Don't ask for body size when fetching BODY[HEADER], so body doesn't
	have to be parsed.
	[1dfae038ecc6]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h, src/lib-storage/index/index-storage.c, src/master/master-
	settings.c:
	Fixed cache flags to work again. Flags are cached by default now.
	[d39842e9e83b]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	lookup.c:
	Added support for bitmask type.
	[87af1f39a69e]

	* src/lib/ostream-file.c:
	Added assert
	[3ad5b4e60321]

	* src/lib-index/mail-index.c:
	Avoid re-mmaping if not needed.
	[1fed92b6cc01]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c:
	Refcounting fixes for index mappings.
	[13c79a556b1f]

2004-09-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-lock.c:
	cleanup/new assert
	[111bd1e6d15b]

	* src/lib-index/mail-index-lock.c:
	a few more asserts
	[79de8de19d5e]

	* src/lib-index/mail-index-lock.c:
	lock mprotect fix
	[e81d4021f85b]

	* src/lib-index/mail-index-lock.c:
	lock fix
	[969a585dbc34]

	* src/lib-index/mail-index-sync-update.c:
	fix
	[021f865e1cfa]

	* src/lib-index/mail-index-sync-update.c:
	Don't fail if we can't lock cache file.
	[ea50ff7fe3c2]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't allow creating mailboxes under INBOX.
	[d76795adbbb4]

	* src/lib-index/mail-index-sync-update.c:
	fix
	[21a62d627989]

	* src/lib-index/mail-index-lock.c:
	mprotect() wasn't always called when index was being locked, and
	caused crashes.
	[2257709d7514]

	* src/lib-index/mail-index.c:
	When updating index mappings, don't let it affect existing views
	mappings. Fixes some crashes.
	[c3608081d0e4]

	* src/lib-storage/index/index-transaction.c:
	Fix for error handling.
	[75e8fc49a102]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Still wrong sync logic
	[5f62a2c34729]

	* src/lib-storage/index/mbox/mbox-sync.c:
	sync fix
	[7f247f5587fe]

	* configure.in:
	Don't check for linux/mman.h, it's not even used.
	[7d474e21e0c1]

	* src/imap/cmd-list.c:
	Fix for having INBOX/ namespace.
	[5c95f17f6f25]

	* src/lib/ostream-file.c:
	_send_istream() might have crashed.
	[0d2c47d85a3a]

2004-09-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-interface.h, src/imap-login/client-
	authenticate.c, src/pop3-login/client-authenticate.c:
	Tell dovecot-auth if SSL/TLS is enabled. Nothing can done with it
	yet though.
	[0db84a609ee2]

	* src/master/main.c:
	crashfix in pid generation
	[9c55e054e57d]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c:
	Don't break if saving messages to maildir without index files.
	[89911d2a9126]

	* src/lib-storage/index/index-sync.c:
	Recent flags might have been wrong if they weren't set in ascending
	order.
	[c80b942d5040]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	Go back to version 1 dovecot-uidlist file. The flags parameter isn't
	needed.
	[154403134c74]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Don't return -2 so easily in read()
	[83eab0b1872c]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c:
	Wrong messages were set recent if another client had modified the
	mbox.
	[23ac04da861f]

	* src/imap/cmd-copy.c:
	removed extranous code.
	[739533156339]

	* src/pop3/commands.c:
	Make RETR mark the message seen.
	[792b3209f705]

	* src/lib-imap/imap-base-subject.c:
	Parsing fix
	[da6b2e4a8b3a]

2004-09-01  Timo Sirainen  <tss@iki.fi>

	* src/pop3/client.c:
	Log error message if we can't open INBOX.
	[633683d78bcb]

2004-08-31  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Create PID file.
	[3730256bf3d3]

	* src/lib-ntlm/ntlm-encrypt.c:
	Patch by Andrey Panin:

	 - open code ntlmssp_des_encrypt_triad() function;
	 - add two missing safe_memset(). It's not safe to leave NTLM hashes
	on the stack, because they are plain password equivalents.
	[415b3e8dea35]

	* src/auth/mech-apop.c, src/auth/mech-cram-md5.c, src/auth/mech-
	digest-md5.c, src/auth/mech-login.c, src/auth/mech-ntlm.c, src/auth
	/mech-plain.c, src/auth/mech-rpa.c, src/auth/mech.c,
	src/auth/mech.h:
	Changed "invalid username" error message.
	[a07fb16b9a24]

	* src/lib/ostream-file.c:
	Output stream sometimes duplicated data and sometimes lost data.
	[3418a7f233ff]

	* src/pop3/commands.c:
	fixed potential crash
	[255cea3e2331]

2004-08-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync.c:
	Save sync_last_check for any sync, not just in sync_init() so FAST
	flag doesn't do another sync if one was just done in transaction
	commit.
	[d04c86bf59c9]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-expunge.c,
	src/imap/cmd-search.c, src/imap/cmd-store.c, src/imap/imap-
	expunge.c, src/imap/imap-fetch.c, src/imap/imap-sort.c, src/imap
	/imap-sync.c, src/imap/imap-thread.c, src/lib-storage/index/maildir
	/maildir-storage.h, src/lib-storage/index/maildir/maildir-
	transaction.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-transaction.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/lib-storage/proxy-mailbox.c, src/pop3/client.c,
	src/pop3/commands.c:
	Added sync flags parameter to mailbox_transaction_commit(), so
	EXPUNGE can do a full sync with dirty syncing enabled.
	[f8be7a5e273a]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Disabling mbox_dirty_syncs didn't always work. And it was a bit
	broken.
	[545a109cbcef]

2004-08-28  Timo Sirainen  <tss@iki.fi>

	* src/auth/main.c:
	Initialize userdb/passdb/password schemes before dropping
	privileges.
	[bfd86f40b4c9]

	* src/auth/userdb-static.c:
	Added mail setting and made home optional.
	[113beb6d7d89]

	* src/master/master-settings.c:
	Default ssl_disabled to yes if SSL isn't compiled in.
	[bb5e0b737f81]

	* src/imap/client.c:
	Input handler tried to process multiple commands at once which broke
	things.
	[f6fdf9048a01]

	* src/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h,
	src/lib-storage/index/mbox/mbox-sync.c:
	When mbox syncing is dirty, read the message headers to verify that
	we've found the correct message.
	[abcdec2299bd]

	* dovecot-example.conf, src/imap/cmd-check.c, src/imap/cmd-expunge.c,
	src/imap/cmd-select.c, src/lib-storage/index/index-storage.h, src
	/lib-storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox
	/mbox-file.h, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/index/mbox/mbox-
	transaction.c, src/lib-storage/mail-storage.h, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added mbox_dirty_syncs setting which delays re-reading the whole
	mbox when it's changed.
	[710e0bf25bf8]

	* dovecot-example.conf, src/auth/mech-apop.c, src/auth/mech-cram-
	md5.c, src/auth/mech-digest-md5.c, src/auth/mech-login.c, src/auth
	/mech-ntlm.c, src/auth/mech-plain.c, src/auth/mech-rpa.c,
	src/auth/mech.c, src/auth/mech.h, src/master/auth-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added auth_username_translation setting.
	[0f660149c7ef]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c:
	Fixed crash if mail data was fetched in specific order. Plus some
	minor fixes.
	[146591955618]

	* src/imap/client.c, src/imap/client.h:
	Command parameter errors weren't handled right. This was broken a
	few commits ago..
	[467af814d5e2]

	* src/lib-index/mail-transaction-log-view.c:
	Handle correctly the case when index hasn't yet been synced with
	transaction log.
	[5ad6ccb8000b]

	* src/auth/auth-client-connection.c:
	Process all input data from stream.
	[3c5ad10526fb]

	* src/auth/auth-client-connection.c:
	Fixed memory leak.
	[847759a0ff75]

	* src/imap/imap-fetch-body.c, src/imap/imap-sort.c, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-mail.h, src
	/lib-storage/index/index-search.c, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/mail-storage.h, src/lib-storage/proxy-mail.c,
	src/pop3/client.c, src/pop3/commands.c:
	Added mail.get_physical_size().
	[98f6057f27a1]

	* src/pop3/commands.c:
	removed accidentally committed debugging
	[2946fa696774]

	* src/pop3/client.c:
	Deinitialize pop3 commands if connection is closed unexpectedly.
	[e628e0ab8924]

	* src/imap/client.c, src/imap/cmd-append.c, src/imap/cmd-idle.c:
	Deinitialize command handlers always.
	[b7eec64e0735]

	* src/lib-storage/index/maildir/maildir-save.c:
	Don't crash if canceling saving
	[430ee8bb6003]

	* src/lib/restrict-access.c:
	Or actually check also that RESTRICT_GID_FIRST=0 before allowing
	gid=0 use
	[fc2ec85f95ca]

	* src/lib/restrict-access.c:
	Allow group id to be 0 even with disallow_root. So setting
	valid_first_gid to 0 now actually works.
	[9232711b7a07]

	* src/imap/imap-fetch.c:
	Don't crash with unknown FETCH commands.
	[5cab421f36be]

2004-08-25  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-internal.h, src/lib/ioloop-poll.c, src/lib/ioloop-
	select.c, src/lib/ioloop.c:
	Changed io_remove() to destroy the io immediately. Changed struct io
	to be double linked list. Moved highest_fd into select-specific
	struct. Some minor optimizations.
	[3f2b73c19a52]

	* src/lib/ioloop-select.c, src/lib/ioloop.c:
	Moved highest_fd calculation to select-specific code. Patch by
	Andrey Panin.
	[ed7628af7865]

	* src/pop3/client.c, src/pop3/commands.c:
	Fixes for nonblocking changes.
	[a2e2c76021b9]

	* src/lib/ostream-crlf.c:
	send_istream(): Don't return -1 if input stream just didn't contain
	anything.
	[9ac27c8f2a72]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	Recent flag wasn't written always
	[11da9df0890c]

	* src/lib-index/mail-index-lock.c:
	We kept exclusive index lock too long which caused deadlocks.
	[e7e99c2b3cb5]

2004-08-24  Timo Sirainen  <tss@iki.fi>

	* src/lib/lib-signals.c:
	Ignore SIGALRM.
	[0284ec4e6ed7]

	* src/lib-index/mail-index-sync.c:
	Don't crash if flag update record gets completely overlapped by
	expunges.
	[4a2c1f6e1a22]

2004-08-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c:
	Use larger default buffer sizes
	[b2993fe1337b]

	* src/lib/ostream-crlf.c:
	close/destroy fixes
	[270b0db8d18f]

	* src/lib-storage/index/mbox/mbox-save.c:
	Use correct error messages.
	[e7fa0d07f247]

	* src/imap/imap-fetch-body.c:
	fix
	[4f115e8b2e14]

	* src/lib/ostream-file.c:
	o_stream_send*() might have returned wrong value
	[c8b12c26a040]

	* src/imap/imap-fetch.c:
	Same FETCH handler could have been executed infinitely if client
	didn't read the data fast enough.
	[b0fc9984ddcd]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/mbox/mbox-storage.c:
	We shouldn't try to use cached header physical_size for mboxes
	because it changes.
	[626e943aacf1]

	* src/util/rawlog.c:
	Rawlog filename was always with date 01.01.1970.
	[2ad55f027439]

	* src/lib/ioloop-internal.h, src/lib/ioloop-poll.c, src/lib/ioloop-
	select.c, src/lib/ioloop.c:
	Internal I/O loop API change in preparation for epoll support. Patch
	by Andrey Panin.
	[ac93896adcc3]

	* src/lib/Makefile.am:
	ostream-crlf.h was missing
	[a8f363cef34e]

	* src/lib-storage/index/index-mailbox-check.c:
	Timeout/stat() based mailbox change checker didn't actually ever
	send notifications.
	[87b6d3303031]

	* src/lib-storage/index/maildir/maildir-save.c:
	Save mails through CRLF or LF output streams.
	[63dca331c266]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	sync fix
	[bce342d816f0]

	* src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Recent flag fixes.
	[27bea4044b93]

	* src/imap/cmd-idle.c:
	Crashfix
	[d2a64ae90011]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Don't crash with empty body
	[f4f133f84d63]

	* src/lib-mail/istream-header-filter.c:
	fix
	[90e72abe74bf]

	* src/lib/ostream-file.c:
	o_stream_sendv() returned wrong value if sending more than
	UIO_MAXIOV iovecs.
	[4fa0f02369b1]

	* src/lib/ostream-crlf.c:
	fixes
	[aabebe4dc5bf]

	* src/lib-mail/message-parser.c:
	fix
	[0da663b2265f]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Fixed handling messages with empty body.
	[70afa3cdcb27]

	* src/imap/main.c:
	Accidentally committed debugging code.
	[b932e4f92157]

	* src/lib/ostream-crlf.c, src/lib/ostream-crlf.h:
	Changed LF stream to replace only CRLF pairs. Changed send functions
	to return the number of input bytes consumed rather than number of
	bytes actually sent. This fixes send_istream().
	[b6b702b5f5fe]

2004-08-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Fixed parsing empty messages.
	[74b7dcdeafc5]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	istream-raw-mbox now sets stream->eof when it's at the end of
	message to fix some issues elsewhere.
	[db61972ffeb3]

	* src/lib/istream-file.c:
	_read() never returns 0 for files.
	[46765dafc6e7]

	* src/imap/client.c:
	fix
	[9946b489d21a]

	* src/lib-storage/index/mbox/mbox-save.c:
	Saving fix.
	[e201021f6ad9]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c:
	crashfixes
	[3accbeb04383]

	* src/lib/istream.c:
	i_stream_read_data(): don't return -1 unless we're at EOF.
	[b7a76368fdad]

	* src/lib/ostream-crlf.c:
	send_istream() didn't work properly.
	[346fe259a18c]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	Buffer wasn't set if _read() returned -2.
	[5506d4cd4973]

	* src/lib-storage/index/mbox/mbox-save.c:
	saving was broken
	[f32419d92307]

	* src/imap/cmd-append.c:
	Forgot want_mail=TRUE parameter from debugging.
	[d38f3876f3ad]

	* src/lib/ostream.c:
	o_stream_send* functions return type is ssize_t, not int.
	[db92fc0bdf67]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	AUTHENTICATE and AUTH commands were broken.
	[d2fe9172e408]

	* src/lib/istream.c:
	i_stream_read_data(): don't loop if read() returns 0.
	[963d95591b49]

	* src/imap/imap-fetch-body.c, src/lib-mail/istream-header-filter.c,
	src/lib-mail/istream-header-filter.h, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/mbox/mbox-mail.c, src/lib-
	storage/index/mbox/mbox-save.c:
	Changed istream-header-filter API a bit. Added HIDE_BODY option.
	Fixed mail.get_headers().
	[f6fef42f01b9]

	* src/lib-index/mail-transaction-log.c:
	Crashfix
	[ace62daa7abd]

	* src/lib-index/mail-transaction-log.c:
	Optimization for setting initial sync_offset from index.
	[1543762353aa]

	* dovecot-example.conf, src/imap/common.h, src/imap/imap-fetch-body.c,
	src/imap/imap-fetch.h, src/imap/main.c:
	Added netscape-eoh workaround.
	[f1e4c99cbb2b]

	* dovecot-example.conf:
	comment fix
	[be2e8dfe25be]

	* src/imap/cmd-append.c, src/lib-storage/Makefile.am, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-transaction.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-transaction.c, src/lib-storage/mail-copy.c,
	src/lib-storage/mail-copy.h, src/lib-storage/mail-save.c, src/lib-
	storage/mail-save.h, src/lib-storage/mail-storage-private.h, src
	/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h, src
	/lib-storage/proxy-mailbox.c:
	Changed mail saving API to be nonblocking.
	[47e1e05cede0]

	* src/imap/client.c, src/imap/cmd-idle.c:
	Set bad_counter before calling client_command_reset because it may
	parse more commands.
	[5376a3c388c0]

	* src/lib-mail/istream-header-filter.c, src/lib-mail/message-parser.c,
	src/lib/istream-limit.c:
	Fixes for nonblocking streams.
	[881e265febfa]

	* src/lib-mail/istream-header-filter.c:
	Call callback for EOH too.
	[aa6b874f7515]

	* src/lib-mail/message-parser.c:
	If headers don't end with linefeed and there's no ':' in the line,
	don't hide the data.
	[95ce60310a56]

	* src/lib/istream-limit.c:
	When we reach the limit, set eof = true
	[b65224a24696]

	* src/lib-index/mail-transaction-log.c:
	Use madvise() for mmaped transaction log file.
	[0ac79623b58e]

	* src/lib/istream-mmap.c, src/lib/mmap-util.c, src/lib/mmap-util.h:
	Added mmap_get_page_size() call which basically returns
	getpagesize() but makes sure it's called only once so there's no
	syscall overhead every time.
	[7d6ca38c8c37]

	* src/lib-storage/index/maildir/maildir-util.c:
	If we can't create maildir temp file because we're out of quota,
	give user readable error message.
	[7daa6c257a56]

	* src/lib-mail/istream-header-filter.c:
	Do the final callback after deinitializing header parser so offsets
	are correct.
	[c58f454afc6b]

	* src/imap/imap-fetch-body.c, src/imap/main.c, src/lib-mail/istream-
	header-filter.c, src/lib-mail/istream-header-filter.h, src/lib-
	storage/index/index-mail-headers.c, src/lib-storage/index/mbox/mbox-
	mail.c:
	header filter can now optionally use either LF or CRLF linefeeds.
	[f8c4ad92092c]

	* src/lib-mail/istream-header-filter.c:
	We didn't call callback with NULL header at the end.
	[288eb0d0ca7d]

	* src/lib/ostream-crlf.c:
	Keep track of offset.
	[5e8e41cb8185]

	* src/lib/Makefile.am, src/lib/ostream-crlf.c, src/lib/ostream-crlf.h:
	Added CRLF/LF output stream converters.
	[be3338893a56]

	* src/lib/ostream-file.c:
	Limit iovec count to UIO_MAXIOV for writev() calls.
	[b8d2a5575fe9]

	* src/lib-mail/istream-header-filter.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib-storage/index/mbox/istream-raw-mbox.h,
	src/lib-storage/index/mbox/mbox-sync.c, src/lib/istream-data.c,
	src/lib/istream-file.c, src/lib/istream-limit.c, src/lib/istream-
	mmap.c, src/lib/istream.c, src/lib/istream.h:
	Removed istream.disconnected, it's too much of a special case and
	the only place where it's needed will be removed soon. Added
	istream.eof back, it's more useful.
	[8e9d8cb1e674]

	* src/lib-mail/istream-header-filter.c, src/lib-mail/message-body-
	search.c, src/lib-mail/message-parser.c, src/lib-mail/message-
	parser.h, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/mail-save.c:
	message_parse_header_next() can now return "need more data" with
	nonblocking input streams.
	[7c1dc4a7db3a]

	* src/imap/imap-fetch-body.c, src/lib-mail/istream-header-filter.c,
	src/lib-mail/istream-header-filter.h, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/mbox/mbox-mail.c:
	istream-header-filter now parses the headers incrementally while
	read()ing, instead of doing it at initialization and storing into
	one large buffer.
	[92f92b3c447b]

2004-08-19  Timo Sirainen  <tss@iki.fi>

	* AUTHORS, src/auth/Makefile.am, src/auth/mech-rpa.c, src/auth/mech.c,
	src/auth/passdb.c, src/auth/passdb.h, src/auth/password-scheme-
	rpa.c, src/auth/password-scheme.c, src/auth/password-scheme.h:
	Added Compuserve RPA authentication. Patch by Andrey Panin.
	[abef2ac8843a]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-check.c, src/imap/cmd-copy.c, src/imap/cmd-expunge.c,
	src/imap/cmd-fetch.c, src/imap/cmd-idle.c, src/imap/cmd-noop.c,
	src/imap/cmd-search.c, src/imap/cmd-select.c, src/imap/cmd-sort.c,
	src/imap/cmd-status.c, src/imap/cmd-store.c, src/imap/cmd-thread.c,
	src/imap/commands-util.c, src/imap/commands-util.h,
	src/imap/commands.h, src/imap/imap-sync.c, src/imap/imap-sync.h:
	Syncing works now too without buffering everything. Also fixed
	handling input while command was being processed.
	[e1616067df5c]

	* src/auth/auth-client-connection.c, src/auth/mech.c:
	fixes
	[d47a550fc23b]

2004-08-18  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-list.c, src/imap
	/commands-util.c:
	LIST command interrupts itself when output buffer gets full and
	continues again when there's space.
	[8267d11cacfb]

	* src/imap/cmd-store.c:
	Don't do separate kludging for readonly mailboxes.
	[ab170ee24eb2]

	* src/lib/buffer.c, src/lib/buffer.h:
	Added buffer_reset()
	[875e7a46a2db]

2004-08-15  Timo Sirainen  <tss@iki.fi>

	* src/auth/password-scheme.c, src/lib-storage/mail-storage.h:
	oops, shouldn't have committed these
	[d5aa32e5a9bc]

	* src/auth/auth-client-connection.c, src/auth/auth-master-
	connection.c, src/auth/password-scheme.c, src/imap-login/client-
	authenticate.c, src/imap-login/client.c, src/imap/Makefile.am,
	src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-fetch.c, src/imap/cmd-idle.c, src/imap/cmd-search.c,
	src/imap/common.h, src/imap/imap-fetch-body-section.c, src/imap
	/imap-fetch-body.c, src/imap/imap-fetch.c, src/imap/imap-fetch.h,
	src/imap/imap-messageset.c, src/imap/imap-messageset.h, src/imap
	/imap-search.c, src/imap/imap-search.h, src/imap/imap-thread.c,
	src/imap/mail-storage-callbacks.c, src/imap/main.c, src/lib-auth
	/auth-server-connection.c, src/lib-auth/auth-server-request.c, src
	/lib-mail/istream-header-filter.c, src/lib-mail/istream-header-
	filter.h, src/lib-mail/message-send.c, src/lib-mail/message-send.h,
	src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib-storage/index/mbox/mbox-lock.c, src
	/lib-storage/index/mbox/mbox-save.c, src/lib-storage/mail-storage.h,
	src/lib/Makefile.am, src/lib/alarm-hup.c, src/lib/alarm-hup.h,
	src/lib/file-lock.c, src/lib/iostream-internal.h,
	src/lib/iostream.c, src/lib/istream-data.c, src/lib/istream-file.c,
	src/lib/istream-limit.c, src/lib/istream-mmap.c, src/lib/istream.c,
	src/lib/istream.h, src/lib/lib.c, src/lib/ostream-file.c, src/lib
	/ostream-internal.h, src/lib/ostream.c, src/lib/ostream.h,
	src/lib/strfuncs.c, src/lib/strfuncs.h, src/pop3-login/client-
	authenticate.c, src/pop3-login/client.c, src/pop3/client.c,
	src/pop3/client.h, src/pop3/commands.c:
	We never do blocking reads/writes to network anymore. Changed imap
	and pop3 processes to use a single I/O loop.

	Not much tested yet, and currently LIST/LSUB may eat too much memory
	and APPEND eats all CPU.
	[d141e1bfdd63]

	* src/lib-index/mail-cache-transaction.c:
	rollback: don't lock file if we don't need to
	[90f25ed2dcef]

	* src/lib-index/mail-cache-lookup.c:
	bugfix
	[ba29613cbb19]

	* src/lib-index/mail-transaction-log-view.c:
	assert crashfix
	[f32a2fd0c8b4]

2004-08-09  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/master/auth-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added auth_debug setting.
	[af0e73fc6658]

	* configure.in:
	If -lmysqlclient doesn't automatically link with zlib, do it
	manually.
	[e6594431ee4f]

2004-08-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-search.c:
	SEARCH TEXT was broken
	[0b296005452e]

2004-08-01  Timo Sirainen  <tss@iki.fi>

	* src/lib/buffer.h:
	buffer.data should be void, not unsigned char
	[05b348b25d46]

2004-07-31  Timo Sirainen  <tss@iki.fi>

	* src/lib/buffer.c:
	buffer_append() fix
	[55330cd9c610]

	* src/lib/buffer.c, src/lib/buffer.h:
	Removed start_pos and limit handling, they weren't used much and
	were only making it more complex. Also made data and size variables
	directly accessible to make it easier to use buffers.
	[daf5ea7556bc]

	* src/lib-imap/imap-base-subject.c, src/lib-imap/imap-base-subject.h:
	Drop using buffer_set_start_pos(). Also some coding style cleanups.
	[c8fa857c4e08]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c, src
	/lib-index/mail-transaction-log.h, src/lib-index/mail-transaction-
	util.c:
	Small cleanups.
	[c7c886199f28]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index.c:
	Fixed fd leaks
	[9183098d7fdf]

	* src/lib-index/mail-transaction-log.c:
	removed assert
	[ad3983cc66cb]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	index-private.h, src/lib-index/mail-index.c, src/lib-index/mail-
	transaction-log-private.h, src/lib-index/mail-transaction-log-
	view.c, src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-log.h:
	Transaction log file is now read-lockless.
	[fed6d07bd8ee]

	* src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-sync-update.c:
	Don't write Content-Length unless it's value is larger than 1024
	bytes.
	[e08fd0ea6907]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Fix rewriting pseudo header when it needs to grow.
	[4f827b29c9b8]

	* src/imap/imap-fetch-body-section.c, src/lib-mail/istream-header-
	filter.c, src/lib-mail/message-parser.c, src/lib-mail/message-
	parser.h, src/lib-storage/index/index-mail-headers.c, src/lib-
	storage/index/mbox/mbox-sync-parse.c, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync-
	rewrite.c, src/lib-storage/mail-save.c:
	Added struct message_header_line.middle and middle_len to contain
	the ':' in header and whitespace around it.
	[8ef002a26f1c]

	* configure.in:
	Mysql check fix
	[3af28e102a39]

	* src/lib-storage/index/mbox/mbox-sync.c:
	fix
	[f81e77487092]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Rollback index sync if mbox syncing failed
	[c617b748be41]

	* src/lib-index/mail-index-sync-update.c:
	Changed some asserts to failure return calls since they actually can
	happen
	[8ab6097598a6]

2004-07-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-transaction.c:
	Growing index record size in the middle of transaction wasn't
	working right.
	[b1b05f3b6805]

	* src/lib-storage/index/mbox/mbox-sync.c:
	read-only mbox fix
	[7134d8ea59a4]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't try to write-lock read-only mboxes
	[5ef38528f873]

	* src/auth/mech-cram-md5.c:
	cleanup
	[4f84a146d93a]

	* src/lib-ntlm/ntlm-message.c:
	compile fix
	[6cb29c751e01]

	* src/auth/db-pgsql.c:
	Reconnection fix, thanks to Zsolt Varga.
	[4b7a5545afaf]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index.h, src
	/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	Renamed mail_index_sync_end() to _commit() and added _rollback().
	Fixed mbox deadlocking issue.
	[d598c82a3c22]

	* src/lib-index/mail-transaction-log-view.c:
	mail_transaction_log_view_next() didn't actually stop at the end of
	view window, but continued to the end of file. That sometimes caused
	crashes and maybe other problems.
	[dad26f6995ff]

	* src/util/Makefile.am:
	RAND_LIBS and MODULE_LIBS are needed for dovecotpw.
	[6b0901140c16]

	* src/util/dovecotpw.c:
	getopt.h isn't needed for getopt() and doesn't exist in all systems.
	[e2a1407b32f7]

	* src/lib/fdpass.c:
	include lib.h first
	[98cbbce48f9f]

	* src/lib-ntlm/ntlm.h:
	Don't include stdint.h, it's already included in lib.h if it exists.
	[529053546752]

	* src/lib-ntlm/ntlm-encrypt.c, src/lib-ntlm/ntlm-message.c:
	Moved system header includes after local headers to fix some compile
	problems.
	[d41d66244eb2]

	* src/lib/sha1.h:
	one more u_int..
	[2f58b0ae7d20]

	* src/lib/sha1.c, src/lib/sha1.h:
	Changed to use standard uint* types rather than u_int*. Also removed
	K&R-isms.
	[161a9e818ad6]

	* configure.in, src/auth/db-mysql.h:
	Better MySQL checking. Patch by John Dennis
	[0cc72087752f]

	* src/auth/mech-cram-md5.c, src/auth/password-scheme-cram-md5.c, src
	/lib-ntlm/Makefile.am, src/lib-ntlm/hmac-md5.c, src/lib-ntlm/hmac-
	md5.h, src/lib/Makefile.am, src/lib/hmac-md5.c, src/lib/hmac-md5.h:
	Merged CRAM-MD5 and NTLM hmac-md5 code. Patch by Joshua Goodall
	[959136e08a70]

	* src/pop3-login/client-authenticate.c:
	Added NTLM kludge. Patch by Andrey Panin
	[34d4c7a7b485]

	* src/auth/mech-ntlm.c, src/auth/passdb.c, src/auth/passdb.h, src/auth
	/password-scheme-ntlm.c, src/auth/password-scheme.c, src/auth
	/password-scheme.h, src/lib-ntlm/ntlm-encrypt.c, src/lib-ntlm/ntlm-
	encrypt.h, src/lib-ntlm/ntlm-types.h:
	Added LANMAN password scheme. Patch by Andrey Panin
	[6531fd0f779f]

	* src/auth/Makefile.am, src/util/Makefile.am:
	Added auth/libpassword.a which util/dovecotpw can use rather than
	using object files directly.
	[4e42d4213927]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	mbox corruption fix
	[9a6d22b5bb7a]

2004-07-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache.c:
	mail_cache_lock() crashed if index wasn't locked while it was
	called.
	[00a4d69a1d1c]

	* AUTHORS, configure.in, src/Makefile.am, src/auth/Makefile.am,
	src/auth/mech-ntlm.c, src/auth/mech.c, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/password-scheme-ntlm.c, src/auth
	/password-scheme.c, src/auth/password-scheme.h, src/lib-
	ntlm/.cvsignore, src/lib-ntlm/Makefile.am, src/lib-ntlm/hmac-md5.c,
	src/lib-ntlm/hmac-md5.h, src/lib-ntlm/ntlm-byteorder.h, src/lib-ntlm
	/ntlm-des.c, src/lib-ntlm/ntlm-des.h, src/lib-ntlm/ntlm-encrypt.c,
	src/lib-ntlm/ntlm-encrypt.h, src/lib-ntlm/ntlm-flags.h, src/lib-ntlm
	/ntlm-message.c, src/lib-ntlm/ntlm-message.h, src/lib-ntlm/ntlm-
	types.h, src/lib-ntlm/ntlm.h, src/lib/Makefile.am, src/lib/md4.c,
	src/lib/md4.h:
	NTLM authentication. Patch by Andrey Panin
	[8f5be0be3199]

	* src/lib/hex-binary.c, src/lib/hex-binary.h:
	Added binary_to_hex_ucase()
	[05b8b6963b02]

2004-07-27  Timo Sirainen  <tss@iki.fi>

	* AUTHORS:
	updated
	[faeb3d17579a]

	* src/imap/cmd-list.c:
	LSUB sent LIST replies instead of LSUB.
	[42e6f7811385]

2004-07-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-index.h, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/mbox/mbox-sync-update.c, src
	/lib-storage/index/mbox/mbox-sync.c:
	Fixed recent flags with mbox.
	[9c830d1a4ebf]

	* src/util/Makefile.am:
	dovecotpw_INCLUDES didn't actually work. Don't even try, src/auth/
	must be compiled before we get here.
	[0169e0cad079]

	* src/auth/db-mysql.c:
	whops, removed debugging
	[d216ff496d01]

	* src/lib/sha1.c, src/lib/sha1.h, src/util/.cvsignore,
	src/util/dovecotpw.c:
	Forgot from last dovecotpw commit.
	[eda658b1557e]

	* configure.in, doc/dovecot-mysql.conf, src/auth/db-mysql.c, src/auth
	/db-mysql.h:
	Added MySQL SSL support.
	[189a6de6b166]

	* doc/variables.txt, src/lib/var-expand.c:
	Added support for %offset.width format in variables.
	[1ce02ffc7ec7]

	* configure.in, src/auth/passdb.c, src/auth/password-scheme.c,
	src/auth/password-scheme.h, src/lib/Makefile.am,
	src/util/Makefile.am:
	Added dovecotpw utility. Patch by Joshua Goodall
	[203938a7f45e]

	* src/auth/passdb-vpopmail.c:
	Support MD5 passwords. Patch by Pascal Malterre
	[33c584ef528a]

	* src/imap/cmd-list.c:
	fix
	[979af608d7c4]

	* src/imap/cmd-list.c:
	fix
	[974b0478a548]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	mbox parsing fix
	[8b0d9d6444be]

2004-07-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache.c:
	Allocate cache->fields and cache->fields_file_map with malloc rather
	than from pool.
	[f2acbe281ac1]

2004-07-24  Timo Sirainen  <tss@iki.fi>

	* COPYING:
	mail-thread.c -> imap-thread.c
	[f3365e8ba7d0]

2004-07-23  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	If MySQL header checks failed, configure still passed.
	[845779ac5507]

	* src/auth/db-mysql.c, src/auth/db-mysql.h:
	db_port and db_client_flags weren't integers. Reconnects now
	immediately if mysql_query() failed because connection was lost.
	[0d76dd47fbf4]

	* src/lib-storage/index/index-storage.c:
	Better error message for unknown fields in mail*_cache_fields
	[3df5796793bd]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	Fixed a crash with fetch (rfc822.size body). Also fixed it so it
	doesn't anymore parse the message body twice.
	[52eef63bebfd]

	* src/auth/password-scheme.c:
	crypt_generate and md5_generate used only 3 different characters for
	salt. Patch by Joshua Goodall.
	[d921b930abd7]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h:
	get_index() wasn't working with caching disabled
	[e6b216ab4b4f]

	* src/lib-index/mail-cache-transaction.c:
	Assert crashfix in certain situations when adding new cache records.
	[1556d9ba23dc]

	* src/auth/db-mysql.c:
	MySQL reconnection memleak fix.
	[849f12c9c7d0]

	* src/lib-storage/index/index-storage.c:
	Force mmap_no_write = yes if configure detected that.
	[a75f04938f49]

	* doc/mkcert.sh:
	Make certificate valid for one year
	[080ac35855d5]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-create.c,
	src/imap/cmd-delete.c, src/imap/cmd-list.c, src/imap/cmd-
	namespace.c, src/imap/cmd-rename.c, src/imap/cmd-select.c, src/imap
	/cmd-status.c, src/imap/cmd-subscribe.c, src/imap/commands-util.c,
	src/imap/commands-util.h, src/imap/namespace.c,
	src/imap/namespace.h, src/lib-storage/index/index-storage.c, src
	/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-list.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/lib-storage/proxy-mail-storage.c, src/pop3/main.c:
	Moved namespace and hierarchy separator handling to imap-specific
	code. LIST now shows non-hidden namespaces in the LIST reply.
	[1371d41c375f]

2004-07-22  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib/fdpass.c:
	Check BUGGY_CMSG_MACROS in configure.
	[b65456de1b49]

	* src/lib/fdpass.c:
	Added BUGGY_CMSG_HEADERS #define to workaround some OS bugs. Updated
	comments and macros to be more accurate.
	[65433665256d]

	* src/lib-storage/index/index-mail-headers.c:
	compiler warning fix
	[c5cc8ccdd0a7]

	* AUTHORS, src/auth/Makefile.am, src/auth/mech-login.c,
	src/auth/mech.c:
	Added LOGIN SASL mechanism. Patch by Andrey Panin
	[13ed27a24f46]

	* src/pop3-login/client-authenticate.c:
	POP3 CAPA command shouldn't return "AUTH=" in SASL reply. Patch by
	Andrey Panin
	[4c9e46b5dcfd]

2004-07-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	Added error checking
	[d16f7c305e57]

	* src/lib-index/mail-cache.c:
	Use larger field_pool size by default.
	[52ff483dc7f7]

	* src/lib-index/mail-cache-decisions.c, src/lib-index/mail-cache-
	fields.c, src/lib-index/mail-cache-private.h:
	Fixes for big endian systems.
	[fa529dd77176]

	* src/lib-index/mail-cache-private.h, src/lib-index/mail-cache-
	transaction.c:
	Limit how much a single transaction can reserve space
	[b3c0ed666757]

	* src/lib-index/mail-cache-lookup.c:
	mail_cache_lookup_headers() fix
	[29cc953f1822]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	decisions.c, src/lib-index/mail-cache-fields.c, src/lib-index/mail-
	cache-lookup.c, src/lib-index/mail-cache-private.h, src/lib-index
	/mail-cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index
	/mail-cache.h, src/lib-storage/index/index-mail-headers.c, src/lib-
	storage/index/index-mail.c:
	Cache fixes. Decisions are saved again.
	[406692edc12d]

	* src/lib/module-dir.c:
	Compile fix when modules were disabled. Patch by Andrey Panin.
	[3347a7e133cc]

	* src/lib/md5.c:
	md5_final() didn't properly clear the whole MD5 context. Also
	changed to use safe_memset(). Patch by Andrey Panin
	[beefcc4249ef]

2004-07-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h:
	header caching fixes
	[d4577ee85f0f]

	* src/login-common/ssl-proxy-openssl.c:
	SSL proxy was destroyed after login instead of staying in
	background.
	[891990251008]

	* src/auth/db-pgsql.c:
	Fixed reconnecting to PostgreSQL.
	[eb9bd211e3ac]

	* src/auth/db-mysql.c:
	Fixes reconnecting to MySQL and some cleanups. Patch by Tomi Hakala.
	[c795490b23d2]

	* src/imap/imap-sync.c:
	Don't send EXISTS after each EXPUNGE.
	[7e02790ded71]

	* src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	transaction-log-view.c:
	Don't crash if mail_index_view_sync_next() is called again after
	it's finished.
	[e5748645a9d6]

	* src/master/master-settings.c:
	Changed default cache fields
	[f6c6ad1a55f9]

	* src/master/login-process.c:
	Changed default cache fields.
	[f34aca0d7c85]

	* src/lib-storage/index/index-mail-headers.c:
	Avoid parsing headers twice to get IMAP envelope.
	[6527f1da0ee3]

	* src/imap/imap-fetch-body-section.c, src/imap/imap-fetch.c, src/imap
	/imap-fetch.h, src/imap/imap-sort.c, src/imap/imap-thread.c, src
	/lib-imap/imap-bodystructure.c, src/lib-index/Makefile.am, src/lib-
	index/mail-cache-compress.c, src/lib-index/mail-cache-decisions.c,
	src/lib-index/mail-cache-fields.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-mail/istream-header-filter.c, src/lib-mail/istream-
	header-filter.h, src/lib-storage/index/index-mail-headers.c, src
	/lib-storage/index/index-mail.c, src/lib-storage/index/index-mail.h,
	src/lib-storage/index/index-search.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/lib-storage/proxy-mail.c, src/lib-
	storage/proxy-mailbox.c:
	Header caching redesigned. New design allows caching decisions per
	field, so they can be divided to temporary/permanent. Cached headers
	are now always returned in original order, old code didn't guarantee
	it. Some other caching changes. (still missing code to store changes
	in caching decisions)
	[7d02e2a7672d]

	* src/lib/strfuncs.c:
	bsearch_strcasecmp() actually called strcmp..
	[0a8c9bfc05a1]

2004-07-16  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/auth/db-ldap.c:
	Fixed to compile with Solaris LDAP library
	[7613e0f68513]

2004-07-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-transaction.c:
	Delay memory allocations for cache transaction. We don't always need
	it.
	[ea745d0c9c4b]

2004-07-12  Timo Sirainen  <tss@iki.fi>

	* src/pop3/commands.c:
	outlook-no-nuls workaround fix
	[ec1dac19cb06]

	* src/imap/Makefile.am, src/imap/client.h, src/imap/cmd-idle.c,
	src/imap/cmd-select.c, src/imap/cmd-status.c, src/imap/cmd-store.c,
	src/imap/commands-util.c, src/imap/imap-fetch.c, src/imap/imap-
	sync.c, src/imap/imap-sync.h, src/imap/mail-storage-callbacks.c, src
	/lib-imap/imap-util.c, src/lib-imap/imap-util.h, src/lib-
	storage/index/index-mailbox-check.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c, src/lib-storage/mail-
	storage.h, src/lib-storage/proxy-mailbox.c, src/pop3/client.c,
	src/pop3/mail-storage-callbacks.c:
	Broke mailbox_sync() into iterator.
	[aae574ed7f4c]

	* src/lib-index/mail-index-view-sync.c:
	View syncing fixes/cleanups.
	[d803ba0206f0]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Handle recent flags in index file correctly. Fixes recent flag
	losing when copying or saving mails with flags.
	[8a6666a9ac98]

	* src/lib-storage/index/mbox/mbox-sync.c:
	mbox recent fixes.
	[7c7e372da1f3]

	* src/lib-index/mail-transaction-log.c, src/lib-storage/index/index-
	storage.c:
	Use CMP_DEV_T() macro to compare struct stat.st_dev
	[4e925eb04b10]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/maildir/maildir-
	mail.c, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-uidlist.h, src/lib-storage/index/mbox
	/mbox-storage.c:
	Recent flags should be fully working now with maildir.
	[0cf316c77b1b]

2004-07-10  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/imap/common.h, src/imap/main.c, src/lib-
	storage/mail-storage.c, src/lib-storage/mail-storage.h, src/master
	/mail-process.c, src/master/master-settings.c, src/master/master-
	settings.h, src/pop3/commands.c, src/pop3/common.h, src/pop3/main.c:
	Split client_workarounds to imap_ and pop3_ ones. Added outlook-no-
	nuls POP3 workaround.
	[1c1ed4494aa4]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-transaction.c, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index-transaction.c:
	Cache fixes. Lookups now look into transactions too.
	[22210d6cf238]

	* src/lib-storage/index/index-transaction.c:
	fetch_mail needs to be deinitialized before transaction is committed
	or rollbacked
	[e2714bd499b7]

	* src/imap/imap-sort.c, src/imap/imap-thread.c:
	thread/sort: commit the transaction, don't rollback..
	[affe191f21ed]

2004-07-09  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	And section fix for --exec-mail..
	[cc753e275197]

	* src/login-common/master.c, src/master/mail-process.c, src/master
	/mail-process.h, src/master/main.c, src/master/master-settings.c,
	src/master/master-settings.h:
	Added --exec-mail option to master. It can be used to parse Dovecot
	config file and exec() imap/pop3 process directly. Moved --inetd
	option into environment as it's only for internal use.
	[4558d1b196fd]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Create all the missing paths up to maildir
	[1d03eceb6ae6]

	* src/lib/mkdir-parents.c:
	check EISDIR in next mkdir() too..
	[53428bbf212e]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Some more mailbox name checks.
	[5f34cfdc29e6]

	* src/lib-index/mail-cache.c:
	Crashfix with empty mailbox
	[75d7f8049add]

	* src/master/main.c:
	SIGHUP correctly reloads configuration now
	[6aa77fdf152e]

	* src/lib/failures.c:
	When i_set_failure_file() is called, make sure the handlers are
	reset back to defaults.
	[2594a592d135]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Never treat "mailbox/" as a valid mailbox name.
	[24387fbf3535]

	* src/lib-storage/index/maildir/maildir-save.c:
	If we're setting flags to saved mail, put it to cur/ directory
	directly. Flags aren't allowed in new dir.
	[a32d5d57a24e]

	* src/login-common/ssl-proxy-openssl.c:
	Refcounting fixes. Unexpectedly destroyed SSL connection could have
	left looping for a long time.
	[8438064ddf08]

	* src/auth/mech-plain.c:
	We could read authid past the buffer if \0password wasn't given in
	input.
	[00b4385cfc48]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h, src/lib-
	storage/index/index-transaction.c:
	Always create cache transaction. Easier that way .. and fixes a
	crash.
	[e4460aca7970]

	* src/lib-index/mail-cache-compress.c:
	Fixed compression.
	[ef0cd18d674c]

2004-07-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-
	bodystructure.h, src/lib-index/mail-cache-compress.c, src/lib-index
	/mail-cache-decisions.c, src/lib-index/mail-cache-lookup.c, src/lib-
	index/mail-cache-private.h, src/lib-index/mail-cache-transaction.c,
	src/lib-index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-mail.h, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox
	/mbox-save.c:
	Cache file fixes, API changes, etc. It's still in somewhat ugly
	state, but getting better..
	[5beb0c20b6e8]

	* src/lib/mempool-alloconly.c:
	If p_free() frees memory, it must also zero it..
	[59062bb4eaac]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index.c:
	crashfix
	[e504e7d19bf7]

2004-07-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/istream-header-filter.c, src/lib/istream-limit.c:
	Wrapper streams shouldn't try to read data if it's already buffered
	in main stream. Fixes at least problem with APPEND when the whole
	message came in one TCP packet.
	[545c1d3ead54]

	* src/auth/db-mysql.c:
	compile fix
	[dde57895a5be]

2004-07-06  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-mysql.conf:
	varchar(255) is max in mysql
	[f4a8d21dbaf1]

	* src/auth/db-mysql.c:
	don't set default port either
	[867b43870bbf]

	* src/master/mail-process.c:
	Updated error message texts.
	[5feeb01998d1]

	* src/auth/db-mysql.c:
	s/user/db_user/
	[f0379a850f2a]

	* src/auth/mech-apop.c, src/pop3-login/client.c:
	Fixes, patch by Andrey Panin
	[83df1d1bbb05]

	* dovecot-example.conf, src/auth/db-mysql.c:
	Added mysql description to example config file. Changed mysql
	default settings.
	[5633733e6ec1]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	Add "Error report written to server log." also to internal login
	error messages.
	[df0b936ae3ed]

2004-07-05  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-alloconly.c:
	pool_alloconly_free() can free the last allocation.
	[ee918986f94e]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-view-sync.c, src/lib-index
	/mail-transaction-log.c:
	fixing crashes from last changes
	[afb81e31b989]

	* src/lib-index/mail-cache.c:
	disable cache file with mmap_no_write. it and mmap_disable will need
	some non-mmap buffer for reading.
	[1a31b3d17b1e]

	* src/lib-index/mail-transaction-log.c:
	more checks against using old cache_offsets
	[199eb3df762c]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	transaction.c, src/lib-index/mail-index-private.h, src/lib-index
	/mail-index-transaction-private.h, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-transaction-log.c:
	Make sure we don't set cache_offsets to old cache files.
	[c54f0c01da09]

	* src/lib-storage/index/index-mail-headers.c:
	cache fix
	[e2a9be7c2270]

	* src/lib-index/mail-index-sync-update.c:
	header and extra_rec syncing crashed because of recent changes.
	[d1318d47cd47]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache.h, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h:
	Cache API updates. Don't return direct pointers to mmaped cache file
	anymore.
	[ed0bb4c12f03]

2004-07-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	renaming mailbox under existing mailbox gave wrong error message
	[675ef825829e]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-index/mail-index-private.h, src/lib-index/mail-
	index-sync-update.c, src/lib-index/mail-index-transaction-private.h,
	src/lib-index/mail-index-transaction.c, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/index-
	transaction.c:
	Cache updating is done now by first reserving space where to write,
	and then writing to it whenever buffer gets full. There is no
	persistent cache file locks anymore because of this, but it also
	means that the same cached field may be written multiple times to
	the file by different processes. Also since we reserve more space
	than we actually need at first, it some space can be wasted if
	multiple processes are updating the cache.
	[41e56f28d085]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-index/mail-index-sync-private.h, src/lib-index
	/mail-index-sync-update.c, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-transaction.c:
	Caching fixes and optimizations. Removed all network byte ordering
	code - it's not worth the trouble and would require massive changes
	in indexing code as well to be useful. Changed next_offset to
	prev_offset which is updated while syncing index.
	[5f374049abdb]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	decisions.c, src/lib-index/mail-cache-lookup.c, src/lib-index/mail-
	cache-private.h, src/lib-index/mail-cache-transaction.c, src/lib-
	index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-index/mail-
	index-sync.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-storage.h:
	Cache file compression works now and compressed cache file is
	reopened. Several other cleanups related to opening - cache file
	isn't created immediately anymore.
	[c68a3c9f6d73]

2004-07-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	storage/index/index-storage.c:
	Removed mail_index_is_in_memory(). It wasn't implemented and it's
	useless anyway. User doesn't need to see "couldn't use index files"
	error message.
	[97da1d911484]

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-storage.h, src/lib-storage/index/mbox/mbox-sync-rewrite.c, src
	/lib-storage/index/mbox/mbox-sync.c:
	Updated comment about how syncing is done, and s/extra
	space/padding/
	[c48822c8713f]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index.h, src
	/lib-index/mail-transaction-util.c, src/lib-storage/index/maildir
	/maildir-sync.c:
	mail_index_sync_sort_flags() now merges flag changes so mail storage
	backends don't need to do it (and maildir didn't before). Dirty
	flags will be synced now too.
	[ced88553af0b]

	* src/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction-view.c, src/lib-index/mail-index-transaction.c,
	src/lib-index/mail-index.h, src/lib-storage/index/index-
	transaction.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	UIDs for appended messages can now be assigned all at once. Maildir
	now updates indexes immediately while saving messages.
	[15d959d262a4]

	* src/auth/mech-apop.c:
	was missing from last commit
	[52a52b3a0357]

	* src/lib-storage/index/mbox/mbox-storage.h:
	Dropped MBOX_HEADER_EXTRA_SPACE from 100 to 50. It should be enough.
	[945403a685f9]

	* src/pop3-login/client.c, src/pop3-login/client.h:
	If we're not connected to all auth sockets, wait before sending
	greeting so APOP challenge gets sent.
	[5bd7fa814d7f]

	* AUTHORS, dovecot-example.conf, src/auth/Makefile.am, src/auth/auth-
	client-connection.c, src/auth/auth-client-connection.h, src/auth
	/auth-client-interface.h, src/auth/auth-master-connection.c,
	src/auth/mech.c, src/imap-login/client-authenticate.c, src/lib-auth
	/auth-client.c, src/lib-auth/auth-client.h, src/lib-auth/auth-
	server-connection.c, src/lib-auth/auth-server-connection.h, src/lib-
	auth/auth-server-request.c, src/pop3-login/client-authenticate.c,
	src/pop3-login/client-authenticate.h, src/pop3-login/client.c,
	src/pop3-login/client.h:
	Added APOP authentication for POP3. Patch by Andrey Panin.

	This required some changes in auth APIs.
	[d2e186f716d8]

2004-07-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Don't keep filling empty spaces which will be overwritten soon
	anyway. Major speedup for rewriting large mboxes.
	[d6001ee7815d]

	* src/lib/istream.c:
	i_stream_read_data() could have returned invalid data at EOF
	(notable with mboxes since end of mail = "EOF").
	[1def5ca25efd]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	body_offset wasn't set if mail had no header.
	[a0ffc18d3185]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	make sure there's only LWSP after X-UID
	[010088ee72de]

	* src/lib-storage/index/mbox/mbox-sync.c:
	fix for mboxes with pseudo header mail
	[e4c375ab3b30]

	* src/lib-storage/index/mbox/mbox-save.c:
	saving messages to empty mbox was buggy
	[ba4f6d7b5a58]

	* src/lib-index/mail-index-sync-update.c:
	assert crashfix
	[0e7534c53679]

2004-06-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-decisions.c:
	Cache decision explanation comment.
	[07c8813877cc]

	* src/lib-storage/index/maildir/maildir-sync.c:
	No maildir filename checking after all.
	[087a43e29492]

2004-06-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache-compress.c:
	Temporary: never compress cache file as it's broken now.
	[487b9179f5dd]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Require that filenames in maildir begin with a digit, otherwise
	complain.
	[93856e13e020]

	* src/lib-storage/index/mbox/mbox-sync-parse.c:
	no_partial_rewrite was incorrectly set always
	[dfb728afc8a3]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	fix, _read() sometimes returned -2 too early
	[4b24a962ef89]

	* src/lib/fdpass.c:
	added comment about solaris and changed the macros once again,
	although may be useless change..
	[509923906599]

	* src/login-common/ssl-proxy.c:
	compile fix when SSL is disabled
	[54c3bc549e34]

	* src/lib-index/mail-cache.c, src/lib-index/mail-cache.h:
	fix
	[648e1a50b959]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	some fixes for handling pseudo headers.
	[7b70a60c0f9d]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c:
	Several fixes for updating mbox. Recent changes also made it corrupt
	headers.
	[cb4dad60f6cd]

	* src/lib-mail/message-parser.c:
	full_value should contain LFs as well
	[8eaf078488d2]

2004-06-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/Makefile.am, src/lib-index/mail-cache-compress.c, src
	/lib-index/mail-cache-decisions.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-index/mail-index-sync-update.c, src/lib-index/mail-
	index-sync.c, src/lib-index/mail-index.h, src/lib-storage/index
	/index-mail.c:
	Added some smartness for deciding what to cache. Cache compression
	code compiles, but untested.
	[2d51bb58a070]

	* src/lib/file-dotlock.c, src/lib/file-dotlock.h:
	don't close dotlock fd if it's given as -1
	[f16e174e1c24]

	* src/lib/ostream-file.c, src/lib/ostream.h:
	Allow giving 0 max_buffer_size, in which case "optimal" size is
	used.
	[95fe82bbda7a]

	* src/lib-index/mail-transaction-log.c:
	fixed some fd leaks in error conditions
	[e7ccd299e754]

2004-06-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	Check immediately if we have write-access to mbox.
	[6850ff275fa5]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/mbox-sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h,
	src/lib-storage/index/mbox/mbox-sync.c:
	Save MD5 sums of some headers for readonly mboxes and use them for
	syncing
	[5e2518377c0a]

	* src/lib-index/mail-index.c:
	removed assert
	[c9a27c0875e2]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-lock.c,
	src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-sync.c, src/lib-index/mail-index-transaction-private.h,
	src/lib-index/mail-index-transaction-view.c, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index-view-sync.c, src/lib-
	index/mail-index-view.c, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log.c, src/lib-index
	/mail-transaction-log.h, src/lib-index/mail-transaction-util.c, src
	/lib-index/mail-transaction-util.h:
	Record size is allowed to change between index files. This will
	allow adding extensions dynamically for existing indexes.
	[51719889ffcf]

2004-06-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-sync.c:
	assertfix
	[1057a5dc0ca7]

	* src/lib-index/mail-cache.h, src/lib-storage/index/index-mail.c, src
	/lib-storage/index/index-mail.h, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h, src
	/lib-storage/index/mbox/mbox-sync.c, src/lib-storage/mail-storage.h,
	src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c:
	Added a framework for getting POP3 UIDL strings from mail-storage.
	The default still is uidvalidity.uid. Added beginnings of overriding
	it from X-UIDL header in mbox.
	[9cc23c29aaec]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	crashfix if client closes connection while authenticating
	[6b05e30c669a]

	* dovecot-example.conf, src/auth/auth-master-connection.c, src/auth
	/auth-master-connection.h, src/auth/auth-master-interface.h,
	src/auth/common.h, src/auth/main.c, src/master/auth-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Dovecot can now connect to externally running dovecot-auth.
	[43b82a35888d]

	* src/imap/main.c, src/login-common/main.c, src/master/main.c,
	src/pop3/main.c:
	DEBUG: If GDB environment is set, don't do fd leak checks.
	[dcff4c088f1a]

	* src/auth/passdb.c, src/auth/userdb.c:
	Default to "" args instead of NULL to avoid some crashes
	[60802bea8f32]

	* src/lib-settings/settings.c:
	Allow empty section name.
	[089d2cc59538]

	* src/auth/passdb.c, src/auth/userdb.c:
	skip extra whitespace between "dbtype arguments"
	[e5684c8c60f9]

	* dovecot-example.conf:
	Add a comment about # chars and whitespace.
	[58fc6765027c]

	* src/master/auth-process.c:
	don't change our umask permanently
	[12852d295196]

	* src/lib-index/mail-cache-lookup.c:
	Crashfixes for disabled cache.
	[201442d45cac]

	* src/lib-storage/index/maildir/maildir-sync.c:
	partial syncing fixes
	[d19ba01fb5cd]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Complain about reappearing UIDs, but reassign new UIDs to them
	anyway. Don't try to update \recent mails if we aren't really going
	to make them non-recent.
	[a0ad3f6fb90f]

2004-06-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox
	/mbox-storage.h:
	We didn't specify full path for .subscriptions file, and it was
	named without the leading dot..
	[f14c54dc41a2]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage-
	private.h, src/lib-storage/mail-storage.c:
	get_last_error() wasn't virtualizable
	[5947497c3e40]

	* src/lib-index/Makefile.am, src/lib-index/mail-cache-lookup.c, src
	/lib-index/mail-cache-transaction.c, src/lib-index/mail-index-
	transaction-private.h, src/lib-index/mail-index-transaction-view.c,
	src/lib-index/mail-index-transaction.c, src/lib-index/mail-index-
	view-private.h, src/lib-index/mail-index-view.c, src/lib-index/mail-
	index.h, src/lib-storage/index/index-fetch.c, src/lib-storage/index
	/index-mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/index-
	transaction.c, src/lib-storage/index/maildir/maildir-transaction.c,
	src/lib-storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-transaction.c:
	Added mail_index_transaction_get_updated_view() which can be used to
	access uncommitted messages.
	[a816e2d88406]

2004-06-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/proxy-mailbox.c, src/lib-storage/proxy-mailbox.h:
	updates
	[cf5967239463]

	* configure.in, src/imap/cmd-append.c, src/imap/cmd-copy.c:
	Removed UIDPLUS after all, it needs more thinking about with
	maildir.
	[c01f238a37a0]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	transaction.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index.h, src/lib-
	storage/index/mbox/mbox-save.c:
	Cache doesn't crash anymore if we're asking it about messages that
	exist only in uncommitted transactions.
	[e0cb58614ebc]

	* src/lib-index/mail-cache-transaction.c, src/lib-index/mail-cache.c:
	Disable cache with mmap_disabled=yes, for now.
	[357bc14b6d05]

	* src/imap/imap-thread.h, src/lib-storage/mail-storage.h:
	Moved enum mail_thread_type to imap
	[06d77f22cf6c]

2004-06-20  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	comment update for setting ports in listen
	[8864dbc17cfa]

	* src/lib-storage/index/mbox/mbox-sync.c:
	assertfix
	[a242b5b9b287]

	* src/lib-storage/index/mbox/mbox-sync.c:
	and more fixes..
	[81d4e61702a3]

	* src/lib-storage/index/mbox/mbox-sync.c:
	expunge everything in index after missing/invalid X-UID
	[be180a9bf10d]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync.c:
	fixes for From-line offset updating
	[c0b5573d76e3]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Hide "folder internal data" messages
	[a3cd4bebb4aa]

	* src/lib-index/mail-index-lock.c:
	Exclusive index locking always used copy-locking without even trying
	fcntl-locking.
	[f71c36aae566]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	Don't die horribly when message with previously expunged UID is
	inserted into mbox.
	[14badbddd7b7]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-
	transaction-log.c:
	assert crashfixes
	[62a2cc099f08]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	view.c, src/lib-index/mail-index.c:
	Index syncing fixes.
	[2a9c84ed988c]

	* src/lib/file-dotlock.c:
	Never overflow secs_left for stale timeout callback
	[74fcdbb6bcee]

	* src/lib-storage/index/mbox/mbox-sync.c:
	fsync() mbox before unlocking if we've modified it
	[9b3e774a9a67]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib-storage/index/mbox/mbox-sync.c:
	Allow dropping exclusive mbox locks to shared locks.
	[2157c6aab530]

	* dovecot-example.conf, src/lib-storage/index/mbox/mbox-lock.c:
	Don't require dotlocking to be first in locking list.
	[821fbe3e892b]

	* src/lib-index/mail-cache.c:
	don't do infinite looping
	[387bccdf00bf]

	* src/lib-index/mail-cache.c, src/lib-index/mail-transaction-log.c:
	cache file fixes
	[9d384176c177]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't crash if transaction log contains records for messages that
	don't exist anymore.
	[7d901b0ec312]

	* src/lib-index/mail-cache-lookup.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-transaction.c, src/lib-index
	/mail-cache.c, src/lib-index/mail-cache.h, src/lib-index/mail-index-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-sync.c, src/lib-index/mail-index-transaction-private.h,
	src/lib-index/mail-index-transaction.c, src/lib-index/mail-index-
	view.c, src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-log.h, src/lib-index/mail-transaction-util.c, src/lib-
	index/mail-transaction-util.h:
	Several fixes and cleanups to cache file code, still badly broken
	[7bdef5ea4591]

	* src/lib-index/mail-cache-compress.c, src/lib-index/mail-cache-
	lookup.c, src/lib-index/mail-cache-old.c, src/lib-index/mail-cache-
	private.h, src/lib-index/mail-cache-transaction.c, src/lib-index
	/mail-cache.c, src/lib-index/mail-cache.h, src/lib-index/mail-
	index.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/index-transaction.c:
	Beginnings of getting cache file working again. Easy to break
	currently, but basics seem to work.
	[97bb7b127617]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c:
	APPEND/COPY in non-selected mailbox must not remove the Recent-flag
	[89001f106f8d]

	* src/lib-index/mail-index-view.c:
	mail_index_lookup() set rec=NULL incorrectly.
	[f5baee0fc85f]

	* src/lib-storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h:
	Filter internal headers from user visible input stream. Make
	mailbox_save() use the same header list.
	[6033af323a61]

	* src/lib-mail/Makefile.am, src/lib-mail/istream-header-filter.c, src
	/lib-mail/istream-header-filter.h:
	Added istream-header-filter, which allows filtering specified
	headers from input stream.
	[0417cdfa6d88]

	* src/lib/strfuncs.c, src/lib/strfuncs.h:
	Added bsearch_strcasecmp()
	[40b8be298506]

	* src/lib-storage/mail-save.c:
	Make sure headers end with LF
	[ebeae1eaa900]

	* src/lib-index/mail-index.c:
	assertfix
	[1019b7694a11]

	* src/lib-storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Expunge fixes
	[d7378b25046b]

	* src/lib-index/mail-index-view.c, src/lib-index/mail-index.h:
	mail_index_lookup() and mail_index_lookup_extra() now returns 0 if
	message has been expunged, 1 if not.
	[4d25f3fe5de1]

	* configure.in, src/imap/cmd-append.c, src/imap/cmd-close.c, src/imap
	/cmd-copy.c, src/imap/cmd-expunge.c, src/imap/cmd-select.c, src/imap
	/cmd-status.c, src/imap/commands-util.c, src/imap/commands-util.h,
	src/imap/commands.c, src/imap/commands.h, src/imap/imap-expunge.c,
	src/imap/imap-expunge.h, src/lib-index/mail-index-transaction.c, src
	/lib-index/mail-index.h, src/lib-storage/index/index-mail.c, src
	/lib-storage/index/index-search.c, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox/mbox-
	mail.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/index/mbox/mbox-
	sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h, src
	/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync-update.c, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/index/mbox/mbox-transaction.c, src
	/lib-storage/mail-save.c, src/lib-storage/mail-save.h, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h:
	mailbox_save() and mailbox_copy() functions can now return the saved
	mail so it can be immediately queried. Implemented UIDPLUS extension
	using it. Maildir implementation missing, so it crashes with it for
	now.. APPEND with mbox now doesn't require resyncing the mailbox
	since it updates indexes directly.
	[755ec9442a58]

	* src/lib-index/mail-index-sync.c:
	Set uid1/uid2 for MAIL_INDEX_SYNC_TYPE_APPEND
	[ff99c79b2fc9]

	* src/lib-index/mail-transaction-log.c:
	bugfix for extra-records change
	[d7a314446b47]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	read() less often
	[8f0e6c3b13c5]

	* src/lib/istream.c:
	seek optimization
	[6eb96c8aaac3]

	* src/lib/fdpass.c:
	Fix for the previous Solaris fix. fd_send() was sending two fds.
	[078da7741971]

	* src/master/mail-process.c:
	cleanup
	[9b4555d58737]

	* src/lib/fd-close-on-exec.c:
	if socket is leaked, show also the remote side of it
	[1b0153eb3fa5]

2004-06-19  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-mmap.c:
	minor optimization
	[4e559fad61fb]

	* configure.in:
	Use AC_TRY_LINK() for sendfile() checks so it works right with
	Solaris. Did the same for mremap() too just in case.
	[7d4e10c5bd93]

	* src/lib-storage/index/mbox/mbox-storage.c:
	create mbox root directory if it doesn't exist
	[2cc1951d6de3]

	* src/lib/ioloop.c:
	fix for fix
	[7b104f7e16c4]

	* src/lib/ioloop.c:
	io_remove() fix
	[39f55e074619]

	* configure.in:
	Removed AC_ARG_PROGRAM. Lets see if this breaks anything..
	[84ffac0d1c04]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	fix
	[a0173f504707]

	* src/lib-storage/index/index-storage.h:
	continuing maildir sync fix commit
	[3e8597575e9f]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't crash after empty mailbox gets messages
	[814f55aea322]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Don't crash if we're syncing last commit to maildir, but some file
	was lost
	[9438951e243f]

	* src/lib-storage/index/mbox/mbox-sync.c:
	index errors always need to store the error message to store
	[cee8c4354b20]

	* src/lib-storage/index/mbox/mbox-sync.c:
	don't crash if we wanted to lock mbox for reading but it also needs
	rewriting
	[d0f9f550e71f]

	* src/lib-index/mail-index.c:
	minor fix for error handling
	[fb785d235c43]

	* src/lib-storage/index/mbox/mbox-sync.c:
	New mails pointed to beginning of file.
	[73e9cf84a92a]

	* src/lib-storage/index/mbox/mbox-sync.c:
	assert crashfix for readonly mboxes
	[d6687626c6a1]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	fix
	[9f318b950ea7]

	* src/lib/istream-limit.c:
	minor fix
	[ed6b3d59ce93]

	* src/lib/istream.c:
	i_stream_read_data(): don't call read() unless we have to
	[4c5732a9e2bc]

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	fixes
	[e5f9d66d6ced]

2004-06-18  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	comment update
	[506302b8b2fb]

	* configure.in, src/auth/.cvsignore, src/auth/Makefile.am, src/auth
	/checkpassword-reply.c, src/auth/passdb-checkpassword.c,
	src/auth/passdb.c, src/auth/passdb.h:
	Added checkpassword passdb. userdb has only beginnings.
	[95b2a6abc01e]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync.c:
	Added istream_raw_mbox_is_eof() and fixed updating UIDVALIDITY in
	index
	[acc93754e91d]

	* src/lib-storage/mail-save.c, src/lib/istream-file.c, src/lib
	/istream-limit.c, src/lib/istream.c, src/lib/istream.h:
	Renamed istream->eof to istream->disconnected which is what it
	currently does.
	[a0b23396835c]

	* src/lib-storage/index/mbox/mbox-sync.c:
	read-only mbox fix
	[c7616a31589a]

	* src/lib-storage/index/mbox/mbox-sync-update.c:
	Fixed updating X-IMAPbase
	[787bbde7ced3]

	* src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	fixes
	[4c55020e6b53]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't leak mbox fd when closing mailbox
	[1d55147bd27b]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync.c:
	fixes
	[282e993b92c4]

	* src/lib-storage/index/mbox/mbox-sync.c:
	X-IMAPbase update fix
	[34ea1398a67b]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c:
	Create X-Keywords header if possible.
	[53288223de6c]

	* src/lib/str.c, src/lib/str.h:
	Added str_insert()
	[c7b77b11c89c]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c:
	Several fixes in space/offset logic. Should be much more robust now.
	[16287320d080]

	* src/imap/imap-fetch-body-section.c, src/lib-mail/message-body-
	search.c, src/lib-mail/message-parser.c, src/lib-mail/message-
	parser.h, src/lib-storage/index/index-mail-headers.c, src/lib-
	storage/mail-save.c:
	Added skip_initial_lwsp parameter to message_parse_header_init().
	[347ca1cf6372]

2004-06-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/mbox-file.c, src/lib-storage/index/mbox/mbox-sync.c:
	EXAMINE/STATUS should also update metadata changes, they don't
	really open the mbox as readonly.
	[b526decec0b8]

	* src/lib-storage/index/mbox/mbox-sync.c:
	sync fix
	[219fe7776a0c]

	* src/lib-index/mail-index-sync-update.c:
	fix
	[8a3e09139b4c]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-sync-rewrite.c, src
	/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Complain if file isn't in mbox format. Complain if From-line wasn't
	found from expected location. Parser should handle now correctly any
	kind of mbox no matter how corrupted.
	[3a33250e6a2d]

	* src/lib-mail/message-parser.c:
	Handle missing last \n from headers more correctly
	[fd00d1b2fd14]

	* src/lib-storage/index/mbox/mbox-from.c:
	Oops, don't include the known date formats list (copyrighted by UW-
	IMAP, copy&pasted there only temporarily and forgot..). They could
	be compressed just as well for a few short rules.
	[b53b36b6b41d]

	* TODO:
	updated
	[11c1f1203b65]

	* src/lib-storage/index/mbox/mbox-sync.c:
	crashfix in error case
	[535227d3e4b0]

	* dovecot-example.conf, src/lib/restrict-access.c, src/lib/restrict-
	access.h, src/master/auth-process.c, src/master/login-process.c,
	src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Added mail_extra_groups setting.
	[8690d2000e33]

	* src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-util.c:
	"readonly sync" -> "forced sync"
	[e2cd51b99359]

	* src/lib-index/mail-index-sync.c:
	cleanups
	[9f90f83835ae]

	* src/lib-index/mail-transaction-util.c:
	merging expunge buffers sometimes produced wrong results
	[0b11c460c64a]

2004-06-15  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/master/master-settings.c:
	Raised login_process_size default from 16MB -> 32MB
	[7d625d6b33aa]

	* src/lib-storage/index/mbox/mbox-from.c:
	Allow more From-line date formats.
	[33ee7db25ee2]

	* src/lib-storage/index/maildir/maildir-list.c:
	d_type symlink checks
	[fdacb90d3f45]

	* src/auth/passdb-pam.c:
	Set PAM_RHOST for PAM if it's known.
	[c70d0155d93c]

	* dovecot-example.conf:
	comment update
	[6e662d7188e9]

	* src/auth/passdb-vpopmail.c:
	Added support for vpopmail pop-before-smtp relay
	[91358abe5874]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	storage.h:
	forgot to commit
	[44a6af356c45]

	* src/lib-storage/index/maildir/maildir-util.c:
	warning
	[46a58a2da7cc]

	* src/lib-storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-sync.c:
	fixes
	[1039d3650f5c]

	* src/lib-storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync.c, src/lib-storage/index/mbox/mbox-transaction.c:
	lock the mbox before reading it.
	[2da965864bc4]

	* src/lib/fdpass.c:
	Solaris fix by Tim Hurman
	[5cb49f75e512]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox/mbox-
	sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync.c:
	more syncing fixes
	[57078e1f2bfc]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-lock.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	several fixes and optimizations.
	[dc18cc3568b0]

2004-06-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	major syncing code cleanups. the code finally looks almost readable.
	logic should have stayed same.
	[24651c3ac7f3]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	locking fixes
	[e01de478882f]

	* src/lib-index/mail-index.c:
	crashfix on error
	[db5807f350ca]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c:
	Locking fixes. use less memory
	[0840edf34f37]

	* src/lib-index/mail-index-sync-update.c:
	bugfixes
	[f434ecc6ef83]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	fixes
	[26dd9aca935e]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/mbox
	/mbox-mail.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-sync-parse.c, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync-
	rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Save mbox offsets to index file using extra_records. Some other
	fixes.
	[11febaee5e9b]

	* src/lib-storage/index/index-storage.c:
	Don't let index_storage_alloc() fail
	[e154abe2337c]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index-view.c, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h, src/lib-index/mail-transaction-
	log.c, src/lib-index/mail-transaction-util.c:
	Fixes for extra_records
	[fbb4da13ee3b]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-transaction-private.h, src/lib-
	index/mail-index-transaction.c, src/lib-index/mail-index.c, src/lib-
	index/mail-index.h, src/lib-index/mail-transaction-log-view.c, src
	/lib-index/mail-transaction-log.c, src/lib-index/mail-transaction-
	log.h, src/lib-index/mail-transaction-util.c, src/lib-index/mail-
	transaction-util.h:
	Modifying extra_records should work now.
	[f720b3f15333]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-lock.c,
	src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index-view-sync.c, src/lib-index
	/mail-index-view.c, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h, src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-util.c, src/lib-index/mail-transaction-util.h:
	Added support for per-index sized mail_index_record.
	[4aedcb4c51cb]

	* src/lib/network.c, src/lib/network.h:
	net_gethostbyname() was broken with IPv6 enabled (wasn't really used
	with Dovecot anyway). Some other cleanups.
	[c5817f302aa6]

	* src/lib-storage/index/mbox/mbox-sync.c:
	Don't sync mbox if it hasn't changed
	[55d3864cc4f8]

2004-06-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Fixes for expunging first message
	[eb26aa46686d]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c:
	some more fixes
	[18d29a565168]

	* src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	expunges should pretty much work now.
	[8c0168d19148]

2004-06-11  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Some of recent dotlock changes weren't committed..
	[0b3a6fea167c]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c,
	src/lib-storage/index/mbox/mbox-sync.c:
	expunging is somewhat working
	[8266299b92f5]

2004-06-10  Timo Sirainen  <tss@iki.fi>

	* doc/configuration.txt:
	s/login_process_per_user/login_process_per_connection/
	[1d15be422201]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Make sure INBOX is created when maildir storage is opened.
	[2a7e87dea317]

2004-06-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-settings/settings.c:
	Changed error message
	[193cb9001256]

2004-06-03  Timo Sirainen  <tss@iki.fi>

	* configure.in, dovecot-example.conf, src/lib-storage/index/mbox/mbox-
	lock.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	Separate mbox_locks/mbox_read_dotlock to mbox_read_locks and
	mbox_write_locks. Added support for lockf() method.
	[879b0b9ed5d4]

2004-05-31  Timo Sirainen  <tss@iki.fi>

	* src/auth/main.c, src/auth/mech-cram-md5.c, src/auth/mech-digest-
	md5.c, src/auth/mech.c, src/auth/mech.h:
	Delay reporting failed authentications
	[a5e7414f1a9a]

	* src/lib-index/mail-transaction-log.c:
	whops, wrong change. immediate_stale_timeout 2min -> 5min
	[9b202e2ac91b]

	* src/lib-index/mail-transaction-log.c:
	Grow log_dotlock_timeout to 120sec
	[6d7c3c150937]

	* src/auth/db-passwd-file.c, src/auth/db-passwd-file.h, src/auth/mech-
	anonymous.c, src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c,
	src/auth/mech-plain.c, src/auth/mech.c, src/auth/mech.h, src/auth
	/passdb-bsdauth.c, src/auth/passdb-ldap.c, src/auth/passdb-mysql.c,
	src/auth/passdb-pam.c, src/auth/passdb-passwd-file.c, src/auth
	/passdb-passwd.c, src/auth/passdb-pgsql.c, src/auth/passdb-shadow.c,
	src/auth/passdb-vpopmail.c, src/auth/userdb-passwd-file.c, src/auth
	/userdb-passwd.c:
	Logging changes. Make sure we don't write control characters to log
	and also log IP address.
	[eac49325fa23]

	* src/lib/network.c, src/lib/network.h:
	Added net_getpeername()
	[24e382b88232]

	* doc/Makefile.am, doc/variables.txt, dovecot-example.conf, src/auth
	/auth-client-interface.h, src/auth/mech.c, src/auth/mech.h, src
	/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/lib-auth/auth-client.h, src/lib-auth/auth-
	server-request.c, src/login-common/client-common.h, src/login-
	common/main.c, src/login-common/master.c, src/master/login-
	process.c, src/master/mail-process.c, src/master/mail-process.h,
	src/master/master-login-interface.h, src/master/master-settings.c,
	src/master/master-settings.h, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/client.h:
	Added %l, %r and %P variables and mail_log_prefix setting.
	[4e77cb0aff21]

	* src/lib/module-dir.c:
	Don't complain if module directory doesn't exist
	[7e46cf0f3522]

2004-05-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c, src/lib-index/mail-transaction-log-
	view.c, src/lib-index/mail-transaction-log.c:
	fixes
	[92d8b70829c8]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	small fixes
	[8f46cf3e9b5a]

	* src/pop3/client.c:
	fix
	[fe795faa81a1]

	* src/pop3/client.c:
	assert fix
	[952a4106d3b8]

	* src/lib-index/mail-transaction-log-view.c:
	show error messages when log files are missing
	[2450b4ff4894]

	* src/lib/module-dir.c:
	Be quiet when we don't want to call init() / deinit() and they don't
	exist
	[0a4b2c006096]

	* src/lib-auth/auth-server-request.c:
	PLAIN auth fallbacking works now with initial responses
	[d8cd285b148b]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h:
	Use initial SASL response for LOGIN command internally.
	[4d0834aaa365]

	* src/lib-index/mail-transaction-log-view.c:
	added assert
	[a11f8fa33848]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c:
	fixes
	[5c851ff00f1a]

	* src/lib-index/mail-transaction-log-view.c:
	assert fix
	[258c8ef1bdc4]

	* src/auth/Makefile.am, src/auth/main.c, src/auth/password-scheme.c,
	src/auth/password-scheme.h, src/imap/main.c, src/lib/module-dir.c,
	src/lib/module-dir.h, src/pop3/main.c:
	Added support for password scheme plugins. auth module dir defaults
	under module_dir now.
	[9ba79ebae6ab]

	* src/auth/password-scheme.c:
	Allow either SHA or SHA1.
	[19394e36178c]

	* src/lib-auth/auth-client.c, src/lib-auth/auth-client.h, src/lib-auth
	/auth-server-connection.c, src/lib-auth/auth-server-connection.h:
	Allow using more easily outside dovecot.
	[e22e3827a5f3]

	* src/auth/mech.c:
	Case insensitive lookups for mechanism names
	[3c0fb1a4a379]

	* configure.in, src/auth/password-scheme.c:
	SHA1 support via OpenSSL
	[cf8c711f76a0]

	* src/master/mail-process.c:
	updated valid_chroot_dirs error message.
	[729431cc32c1]

	* configure.in, dovecot-example.conf, src/lib-storage/index/maildir
	/maildir-list.c, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added maildir_stat_dirs option.
	[b3daf55df932]

	* src/auth/Makefile.am, src/auth/auth-client-connection.c, src/auth
	/auth-client-interface.h, src/auth/auth-master-connection.c,
	src/auth/auth-master-connection.h, src/auth/auth-master-interface.h,
	src/auth/auth-mech-desc.h, src/auth/main.c, src/auth/mech-
	anonymous.c, src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c,
	src/auth/mech-plain.c, src/auth/mech.c, src/auth/mech.h,
	src/auth/passdb.c, src/imap-login/client-authenticate.c, src/lib-
	auth/auth-client.c, src/lib-auth/auth-client.h, src/lib-auth/auth-
	server-connection.c, src/lib-auth/auth-server-connection.h, src/lib-
	auth/auth-server-request.c, src/lib/file-dotlock.c, src/pop3-login
	/client-authenticate.c:
	Removed hardcoded mechanism lists. It's now possible to add them
	dynamically. Added support for SASL initial response.
	[d5b20d679b8a]

2004-05-29  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-client-interface.h, src/auth/mech.c, src/auth/mech.h,
	src/auth/passdb-pam.c, src/auth/passdb-vpopmail.c, src/imap-login
	/client-authenticate.c, src/lib-auth/auth-client.h, src/lib-auth
	/auth-server-request.c, src/pop3-login/client-authenticate.c:
	Don't use hardcoded protocol list for auth process, string is just
	fine.
	[6a72075e3543]

	* src/auth/auth-master-connection.c, src/auth/auth-master-
	connection.h, src/auth/main.c, src/auth/mech.c, src/master/auth-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	dovecot-auth can now be run by itself, it listens in UNIX sockets
	specified in AUTH_SOCKETS environment. Added extra_sockets auth
	setting which can be used to do the same thing while started through
	dovecot master.
	[5138b14889a6]

2004-05-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-transaction-log-view.c, src/lib-index
	/mail-transaction-log.h:
	Keep the transaction log view open all the time for index views (not
	just while syncing) to avoid losing the log files.
	[cb5269c052e0]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log.c:
	Don't complain about transaction log indexid changes when rebuilding
	index.
	[a58c51c8f37b]

2004-05-26  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream-file.c:
	struct iovec->iov_base may not be defined as void*. add casts to
	avoid compiler warnings.
	[69cef820735f]

	* src/lib-index/mail-index-sync-update.c:
	mmap_disable=yes crashfix
	[fd17ca21af0b]

	* configure.in, src/master/Makefile.am, src/master/master-settings.c:
	Added --with-moduledir configure option
	[0c8f884d1648]

	* src/master/master-settings.c:
	mail_modules for pop3 should default to lib/pop3, not lib/imap
	[028a6cf7488f]

	* dovecot-example.conf:
	oe6-fetch-redundant-msgset workaround doesn't exist anymore, remove
	it
	[d52c8cbf2b9d]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Path was missing from Maildir sync-errors.
	[3f97439ba59e]

	* src/lib-index/mail-index-sync-update.c:
	fix
	[ef96a98b109a]

	* src/lib-index/mail-index-view.c:
	mail_index_lookup_uid_range(): don't crash if we look only UIDs
	larger than our next_uid
	[2e2287c9d5eb]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Don't use internal last_cur_mtime stamp - it's index-specific so
	always get it from index's header.
	[5cfdc99fab69]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h:
	mail_index_refresh() - allows forcing a refresh check
	[21a3e5d08290]

2004-05-25  Timo Sirainen  <tss@iki.fi>

	* src/imap/mail-storage-callbacks.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c, src/lib-storage/mail-storage.h, src/pop3
	/mail-storage-callbacks.c:
	Send recent counter changes when it actually changes.
	[397ce1dbc593]

	* src/lib-storage/index/maildir/maildir-mail.c:
	,W= fix
	[ad296f17c100]

	* src/login-common/ssl-proxy.c:
	compile fix
	[9c18f7e42016]

	* src/lib-index/mail-index-lock.c:
	fcntl_locks_disable=yes fix
	[5847f9dc8ce4]

	* src/imap-login/client.c, src/imap/client.c, src/imap/imap-sort.c,
	src/master/mail-process.c, src/pop3-login/client.c,
	src/pop3/commands.c:
	cleanup: str_*case(t_strdup_noconst(str)) -> t_str_*case(str)
	[0a1755f79392]

	* dovecot-example.conf, src/auth/auth-master-connection.c,
	src/auth/mech.c, src/auth/mech.h, src/auth/passdb-ldap.c, src/auth
	/passdb-mysql.c, src/auth/passdb-pgsql.c, src/auth/userdb-ldap.c,
	src/auth/userdb-mysql.c, src/auth/userdb-passwd-file.c, src/auth
	/userdb-passwd.c, src/auth/userdb-pgsql.c, src/auth/userdb-static.c,
	src/auth/userdb-vpopmail.c, src/auth/userdb.h, src/lib-index/mail-
	index-sync-update.c, src/lib/strfuncs.c, src/lib/strfuncs.h, src/lib
	/var-expand.c, src/lib/var-expand.h, src/master/common.h, src/master
	/login-process.h, src/master/mail-process.c:
	Fixed var_expand() to take a table of variables rather than a few
	predefined ones. Added support for modifiers.
	[5e0167577399]

	* src/lib-storage/index/maildir/maildir-list.c:
	don't crash if we can't open directory
	[7c47536833ca]

2004-05-24  Timo Sirainen  <tss@iki.fi>

	* src/auth/userdb-vpopmail.c:
	Get internal username from vpw->pw_name after all. It may contain
	domain which input username doesn't.
	[ef9a46ea2622]

	* src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	uidvalidity/uidnext fixes
	[02e066d4df9a]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	race condition fixes
	[66f5d28f9b27]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	cleanup
	[9d1ce6135d4f]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h:
	Some more UIDVALIDITY issues fixed.
	[596267d8e2e2]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync-update.c, src/lib-index
	/mail-index-sync.c, src/lib-index/mail-index-transaction-private.h,
	src/lib-index/mail-index-transaction.c, src/lib-index/mail-index-
	view-private.h, src/lib-index/mail-index-view-sync.c, src/lib-index
	/mail-index.c, src/lib-index/mail-index.h, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c, src
	/lib-index/mail-transaction-log.h, src/lib-index/mail-transaction-
	util.c, src/lib-index/mail-transaction-util.h, src/lib-storage/index
	/index-sync.c, src/lib-storage/index/maildir/maildir-storage.c, src
	/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h, src/lib-storage/index/mbox
	/mbox-sync.c:
	Index header changes now go through transaction log. Removed the
	kludgy parameters for mail_index_sync_end(). Removed code
	duplication of syncing index root mapping and view mapping. Some
	fixes to handling uidvalidity and nextuid in syncing.
	[ee1095ccfd23]

	* src/lib-index/mail-index-lock.c:
	fix for last change
	[6bdabb83f1a2]

	* src/lib-index/mail-index-lock.c:
	when index's header size grows, fix it first time we get exclusive
	lock
	[a4babfc85e0a]

2004-05-23  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Print version number in "Dovecot starting up" message.
	[55e3412ae995]

	* src/master/auth-process.c, src/master/log.c, src/master/log.h,
	src/master/login-process.c, src/master/mail-process.c:
	logging cleanups.
	[6ae973f60f43]

	* src/lib-index/mail-transaction-log.c:
	more debugging info to log
	[c7b50945591e]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view-sync.c, src/lib-index/mail-index-view.c:
	View's message count shouldn't change until after view is synced.
	[d2eafac70369]

	* src/lib-index/mail-index.c:
	Don't try to re-map dirty memory mapping.
	[4548def7ac02]

	* src/lib-storage/index/index-search.c:
	cleanup
	[418a0de45c38]

	* src/lib-storage/index/index-sync.c, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib-storage/index/mbox/mbox-sync-parse.c,
	src/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	mbox syncing fixes
	[2240a38138db]

	* src/lib/ostream-file.c:
	o_stream_send_istream() fix
	[6920ebecb853]

	* dovecot-example.conf, src/lib-storage/index/index-storage.c, src
	/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/maildir/maildir-uidlist.c,
	src/lib-storage/mail-storage.h, src/master/mail-process.c,
	src/master/master-settings.c, src/master/master-settings.h,
	src/pop3/client.c:
	Added pop3_mails_keep_recent option. Fixed recent assert crash.
	[f0925b2271e1]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	src/lib-storage/index/index-mail.c, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/maildir/maildir-uidlist.c:
	Recent flag fixes. Should work perfectly now with maildir.
	[df504dad3aec]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index-view-sync.c, src/lib-
	index/mail-index.h, src/lib-storage/index/index-sync.c, src/lib-
	storage/index/maildir/maildir-sync.c:
	Set dirty flags through transaction log, not directly. Some other
	flag fixes etc.
	[8763032d31bd]

2004-05-22  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	AC_DEFUN warning fixes for aclocal 1.8..
	[b3a56463c812]

	* configure.in, src/lib/sendfile-util.c:
	Solaris: Move from sendfilev() to sendfile() (was it always there?).
	Make EAFNOSUPPORT error Linux-compatible EINVAL.
	[0e65efd14eda]

	* src/lib-storage/index/maildir/maildir-sync.c:
	Fix bogus "UID inserted in the middle of mailbox" errors
	[8078400fe561]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index-view-sync.c, src/lib-
	index/mail-index.h, src/lib-index/mail-transaction-log-view.c, src
	/lib-index/mail-transaction-log.c, src/lib-index/mail-transaction-
	log.h, src/lib-index/mail-transaction-util.c, src/lib-index/mail-
	transaction-util.h, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/maildir/maildir-
	sync.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-update.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Transaction log contains only UIDs now, no more sequences which just
	mess up everything.
	[4f6b1118a53d]

2004-05-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-transaction-log-
	view.c, src/lib-index/mail-transaction-util.c, src/lib-index/mail-
	transaction-util.h:
	last tried fixes with sequences-in-log approach. moving to uids
	next, wonder why I didn't earlier.
	[1138c7abb360]

2004-05-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-util.c:
	Expunge fix
	[28d715a903e1]

	* src/auth/mycrypt.c:
	Solaris 10 comple fix
	[4e331341d603]

	* src/lib-storage/proxy-mail-storage.c:
	compile fix
	[25a8c7c21a7a]

	* configure.in:
	Removed LIST-SUBSCRIBED capability, latest LISTEXT draft dropped it.
	[ec22548b6124]

	* dovecot-example.conf, src/auth/auth-client-interface.h,
	src/auth/mech.c, src/auth/mech.h, src/imap-login/client-
	authenticate.c, src/imap-login/client.c, src/lib-auth/auth-client.h,
	src/lib-auth/auth-server-request.c, src/login-common/client-
	common.h, src/login-common/main.c, src/login-common/ssl-proxy-
	openssl.c, src/login-common/ssl-proxy.h, src/master/auth-process.c,
	src/master/master-settings.c, src/master/master-settings.h,
	src/pop3-login/client-authenticate.c, src/pop3-login/client.c:
	Added ssl_require_client_cert auth-specific setting. Hide
	ssl_verify_client_cert from default config file as it's
	automatically set if needed and there's not much point in forcing
	it.
	[dc5d0da1abe9]

	* src/lib-index/mail-transaction-log.c:
	Dotlocking: Don't leave the log infinitely locked after rotation
	[53585aa87f9c]

	* src/lib/file-dotlock.c:
	file_dotlock_delete(): don't complain about mtime changes in lock
	file, as we most likely did it ourself
	[ced02e8023c6]

	* src/lib-index/mail-index-transaction.c:
	Don't remove flag changes in transaction log if they're expunged
	[8bb1db13c94a]

	* src/imap/cmd-sort.c, src/imap/cmd-thread.c, src/imap/imap-sort.c,
	src/imap/imap-thread.c:
	return value fixes
	[1659cfc67eaf]

	* src/lib-index/mail-transaction-log.c:
	fixes
	[f5eb6bd7d1aa]

2004-05-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c:
	Locking fixes
	[19e638ade25c]

	* src/pop3/client.c:
	fixes
	[62faff1d0047]

	* src/pop3/client.c:
	fix
	[b6b0d536bed9]

	* src/lib-index/mail-transaction-util.c:
	fixes
	[be02e17d7162]

	* src/lib-index/mail-transaction-log.c:
	more fixes (still not right?)
	[2a047b054e92]

2004-05-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-transaction-log.c:
	bugfixes
	[28779a3de9c6]

	* src/pop3/client.c:
	t_push/t_pop
	[0fae715679bc]

2004-05-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-util.c:
	t_push/t_pop
	[6c21c1d25b53]

	* src/lib-index/mail-transaction-log.c:
	fix
	[c4ac66804f8a]

	* src/pop3/client.c:
	don't crash to errors
	[863fbe16e395]

	* src/lib-index/mail-index-sync.c:
	don't crash with assert if transacton log has expunge with seq 0
	[9c2c31893775]

	* src/pop3/client.c:
	index wasn't unlocked initially
	[01d2eb10a1c9]

	* src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-log.h, src/lib-storage/index/index-transaction.c, src
	/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/mbox/mbox-sync.c:
	When committing with no changes, don't try to sync them later.
	[2e77ee652e2e]

	* src/lib-index/mail-transaction-log.c:
	some minor fixes
	[23959140f4f5]

2004-05-10  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	Don't require initializing RAND_bytes() to return cryptographically
	strong data.
	[3dd9d3165bff]

	* src/pop3/commands.c:
	Message deletion deleted wrong messages
	[e97b7b1b2a1e]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	removed assert, that can happen in valid situations
	[13f8765f08c9]

	* src/lib-index/mail-transaction-log.c:
	some fixes
	[2ab29071a32c]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	sync fix
	[d1a2c2ae7226]

	* src/imap/main.c:
	removed debugging
	[3b1e6485704d]

	* src/imap/cmd-subscribe.c:
	fix
	[1f17e37607fd]

	* src/auth/main.c, src/imap/main.c, src/lib/failures.c,
	src/lib/failures.h, src/login-common/main.c, src/master/Makefile.am,
	src/master/auth-process.c, src/master/common.h, src/master/log.c,
	src/master/log.h, src/master/login-process.c, src/master/mail-
	process.c, src/master/main.c, src/master/master-settings.c,
	src/master/master-settings.h, src/pop3/main.c:
	Write all logging through master process. Fixes problems with log
	rotation, chrooting, etc. Master process also allows max. 10 log
	messages per second per child process, it then begins throttling
	them (eventually making the child process start blocking on stderr).
	[c7c19f5071c3]

	* src/lib-storage/index/mbox/istream-raw-mbox.c:
	fix
	[8f0e6d457239]

	* README:
	Updated RFC list
	[7c9e02c14f8e]

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c,
	src/master/login-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Added ssl_verify_client_cert setting.
	[1d0985f6bdd9]

	* dovecot-example.conf, src/login-common/ssl-proxy-openssl.c,
	src/master/login-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Added ssl_cipher_list setting.
	[d8f06a0c818e]

	* AUTHORS, configure.in, doc/Makefile.am, doc/dovecot-mysql.conf,
	src/auth/Makefile.am, src/auth/db-mysql.c, src/auth/db-mysql.h,
	src/auth/passdb-mysql.c, src/auth/passdb.c, src/auth/passdb.h,
	src/auth/userdb-mysql.c, src/auth/userdb.c, src/auth/userdb.h:
	MySQL authentication patch by Matther Reimer
	[cc64f8bb4716]

	* src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c:
	Fixes to commands after mails have been deleted. Patch by Nic
	Bellamy.
	[77f3111f7976]

	* src/master/master-settings.c:
	show error if config is missing auth section
	[719228a4df3f]

	* src/lib/data-stack.c:
	allow using data stack without data_stack_init().
	[63e67430b580]

	* src/lib-charset/charset-iconv.c:
	iconv_t isn't necessarily pointer.
	[689f791b480f]

	* configure.in:
	fix
	[049502ef137e]

	* configure.in, src/lib/lib.h:
	Define PREAD_WRAPPERS if we're using GLIBC, not if we're using
	Linux. Removed a few ANSI-C header checks. Added strings.h check and
	include it automatically if it's found, for strcasecmp().
	[a2b009c65e02]

	* src/lib-index/mail-index-view-sync.c, src/lib-storage/index/maildir
	/maildir-sync.c, src/lib-storage/index/maildir/maildir-uidlist.c,
	src/lib-storage/index/maildir/maildir-uidlist.h:
	syncing fixes
	[739b469b99e2]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-uidlist.c,
	src/lib-storage/index/mbox/mbox-storage.c, src/lib-storage
	/subscription-file/subscription-file.c, src/lib-storage
	/subscription-file/subscription-file.h:
	maildir: don't use ".temp" prefix for temporary files, since in
	~/Maildir they conflict with mailbox namespace.
	[3b1f8ed213ca]

	* dovecot-example.conf:
	s/custom flags/keywords/
	[7ac0ef106427]

	* src/lib-index/mail-index-view.c, src/lib-storage/index/index-
	search.c:
	don't crash when requesting messages from empty mailbox
	[3ccd4eb52ee4]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	private.h, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index-view-sync.c, src/lib-index/mail-index.c, src/lib-storage/index
	/index-sync.c, src/lib-storage/index/maildir/maildir-sync.c, src
	/lib-storage/index/maildir/maildir-uidlist.c, src/lib-
	storage/index/maildir/maildir-uidlist.h:
	syncing fixes
	[9c159272f721]

	* src/lib-storage/index/mbox/mbox-lock.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-sync-parse.c, src
	/lib-storage/index/mbox/mbox-sync-private.h, src/lib-
	storage/index/mbox/mbox-sync-rewrite.c, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/index/mbox/mbox-sync.c:
	mbox growing and locking works now
	[933cab442392]

2004-05-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-sync-header.c:
	this isn't needed
	[6985631ac6eb]

	* src/lib-storage/index/mbox/istream-raw-mbox.c, src/lib-
	storage/index/mbox/istream-raw-mbox.h, src/lib-storage/index/mbox
	/mbox-sync-parse.c, src/lib-storage/index/mbox/mbox-sync-private.h,
	src/lib-storage/index/mbox/mbox-sync-rewrite.c, src/lib-
	storage/index/mbox/mbox-sync-update.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	mbox rewriting is almost working - the hard part is done.
	[eb282832fc75]

	* src/lib-mail/message-parser.c:
	If value of header contains only LWSP, return all LWSP instead of
	returning just empty value.
	[ab4fbb7727ec]

2004-05-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-mail.c, src/lib-storage/index/mbox
	/mbox-sync.c:
	Some mbox fixes. Kind of works now.
	[a4850e1c56f7]

	* configure.in, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-mail.h, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-list.c, src/lib-storage/index/maildir/maildir-mail.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h,
	src/lib-storage/index/mbox/Makefile.am, src/lib-storage/index/mbox
	/istream-raw-mbox.c, src/lib-storage/index/mbox/istream-raw-mbox.h,
	src/lib-storage/index/mbox/mbox-expunge.c, src/lib-
	storage/index/mbox/mbox-file.c, src/lib-storage/index/mbox/mbox-
	file.h, src/lib-storage/index/mbox/mbox-from.c, src/lib-
	storage/index/mbox/mbox-from.h, src/lib-storage/index/mbox/mbox-
	list.c, src/lib-storage/index/mbox/mbox-lock.c, src/lib-
	storage/index/mbox/mbox-lock.h, src/lib-storage/index/mbox/mbox-
	mail.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/index/mbox/mbox-sync-parse.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-rewrite.c, src/lib-storage/index/mbox/mbox-sync.c, src
	/lib-storage/index/mbox/mbox-transaction.c:
	mbox code compiles again, but syncing is only partially implemented
	so accessing mboxes fails..

	Also some cleanups to index-storage and maildir code.
	[6303ef092c5b]

2004-05-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-sync.c:
	error message change
	[ab2f615e0ce8]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log.c, src/lib-index/mail-transaction-log.h:
	Don't rotate transaction log too often
	[4e0269adb24a]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	sync fix
	[be0269b8e2d4]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log.c, src/lib-storage/index/maildir/maildir-uidlist.c,
	src/lib-storage/subscription-file/subscription-file.c, src/lib/file-
	dotlock.c, src/lib/file-dotlock.h:
	file_dotlock_open/delete/replace now has lock_suffix parameter. NULL
	defaults to ".lock".

	Fixed dotlocking transaction log.
	[d85f71ffeb8f]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	and yet more syncing fixes..
	[f6d2dba3b78b]

2004-05-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-sync-
	update.c:
	fixes for fcntl_locks_disable = yes
	[137ed22eb749]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	sync fix
	[e7244b4dd03c]

	* src/lib-storage/index/maildir/maildir-sync.c:
	When moving mails to cur/, we must add the ":2," part to filename.
	[0f4c4a043be1]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Create .INBOX/ to index directory, if it's different.
	[570587f42d29]

	* src/login-common/ssl-proxy-gnutls.c:
	Fixed to compile with GNUTLS 1.0. Patch by Jaldhar H. Vyas.
	[f23cbc64cef4]

	* src/imap/main.c, src/lib-index/mail-index.c, src/lib-index/mail-
	transaction-log.c, src/lib-storage/index/index-storage.c:
	memory leak fixes
	[b6d900688c55]

	* src/lib-index/mail-index.h:
	comment update
	[ee995fdad8da]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index.c, src/lib-index/mail-index.h:
	INDEX_KEYWORDS_BYTE_COUNT was counted wrong so index files were
	larger than they needed to be. Added sizeof(keywords_mask_t) to
	compat_data. Added limit to growing index file exponentially.
	[41f6a04154a3]

	* src/lib-index/mail-transaction-log.c:
	mail_transaction_log_append() - return seq/offset even if we didn't
	write anything
	[8e0cc5b87eab]

	* src/imap/imap-fetch-body-section.c:
	don't access uninitialized memory
	[db06a387ef1a]

	* src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c:
	Syncing should be fixed now.
	[4775ffa73874]

	* src/lib-index/maildir/.cvsignore, src/lib-index/mbox/.cvsignore:
	removed
	[79a701e60f87]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	crashfix
	[b9ea4db3f8e0]

2004-05-02  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/imap/main.c, src/master/mail-process.c, src/master
	/master-settings.c, src/master/master-settings.h:
	and a few more custom flag -> keyword changes
	[50e24ce4f9c3]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-select.c, src/imap/cmd-store.c, src/imap/commands-
	util.c, src/imap/commands-util.h, src/imap/common.h, src/imap/mail-
	storage-callbacks.c, src/imap/main.c, src/lib-imap/imap-util.c, src
	/lib-imap/imap-util.h, src/lib-index/mail-index-sync-update.c, src
	/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	transaction.c, src/lib-index/mail-index-view-sync.c, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log.h, src/lib-mail
	/mail-types.h, src/lib-storage/index/index-fetch.h, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-search.c,
	src/lib-storage/index/index-status.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-sync-private.h, src/lib-storage/index/mbox
	/mbox-sync-update.c, src/lib-storage/mail-storage-private.h, src
	/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h, src
	/lib-storage/proxy-mailbox.c, src/pop3/mail-storage-callbacks.c:
	s/custom flags/keywords/
	[4dec6a3d79fd]

	* src/lib-index/mail-index-sync.c:
	comment
	[d77a2a1e9278]

	* src/lib-index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-
	index/mail-index-sync-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index.h, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/maildir/maildir-sync.c:
	Added support for setting dirty flags for messages (TODO: undirty..)

	s/mail_index_record_flag/mail_cache_record_flag/
	[d6941cd8afdc]

	* src/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-sync.c:
	More syncing changes
	[0f0128b4af5d]

	* src/lib-index/mail-index-sync-private.h, src/lib-index/mail-index-
	sync-update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-
	index.h, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h:
	Syncing optimizations.
	[2f6e137cdc44]

	* src/imap/imap-fetch-body-section.c:
	Add CRLF to end of FETCH BODY[HEADER.FIELDS (...)] always.
	[a1c00aa3a078]

	* src/lib-index/mail-transaction-log-view.c, src/lib-index/mail-
	transaction-log.c:
	Don't crash in assert() with corrupted index file.
	[05f76fe32f0d]

	* src/imap/cmd-subscribe.c, src/lib-storage/index/maildir/maildir-
	list.c:
	fixes
	[47f3a846b769]

	* src/pop3/commands.c:
	crashfix
	[c4d246aad338]

2004-05-01  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	Don't advertise AUTH=PLAIN unless transport is secure
	[d2755efdd187]

	* configure.in:
	Default to OpenSSL
	[7fa8697bc2a9]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/maildir/maildir-mail.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h,
	src/lib-storage/index/maildir/maildir-util.c:
	Recent-flag should work now
	[777da553d1d3]

	* src/lib-index/mail-index.c:
	syncing fix
	[dbec6c9dbffa]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h:
	cleanup
	[268a4096e8be]

	* src/lib-index/Makefile.am, src/lib-index/mail-index-private.h, src
	/lib-index/mail-index-reset.c, src/lib-index/mail-index.h, src/lib-
	storage/index/maildir/maildir-sync.c:
	remove mail_index_reset() completely
	[5a3c3b4d4a02]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-lock.c,
	src/lib-index/mail-index-private.h, src/lib-index/mail-index-
	reset.c, src/lib-index/mail-index.c:
	missing index file fixes
	[e473d2df21be]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-reset.c, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c, src/lib-index/mail-transaction-log-
	view.c, src/lib-index/mail-transaction-log.c, src/lib-index/mail-
	transaction-log.h:
	handle losing index file
	[2b114aa7eeec]

	* src/lib-index/mail-index-sync.c, src/lib-index/mail-index-view-
	sync.c, src/lib-index/mail-transaction-log-view.c, src/lib-index
	/mail-transaction-log.c, src/lib-index/mail-transaction-log.h:
	automatically fix broken/missing transaction log files on the fly
	[ced8e41c137a]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync.c, src/lib-index/mail-index-view-
	private.h, src/lib-index/mail-index-view-sync.c, src/lib-index/mail-
	index-view.c, src/lib-index/mail-transaction-log-view.c, src/lib-
	index/mail-transaction-log.c, src/lib-index/mail-transaction-log.h,
	src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/index/maildir/maildir-uidlist.c:
	fixes
	[876bd2849a00]

2004-04-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	changes
	[4698c121bae3]

2004-04-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-private.h:
	recent fixes
	[a2eaa322ca8c]

	* src/lib-index/mail-index-sync-update.c, src/lib-index/mail-
	transaction-log.c:
	Ignore new mail appends if they're already in transaction log.
	[f56d502b248b]

	* src/lib-index/mail-transaction-log.c:
	assert
	[bb1bde2680b0]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index.c, src
	/lib-index/mail-transaction-log-view.c, src/lib-index/mail-
	transaction-log.c, src/lib-index/mail-transaction-log.h:
	Don't modify index file when creating new transaction log.
	[ec4d5ff99f6e]

	* src/lib-storage/index/maildir/maildir-uidlist.c:
	make sure we unlock uidlist
	[08159fcf9eb8]

	* src/lib-index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c, src
	/lib-index/mail-transaction-util.c:
	fixes for mmap_disable
	[bfdff8c75965]

	* src/lib-index/mail-transaction-log.c:
	fix
	[f04ff2a2ad5d]

	* src/lib-storage/index/index-sync.c, src/lib-storage/index/maildir
	/maildir-uidlist.c:
	fixes
	[35a947481130]

2004-04-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync-update.c, src/lib-index/mail-index.c,
	src/lib-storage/index/index-storage.c:
	fixes
	[8f31c6dae363]

	* src/lib/read-full.c, src/lib/write-full.c:
	whops, retrying was broken
	[e1443315294c]

	* src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c:
	when growing index file, do it exponentially for this session (files
	being added one at a time).
	[5ca676060080]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-transaction-log.c:
	some more locking fixes
	[7ad1a47c615e]

	* src/imap/imap-fetch.c:
	BYE if trying to fetch body[] of expunged message.
	[982bd89b42fd]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-private.h,
	src/lib-index/mail-index-sync.c, src/lib-index/mail-index.c:
	locking fixes, sync fix
	[e3fa34df2263]

	* configure.in:
	Put -lcrypt to first in AUTH_LIBS to fix some linking problems with
	Solaris
	[4dbe61f1aea6]

	* src/lib-index/mail-index-view-private.h, src/lib-index/mail-index-
	view.c:
	cleanup
	[fb656c936c47]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-lock.c,
	src/lib-index/mail-index-private.h, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index-sync.c, src/lib-index/mail-index-
	view.c, src/lib-index/mail-transaction-log-view.c, src/lib-index
	/mail-transaction-log.c, src/lib-index/mail-transaction-util.c:
	Locking changes. bugfixes.
	[e4c30cb5d094]

	* src/lib-index/mail-index-lock.c:
	whops, was unfinished
	[e28999e74a12]

	* dovecot-example.conf, src/lib-index/mail-index-lock.c, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-index/mail-transaction-log-private.h, src
	/lib-index/mail-transaction-log.c, src/lib-storage/index/index-
	storage.c, src/master/mail-process.c, src/master/master-settings.c,
	src/master/master-settings.h:
	Added fcntl_lock_disable setting to allow indexes to work with NFS.
	Some other locking fixes.
	[d11efbf1d341]

	* src/lib-index/mail-index-lock.c, src/lib-index/mail-index-sync-
	update.c, src/lib-index/mail-index.c, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c:
	locking fixes, mmap_disable=yes fixes
	[4aeb7357951a]

	* dovecot-example.conf:
	updated for mmap changes
	[ef89efba1838]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-select.c,
	src/imap/cmd-status.c, src/imap/common.h, src/imap/imap-search.h,
	src/imap/main.c, src/lib-index/mail-index-lock.c, src/lib-index
	/mail-index-private.h, src/lib-index/mail-index-reset.c, src/lib-
	index/mail-index-sync-update.c, src/lib-index/mail-index-sync.c, src
	/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index-view-private.h, src
	/lib-index/mail-index-view-sync.c, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-transaction-log.c, src/lib-storage/index/index-search.c,
	src/lib-storage/index/index-status.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/maildir/maildir-sync.c, src/lib-
	storage/mail-storage.h, src/master/mail-process.c, src/master
	/master-settings.c, src/master/master-settings.h, src/pop3/client.c:
	Forced locking to be right with mprotect()ing index file. Support
	for disabling mmap for indexes, and disabling just mmap+write().
	[68938dccbc45]

	* src/lib-storage/index/index-mail.c:
	from_envelope crashfix..
	[01bce69ac1b4]

2004-04-27  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/imap/client.c, src/imap/cmd-
	append.c, src/imap/cmd-close.c, src/imap/cmd-copy.c, src/imap/cmd-
	create.c, src/imap/cmd-delete.c, src/imap/cmd-expunge.c, src/imap
	/cmd-fetch.c, src/imap/cmd-idle.c, src/imap/cmd-list.c, src/imap
	/cmd-logout.c, src/imap/cmd-rename.c, src/imap/cmd-search.c,
	src/imap/cmd-select.c, src/imap/cmd-sort.c, src/imap/cmd-status.c,
	src/imap/cmd-store.c, src/imap/cmd-subscribe.c, src/imap/cmd-
	thread.c, src/imap/cmd-unselect.c, src/imap/commands-util.c,
	src/imap/imap-expunge.c, src/imap/imap-expunge.h, src/imap/imap-
	fetch-body-section.c, src/imap/imap-fetch.c, src/imap/imap-fetch.h,
	src/imap/imap-messageset.c, src/imap/imap-messageset.h, src/imap
	/imap-search.c, src/imap/imap-search.h, src/imap/imap-sort.c,
	src/imap/imap-thread.c, src/imap/mail-storage-callbacks.c,
	src/imap/namespace.c, src/lib-imap/imap-util.c, src/lib-imap/imap-
	util.h, src/lib-index/Makefile.am, src/lib-index/mail-cache-
	compress.c, src/lib-index/mail-cache-lookup.c, src/lib-index/mail-
	cache-old.c, src/lib-index/mail-cache-private.h, src/lib-index/mail-
	cache-transaction.c, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-index/mail-index-fsck.c, src/lib-index/mail-index-
	lock.c, src/lib-index/mail-index-private.h, src/lib-index/mail-
	index-reset.c, src/lib-index/mail-index-sync-private.h, src/lib-
	index/mail-index-sync-update.c, src/lib-index/mail-index-sync.c, src
	/lib-index/mail-index-transaction-private.h, src/lib-index/mail-
	index-transaction.c, src/lib-index/mail-index-view-private.h, src
	/lib-index/mail-index-view-sync.c, src/lib-index/mail-index-view.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-transaction-log-private.h, src/lib-index/mail-
	transaction-log-view.c, src/lib-index/mail-transaction-log.c, src
	/lib-index/mail-transaction-log.h, src/lib-index/mail-transaction-
	util.c, src/lib-index/mail-transaction-util.h, src/lib-
	index/maildir/Makefile.am, src/lib-index/mbox/Makefile.am, src/lib-
	mail/Makefile.am, src/lib-mail/mail-types.h, src/lib-mail/message-
	parser.c, src/lib-mail/message-parser.h, src/lib-
	storage/Makefile.am, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/index-copy.c, src/lib-storage/index/index-expunge.c,
	src/lib-storage/index/index-expunge.h, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-mail-headers.c, src/lib-
	storage/index/index-mail.c, src/lib-storage/index/index-mail.h, src
	/lib-storage/index/index-mailbox-check.c, src/lib-storage/index
	/index-messageset.c, src/lib-storage/index/index-messageset.h, src
	/lib-storage/index/index-search.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/index-transaction.c, src/lib-storage/index
	/index-update-flags.c, src/lib-storage/index/maildir/Makefile.am,
	src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-expunge.c, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/maildir
	/maildir-mail.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/maildir/maildir-sync.c, src/lib-storage/index/maildir
	/maildir-transaction.c, src/lib-storage/index/maildir/maildir-
	uidlist.c, src/lib-storage/index/maildir/maildir-uidlist.h, src/lib-
	storage/index/maildir/maildir-util.c, src/lib-
	storage/index/mbox/Makefile.am, src/lib-storage/index/mbox/istream-
	raw-mbox.c, src/lib-storage/index/mbox/istream-raw-mbox.h, src/lib-
	storage/index/mbox/mbox-expunge.c, src/lib-storage/index/mbox/mbox-
	from.c, src/lib-storage/index/mbox/mbox-from.h, src/lib-
	storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-sync-header.c, src/lib-
	storage/index/mbox/mbox-sync-parse.c, src/lib-storage/index/mbox
	/mbox-sync-private.h, src/lib-storage/index/mbox/mbox-sync-
	rewrite.c, src/lib-storage/index/mbox/mbox-sync-update.c, src/lib-
	storage/index/mbox/mbox-sync.c, src/lib-storage/mail-save.c, src
	/lib-storage/mail-save.h, src/lib-storage/mail-search.h, src/lib-
	storage/mail-storage-private.h, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h, src/lib-storage/proxy-mail-storage.c,
	src/lib-storage/proxy-mail-storage.h, src/lib-storage/proxy-mail.c,
	src/lib-storage/proxy-mailbox.c, src/lib-storage/proxy-mailbox.h,
	src/lib-storage/register/Makefile.am, src/lib-storage/subscription-
	file/Makefile.am, src/lib-storage/subscription-file/subscription-
	file.c, src/lib-storage/subscription-file/subscription-file.h,
	src/lib/Makefile.am, src/lib/compat.h, src/lib/file-dotlock.c,
	src/lib/file-lock.c, src/lib/istream-data.c, src/lib/istream-file.c,
	src/lib/istream-limit.c, src/lib/istream-mmap.c, src/lib/macros.h,
	src/lib/network.c, src/lib/read-full.c, src/lib/read-full.h, src/lib
	/write-full.c, src/lib/write-full.h, src/pop3/client.c,
	src/pop3/commands.c, src/pop3/mail-storage-callbacks.c:
	importing new index code. mbox still broken.
	[79790750c349]

	* src/lib-index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-
	index/mail-custom-flags.c, src/lib-index/mail-custom-flags.h, src
	/lib-index/mail-index-file.c, src/lib-index/mail-index-fsck.c, src
	/lib-index/mail-index-open.c, src/lib-index/mail-index-rebuild.c,
	src/lib-index/mail-index-util.c, src/lib-index/mail-index-util.h,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-modifylog.c, src/lib-index/mail-modifylog.h, src/lib-
	index/maildir/maildir-build.c, src/lib-index/maildir/maildir-
	clean.c, src/lib-index/maildir/maildir-expunge.c, src/lib-
	index/maildir/maildir-index.c, src/lib-index/maildir/maildir-
	index.h, src/lib-index/maildir/maildir-open.c, src/lib-index/maildir
	/maildir-sync.c, src/lib-index/maildir/maildir-uidlist.c, src/lib-
	index/maildir/maildir-uidlist.h, src/lib-index/maildir/maildir-
	update-flags.c, src/lib-index/mbox/istream-mbox.c, src/lib-
	index/mbox/mbox-append.c, src/lib-index/mbox/mbox-from.c, src/lib-
	index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-
	index/mbox/mbox-lock.c, src/lib-index/mbox/mbox-lock.h, src/lib-
	index/mbox/mbox-open.c, src/lib-index/mbox/mbox-rewrite.c, src/lib-
	index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c:
	removed out of the way of new index code
	[1f156d653f4a]

	* src/auth/db-pgsql.c, src/auth/db-pgsql.h, src/auth/passdb-pgsql.c,
	src/auth/userdb-pgsql.c:
	Use PQescapeString() instead of str_escape()
	[be667b9f4605]

2004-04-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/mail-storage.c:
	"Internal error" message changed.
	[e27ec44c0d53]

	* dovecot-example.conf:
	typofix
	[ac810e95cdd6]

	* src/auth/db-ldap.c, src/auth/db-ldap.h:
	Patch by Quentin Garnier:

	1. Change default value for 'hosts' to NULL instead of 'localhost'.
	That way, libldap will choose the default list of server as
	specified in OpenLDAP's ldap.conf configuration file.

	2. Add a new configuration stance, 'uris', which you can set to a
	list of URIs that will be passed directly to libldap, which
	understands them.
	[b9005f93be70]

	* src/imap/imap-fetch-body-section.c:
	Fixes for fetching BODY[n], patch by Rick Jones
	[a3a6b702c766]

2004-01-23  Timo Sirainen  <tss@iki.fi>

	* INSTALL:
	updates about running it
	[0615c22cbda5]

2004-01-19  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c, src/master/login-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added setting ssl_ca_file, patch by Zach Bagnall
	[190f1d315ce6]

2004-01-06  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	LIST: If reference parameter is given, get the namespace from it.
	[956232f5706c]

	* src/lib/mempool.h:
	pool_unref(x): don't set (x) = NULL, it may have been allocated from
	the pool that was just freed.
	[45a656ec68a1]

	* src/auth/mech-digest-md5.c:
	removed unused trim() function
	[00cc093bb85f]

	* src/auth/mech-digest-md5.c:
	Remove service type checking from given URI. It was hardcoded to
	IMAP, but we would also want it to work with POP3. Also some clients
	seemed to use something else as imap there..
	[3136aa09df05]

	* src/lib-storage/proxy-mail-storage.c:
	don't return values from void function
	[ee8fb7ab106f]

2003-12-25  Timo Sirainen  <tss@iki.fi>

	* Makefile.am:
	COPYING.MIT missing
	[f59cd148bdfe]

2003-12-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-auth/auth-server-request.c:
	compiling fix
	[e3af1cf293ac]

2003-12-03  Timo Sirainen  <tss@iki.fi>

	* src/lib/hash.c:
	bugfix
	[1bfe23d94647]

	* src/lib/hash.c:
	cleanup
	[54e60d63a942]

	* src/auth/auth-client-connection.c, src/auth/db-ldap.c, src/imap-
	login/client.c, src/imap/imap-thread.c, src/lib-index/maildir
	/maildir-sync.c, src/lib/hash.c, src/lib/hash.h, src/login-common
	/ssl-proxy-gnutls.c, src/login-common/ssl-proxy-openssl.c,
	src/master/auth-process.c, src/master/login-process.c,
	src/pop3-login/client.c:
	Changed hash_foreach() to iterator.
	[1e6ed8045f2b]

2003-12-01  Timo Sirainen  <tss@iki.fi>

	* src/lib/fdpass.c:
	warning fixes
	[0613ad9d5034]

2003-11-25  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	LSUB should never show \HasChildren flags.
	[bbdce1697239]

	* src/imap-login/client-authenticate.c, src/pop3-login/client-
	authenticate.c:
	IMAP AUTHENTICATE and POP3 AUTH commands could have left the process
	stuck doing nothing forever.
	[07324c0d1d0a]

2003-11-21  Timo Sirainen  <tss@iki.fi>

	* doc/mkcert.sh:
	write dovecot.pem, not imapd.pem files.
	[3f85a4b7880e]

2003-11-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/subscription-file/subscription-file.c:
	Bugfixes
	[e34c62503933]

	* src/lib-mail/message-send.c:
	message_skip_virtual() calculated returned msg_size wrong. This
	could have caused some problems with partial body fetches.
	[118ed97bd25a]

2003-11-17  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	Children/NoChildren -> HasChildren/HasNoChildren
	[66e5fdc07ac5]

2003-11-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-from.c:
	We didn't skip space between year and potential timezone
	[9ca9f997f0c6]

2003-11-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-sync-full.c:
	don't break if uidvalidity changes + cleanup
	[4c94ab0ff8de]

	* src/lib-index/mail-index.c:
	update lock counters with in-memory indexes too
	[75d86ebb844e]

	* src/master/master-settings.c:
	Always give error if flock is used with a system where it's not
	supported. The check was actually checking fcntl before..
	[de4b5d7ec9b2]

	* src/lib-index/mbox/istream-mbox.c, src/lib-index/mbox/mbox-sync-
	full.c:
	fixes
	[f901e8b9d2e3]

	* src/lib-storage/index/mbox/mbox-storage.c:
	If mbox wasn't indexed yet when it was being renamed, an extra error
	message was logged.
	[61b80f9e6d87]

2003-11-12  Timo Sirainen  <tss@iki.fi>

	* src/lib/istream-file.c, src/lib/istream-mmap.c:
	cleanups
	[aa2341461620]

2003-11-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-sync-
	full.c:
	Fixed "LF not found where expected" error happening in some
	conditions.
	[01a83df6c232]

	* src/lib-mail/message-parser.c:
	wrong fix, reverted plus a cleanup..
	[841087a35d3e]

	* src/lib-mail/message-parser.c:
	When parsing message with CRLF headers, we stopped after CRLFCR
	instead of CRLFCRLF.
	[fe922b90ef08]

	* doc/auth.txt, dovecot-example.conf, src/auth/mech-cram-md5.c,
	src/auth/passdb.c, src/auth/password-scheme-cram-md5.c, src/auth
	/password-scheme.c:
	cram-md5 updates.
	[6d37e8554dbb]

2003-11-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-body-search.c:
	istream fix
	[435e7fc5093f]

	* src/lib-index/mbox/mbox-append.c:
	fix
	[9bbe17257bba]

	* src/auth/mech-cram-md5.c:
	Don't treat data as NUL-terminated string.
	[445fc3dfecad]

	* src/lib-index/mbox/mbox-rewrite.c:
	fix
	[c901f6afdc8d]

	* src/lib/istream-limit.c, src/lib/istream.c:
	fixes
	[4bff66d9b834]

	* src/auth/Makefile.am, src/auth/auth-client-interface.h, src/auth
	/auth-mech-desc.h, src/auth/md5crypt.c, src/auth/md5crypt.h,
	src/auth/mech-cram-md5.c, src/auth/mech-digest-md5.c,
	src/auth/mech.c, src/auth/passdb.c, src/auth/passdb.h, src/auth
	/password-scheme-cram-md5.c, src/auth/password-scheme-md5crypt.c,
	src/auth/password-scheme.c, src/auth/password-scheme.h:
	CRAM-MD5 mechanism by Joshua Goodall, plus some cleanups.
	[ed5e808d934f]

	* src/lib-storage/index/index-messageset.c:
	cleanup
	[f83bf8214723]

2003-11-09  Timo Sirainen  <tss@iki.fi>

	* src/lib/network.c:
	net_set_nonblock(): don't replace flags in fd, change the existing
	ones
	[638944ab7753]

	* src/imap/cmd-append.c, src/lib-index/mbox/istream-mbox.c, src/lib-
	index/mbox/mbox-append.c, src/lib-index/mbox/mbox-index.c, src/lib-
	index/mbox/mbox-index.h, src/lib-index/mbox/mbox-open.c, src/lib-
	index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync-full.c, src
	/lib-mail/message-body-search.c, src/lib-storage/index/mbox/mbox-
	expunge.c, src/lib-storage/mail-save.c, src/lib/Makefile.am, src/lib
	/iostream-internal.h, src/lib/istream-data.c, src/lib/istream-
	file.c, src/lib/istream-internal.h, src/lib/istream-limit.c, src/lib
	/istream-mmap.c, src/lib/istream.c, src/lib/istream.h, src/lib
	/ostream-file.c:
	istream rewrite. instead of directly setting any limits to stream,
	you now have to use i_stream_create_limit() to existing stream. this
	should make the istreams much easier to create and understand how
	they work.
	[c972ea085643]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index.c:
	type fixes
	[39d0548792d8]

2003-11-08  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body-section.c:
	cleanups and fix for partial header fetching
	[e014a9df5fa6]

	* src/imap/imap-fetch-body-section.c, src/lib-mail/message-send.c, src
	/lib-mail/message-send.h:
	message_send()'s skip parameter was buggy with messages having CRLF.
	[d9d05fc3c905]

	* src/pop3/capability.h:
	Advertise PIPELINING capability
	[c6d327242fa6]

	* configure.in:
	cleanup
	[a0de7b3f133c]

	* doc/Makefile.am:
	securecoding.txt missing
	[b012ed1ab7e1]

	* src/lib/compat.c:
	whops, too many changes
	[d2f729d6f1e2]

	* src/lib/compat.c:
	pread/pwrite fixes
	[3b25ea70b500]

2003-11-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-index.c,
	src/lib-index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync-
	full.c, src/lib-mail/message-send.c, src/lib-storage/index/mbox
	/mbox-expunge.c, src/lib/istream-file.c, src/lib/istream-mmap.c,
	src/lib/istream.c, src/lib/istream.h, src/lib/ostream-file.c:
	Added istream->eof. istream->v_size is now set to 0 with files.
	[e42d97a85653]

	* src/lib-index/mail-index.h, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-index/mbox/mbox-sync-full.c:
	we didn't sync mbox again after rewriting which left us broken mail
	offsets.
	[8da9b7748bd4]

2003-11-04  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-store.c:
	STORE .. FLAGS.SILENT will now return flags anyway if mailbox is
	read-only.
	[8636c61b3b5a]

2003-10-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c:
	fixes
	[f59f0c50f018]

	* src/lib-index/mbox/istream-mbox.c:
	fixes
	[34bdf8beb23a]

	* src/lib-index/mbox/mbox-sync-full.c:
	fix
	[ef870406de53]

	* src/lib-index/mbox/istream-mbox.c:
	fix
	[56cec02d8f8c]

	* src/lib-index/mbox/istream-mbox.c, src/lib/istream-file.c:
	fix
	[d4a2788f5fa6]

	* src/lib/istream.c:
	cleanup
	[0fd7dbda6704]

	* src/lib/compat.c, src/lib/compat.h:
	more kludgeing to get pread/pwrite working
	[29729fa90bb2]

	* configure.in, src/auth/Makefile.am, src/auth/passdb-bsdauth.c,
	src/auth/passdb.c, src/auth/passdb.h:
	Added bsdauth support, patch by Dan Cross
	[d66d53f57e43]

	* src/lib-storage/mail-save.c:
	removed debugging
	[e19d3d8632b7]

	* configure.in, src/lib-index/mail-cache.c, src/lib/compat.c,
	src/lib/compat.h, src/lib/istream-file.c:
	pread/pwrite fixes
	[83c635deda0b]

	* src/lib-index/mbox/istream-mbox.c, src/lib-index/mbox/mbox-index.c,
	src/lib-storage/mail-save.c:
	Fixes to make copying mail inside same mbox working.
	[8222937d4434]

	* src/lib/istream-file.c:
	Changed to use pread() with files.
	[920307c42b17]

	* src/lib/istream.c:
	reset stream_errno
	[f5d7407d33a0]

2003-10-26  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-copy.c, src/imap/cmd-search.c, src/imap/cmd-store.c,
	src/imap/imap-fetch.c, src/imap/imap-fetch.h, src/imap/imap-
	search.c, src/imap/imap-search.h, src/imap/imap-sort.c, src/imap
	/imap-thread.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.h,
	src/lib-storage/proxy-mailbox.c, src/pop3/client.c,
	src/pop3/commands.c:
	Removed fetch_init/fetch_next from mail-storage. search_* makes it
	unnecessary
	[bd8b6ed35327]

	* src/lib-storage/index/index-messageset.c, src/lib-storage/index
	/index-messageset.h, src/lib-storage/index/index-search.c, src/lib-
	storage/mail-search.c, src/lib-storage/mail-search.h:
	Some optimizations to messageset handling in search.
	[4c2678dd65f1]

	* src/lib-index/mail-index.c:
	minor optimization
	[03f4b7b2641d]

	* src/imap/cmd-copy.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage.h, src/lib-storage
	/proxy-mail.c:
	Moved copy() method from struct mail to struct mailbox - the context
	parameter makes sense only to destination mailbox handler.
	[b2ceea02ba60]

	* src/lib-index/mail-cache.c:
	cleanup
	[31e628d88253]

	* src/lib-index/mail-cache.c:
	missing t_pop()
	[cbe06afc6455]

	* src/lib/buffer.c, src/lib/buffer.h, src/lib/str.c, src/lib/str.h:
	Use unsigned char for buffer_append_c and str_append_c.
	[364b1e992154]

2003-10-23  Timo Sirainen  <tss@iki.fi>

	* src/lib/strfuncs.c:
	p_strndup() read str[max_chars] byte - could have possibly crashed
	in some rare conditions
	[6e834ae1da0e]

2003-10-21  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	Don't request empty headers
	[b730eeca8861]

	* src/lib-storage/index/index-mail-headers.c:
	assert
	[36ae8c2e5791]

	* src/lib-index/mail-cache.c:
	header fix
	[3dac992e11e0]

	* src/lib/ostream-file.c:
	removed unused #include
	[6cfa2a123b7e]

	* src/lib-storage/index/index-mail-headers.c:
	Don't save empty header lists
	[d951d5b883ec]

	* src/lib-index/mail-cache.c:
	assert
	[fece302386f4]

	* src/lib-index/mail-cache.c:
	compression could have broken header lists
	[e018d6b0a3df]

	* src/lib-index/mail-cache.c, src/lib-storage/index/index-mail-
	headers.c:
	Some cleanups and extra checks to detect if header names list gets
	duplicated (can happen, why?..)
	[27cc6681ea3e]

2003-10-20  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-digest-md5.c:
	recent change broke it
	[19e1ec244752]

	* src/lib-storage/index/maildir/maildir-storage.c:
	mail_create_mode was set too late.
	[7df3a022ef7d]

	* src/lib-storage/index/maildir/maildir-storage.c:
	fix
	[b1acbfe2a7ed]

	* src/lib-storage/index/maildir/maildir-storage.c:
	crashfix
	[a8f433bcffce]

	* src/lib-index/mail-index.h, src/lib-index/maildir/maildir-uidlist.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib/file-dotlock.c:
	fixed dovecot-uidlist permissions for shared mailboxes
	[ffd430238c32]

	* src/lib-index/mail-index.h, src/lib-index/maildir/maildir-index.c,
	src/lib-index/maildir/maildir-index.h, src/lib-index/maildir
	/maildir-sync.c, src/lib-index/maildir/maildir-update-flags.c, src
	/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c:
	If maildir contains dovecot-shared file Dovecot does two things
	differently: it allows some flags to be private and stored only in
	index file (currently hardcoded to \Seen flag only) and new mails
	are created with dovecot-shared file's mode & 0666. So if you set
	filesystem permissions correctly, you should have fully functioning
	shared mailboxes.
	[1acb38d177cf]

	* src/lib/strfuncs.c:
	If input is empty, return only list with NULL.
	[cf9fa86e2a91]

	* src/lib-index/mail-cache.c, src/lib-index/maildir/maildir-uidlist.c,
	src/lib-index/mbox/mbox-lock.c, src/lib-storage/subscription-file
	/subscription-file.c, src/lib/file-dotlock.c, src/lib/file-
	dotlock.h:
	Added dotlock parameter to specify how old lock file has to be to be
	immediately deleted. This fixes the problem of never deleting
	uidlist.lock files.
	[7aff4dec4e9b]

	* src/lib/strfuncs.c:
	*_strconcat() bugfix
	[d623907c098a]

	* src/auth/mech.c, src/auth/userdb-static.c, src/imap/imap-fetch.c,
	src/lib-index/mbox/mbox-lock.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/mail-storage.c, src/lib/strfuncs.c,
	src/lib/strfuncs.h, src/master/main.c, src/master/master-settings.c:
	Added t_strsplit_spaces().
	[02bc3ef29b22]

	* src/lib-index/mbox/mbox-sync.c:
	mbox was always synced when mailbox was opened.
	[c9571aa175f8]

	* src/lib-index/mail-index.c:
	Sync stamps weren't updated always from header.
	[7826e88c5679]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-file.c, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h:
	We didn't notice cache compression immediately in other processes.
	Also some other bugfixes.
	[f8c343c3d283]

	* src/lib/file-dotlock.c:
	save errno in failures
	[af6c65fe9bf8]

2003-10-19  Timo Sirainen  <tss@iki.fi>

	* src/lib/mmap-anon.c:
	MAP_FIXED didn't actually work the way I thought (should have looked
	the man page more carefully..). Dropped that and now we'll always
	just memcpy() the data when we want to grow a mmaping.
	[3045659c65d9]

2003-10-16  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c:
	Don't disconnect client immediately if there's an error in IMAP
	syntax.
	[b523a248424c]

	* src/imap/cmd-append.c:
	cleanup
	[cae2c9166bd0]

	* src/imap/cmd-copy.c:
	COPY: Don't crash if no mailbox is selected.
	[95d03c5a3a31]

2003-10-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c:
	If there was multiple headers with same name, we stored only first
	one into cache.
	[caaeeda81d9d]

	* src/lib-index/mbox/istream-mbox.c:
	bugfixes
	[e3ce78c545f0]

2003-10-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/istream-mbox.c:
	bugfixes
	[2683523cc575]

	* src/imap/imap-fetch-body-section.c, src/imap/imap-fetch.c:
	BODY[HEADER] and RFC822.HEADER fetching was broken (why did it work
	before?..)
	[36d0e23dc231]

	* src/lib-index/mail-index-open.c:
	bugfix
	[54d7fb9e0b72]

2003-10-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-open.c:
	bugfix
	[0ac9f72a84a8]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Strip trailing '/' from mail directory if given. Just makes it
	cleaner in log files.
	[2ef8e4ab3f03]

	* src/lib/compat.c:
	pread/pwrite doesn't move file offset. make our compat functions
	restore it
	[e86000107a45]

	* src/lib-index/mbox/mbox-rewrite.c:
	fix
	[4a61ab6c980d]

	* src/lib-index/mail-index-open.c, src/lib-index/mbox/mbox-rewrite.c:
	bugfixes
	[fef0b4df8383]

	* src/lib-storage/index/mbox/mbox-expunge.c:
	mbox expunging works again
	[fe13672d14b3]

	* src/lib-index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync-
	full.c:
	mbox rewriting should work again..
	[9f25c3d7b378]

2003-10-03  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-sort.c:
	Use data stack pool instead of temp_pool. Fixes sorting by subject.
	[eaf7de575156]

	* src/imap/imap-fetch-body-section.c:
	Partial BODY[header] or BODY[part] fetches were buggy if client
	requested more data than was available in the header/part.
	[69c2ec6d198b]

	* src/lib-imap/imap-base-subject.c:
	Allow using data stack pool with imap_get_base_subject_cased()
	[8cdd630e6b07]

	* src/lib-storage/index/index-mail-headers.c:
	get_header() returned values wrong
	[9d8ed97a807f]

	* src/lib-mail/message-date.c:
	Don't require timezone in Date-header.
	[e48b49aaeffc]

	* src/lib/fdpass.c:
	Put the msg/cmsg checks in CHECK_MSG() and CHECK_CMSG() macros. Add
	support for Linux 2.0 kernels by checking if LINUX20 is defined.
	[e1a7e38c17ed]

	* src/lib/compat.c, src/lib/compat.h, src/lib/mmap-util.c, src/lib
	/mmap-util.h:
	If we don't have function foo, do it always as #define foo my_foo
	and create your own my_foo. Did this to pread/pwrite/madvise.
	[82e19ad18784]

2003-09-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-storage/index/mbox/mbox-save.c:
	\Draft and \Deleted flags used opposite flag chars in X-Status
	header. We were incompatible with other mbox accessing software.
	[ccd30c24201a]

2003-09-24  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-pam.c:
	Alignment fix
	[924d5279293b]

2003-09-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Fixes memory/fd leaking with INDEX=MEMORY.
	[b101e678e7ac]

	* src/lib-index/mail-index-open.c:
	Fixed potential file descriptor leaks
	[e71256caeff9]

2003-09-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-custom-flags.c:
	Fix for leaking fds with non-writable .customflags files.
	[42d9cae286b5]

2003-09-21  Timo Sirainen  <tss@iki.fi>

	* doc/securecoding.txt:
	Secure coding guide for Dovecot.
	[6cb3cbf8c7c4]

	* configure.in, src/lib/data-stack.c, src/lib/mempool-alloconly.c,
	src/lib/mempool-system.c:
	Added support for Boehm GC. However it seems to be crashing for some
	reason with me..
	[49b6103dd2e0]

	* src/lib/strfuncs.c:
	cleanup
	[35f1682e311b]

	* src/lib/imem.c, src/lib/imem.h, src/lib/mempool.h:
	Make i_free(), p_free() and pool_unref() calls also set the given
	parameter to NULL.
	[0e72d6ab85ad]

	* src/lib/mempool.h:
	Removed pool leak checking stuff, it's not used.
	[46d2094ac470]

	* src/auth/auth-master-connection.c, src/auth/mech-digest-md5.c,
	src/auth/mech-plain.c, src/auth/mech.c, src/auth/passdb-pam.c, src
	/imap-login/client-authenticate.c, src/imap-login/client.c, src/imap
	/cmd-append.c, src/imap/cmd-sort.c, src/imap/imap-fetch-body-
	section.c, src/imap/imap-fetch.c, src/imap/imap-sort.c, src/imap
	/imap-thread.c, src/lib-charset/charset-utf8.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	quote.c, src/lib-index/mail-cache.c, src/lib-index/mail-modifylog.c,
	src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-mail/message-address.c, src/lib-mail/message-body-search.c,
	src/lib-mail/message-header-decode.c, src/lib-storage/index/index-
	mail-headers.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/maildir/maildir-
	save.c, src/lib-storage/mail-search.c, src/lib/Makefile.am, src/lib
	/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib/mempool-
	system.c, src/lib/mempool-unsafe-datastack.c, src/lib/mempool.h,
	src/lib/str.c, src/lib/strfuncs.c, src/pop3-login/client-
	authenticate.c, src/pop3-login/client.c:
	data_stack_pool split into two: unsafe_data_stack_pool which works
	like before, and a new one which verifies that stack frame stays the
	same whenever the pool is accessed.
	[2f3d906d99d8]

	* src/imap/imap-fetch-body-section.c:
	Compiler warning fix
	[986d5dac10c8]

2003-09-20  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	location defaulted only to default_mail_env, not userdb.
	[7ebd4bb20815]

2003-09-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	Revert the mailbox/ == mailbox change after all. It broke LIST and
	it's not important really..
	[a027c8bac567]

2003-09-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	Reverted mailbox == mailbox/ change, it applies to only dual-use
	mailboxes..
	[8edd874f53a3]

2003-09-15  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body-section.c:
	If client requests invalid body part, return it as NIL.
	[88744e967222]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Ignore hierarchy separator at the end of mailbox name.
	[850bf9389a73]

	* src/imap/cmd-create.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage.h:
	CREATE mailbox/ with maildir now creates the mailbox instead of
	ignoring it.
	[99cf3e9393a6]

	* src/master/master-settings.c:
	missed
	[57bd9be0ecff]

	* src/imap/cmd-namespace.c, src/imap/namespace.c,
	src/imap/namespace.h, src/master/mail-process.c, src/master/master-
	settings.h:
	Added hidden-option to namespaces to hide them from NAMESPACE reply.
	[9547667cfa19]

	* src/master/mail-process.c:
	Support %vars in namespace prefix.
	[c5fa45f0ebf6]

2003-09-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-mail-headers.c:
	get_header() returned only first line of multiline headers
	[63254344ea0e]

	* src/lib-storage/index/index-mail-headers.c:
	Headers were returned twice sometimes
	[ba17c15b9b40]

	* src/lib-storage/index/index-mail-headers.c:
	compile fix
	[c2ba78db758e]

2003-09-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-address.c:
	We stored groups wrong in ENVELOPE.
	[115ffc7eaff5]

	* src/lib-storage/index/maildir/maildir-storage.c:
	treat ~ mailbox prefix as absolute path too
	[b04610627018]

2003-09-08  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch.c:
	Missing spaces in ENVELOPE, BODY and BODYSTRUCTURE replies.
	[53e06e33393f]

	* src/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.h, src/lib-storage/index/index-search.c:
	Stop parsing cached headers when we've got everything.
	[6c0c2ff2c113]

	* src/imap/imap-fetch.c:
	Write envelope, body and bodystructure directly into output stream.
	[fbb28b07c60f]

	* src/lib/failures.c, src/lib/printf-upper-bound.c, src/lib/printf-
	upper-bound.h, src/lib/str.c, src/lib/strfuncs.c:
	Call printf_string_fix_format() only when
	printf_string_upper_bound() sees %m.
	[32bfcbe2a006]

	* src/lib/printf-upper-bound.c:
	minor speedup
	[520e3a0496db]

	* src/lib-imap/imap-date.c, src/lib-imap/imap-date.h:
	imap_to_datetime_offset() isn't needed. optimized imap_to_datetime()
	a bit.
	[3767595e9069]

	* src/lib-index/mail-cache.c:
	cleanup
	[7bbd17c237a4]

	* src/lib-index/mail-cache.c:
	minor speedups
	[25b42c124efd]

	* src/lib-storage/index/index-mail-headers.c:
	bugfix
	[81ebf6c81fc4]

2003-09-07  Timo Sirainen  <tss@iki.fi>

	* src/lib/buffer.c:
	minor optimizations
	[ebc6c417e6bc]

	* src/lib-index/mail-cache.c:
	Fixed memory leak after compressing cache file.
	[44b90c887345]

	* src/lib-storage/index/index-mail-headers.c:
	bugfix
	[d766c93ffb96]

	* src/auth/passdb-pam.c:
	Strict aliasing fix
	[934cb5f21751]

	* src/lib-index/mail-cache.c:
	Header fetching committed changes twice, now we don't commit changes
	when requesting a field which we know hasn't changed (pretty dummy
	logic, but works for this case). Continued rows were also counted
	wrong.
	[6830c31323c1]

	* src/lib/ioloop-internal.h:
	s/int/enum io_condition/
	[fff38df7f98f]

2003-09-06  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	whops, left extra stuff.
	[fd33cf8a1261]

	* src/imap/namespace.c, src/imap/namespace.h, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added "inbox" setting to specify which namespace has the INBOX.
	[4e14ba3c115b]

	* src/master/mail-process.c, src/master/master-settings.c:
	If location isn't given for namespace, use the default
	[9ce1e589d3c1]

	* src/imap/cmd-list.c:
	If LISTEXT is used and CHILDREN info isn't wanted, don't send it.
	[588326f1cd84]

	* dovecot-example.conf:
	comment changes
	[a1183185b013]

2003-09-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache.c:
	Include used-bit for all bytes in offsets to make sure their reads
	aren't only partial
	[72933c5c0b68]

2003-09-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-
	index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mbox/Makefile.am, src/lib-index/mbox/istream-mbox.c, src/lib-
	index/mbox/mbox-append.c, src/lib-index/mbox/mbox-index.c, src/lib-
	index/mbox/mbox-index.h, src/lib-index/mbox/mbox-open.c, src/lib-
	index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync-full.c, src
	/lib-index/mbox/mbox-sync.c, src/lib-mail/message-parser.c, src/lib-
	mail/message-part-serialize.c, src/lib-mail/message-part-
	serialize.h, src/lib-storage/index/mbox/mbox-expunge.c:
	mbox reading is kind of working again. Just don't try rewriting or
	expunging :) Changing headers are also hidden from clients so mbox
	messages are finally seen immutable as required by IMAP.
	[7e3ce7515477]

2003-08-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-settings/settings.c:
	Allow key=value without requiring space between key and '='
	[2a0220362d1b]

2003-08-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-settings/settings.c:
	Support # comments also at the end of setting lines
	[37881cedb70d]

	* src/lib/safe-mkdir.c:
	comment updates. it's not possible to change the file mode if you're
	not the owner..
	[05427d8112ee]

	* COPYING, COPYING.MIT, src/lib/alarm-hup.c, src/lib/buffer.c,
	src/lib/compat.c, src/lib/data-stack.c, src/lib/env-util.c,
	src/lib/failures.c, src/lib/fd-close-on-exec.c, src/lib/file-lock.c,
	src/lib/file-set-size.c, src/lib/hash.c, src/lib/hex-binary.c,
	src/lib/hostpid.c, src/lib/imem.c, src/lib/ioloop-poll.c, src/lib
	/ioloop-select.c, src/lib/ioloop.c, src/lib/iostream.c, src/lib
	/istream-data.c, src/lib/istream-file.c, src/lib/istream-mmap.c,
	src/lib/istream.c, src/lib/lib-signals.c, src/lib/lib.c, src/lib
	/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib/mempool-
	system.c, src/lib/mmap-anon.c, src/lib/mmap-util.c,
	src/lib/network.c, src/lib/ostream-file.c, src/lib/ostream.c,
	src/lib/process-title.c, src/lib/randgen.c, src/lib/restrict-
	access.c, src/lib/restrict-process-size.c, src/lib/safe-memset.c,
	src/lib/safe-mkdir.c, src/lib/sendfile-util.c, src/lib/str.c,
	src/lib/strescape.c, src/lib/strfuncs.c, src/lib/unlink-directory.c,
	src/lib/unlink-lockfiles.c, src/lib/utc-mktime.c, src/lib/utc-
	offset.c, src/lib/write-full.c:
	Removed most of the license comments from src/lib/*.c. It's just
	fine to keep them in a single COPYING.MIT file. Changed a few other
	comments as well.
	[9df02b1533b3]

	* src/lib/fdpass.c:
	Fix for IRIX (plus comment cleanups)
	[219b6e9e82f1]

2003-08-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-auth/Makefile.am:
	missing .h files
	[c9026bb73dae]

2003-08-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/md5crypt.c:
	Removed strcat stuff and did some minor tweaks.
	[ec90bae6f20a]

	* src/master/mail-process.c:
	crashfix
	[b94a21f18a13]

	* src/master/master-settings.c:
	missing initializers
	[d55e7dfa9770]

	* src/master/master-settings.c:
	forgot mail_chroot
	[0b4b254cf726]

2003-08-24  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added mail_chroot setting to specify default chroot.
	[d83e16602418]

	* src/lib-storage/index/index-mailbox-check.c:
	fix
	[6c4a75f4e40c]

	* src/imap/cmd-idle.c, src/lib-storage/index/index-mailbox-check.c,
	src/lib-storage/index/index-storage.h:
	IDLE fixes..
	[9f89edcfc043]

	* src/master/master-settings.c:
	Don't crash if no protocols were given in config file
	[687a06278ef5]

	* src/imap/cmd-idle.c, src/imap/cmd-select.c, src/imap/commands-
	util.c, src/lib-storage/index/index-mailbox-check.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.h,
	src/lib-storage/proxy-mailbox.c:
	IDLE uses now IO_*_NOTIFY to get instant notifying of mails.
	[8480f945e270]

	* configure.in, src/lib/Makefile.am, src/lib/ioloop-internal.h,
	src/lib/ioloop-notify-dn.c, src/lib/ioloop-notify-none.c, src/lib
	/ioloop-poll.c, src/lib/ioloop-select.c, src/lib/ioloop.c,
	src/lib/ioloop.h:
	Added IO_DIR_NOTIFY and IO_FILE_NOTIFY conditions to io_add().
	IO_DIR_NOTIFY is now implemented for Linux dnotify.
	[5bf22d6bb65e]

	* dovecot-example.conf, src/lib-storage/index/index-messageset.c, src
	/lib-storage/mail-storage.c, src/lib-storage/mail-storage.h:
	Added oe6-fetch-redundant-msgset workaround.
	[d1a6d9d24bd9]

	* dovecot-example.conf:
	added rawlog example
	[6d10ece6cf9f]

	* src/util/rawlog.c:
	fixes
	[f5e6f29731c4]

	* dovecot-example.conf, src/imap-login/client-authenticate.c, src
	/imap-login/client-authenticate.h, src/imap-login/client.c, src
	/imap-login/client.h, src/master/master-settings.c, src/pop3-login
	/client-authenticate.c, src/pop3-login/client.c,
	src/pop3-login/client.h:
	disable_plaintext_auth defaults to yes now. ipv4 127.* and ipv6 ::1
	addresses are considered secure however and plaintext authentication
	is allowed from them.
	[cc0690f92d96]

	* src/master/auth-process.c, src/master/login-process.c, src/master
	/master-settings.c, src/master/master-settings.h:
	Make sure auth process and login process don't share uids.
	[b3526668de78]

	* src/master/master-settings.c, src/master/master-settings.h:
	Reading global auth_* defaults didn't work
	[c090fc199013]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.h:
	Added back compat_data[]. It wasn't so simple to access data
	portably in index files after all..
	[629eb2888e6d]

	* src/lib-index/mail-cache.h, src/lib-storage/index/index-mail-
	headers.c, src/lib-storage/index/index-mail.c:
	use int32_t instead of int in struct mail_sent_date
	[90f1068e2dea]

	* configure.in, src/lib-index/mail-index.h:
	Removed index_align stuff. It's not needed anymore.
	[a0dee56b280d]

	* src/lib-index/mail-index-file.c, src/lib-index/mail-index.c:
	expunge/append behaviour corrupted indexes
	[f25f90d8d24a]

	* src/lib-index/maildir/maildir-sync.c:
	comment update
	[43b4b59310d2]

	* src/lib-storage/index/index-mail-headers.c:
	Assert -> mark cache corrupted
	[443470f8e88b]

	* doc/dovecot-ldap.conf, doc/dovecot-pgsql.conf, src/auth/userdb-
	ldap.c:
	LDAP: Removed the system_user=uid defaulting. LDAP usually has only
	virtual users which don't exist in /etc/group. Clarified what the
	system user actually does for ldap/pgsql.
	[611c552a518c]

	* src/lib-index/maildir/maildir-index.c:
	Don't use microseconds in maildir name if it's not needed.
	[8bb3216773d6]

2003-08-22  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/lib-auth/auth-server-request.c, src/lib-
	index/mail-cache.c, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/client.h:
	fixes. maybe it works now.
	[96dab004a87a]

	* src/auth/auth-client-connection.c:
	crashfix
	[6a1586f04640]

	* src/auth/auth-master-connection.c, src/auth/mech.c, src/auth/mech.h:
	fixes
	[2bc5207deb0e]

	* src/auth/auth-client-connection.c:
	fix
	[293ec0d24009]

	* src/lib-auth/auth-server-connection.c, src/lib-auth/auth-server-
	connection.h, src/lib-auth/auth-server-request.c:
	fixes
	[f1377239867e]

	* src/auth/db-ldap.c, src/auth/userdb-ldap.c:
	Give better error message if uid/gid not found from ldap and no
	default was set.
	[044fdf70f11a]

	* src/auth/auth-client-connection.c, src/auth/mech-anonymous.c,
	src/auth/mech-cyrus-sasl2.c, src/auth/mech-digest-md5.c, src/auth
	/mech-plain.c, src/auth/mech.c, src/auth/mech.h, src/auth/passdb-
	ldap.c, src/auth/passdb-pam.c:
	Fixed crash if login process connection died while there were some
	auth requests.
	[0731fc436585]

	* dovecot-example.conf, src/lib-auth/auth-server-request.c:
	We now support checking the password against all defined auth
	processes and use the one that matches.
	[ba70d60987e2]

	* src/lib-auth/auth-server-request.c:
	s/process/server/
	[cdf53841c4af]

	* src/auth/auth-master-connection.c, src/lib-auth/auth-client.c, src
	/lib-auth/auth-server-connection.c, src/login-common/main.c, src
	/login-common/master.c:
	bugfixes
	[5121567de516]

	* src/auth/db-ldap.c:
	fix
	[466ed9c67114]

	* src/master/auth-process.c:
	forgot
	[384037d89a12]

	* configure.in, src/Makefile.am, src/auth/Makefile.am, src/auth/auth-
	client-connection.c, src/auth/auth-client-connection.h, src/auth
	/auth-client-interface.h, src/auth/auth-login-interface.h, src/auth
	/auth-master-connection.c, src/auth/auth-master-connection.h,
	src/auth/auth-master-interface.h, src/auth/login-connection.c,
	src/auth/login-connection.h, src/auth/main.c, src/auth/master-
	connection.c, src/auth/master-connection.h, src/auth/mech-
	anonymous.c, src/auth/mech-digest-md5.c, src/auth/mech-plain.c,
	src/auth/mech.c, src/auth/mech.h, src/imap-login/Makefile.am, src
	/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/imap-login/common.h, src/lib-
	auth/.cvsignore, src/lib-auth/Makefile.am, src/lib-auth/auth-
	client.c, src/lib-auth/auth-client.h, src/lib-auth/auth-server-
	connection.c, src/lib-auth/auth-server-connection.h, src/lib-auth
	/auth-server-request.c, src/lib-auth/auth-server-request.h, src
	/login-common/Makefile.am, src/login-common/auth-common.c, src
	/login-common/auth-common.h, src/login-common/auth-connection.c, src
	/login-common/auth-connection.h, src/login-common/client-common.h,
	src/login-common/common.h, src/login-common/main.c, src/login-
	common/master.c, src/login-common/master.h,
	src/pop3-login/Makefile.am, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/client.h,
	src/pop3-login/common.h:
	Moved client side code for auth process handling to lib-auth. Some
	other login process cleanups.
	[43815588dd6b]

	* src/auth/db-ldap.c:
	If LDAP connection closes, notify all requests that they failed.
	[a8502917689d]

2003-08-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache.c, src/lib-index/mail-cache.h, src/lib-
	index/mbox/mbox-index.c, src/lib-mail/message-part-serialize.c, src
	/lib-storage/index/index-mail.c:
	Removed some header/body size fields. We use only message_part now
	everywhere since it's small enough. virtual_full_size was left
	because we may know that by just reading maildir filename.
	[21b1cca4849b]

	* src/lib-mail/message-part-serialize.c:
	Serialized message_parts are now packed into smaller space.
	[e3cbf6d70899]

	* src/lib-storage/index/index-mail.c:
	bugfix
	[d77a282125b6]

	* src/lib-mail/message-parser.c, src/lib-mail/message-parser.h, src
	/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h:
	Message parsing can now be done in two parts - header and body.
	We're now more eager at parsing MIME structure for message. It's
	done whenever body has to be fully read (eg. rfc822.size).
	[ef79ce6507ff]

	* src/util/Makefile.am:
	Keep rawlog still in libexec/dovecot/ directory.
	[ad5be4c9cf09]

	* INSTALL:
	Removed --with-rawlog. It's built always now.
	[587f7911b93d]

	* configure.in, src/Makefile.am, src/imap/Makefile.am,
	src/imap/main.c, src/imap/rawlog.c, src/imap/rawlog.h,
	src/util/.cvsignore, src/util/Makefile.am, src/util/rawlog.c:
	Separated rawlog into it's own binary.
	[0fae24674a9a]

	* src/master/mail-process.c, src/master/master-settings.c:
	Allow one parameter for mail_executable.
	[552514c014cc]

2003-08-20  Timo Sirainen  <tss@iki.fi>

	* src/pop3-login/client-authenticate.c:
	We were posing as IMAP instead of POP3 to auth process.
	[e5e5ca4aa466]

	* src/lib-imap/imap-bodystructure.h:
	Removed unneeded code
	[1ad3218d7d08]

	* src/lib-imap/imap-bodystructure.c:
	removed unneeded code
	[cb40abe0ae28]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-
	bodystructure.h, src/lib-mail/message-parser.c, src/lib-mail
	/message-parser.h, src/lib-storage/index/index-mail-headers.c, src
	/lib-storage/index/index-mail.c, src/lib-storage/index/index-mail.h:
	If BODY/BODYSTRUCTURE is requested with some other headers, parse
	the headers only once. If body contains multiple MIME parts, cache
	the internal MIME structure so BODY[part] fetching doesn't need to
	parse it again.
	[c07b98265577]

2003-08-18  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	auth_methods -> auth_mechanisms
	[72624cb9e4d6]

	* src/lib-index/mail-cache.c, src/lib-storage/index/Makefile.am, src
	/lib-storage/index/index-mail-headers.c, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/index-mail.h:
	Changed how cached headers are stored. Previously when we added new
	headers, all the old headers were duplicated as well which wasted
	space. Also fixed several bugs in caching.
	[f5181233b04e]

	* src/lib-index/mail-cache.h, src/lib-index/mail-index.h:
	Removed NBO32_BIT* stuff
	[68258de0a00f]

	* src/lib/byteorder.c, src/lib/byteorder.h:
	Removed the NBO32_BIT* stuff. They don't work well with enums which
	are signed integers..
	[54a6dd88aedd]

	* src/lib/buffer.c:
	Inserting to end of buffer or past it didn't work
	[8ae128679e05]

2003-08-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-open.c:
	crashfix
	[cc366700adfc]

2003-08-14  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-sort.c, src/lib-storage/index/index-mail.c, src/lib-
	storage/mail-storage.h, src/lib-storage/proxy-mail.c:
	Removed get_address() and get_first_mailbox() from mail interface.
	[1534976b029b]

2003-08-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-open.c:
	some opening fixes
	[174b0a707426]

	* src/lib-storage/index/index-mail.c:
	message parts were stored corrupted
	[6a5e548b47d8]

	* src/lib-index/Makefile.am, src/lib-index/mail-index-compress.c, src
	/lib-index/mail-index-file.c, src/lib-index/mail-index-open.c, src
	/lib-index/mail-index.c:
	Support for upgrading from old index file with smaller header.
	[c47ff2e6e946]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index-open.c, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-expunge.c, src/lib-index/maildir/maildir-
	sync.c, src/lib-index/maildir/maildir-update-flags.c, src/lib-
	index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync.c:
	Save sync stamp in index header rather than in file's mtime.
	[417558e2103e]

	* src/lib-index/mail-index-open.c:
	comment update
	[c53caaf84cb6]

	* src/lib-index/mail-cache.c, src/lib-index/mail-index.h:
	Fixes for opening broken cache file.
	[3b8c4a370d86]

	* src/lib-imap/imap-util.h, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h, src/lib-index/maildir/maildir-build.c, src/lib-
	index/maildir/maildir-expunge.c, src/lib-index/maildir/maildir-
	index.c, src/lib-index/maildir/maildir-index.h, src/lib-
	index/maildir/maildir-open.c, src/lib-index/maildir/maildir-sync.c,
	src/lib-index/maildir/maildir-uidlist.c, src/lib-index/maildir
	/maildir-update-flags.c, src/lib-index/mbox/mbox-index.c, src/lib-
	storage/index/index-update-flags.c, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/mail-storage.h:
	Maildir syncing works now without requiring base filenames to be in
	index cache file. Also message flag updates with +FLAGS and -FLAGS
	works correctly now if another client had just changed it's flags.
	[b5dc9acbbc9b]

2003-08-10  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-store.c:
	crashfix
	[b20ecf0cf8f6]

2003-08-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/Makefile.am:
	missing index-expunge.h
	[9a6425d70d83]

2003-08-06  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-copy.c, src/imap/cmd-fetch.c, src/imap/cmd-store.c,
	src/imap/imap-fetch-body-section.c, src/imap/imap-fetch.c, src/imap
	/imap-fetch.h, src/imap/imap-search.c, src/imap/imap-thread.c, src
	/lib-imap/imap-envelope.c, src/lib-imap/imap-envelope.h, src/lib-
	index/Makefile.am, src/lib-index/mail-cache.c, src/lib-index/mail-
	cache.h, src/lib-index/mail-custom-flags.c, src/lib-index/mail-
	index-compress.c, src/lib-index/mail-index-data.c, src/lib-index
	/mail-index-data.h, src/lib-index/mail-index-fsck.c, src/lib-index
	/mail-index-open.c, src/lib-index/mail-index-rebuild.c, src/lib-
	index/mail-index-update-cache.c, src/lib-index/mail-index-update.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/Makefile.am, src/lib-index/maildir/maildir-build.c,
	src/lib-index/maildir/maildir-expunge.c, src/lib-index/maildir
	/maildir-index.c, src/lib-index/maildir/maildir-index.h, src/lib-
	index/maildir/maildir-open.c, src/lib-index/maildir/maildir-
	rebuild.c, src/lib-index/maildir/maildir-sync.c, src/lib-
	index/maildir/maildir-uidlist.c, src/lib-index/maildir/maildir-
	update-flags.c, src/lib-index/mbox/Makefile.am, src/lib-index/mbox
	/mbox-append.c, src/lib-index/mbox/mbox-index.c, src/lib-index/mbox
	/mbox-index.h, src/lib-index/mbox/mbox-open.c, src/lib-index/mbox
	/mbox-rebuild.c, src/lib-index/mbox/mbox-rewrite.c, src/lib-
	index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c, src
	/lib-storage/index/index-expunge.c, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-mail.h, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/mail-search.c, src/lib-storage/mail-search.h, src/lib-
	storage/mail-storage.h, src/lib-storage/proxy-mailbox.c,
	src/pop3/client.c, src/pop3/commands.c:
	Index cache file rewrite. It's not finished yet and mbox support is
	completely broken. But it's getting difficult to maintain outside
	cvs :)
	[8920600a8cfc]

	* src/lib/byteorder.c, src/lib/byteorder.h:
	added nbo32_bitmasks[]
	[3c041da53757]

	* src/lib/Makefile.am, src/lib/byteorder.c, src/lib/byteorder.h:
	Added some network byte ordering functions and macros
	[cfaef4f27083]

	* configure.in, src/lib/compat.c, src/lib/compat.h:
	Added pwrite() compatibility
	[a0dd52443420]

	* src/lib/file-dotlock.h:
	comment fix
	[644268046d59]

	* src/lib/istream-data.c:
	bugfix
	[293143677345]

	* src/lib/mempool-alloconly.c:
	reallocing clears memory unneededly since it's always already
	cleared
	[64bb8794ac15]

	* src/lib-imap/imap-bodystructure.c:
	Some message/rfc822 mails were returned as text/plain
	[e50e21588020]

	* src/lib-imap/imap-bodystructure.c:
	fix
	[60b5179d6131]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-envelope.c:
	Don't write envelope as NIL into bodystructure even if it's broken.
	[4aca99baa9a4]

	* src/lib-mail/message-parser.c:
	"Content-Type: text" (without '/') didn't mark the message as
	containing text, which generated broken BODYSTRUCTUREs.
	[aff92c2de6f5]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-parser.c, src
	/lib-imap/imap-parser.h:
	Fixes for parsing BODYSTRUCTURE
	[566fb4bf7066]

2003-08-05  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	We should be checking C99 types using stdint.h, not inttypes.h
	[4076387f7ccb]

2003-08-03  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	If user's home dir doesn't exist, fallback to chdiring /tmp.
	[e7f5af0ae65d]

2003-08-02  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib/utc-mktime.c:
	utc_mktime() crashed with 64bit time_t if gmtime() didn't like
	>32bit values
	[20519e4bca48]

2003-07-27  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c:
	A bit more temporary kludging
	[a85af58a363c]

	* configure.in, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Namespace configuration.
	[6025913b581b]

	* src/imap/cmd-list.c, src/imap/cmd-rename.c:
	fixes
	[26e150912cc6]

	* src/imap/Makefile.am, src/imap/client.c, src/imap/client.h, src/imap
	/cmd-append.c, src/imap/cmd-close.c, src/imap/cmd-copy.c, src/imap
	/cmd-create.c, src/imap/cmd-delete.c, src/imap/cmd-expunge.c,
	src/imap/cmd-fetch.c, src/imap/cmd-idle.c, src/imap/cmd-list.c,
	src/imap/cmd-namespace.c, src/imap/cmd-rename.c, src/imap/cmd-
	search.c, src/imap/cmd-select.c, src/imap/cmd-sort.c, src/imap/cmd-
	status.c, src/imap/cmd-store.c, src/imap/cmd-subscribe.c, src/imap
	/cmd-thread.c, src/imap/cmd-unselect.c, src/imap/commands-util.c,
	src/imap/commands-util.h, src/imap/commands.c, src/imap/commands.h,
	src/imap/main.c, src/imap/namespace.c, src/imap/namespace.h:
	Getting ready for namespaces. LIST is still broken with them.
	[31c4bb26a1e9]

	* src/lib-storage/index/maildir/maildir-list.c:
	\Nochildren got lost again..
	[949ecc6c272b]

	* src/imap/main.c, src/lib-storage/index/maildir/maildir-list.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-list.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h, src/pop3/main.c:
	Mail storages support now configurable namespace prefix and
	hierarchy separator. Subscription file handling needs some more
	thought.
	[193daadc3924]

	* src/lib/strescape.c:
	unescaping was broken
	[43fdcf8d9a0d]

	* src/imap/cmd-list.c, src/lib-storage/Makefile.am, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox
	/mbox-storage.h, src/lib-storage/mail-storage.h, src/lib-storage
	/mailbox-tree.c, src/lib-storage/mailbox-tree.h, src/lib-storage
	/proxy-mail-storage.c:
	API change: Mailbox list sorting must now always done by storage
	itself if it's needed.

	Maildir listing rewritten.
	[bc76e08a9c9d]

	* src/lib-imap/imap-match.c:
	Fixes for inbox case-insensitity matching
	[27f68eecfb35]

	* src/master/Makefile.am:
	compile fix
	[f9f7f69f345e]

2003-07-26  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/lib-settings/settings.c:
	Spaces are now stripped from end of line in config file. You can use
	" or ' quotes if you need them.
	[d6288ae1a71b]

	* src/pop3/client.c, src/pop3/common.h, src/pop3/main.c:
	Added pop3 hooks
	[a7c742b940e5]

	* src/imap/imap-expunge.c, src/imap/imap-expunge.h, src/lib-
	storage/index/index-expunge.h:
	forgot to add
	[c846d6735042]

	* src/lib-storage/Makefile.am, src/lib-storage/proxy-mail-storage.c,
	src/lib-storage/proxy-mail-storage.h, src/lib-storage/proxy-mail.c,
	src/lib-storage/proxy-mail.h, src/lib-storage/proxy-mailbox.c, src
	/lib-storage/proxy-mailbox.h:
	Added proxy classes for use with modules.
	[9ce620b10b28]

	* src/imap/client.c, src/imap/common.h, src/imap/main.c:
	hook changes
	[ca1c2972b78f]

	* src/imap/cmd-close.c, src/imap/cmd-select.c, src/imap/commands-
	util.c, src/imap/imap-fetch.c, src/lib-storage/index/index-
	expunge.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-update-
	flags.c, src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-expunge.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h:
	API changes: Don't keep variables in mailbox class.
	[72c6e848f583]

	* src/imap/client.c, src/imap/common.h, src/imap/main.c:
	Added hook_client_created and hook_mail_storage_created for modules.
	[6498f3cb9d2c]

	* src/imap/Makefile.am, src/imap/cmd-close.c, src/imap/cmd-expunge.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	storage/index/index-expunge.c, src/lib-storage/index/index-mail.c,
	src/lib-storage/index/index-mail.h, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-update-flags.c, src/lib-storage/index/maildir
	/maildir-expunge.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-expunge.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-storage.h, src/pop3/client.c, src/pop3/commands.c,
	src/pop3/mail-storage-callbacks.c:
	API change for expunging messages. Not exactly what I wanted, but
	good enough.
	[db14aa8e2b5c]

2003-07-23  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-copy.c, src/imap/cmd-store.c, src/imap/imap-fetch.c,
	src/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage.h:
	Explicit lock() method for mailbox.
	[3621292209f4]

	* src/imap/client.h, src/imap/cmd-copy.c, src/imap/cmd-store.c,
	src/imap/imap-fetch.c, src/imap/imap-fetch.h, src/imap/mail-storage-
	callbacks.c, src/lib-imap/imap-util.c, src/lib-imap/imap-util.h, src
	/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	mail.c, src/lib-storage/index/index-mail.h, src/lib-storage/index
	/index-search.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/index-update-
	flags.c, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.h:
	API change for updating message flags.
	[e95c0e462591]

	* src/imap/cmd-copy.c, src/lib-storage/index/index-copy.c, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-mail.c, src
	/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.h:
	API change for copying messages.
	[a64391b49589]

	* src/lib-index/mail-modifylog.c, src/lib-index/mbox/mbox-sync-full.c,
	src/lib-index/mbox/mbox-sync.c:
	Mbox syncing / expunging fixes for previous expunge-commit.
	[20212920c795]

	* src/lib-index/Makefile.am, src/lib-index/maildir/maildir-rebuild.c:
	mail-tree.h no longer needed
	[400165502ee6]

2003-07-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/Makefile.am, src/lib-index/mail-index-compress.c, src
	/lib-index/mail-index-data.c, src/lib-index/mail-index-file.c, src
	/lib-index/mail-index-fsck.c, src/lib-index/mail-index-open.c, src
	/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-index
	/mail-modifylog.c, src/lib-index/mail-modifylog.h, src/lib-index
	/mail-tree-redblack.c, src/lib-index/mail-tree.c, src/lib-index
	/mail-tree.h, src/lib-index/maildir/maildir-rebuild.c, src/lib-
	index/maildir/maildir-sync.c, src/lib-index/mbox/mbox-index.c, src
	/lib-index/mbox/mbox-sync-full.c, src/lib-storage/index/index-
	expunge.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-expunge.c, src/lib-storage/index/mbox
	/mbox-expunge.c:
	Removed .imap.index.tree file. For now we'll just rewrite
	.imap.index file whenever there's expunges. "Expunge binary tree"
	might be added later, but it's not really useful until you have
	thousands of messages in mailbox and you're deleting old messages
	from it.
	[e3b88c16d544]

2003-07-18  Timo Sirainen  <tss@iki.fi>

	* autogen.sh:
	libtoolize --force
	[e0e691291c38]

	* src/lib-mail/message-date.c:
	Allow full month names, compare only the first 3 chars.
	[c5018f68752f]

2003-07-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-address.c:
	Don't crash if there's no domain in address
	[c2f5d02965ca]

2003-07-16  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	size_t checking fixes
	[e9e533b323fb]

	* src/login-common/main.c:
	Disable forking after setuid(), so Linux 2.6 is happy.
	[5bc8a5c718ca]

	* autogen.sh:
	Run libtoolize. Seems to fix newer auto* tools.
	[f1fae9ae2e27]

	* doc/nfs.txt:
	Updated, added ideas how to create better NFS indexes.
	[7992e3981b1b]

2003-07-15  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Get the size_t type properly in OSX
	[08b73ec005f8]

	* configure.in:
	bugfix
	[4f38b6de621a]

	* src/lib/file-dotlock.c:
	Minor speedup
	[b31688700d63]

	* configure.in:
	Delete conftest.mmap too
	[e31dbc7ca0da]

	* configure.in, dovecot-example.conf, src/imap/cmd-append.c, src/imap
	/cmd-copy.c, src/imap/cmd-select.c, src/imap/cmd-status.c,
	src/imap/common.h, src/imap/main.c, src/lib-index/mail-index-data.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-modifylog.c, src/lib-index/mail-tree.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.h,
	src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h, src/pop3/client.c:
	index_mmap_invalidate = yes now invalidate memory maps before
	accessing them. Setting this on should fix some problems with
	OpenBSD. It should also make it possible to use index files over NFS
	as long as lock daemon is used. It might be such a good idea
	however.
	[d22e03714d36]

	* doc/mkcert.sh:
	Quotes around echo
	[401f0c3a3aa2]

	* src/pop3/main.c:
	Added missing randgen initialization.
	[124a42f0be3a]

2003-07-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c:
	Fixes for handling missing Mime-Version
	[5bdda4147b36]

2003-07-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c, src/lib-mail/message-parser.c,
	src/lib-mail/message-parser.h:
	Ignore Content-* headers if there's no MIME-Version header. Note
	that this change breaks cached message parts in indexes.
	[149ade487f48]

	* src/master/auth-process.c, src/master/common.h, src/master/mail-
	process.c, src/master/main.c, src/master/master-settings.c,
	src/master/ssl-init.c:
	Replaced geteuid() calls with one in the beginning and saving it to
	master_uid. When chdir()ing to user's home dir, temporarily set euid
	to user's uid.
	[cc3cef25662c]

2003-07-12  Timo Sirainen  <tss@iki.fi>

	* src/master/mail-process.c:
	We can't always chdir() to user's home directory if it's NFS-
	mounted. Ignore that error.
	[68352df8b24f]

	* dovecot-example.conf:
	Included comment about passwd+BSD requiring roots.
	[a8dc875a8918]

2003-07-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-from.c:
	Support numeric timezones in From-line
	[34f8651349bd]

2003-07-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-modifylog.c:
	compile fix
	[c7459707903d]

	* src/lib-index/mail-modifylog.c:
	DEBUG: crashfix when switching modify log
	[4624a21e1bbb]

	* configure.in:
	test -o and -a are apparently non-POSIX. not using.
	[fcc5d6bb6244]

	* dovecot-example.conf, src/auth/db-ldap.c, src/auth/db-pgsql.c, src
	/lib-settings/settings.c, src/lib-settings/settings.h, src/master
	/auth-process.c, src/master/common.h, src/master/login-process.c,
	src/master/login-process.h, src/master/mail-process.c, src/master
	/mail-process.h, src/master/main.c, src/master/master-settings.c,
	src/master/master-settings.h, src/master/ssl-init.c:
	New configuration file code. Some syntax changes, but tries to be
	somewhat backwards compatible. SIGHUP now reverts back to old
	configuration if it detected errors in new one.
	[6850142c4e25]

	* configure.in:
	test -e isn't standard. Use test -c + -s for checking /dev/urandom.
	[5c2ad8ec50db]

2003-07-09  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	test -e /dev/urandom, not test -c. BSD/OS has it as a symlink to
	socket.
	[507de0e8d250]

	* src/imap/Makefile.am, src/pop3/Makefile.am:
	RAND_LIBS are needed nowadays for imap/pop3.
	[ec4d15b87491]

	* src/auth/master-connection.c:
	Crashfix if user's home directory wasn't given
	[7bc682625eaa]

	* src/lib-storage/index/index-search.c:
	Return BAD instead of NO errors with invalid message sets
	[92289fa71af4]

	* src/lib-mail/message-date.c, src/lib-storage/index/index-search.c:
	Still more timezone fixes
	[6a18854e6856]

2003-07-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/userdb-vpopmail.c:
	typo
	[88bca4f52f71]

	* src/auth/userdb-vpopmail.c:
	fix
	[c6babc7dae00]

2003-07-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	call index deinit properly
	[5d3d87ab83c1]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Destroy all unused indexes 10 seconds after use. Before we destroyed
	them only when opening a new index.
	[993fe64a5e20]

2003-07-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-sync.c:
	updates for syncing comments
	[4c4d0d771350]

	* src/lib-storage/subscription-file/subscription-file.c:
	NFS-safe subscription file
	[d45c613e3b15]

2003-07-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c, src/lib-index/mail-index-open.c, src/lib-
	index/maildir/maildir-uidlist.c, src/lib-index/mbox/mbox-lock.c,
	src/lib/file-dotlock.c, src/lib/file-dotlock.h, src/lib/randgen.c:
	Moved all dotlocking code to lib/. Also we now use temp file +
	link() rather than rely on working O_EXCL.
	[9f503b7851ab]

2003-07-03  Timo Sirainen  <tss@iki.fi>

	* src/lib/unlink-lockfiles.c:
	fix :)
	[beab37ab1617]

	* src/lib/unlink-lockfiles.c, src/lib/unlink-lockfiles.h:
	some more cleanups
	[fc1fbedc3d4e]

	* src/lib/unlink-lockfiles.c, src/lib/unlink-lockfiles.h:
	Minor cleanups.
	[94df30426a96]

2003-07-02  Timo Sirainen  <tss@iki.fi>

	* doc/mail-storages.txt:
	We don't lose UIDs anymore if index is deleted.
	[19ef482ece51]

	* dovecot-example.conf, src/master/mail-process.c, src/master/master-
	settings.c, src/master/master-settings.h:
	Added imap_max_line_length setting to config file.
	[8156b82727a8]

	* src/imap-login/client.c, src/imap/client.c, src/imap/cmd-append.c,
	src/imap/common.h, src/imap/main.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	parser.c, src/lib-imap/imap-parser.h:
	IMAP parser memory limits are now enforced by bytes per line rather
	than limiting maximum amount of tokens per line. Default is 64k now,
	which should help with the huge message sets generated by some
	clients.
	[6eca99b727a0]

2003-07-01  Timo Sirainen  <tss@iki.fi>

	* INSTALL:
	CPPFLAGS/LDFLAGS examples were missing -I / -L options..
	[6bf54ebc16af]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Expand ~/ from beginning of all paths. Added INBOX=<dir> support for
	maildir.
	[55431c7b6314]

	* src/lib/home-expand.c:
	home_expand(NULL) -> NULL
	[e0006f30b496]

	* src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/maildir/maildir-storage.c:
	mail_full_filesystem_access = yes fixes
	[c390d5ac3327]

2003-06-30  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-capability.c, src/imap/common.h, src/imap/main.c:
	Keep capability in string_t so plugins can modify it.
	[898a95426118]

2003-06-26  Timo Sirainen  <tss@iki.fi>

	* NEWS, README, TODO, configure.in:
	0.99.10 released
	[0b8260468474]

	* src/lib-index/maildir/maildir-index.c:
	INTERNALDATE fetching was broken
	[c7578350f135]

	* src/lib-index/maildir/maildir-sync.c:
	When assigning UIDs to mails, we tried to sort them with strcmp(),
	but that wasn't actually working. Also we now sort properly the
	mails that had unix timestamp older than 1 billion (Sep 9 2001).
	[e5bd44be3f5a]

	* dovecot-example.conf:
	Comment updates
	[498a9b7797f2]

	* src/lib-storage/index/mbox/mbox-list.c:
	Don't send \Unmarked in LIST reply unless mbox file is zero-sized.
	We can't get it right with atime checks, so don't even try.
	[3b853dad23e3]

	* INSTALL:
	Say something about CPPFLAGS and LDFLAGS.
	[a3de39b92838]

	* src/lib-storage/index/mbox/mbox-storage.c:
	When deleting directory, delete .imap dir under it first.
	[a0207c0adf7e]

	* doc/auth.txt, dovecot-example.conf, src/auth/passdb-pam.c:
	Using "*" as PAM service name now uses imap/pop3 service.
	[ab2fb3c6a12b]

	* INSTALL, src/imap/rawlog.c:
	~/rawlog -> ~/dovecot.rawlog
	[b3ae1757f921]

2003-06-25  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-pam.c:
	Call waitpid() until no processes are left, instead of one per
	second.
	[f1711e0f7035]

	* src/imap-login/client.c, src/pop3-login/client-authenticate.c:
	Don't advertise STARTTLS/STLS capability when TLS/SSL connection is
	already established.
	[37c4985b7dc9]

	* src/master/mail-process.c:
	Better error message if UID/GID isn't valid.
	[9b5bcd7b1b5a]

	* src/auth/passdb-pam.c:
	Use "dovecot" service rather than "imap".
	[c0c503ad1cf7]

	* src/auth/mech-cyrus-sasl2.c:
	Compile fix (dunno if it works though)
	[e3d896a9487d]

	* src/imap-login/client.c:
	imap-login could get into infinite loop if connection was closed
	improperly.
	[1cadf76d7c4c]

	* src/lib-storage/index/index-mail.c:
	get_date() wasn't optimized by using cached ENVELOPE.
	[6ec903a5d333]

2003-06-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-sync.c:
	More verbose bug reporting.
	[059c82e833b2]

	* src/imap/cmd-list.c, src/imap/cmd-status.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	quote.c, src/lib-imap/imap-quote.h:
	LIST and STATUS replies shouldn't strip tabs and spaces from mailbox
	names.
	[235f67c3cc9f]

	* src/lib-storage/index/index-messageset.c:
	Accessing messages in empty mailbox caused some crashes.
	[253967fa5b8a]

	* configure.in:
	fix for openssl detection
	[919f5aafbc6c]

	* configure.in:
	Check OpenSSL using pkg-config which at least redhat uses nowadays.
	[97572a77243a]

2003-06-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-tree-redblack.c, src/lib/module-dir.c,
	src/lib/network.c:
	Compiler warning fixes
	[e291bf36d57f]

2003-06-19  Timo Sirainen  <tss@iki.fi>

	* src/login-common/main.c:
	Set process count to 1 instead of 0.
	[1ffb486b0ca6]

	* src/auth/db-pgsql.c:
	If query fails with fatal failure, reconnect.
	[95e2fea24d06]

	* src/auth/passdb-pam.c:
	Fork new process for each PAM check. Not exactly fast, but we have
	to do it so we don't block when incorrect password is given. We
	could try reusing the processes though..
	[24dad210417f]

	* src/lib-mail/message-send.c:
	We were sending \0 instead of \r with non-x86 systems.
	[c83031137fdd]

	* src/lib-storage/index/maildir/maildir-copy.c:
	Hardlink copying crashed.
	[640196881ac6]

2003-06-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-quote.c:
	LWSP stripping with NUL/8bit chars set wrong literal size which
	broke things.
	[fa3c261d3556]

	* src/lib/randgen.c:
	Use RAND_bytes() rather than RAND_pseudo_bytes().
	[fa8322b3b7ec]

	* src/login-common/ssl-proxy-openssl.c:
	Make sure PRNG gets initialized before chrooting so it can open
	/dev/urandom.
	[545f6b150e2c]

2003-06-16  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	s/max_logging_users/login_max_logging_users/
	[b566a1ba703e]

	* src/lib/ioloop-select.c:
	compile fixes
	[13111b4073c4]

2003-06-15  Timo Sirainen  <tss@iki.fi>

	* TODO:
	updated
	[25cef50e3b0e]

	* src/imap/cmd-append.c, src/imap/cmd-capability.c, src/imap/cmd-
	copy.c, src/imap/cmd-fetch.c, src/imap/cmd-search.c, src/imap/cmd-
	sort.c, src/imap/cmd-store.c, src/imap/cmd-thread.c, src/imap
	/commands-util.c, src/imap/commands-util.h, src/lib-index/mail-
	index-open.c, src/lib-index/mail-index.h, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-rebuild.c, src/lib-
	index/maildir/maildir-sync.c, src/lib-index/mbox/mbox-index.h, src
	/lib-index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync.c, src
	/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	expunge.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-status.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/index-
	sync.c, src/lib-storage/index/index-update-flags.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/mail-storage.h:
	Only NOOP and CHECK will now always do a real mailbox sync. Other
	commands will also do it but no often than once in 5 seconds. Also
	with maildir we don't anymore try to sync it before running commands
	since syncing is now done automatically whenever we try to access a
	file that doesn't exist.
	[bc3307f2f35d]

	* src/lib-index/maildir/maildir-update-flags.c:
	whops, don't commit debugging
	[313779bde3ec]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.h, src
	/lib-index/maildir/maildir-expunge.c, src/lib-index/maildir/maildir-
	index.h, src/lib-index/maildir/maildir-sync.c, src/lib-index/maildir
	/maildir-update-flags.c, src/lib-storage/index/maildir/maildir-
	storage.c:
	Dirty maildir flags support works now.
	[e1b2614c9e16]

	* src/lib-storage/index/index-storage.c:
	Make sure we unlock index before unreferencing it, since it's not
	actually closed at that time
	[3620bfe9cb05]

	* src/auth/login-connection.c:
	We might have crashed if we ended up killing login processes with
	too old auth requests.
	[9e4129202417]

2003-06-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	"SEARCH DELETED" didn't return anything if all messages were
	deleted.
	[54764a1cde30]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Close index files before deleting the mailbox.
	[9c9ce9c71509]

	* src/lib/mkdir-parents.c:
	Check for EISDIR error as well. Fixed problems with BSD/OS.
	[9ce3f3f950c5]

2003-06-12  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-gnutls.c, src/login-common/ssl-proxy-
	openssl.c:
	OpenSSL proxy changes - hopefully fixes something. Also don't crash
	with "key not found from hash" if SSL handshake fails.
	[ac6ee442376d]

2003-06-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c, src/lib-mail/message-size.c, src/lib-
	mail/message-size.h, src/lib-storage/index/index-mail.c:
	Removed useless parameters from message_get_body_size(). Also did
	some small optimizations to it.
	[7ac153f21949]

2003-06-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-open.c:
	New index files were initialized wrong.
	[e3275092817e]

	* src/lib-index/mail-custom-flags.c:
	mbox with in-memory indexes don't have control_dir and doesn't need
	it, so don't crash then.
	[43ed38ee4415]

	* src/lib-index/maildir/maildir-index.c:
	assert
	[ef1bad8ec45c]

	* configure.in:
	Check dlopen() from libc before from libdl
	[c31852cc94f5]

	* src/imap/client.c, src/imap/cmd-fetch.c, src/imap/cmd-list.c,
	src/imap/cmd-store.c:
	Give more verbose protocol level errors + some fixes.
	[4d1c65eded2c]

	* src/lib-imap/imap-bodystructure.c:
	Add charset/us-ascii into body/bodystructure replies if no charset
	is given for text/* body parts.
	[d4563a5ba30b]

	* src/lib-imap/imap-quote.c:
	Actually it should assume that beginning of string is LWSP..
	[09d4674b1d93]

	* src/lib-imap/imap-quote.c:
	imap_quote_append() shouldn't have checked previous string for lwsp
	[ec85645ad1d9]

	* src/imap/imap-fetch-body-section.c, src/imap/imap-fetch.c, src/lib-
	index/mail-index-update.c, src/lib-index/mail-index.h, src/lib-mail
	/message-parser.c, src/lib-mail/message-parser.h, src/lib-mail
	/message-send.c, src/lib-mail/message-send.h, src/lib-mail/message-
	size.c, src/lib-mail/message-size.h, src/lib-storage/index/index-
	mail.c, src/lib-storage/mail-storage.h:
	IMAP protocol doesn't allow server to send NULs to client. Send
	ascii #128 instead.
	[676995d7c0ca]

	* src/lib-imap/imap-quote.c, src/lib-imap/imap-quote.h:
	imap_quote*() will now pack all LWSP into a single space and convert
	NULs to ascii 128.
	[76d44dda0f32]

	* src/lib-mail/message-parser.c:
	message_parse_header(): skip all LWSP after ':' or in continued
	header. It's not what RFC2822 says, but it's historically better
	behaviour.
	[d15bfc7cae1c]

	* src/lib-index/maildir/maildir-sync.c:
	Handle syncing better while uidlist is locked.
	[d8c58244a5e9]

	* src/lib/failures.c:
	Log using current time, not ioloop_time.
	[b922df9af4de]

2003-05-30  Timo Sirainen  <tss@iki.fi>

	* src/master/ssl-init-openssl.c:
	was missing #ifdef HAVE_OPENSSL
	[edffbb824d96]

	* src/lib-storage/index/index-storage.c:
	Keep mailbox indexes cached for a while after they've been closed.
	Should speed up at least multiple APPENDs.
	[5e45e1cefb8d]

	* src/lib-storage/index/index-status.c:
	If we're asking only custom flags (eg. APPEND), don't do any mailbox
	syncing.
	[ec674fd47b2c]

	* src/auth/auth-module.c:
	Again RTLD_* fixes.
	[76c89608e4bb]

	* src/lib/module-dir.c:
	All systems don't define RTLD_GLOBAL and RTLD_NOW. Default them to
	0.
	[89aabeac23a3]

	* configure.in:
	dlopen wasn't actually checked from libc..
	[d3015271bb1f]

	* src/lib-index/maildir/maildir-sync.c:
	cleanup
	[626fc3f703a8]

	* src/lib-index/maildir/maildir-sync.c:
	expunges were broken
	[ea0cabfeba02]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Some fixes/cleanups for cases when maildir doesn't exist
	[4236ee2a4ac3]

	* src/lib-index/maildir/maildir-sync.c:
	comment update
	[bbfcb7174733]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.h, src
	/lib-index/maildir/maildir-sync.c:
	Fixes for syncing mails that are kept in new/ dir.
	[237c7b872138]

	* src/lib-index/maildir/maildir-uidlist.h:
	Removed unused variable.
	[3720471597f7]

	* src/lib-index/maildir/maildir-sync.c:
	bugfix
	[5c69634f67c6]

	* src/lib-index/mail-index-data.c:
	mail_index_data_get_mmaped() didn't work with in-memory indexes
	[7457ebcf0518]

	* src/lib-index/maildir/maildir-sync.c:
	Use less memory
	[6842036f8931]

	* src/lib-index/maildir/maildir-sync.c:
	whops, removed debugging code
	[1c889e094fb5]

	* src/lib-index/mail-index.h, src/lib-index/maildir/maildir-sync.c,
	src/lib-index/maildir/maildir-uidlist.c, src/lib-index/maildir
	/maildir-uidlist.h, src/lib-index/maildir/maildir-update-flags.c:
	uidlist file is read/updated much less often now. did some other
	improvements for syncing as well.
	[f428ef9fc4d3]

2003-05-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-expunge.c, src/lib-index/maildir
	/maildir-update-flags.c:
	flag updates and expunge now set the cur/ dirty-synced to avoid
	extra sync after them.
	[2554c25f5519]

2003-05-28  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Check if dlopen is in libc too.
	[a4ad03c210af]

	* src/lib-index/maildir/maildir-sync.c:
	bugfix with a temporary kludge
	[f275115c6a1f]

	* src/imap/cmd-append.c:
	Fixed memory leak.
	[69261ad92783]

	* src/pop3-login/client-authenticate.c:
	STLS was missing from capability list.
	[64b8d6b2b457]

2003-05-27  Timo Sirainen  <tss@iki.fi>

	* src/pop3/commands.c:
	If mail didn't end with linefeed, we sent it wrong.
	[1fad8b3d7ef1]

2003-05-26  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/lib/restrict-access.c, src/lib/restrict-
	access.h, src/master/auth-process.c, src/master/login-process.c,
	src/master/mail-process.c:
	Allow first_valid_gid to be 0. Drop any supplementary groups not in
	valid gid range.
	[e7c627bacaaf]

	* src/lib-index/mail-index-util.c:
	more verbose error message for "lock timeout"
	[761bd2c8fefa]

	* src/lib/ioloop-poll.c:
	bugfix
	[637b21e11a72]

2003-05-24  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-poll.c:
	fix
	[6cfb4a7e7c1a]

	* src/lib/ioloop-poll.c, src/lib/ioloop-select.c, src/lib/ioloop.c:
	bugfixes
	[4bff65d2a4b6]

2003-05-23  Timo Sirainen  <tss@iki.fi>

	* src/master/ssl-init-openssl.c:
	wasn't supposed to be committed
	[98850f1c4ab9]

	* src/lib/ioloop-poll.c:
	Extra asserts
	[40b6118245b2]

	* src/auth/login-connection.c, src/auth/main.c, src/auth/master-
	connection.c, src/imap-login/client-authenticate.c, src/imap-
	login/client.c, src/imap/client.c, src/lib-index/mbox/mbox-
	rewrite.c, src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/mbox/mbox-expunge.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/subscription-file/subscription-file.c,
	src/lib/ioloop-internal.h, src/lib/ioloop-poll.c, src/lib/ioloop-
	select.c, src/lib/ioloop.c, src/lib/ioloop.h, src/lib/ostream-
	file.c, src/lib/ostream.h, src/login-common/auth-connection.c,
	src/master/auth-process.c, src/master/login-process.c, src/master
	/ssl-init-openssl.c, src/pop3-login/client.c, src/pop3/client.c:
	Removed I/O priorities. They were pretty much useless and were just
	getting in way.
	[e850252cdc7e]

	* src/imap/main.c:
	Minor speedup
	[5a247fb1673c]

	* src/lib/ioloop-poll.c:
	minor speedup
	[cdd898d549db]

	* src/lib/ioloop-poll.c:
	Clear old poll revents when removing the IO. Just extra sanity
	check.
	[aa1e8b09b580]

	* src/lib-mail/message-parser.c:
	Reset line->name and full_value* fields at end of headers. Envelope
	parser was treating the EOH as duplicate of last header.
	[4d358048e9d7]

2003-05-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-sync.c:
	Fixed index corruption
	[2722aa2c152e]

2003-05-20  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	Check that imap/pop3 module directories exist if they're enabled.
	Give a warning if module support is enabled in config file but not
	built into binary.
	[f2dbea57e997]

	* src/login-common/ssl-proxy-openssl.c:
	Generate temporary RSA key when requested. Could be slow, should do
	some caching in master process side..
	[383d87166963]

	* src/lib-index/mbox/mbox-from.c:
	Support From-lines which contain timezone in timestamp.
	[92fb0d55eee9]

2003-05-19  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	fixes
	[63242ba50ea4]

	* src/lib/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib
	/mempool-system.c, src/lib/mempool.h:
	Added pool_get_name(), for debugging mostly.
	[826bed85c807]

	* src/lib-index/mbox/mbox-index.c:
	crahsfix
	[1263becf7cdb]

	* src/lib/ostream-file.c:
	fixes
	[ea32969a28b7]

2003-05-18  Timo Sirainen  <tss@iki.fi>

	* src/imap-login/client.c, src/pop3-login/client.c:
	s/host/addr/ in variables
	[2f5b3da28dd9]

	* src/imap-login/client.c, src/lib/fd-close-on-exec.c,
	src/lib/network.c, src/lib/network.h, src/login-common/ssl-proxy-
	gnutls.c, src/login-common/ssl-proxy-openssl.c, src/master/mail-
	process.c, src/pop3-login/client.c:
	s/host/addr/ in a few network functions
	[8c28289a15a1]

	* src/master/mail-process.c:
	Send client's IP to mail process.
	[8b3e16678100]

	* src/lib-storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib/Makefile.am, src/lib/compat.h, src/lib
	/mkdir-parents.c, src/lib/mkdir-parents.h:
	More robust error handling for mbox.
	[836c952e17ec]

	* src/lib-index/mail-custom-flags.c, src/lib-index/maildir/maildir-
	index.c, src/lib-index/maildir/maildir-sync.c, src/lib-index/maildir
	/maildir-uidlist.c, src/lib-index/maildir/maildir-update-flags.c:
	Some fixes to handling read-only maildirs.
	[4da66d98246c]

	* src/lib-index/mail-index.h, src/lib-index/maildir/Makefile.am, src
	/lib-index/maildir/maildir-build.c, src/lib-index/maildir/maildir-
	expunge.c, src/lib-index/maildir/maildir-index.c, src/lib-
	index/maildir/maildir-index.h, src/lib-index/maildir/maildir-open.c,
	src/lib-index/maildir/maildir-sync.c, src/lib-index/maildir/maildir-
	uidlist.c, src/lib-index/maildir/maildir-update-flags.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-expunge.c:
	Maildir syncing updates: it's now faster, it handles read-only
	folders, it handles many out of disk space conditions (uidlist
	doesn't) and all commands finally handle the condition when maildir
	filename was renamed after our syncing but before we had the chance
	to open it.
	[f59981f49782]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.c, src
	/lib-index/mbox/mbox-index.c:
	Misc. fixes.
	[135ac8354a8c]

2003-05-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h, src/lib-index/maildir/maildir-index.c, src
	/lib-index/maildir/maildir-index.h, src/lib-index/maildir/maildir-
	uidlist.c, src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-
	index.h, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.h:
	Maildir: CONTROL=<dir> in MAIL environment now specifies where to
	save .customflags and dovecot-uidlist files. This can be useful if
	the main mail directory is under hard quota.
	[6f5d7b43fe53]

	* src/lib/ostream-file.c:
	Automatically set file streams to blocking and don't try to io_add()
	them.
	[ce6521e4a191]

	* src/lib-storage/mail-save.c:
	If there's no limit in stream, don't fail with "unexpected EOF".
	[280e6d3772c9]

	* src/lib/ostream-file.c:
	Don't try to cork files.
	[6e2806114f44]

2003-05-16  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop.c:
	If there were no timeouts, struct timeval wasn't initialized and
	select() might have failed because of it. Patch by Mark E. Mallett.
	[474e4b205af7]

	* src/imap-login/client-authenticate.c:
	If client tries to do LOGIN even if it's disabled, send [ALERT] to
	user.
	[e0065ebba5b3]

	* src/imap-login/client-authenticate.c, src/imap-login/client-
	authenticate.h, src/imap-login/client.c, src/pop3-login/client-
	authenticate.c:
	Don't advertise AUTH=PLAIN in capability if disable_plaintext_auth =
	yes and SSL/TLS is not yet negotiated.
	[7709e997903f]

2003-05-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-data.c:
	Reset the header using mmaped memory + msync, instead of lseek() +
	write() which was buggy with OpenBSD (didn't update the mmap).
	[74e28b26b4eb]

	* src/auth/master-connection.c, src/imap/commands.c, src/imap/imap-
	sort.c, src/lib-charset/charset-iconv.c, src/lib-charset/charset-
	utf8.c, src/lib-index/mail-index-update.c, src/lib-index/mail-
	modifylog.c, src/lib-index/mbox/mbox-index.c, src/lib-mail/message-
	part-serialize.c, src/lib/buffer.c, src/lib/buffer.h, src/lib/str.c:
	Renamed buffer_*_space() to buffer_*_space_unsafe() and added
	several warnings about using them. Fixed their usage in a few places
	in sources where they could have produced invalid results (no buffer
	overflows, luckily).
	[8f56379c3917]

2003-05-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-index.c:
	mboxes were always selected read-only
	[f5e7019f6c46]

	* src/auth/passdb.c, src/auth/userdb.c:
	AUTH_MODULES -> HAVE_MODULES
	[d274446d6fb8]

	* src/master/login-process.c, src/master/mail-process.c:
	fix
	[8b7f631a83c3]

	* configure.in:
	No, still no oracle here..
	[4bfaa07d1ff6]

	* src/lib/module-dir.c, src/lib/module-dir.h:
	missing
	[5ecbc9f82019]

	* INSTALL, configure.in, dovecot-example.conf, src/auth/Makefile.am,
	src/auth/auth-module.c, src/imap/Makefile.am, src/imap/main.c,
	src/lib/Makefile.am, src/master/Makefile.am, src/master/login-
	process.c, src/master/mail-process.c, src/master/mail-process.h,
	src/master/master-settings.c, src/master/master-settings.h,
	src/pop3/Makefile.am, src/pop3/main.c:
	Added support for dynamically loadable imap/pop3 modules.
	[03dd87873a81]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-uid.c,
	src/imap/commands.c, src/imap/commands.h, src/imap/main.c:
	Added command_register() and related functions so we can dynamically
	register new commands.
	[bd489d13479e]

2003-05-12  Timo Sirainen  <tss@iki.fi>

	* src/imap/Makefile.am:
	fix
	[fcc01d10868c]

	* configure.in, src/lib-index/maildir/Makefile.am, src/lib-
	index/mbox/Makefile.am:
	libstorage_index_* -> libindex_*
	[314a91d2761f]

	* src/imap/Makefile.am, src/pop3/Makefile.am:
	Dependency fixes
	[a7676687aac9]

	* src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth/userdb-
	passwd.c:
	Don't check errno of getpwnam() and getspnam() functions. They don't
	seem to be set correctly in all systems and it's unlikely the error
	is anything else than "user doesn't exist".
	[88e6a4040955]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Don't give internal errors when trying to select, delete or rename
	(non-existing) mailboxes under mbox.
	[4b643fcae5c8]

2003-05-11  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	Unexpected SSL connection errors sometimes crashed
	[98362534b2c7]

	* src/login-common/ssl-proxy-openssl.c:
	cleanups
	[7dd0e88ed7ef]

	* src/lib-storage/subscription-file/subscription-file.c:
	If we don't have access to write subscriptions file, say "permission
	denied" to user rather than internal error
	[616feacd6bd4]

2003-05-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	DELETE should report success to client even if it can't actually
	delete the folder, as long as it can rename it to "..dir".
	[4f7d146f6201]

2003-05-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-build.c, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-sync.c:
	We have to sync dovecot-uidlist before indexing mails in new/ dir or
	we'll get UID conflicts.
	[80f82c6a3250]

	* src/lib/unlink-directory.c:
	check lstat() error too
	[30e8a75d7842]

	* src/lib/unlink-directory.c:
	Returned errno was often wrong.
	[22495f001acc]

	* src/lib-storage/index/index-update-flags.c:
	No, actually it's valid for server to just ignore any non-permanent
	flag updates.
	[6de098ab4ef3]

	* src/lib-storage/index/index-expunge.c, src/lib-storage/index/index-
	update-flags.c:
	EXPUNGE should reply OK even if mailbox is read-only. STORE should
	use per-session flags, but we'll leave it as FIXME for now..
	[a9a512a5b388]

	* src/lib-index/mail-index-open.c:
	In-memory indexes didn't set index->opened.
	[393c4cf5260c]

	* dovecot.spec.in:
	Updates by Farkas Levente
	[6820c0caa0ae]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Give "Permission denied" error instead of internal error if some
	call fails with EACCES.
	[0d25b85dbe25]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-index/mbox/mbox-sync.c:
	Don't try to rewrite mbox file if it's read-only.
	[91bb57655d96]

	* src/imap/cmd-close.c, src/lib-index/mbox/mbox-index.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/mbox/mbox-
	storage.c:
	Some fixes to get read-only mboxes working.
	[e29bc94711e2]

	* src/auth/master-connection.c, src/master/mail-process.c:
	bugfix
	[3b9a09c18647]

	* doc/auth.txt, doc/dovecot-ldap.conf, doc/dovecot-pgsql.conf,
	src/auth/auth-master-interface.h, src/auth/db-passwd-file.c,
	src/auth/db-passwd-file.h, src/auth/master-connection.c, src/auth
	/userdb-ldap.c, src/auth/userdb-passwd-file.c, src/auth/userdb-
	passwd.c, src/auth/userdb-pgsql.c, src/auth/userdb.h, src/master
	/auth-process.c, src/master/mail-process.c:
	Chrooting changes. Now all userdbs will support
	"<chroot>/./<homedir>" style home directories.
	[c96290faa106]

	* src/lib-storage/index/mbox/mbox-list.c:
	Crashfix
	[e03d22a64fb0]

	* src/master/auth-process.c, src/master/login-process.c:
	If exec() fails, show the full path rather than argv[0]
	[a83ce8395316]

	* doc/auth.txt:
	Updated for ANONYMOUS
	[d11bd93bc098]

	* src/auth/userdb-passwd.c:
	Support wu-ftpd-like chrooting in /etc/passwd. If home directory
	ends with "/./", it's chrooted to.
	[ff6e38e890bf]

	* src/master/mail-process.c:
	We didn't log if chroot directory was invalid.
	[4b12d0d3bbd7]

	* dovecot-example.conf, src/auth/Makefile.am, src/auth/auth-login-
	interface.h, src/auth/auth-mech-desc.h, src/auth/mech-anonymous.c,
	src/auth/mech.c, src/auth/mech.h, src/master/auth-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added support for ANONYMOUS SASL mechanism.
	[c27c6089e933]

	* src/auth/mech-plain.c:
	hash.h not needed
	[18d85621dd17]

	* src/lib-mail/message-body-search.c:
	Content-Type wasn't actually set, which caused us to search non-text
	attachments which unnecessarily slows down things.
	[be028b4ce27c]

	* src/lib-storage/index/index-status.c:
	Don't crash with invalid first_unseen_uid_lowwater
	[a80b6837f088]

	* src/imap/imap-fetch-body-section.c:
	FETCH BODY[HEADER.FIELDS ...] now doesn't crash to assert if header
	line contains NULs. IMAP spec actually forbids sending NULs to
	client, uw-imapd changes them to ascii 128. Currently we send them
	though, that requires some more fixing.
	[a07648daa625]

2003-05-07  Timo Sirainen  <tss@iki.fi>

	* src/lib/fdpass.c:
	Use ENOSYS rather than EINVAL for fd_send/fd_recv.
	[13c0031b2522]

	* src/lib-index/maildir/maildir-index.h, src/lib/ioloop-internal.h,
	src/lib/ioloop.h:
	struct timeval requires sys/time.h
	[8a2e1c539faf]

	* src/lib/mmap-util.c:
	remove compiler warnings if we declare madvise() as empty function
	[be6749ad05ad]

	* src/lib-storage/Makefile.am, src/lib-storage/index/Makefile.am, src
	/lib-storage/index/index-save.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/mail-save.c, src
	/lib-storage/mail-save.h:
	cleanup: message saving code isn't index-specific
	[5166b1e09f84]

	* src/lib/fdpass.c:
	Compile even if SCM_RIGHTS isn't supported.
	[5693bddad736]

	* src/lib/compat.c, src/lib/randgen.c:
	Use #warning only with GCC.
	[892b52f53e27]

	* src/lib/fdpass.c:
	Don't redefine _XOPEN_SOURCE_EXTENDED.
	[f5b3575194ed]

2003-05-05  Timo Sirainen  <tss@iki.fi>

	* Makefile.am:
	Keep dovecot.spec in tarball as well.
	[cb661e22730a]

	* src/imap/imap-fetch-body-section.c:
	partial->cr_skipped wasn't reset when changing message
	[d8f10cedbc48]

2003-05-04  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Don't try to set /dev/null fd nonblocking, all systems don't like
	that.
	[3e73d02e5f71]

2003-05-03  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	_still_ no oracle here.
	[b53a185eb4b3]

	* configure.in:
	Removed AM_CONFIG_HEADER accidentally
	[7594cb84e9c8]

	* configure.in:
	oracle wasn't supposed to be here yet
	[d6f5ef2247da]

	* .cvsignore:
	added dovecot.spec
	[94035404deed]

	* Makefile.am, NEWS, TODO, configure.in, dovecot.spec.in:
	0.99.9.1 released. Added redhat spec file.
	[c36d18766a35]

	* src/lib-imap/imap-envelope.c:
	imap_envelope_parse() didn't parse literals correctly.
	[6b925a429544]

	* src/pop3/client.c:
	Removed IMAP-specific comment..
	[36d7bec1da26]

	* src/pop3/client.c:
	Handle inconsistency error separately.
	[c1a7da406bbd]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-index.c,
	src/lib-index/mbox/mbox-index.h:
	Rewrite Content-length header if it's broken. UID-validity change
	checking was broken when first message was added to empty mbox.
	[dcc9b7b868d8]

	* src/lib-mail/message-parser.c:
	We stopped parsing message if there was a line longer than input
	buffer (8192 bytes).
	[f9f69a6fdd63]

	* src/pop3/client.c:
	If no error is set, give "BUG: Unknown error" rather than try to
	print NULL which crashes in some systems.
	[ac714d7d0b67]

2003-04-30  Timo Sirainen  <tss@iki.fi>

	* src/lib/fdpass.c:
	Define _XOPEN_SOURCE only for IRIX.
	[027a528ebf01]

2003-04-28  Timo Sirainen  <tss@iki.fi>

	* NEWS, TODO, configure.in:
	0.99.9 released
	[ccb430d3b945]

	* src/lib/macros.h:
	Added __attr_scanf__
	[978cd1c0e6b0]

	* src/imap/commands-util.c:
	minor fix
	[29b56293067b]

	* doc/Makefile.am:
	Added dovecot-pgsql.conf
	[64e3e51001f5]

	* src/pop3/Makefile.am:
	Use STORAGE_LIBS.
	[02c192ea6f31]

	* src/lib/fdpass.c:
	AIX fix
	[fd9419b90b12]

2003-04-27  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/lib-index/Makefile.am:
	--with-storage=maildir,mbox can now be used to compile in only the
	wanted storage formats.
	[54015ae11177]

	* configure.in:
	fix
	[8d12b2a608c5]

	* src/lib-index/mbox/mbox-index.c:
	Use Content-Length: 0 too
	[f35c2472bb30]

	* src/lib/istream.c:
	i_stream_seek() broke stream if read limit was set.
	[5fe1597c6674]

	* src/lib/ioloop-internal.h:
	"invalid" no longer needed.
	[0c9fda55b4d6]

	* src/lib/ioloop-poll.c:
	Better handling for POLLNVAL.
	[c3c2754040ad]

	* src/login-common/main.c, src/master/login-process.c:
	Moved setting process limit after exec().
	[b2a2edafdd91]

	* src/lib/restrict-process-size.c:
	cleanup
	[f6ae4dc25427]

	* AUTHORS:
	update
	[47d79a08aebd]

	* doc/nfs.txt:
	updated
	[b7fa9a51611b]

	* configure.in, src/lib-index/mail-index-data.c, src/lib-index/mail-
	index-open.c, src/lib-index/mail-index-update.c, src/lib-index/mail-
	index.h:
	Use separate index alignment from memory alignment. We don't use
	pointers in index file so required alignmentation comes pretty much
	from sizeof(off_t).
	[059f13d577bb]

	* src/lib-index/maildir/maildir-uidlist.c:
	bugfix
	[c0d6ab3ee2d0]

	* doc/dovecot-pgsql.conf, src/auth/db-pgsql.c, src/auth/userdb-
	pgsql.c:
	Fixes and support for system_user, mail and chroot settings
	[55c9f99cdd3e]

	* src/imap/imap-fetch-body-section.c, src/imap/imap-fetch.c, src/lib-
	mail/message-send.c, src/lib-mail/message-send.h, src/lib-mail
	/message-size.c, src/lib-mail/message-size.h:
	Partial fetches were broken when they stopped between virtual CR and
	LF.
	[e0dbaabbc22b]

2003-04-25  Timo Sirainen  <tss@iki.fi>

	* src/lib/fdpass.c:
	Fix for IRIX
	[a7b1ec1ec8ba]

	* configure.in:
	mem_align test was broken
	[56f6dc5f3451]

	* configure.in:
	Use mem_align=4 with 32bit off_t
	[683a8202c037]

2003-04-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-data.c, src/lib-index/mail-index.c, src
	/lib-index/mail-tree.c, src/lib-index/maildir/maildir-rebuild.c, src
	/lib-index/mbox/mbox-rebuild.c:
	Don't call msync() with with in-memory indexes.
	[dfa23fc2f370]

	* src/lib/fdpass.c:
	#ifdef _AIX, not AIX
	[5d16da99b537]

	* src/lib-index/mail-index-open.c:
	Compile fix
	[56d0608a4d17]

	* src/lib/mmap-anon.c:
	and disable debugging :)
	[8602e89a875c]

	* src/lib/mmap-anon.c:
	mremap_anon() was broken when it had to move data.
	[99e862a41b46]

	* configure.in:
	Don't define OFF_T_MAX if it's already defined
	[c4d519a6395d]

	* src/lib/mmap-anon.c:
	mmap(MAP_FIXED) may return ENOMEM as well as EINVAL if
	address+length isn't valid. Also some other cleanups.
	[8ef24a824568]

	* src/lib-storage/index/index-messageset.c:
	Fail if sequence numbers in messageset are out of range.
	[7dff693ab2b2]

	* src/lib-index/mail-index-data.c, src/lib-index/mail-index-open.c,
	src/lib-index/mail-modifylog.c, src/lib-index/mail-tree.c:
	Don't crash if mmap_anon() doesn't succeed.
	[42d30992c0a4]

2003-04-22  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-delete.c:
	allow deleting selected mailbox
	[bda297ecd516]

	* src/imap/commands-util.c:
	Give BAD instead of NO when trying to use selected state command in
	non-selected state.
	[b0f075271b2f]

	* src/lib-storage/index/index-search.c:
	More SEARCH OR fixes.
	[1664a3d51a74]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-search.c:
	SEARCH OR fixes.
	[a3521f4ca773]

	* src/lib-imap/imap-date.c, src/lib-mail/message-date.c:
	Still some timezone fixes
	[008f837263f3]

	* src/lib-index/maildir/maildir-sync.c:
	bugfix
	[9284e4e3d967]

2003-04-21  Timo Sirainen  <tss@iki.fi>

	* src/auth/mycrypt.c, src/lib/fdpass.c:
	AIX fixes.
	[7a7e58744e0a]

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/mbox/mbox-save.c:
	fsync() saved mails
	[b73c2bdd12d0]

	* src/lib-index/mail-index.h, src/lib-index/maildir/maildir-sync.c,
	src/lib-index/maildir/maildir-uidlist.c, src/lib-index/maildir
	/maildir-uidlist.h:
	Use mtime to check changes in dovecot-uidlist file rather than inode
	changes which aren't reliable.
	[5f521a721671]

2003-04-17  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-dotlock.c:
	We got dotlock's mtime before modifying it, which caused problems
	sometimes.
	[945f857cb514]

2003-04-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-open.c:
	Don't set any default cache_fields when building index into memory.
	[33cf08305781]

	* src/master/mail-process.c, src/master/main.c:
	chdir() to base_dir at startup. chdir() mail processes to home dir
	if it's known.
	[533bb936e674]

	* src/lib-index/maildir/maildir-rebuild.c:
	Don't crash if there's tree file hasn't been opened yet.
	[b2005542fc93]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-tree.c, src/lib-
	index/mail-tree.h, src/lib-index/maildir/maildir-rebuild.c, src/lib-
	index/maildir/maildir-sync.c:
	Some fixes to opening index.
	[6f65cc862649]

	* src/pop3/main.c:
	cleanup
	[33426716797a]

	* src/pop3/client.c, src/pop3/client.h, src/pop3/main.c:
	Crashfix if there was some errors while opening mailbox
	[383e4b9e347c]

	* src/lib-index/maildir/Makefile.am, src/lib-index/maildir/maildir-
	build.c, src/lib-index/maildir/maildir-index.h, src/lib-
	index/maildir/maildir-update.c:
	If we don't want to precache anything, don't open the file at all
	when building index.
	[085c5b7a69ad]

	* src/auth/db-passwd-file.c, src/auth/db-passwd-file.h, src/auth
	/passdb-passwd-file.c, src/auth/userdb-passwd-file.c:
	passwd-file fixes. passdb ignores now fields after password, so it
	can work with shadow-like file.
	[dc2163fafa70]

	* src/lib-index/mail-index.c:
	DEBUG: Don't crash with in-memory indexes
	[5c67f77e4116]

2003-04-15  Timo Sirainen  <tss@iki.fi>

	* src/lib/file-dotlock.c:
	Use different warning message for dotlock mtime change.
	[bbcbe27926ad]

	* src/master/common.h, src/master/login-process.c, src/master/mail-
	process.c, src/master/mail-process.h, src/master/main.c:
	Separate PROCESS_TYPE_MAIL into IMAP and POP3.
	[70b60399c7d3]

	* src/imap/imap-fetch-body-section.c:
	FETCH BODY[HEADER.FIELDS ...] crashed
	[5986d8920b86]

2003-04-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-index.h, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-storage/index/mbox/mbox-save.c:
	More optimized mbox rewriting. It now tries to shrink/extend the
	filler in x-keywords header.
	[026ae7f33d61]

	* src/lib-index/mbox/mbox-lock.c, src/lib-storage/index/mbox/mbox-
	storage.c:
	Don't crash if there was locking problems when trying to rewrite
	mbox.
	[96e28b964269]

2003-04-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-data.c:
	mmap_used_length should be updated too when data is appeneded
	[50d1902b4928]

	* src/lib-index/maildir/maildir-sync.c:
	minor cleanup
	[bde1b4fb2852]

	* src/lib-index/maildir/maildir-sync.c:
	Expunging mails broke syncing
	[f447f121fbe5]

2003-04-11  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h, src/lib/ioloop.c, src/pop3/main.c:
	minor memory leak/cleanup fixes
	[6709d9330885]

	* src/lib/mempool-alloconly.c:
	p_clear() left only the smallest block, not the largest block
	[68544dbee475]

	* src/lib/failures.c:
	Free memory at exit
	[3bd74a1326c9]

2003-04-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-sync.c:
	a bit memory allocation tweaks
	[883ba6a7db44]

2003-04-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-sync.c:
	Don't index new mails in cur/ if we don't have uidlist.lock
	[80bd51c7d60f]

	* src/lib-index/maildir/Makefile.am:
	missing maildir-uidlist.h
	[6fa223de19f9]

	* src/lib/ostream-file.c, src/lib/sendfile-util.c:
	Call safe_sendfile() only with sockets, and also with files under
	Linux. Hopefully helps for signal 12 under FreeBSD.
	[04b81672c3a3]

	* src/lib-index/mail-index.h:
	We don't need these fields
	[2dcd8cebe5e6]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.h, src
	/lib-index/maildir/Makefile.am, src/lib-index/maildir/maildir-
	build.c, src/lib-index/maildir/maildir-index.c, src/lib-
	index/maildir/maildir-index.h, src/lib-index/maildir/maildir-
	rebuild.c, src/lib-index/maildir/maildir-sync.c, src/lib-
	index/maildir/maildir-uidlist.c, src/lib-index/maildir/maildir-
	uidlist.h, src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h:
	Rewritten maildir syncing. Uses dovecot-uidlist file to store UIDs
	permanently.
	[e80c784252ea]

	* src/lib-imap/imap-envelope.c:
	Don't crash if mail doesn't have any headers.
	[f1dc24e5bc0f]

	* configure.in:
	use test -c for checking /dev/urandom. test -e doesn't work in
	solaris.
	[fe6f252a389f]

	* src/lib-storage/index/index-messageset.c, src/lib-storage/index
	/index-search.c:
	s/latest IMAP4rev1 draft/RFC-3501/
	[087a9f4304ca]

2003-04-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/passdb-passwd-file.c:
	default is CRYPT, not DES (which doesn't even exist)
	[379509d0c196]

	* src/lib/fdpass.c, src/master/login-process.c:
	Tru64 fixes. More comments.
	[04ed7a2536cc]

2003-04-06  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-copy.c:
	hardlink copying was broken again
	[0f2e0b39a747]

2003-04-04  Timo Sirainen  <tss@iki.fi>

	* src/lib/randgen.c:
	compilefix
	[adca691bd671]

	* configure.in, src/auth/Makefile.am, src/lib/randgen.c:
	Support using OpenSSL's pseudo-random generator instead of
	/dev/urandom. If neither are found, allow dovecot-auth still to be
	started because currently only DIGEST-MD5 requires prng.
	[5ad84c54eb7e]

	* src/imap/imap-fetch-body-section.c:
	compile warning fixes
	[968c9d53506a]

	* Makefile.am:
	config.rpath was missing
	[1fa88503bbe6]

	* src/lib/fdpass.c:
	Compile fix for tru64
	[f2f3fe0916c1]

	* src/auth/md5crypt.c, src/auth/md5crypt.h, src/auth/password-
	scheme.c:
	MD5crypt password fixes.
	[d55cf9c28062]

2003-04-02  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-pgsql.conf, dovecot-example.conf, src/auth/db-ldap.c,
	src/auth/db-pgsql.c, src/auth/db-pgsql.h, src/auth/mech-digest-
	md5.c, src/auth/mech-plain.c, src/auth/mech.c, src/auth/mech.h,
	src/auth/passdb-pgsql.c, src/auth/userdb-pgsql.c, src/master/auth-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Moved auth_username_chars from db-pgsql to generic for all. Some
	other auth code cleanups.
	[7cde19dbe754]

	* src/imap/cmd-list.c, src/imap/cmd-status.c, src/lib/strescape.c,
	src/lib/strescape.h:
	Mailbox names are now sent through imap-quoter instead of just
	escaping it. This means that mailbox names that would require
	escapes are instead sent as literals now.
	[ae229b7acb4c]

	* dovecot-example.conf, src/auth/mech-digest-md5.c, src/auth/mech-
	plain.c, src/auth/mech.c, src/auth/mech.h, src/master/auth-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added auth_default_realm (based on patch by Kristian Hoffmann)
	[0a524d229f50]

2003-04-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c:
	crashfix
	[36ba64c5dbb2]

	* src/lib-mail/message-body-search.c, src/lib-mail/message-parser.c:
	crashfix
	[baf63e166aeb]

2003-03-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-index-
	compress.c, src/lib-index/mail-index-data.c, src/lib-index/mail-
	index-util.c, src/lib-index/mail-modifylog.c, src/lib-index/mail-
	tree.c, src/lib-index/maildir/maildir-index.c, src/lib-storage/index
	/index-save.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/mbox/mbox-save.c, src/lib/compat.h:
	Handle EDQUOT errno as "not enough disk space" like ENOSPC.
	[e026f8e4d241]

2003-03-29  Timo Sirainen  <tss@iki.fi>

	* src/login-common/ssl-proxy-openssl.c:
	rewrite, maybe it works properly now.
	[13d8f69d4f1a]

2003-03-26  Timo Sirainen  <tss@iki.fi>

	* doc/nfs.txt:
	updated
	[c0ecdcaca2a6]

	* src/imap/imap-fetch-body-section.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	envelope.h, src/lib-imap/imap-quote.c, src/lib-index/mail-index-
	update.c, src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-
	index.h, src/lib-index/mbox/mbox-rewrite.c, src/lib-mail/message-
	body-search.c, src/lib-mail/message-parser.c, src/lib-mail/message-
	parser.h, src/lib-storage/index/index-mail.c, src/lib-storage/index
	/index-mail.h, src/lib-storage/index/index-save.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/mbox/mbox-save.c:
	Better handling for multiline headers. Before we skipped headers
	larger than input buffer size (8k with read (default), 256k with
	mmap). The skipping was also a bit buggy.

	Now we parse the lines one at a time. There's also a way to read the
	header fully into memory before parsing it, if really needed.
	[97f8c00b8d4c]

	* src/lib-imap/imap-envelope.c, src/lib-imap/imap-envelope.h, src/lib-
	imap/imap-quote.c, src/lib-imap/imap-quote.h, src/lib-index/mail-
	index-update.c, src/lib-storage/index/index-mail.c:
	memory usage fixes
	[1a5705eb23d4]

	* src/lib/data-stack.c:
	When data stack grew larger than two blocks, t_pop()ing crashed when
	trying to free extra blocks.
	[e9e08440df77]

	* src/lib-storage/index/index-mail.c:
	fix extra memory usage
	[233eb6e394bb]

	* dovecot-example.conf:
	Removed default auth_chroot directory from digest-md5 case. If you
	really want it, you know where to set it.
	[d041581ddebf]

	* INSTALL:
	s/imap-master/dovecot/
	[8cdbade3c75f]

	* src/imap/main.c:
	Support for mailfront.
	[02dc0b35af64]

2003-03-24  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body-section.c:
	FETCH BODY[part]<partial> didn't work correctly
	[d69f8b4adaf6]

2003-03-22  Timo Sirainen  <tss@iki.fi>

	* src/lib/lib.c:
	compile warning fix
	[bd8e8495c7b3]

2003-03-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-util.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib/file-dotlock.c, src/lib/lib.c:
	Call the hostpid_init() always at startup. Easier than doing it all
	around.
	[c4fa748b9f24]

	* src/lib/istream-internal.h, src/lib/istream.c:
	Fixes for resetting stream limits. Should fix some APPEND problems.
	[c893ba64db07]

2003-03-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-parser.c:
	Literals didn't work if they weren't the last argument.
	[dab8da005325]

	* src/imap/cmd-list.c, src/lib-storage/index/maildir/maildir-list.c:
	More kludgy LIST fixes for maildir subfolders
	[f0ae8979b0ab]

	* src/imap/cmd-list.c:
	LIST "" foo.% doesn't anymore reply "foo." folder.
	[326e0826467c]

	* src/lib-imap/imap-parser.c:
	We didn't stop after reading literal size. This broke using non-
	synced literals with APPEND.
	[f19fbca465fb]

2003-03-19  Timo Sirainen  <tss@iki.fi>

	* doc/dovecot-pgsql.conf:
	forgot to add
	[e360dc131150]

2003-03-18  Timo Sirainen  <tss@iki.fi>

	* src/imap/imap-fetch-body-section.c:
	Partial body fetches were buggy
	[a36ab9657f52]

2003-03-17  Timo Sirainen  <tss@iki.fi>

	* src/lib/ostream-file.c:
	file offset wasn't kept right.
	[06e9bb095cb3]

	* src/imap/Makefile.am, src/pop3/Makefile.am:
	more fixes..
	[f363925f2f45]

	* src/imap/Makefile.am, src/pop3/Makefile.am:
	iconv fixes
	[7930081ae331]

	* src/imap/cmd-select.c:
	Whops, test reverted back.
	[7fe3ad564eac]

	* src/lib/fd-close-on-exec.c:
	Don't assume that major() and minor() are unsigned ints.
	[cf06c49f6d87]

	* config.rpath, configure.in, src/imap/Makefile.am, src/imap/cmd-
	select.c, src/lib-charset/charset-iconv.c, src/lib-charset/charset-
	utf8.c, src/pop3/Makefile.am:
	Better iconv() checking.
	[952bf533c2ea]

2003-03-16  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-passwd-file.c:
	Fixes to parsing userdb fields.
	[e7ece7cfb14c]

2003-03-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	Renaming maildir subfolders inserted extra "." in the middle.
	[c2935bbfd399]

	* src/auth/passdb.c, src/auth/userdb.c:
	cleanups
	[1bab80054775]

2003-03-14  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-pgsql.c, src/auth/db-pgsql.h, src/auth/passdb-pgsql.c,
	src/auth/userdb-pgsql.c:
	Whops, forgot to add.
	[a9ac5865daf8]

	* dovecot-example.conf:
	updated first_valid_uid comment
	[cc9b61b9959e]

	* src/master/mail-process.c:
	"mail process isn't allowed to use UID %s (modify first_valid_uid in
	config file)"
	[9f8a41f1edae]

2003-03-10  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-passwd-file.c, src/lib-settings/settings.c,
	src/lib/istream.c, src/lib/istream.h:
	Added i_stream_read_next_line()
	[2f2c6335ed6d]

2003-03-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-index.c, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-open.c, src/lib-
	index/maildir/maildir-sync.c:
	cleanup
	[359334706e65]

	* src/lib-storage/index/mbox/mbox-list.c:
	mbox: LIST "" invalid-directory/% doesn't anymore give internal
	error
	[ddb4ebbf32a9]

	* src/imap/cmd-create.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage.h:
	mbox: CREATE mailbox/ now mkdir()s it.
	[9562ba6af1f1]

	* src/lib-storage/index/index-fetch.c:
	FETCH: \Seen flag updating didn't work (eg. FETCH BODY[]).
	[c6c7867b2f6f]

	* src/lib-imap/imap-parser.c:
	Literal parser broke if \r\n wasn't in buffer at the time '}' was
	parsed.
	[fa47d787c2aa]

2003-03-07  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	pgsql check fixes
	[38b7fe3a596e]

	* configure.in:
	cleanup
	[b8ecb067141a]

	* src/auth/userdb-vpopmail.c:
	Log vpop_user + vpop_domain too. They may be different from original
	username after parse_email()..
	[89d6b54b203a]

	* configure.in, src/auth/Makefile.am:
	cleanups
	[71f61b6a0f02]

	* INSTALL, configure.in, doc/auth.txt, doc/dovecot-ldap.conf, dovecot-
	example.conf, src/auth/Makefile.am, src/auth/passdb.c,
	src/auth/passdb.h, src/auth/userdb.c, src/auth/userdb.h:
	Added PostgreSQL support, patch by Alex Howansky
	[2d8af547a8b4]

2003-03-06  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c, src/auth/db-ldap.h:
	Added ldap_version setting.
	[e8894f2c776f]

	* src/imap-login/client.c, src/login-common/main.c:
	We didn't work at all in non-inetd mode. Also fix crash when
	quitting.
	[043b71a06568]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index-update.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-index.c, src/lib-index/mbox/mbox-append.c, src
	/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h, src
	/lib-index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c:
	UIDs are now saved into mbox file. added a few rewriting
	optimizations so that we don't always have to rewrite the whole file
	when updating messages at the beginning of file.
	[2ea9661542ee]

2003-03-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-address.c:
	message_address_write() didn't work.
	[b14d1f375039]

	* src/lib-mail/message-address.c:
	message_address_parse(): allow using data_stack_pool
	[4d6c72dc34db]

	* src/lib-storage/index/index-save.c, src/lib-storage/index/index-
	storage.h:
	Compiler warning fixes.
	[c5c17b45cceb]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-build.c, src/lib-index/maildir/maildir-
	index.c, src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-
	index.c:
	Added index->append_abort() to abort append cleanly.
	[3607a2b4f011]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/login-common/Makefile.am, src/login-common
	/auth-connection.c, src/login-common/client-common.h, src/login-
	common/main.c, src/login-common/master.c, src/login-common/master.h,
	src/master/login-process.c, src/pop3-login/client.c,
	src/pop3-login/client.h:
	login: Wait until we're connected to auth process before executing
	command from client.

	inetd usage: --group=name can now specify which login group to use.
	Default is the binary name before '-' character (ie. imap or pop3).
	[af685269ead0]

2003-03-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-save.c:
	Don't crash if something tries to write 0 bytes in headers while
	saving the message. This happened sometimes with mbox.
	[f7fc5d52ac7c]

	* src/login-common/Makefile.am, src/login-common/main.c, src/login-
	common/master.c, src/login-common/master.h, src/master/auth-
	process.c, src/master/common.h, src/master/login-process.c,
	src/master/mail-process.c, src/master/main.c, src/master/master-
	login-interface.h:
	Somewhat working code to support loading Dovecot from inetd and
	such. It still needs possibility to specify which login process to
	use, and LOGIN and AUTHENTICATE commands shouldn't be allowed before
	we're connected to auth process.
	[2cf2e08a6ee9]

	* src/auth/master-connection.c:
	Don't crash if auth request wasn't found.
	[634b5ef110da]

	* src/lib/env-util.c, src/lib/env-util.h, src/lib/restrict-access.c,
	src/lib/restrict-access.h:
	Removed restrict_access_clean_env() and env_remove(). They're not
	needed.
	[0ca6dfe196f1]

	* src/lib/failures.c:
	Handle /dev/stderr directly instead of open()ing.
	[00707938a332]

	* src/lib/fd-close-on-exec.c:
	More verbose error message when leaked fd is noticed.
	[dad400966e72]

	* src/auth/main.c, src/lib/network.c, src/login-common/auth-
	connection.c, src/login-common/ssl-proxy-gnutls.c, src/login-common
	/ssl-proxy-openssl.c, src/master/auth-process.c, src/master/main.c:
	net_* functions don't anymore set sockets to non-blocking by
	default.
	[0d9f0e617a1a]

	* src/lib-imap/imap-quote.c:
	Use literals for strings containing '"' and '\' characters too. This
	wasn't done at all before so FETCH ENVELOPE, BODY and BODYSTRUCTURE
	could have returned pretty broken results.
	[8ceacaf13c9c]

2003-03-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-storage.c:
	Selecting INBOX didn't use index files if full_filesystem_access was
	yes.
	[4cc2a05c5c88]

2003-03-01  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c:
	Setting user_global_uid or user_global_gid crashed.
	[fd2ccb3d67e4]

2003-02-27  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c, src/lib-storage/index/maildir/maildir-list.c:
	Maildir LIST \Children fixes.
	[69642d55545d]

	* src/lib/safe-mkdir.c:
	safe_mkdir(): usage fchmod() and fchown(). chmod() wasn't really
	safe and lchown() wasn't portable.
	[500ec0ec3b85]

2003-02-26  Timo Sirainen  <tss@iki.fi>

	* src/auth/mech-plain.c:
	Invalid PLAIN auth request crashed auth process.
	[7767e5b3e83e]

	* src/master/main.c:
	[::] address wasn't treated exactly as "ipv6 any", but looks like
	gethostbyname() worked with it.
	[5373999355ed]

	* src/master/main.c:
	Added --version
	[e6e81ce8210b]

	* doc/nfs.txt:
	updated
	[3be1497e09b9]

	* doc/index.txt:
	update
	[8672f9897066]

2003-02-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c:
	final fix: text-content subtype wasn't defaulted to plain
	[cee5e11b08f3]

	* configure.in:
	0.99.8 released
	[cb1782907902]

	* src/lib-imap/imap-bodystructure.c:
	Default to 7bit instead of 8bit content-encoding-type.
	[58041ce0a24c]

	* src/lib-storage/index/maildir/maildir-list.c:
	Don't delete ".." dirs outside our imap root.
	[c7bb9cc26e1f]

	* src/lib-mail/message-address.c, src/lib-mail/message-parser.c:
	A few small fixes to MIME and mail address parsers.
	[39b899338c99]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Use less strict mailbox name verification when trying to access
	existing mailboxes. Don't delete directories beginning with ".."
	outside our maildir root (if full_filesystem_access = yes).
	[61decb945930]

	* src/imap/cmd-list.c:
	placeholder -> noselect change broke LIST "" "foo/%" not showing
	foo/.
	[53f8ac273a9b]

2003-02-24  Timo Sirainen  <tss@iki.fi>

	* NEWS, README, TODO:
	updates
	[31510fc5e02f]

	* src/lib/unlink-directory.c:
	fd leak fix
	[9833f1b94f25]

	* src/login-common/ssl-proxy.c:
	Didn't compile without SSL libs
	[a85455157496]

	* src/lib-index/mail-index-util.c:
	Fallback temp file creation into /tmp with in-memory indexes. Used
	only with mbox rewriting.
	[467e79a48848]

	* src/imap/cmd-list.c, src/lib-storage/index/maildir/maildir-list.c:
	Use \PlaceHolder only when listing subscriptions.
	[d850b16d583f]

	* src/lib/ostream-file.c:
	Try to use optimal block sizes when writing to files.
	[06b1b95ae756]

	* configure.in, src/imap/cmd-list.c, src/imap/commands.h, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-list.c, src/lib-
	storage/mail-storage.h:
	Added support for CHILDREN and LISTEXT extensions.
	[40bae47bdba1]

	* src/lib/unlink-directory.c:
	unlink_directory() is now (hopefully) race-condition free.
	[478471737964]

	* doc/mkcert.sh:
	comment update
	[4c5f325df4ac]

	* doc/auth.txt:
	Use pam_unix as example instead of pam_pwdfile.
	[fc8fb4aa5c14]

2003-02-23  Timo Sirainen  <tss@iki.fi>

	* doc/design.txt, doc/index.txt:
	updates
	[6e893f3f9837]

	* src/lib-storage/index/maildir/maildir-storage.c:
	in-memory index crashfixes
	[844bf41d831b]

	* doc/index.txt, doc/mail-storages.txt, dovecot-example.conf, src/lib-
	index/Makefile.am, src/lib-index/mail-custom-flags.c, src/lib-index
	/mail-index-compress.c, src/lib-index/mail-index-data.c, src/lib-
	index/mail-index-open.c, src/lib-index/mail-index-util.c, src/lib-
	index/mail-index.c, src/lib-index/mail-index.h, src/lib-index/mail-
	lockdir.c, src/lib-index/mail-lockdir.h, src/lib-index/mail-
	modifylog.c, src/lib-index/mail-tree.c, src/lib-index/maildir
	/maildir-index.c, src/lib-index/mbox/mbox-index.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c,
	src/master/mail-process.c, src/master/master-settings.c, src/master
	/master-settings.h:
	Index opening rewrites. We don't try to support
	.imap.index-<hostname> style indexes anymore. They just made things
	more difficult, and it's really not a good idea to use index files
	via NFS anyway.

	Added support for :INDEX=MEMORY in MAIL env to disable using index
	files. Also if we can't open or create index file for any reason, we
	now fallback to in-memory indexes. Before we fallbacked only with
	out of disk space errors.

	If .customflags can't be created, we still work now by not allowing
	to create new custom flags.
	[2512ad6fd9e9]

	* src/master/login-process.c:
	..and tell login process about verbose_ssl..
	[9b693201e075]

	* dovecot-example.conf:
	verbose_ssl here too
	[5c73e63c75f7]

	* src/imap-login/client.c, src/login-common/common.h, src/login-
	common/main.c, src/login-common/ssl-proxy-gnutls.c, src/login-common
	/ssl-proxy-openssl.c, src/login-common/ssl-proxy.h, src/master
	/master-settings.c, src/master/master-settings.h,
	src/pop3-login/client.c:
	Added setting verbose_ssl
	[2660b47fd9bc]

	* src/login-common/ssl-proxy-openssl.c:
	bugfix
	[23f28ecd2c21]

	* src/login-common/ssl-proxy-gnutls.c:
	proper deinit for gnutls proxy too
	[42f7c4e8e690]

	* src/login-common/ssl-proxy-openssl.c:
	destroy proxies before destroying ssl context
	[f7da7d46e3f2]

	* src/login-common/ssl-proxy-openssl.c:
	and compiler warning fixes..
	[6352baabd8a1]

	* src/login-common/main.c, src/login-common/ssl-proxy-openssl.c:
	Keep list of the SSL proxies, so they're deinitialized properly if
	we have to kill them.
	[e6d2b8c78519]

	* src/master/main.c:
	Don't listen in imaps/pop3s if ssl_disable = yes. Even if they're
	listed in protocols.
	[88e025c0d1c6]

2003-02-22  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	[ipv6 address] was still buggy in *_listen
	[4e438a5c00d3]

2003-02-21  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-fetch.c, src/imap/cmd-search.c, src/imap/cmd-store.c:
	Sync EXPUNGEs also with UID FETCH and UID STORE.
	[d35e8f84bf71]

	* src/lib-index/mbox/mbox-from.c:
	Support parsing some broken mbox From-lines
	[c0783c50e47c]

	* src/imap/cmd-idle.c:
	cork the output before sending the ending IDLE replies.
	[8c85c03e0485]

	* src/lib/ostream-file.c:
	if connection was closed while trying to write data to client, we
	sometimes crashed. also errno wasn't saved.
	[b661eb87bd26]

	* dovecot-example.conf, src/master/mail-process.c, src/master/main.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added setting mail_drop_priv_before_exec.
	[52e0830ade13]

	* src/lib/env-util.c, src/lib/env-util.h, src/lib/restrict-access.c,
	src/lib/restrict-access.h:
	Added env_remove() and restrict_access_clear_env().
	[ea3f6c93d1a2]

2003-02-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-idle.c:
	handle error condition better
	[bff971233e5d]

	* src/imap/cmd-idle.c:
	fixes
	[fb8cec12d2ee]

	* src/lib-storage/index/index-save.c:
	crashfix
	[e4210f1ea3f1]

	* dovecot-example.conf, src/imap/cmd-list.c, src/lib-imap/imap-
	match.c, src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/mbox/mbox-list.c, src/lib-storage/mail-storage.c, src
	/lib-storage/mail-storage.h:
	Removed list-sort workarounds. It's pretty much needed for maildir
	listing. Also added some more complexity and kludging to make
	everything work correctly.
	[a70ebd3a59e2]

	* src/auth/db-passwd-file.c:
	passwd-file changes. Moved flags before MAIL environment which is
	now last so it allows ':' characters in it..
	[15c1353d74d9]

	* src/lib/strescape.c, src/lib/strescape.h:
	str_unescape(): return char*
	[3784730cfcd8]

	* src/login-common/ssl-proxy-openssl.c:
	error handling fixes
	[69bd0ea4c718]

	* doc/auth.txt, doc/configuration.txt, dovecot-example.conf:
	updates
	[1429fcb2e577]

	* src/imap/cmd-idle.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-storage.c:
	outlook-idle workaround fixes.
	[fee90d8ad273]

	* dovecot-example.conf, src/imap/client.c, src/imap/client.h, src/imap
	/cmd-close.c, src/imap/cmd-idle.c, src/imap/cmd-select.c, src/imap
	/cmd-unselect.c, src/imap/commands-util.c, src/imap/commands-util.h,
	src/imap/common.h, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h:
	workaround: outlook-idle
	[9ced30dda6c3]

	* TODO:
	updated
	[6fd1f2e82c9a]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	src/auth/userdb-ldap.c:
	minor ldap fixes
	[8e6addbf12b3]

	* src/lib-storage/index/index-messageset.c, src/lib-storage/index
	/index-save.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/mbox
	/mbox-save.c:
	mbox: strip some headers when saving message. also always set
	Content-Length header so message may safely contain lines beginning
	with "From ".
	[539b7336b68a]

	* src/lib-index/mbox/mbox-rewrite.c:
	X-Keywords-headers were duplicated
	[3aa40f0dde5f]

	* src/lib/ostream-file.c:
	ostream: get initial offset. flush buffer before seeking.
	[cf9558657ded]

2003-02-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.h:
	Include microseconds in maildir filename base.
	[60770e7e3dea]

	* src/lib-storage/index/index-save.c:
	Don't save the message if EOF comes too early
	[35ea9b558c2b]

	* src/lib/ostream-file.c:
	sendfile bugfix
	[db5958ba1c32]

	* src/lib/ioloop.c:
	Check gettimeofday() failures
	[6b99a5b076a6]

	* src/lib-storage/index/maildir/maildir-list.c:
	comment update
	[2d14be5b6829]

	* src/lib-storage/index/maildir/maildir-list.c:
	Assume \Marked if new/ has been modified later than cur/
	[e04c2b01ecb2]

	* src/lib-storage/index/maildir/maildir-storage.c:
	We don't really need the cur, new and tmp symlinks in .INBOX/ dir.
	Also don't even try to support renaming INBOX since we can't make it
	atomic.
	[57f6989a6b8d]

	* dovecot-example.conf, src/lib-index/mbox/mbox-index.c:
	mail_read_mmaped = no works now with mbox
	[88c0d1c2b3c3]

	* dovecot-example.conf, src/imap/cmd-list.c, src/lib-imap/imap-
	match.c, src/lib-imap/imap-match.h, src/lib-storage/index/maildir
	/maildir-list.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-storage.c, src/lib-storage/mail-storage.h, src/lib-
	storage/subscription-file/subscription-file.c, src/lib-storage
	/subscription-file/subscription-file.h:
	Rewrote LIST, LSUB and subscription file handling. LIST replies
	aren't sorted anymore by default, it can be enabled with
	client_workarounds = list-sort.
	[d28571e8c810]

	* src/lib/istream-mmap.c, src/lib/istream.h, src/lib/ostream-file.c,
	src/lib/ostream.h:
	o_stream_send_istream() is now safe to use for moving data within
	file.
	[e86f259048cf]

	* doc/dovecot-ldap.conf:
	notes about userPassword
	[eb2c2da659df]

	* src/auth/Makefile.am, src/auth/md5crypt.c, src/auth/md5crypt.h,
	src/auth/password-scheme.c:
	crypt-password checking was broken. added support for md5crypt
	passwords.
	[789b0346308e]

2003-02-18  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c:
	fix
	[31deba59422f]

	* src/imap/main.c:
	Use getlogin() alternatively if USER environment isn't found.
	[206190c8c66f]

	* src/auth/Makefile.am, src/auth/mech-digest-md5.c, src/auth/passdb-
	ldap.c, src/auth/passdb-passwd-file.c, src/auth/passdb.c, src/auth
	/password-scheme.c, src/auth/password-scheme.h, src/auth/password-
	verify.c, src/auth/password-verify.h:
	Fix realm usage with DIGEST-MD5. Support generating other password
	schemes out of plaintext passwords.
	[76321f65960d]

	* doc/dovecot-ldap.conf, src/auth/Makefile.am, src/auth/auth-login-
	interface.h, src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/db-
	passwd-file.c, src/auth/db-passwd-file.h, src/auth/master-
	connection.c, src/auth/mech-digest-md5.c, src/auth/mech-plain.c,
	src/auth/mech.c, src/auth/mech.h, src/auth/passdb-ldap.c, src/auth
	/passdb-pam.c, src/auth/passdb-passwd-file.c, src/auth/passdb-
	passwd.c, src/auth/passdb-shadow.c, src/auth/passdb-vpopmail.c,
	src/auth/passdb.c, src/auth/passdb.h, src/auth/password-verify.c,
	src/auth/password-verify.h, src/auth/userdb-ldap.c, src/auth/userdb-
	passwd-file.c, src/auth/userdb-passwd.c, src/auth/userdb-static.c,
	src/auth/userdb-vpopmail.c, src/auth/userdb-vpopmail.h,
	src/auth/userdb.h, src/login-common/auth-common.c:
	Added default_pass_scheme to LDAP. Support for more password
	schemes. Merged password checking code with LDAP and passwd-file, so
	both support the same schemes now.
	[65e48854491d]

	* INSTALL:
	s/ldap/vpopmail/ in vpopmail.so example
	[c54c61822d27]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	src/auth/userdb-ldap.c:
	Escape special chars in username if needed.
	[2cb8e2136283]

	* src/imap/cmd-delete.c:
	Don't allow deleting selected mailbox.
	[188e2ca0b36c]

	* doc/Makefile.am:
	missing dovecot-ldap.conf
	[e042bed705af]

2003-02-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c:
	Do tmp -> new using link() + unlink(). Use "new" way for unique
	filename generation.
	[6dc4f89b53c4]

	* src/lib-storage/index/maildir/maildir-storage.c:
	Check for ENOTEMPTY too for rename() failures.
	[66bf2aaf74dc]

	* src/lib-storage/index/mbox/mbox-expunge.c:
	o_stream_seek() return value was checked wrong
	[0dc579b99c9e]

	* src/imap/cmd-list.c:
	Remove the mailbox globbing code from here. It should have been done
	already by mail_storage. Also show parent mailboxes before children,
	not after. (Patch by Peter Kaas)
	[cacfd1b16626]

	* src/auth/db-ldap.c, src/auth/passdb-ldap.c, src/auth/userdb-ldap.c:
	Handle LDAP failures better.
	[27fb52c532a4]

	* src/auth/db-ldap.c:
	Rather than block for two seconds, we can just call ldap_result()
	again if it returns 0..
	[ac7dbb236b59]

2003-02-14  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	comment update
	[930452c85250]

	* src/lib-storage/mail-storage.h:
	oe6 workaround enum was 0 which didn't really work..
	[538a09318de0]

	* TODO:
	updated
	[933c8f9c241f]

	* dovecot-example.conf:
	IDLE setting.
	[dee729f18aa1]

	* src/lib-index/mbox/mbox-lock.c, src/lib/file-dotlock.c, src/lib
	/file-dotlock.h:
	Don't even try to override mbox dotlock if we can't get fcntl/flock.
	[625d4d2b35ee]

	* src/lib-imap/imap-parser.c:
	Allow '\' character too in atoms, they're used in flags..
	[5bf4efe73b2d]

	* src/lib/fdpass.c:
	check cmsg_level too
	[00dd1db9e312]

	* src/lib/fdpass.c:
	fd_read(): make sure it's SCM_RIGHTS that was transferred so that
	login process couldn't fool us to use some of our existing fds.
	[07c8944fdd28]

	* configure.in, src/imap/Makefile.am, src/imap/client.c,
	src/imap/client.h, src/imap/cmd-idle.c, src/imap/cmd-select.c,
	src/imap/commands.c, src/imap/commands.h, src/imap/common.h,
	src/imap/main.c, src/lib-storage/index/index-mailbox-check.c, src
	/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-sync.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage.h, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Support for IDLE extension.
	[f7c273202dc3]

	* src/lib/ioloop.c:
	Don't inline timeout_update_next(). gcc 3.2.2 with -O2 seems to
	break it.
	[6a22587f069a]

	* src/lib-imap/imap-parser.c:
	show proper error message to 8bit chars
	[434727666f19]

	* src/lib-imap/imap-parser.c:
	Allow wildcards anyway in atoms, they're needed with LIST.
	[0eaf51e01ccd]

	* dovecot-example.conf, src/imap/client.c, src/imap/client.h, src/imap
	/cmd-append.c, src/imap/cmd-select.c, src/imap/cmd-store.c, src/imap
	/commands-util.c, src/imap/commands-util.h, src/imap/common.h,
	src/imap/mail-storage-callbacks.c, src/imap/main.c, src/master/mail-
	process.c, src/master/master-settings.c, src/master/master-
	settings.h:
	Added setting to limit length of custom flag names.
	[03f1455664d7]

	* src/lib-imap/imap-parser.c:
	Complain if atoms contain invalid characters.
	[64345e62089c]

2003-02-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-quote.c:
	Quoting didn't remove CR and LF characters, so it could have caused
	corrupted ENVELOPE/BODY replies.
	[fccf13a1c67a]

	* src/lib/sendfile-util.c:
	Solaris 9 seems to kernel panic if sendfilev() is used with non-
	socket.
	[69d922a1d051]

	* src/lib-storage/index/mbox/mbox-storage.c:
	typofix
	[80fe40b9db65]

2003-02-12  Timo Sirainen  <tss@iki.fi>

	* src/imap/commands-util.c:
	more full_filesyste_access fixes (forgot to commit)
	[9626eda973d1]

	* src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	Several fixes to mail_full_filesystem_access = yes handling
	[c2f6ca19fa29]

	* src/lib-index/mail-index.h, src/lib-index/mbox/mbox-lock.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib/Makefile.am, src/lib/file-dotlock.c, src/lib
	/file-dotlock.h, src/lib/file-lock.c, src/lib/unlink-lockfiles.c:
	Locking code cleanups and small fixes
	[fc5d2e44cc5e]

	* src/login-common/auth-connection.c:
	handshake counter was decreased too often and could have caused
	hangs
	[1a9be391559b]

2003-02-11  Timo Sirainen  <tss@iki.fi>

	* INSTALL:
	wordwrapping..
	[8a93dff28e13]

	* INSTALL:
	-fPIC too
	[d346da6de29d]

	* INSTALL:
	updated
	[d8d8ec83c2f7]

	* src/auth/passdb.c:
	fix
	[cd46f47d559f]

	* src/lib-storage/mail-storage.c:
	..and it went wrong..
	[17899f8ff18a]

	* src/lib-storage/mail-storage.c:
	Ignore empty workarounds
	[0c8c64bd997e]

	* src/master/mail-process.c:
	We shouldn't check umask() return value.
	[5e945f06a142]

	* src/master/mail-process.c:
	And pass the mail_full_filesystem_access setting to IMAP process
	too..
	[95d67b5c3fd4]

	* dovecot-example.conf, src/lib-storage/index/maildir/maildir-list.c,
	src/lib-storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/mail-storage.c, src/lib-storage
	/mail-storage.h, src/lib/Makefile.am, src/lib/home-expand.c, src/lib
	/home-expand.h, src/master/master-settings.c, src/master/master-
	settings.h:
	Added mail_full_filesystem_access setting. Some of the setting
	variable types were declared wrong and caused Dovecot to crash if
	they were set in config file.
	[058f6c26f405]

	* configure.in, src/auth/Makefile.am, src/auth/auth-module.c, src/auth
	/auth-module.h, src/auth/passdb.c, src/auth/userdb.c:
	Support for dynamic authentication modules.
	[18a2074a4d3d]

	* src/auth/userdb-vpopmail.c:
	compile fix
	[38f6130abec2]

	* src/imap-login/client.c, src/imap-login/client.h,
	src/pop3-login/client.c, src/pop3-login/client.h:
	Make sure calling client_destroy() multiple times doesn't break
	anything.
	[b5b172ab0ed9]

	* src/login-common/master.c:
	Die cleanly when master tells us so.
	[0beeeffc6d31]

	* src/lib/istream-mmap.c, src/lib/ostream-file.c, src/lib/sendfile-
	util.c, src/lib/sendfile-util.h:
	Bugfixes to handling >2GB files.
	[ee4bdf40ec10]

	* src/lib-index/mail-index-open.c, src/lib-index/maildir/Makefile.am,
	src/lib-index/maildir/maildir-clean.c, src/lib-index/maildir
	/maildir-index.c, src/lib-index/maildir/maildir-index.h:
	Clean old files from Maildir tmp dirs.
	[40629cdd51fb]

	* src/master/auth-process.c:
	Creating more than one auth process per group didn't really work.
	[6970c1d808ab]

	* src/auth/db-ldap.c, src/auth/db-ldap.h:
	Use the same LDAP connection for both userdb and passdb if
	config_path is the same.
	[50f10a7a3bad]

	* dovecot-example.conf:
	updated
	[3754fb986f65]

	* doc/dovecot-ldap.conf, src/auth/db-ldap.c, src/auth/db-ldap.h,
	src/auth/userdb-ldap.c:
	Added user_global_uid and user_global_gid LDAP settings.
	[873634a5b472]

	* src/lib-storage/index/index-mail.c:
	get_size() was buggy
	[44904d3d7b6b]

	* src/lib-imap/imap-quote.c:
	Literals sizes were sometimes set to 2^32-1.
	[cfe8bafb61d3]

	* dovecot-example.conf, src/imap/cmd-fetch.c, src/imap/main.c, src
	/lib-storage/index/index-fetch.c, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h, src/master/mail-process.c,
	src/master/master-settings.c, src/master/master-settings.h:
	Added client_workarounds setting, with currently one workaround for
	OE6.
	[340dea0150bf]

	* doc/dovecot-ldap.conf:
	Added example config file.
	[5b5716af5aa8]

	* src/auth/db-ldap.c, src/auth/db-ldap.h, src/auth/passdb-ldap.c,
	src/auth/userdb-ldap.c:
	Separate user and pass attrs/filters in config file
	[ad6343bd4479]

	* src/auth/Makefile.am, src/auth/db-ldap.c, src/auth/db-ldap.h,
	src/auth/passdb-ldap.c, src/auth/passdb.c, src/auth/passdb.h,
	src/auth/userdb-ldap.c:
	passdb ldap added. fixes to userdb ldap.
	[81930fff13cf]

2003-02-10  Timo Sirainen  <tss@iki.fi>

	* src/login-common/auth-connection.c, src/login-common/auth-
	connection.h, src/login-common/main.c:
	Don't accept client connections before we're connected to all auth
	processes.
	[bd3dabaa598e]

	* src/master/auth-process.c:
	i_error, not i_panic..
	[f6889bb50a7f]

	* src/login-common/auth-connection.c:
	Crashfix.
	[50727d444717]

	* src/master/auth-process.c:
	Auth process communication was a bit broken
	[817718515e5f]

2003-02-09  Timo Sirainen  <tss@iki.fi>

	* src/auth/master-connection.c:
	cleanup
	[64ebf1b58b53]

	* src/auth/db-passwd-file.c, src/login-common/auth-common.c:
	More realm fixes
	[9a1a79df6238]

	* src/auth/mech-plain.c:
	usernames with '@' char were supposed to be treated as user@realm,
	but that was a bit buggy
	[373ea249ff2f]

2003-02-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/maildir/maildir-sync.c:
	Allocate larger initial pool for maildir syncing.
	[e352e28f80c3]

	* src/lib/mempool-alloconly.c:
	DEBUG: we cleared wrong memory block..
	[e106cde5255c]

	* src/auth/common.h, src/auth/login-connection.c, src/auth/main.c:
	Moved login process verbose stuff under verbose_debug.
	[bf89319ec557]

	* dovecot-example.conf, src/login-common/main.c, src/master/auth-
	process.c, src/master/mail-process.c, src/master/main.c, src/master
	/master-login-interface.h:
	/dev/stderr works now in log paths.
	[5e9430a39611]

	* src/master/master-settings.c:
	Don't check log dir permission if the log file already exists
	[313790fb126e]

	* src/master/master-settings.c:
	And remove the flock default from here too..
	[3e234b658c7b]

	* src/auth/passdb-pam.c:
	OpenPAM uses const too.
	[282e0980c3f2]

	* src/login-common/master.c:
	Show the fd we're sending to master if fd_send() fails.
	[7ddb17390a5c]

	* src/master/login-process.c:
	Don't start those login processes that aren't enabled in protocols
	setting.
	[5c9c681f13ff]

	* src/login-common/auth-connection.c:
	Don't complain about unexpected auth disconnections actually, that's
	normal during shutdown.
	[d7ac3c5eb831]

	* src/imap-login/client.c, src/login-common/ssl-proxy-gnutls.c, src
	/login-common/ssl-proxy-openssl.c, src/pop3-login/client.c:
	STARTTLS handshake failure fixes.
	[71c438e6a40f]

	* src/imap/rawlog.c:
	There's no space before "* OK"
	[cbfee53bcaee]

	* src/lib/ostream-file.c:
	Don't bother trying sendfile() more than once with the stream.
	[6a233fbb02a5]

	* src/lib/sendfile-util.c:
	FreeBSD's sendfile() works only with sockets. Replace errno with
	EINVAL to make it look like sendfile isn't supported.
	[44b531fbb32a]

	* dovecot-example.conf, src/lib-index/mbox/mbox-lock.c:
	Don't use flock() locking by default. Using both fcntl+flock doesn't
	work with FreeBSD.
	[4abeb0fa0fe7]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Autodetect /var/mail/%u and /var/spool/mail/%u INBOXes.
	[a246c1d68061]

	* src/lib/mempool-alloconly.c:
	DEBUG: fill memory with 0xde before freeing it
	[1ae6cf799802]

	* src/lib/istream-file.c:
	use the file size only for regular files. FreeBSD gave sockets a
	size of 4 which broke things.
	[19d58921378f]

	* src/login-common/auth-connection.c:
	Warn if auth process disconnected.
	[7b249ab4a538]

	* src/login-common/auth-common.c:
	Don't crash if authentication was aborted too early.
	[b27e20bbdef5]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-envelope.c, src
	/lib-imap/imap-parser.c, src/lib-imap/imap-parser.h, src/lib-imap
	/imap-quote.c, src/lib-imap/imap-quote.h:
	Don't do x-unknown mime encoding. Correct way is to just send them
	as literals to client. ENVELOPE, BODY and BODYSTRUCTURE replies are
	now always sent as literals if they contain 8bit text, '"' or '\'
	characters.

	Added option to IMAP parser to return literals with IMAP_ARG_LITERAL
	type.
	[4044c2903ed7]

	* src/master/auth-process.c:
	cleanups
	[d981ebb3a155]

	* src/lib/fdpass.c:
	Have to check that msg_controllen is large enough, otherwise cmsg
	points to uninitialized buffer (at least with freebsd).
	[02454eee1775]

	* src/lib/restrict-process-size.c:
	Don't try to set rlimits to infinity, rather just don't change them.
	[95ef12ebc953]

	* src/auth/login-connection.c, src/login-common/auth-connection.c, src
	/login-common/master.c:
	Some extra checks to make sure we notice if auth process ID is 0.
	[0f7ff293c414]

	* src/lib-mail/message-part-serialize.c:
	Variable type changes, fixes compiler warning.
	[fcc3a3b4aec9]

	* src/lib-settings/settings.c:
	Don't skip trailing whitespace, it might be wanted (eg.
	log_timestamp).
	[85f9b3f666e5]

	* src/master/main.c:
	[ipv6 address] didn't work in *_listen
	[95d2f3e60b82]

	* src/lib-mail/quoted-printable.c:
	We handled '=' at end of line wrong.
	[cad379bd76d6]

2003-02-06  Timo Sirainen  <tss@iki.fi>

	* src/lib/fd-close-on-exec.c:
	Print also the fd number if it fails.
	[5a60e173fe9a]

2003-02-04  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	Don't complain about missing *-login binaries if they're not
	enabled.
	[d42e2864dc3d]

	* configure.in:
	Building in separate directory didn't work
	[2ea48622afbc]

	* src/lib-index/mbox/mbox-index.c:
	Valid From-line parsing could have crashed too.
	[714661dacead]

	* src/imap-login/Makefile.am, src/pop3-login/Makefile.am:
	Missing headers
	[c1e099b65be0]

	* src/auth/Makefile.am:
	missing db-ldap.h
	[b46e3ca71d66]

	* src/auth/userdb-ldap.c:
	cleanups
	[63e76cf6c9e8]

	* src/lib-index/mbox/mbox-index.c:
	Dovecot might have crashed sometimes when accessing mbox with
	invalid From-lines (eg. in the middle of the message body).
	[a0a1b532fab8]

	* src/auth/passdb-shadow.c:
	s/PASSDB_PASSWD/PASSWD_SHADOW/
	[c871ad112e19]

2003-02-03  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	Check for shadow.h before assuming shadow auth is possible.
	[088c7d83f2f2]

	* src/imap/cmd-status.c:
	STATUS cleared \Recent flags from messages
	[eedb1467ccb0]

	* src/imap/main.c, src/lib/alarm-hup.c, src/pop3/main.c:
	We don't need to raise SIGHUP in alarm handler, that was just a
	mistake in first tests. That also means gdb won't break at SIGALRM
	and I can remove the DISABLE_ALARMHUP kludge.
	[c1f6c20cde9a]

2003-02-02  Timo Sirainen  <tss@iki.fi>

	* src/auth/db-ldap.c:
	Define OPENLDAP_ASYNC_WORKAROUND
	[067130d609b7]

	* src/imap-login/client-authenticate.c, src/login-common/auth-
	connection.c, src/login-common/auth-connection.h, src/pop3-login
	/client-authenticate.c:
	Send protocol with auth requests
	[40c2be9abdd3]

	* src/imap-login/client-authenticate.c, src/imap-login/client.c, src
	/imap-login/client.h, src/login-common/Makefile.am, src/login-common
	/auth-common.c, src/login-common/auth-common.h, src/login-common
	/client-common.h, src/pop3-login/client-authenticate.c,
	src/pop3-login/client.c, src/pop3-login/client.h:
	Moved more auth code to login-common.
	[86b8c9cb7ac0]

	* src/auth/auth-login-interface.h, src/auth/login-connection.c,
	src/auth/mech-digest-md5.c, src/auth/mech-plain.c, src/auth/mech.c,
	src/auth/mech.h, src/imap-login/client-authenticate.c, src/imap-
	login/client.c, src/pop3-login/client.c:
	auth: kill login connection if it leaves requests hanging too long.
	[f6ec28683512]

	* src/login-common/auth-connection.c, src/login-common/auth-
	connection.h:
	make sure we don't access free'd memory if auth process dies.
	[c62416017121]

	* src/auth/login-connection.c, src/auth/login-connection.h, src/auth
	/mech-digest-md5.c, src/auth/mech-plain.c, src/auth/mech.c:
	fixes
	[98dca3b6b209]

	* src/login-common/auth-connection.c:
	s/imap-auth/auth process/
	[6def98421f46]

	* src/imap-login/client.c, src/pop3-login/client.c:
	STARTTLS commands crashed. imap-login STARTTLS also ignored next
	command.
	[3aece07f3a1b]

	* src/auth/mech-digest-md5.c:
	finally working
	[58ec36002730]

	* src/auth/mech-digest-md5.c:
	maybe now?
	[0106bbf4bdaf]

	* src/auth/mech-digest-md5.c, src/auth/mech-plain.c, src/auth/mech.c,
	src/auth/mech.h:
	more fixes
	[e22f21b9ec49]

	* src/auth/auth-login-interface.h, src/auth/db-ldap.c, src/auth/db-
	ldap.h, src/auth/mech-digest-md5.c, src/auth/mech-plain.c,
	src/auth/mech.c, src/auth/mech.h, src/auth/passdb-pam.c, src/auth
	/passdb-passwd-file.c, src/auth/passdb-passwd.c, src/auth/passdb-
	shadow.c, src/auth/passdb-vpopmail.c, src/auth/passdb.h, src/auth
	/userdb-ldap.c, src/auth/userdb.c, src/auth/userdb.h:
	auth process fixes, LDAP seems to be working (with the kludge define
	or fixed libldap)
	[f1401fa7ab03]

2003-02-01  Timo Sirainen  <tss@iki.fi>

	* src/master/master-settings.c:
	um. still not.
	[85e2b65cc780]

	* src/master/master-settings.c:
	Changing login_dir or login_chroot wasn't possible
	[389e9d1f4e60]

	* src/imap/imap-sort.c:
	Message size was returned with wrong type
	[a3e831cba5c4]

	* src/pop3/commands.c:
	Don't crash if we couldn't open message.
	[d71e0aa00d75]

	* src/lib-storage/index/index-search.c:
	Fixes to SEARCH SENT*
	[5c34c363a062]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-search.c,
	src/lib-storage/mail-search.h:
	Several search fixes, mostly related to matching multiple
	conditions.
	[8024a2cdc406]

	* src/lib-imap/imap-parser.c:
	Giving >7 args to imap command was buggy
	[be54621f4079]

	* src/imap/main.c:
	wrong debug check
	[800810173989]

	* src/lib-storage/index/index-search.c:
	SEARCH NOT didn't work
	[06b566bd2623]

	* configure.in, src/lib/ioloop-poll.c, src/lib/restrict-process-
	size.c, src/lib/restrict-process-size.h, src/master/auth-process.c,
	src/master/login-process.c, src/master/mail-process.c:
	Don't let login process fork()
	[6cb5b50aea71]

2003-01-31  Timo Sirainen  <tss@iki.fi>

	* src/Makefile.am:
	lib-settings was missing
	[1577e4cfd569]

	* src/lib-settings/settings.c, src/lib-settings/settings.h, src/master
	/master-settings.c:
	updates
	[af288710044a]

	* src/auth/.cvsignore, src/auth/Makefile.am, src/auth/db-ldap.c,
	src/auth/db-ldap.h, src/auth/db-passwd-file.c, src/auth/db-passwd-
	file.h, src/auth/login-connection.c, src/auth/main.c, src/auth/mech-
	cyrus-sasl2.c, src/auth/mech.c, src/auth/passdb-passwd-file.c,
	src/auth/passdb.c, src/auth/passwd-file.c, src/auth/passwd-file.h,
	src/auth/userdb-ldap.c, src/auth/userdb-passwd-file.c, src/auth
	/userdb-passwd.c, src/auth/userdb-static.c, src/auth/userdb.c,
	src/auth/userdb.h:
	Cleanups, LDAP support compiles again and generally looks ok, even
	if it doesn't necessarily work :) Works now with new master config.
	[0522a0315d2f]

	* src/lib-mail/message-parser.c:
	Handle boundary=""
	[6a19c941a1fc]

	* src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/mbox/mbox-list.c:
	If there's multiple mailboxes named "inbox", ignore them at least
	for now (eg. /var/mail/inbox, ~/mail/inbox).
	[d051d031fc09]

2003-01-30  Timo Sirainen  <tss@iki.fi>

	* src/pop3-login/client-authenticate.c, src/pop3-login/client-
	authenticate.h, src/pop3-login/client.c, src/pop3/Makefile.am,
	src/pop3/capability.h, src/pop3/client.c, src/pop3/commands.c:
	Support for CAPA command (rfc2449).
	[d805c2f1d6a9]

	* configure.in, src/lib-settings/.cvsignore, src/lib-
	settings/Makefile.am, src/lib-settings/settings.c, src/lib-
	settings/settings.h, src/master/Makefile.am, src/master/common.h,
	src/master/main.c, src/master/master-settings.c, src/master/master-
	settings.h, src/master/settings.c, src/master/settings.h:
	Moved settings parsing to lib-settings.
	[3b8fb7bf7ecc]

	* configure.in, src/Makefile.am:
	libldap checks, --without-pop3 disables pop3 server
	[c5ab972db48c]

	* src/pop3/client.c, src/pop3/commands.c, src/pop3/commands.h:
	Disconnect after too many bad commands. We also crashed if there
	were no mails in mailbox.
	[a9b499b2611e]

	* dovecot-example.conf, src/imap/main.c, src/login-common/main.c,
	src/master/.cvsignore, src/master/Makefile.am, src/master/auth-
	process.c, src/master/common.h, src/master/imap-process.c,
	src/master/imap-process.h, src/master/login-process.c, src/master
	/mail-process.c, src/master/mail-process.h, src/master/main.c,
	src/master/master-login-interface.h, src/master/settings.c,
	src/master/settings.h, src/master/ssl-init.c:
	Rewrote setting handling. Changed some existing settings also since
	POP3 support required changes anyway. POP3 seems to be really
	working now :)
	[a72bba3f8a55]

	* src/pop3-login/client-authenticate.c, src/pop3-login/client.c:
	compile fix + complain about unknown commands
	[cd1ac4101adf]

	* src/pop3/client.c:
	Reduce input buffer size
	[28f606ada24a]

	* src/lib/macros.h:
	Removed STRUCT_OFFSET, offsetof() is ANSI-C for the same purpose.
	Added MEMBER() macro to define C99-style struct labels.
	[2f6225f9c170]

	* src/pop3/commands.c:
	bugfixes
	[5c76c96f745f]

2003-01-29  Timo Sirainen  <tss@iki.fi>

	* src/imap/.psrc, src/login/.psrc, src/master/.psrc:
	..wonder how these ever got into here..
	[ff63007297c3]

2003-01-28  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/Makefile.am, src/imap-login/.cvsignore, src/imap-
	login/Makefile.am, src/imap-login/client-authenticate.c, src/imap-
	login/client-authenticate.h, src/imap-login/client.c, src/imap-
	login/client.h, src/imap-login/common.h, src/login-
	common/.cvsignore, src/login-common/Makefile.am, src/login-common
	/auth-connection.c, src/login-common/auth-connection.h, src/login-
	common/client-common.h, src/login-common/common.h, src/login-
	common/main.c, src/login-common/master.c, src/login-common/master.h,
	src/login-common/ssl-proxy-gnutls.c, src/login-common/ssl-proxy-
	openssl.c, src/login-common/ssl-proxy.c, src/login-common/ssl-
	proxy.h, src/login/.cvsignore, src/login/Makefile.am, src/login
	/auth-connection.c, src/login/auth-connection.h, src/login/client-
	authenticate.c, src/login/client-authenticate.h, src/login/client.c,
	src/login/client.h, src/login/common.h, src/login/main.c,
	src/login/master.c, src/login/master.h, src/login/ssl-proxy-
	gnutls.c, src/login/ssl-proxy-openssl.c, src/login/ssl-proxy.c,
	src/login/ssl-proxy.h, src/pop3-login/.cvsignore,
	src/pop3-login/Makefile.am, src/pop3-login/client-authenticate.c,
	src/pop3-login/client-authenticate.h, src/pop3-login/client.c,
	src/pop3-login/client.h, src/pop3-login/common.h:
	Moved common login process code to login-common, created pop3-login.
	[c41787e8c3f4]

	* src/lib/macros.h:
	No i_memmove here, just memmove.
	[526415575295]

2003-01-27  Timo Sirainen  <tss@iki.fi>

	* src/auth/login-connection.c:
	destroy requests for login connection when it does.
	[c8adf40c8f42]

	* src/auth/login-connection.c, src/auth/master-connection.c, src/auth
	/mech-digest-md5.c, src/auth/mech-plain.c, src/auth/mech.c,
	src/auth/mech.h, src/auth/passdb-pam.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-vpopmail.c, src/auth/passdb.h, src/auth/userdb-passwd-
	file.c, src/auth/userdb-passwd.c, src/auth/userdb-static.c, src/auth
	/userdb-vpopmail.c, src/auth/userdb.h:
	Async userdb and passdb interface.
	[561da07883b6]

	* src/pop3/commands.c:
	Fixes, seems to be working now. Only thing left is the pop3-login..
	[be7710b9a819]

	* src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c:
	Read the sizes of all messages to memory at startup. More failsafe
	and faster.
	[50d258907c99]

	* configure.in, src/pop3/.cvsignore, src/pop3/Makefile.am,
	src/pop3/client.c, src/pop3/client.h, src/pop3/commands.c,
	src/pop3/commands.h, src/pop3/common.h, src/pop3/mail-storage-
	callbacks.c, src/pop3/main.c:
	Initial code for POP3 server. RETR isn't working right yet, there's
	some syncing problems to figure out (pop3 wants to keep the mailbox
	locked) and the whole pop3-login process is still missing.
	[cacabd33c68a]

	* src/lib-storage/index/index-fetch.c:
	Allow update_seen to be NULL
	[002096c1af3c]

	* src/imap/client.h, src/imap/cmd-append.c, src/imap/commands-util.c,
	src/imap/commands-util.h, src/imap/commands.h, src/imap/imap-
	search.c, src/imap/imap-sort.c, src/imap/imap-thread.c, src/imap
	/mail-storage-callbacks.c, src/imap/main.c:
	some header file cleanups
	[47ecd950a702]

	* dovecot-example.conf, src/master/auth-process.c,
	src/master/settings.c:
	Authentication named socket permissions were insecure, an exploited
	login process could have replaced it with it's own and began reading
	plaintext passwords sent by other login processes.
	[299f59fb9ff4]

	* src/auth/mech-plain.c, src/imap/imap-sort.h, src/lib-storage/index
	/index-mail.c, src/lib-storage/index/mbox/mbox-save.c, src/master
	/imap-process.c, src/master/imap-process.h, src/master/login-
	process.c:
	signed/unsigned/const pointer fixes
	[793f05a7e50e]

	* src/auth/passwd-file.c, src/imap/client.h, src/imap/commands.c,
	src/imap/commands.h, src/imap/imap-sort.c, src/imap/imap-thread.c,
	src/lib-index/mail-index-update.c, src/lib-index/mail-index.h, src
	/lib-index/maildir/maildir-sync.c, src/lib-mail/message-content-
	parser.c, src/lib-mail/message-content-parser.h, src/lib-mail
	/message-header-decode.c, src/lib-mail/message-header-decode.h, src
	/lib-mail/message-parser.c, src/lib-mail/message-parser.h, src/lib-
	mail/message-tokenize.c, src/lib-mail/message-tokenize.h, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/mbox
	/mbox-list.c, src/lib-storage/mail-storage.h, src/lib-storage
	/subscription-file/subscription-file.c, src/lib-storage
	/subscription-file/subscription-file.h, src/lib/failures.c,
	src/lib/failures.h, src/lib/hash.c, src/lib/hash.h, src/login/ssl-
	proxy-openssl.c:
	Function typedefs now define them as functions, not function
	pointers.
	[60646878858e]

	* src/lib-storage/index/Makefile.am:
	missing index-mail.h
	[17ac2832c63f]

	* src/auth/login-connection.c, src/auth/main.c, src/auth/master-
	connection.c, src/imap/client.c, src/imap/rawlog.c, src/lib-
	storage/index/index-mailbox-check.c, src/lib/ioloop-internal.h,
	src/lib/ioloop-poll.c, src/lib/ioloop-select.c, src/lib/ioloop.c,
	src/lib/ioloop.h, src/lib/ostream-file.c, src/login/auth-
	connection.c, src/login/client-authenticate.c, src/login/client.c,
	src/login/client.h, src/login/main.c, src/login/master.c, src/login
	/ssl-proxy-gnutls.c, src/master/auth-process.c, src/master/login-
	process.c, src/master/main.c, src/master/ssl-init.c:
	Removed useless parameters from io_callback_t and
	timeout_callback_t.
	[f782b3319553]

	* dovecot-example.conf, src/auth/Makefile.am, src/auth/auth-cyrus-
	sasl2.c, src/auth/auth-digest-md5.c, src/auth/auth-interface.h,
	src/auth/auth-login-interface.h, src/auth/auth-master-interface.h,
	src/auth/auth-plain.c, src/auth/auth.c, src/auth/auth.h,
	src/auth/common.h, src/auth/cookie.c, src/auth/cookie.h, src/auth
	/login-connection.c, src/auth/login-connection.h, src/auth/main.c,
	src/auth/master-connection.c, src/auth/master-connection.h,
	src/auth/master.c, src/auth/master.h, src/auth/mech-cyrus-sasl2.c,
	src/auth/mech-digest-md5.c, src/auth/mech-plain.c, src/auth/mech.c,
	src/auth/mech.h, src/auth/passdb-pam.c, src/auth/passdb-passwd-
	file.c, src/auth/passdb-passwd.c, src/auth/passdb-shadow.c, src/auth
	/passdb-vpopmail.c, src/auth/passdb.c, src/auth/passdb.h, src/auth
	/passwd-file.c, src/auth/passwd-file.h, src/auth/userdb-passwd-
	file.c, src/auth/userdb-passwd.c, src/auth/userdb-static.c, src/auth
	/userdb-vpopmail.c, src/auth/userdb-vpopmail.h, src/auth/userdb.c,
	src/auth/userdb.h, src/auth/userinfo-pam.c, src/auth/userinfo-
	passwd-file.c, src/auth/userinfo-passwd.c, src/auth/userinfo-
	passwd.h, src/auth/userinfo-shadow.c, src/auth/userinfo-vpopmail.c,
	src/auth/userinfo.c, src/auth/userinfo.h, src/imap/main.c, src/login
	/auth-connection.c, src/login/auth-connection.h, src/login/client-
	authenticate.c, src/login/client.h, src/login/common.h,
	src/login/master.c, src/login/master.h, src/master/Makefile.am,
	src/master/auth-process.c, src/master/auth-process.h,
	src/master/common.h, src/master/imap-process.c, src/master/imap-
	process.h, src/master/login-process.c, src/master/login-process.h,
	src/master/main.c, src/master/master-interface.h, src/master/master-
	login-interface.h, src/master/settings.c, src/master/settings.h:
	We have now separate "userdb" and "passdb". They aren't tied to each
	others in any way, so it's possible to use whatever user database
	with whatever password database.

	Added "static" userdb, which uses same uid/gid for everyone and
	generates home directory from given template. This could be useful
	with PAM, although insecure since everyone uses same uid.

	Not too well tested, and userdb/passdb API still needs to be changed
	to asynchronous for sql/ldap/etc lookups.
	[fe49ece0f3ea]

	* src/lib/Makefile.am, src/lib/var-expand.c, src/lib/var-expand.h:
	Added var_expand()
	[c077254cbe66]

	* src/lib/ioloop.c, src/lib/ioloop.h:
	Added io_loop_is_running()
	[e37e626902c3]

	* src/lib/data-stack.c:
	Allow calling t_push() before data_stack_init().
	[ea309e90c01a]

	* src/lib/alarm-hup.c:
	comment update
	[f17e2263f223]

2003-01-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/mbox/mbox-save.c:
	Memory usage tweaks
	[4bcebdcf052b]

2003-01-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-fetch.c:
	Removed the OE workaround, it still didn't work if the EXISTS/RECENT
	was sent after FETCH.
	[3b5ad60473be]

	* src/auth/auth-digest-md5.c:
	added const
	[b26b83f30f65]

	* src/lib/istream.c, src/lib/istream.h, src/lib/ostream.c,
	src/lib/ostream.h:
	More type safety to i/o streams
	[29f09c05945d]

	* src/imap/cmd-unselect.c:
	forgot to add
	[e147dcbb2ba6]

	* src/lib-index/mail-modifylog.c:
	Modifylog wasn't written for external changes (broken by the
	previous speedup)
	[eb80a942bd8b]

	* src/lib-storage/index/maildir/maildir-save.c:
	When save is aborted, remove the created temp files.
	[2b7eaf2d31a1]

	* src/imap/client.c, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/commands-util.c, src/lib-imap/imap-parser.c, src/lib-imap
	/imap-parser.h:
	Disconnect client if given non-sync literal size is too large.
	Better than eating the input.
	[dc660f588218]

	* configure.in, src/imap/cmd-append.c, src/lib-imap/imap-parser.c, src
	/lib-imap/imap-parser.h:
	Support for LITERAL+ extension.
	[09bac2875ed8]

2003-01-22  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/imap/cmd-close.c, src/imap
	/cmd-select.c, src/imap/commands-util.c, src/imap/commands-util.h,
	src/imap/commands.c, src/imap/commands.h:
	Added support for UNSELECT extension with some cleanups for SELECT
	and CLOSE.
	[81cbc1467097]

	* src/lib-index/mail-modifylog.c:
	Bugfix for last optimization
	[d3c7e5f7041c]

	* configure.in:
	Don't print the result twice either..
	[1cccde7c3f20]

	* configure.in:
	Don't print checking sendfilev() message twice
	[000a86b4e4a9]

	* src/imap/imap-fetch-body-section.c:
	FETCH BODY[TEXT] was broken
	[a237bde6bd1e]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-modifylog.c:
	Modify log used to test if there were other users for every changed
	flag or expunged message, causing two fcntl() syscalls every time ->
	SLOW. Now we check it only once after exclusively locking the index.
	[d1caf5d0e77c]

	* configure.in, doc/multiaccess.txt, src/imap/client.c, src/imap/cmd-
	append.c, src/imap/cmd-copy.c, src/imap/common.h, src/lib-
	storage/index/index-copy.c, src/lib-storage/index/index-fetch.c, src
	/lib-storage/index/index-messageset.c, src/lib-storage/index/index-
	messageset.h, src/lib-storage/index/index-save.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-update-
	flags.c, src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-storage.h:
	Support for MULTIAPPEND extension. COPY now behaves like spec says -
	if it fails, none of the messages are copied.
	maildir_copy_with_hardlinks didn't actually work.
	[40a327d356de]

	* src/lib-imap/imap-parser.c:
	Externally parsed literal size always stops argument parsing now.
	Input stream is now skipped when returning success/failure, so the
	stream can be used for other purposes too.
	[26a028e6d7d5]

	* src/lib/iostream.c:
	i/o streams unreffed their pool, but never referenced it. this
	didn't matter so far since we always used system/data stack pools
	where refcounting didn't matter.
	[3415ebfad8d2]

2003-01-21  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-sort.c:
	Give nice error message for "SORT ()"
	[b2d9219c60af]

	* src/imap/imap-search.c:
	Don't crash with "SEARCH ()"
	[cdfd647b0cbb]

	* src/lib-imap/imap-parser.c:
	Missing ')' wasn't reported correctly.
	[3c30228ae095]

	* src/lib-storage/index/index-fetch.c:
	WORKAROUND: Outlook (Express 6) fails with to read FETCH BODY[] if
	we send EXISTS/RECENT before it
	[fb83ce2a26c3]

	* src/lib-storage/index/index-messageset.c:
	Some fixes for handling messageset ranges.
	[b5ca53885d07]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	FETCH ENVELOPE failed if it wasn't already cached.
	[1222ab408f63]

	* src/imap/imap-fetch-body-section.c:
	FETCH BODY [1.HEADER*|MIME] didn't work
	[95d77998ec16]

	* src/imap/cmd-fetch.c:
	UID FETCH didn't return the UID.
	[cc02c93d254e]

	* src/lib-storage/index/mbox/mbox-storage.c:
	mboxes in subfolders weren't selectable.
	[1109ad591e44]

	* src/imap/cmd-store.c:
	STORE accepts now multiple flags without requiring them being inside
	().
	[61400b3bc338]

	* src/imap/commands-util.c:
	store/append crashed if no custom flags were being set (ie. almost
	always)
	[a5f39241d089]

	* src/imap/client.c, src/login/client.c, src/login/client.h:
	imap-login: disconnect when received 10 invalid commands. imap:
	disconnect when received 20 invalid commands in a row - every
	successful command resets the counter now.
	[fb9c95a8847f]

	* src/master/auth-process.c, src/master/common.h, src/master/login-
	process.c, src/master/main.c:
	If auth/login process died unexpectedly, the exit status or killing
	signal wasn't logged.
	[0fbafade2d85]

	* dovecot-example.conf:
	Added auth_verbose
	[070aee0e5b9f]

	* src/auth/auth-digest-md5.c, src/auth/common.h, src/auth/login-
	connection.c, src/auth/main.c, src/auth/userinfo-pam.c, src/auth
	/userinfo-passwd-file.c, src/auth/userinfo-passwd.c, src/auth
	/userinfo-shadow.c, src/auth/userinfo-vpopmail.c, src/master/auth-
	process.c, src/master/settings.c, src/master/settings.h:
	auth_verbose = yes logs now all authentication failures and some
	other stuff.
	[d0845dca7eca]

	* doc/configuration.txt:
	updated memory usage counts
	[6abffe419582]

	* src/imap/imap-fetch.c:
	Now it actually leaked memory..
	[b26a06cd5e8f]

	* src/lib/str.c, src/lib/str.h:
	Added str_free()
	[4b264ea5d41d]

	* src/imap/imap-fetch.c:
	FETCH ate too much memory
	[ab4091b2ddc2]

	* src/lib/strfuncs.c:
	null_strcmp() was broken -> SORT was broken.
	[cba414845f1b]

	* src/imap/imap-fetch-body-section.c:
	And remove debugging :)
	[5a4461a388d9]

	* src/imap/client.h, src/imap/cmd-select.c, src/imap/imap-fetch-body-
	section.c, src/imap/imap-fetch.c, src/imap/imap-fetch.h, src/lib-
	mail/message-send.c, src/lib-mail/message-send.h:
	Partial fetches are working fast again - faster than ever actually.
	[21788a1e9e39]

	* src/lib-storage/index/index-mail.c, src/lib-storage/index/index-
	mail.h:
	Forgot to add
	[9c8df18fb2a9]

	* src/lib-index/mail-index-data.c:
	shouldn't have moved the debug_mprotect()
	[e6a7afe4cca7]

2003-01-20  Timo Sirainen  <tss@iki.fi>

	* src/imap/Makefile.am, src/imap/cmd-append.c, src/imap/cmd-fetch.c,
	src/imap/cmd-search.c, src/imap/cmd-sort.c, src/imap/cmd-store.c,
	src/imap/cmd-thread.c, src/imap/commands-util.c, src/imap/commands-
	util.h, src/imap/imap-fetch-body-section.c, src/imap/imap-fetch.c,
	src/imap/imap-fetch.h, src/imap/imap-search.c, src/imap/imap-
	search.h, src/imap/imap-sort.c, src/imap/imap-sort.h, src/imap/imap-
	thread.c, src/imap/imap-thread.h, src/lib-imap/Makefile.am, src/lib-
	imap/imap-envelope.c, src/lib-imap/imap-message-cache.c, src/lib-
	imap/imap-message-cache.h, src/lib-index/mail-index-data.c, src/lib-
	mail/message-address.c, src/lib-mail/message-address.h, src/lib-mail
	/message-body-search.c, src/lib-mail/message-body-search.h, src/lib-
	mail/message-date.c, src/lib-mail/message-date.h, src/lib-mail
	/message-parser.h, src/lib-mail/message-send.c, src/lib-mail
	/message-send.h, src/lib-mail/message-size.h, src/lib-mail/message-
	tokenize.h, src/lib-storage/Makefile.am, src/lib-
	storage/index/Makefile.am, src/lib-storage/index/index-copy.c, src
	/lib-storage/index/index-fetch-section.c, src/lib-storage/index
	/index-fetch.c, src/lib-storage/index/index-fetch.h, src/lib-
	storage/index/index-messageset.c, src/lib-storage/index/index-
	messageset.h, src/lib-storage/index/index-msgcache.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-sort.c,
	src/lib-storage/index/index-sort.h, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-update-flags.c, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/mail-search.c,
	src/lib-storage/mail-search.h, src/lib-storage/mail-sort.c, src/lib-
	storage/mail-sort.h, src/lib-storage/mail-storage.h, src/lib-storage
	/mail-thread.c, src/lib-storage/mail-thread.h, src/lib/strfuncs.c,
	src/lib/strfuncs.h:
	mail-storage.h interface changes, affects pretty much everything.
	FETCH, SEARCH, SORT and THREAD handling were pretty much moved from
	lib-storage/ to imap/ so adding non-index storages would be much
	easier now. Also POP3 server can now be easily implemented with lib-
	storage.

	Not too well tested, and at least one major problem: partial
	fetching is _slow_.
	[8028c4dcf38f]

	* dovecot-example.conf:
	comment updates
	[cbf096fbb9f0]

	* src/lib-imap/imap-bodystructure.h:
	comment update
	[efca64f75e62]

	* src/lib-imap/imap-base-subject.c:
	Strip CR and LF characters too.
	[961617a56fb9]

	* src/auth/auth-plain.c, src/login/client-authenticate.c:
	PLAIN SASL-authentication was a bit broken.
	[907b9845eaa6]

	* src/lib/alarm-hup.c:
	DISABLE_ALARMHUP environment: Disable sending SIGHUP every 30 secs.
	Really annoying with debugging.
	[f57cc4bfa195]

	* src/lib-imap/imap-date.c:
	imap_parse_date() returned a bit wrong time: mktime() already builds
	the local date into UTC timestamp, so we don't need to change it
	again.
	[4937e278489c]

2003-01-16  Timo Sirainen  <tss@iki.fi>

	* configure.in:
	If Solaris sendfilev() is found, don't try checking for Linux one.
	Linux check some reason passes with sendfile-enabled Solaris..
	[7e9b90bfe78c]

2003-01-15  Timo Sirainen  <tss@iki.fi>

	* src/auth/userinfo-vpopmail.c:
	compile fix
	[dd4b74885c43]

2003-01-14  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf:
	comment update
	[fd1438d43443]

	* dovecot-example.conf:
	comment update
	[d3433363bcaa]

	* doc/configuration.txt:
	updated
	[45d04b5dcd24]

	* configure.in, src/lib/sendfile-util.c:
	Support for Solaris sendfilev(). Entirely untested, hope it works.
	[b3e0f857981c]

	* NEWS, TODO, configure.in:
	0.99.7 out
	[7bd8508ed0fa]

	* src/lib/hash.c:
	Still more fixes
	[d9df59a406fb]

	* src/lib-index/maildir/maildir-sync.c:
	Don't call hash_remove() if it isn't there.
	[d634f81c1217]

	* src/lib/hash.c:
	Removed the collision table, it was a bad idea and was buggy when
	nodes were removed.
	[0857c8c7ddf9]

	* src/lib/restrict-access.c:
	Don't check for dropped root gid privileges if our uid is still
	root.
	[91b9d01dc79e]

	* doc/index.txt:
	updated
	[0e7f5f4751d3]

	* doc/design.txt, doc/index.txt, doc/multiaccess.txt:
	updates
	[13f27425cb88]

	* src/lib-storage/mail-thread.c:
	Compiler warning fix
	[eac32e0caeb9]

2003-01-13  Timo Sirainen  <tss@iki.fi>

	* src/login/ssl-proxy-openssl.c:
	um. now a correct fix :)
	[4102bebc7411]

	* src/login/ssl-proxy-openssl.c:
	compile error
	[89e736d2247f]

	* NEWS, TODO, configure.in:
	0.99.6 out
	[6f005d5d9931]

	* src/lib-storage/mail-sort.c:
	bugfix
	[951c022b9f8f]

	* src/lib-imap/imap-message-cache.c:
	Caching was a bit broken, it sometimes used free'd context memory.
	[b27b8614d81b]

	* src/lib-storage/index/index-search.c:
	SEARCH didn't properly complain about invalid messagesets. high:low
	never worked (it was recently changed for other commands). "*" in
	UID set didn't actually match for last uid, but last sequence
	number..
	[3b139ccc1858]

	* src/lib-charset/charset-utf8.c:
	Didn't compile without iconv.
	[41b6754c2e35]

	* src/lib-storage/mail-thread.c:
	Some fixes
	[48c5ea7477fe]

	* src/lib-imap/imap-base-subject.c:
	Blobs weren't removed correctly, resulting in incorrect SORT SUBJECT
	and THREAD results.
	[f66455b629cd]

	* src/lib-mail/message-date.c:
	Handle one-digit hour in dates.
	[2c7a2d90e0cb]

	* src/lib/hash.c:
	hash_resize() leaked memory, hash_insert/update didn't update value
	for existing nodes.
	[c1a97fc30d1c]

2003-01-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-part-serialize.c:
	minor optimization
	[26cafa3dc09c]

	* src/lib-imap/imap-message-cache.c:
	If we couldn't get message_part for any reason, don't crash.
	[1fd572d68422]

	* src/lib-index/mbox/mbox-sync-full.c, src/lib-mail/message-part-
	serialize.c, src/lib-mail/message-part-serialize.h:
	Do some more sanity checking when updating cached message_part. If
	anything fails, log the error and set index corrupted.
	[f7d0209bb7a6]

2003-01-11  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-cyrus-sasl2.c, src/auth/auth-digest-md5.c, src/auth
	/auth-plain.c, src/auth/auth.c, src/auth/auth.h, src/auth/cookie.h,
	src/auth/userinfo-passwd-file.c, src/imap/client.c,
	src/imap/client.h, src/imap/cmd-list.c, src/imap/commands.c,
	src/imap/commands.h, src/lib-imap/imap-message-cache.c, src/lib-
	index/mail-index-update.c, src/lib-index/mail-index-util.c, src/lib-
	index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-sync.c, src/lib-index/mbox/mbox-append.c, src
	/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h, src
	/lib-index/mbox/mbox-lock.c, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-index/mbox/mbox-sync-full.c, src/lib-mail/message-content-
	parser.c, src/lib-mail/message-content-parser.h, src/lib-mail
	/message-header-decode.c, src/lib-mail/message-header-decode.h, src
	/lib-mail/message-parser.c, src/lib-mail/message-parser.h, src/lib-
	mail/message-tokenize.c, src/lib-mail/message-tokenize.h, src/lib-
	storage/index/index-copy.c, src/lib-storage/index/index-
	messageset.c, src/lib-storage/index/index-messageset.h, src/lib-
	storage/index/index-update-flags.c, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-list.c, src
	/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/mail-search.c, src/lib-storage/mail-
	search.h, src/lib-storage/mail-sort.c, src/lib-storage/mail-
	storage.h, src/lib-storage/mail-thread.c, src/lib-storage
	/subscription-file/subscription-file.c, src/lib-storage
	/subscription-file/subscription-file.h, src/lib/failures.c,
	src/lib/failures.h, src/lib/file-lock.c, src/lib/file-lock.h,
	src/lib/hash.c, src/lib/hash.h, src/lib/ioloop-internal.h, src/lib
	/ioloop-poll.c, src/lib/ioloop-select.c, src/lib/ioloop.c,
	src/lib/ioloop.h, src/lib/iostream-internal.h, src/lib/iostream.c,
	src/lib/istream-data.c, src/lib/istream-file.c, src/lib/istream-
	mmap.c, src/lib/istream.c, src/lib/istream.h, src/lib/ostream-
	file.c, src/lib/ostream.c, src/lib/ostream.h, src/login/auth-
	connection.c, src/login/auth-connection.h, src/login/common.h,
	src/login/master.c, src/login/master.h, src/master/auth-process.c,
	src/master/auth-process.h, src/master/ssl-init.c:
	Naming change for function typedefs.
	[411006be3c66]

	* configure.in, src/imap/cmd-thread.c, src/lib-storage/mail-thread.c:
	We support only REFERENCES threading for now - updated capability
	and trying to use ORDEREDSUBJECT now gives error.
	[5c8cd0bf94c1]

	* src/lib-storage/index/index-search.c, src/lib-storage/index/index-
	sort.c, src/lib-storage/index/index-sort.h:
	SORT and THREAD didn't work with sequence numbers at all. SEARCH was
	also a bit broken with it if another session had deleted messages
	which we hadn't yet told to client.
	[6f1e87a51872]

	* src/lib-storage/index/index-search.c, src/lib-storage/index/index-
	sort.c, src/lib-storage/mail-sort.c, src/lib-storage/mail-sort.h:
	SORT optimization. It now uses memory to store one or two of the
	sort criteria items. Should be "fast enough" now, sorting ~4000
	messages doesn't take hardly any time.
	[ceb3ea5e1a2a]

	* src/lib/hash.c, src/lib/hash.h:
	hash_clear() can now be used to drop the memory allocated using
	node_pool.
	[e601f13d95b1]

	* src/lib-index/mail-index.h:
	We don't actually need to reserve the highest UID anymore, don't do
	it :)
	[70083370cc84]

	* src/lib-storage/index/mbox/mbox-storage.c:
	If ~/mail isn't found, create it.
	[f5658274245f]

	* src/lib/hash.c:
	Few fixes
	[3681ff89f0e2]

	* COPYING, src/auth/cookie.c, src/auth/userinfo-passwd-file.c, src
	/lib-index/maildir/maildir-sync.c, src/lib-storage/mail-thread.c,
	src/lib/hash.c, src/lib/hash.h, src/login/auth-connection.c,
	src/login/client.c, src/master/login-process.c, src/master/main.c:
	Rewrote hash table code, works with less memory now. Also some
	memory allocation fixes to thread extension code.
	[501f076f2e74]

	* src/lib/mempool-alloconly.c, src/lib/mempool-datastack.c, src/lib
	/mempool-system.c, src/lib/mempool.h:
	Added alloconly_pool field for checking if pool supports free()
	[4f38538aa4a1]

2003-01-10  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-system.c:
	compiling fix
	[9a011e9e7070]

	* src/lib/hash.c, src/lib/hash.h:
	whops, shouldn't have been committed.
	[fbd907ad9b27]

	* src/lib-imap/imap-parser.c, src/lib/buffer.c, src/lib/hash.c,
	src/lib/hash.h, src/lib/imem.c, src/lib/imem.h, src/lib/ioloop-
	poll.c, src/lib/istream-file.c, src/lib/mempool-alloconly.c, src/lib
	/mempool-datastack.c, src/lib/mempool-system.c, src/lib/mempool.h,
	src/lib/ostream-file.c:
	Added old_size parameter to p_realloc() - we rarely need it and this
	way each allocation takes 8 bytes less memory.
	[4d6b69558add]

	* src/lib-index/mail-index-data.c:
	A few more sanity checks.
	[65639e7a7cb0]

	* src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-sync.c:
	index_storage_sync_and_lock() didn't set lock notify function.
	[24b64302f59c]

	* src/lib-index/mbox/mbox-lock.c:
	Don't crash if lock_notify_func isn't set.
	[54e2ef691f93]

	* src/imap/cmd-status.c:
	STATUS reply didn't quote the mailbox name, which broke it if it
	contained spaces.
	[b6a15094b8e1]

	* src/lib-storage/mail-thread.c:
	Duplicate handling was incorrect.
	[ced60aed95bb]

	* src/lib-mail/message-date.c, src/lib-storage/index/index-search.c,
	src/lib-storage/index/index-sort.c:
	Even more rfc822 date timezone fixes
	[bd2d99a3d601]

	* src/lib-storage/index/index-search.c, src/lib-storage/mail-thread.c,
	src/lib-storage/mail-thread.h:
	Fixes, seems to work properly now. Much faster too.
	[d0f8479f7b78]

	* src/lib-mail/message-date.c:
	Timezones were still being parsed wrong
	[19e0c6aa8847]

2003-01-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-date.c:
	Timezone parsing was broken.
	[ac69cabf9568]

	* src/lib-index/mail-index.c, src/lib-index/mail-modifylog.c, src/lib-
	index/mail-tree.c:
	Make sure hdr->used_file_size isn't too small.
	[d458f318ab02]

	* src/auth/auth-digest-md5.c, src/auth/auth-interface.h, src/auth
	/auth-plain.c, src/login/auth-connection.c, src/login/auth-
	connection.h, src/login/client-authenticate.c, src/login/client.c,
	src/login/client.h:
	Log username with logins. auth/login processes are getting a bit
	kludgy..
	[fdcc1cab13ff]

	* src/master/login-process.c:
	Don't leak fds in case of errors.
	[a763b3826762]

	* src/login/client-authenticate.c, src/login/client.c,
	src/login/client.h:
	AUTHENTICATE command was broken.
	[0da2cb9368f6]

	* src/lib/ostream.c:
	Remove one of the previous speedups, it broke things
	[935d0b1df754]

2003-01-08  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Write "Dovecot starting up" to log file.
	[274c722acc35]

	* src/auth/main.c, src/auth/master.c, src/login/main.c,
	src/login/master.c, src/master/auth-process.c, src/master/login-
	process.c:
	Auth and login processes send an "we're ok" reply at the end of
	initialization. If the process dies before master receives that
	reply, it shutdowns itself. Usually this is because of some
	configuration error and it's not nice to start spamming the log
	files.
	[2e649dec0f09]

	* AUTHORS, COPYING, src/imap/Makefile.am, src/imap/cmd-search.c,
	src/imap/cmd-sort.c, src/imap/cmd-thread.c, src/imap/cmd-uid.c,
	src/imap/commands.c, src/imap/commands.h, src/lib-imap/imap-base-
	subject.c, src/lib-imap/imap-base-subject.h, src/lib-
	storage/Makefile.am, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-sort.c, src/lib-storage/index/index-sort.h, src
	/lib-storage/index/index-storage.h, src/lib-storage/mail-sort.c, src
	/lib-storage/mail-sort.h, src/lib-storage/mail-storage.h, src/lib-
	storage/mail-thread.c, src/lib-storage/mail-thread.h:
	THREAD=REFERENCES implementation. Doesn't crash, but I'm not sure
	how correct replies it produces :)
	[4f697dde0fca]

	* src/lib-index/mail-index.h:
	Reserve UID 2^31-1
	[b71883ef0247]

	* src/lib-imap/imap-parser.h:
	comment fix
	[a9a7e57064df]

	* src/lib-mail/message-tokenize.c, src/lib-mail/message-tokenize.h:
	Added message_tokenize_get_parse_position()
	[b9875966b09d]

	* src/lib/ostream-file.c, src/lib/ostream.c:
	Minor speed optimizations
	[30babf122f97]

2003-01-07  Timo Sirainen  <tss@iki.fi>

	* src/login/Makefile.am, src/login/client-authenticate.c, src/login
	/client-authenticate.h, src/login/client.c, src/login/client.h:
	Login process now uses the same imap-parser as the imap process
	itself. This fixes the problem of literals not working before
	logging in.
	[5ebec31b49e0]

	* src/lib/istream-file.c, src/lib/istream-internal.h,
	src/lib/istream.c:
	Removed cr_lookup_pos optimization with i_stream_next_line(). It
	breaks if the stream is used with anything else and it's probably
	not worth fixing.
	[23b42ffe8756]

	* src/auth/Makefile.am:
	missing auth-mech-desc.h
	[5f52674b3a58]

2003-01-06  Timo Sirainen  <tss@iki.fi>

	* src/login/ssl-proxy-openssl.c:
	didn't compile
	[5580b1a00e18]

	* src/lib/fdpass.c:
	Still some fixes, I broke Solaris 8.
	[f33a139029db]

	* src/lib-index/mail-index-update.c, src/lib-mail/message-part-
	serialize.c, src/lib-mail/message-part-serialize.h, src/lib-
	storage/index/index-msgcache.c:
	message_part_deserialize() now verifies that the data is valid so we
	don't later crash to some assert.
	[fe0ba77d5506]

	* src/lib-imap/imap-bodystructure.c:
	minor cleanup
	[f8e189e8a98e]

	* src/login/auth-connection.c, src/login/auth-connection.h, src/login
	/client-authenticate.c:
	If authentication was aborted by user, we didn't clean it up
	properly.
	[ee0b3d18edd4]

	* src/master/main.c:
	Call login_process_abormal_exit() only if it was login processes
	that died..
	[7f92d2100795]

	* src/lib/fdpass.c:
	fd_read() fixes, hopefully works better now.
	[e757c5fab691]

	* src/imap/rawlog.c:
	compile fix
	[9d1076e7c090]

	* configure.in, src/lib/compat.h:
	Use separate check for uint_fast32_t.
	[bc55266563cd]

2003-01-05  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/auth/Makefile.am, src/auth/auth-cyrus-sasl2.c,
	src/auth/auth-digest-md5.c, src/auth/auth-interface.h, src/auth
	/auth-mech-desc.h, src/auth/auth-plain.c, src/auth/auth.c,
	src/auth/auth.h, src/auth/login-connection.c, src/auth/userinfo.c,
	src/login/auth-connection.c, src/login/auth-connection.h, src/login
	/client-authenticate.c, src/master/auth-process.c,
	src/master/settings.c, src/master/settings.h:
	Initial support for Cyrus SASL 2 library. I couldn't get it to work
	yet though :)
	[218e68ab290d]

	* src/lib-storage/mail-sort.h, src/lib-storage/mail-storage.h:
	"ISO C forbids forward references to enum types"
	[b176f913d092]

	* src/auth/userinfo-passwd-file.c:
	Don't try looking for plaintext user from all realms. It didn't seem
	to work before and it's probably not a good idea.
	[2d6db119ca9a]

	* doc/auth.txt:
	Updates to MD5 passwords.
	[77a0eb2b5397]

	* configure.in, src/auth/auth-digest-md5.c, src/auth/auth-interface.h,
	src/auth/auth-plain.c, src/auth/auth.c, src/auth/auth.h,
	src/auth/common.h, src/auth/cookie.c, src/auth/cookie.h, src/auth
	/login-connection.c, src/auth/login-connection.h, src/auth/main.c,
	src/auth/master.c, src/auth/userinfo-pam.c, src/auth/userinfo-
	passwd-file.c, src/auth/userinfo-passwd.c, src/auth/userinfo-
	passwd.h, src/auth/userinfo-shadow.c, src/auth/userinfo-vpopmail.c,
	src/auth/userinfo.c, src/auth/userinfo.h, src/imap/client.c,
	src/imap/client.h, src/imap/cmd-append.c, src/imap/cmd-
	authenticate.c, src/imap/cmd-capability.c, src/imap/cmd-check.c,
	src/imap/cmd-close.c, src/imap/cmd-copy.c, src/imap/cmd-create.c,
	src/imap/cmd-delete.c, src/imap/cmd-examine.c, src/imap/cmd-
	expunge.c, src/imap/cmd-fetch.c, src/imap/cmd-list.c, src/imap/cmd-
	login.c, src/imap/cmd-logout.c, src/imap/cmd-lsub.c, src/imap/cmd-
	noop.c, src/imap/cmd-rename.c, src/imap/cmd-search.c, src/imap/cmd-
	select.c, src/imap/cmd-sort.c, src/imap/cmd-status.c, src/imap/cmd-
	store.c, src/imap/cmd-subscribe.c, src/imap/cmd-uid.c, src/imap/cmd-
	unsubscribe.c, src/imap/commands-util.c, src/imap/commands-util.h,
	src/imap/commands.h, src/imap/common.h, src/imap/mail-storage-
	callbacks.c, src/imap/main.c, src/imap/rawlog.c, src/lib-charset
	/charset-iconv.c, src/lib-charset/charset-utf8.c, src/lib-charset
	/charset-utf8.h, src/lib-imap/imap-base-subject.c, src/lib-imap
	/imap-base-subject.h, src/lib-imap/imap-bodystructure.c, src/lib-
	imap/imap-bodystructure.h, src/lib-imap/imap-envelope.c, src/lib-
	imap/imap-envelope.h, src/lib-imap/imap-match.c, src/lib-imap/imap-
	match.h, src/lib-imap/imap-message-cache.c, src/lib-imap/imap-
	message-cache.h, src/lib-imap/imap-parser.c, src/lib-imap/imap-
	parser.h, src/lib-imap/imap-quote.c, src/lib-imap/imap-quote.h, src
	/lib-imap/imap-util.c, src/lib-imap/imap-util.h, src/lib-index/mail-
	custom-flags.c, src/lib-index/mail-custom-flags.h, src/lib-index
	/mail-index-compress.c, src/lib-index/mail-index-data.c, src/lib-
	index/mail-index-data.h, src/lib-index/mail-index-fsck.c, src/lib-
	index/mail-index-open.c, src/lib-index/mail-index-update-cache.c,
	src/lib-index/mail-index-update.c, src/lib-index/mail-index-util.c,
	src/lib-index/mail-index-util.h, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h, src/lib-index/mail-lockdir.c, src/lib-index
	/mail-lockdir.h, src/lib-index/mail-modifylog.c, src/lib-index/mail-
	modifylog.h, src/lib-index/mail-tree-redblack.c, src/lib-index/mail-
	tree.c, src/lib-index/mail-tree.h, src/lib-index/maildir/maildir-
	build.c, src/lib-index/maildir/maildir-index.c, src/lib-
	index/maildir/maildir-index.h, src/lib-index/maildir/maildir-open.c,
	src/lib-index/maildir/maildir-rebuild.c, src/lib-index/maildir
	/maildir-sync.c, src/lib-index/maildir/maildir-update.c, src/lib-
	index/mbox/mbox-append.c, src/lib-index/mbox/mbox-from.c, src/lib-
	index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-
	index/mbox/mbox-lock.c, src/lib-index/mbox/mbox-lock.h, src/lib-
	index/mbox/mbox-open.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-
	index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync-full.c, src
	/lib-index/mbox/mbox-sync.c, src/lib-mail/Makefile.am, src/lib-mail
	/message-address.c, src/lib-mail/message-address.h, src/lib-mail
	/message-body-search.c, src/lib-mail/message-body-search.h, src/lib-
	mail/message-content-parser.c, src/lib-mail/message-date.c, src/lib-
	mail/message-date.h, src/lib-mail/message-header-decode.c, src/lib-
	mail/message-header-search.c, src/lib-mail/message-header-search.h,
	src/lib-mail/message-parser.c, src/lib-mail/message-parser.h, src
	/lib-mail/message-part-serialize.c, src/lib-mail/message-part-
	serialize.h, src/lib-mail/message-send.c, src/lib-mail/message-
	send.h, src/lib-mail/message-size.c, src/lib-mail/message-size.h,
	src/lib-mail/message-tokenize.c, src/lib-mail/message-tokenize.h,
	src/lib-mail/quoted-printable.c, src/lib-mail/quoted-printable.h,
	src/lib-mail/rfc822-address.c, src/lib-mail/rfc822-address.h, src
	/lib-mail/rfc822-date.c, src/lib-mail/rfc822-date.h, src/lib-
	mail/rfc822-tokenize.c, src/lib-mail/rfc822-tokenize.h, src/lib-
	storage/index/index-copy.c, src/lib-storage/index/index-expunge.c,
	src/lib-storage/index/index-fetch-section.c, src/lib-storage/index
	/index-fetch.c, src/lib-storage/index/index-fetch.h, src/lib-
	storage/index/index-mailbox-check.c, src/lib-storage/index/index-
	messageset.c, src/lib-storage/index/index-messageset.h, src/lib-
	storage/index/index-msgcache.c, src/lib-storage/index/index-save.c,
	src/lib-storage/index/index-search.c, src/lib-storage/index/index-
	sort.c, src/lib-storage/index/index-sort.h, src/lib-storage/index
	/index-status.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/index-update-flags.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-expunge.c, src/lib-storage/index/maildir/maildir-list.c,
	src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-expunge.c, src/lib-storage/index/mbox/mbox-list.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-search.c, src/lib-storage/mail-search.h, src/lib-
	storage/mail-sort.c, src/lib-storage/mail-sort.h, src/lib-storage
	/mail-storage.c, src/lib-storage/mail-storage.h, src/lib-storage
	/subscription-file/subscription-file.c, src/lib-storage
	/subscription-file/subscription-file.h, src/lib/base64.c,
	src/lib/base64.h, src/lib/buffer.c, src/lib/buffer.h,
	src/lib/compat.h, src/lib/data-stack.c, src/lib/env-util.c,
	src/lib/failures.h, src/lib/hash.c, src/lib/hash.h, src/lib/hex-
	binary.c, src/lib/hex-binary.h, src/lib/imem.c, src/lib/imem.h,
	src/lib/ioloop-internal.h, src/lib/ioloop-poll.c, src/lib/ioloop-
	select.c, src/lib/ioloop.c, src/lib/ioloop.h, src/lib/iostream-
	internal.h, src/lib/iostream.c, src/lib/istream-data.c, src/lib
	/istream-file.c, src/lib/istream-internal.h, src/lib/istream-mmap.c,
	src/lib/istream.c, src/lib/istream.h, src/lib/lib.h,
	src/lib/macros.h, src/lib/md5.c, src/lib/md5.h, src/lib/mempool-
	alloconly.c, src/lib/mempool-datastack.c, src/lib/mempool-system.c,
	src/lib/mempool.h, src/lib/network.c, src/lib/network.h, src/lib
	/ostream-file.c, src/lib/ostream-internal.h, src/lib/ostream.c,
	src/lib/ostream.h, src/lib/str.c, src/lib/str.h,
	src/lib/strescape.c, src/lib/strescape.h, src/lib/strfuncs.c,
	src/lib/strfuncs.h, src/login/auth-connection.c, src/login/auth-
	connection.h, src/login/client-authenticate.c, src/login/client-
	authenticate.h, src/login/client.c, src/login/client.h,
	src/login/main.c, src/login/master.c, src/login/master.h, src/login
	/ssl-proxy-gnutls.c, src/login/ssl-proxy-openssl.c, src/master/auth-
	process.c, src/master/auth-process.h, src/master/common.h,
	src/master/imap-process.c, src/master/login-process.c,
	src/master/main.c, src/master/master-interface.h,
	src/master/settings.c, src/master/settings.h, src/master/ssl-init.c:
	Naming style changes, finally got tired of most of the typedefs.
	Also the previous enum -> macro change reverted so that we don't use
	the highest bit anymore, that's incompatible with old indexes so
	they will be rebuilt.
	[fd8888f6f037]

	* src/auth/userinfo-passwd-file.c:
	':' -> '@' change was buggy
	[5043e48c022f]

2003-01-04  Timo Sirainen  <tss@iki.fi>

	* src/lib/macros.h:
	If PEDANTIC is defined, don't use (void)(..) with STMT_START/END.
	[a225abf5f479]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h:
	Replaced MailDataField from being enum to being unsigned int with
	values defined with macros. Not that pretty, but enums are signed
	integers and we want to use the highest bit without ugly kludges.
	[981a359257bb]

	* src/lib-storage/index/index-fetch-section.c, src/lib/ioloop-poll.c,
	src/lib/ioloop.c:
	Misc. compiler warning fixes.
	[d3075affded9]

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-imap/imap-base-subject.c, src/lib-imap/imap-bodystructure.c,
	src/lib-imap/imap-envelope.c, src/lib-imap/imap-envelope.h, src/lib-
	imap/imap-message-cache.c, src/lib-imap/imap-parser.c, src/lib-imap
	/imap-quote.c, src/lib-imap/imap-quote.h, src/lib-imap/imap-util.h,
	src/lib-index/mail-index-update.c, src/lib-index/mbox/mbox-append.c,
	src/lib-index/mbox/mbox-from.c, src/lib-index/mbox/mbox-index.c, src
	/lib-index/mbox/mbox-index.h, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-mail/message-body-search.c, src/lib-mail/message-content-
	parser.c, src/lib-mail/message-content-parser.h, src/lib-mail
	/message-header-search.c, src/lib-mail/message-parser.c, src/lib-
	mail/message-parser.h, src/lib-mail/rfc822-address.c, src/lib-
	mail/rfc822-address.h, src/lib-mail/rfc822-date.c, src/lib-
	mail/rfc822-tokenize.c, src/lib-mail/rfc822-tokenize.h, src/lib-
	storage/index/index-fetch-section.c, src/lib-storage/index/index-
	search.c, src/lib-storage/mail-sort.c, src/lib/imem.c,
	src/lib/imem.h, src/lib/istream-data.c, src/lib/istream.h,
	src/lib/str.c, src/lib/str.h, src/lib/strescape.c,
	src/lib/strescape.h, src/lib/strfuncs.c, src/lib/strfuncs.h,
	src/login/client-authenticate.c, src/login/ssl-proxy-gnutls.c:
	Use unsigned char* when accessing non-NUL terminating strings.
	Compiler warnings would then notify about accidentally passing them
	to functions which require them NUL-terminated. Changed a few
	functions to use void* to avoid unneeded casting.
	[0d5be52d7131]

	* src/lib-imap/imap-bodystructure.c, src/lib-mail/message-content-
	parser.c, src/lib-mail/rfc822-address.c, src/lib-mail/rfc822-date.c,
	src/lib-mail/rfc822-tokenize.c, src/lib-mail/rfc822-tokenize.h:
	Rfc822 tokenizer cleanups
	[e27267f227e6]

2003-01-03  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-list.c, src/lib-imap/imap-bodystructure.c, src/lib-imap
	/imap-parser.c, src/lib-imap/imap-util.c, src/lib-imap/imap-util.h,
	src/lib-index/mail-index-update.c, src/lib-index/mbox/mbox-index.c,
	src/lib-mail/message-body-search.c, src/lib-mail/message-content-
	parser.c, src/lib-mail/message-content-parser.h, src/lib-mail
	/message-header-search.c, src/lib-mail/message-parser.c, src/lib-
	mail/message-parser.h, src/lib-mail/rfc822-address.c, src/lib-
	mail/rfc822-date.c, src/lib-mail/rfc822-date.h, src/lib-
	mail/rfc822-tokenize.c, src/lib-mail/rfc822-tokenize.h, src/lib-
	storage/index/index-fetch-section.c, src/lib-storage/index/index-
	search.c, src/lib/Makefile.am, src/lib/strescape.c,
	src/lib/strescape.h, src/lib/strfuncs.c, src/lib/strfuncs.h,
	src/login/client.c:
	Rewrote rfc822-tokenize.c to work one token at a time so it won't
	uselessly take memory, maybe also a bit faster. This caused pretty
	large changes all around.

	Also moved all string (un)escaping code to lib/strescape.c.
	[21ffcce83c70]

	* src/auth/auth-digest-md5.c:
	s/qop-options/qop/, fixes compatibility problem with Cyrus SASL
	library.
	[68c46e7faf4f]

2003-01-02  Timo Sirainen  <tss@iki.fi>

	* src/lib/process-title.c:
	Include unistd.h for setproctitle(), FreeBSD wants it.
	[efe7c015dd78]

	* NEWS, configure.in:
	Getting ready for 0.99.5 release..
	[4f619b97ee65]

	* README, TODO:
	updates
	[80b847900dfd]

	* src/imap/commands-util.c:
	Handle the MAILBOX_NAME_NOINFERIORS case.
	[fd754a6fa784]

	* src/lib-storage/index/mbox/mbox-storage.c:
	CREATE and RENAME should create the folder hierarchy if needed.
	SELECTing a folder gives now prettier error message.
	[079a620c0261]

	* src/lib-storage/mail-storage.h:
	comment updates
	[f6e6812bd872]

	* src/imap/cmd-create.c:
	CREATE mailbox<hierarchy separator> failed always.
	[986e89b61520]

	* src/lib-storage/index/index-fetch-section.c:
	The ending \r\n is message header shouldn't be filtered with FETCH
	BODY[HEADER.FIELDS...].
	[06776a31f50c]

	* src/imap/cmd-list.c:
	Handle LIST A B same way as LIST "" A.B
	[3a4f468a53c6]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h:
	Make sure UIDs won't wrap around unexpectedly.
	[1b3c679d2c6d]

	* src/lib-imap/imap-util.c:
	imap_escape() was broken
	[c5897896c4f1]

	* src/imap/cmd-close.c, src/imap/cmd-search.c, src/imap/commands-
	util.c, src/lib-storage/index/index-messageset.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage.c, src/lib-storage/mail-storage.h:
	Storage can now specify if errors should be sent to user as BAD or
	NO. Some changes to messageset parsing as specified by latest
	IMAP4rev1 draft. Bad charset error is prefixed with [BADCHARSET].
	Fixed a crash in SEARCH the last commit in it caused.
	[39e0b536e708]

	* dovecot-example.conf, src/lib-index/maildir/maildir-sync.c:
	Changed maildir_check_content_changes = yes now to treat the message
	as new because IMAP protocol specifies that existing messages are
	immutable.
	[38b3bc6ddcc4]

	* src/lib-storage/index/index-search.c:
	comment update
	[fe91b60fdb7c]

	* src/lib-imap/imap-envelope.c, src/lib-imap/imap-envelope.h, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-sort.c:
	SEARCHing headers with "" value should always match if the header is
	found. Changed imap_envelope_parse() so that it's possible to
	differentiate NIL from "".
	[d5168cca2052]

	* src/imap/cmd-select.c:
	Added UIDNEXT reply to SELECT/EXAMINE, as required by latest
	IMAP4rev1 draft.
	[488a4c4bcabb]

	* src/lib-imap/imap-parser.h:
	Actually, don't allow NIL with IMAP_ARG_LIST().
	[cc1cf8161203]

	* src/imap/cmd-append.c, src/imap/cmd-fetch.c, src/imap/cmd-search.c,
	src/imap/cmd-sort.c, src/imap/cmd-status.c, src/imap/cmd-store.c,
	src/imap/commands-util.c, src/lib-imap/imap-bodystructure.c, src
	/lib-imap/imap-envelope.c, src/lib-imap/imap-parser.c, src/lib-imap
	/imap-parser.h, src/lib-storage/mail-search.c:
	Don't access ImapArg's union members directly - too easy to mess up.
	Fixes a crash with feeding non-string parameters to SEARCH/SORT
	commands.
	[7935347f54f1]

2002-12-29  Timo Sirainen  <tss@iki.fi>

	* src/master/login-process.c:
	If ssl_disable is set to yes and we get SIGHUPed, don't feed the
	listening socket to login processes anymore or they'll just keep
	dying. We still don't actually close the socket though..
	[ad8f7d2107b4]

	* src/master/settings.c:
	The base_dir setting was actually missing..
	[969bdb985a03]

	* src/lib-mail/message-parser.c:
	extra assert.
	[a60e12a66ad3]

	* src/lib/mmap-anon.c:
	Use void* always with munmap()
	[6c42b9c76464]

	* dovecot-example.conf, src/master/settings.c, src/master/settings.h:
	Added base_dir setting, so the configure time --localstatedir can be
	overridden.
	[6377d4f7a31c]

2002-12-28  Timo Sirainen  <tss@iki.fi>

	* src/lib/fdpass.c:
	more fixes
	[28212c00d147]

	* src/lib/fdpass.c:
	Fixed to work with 64bit BSD systems.
	[971947c0034f]

	* src/lib-storage/index/mbox/mbox-storage.c:
	Complain about missing mbox file.
	[2873d04a566e]

	* src/master/imap-process.c:
	default_mail_env wasn't actually working.
	[c0048f0ef101]

	* src/master/main.c:
	Forgot to handle FATAL_LOGERROR.
	[e1656057b9a5]

	* src/lib/failures.c, src/lib/failures.h:
	In case of internal errors in logging, exit() with FATAL_LOGERROR.
	[43a42c16bba8]

	* src/lib/printf-upper-bound.c:
	Allow %m in printf_string_upper_bound(). Fixes syslog failure
	handler.
	[8676ba4f3ba9]

	* src/lib/process-title.c:
	setproctitle() needs stdlib.h
	[a090577ffdca]

	* src/lib/mmap-anon.c:
	Keep the mmap()ed area far from heap.
	[8ecfe2c250ee]

2002-12-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c:
	BODYSTRUCTURE reply was incorrect. pine didn't like it.
	[375923d2f910]

	* configure.in, src/login/client.c:
	Show STARTTLS in capability only if SSL support is enabled.
	[7498eab8903f]

	* TODO:
	updated
	[c3d0eddd6065]

	* configure.in, src/lib/failures.c, src/lib/macros.h, src/lib/str.c,
	src/lib/strfuncs.c:
	We weren't using va_list properly, especially gcc/PowerPC didn't
	like it.
	[c4754c5770f3]

	* src/lib/mmap-anon.c:
	Old implementation was overly complex and stupid.
	[8f4bd02461e0]

	* src/lib/data-stack.c, src/lib/mempool-alloconly.c, src/lib/mempool-
	datastack.c, src/lib/mempool-system.c, src/lib/mempool.h:
	Removed pool->realloc_min() which nothing used. A few small fixes to
	alloc-only pool.
	[3d437b1e5257]

	* src/lib-imap/imap-message-cache.c, src/lib-mail/message-parser.c,
	src/lib-mail/message-send.c, src/lib-mail/message-size.c, src/lib-
	mail/message-size.h:
	Some bugfixes and speedups for partial fetch handling.
	[e49f7397af98]

	* src/lib-imap/imap-message-cache.c:
	Caching IMAP_CACHE_MESSAGE_PART failed if it was already in cache.
	[c77a8b9fb3ef]

2002-12-22  Timo Sirainen  <tss@iki.fi>

	* src/auth/userinfo-passwd.c:
	Always compile in passwd_fill_cookie_reply(), it's used by pretty
	much all auth modules.
	[89f1e0a754f0]

	* src/lib-storage/index/Makefile.am:
	missing index-sort.h
	[a9c273854dd2]

	* TODO:
	updated
	[a327862d07c0]

	* src/lib/buffer.c:
	Several fixes. I think it's beginning to look safe.
	[e73389a2324a]

	* configure.in:
	Enable more warnings with gcc
	[a6f53dbe803f]

	* src/master/settings.h:
	removed double declaration
	[55a2bac7b74a]

	* src/lib-storage/index/index-fetch-section.c:
	A bit more const'ing.
	[b19889528486]

	* src/auth/auth-digest-md5.c, src/auth/auth.c, src/auth/auth.h,
	src/auth/userinfo-passwd-file.c, src/lib-index/mbox/mbox-lock.c, src
	/lib-storage/index/index-fetch-section.c, src/lib-storage/index
	/index-storage.c, src/lib/strfuncs.c, src/lib/strfuncs.h, src/master
	/imap-process.c, src/master/settings.c:
	t_strsplit() returns now const char **, which removes a few nasty
	casts. Removed a few unneded functions and did some small cleanups.
	[7f41a4b33975]

	* src/lib/failures.c:
	info log was broken
	[8144e1025bda]

	* src/auth/auth-digest-md5.c:
	Use larger initial pool size
	[98cde3d3ab1d]

	* src/lib-storage/index/index-fetch.c:
	Don't send \0 char in FETCH replies..
	[bea83e599761]

	* configure.in:
	EXTRA_CFLAGS environment is now added to CFLAGS after all tests.
	Useful for adding -Werror there.
	[e9a5ce16f0f3]

	* src/lib/strfuncs.c:
	_vstrconcat() is now faster
	[42176571725b]

	* src/lib/data-stack.c:
	t_try_realloc() wasn't working right with DISABLE_DATA_STACK.
	[e3a979b1b55d]

	* src/lib-index/mail-index-update.c:
	Use larger initial pool size for MailIndexUpdate.
	[481a678ba019]

	* COPYING, src/lib/Makefile.am, src/lib/data-stack.c,
	src/lib/failures.c, src/lib/imem.c, src/lib/imem.h, src/lib/mempool-
	alloconly.c, src/lib/mempool-datastack.c, src/lib/mempool-system.c,
	src/lib/printf-upper-bound.c, src/lib/printf-upper-bound.h,
	src/lib/str.c, src/lib/strfuncs.c, src/lib/strfuncs.h,
	src/master/settings.c:
	String function cleanups. Allocating 0 bytes of memory is treated as
	error now, it could be an integer overflow. Moved
	printf_string_upper_bound() to it's own file, so strfuncs.c can be
	with MIT license.
	[34cb1d196d2b]

	* src/lib/compat.c, src/lib/failures.c:
	Don't leak data stack memory.
	[a6cd073c5283]

	* src/lib/compat.c, src/lib/data-stack.c, src/lib/failures.c,
	src/lib/str.c, src/lib/strfuncs.c:
	Use vsnprintf() always when possible, even if we went through the
	upper_bound function. DEBUG message in data stack might have
	sometimes caused an infinite loop. Made sure infinite loops don't
	happen anymore with failure handlers. str_printfa() didn't handle
	%m. Made my_vsyslog() a lot simpler, since t_strdup_printf() is now
	safe enough to call in failure handler.
	[ec6dd72cb8e3]

	* src/lib-index/mail-index-data.h, src/lib-index/mail-index-util.h,
	src/lib-index/mail-index.c, src/lib-index/mail-tree.h:
	Added some missing format attribute declarations. And fixed one more
	bug found found with them.
	[eefa28ef9646]

	* configure.in, src/lib-storage/index/index-storage.c,
	src/lib/failures.c:
	Compile with -Wformat-nonliteral now. Found a format string bug with
	it :( But lucky for us, we haven't allowed %n in format strings for
	a few months now and those bugs were added after that. So arbitrary
	code execution vulnerabilities count is still zero :)
	[91d7ee63a0b5]

	* src/lib/str.c:
	Removed @UNSAFE tag, it's not anymore.
	[64a7dc694b60]

	* src/auth/auth-digest-md5.c, src/imap/cmd-select.c, src/imap/cmd-
	status.c, src/imap/commands-util.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	envelope.h, src/lib-imap/imap-message-cache.c, src/lib-imap/imap-
	quote.c, src/lib-imap/imap-util.c, src/lib-index/maildir/maildir-
	index.c, src/lib-index/mbox/mbox-from.c, src/lib-index/mbox/mbox-
	rewrite.c, src/lib-mail/rfc822-address.c, src/lib-storage/index
	/index-fetch-section.c, src/lib-storage/index/index-fetch.c, src
	/lib-storage/index/index-fetch.h, src/lib/Makefile.am,
	src/lib/lib.h, src/lib/str.c, src/lib/str.h, src/lib/strfuncs.h,
	src/lib/temp-string.c, src/lib/temp-string.h, src/login/client-
	authenticate.c, src/master/imap-process.c:
	Replaced TempString with a String which can use any memory pool and
	uses Buffer internally.
	[41ec8cadd238]

	* src/lib/buffer.c:
	whops, reverted unwanted changes
	[e1ca4ef76ab4]

2002-12-21  Timo Sirainen  <tss@iki.fi>

	* src/lib/buffer.c:
	Last update broke used size.
	[0ae9b03a0f05]

	* src/lib/buffer.c:
	Fixed several bugs, added a small testsuite. Still requires careful
	auditing.
	[27774d0493dd]

	* src/lib/ioloop-select.c:
	Don't define FD_SETSIZE actually, it should exist and it can be less
	than 1024 we used..
	[56bbee9df6f4]

	* src/lib-storage/index/mbox/mbox-storage.c:
	We couldn't delete mbox folders.
	[774f32498a7f]

	* src/lib/ioloop-select.c:
	select() based I/O-loop: Kill ourself if we're trying to use more
	than FD_SETSIZE (1024) fds. Before we just overflowed fd_set buffer,
	but it's unlikely it could have been exploited. Default settings
	prevented this from happening anyway.
	[0450b8c216e8]

	* src/lib/mempool-alloconly.c:
	DEBUG: warn when growing pool
	[ca927eb6202f]

	* src/auth/auth-digest-md5.c, src/auth/userinfo-passwd-file.c,
	src/imap/cmd-list.c, src/imap/cmd-search.c, src/imap/cmd-sort.c, src
	/lib-imap/imap-message-cache.c, src/lib-imap/imap-parser.c, src/lib-
	index/mail-index-update.c, src/lib-index/maildir/maildir-sync.c, src
	/lib-storage/index/index-search.c, src/lib-storage/mail-sort.c,
	src/lib/Makefile.am, src/lib/env-util.c, src/lib/imem.c, src/lib
	/mempool-alloconly.c, src/lib/mempool.c, src/lib/mempool.h:
	We don't have separate read-write pools, so renamed pool_create(..,
	FALSE) to pool_alloconly_create().
	[8afbafd5deac]

	* src/master/settings.c, src/master/ssl-init.c:
	Make sure SSL parameters file has correct permissions before using
	it. Also use effective uid/gid for checking the base dir, don't
	assume roots..
	[02cda88b44e2]

	* src/lib/safe-mkdir.c:
	Whops, should have tested it :) Mode check always failed.
	[d00ce0e4de7f]

	* src/lib-storage/index/maildir/maildir-list.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-storage.c, src/lib/Makefile.am, src/lib/safe-mkdir.c, src/lib
	/safe-mkdir.h, src/lib/unlink-directory.c, src/lib/unlink-
	directory.h, src/master/settings.c:
	If used base/login directories exist already, make sure they're with
	correct permissions. Always delete contents in login directory at
	startup.

	Added safe_mkdir(). changed unlink_directory() behaviour, and fixed
	a race condition which could have made it follow symlinks to other
	directories and delete them. Didn't really harm us so far, we never
	used it for deleting unsafe directories.
	[5101f8bf2368]

	* src/lib-index/mbox/mbox-lock.c:
	Check mbox .lock files with lstat(), not stat(). Just paranoia,
	O_EXCL prevented us from overwriting symlink destinations anyway.
	[9929883228a4]

	* src/lib-storage/index/index-status.c:
	Better checking for corrupted first_unseen_uid_lowwater.
	[9bcd3cc068a5]

	* src/lib-index/mail-index-fsck.c:
	fsck updated first_unseen_uid_lowwater wrong, which caused SELECT or
	EXAMINE to print wrong [UNSEEN seq] tag, or sometimes complain about
	corrupted indexes.
	[ee8acb990752]

	* src/lib-index/mbox/mbox-rewrite.c:
	Don't fsck index after we've rewritten mbox - that doesn't gain us
	anything. Rather just make sure the index's timestamp differs from
	mbox file.
	[3d8767d31fe2]

2002-12-20  Timo Sirainen  <tss@iki.fi>

	* doc/mail-storages.txt, dovecot-example.conf, src/lib-index/mail-
	index.h, src/lib-index/maildir/maildir-index.c, src/lib-
	index/maildir/maildir-index.h, src/lib-index/maildir/maildir-open.c,
	src/lib-index/maildir/maildir-rebuild.c, src/lib-index/maildir
	/maildir-sync.c, src/lib-index/mbox/mbox-append.c, src/lib-
	index/mbox/mbox-index.c, src/lib-index/mbox/mbox-lock.c, src/lib-
	index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c,
	src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-expunge.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-expunge.c, src
	/lib-storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage.h, src/lib/unlink-directory.c:
	Added :INDEX=<dir> for both Maildir and mbox to specify different
	location where to store index files. This would allow keeping
	mailboxes accessible through NFS but still keep the indexes in fast
	local disk.

	Did also some other related cleanups and minor fixes.
	[86cf24da85f1]

	* src/lib-index/maildir/maildir-index.c:
	We got into memory eating loop if maildir file contained unknown
	flags.
	[ae9b55f7164e]

	* doc/mail-storages.txt, dovecot-example.conf, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-list.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage.h:
	Support for separate location of mbox INBOX folder.
	[ef64c9a50326]

	* src/login/client-authenticate.c:
	Removed extra space from capability string.
	[a6d24244c23f]

	* dovecot-example.conf, src/master/imap-process.c:
	default_mail_env behaviour changed. We use %u instead of $U now.
	Added also several other variables which can be used. Ideas based on
	David Champion's mailpath library.
	[493bc8da9e80]

	* src/lib/temp-string.c, src/lib/temp-string.h:
	t_string_append_n() should specify the maximum length for given
	string, which may be shorter than that.
	[9e6317fa800c]

	* dovecot-example.conf, src/auth/main.c, src/imap/main.c,
	src/lib/failures.c, src/lib/failures.h, src/login/client.c,
	src/login/main.c, src/master/imap-process.c, src/master/main.c,
	src/master/settings.c, src/master/settings.h:
	Added info_log_file setting and i_info() function to write to it.
	Default is the same as failure log. Currently only logged
	information is client logins.
	[664de3231e33]

	* src/auth/auth-digest-md5.c, src/auth/auth-interface.h, src/auth
	/auth-plain.c, src/auth/auth.c, src/auth/auth.h, src/auth/cookie.c,
	src/auth/cookie.h, src/auth/login-connection.c, src/auth/main.c,
	src/auth/master.c, src/login/auth-connection.c, src/login/auth-
	connection.h, src/login/client-authenticate.c, src/login/common.h,
	src/login/main.c, src/login/master.c, src/login/master.h, src/master
	/auth-process.c, src/master/auth-process.h, src/master/common.h,
	src/master/login-process.c, src/master/main.c, src/master/master-
	interface.h, src/master/settings.c, src/master/settings.h:
	Instead of just trusting randomness of authentication cookies
	between auth<->master<->login process IPC, master now doesn't accept
	any cookies from login process which weren't created by it
	(identified by PID). When login process dies, all it's pending
	cookies are also removed, so I can't see even a theoretical
	possiblity anymore for exploited login process to authenticate as
	someone else.

	Also fixed some int -> unsigned int.
	[30f6811f4952]

2002-12-19  Timo Sirainen  <tss@iki.fi>

	* src/imap/commands-util.c, src/lib-storage/index/mbox/mbox-list.c,
	src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	Limit the mailbox path. A few cleanups.
	[27554afad17e]

	* src/auth/userinfo-pam.c:
	compile bugfix
	[574a18ea05d6]

	* src/auth/userinfo-pam.c, src/auth/userinfo-passwd-file.c, src/auth
	/userinfo-passwd.c, src/auth/userinfo-vpopmail.c, src/imap/client.c,
	src/imap/rawlog.c, src/lib-imap/imap-parser.c, src/lib-index/mail-
	index-open.c, src/lib-index/maildir/maildir-build.c, src/lib-
	index/maildir/maildir-sync.c, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-mail/rfc822-address.c, src/lib-storage/index/index-fetch-
	section.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-sort.c,
	src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-expunge.c, src/lib-
	storage/index/maildir/maildir-list.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.c,
	src/lib-storage/index/mbox/mbox-list.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c,
	src/lib/hostpid.c, src/lib/mempool-alloconly.c, src/lib/network.c,
	src/lib/ostream.c, src/lib/ostream.h, src/lib/process-title.c,
	src/lib/restrict-access.c, src/lib/strfuncs.c, src/lib/strfuncs.h,
	src/lib/unlink-directory.c, src/lib/unlink-lockfiles.c,
	src/login/client.c, src/login/master.c, src/master/auth-process.c,
	src/master/imap-process.c, src/master/login-process.c,
	src/master/main.c:
	Buffer related cleanups. Use PATH_MAX instead of hardcoded 1024 for
	paths. Added str_path() and str_ppath() functions. i_snprintf() now
	returns only -1 or 0 depending on if buffer got full. dec2str()
	returns the string allocated from data stack. Instead of just
	casting to (long) or (int), we now use dec2str() with printf-like
	functions. Added o_stream_send_str(). Added strocpy() and replaced
	all strcpy()s and strncpy()s with it.

	Pretty much untested, hope it doesn't break too badly :)
	[35abd7a5d381]

2002-12-18  Timo Sirainen  <tss@iki.fi>

	* src/auth/userinfo-vpopmail.c:
	should use mycrypt(), not crypt().
	[5e42a1dbcd0c]

	* configure.in, src/auth/auth-digest-md5.c, src/auth/userinfo-pam.c,
	src/auth/userinfo-passwd-file.c, src/auth/userinfo-passwd.c,
	src/auth/userinfo-shadow.c, src/auth/userinfo-vpopmail.c,
	src/imap/client.c, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	match.c, src/lib-imap/imap-match.h, src/lib-imap/imap-message-
	cache.c, src/lib-imap/imap-parser.c, src/lib-imap/imap-util.c, src
	/lib-index/mail-index-update.c, src/lib-index/mbox/mbox-index.c, src
	/lib-index/mbox/mbox-rewrite.c, src/lib-mail/message-body-search.c,
	src/lib-mail/message-header-search.c, src/lib-mail/message-size.c,
	src/lib-mail/message-size.h, src/lib-mail/rfc822-tokenize.c, src
	/lib-storage/subscription-file/subscription-file.c,
	src/lib/buffer.c, src/lib/buffer.h, src/lib/compat.c,
	src/lib/compat.h, src/lib/data-stack.c, src/lib/hex-binary.c,
	src/lib/ioloop-poll.c, src/lib/istream-file.c, src/lib/istream.c,
	src/lib/md5.c, src/lib/mempool-alloconly.c, src/lib/mempool-
	datastack.c, src/lib/mempool-system.c, src/lib/mmap-anon.c,
	src/lib/network.c, src/lib/network.h, src/lib/ostream-file.c,
	src/lib/randgen.c, src/lib/strfuncs.c, src/lib/temp-string.c,
	src/lib/unlink-directory.c, src/login/auth-connection.c, src/login
	/client-authenticate.c, src/login/client.c, src/login/master.c,
	src/login/ssl-proxy-gnutls.c, src/login/ssl-proxy-openssl.c,
	src/master/auth-process.c, src/master/imap-process.c, src/master
	/login-process.c, src/master/main.c, src/master/settings.c,
	src/master/ssl-init.c:
	Marked all non-trivial buffer modifications with @UNSAFE tag.
	Several cleanups and a couple of minor bugfixes.
	[5ac361acb316]

	* src/auth/auth-plain.c, src/auth/login-connection.c, src/auth
	/userinfo-pam.c, src/auth/userinfo-passwd.c, src/auth/userinfo-
	passwd.h, src/auth/userinfo-shadow.c, src/auth/userinfo-vpopmail.c,
	src/lib/Makefile.am, src/lib/safe-memset.c, src/lib/safe-memset.h,
	src/login/client-authenticate.c, src/login/client.c:
	Added safe_memset() which guarantees that compiler optimizations
	don't optimize it away. Not that we really need to clear the
	passwords from memory, but won't hurt much either :)
	[bf38c8f30a4c]

	* src/lib-index/mbox/mbox-sync-full.c:
	fix warning with older gccs
	[960b35117c39]

	* src/lib/env-util.c:
	unix98 says putenv() returns non-zero for errors - check for that
	rather than just negative values.
	[681cfbf19424]

	* src/auth/main.c, src/imap/main.c, src/lib/env-util.c,
	src/lib/failures.c, src/lib/failures.h, src/lib/lib.c, src/lib
	/process-title.c, src/lib/restrict-access.c, src/lib/restrict-
	access.h, src/login/main.c, src/master/auth-process.c,
	src/master/common.h, src/master/imap-process.c, src/master/login-
	process.c, src/master/main.c:
	Drop root privileges earlier. Close syslog more later in imap-master
	when forking new processes, so that any errors get logged. Make sure
	that all errors show up in log files - use specific exit status
	codes if we can't write to log file. Make sure imap and login
	processes always drop root privileges even if master process didn't
	ask for it for some reason. putenv() wasn't verified to succeed -
	luckily we never allowed large user given data there.
	[86224ff16bf6]

	* configure.in, src/lib/restrict-access.c:
	Don't bother trying to use setreuid(), setuid() check should be
	enough and openbsd complains about it being deprecated.
	[db1608b43054]

	* src/lib-index/mail-index-data.c, src/lib-index/mail-index-util.c,
	src/lib-index/mail-index.c, src/lib-index/mail-lockdir.c, src/lib-
	index/mail-tree-redblack.c:
	Try not to split strings to multiple lines from the middle of human
	readable text. Makes it easier to grep for them.
	[41dde6822eea]

	* src/lib/data-stack.c:
	Use a bit larger initial data stack size when DEBUG is set - current
	one is too small for message searching.
	[1c67ec58f0a1]

	* src/lib-storage/index/index-status.c:
	More verbose error message when noticing problems with seen messages
	count.
	[cecf76430cac]

2002-12-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/subscription-file/subscription-file.c:
	LSUB failed if there was no subscriptions file.
	[92c25daf3a78]

	* TODO:
	updated
	[bcf35cc1a56b]

	* src/lib-storage/index/mbox/mbox-list.c:
	LIST: If our root folder doesn't exists, complain about it.
	Otherwise just ignore those errors.
	[555e620ee8f1]

	* src/lib-imap/imap-base-subject.c, src/lib-imap/imap-base-subject.h:
	Forgot from last SORT commit.
	[ab093fefe04b]

	* configure.in, src/lib-charset/charset-iconv.c, src/lib-charset
	/charset-utf8.c, src/lib-charset/charset-utf8.h, src/lib-
	imap/Makefile.am, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	envelope.h, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-sort.c, src/lib-storage/mail-sort.c, src/lib-
	storage/mail-sort.h:
	Full not-too-well-tested support for SORT extension. Required a few
	library interface changes.
	[d573c53946ac]

	* src/auth/auth-interface.h, src/auth/userinfo-passwd-file.c, src/auth
	/userinfo-passwd.c, src/auth/userinfo-vpopmail.c, src/lib/restrict-
	access.c, src/master/auth-process.c, src/master/common.h, src/master
	/imap-process.c, src/master/login-process.c:
	Clear separation of virtual and system usernames. passwd-file didn't
	work before if the user didn't exist in system. Prefixed also all
	setuid/etc. restriction environments with RESTRICT_.
	[6efced4f80de]

	* src/lib/buffer.h:
	comment update
	[27b28ba2a306]

2002-12-16  Timo Sirainen  <tss@iki.fi>

	* src/master/imap-process.c:
	Don't crash with empty default_mail_env setting.
	[c50f9f4194d2]

	* dovecot-example.conf, src/master/settings.c:
	mailbox_check_interval is now disabled by default, at least
	Evolution breaks with it.
	[5b2a247ed361]

	* src/master/ssl-init.c:
	Don't try creating SSL parameter file when SSL is disabled.
	[31b22b4a48c9]

	* src/lib-index/maildir/maildir-index.c:
	maildir_filename_set_flags() was broken by the buffer changes. the
	base name of maildir files was lost when flags were updated.
	[c0e7bfb5bab8]

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-charset/charset-utf8.h, src/lib-mail/message-body-search.c, src
	/lib-mail/message-header-search.c:
	Don't use Buffers with read-only data, just makes it more difficult
	without gaining anything.
	[d96cbba73a8b]

	* src/lib-index/maildir/maildir-sync.c, src/lib-index/mbox/mbox-
	append.c:
	Fixed a unnecessarily large data stack usage when indexing new
	mails.
	[2a6cc4f0c3c6]

	* src/lib-mail/Makefile.am, src/lib-mail/message-header-decode.c, src
	/lib-mail/message-header-decode.h, src/lib-mail/message-header-
	search.c, src/lib-mail/quoted-printable.c:
	Quoted-Printable decoding was buggy. Extracted RFC2047 header
	decoding into separate function.
	[d826ab8c8d62]

2002-12-14  Timo Sirainen  <tss@iki.fi>

	* src/imap/commands.c:
	CHECK command was actually calling COPY, so it gave just error about
	missing parameters.
	[6699647fd049]

2002-12-12  Timo Sirainen  <tss@iki.fi>

	* src/imap/rawlog.c, src/lib/istream-file.c, src/lib/network.c,
	src/lib/network.h, src/lib/randgen.c:
	net_receive, net_transmit: Return -2 for regular disconnection
	errors. Don't log those errors. Some other cleanups.
	[9cb7022749e7]

	* dovecot-example.conf, src/lib/network.c, src/lib/network.h,
	src/master/main.c, src/master/settings.c:
	imap_listen and imaps_listen accepts now "*" as "all IPv4
	interfaces" and "::" as "all IPv6 interfaces, plus all IPv4
	interfaces if supported by OS".

	Added a few consts to network API and added functions to get
	inaddr_any for ipv4/ipv6.
	[1cc947617c8b]

	* dovecot-example.conf, src/master/imap-process.c,
	src/master/settings.c, src/master/settings.h:
	New setting: default_mail_env which can be used to specify where to
	find users mailbox. Default is still to use autodetection.
	Authentication process can override this if needed, it's possible
	with passwd-file authentication.
	[f126b666859e]

	* src/lib-index/mbox/mbox-sync-full.c:
	Deleting messages in the middle of mbox caused dovecot to reindex
	the following messages as new messages (ie. change UIDs and set
	\Recent flag).
	[9c9d89e56514]

2002-12-10  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/lib/ioloop-select.c:
	select() is nowadays defined to be in sys/select.h
	[a02e5e7790bb]

2002-12-09  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-part-serialize.c:
	still stupid bug :) works now, tested.
	[acf904579d84]

	* src/lib-mail/message-part-serialize.c:
	still broken
	[d5a3c18c9082]

	* src/lib-index/mail-index-fsck.c:
	When printing fsck warnings, print also the index file path
	[a2eaa563f40a]

	* src/lib-mail/message-part-serialize.c:
	message_part_serialize() was broken with multipart messages.
	[5984360c231d]

	* src/auth/userinfo-passwd-file.c:
	Digest-MD5 lookup was broken.
	[68248bb9ad82]

	* src/auth/auth-digest-md5.c:
	Added missing comma between realm and nonce.
	[fff9f94f1686]

	* src/lib/base64.c:
	base64_encode() was broken
	[f28f1055e189]

	* src/imap/client.c:
	Fixed "Missing arguments" error msg to work again
	[f17a1f59ac3f]

	* src/imap/client.c, src/imap/cmd-append.c, src/imap/cmd-search.c,
	src/imap/cmd-sort.c, src/lib-imap/imap-bodystructure.c, src/lib-imap
	/imap-envelope.c, src/lib-imap/imap-parser.c, src/lib-imap/imap-
	parser.h:
	Limited max. command argument elements to 128. Added more verbose
	error messages to IMAP parser.
	[8b3518bb327e]

	* src/lib-storage/mail-search.c:
	Don't crash with missing search argument parameters.
	[c809378a48db]

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c, src
	/lib-charset/charset-utf8.h:
	Compiles again without iconv()
	[03832c7f389b]

2002-12-08  Timo Sirainen  <tss@iki.fi>

	* src/auth/auth-digest-md5.c, src/auth/auth-plain.c, src/auth
	/userinfo-passwd-file.c, src/imap/cmd-list.c, src/imap/cmd-sort.c,
	src/imap/cmd-uid.c, src/imap/main.c, src/imap/rawlog.c, src/lib-
	charset/charset-iconv.c, src/lib-charset/charset-utf8.h, src/lib-
	index/mail-custom-flags.c, src/lib-index/mail-index-update.c, src
	/lib-index/mail-modifylog.c, src/lib-index/maildir/maildir-index.c,
	src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-mail/message-body-search.c, src/lib-mail/message-header-
	search.c, src/lib-mail/message-header-search.h, src/lib-mail
	/message-parser.c, src/lib-mail/message-part-serialize.c, src/lib-
	mail/message-part-serialize.h, src/lib-mail/quoted-printable.c, src
	/lib-mail/quoted-printable.h, src/lib-storage/index/index-search.c,
	src/lib-storage/mail-sort.c, src/lib-storage/mail-storage.c,
	src/lib/Makefile.am, src/lib/base64.c, src/lib/base64.h,
	src/lib/buffer.c, src/lib/buffer.h, src/lib/data-stack.c, src/lib
	/hex-binary.c, src/lib/hex-binary.h, src/lib/lib.h, src/login
	/client-authenticate.c, src/login/client.c, src/login/client.h:
	Added buffer API. Point is to hide all buffer writing behind this
	API which verifies that nothing overflows. Much better than doing
	the same checks all around the code, even if it is slightly slower.

	Buffer reading is still mostly done directly, that isn't such a big
	security risk and I can't think of a reasonable API for it anyway.
	[553f050c8313]

2002-12-06  Timo Sirainen  <tss@iki.fi>

	* src/auth/login-connection.c, src/auth/master.c, src/auth/userinfo-
	passwd-file.c, src/imap/client.c, src/imap/client.h, src/imap/cmd-
	append.c, src/imap/cmd-fetch.c, src/imap/cmd-search.c, src/imap/cmd-
	sort.c, src/imap/mail-storage-callbacks.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-bodystructure.h, src/lib-imap
	/imap-envelope.c, src/lib-imap/imap-message-cache.c, src/lib-imap
	/imap-message-cache.h, src/lib-imap/imap-parser.c, src/lib-imap
	/imap-parser.h, src/lib-index/mail-index-update-cache.c, src/lib-
	index/mail-index-update.c, src/lib-index/mail-index-util.c, src/lib-
	index/mail-index.h, src/lib-index/maildir/maildir-index.h, src/lib-
	index/maildir/maildir-open.c, src/lib-index/maildir/maildir-
	update.c, src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-
	index.c, src/lib-index/mbox/mbox-index.h, src/lib-index/mbox/mbox-
	lock.c, src/lib-index/mbox/mbox-open.c, src/lib-index/mbox/mbox-
	rebuild.c, src/lib-index/mbox/mbox-rewrite.c, src/lib-index/mbox
	/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c, src/lib-mail
	/message-body-search.c, src/lib-mail/message-body-search.h, src/lib-
	mail/message-parser.c, src/lib-mail/message-parser.h, src/lib-mail
	/message-send.c, src/lib-mail/message-send.h, src/lib-mail/message-
	size.c, src/lib-mail/message-size.h, src/lib-storage/index/index-
	copy.c, src/lib-storage/index/index-fetch-section.c, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-fetch.h,
	src/lib-storage/index/index-msgcache.c, src/lib-storage/index/index-
	save.c, src/lib-storage/index/index-search.c, src/lib-storage/index
	/index-sort.c, src/lib-storage/index/index-sort.h, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/maildir/maildir-storage.h,
	src/lib-storage/index/mbox/mbox-expunge.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/mail-sort.c, src/lib-storage/mail-
	storage.h, src/lib/Makefile.am, src/lib/ibuffer-data.c, src/lib
	/ibuffer-file.c, src/lib/ibuffer-internal.h, src/lib/ibuffer-mmap.c,
	src/lib/ibuffer.c, src/lib/ibuffer.h, src/lib/iobuffer-internal.h,
	src/lib/iobuffer.c, src/lib/iostream-internal.h, src/lib/iostream.c,
	src/lib/istream-data.c, src/lib/istream-file.c, src/lib/istream-
	internal.h, src/lib/istream-mmap.c, src/lib/istream.c,
	src/lib/istream.h, src/lib/lib.h, src/lib/obuffer-file.c, src/lib
	/obuffer-internal.h, src/lib/obuffer.c, src/lib/obuffer.h, src/lib
	/ostream-file.c, src/lib/ostream-internal.h, src/lib/ostream.c,
	src/lib/ostream.h, src/login/auth-connection.c, src/login/client-
	authenticate.c, src/login/client.c, src/login/client.h, src/master
	/auth-process.c, src/master/login-process.c, src/master/settings.c:
	Renamed IBuffer and OBuffer to IStream and OStream which describes
	their functionality better. I tried to keep the variable names and
	comments also sensible.
	[f57c52738f90]

	* src/lib-storage/mail-sort.c, src/lib-storage/mail-sort.h:
	Small cleanups.
	[bbf682857b4a]

2002-12-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-save.c:
	When APPEND timeouted while waiting for input data, say it now
	nicely instead of writing about it to error log.
	[78f07216daeb]

2002-12-04  Timo Sirainen  <tss@iki.fi>

	* configure.in, src/imap/Makefile.am, src/imap/cmd-search.c, src/imap
	/cmd-sort.c, src/imap/commands.c, src/imap/commands.h, src/lib-
	storage/.cvsignore, src/lib-storage/Makefile.am, src/lib-
	storage/index/Makefile.am, src/lib-storage/index/index-search.c, src
	/lib-storage/index/index-sort.c, src/lib-storage/index/index-sort.h,
	src/lib-storage/index/index-storage.h, src/lib-storage/mail-sort.c,
	src/lib-storage/mail-sort.h, src/lib-storage/mail-storage.h, src
	/lib-storage/register/.cvsignore, src/lib-
	storage/register/Makefile.am:
	First implementation of SORT extension. String comparing still not
	up to spec, so we don't advertise it in capability string yet. The
	code supports getting the data partially pre-sorted to reduce memory
	usage and make it faster. So, in future we could use this by
	creating sorted binary trees.

	Also moved mail-storage-register.c into it's own .a lib to fix
	circular dependencies.
	[d3bd41a56309]

	* src/lib-mail/rfc822-date.c:
	We didn't handle single-digit days.
	[3398c23434de]

	* src/lib/alarm-hup.c:
	Set all required sigaction values when deinitializing.
	[aafe524f26c4]

	* src/imap/cmd-list.c:
	Send INBOX always uppercased with LIST and LSUB.
	[a1dc53fcc0a7]

	* src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h:
	Forgot to commit.
	[5d80c93e6c52]

	* doc/mkcert.sh:
	Subject printing used wrong certificate file.
	[17598099d9ac]

	* configure.in:
	#undef _FILE_OFFSET_BITS before checking for sendfile() support,
	that breaks it.
	[2330d6d75910]

	* AUTHORS, COPYING, src/imap/cmd-list.c, src/lib-imap/imap-match.c,
	src/lib-imap/imap-match.h, src/lib-storage/index/maildir/maildir-
	list.c, src/lib-storage/index/mbox/mbox-list.c, src/lib-storage
	/subscription-file/subscription-file.c:
	Rewrote imap_match() function. Maybe not as fast as before, but at
	least it's understandable now. This was required to fix listing mbox
	mailboxes where we wanted to match partial paths (it was pretty
	buggy before).
	[b531f5cd415e]

2002-12-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c:
	charset_to_ucase_utf8_string() didn't return \0 terminated string
	with ascii/utf8.
	[3521edb6c240]

	* src/master/settings.c:
	We should verify existance of log directory, not the file itself.
	[772d8ad12895]

	* src/lib/data-stack.c:
	DEBUG: Don't send shrink messages, they could cause infinite loop.
	[04e2c5774c3f]

	* configure.in:
	Give a hard warning if size_t is signed.
	[b97c8964d7c1]

	* src/imap/main.c:
	imap processes open syslog fd now immediately at startup, so
	dropping roots and potential chrooting won't break it.
	[501bd2f532ae]

	* src/imap/main.c:
	Sanity check to make sure USER environment exists.
	[474319868e82]

	* src/master/login-process.c:
	Let login process also know if verbose process titles are wanted..
	[db6fb0aa16d1]

	* src/imap/main.c, src/imap/rawlog.c:
	Set process title for rawlog process.
	[ad4292a30b1d]

	* configure.in, src/lib/Makefile.am, src/lib/process-title.c, src/lib
	/process-title.h, src/login/client.c, src/login/client.h,
	src/login/common.h, src/login/main.c:
	Login process now changes it's name if verbose_proctitle = yes, and
	we're running BSD. This is also possible with Linux with a pretty
	ugly hack, which you can enable by modifying lib/process-title.c if
	you _really_ want to.

	And a nasty bugfix - login_process_per_connection setting didn't
	work with imaps port connections which is exactly where it was
	mostly wanted.
	[32040b730b37]

2002-12-02  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/rfc822-tokenize.c, src/lib-mail/rfc822-tokenize.h:
	int -> size_t
	[68d99a09dab2]

	* src/lib/imem.h, src/lib/mempool.h:
	We shouldn't cast sizeof() to unsigned int.
	[a85130f17ab5]

	* acconfig.h, configure.in:
	acconfig.h is deprecated with autoconf 2.5, changed configure to
	contain internal definitions. Also off_t type was detected wrong,
	long/int were swapped.
	[b3dd87844fff]

2002-12-01  Timo Sirainen  <tss@iki.fi>

	* src/master/settings.c:
	Check ssl/log settings while starting up.
	[a0b37087d673]

	* src/master/main.c:
	If ssl_disabled = yes, we shouldn't listen in imaps port.
	[3eae69eb6628]

	* acconfig.h, configure.in, src/lib/restrict-process-size.c:
	RLIMIT_AS isn't supported everywhere - use it if it exists, but also
	use RLIMIT_DATA.
	[f50714973d0b]

	* src/imap/main.c:
	DEBUG: We shouldn't verify the fds when running in pre-auth mode
	(breaks with gdb).
	[1b0205fc4153]

	* src/lib-mail/message-header-search.c:
	Added a few t_push/t_pops to prevent unnecessary memory usage.
	[eae61c3f4f3c]

	* src/lib-charset/charset-iconv.c:
	We shouldn't be strdup()ing the buffer, it's not \0 terminated.
	[edd896dda3bd]

	* src/lib-imap/imap-parser.c:
	All SEARCH arguments still may not have been parsed.
	[ce93054db96b]

	* src/lib/data-stack.c:
	crashfix when DEBUG was set.
	[b89a43bd90c5]

	* configure.in:
	AC_TYPEOF macro: with gcc we can check the type with printf() +
	-Werror
	[280c0952fa90]

	* NEWS, configure.in:
	0.99.4 out
	[890ee8db4f3e]

	* src/login/ssl-proxy-openssl.c:
	Be quiet about syscall/ssl errors, they're rarely fatal.
	[0cf0c312284f]

	* src/lib/failures.c, src/lib/fd-close-on-exec.c, src/lib/randgen.c:
	Set close-on-exec flag to failure log, /dev/urandom fd already tried
	to do that but did it wrong.
	[02fe757df1f0]

	* src/lib/failures.c:
	bugfix
	[9bfc0ee945df]

	* src/lib/data-stack.c:
	DEBUG: we get warnings when growing/shrinking data stack.
	[883cda17d175]

	* src/auth/main.c, src/imap/main.c, src/lib/Makefile.am, src/lib/fd-
	close-on-exec.c, src/lib/fd-close-on-exec.h, src/login/main.c,
	src/master/auth-process.c, src/master/auth-process.h, src/master
	/login-process.c, src/master/login-process.h, src/master/main.c:
	We use close-on-exec flag now to make sure that master process
	closes the fds when executing other processes.
	[8dd8ebe6bcac]

	* src/lib/failures.c:
	Changed so that we can use the functions before calling
	failures_init().
	[d60c6c65d1ca]

	* TODO:
	updated
	[3bc6324e5ba3]

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-index-update-
	cache.c, src/lib-index/mail-index-update.c, src/lib-index/mbox/mbox-
	index.c:
	A few memory leak fixes.
	[1be59bbb13f6]

	* src/master/auth-process.c:
	whops, accidentally committed some test code.
	[2fc7cb5197b4]

	* configure.in, dovecot-example.conf, src/lib/Makefile.am, src/lib
	/restrict-process-size.c, src/lib/restrict-process-size.h,
	src/master/auth-process.c, src/master/imap-process.c, src/master
	/login-process.c, src/master/settings.c, src/master/settings.h:
	Added virtual memory size limits to processes. Default values are
	pretty high, this is mostly because I want it to prevent accidental
	infinite loops eating memory or some integer overflows, not to
	actually restrict anything.
	[0438621d25ff]

	* src/lib-storage/subscription-file/subscription-file.c:
	subsfile_foreach() (LSUB) leaked memory.
	[b01cd1b30764]

2002-11-30  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c, src/lib-imap/imap-parser.c:
	Maybe now?
	[e0825139b0f1]

	* src/lib-imap/imap-parser.c:
	Still not exactly right.
	[d23e1df5efa0]

	* src/lib-imap/imap-parser.c:
	Lists still weren't fully parsed always.
	[70dc986f3164]

	* src/imap/client.c, src/lib-imap/imap-parser.c:
	Input parsing was a bit broken in some conditions. Mostly visible
	with APPEND (_finally_, that should be the last weird bug I've
	noticed).
	[3f817df5eba4]

	* src/lib-mail/message-body-search.c, src/lib-mail/message-body-
	search.h, src/lib-storage/index/index-search.c:
	Body searching wasn't working with unknown charsets, and SEARCH BODY
	searched also headers.
	[dd574ac271c1]

	* src/lib-mail/message-header-search.c, src/lib-storage/index/index-
	search.c:
	Non-envelope-cached header searching wasn't working. Also now search
	works with messages having 8bit headers, assuming them being in same
	charset as search key.
	[3e952f64b2ec]

	* src/lib-index/mail-index-update.c:
	When updating cached fields with mbox, the first message was set to
	size of the whole mbox file, deleting the rest of the messages from
	the index (mbox file itself didn't get corrupted)..
	[c93b47143909]

2002-11-27  Timo Sirainen  <tss@iki.fi>

	* src/master/auth-process.c:
	added assert.
	[a8b43d111284]

	* configure.in:
	--with-ssldir actually didn't do anything, and the default directory
	for them wasn't set either. Not important enough to release 0.99.4
	though.
	[385f862a4005]

	* NEWS, configure.in:
	0.99.3 release
	[f0b27bacadbf]

	* src/lib-index/mbox/mbox-index.c:
	temporarily disabled mail_read_mmaped setting, causes expunge
	corruption.
	[7b1bef7ffbeb]

2002-11-26  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop-select.c:
	unused variable
	[f28c18b7acc3]

	* src/lib/env-util.c:
	crashfix
	[f7a13d96c09d]

	* NEWS, TODO:
	0.99.2 released
	[09c01325e070]

	* acconfig.h, configure.in, src/auth/userinfo-pam.c:
	OSX puts PAM includes into pam/ directory instead of security.
	Detect that.
	[df5bf4ee669f]

	* src/lib-index/maildir/maildir-sync.c, src/lib/hash.c,
	src/lib/hash.h:
	Removed const from key and value of hash_insert() and hash_update().
	[b1bec95ecde3]

	* src/lib/compat.c, src/lib/compat.h, src/lib/obuffer-file.c:
	writev()'s 3rd parameter is declared as "int" pretty much
	everywhere, so we should do that too.
	[fdc1fafb533d]

	* src/login/ssl-proxy.c:
	warning fix
	[f13ff48cb172]

	* configure.in:
	No, actually we don't want -Wcast-align :)
	[f1a1e9333a9e]

	* src/login/ssl-proxy-openssl.c:
	accidental global -> static
	[e7781d662778]

	* src/auth/Makefile.am, src/auth/master.h:
	missing master.h
	[1d20a088aead]

	* configure.in, src/auth/main.c, src/auth/master.c, src/imap/cmd-
	examine.c, src/imap/cmd-list.c, src/imap/cmd-lsub.c, src/imap/cmd-
	select.c, src/imap/cmd-subscribe.c, src/imap/cmd-unsubscribe.c,
	src/imap/commands.h, src/lib/mempool-alloconly.c, src/lib/mempool.c,
	src/lib/mempool.h, src/master/auth-process.c, src/master/login-
	process.c:
	Use more warnings with GCC by default. Fixed several warnings.
	[cc795d74d08f]

	* src/imap/rawlog.c, src/lib-index/mail-index-open.c, src/lib-
	index/mbox/mbox-index.c:
	misc. compiling cleanups.
	[bbc5f74c464f]

	* src/lib/Makefile.am, src/lib/env-util.c, src/lib/env-util.h, src/lib
	/restrict-access.c, src/master/auth-process.c, src/master/imap-
	process.c, src/master/login-process.c, src/master/main.c:
	Created env_put() and env_clean() for a bit easier handling of
	environment variables.
	[7814b29d0862]

	* src/lib/compat.h:
	Reverted back the isdigit()/etc. They're defined to get int
	argument, so we shouldn't given them unsigned.
	[c7f42a8e7176]

	* src/lib/mempool-alloconly.c:
	Don't do void* arithmetics.
	[e7a00568df23]

	* src/lib/compat.h:
	Cast chars to (unsigned int) instead of (int) in i_isdigit() etc.
	macros. Hopefully fixes some warnings with HP/UX.
	[944758e83111]

	* src/lib/compat.h:
	And the missing sys/sysmacros.h include..
	[21233287e9c1]

	* configure.in, src/lib-index/mbox/mbox-lock.c, src/lib-index/mbox
	/mbox-sync.c, src/lib/compat.h:
	Added CMP_DEV_T macro which uses major()/minor() if possible but
	fallbacks to direct comparing if it's not a structure.
	[359f73bf84b5]

	* acconfig.h, configure.in, src/lib-index/mail-index.h, src/lib-
	index/mbox/mbox-lock.c, src/lib-index/mbox/mbox-sync.c:
	We compile now if dev_t is a structure (eg. glibc+tcc).
	[567f5e66c7b8]

	* src/auth/Makefile.am, src/auth/mycrypt.c, src/auth/mycrypt.h,
	src/lib/Makefile.am, src/lib/mycrypt.c, src/lib/mycrypt.h:
	Moved mycrypt() into auth/ dir, so we don't have to link all
	programs with
	-lcrypt
	[413227772e6f]

	* src/lib/Makefile.am:
	Forgot mycrypt.h
	[7d00ff7ef77c]

	* src/master/ssl-init-openssl.c:
	Removed compiler warnings.
	[d36b8eaa259b]

	* src/lib/mycrypt.c:
	And added the rest of the defines to make sure it compiles.
	[ebab743ef4ee]

	* src/auth/userinfo-passwd-file.c, src/auth/userinfo-passwd.c,
	src/auth/userinfo-passwd.h, src/auth/userinfo-shadow.c, src/auth
	/userinfo-vpopmail.c, src/lib/Makefile.am, src/lib/mycrypt.c,
	src/lib/mycrypt.h:
	Still more crypt() problems. Wrapped it into mycrypt() which should
	finally put end to this kludgeing.
	[ae9e39383a72]

	* src/auth/userinfo-passwd.h:
	compile fix for netbsd-current.
	[6e718f25f0d5]

	* src/master/ssl-init.c:
	missing include file
	[e7ad373d4e77]

	* src/master/auth-process.c:
	Still not correct order with dup2()ing.
	[63acdd7a4f83]

	* src/master/auth-process.c:
	Close old fds before dup2()ing to fd 3, so we don't close it
	accidentally.
	[735d59fda607]

	* src/master/Makefile.am, src/master/settings.c:
	default settings still pointed to lib dir instead of libexec dir..
	[d787d0bc3b58]

	* src/auth/main.c, src/lib/network.c, src/lib/network.h,
	src/login/main.c:
	net_accept() returns now -2 for fatal failures.
	[84e398270f7f]

	* configure.in:
	Get uintmax_t from inttypes.h instead of stdint.h.
	[78966c511e57]

	* acconfig.h, configure.in, src/imap/mail-storage-callbacks.c, src
	/lib-index/mbox/mbox-rewrite.c, src/lib-storage/index/index-
	search.c, src/lib/compat.h, src/lib/hostpid.c, src/lib/lib.h,
	src/lib/strfuncs.c, src/lib/strfuncs.h:
	Renamed largest_t to uintmax_t which already exists in C99.
	[1e5c655bad25]

	* configure.in:
	Created AC_TYPEOF() which tells what base type (int/long/long long)
	the given type is. This cleans up the ssize_t and off_t checks. We
	also try another way to figure out the size by checking if compiler
	allows us to redeclare the type using typedef, at least it works
	with gcc. This should get rid of the warnings with OSX where ssize_t
	was previously declared as int instead of long.
	[3089685bbb7e]

	* acconfig.h, configure.in, src/lib/Makefile.am, src/lib/ioloop-
	poll.c, src/lib/ioloop-select.c:
	select() support was broken. Also changed the way it's built.
	[3e23fa94f762]

	* src/lib-mail/message-header-search.c, src/lib/ioloop-select.c,
	src/login/client-authenticate.c:
	Fixed a few compiling warnings about signedness.
	[a26d28bbc3ff]

2002-11-25  Timo Sirainen  <tss@iki.fi>

	* TODO, src/imap/Makefile.am, src/imap/client.c, src/imap/cmd-
	select.c, src/imap/mail-storage-callbacks.c, src/imap/mailbox-
	sync.c, src/lib-index/mail-custom-flags.c, src/lib-index/mail-index-
	open.c, src/lib-index/mail-index-util.c, src/lib-index/mail-index-
	util.h, src/lib-index/mail-index.c, src/lib-index/mail-index.h, src
	/lib-index/mail-modifylog.c, src/lib-index/maildir/maildir-index.c,
	src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-lock.c, src
	/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	expunge.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-messageset.c, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-sync.c, src/lib-storage/index
	/index-update-flags.c, src/lib-storage/index/maildir/maildir-copy.c,
	src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/mail-storage.h, src/lib-storage
	/subscription-file/subscription-file.c, src/lib/file-lock.c, src/lib
	/file-lock.h:
	Locking changes triggered a bit larger cleanup :) If we have to wait
	for a lock longer, the client is now notified about it every 30
	seconds. Also if mailbox opening fails because of lock timeout, we
	won't overwrite the index anymore. Finally user gets a clear error
	message about lock timeout instead of "internal error".
	[b7aefd0d7611]

	* src/login/client-authenticate.c:
	We crashed if master process didn't let us authenticate.
	[d864b45e708e]

	* src/auth/userinfo-vpopmail.c:
	whops, commented out too much of the debug macro
	[550eaf0fcb7a]

	* src/auth/userinfo-vpopmail.c:
	vpopmail's parse_email() is buggy, we need to zero fill the username
	buffer before calling it.
	[d2a574cbeccb]

	* src/auth/common.h, src/master/auth-process.c:
	Moved login listener handle to fd 3 from 1 (stdout), because
	vpopmail could try writing into it.
	[e5f32324af3c]

	* NEWS:
	And the date :)
	[d560d17cf23d]

	* NEWS, configure.in:
	0.99.1 released
	[aff68c9e0317]

	* src/imap/Makefile.am:
	Reverted accidental commit.
	[aa33734bccd5]

	* dovecot-example.conf, src/master/login-process.c,
	src/master/settings.c, src/master/settings.h:
	Added ssl_disable setting.
	[36ac2fd352ff]

	* doc/mkcert.sh:
	Name the cert and key files as "imapd.pem" after all like they're in
	config file. I'm not sure what's the standard naming in /etc/ssl
	though.
	[748cbf0af0ed]

	* doc/auth.txt, doc/configuration.txt:
	updates
	[fa8e1eb0b881]

	* doc/configuration.txt:
	updated
	[4b02fde791dd]

	* src/master/settings.c:
	SSLDIR, not SSL_DIR
	[8993ccefd9a0]

	* dovecot-example.conf:
	updated lib paths to libexec ones
	[b88b5488bcfd]

	* src/auth/userinfo-vpopmail.c:
	Missing include file caused compiling to break
	[b9c20fe3ddde]

	* .cvsignore:
	updated
	[47cdbb98fdae]

	* src/master/Makefile.am, src/master/settings.c:
	Use --with-ssldir directory instead of hardcoded /etc/ssl
	[1a86a8b6e6ff]

	* configure.in, doc/Makefile.am, doc/dovecot-openssl.cnf,
	doc/mkcert.sh, dovecot-example.conf:
	Added script to easily generate self-signed certificate.
	[85a888d2766e]

2002-11-24  Timo Sirainen  <tss@iki.fi>

	* src/auth/Makefile.am, src/imap/Makefile.am, src/login/Makefile.am:
	Use libexecdir instead of libdir to install the binaries.
	[da039ae2cfd1]

	* doc/Makefile.am:
	The txt files are now installed into doc directory, and a few of
	them were missing.
	[f3870975abcf]

	* configure.in:
	Was missing -lcrypto when checking for OpenSSL.
	[5ad6e4f51c96]

	* configure.in:
	Final bugfix..
	[67c840670ee2]

	* NEWS, configure.in:
	0.99.0 released
	[d0c09214b803]

2002-11-22  Timo Sirainen  <tss@iki.fi>

	* TODO:
	updated
	[f96c45d2e24a]

	* src/lib-index/mbox/mbox-lock.c:
	Even if we didn't want to create dotlock when reading, first make
	sure it doesn't exist. This is a bit racy, but can't help that.
	[4fb29279235f]

	* src/lib/ibuffer-file.c:
	cleanup
	[e4cf79f2a30f]

	* src/lib/ibuffer-file.c:
	Several bugfixes and speedups related to i_buffer_skip().
	[3663df53b127]

	* src/lib-imap/imap-bodystructure.c:
	handle broken multipart messages without crashing
	[1acbf6c8758c]

2002-11-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.h, src
	/lib-index/maildir/maildir-index.c, src/lib-index/mbox/mbox-index.c:
	MAIL_READ_MMAPED setting was set too late, plus a few cleanups.
	[ea7099259c57]

	* src/lib-index/mbox/mbox-index.c:
	lseek() to beginning of file before creating file ibuffer.
	[0834f1490e68]

	* dovecot-example.conf, src/lib-index/mail-index-open.c, src/lib-index
	/mail-index.h, src/lib-index/maildir/maildir-open.c, src/lib-
	index/maildir/maildir-update.c, src/lib-index/mbox/mbox-index.c,
	src/master/imap-process.c, src/master/settings.c,
	src/master/settings.h:
	mail_read_mmaped: Use mmap() instead of read() to read mail files.
	read() seems to be a bit faster with my Linux/x86 and it's better
	with NFS, so that's the default.
	[415498fa78d6]

	* dovecot-example.conf, src/lib-index/mail-index.h, src/lib-index/mbox
	/mbox-lock.c, src/master/imap-process.c, src/master/settings.c,
	src/master/settings.h:
	Added mbox lock settings to config file. Support timeouting fcntl()
	and flock() locks. Plus before the fcntl/flocks weren't even set.
	[da34bdd4e0c6]

	* src/lib-index/mbox/mbox-rewrite.c:
	Don't rewrite when there's no messages (ie. don't write the one
	'\n').
	[5f5fdc45c19d]

2002-11-20  Timo Sirainen  <tss@iki.fi>

	* src/login/ssl-proxy-openssl.c:
	Don't log when remote close()d connection.
	[83aaf3dc6362]

	* src/login/master.c:
	bugfix
	[91f2f80123f0]

	* src/login/client-authenticate.c, src/login/client.c:
	Make sure we're not doing io_remove() for already removed IO.
	[252bdd1392f0]

	* src/login/common.h, src/login/main.c, src/login/master.c:
	When connection to master is lost, close listening sockets.
	[78b261175f2d]

	* src/login/ssl-proxy-openssl.c:
	More verbose logging.
	[6e5279a60f82]

	* src/login/client.c:
	If SSL handshake failed we accessed free'd memory.
	[02a80e0f71cb]

	* src/master/auth-process.c, src/master/auth-process.h, src/master
	/login-process.c, src/master/login-process.h, src/master/main.c,
	src/master/settings.c, src/master/settings.h:
	SIGHUP reloads now settings. Logged in clients are left untouched,
	but clients still logging in are killed.
	[90a65c017bf0]

	* TODO:
	updated
	[339c176aba1e]

	* src/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/mbox/mbox-save.c:
	COPYing inside same mailbox works now with mbox. Also fixed SAVE
	leaving From-line written to mbox file if it was aborted.
	[3814fc4f4135]

	* src/lib-index/mbox/mbox-sync.c:
	syncing doesn't do anything now if we know we're already synced
	[8efd9f63e333]

	* src/lib-index/mail-index.c:
	debug fix
	[8abfbce2f72d]

	* src/lib/ibuffer-mmap.c:
	make sure i_buffer_read() sets buf_errno to 0 at eof.
	[03f23250b63d]

	* src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-rewrite.c:
	If first message with our X-IMAPbase is deleted, make sure it's
	added back.
	[2f3b2a5d74d7]

	* src/lib/network.c:
	typofix
	[e4aba04143ad]

	* src/lib-index/mail-tree.c:
	Avoid rebuilding tree twice if two processes notice it's broken at
	the same time.
	[49893535ce92]

	* src/lib-storage/index/maildir/maildir-storage.c:
	typo in comment
	[5ce5aafe28d9]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Don't allow '*' and '%' characters in mailbox names. Maildir RENAME
	works now properly when renaming folders having subfolders.
	[fe017093e4d8]

	* src/login/ssl-proxy-openssl.c:
	bugfix
	[8bc4876397cd]

	* INSTALL, configure.in, src/master/ssl-init-gnutls.c:
	SSL fixes and doc updates.
	[3fa9e363cd3d]

	* acconfig.h, configure.in, src/login/Makefile.am, src/login/ssl-
	proxy-gnutls.c, src/login/ssl-proxy-openssl.c, src/login/ssl-
	proxy.c, src/master/Makefile.am, src/master/ssl-init-gnutls.c,
	src/master/ssl-init-openssl.c, src/master/ssl-init.c, src/master
	/ssl-init.h:
	Support for OpenSSL.
	[235188ee7a05]

	* src/imap/main.c:
	No space before "* PREAUTH" ..
	[5690ce7151c9]

2002-11-19  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c:
	Send PREAUTH if we were started without LOGIN_TAG environment (ie.
	not through master process).
	[d34ee528aa68]

2002-11-17  Timo Sirainen  <tss@iki.fi>

	* src/auth/userinfo-passwd-file.c:
	re-read passwd file when it changes.
	[fcdff89c3df2]

	* src/master/Makefile.am, src/master/ssl-init.c, src/master/ssl-
	init.h:
	forgot
	[a7c3ea56ba62]

	* src/lib-storage/index/index-fetch-section.c:
	Fix when fetching body[sections] with message/rfc822 parts.
	[c6b5e8af85e7]

	* TODO:
	updated
	[c7a01d999962]

	* dovecot-example.conf, src/login/ssl-proxy.c, src/master/Makefile.am,
	src/master/common.h, src/master/login-process.c, src/master/login-
	process.h, src/master/main.c, src/master/settings.c,
	src/master/settings.h:
	Master process generates DH/RSA parameters now and stores them into
	file which login processes read. Added setting for regeneration
	interval. Some other SSL cleanups.

	Also fixed default login process path to be ../run/dovecot/login/
	like example config file said, instead of just ../run/dovecot/ which
	it actually was until now.
	[0d852af6842e]

2002-11-16  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/master/login-process.c,
	src/master/settings.c, src/master/settings.h:
	login_process_per_connection = yes scales now better when multiple
	users are trying to log in at the same time.
	[e60620644af3]

	* dovecot-example.conf, src/login/client.c, src/login/client.h,
	src/login/common.h, src/login/main.c, src/login/master.c,
	src/login/master.h, src/login/ssl-proxy.c, src/master/login-
	process.c, src/master/settings.c, src/master/settings.h:
	Finally support for handling each login connection in it's own
	process. Enabled by default. Also a few bugfixes to master process.
	[1906116a62ce]

	* src/lib/fdpass.c, src/lib/fdpass.h:
	Some fixes, cleanups and possibility to send/receive data without
	actually passing the fds (ie. just a sendmsg/recvmsg wrapper).
	[7c91f579ebed]

2002-11-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-charset/charset-iconv.c:
	Removed warnings with Solaris' iconv()
	[9373933b1be1]

2002-11-14  Timo Sirainen  <tss@iki.fi>

	* src/master/main.c:
	Call setsid() when daemonizing.
	[bc766660efc4]

2002-11-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-charset/Makefile.am, src/lib-charset/charset-ascii.c, src
	/lib-charset/charset-iconv.c, src/lib-charset/charset-utf8.c:
	We can support UTF-8 charset too without any translations.
	[5470c0cb13a7]

	* src/lib-charset/charset-ascii.c, src/lib-charset/charset-iconv.c,
	src/lib-charset/charset-utf8.h, src/lib-mail/Makefile.am, src/lib-
	mail/message-body-search.c, src/lib-mail/message-body-search.h, src
	/lib-mail/message-header-search.c, src/lib-mail/message-header-
	search.h, src/lib-mail/quoted-printable.c, src/lib-mail/quoted-
	printable.h, src/lib-storage/index/index-search.c, src/lib/base64.c,
	src/lib/base64.h, src/login/client-authenticate.c:
	SEARCH CHARSET now works properly with message bodies, and in
	general body searching works more correctly by decoding base64/qp
	data. Non-text MIME parts are currently not included in search, that
	could be made optional. Also the body is parsed separately for each
	keyword, that could be optimized.

	Changed base64_decode() behaviour so that it can accept non-base64
	data as well, ie. line feeds etc.
	[debb8468514e]

	* src/lib-index/mail-index.c:
	mail_index_lock_full() doesn't need to be global
	[c857ebe48596]

	* src/lib-index/mail-index-update.c, src/lib/mmap-anon.c:
	Fix ~ usage - I'm not sure if it was wrong before (it did work), but
	at least now I know it's correct. :)
	[f7fe4055d1ae]

	* TODO:
	update
	[e5ff7ddeb895]

	* src/lib-index/mbox/mbox-rewrite.c, src/lib-storage/index/maildir
	/maildir-save.c, src/lib-storage/index/mbox/mbox-expunge.c, src/lib-
	storage/index/mbox/mbox-save.c:
	Use blocking output buffers when writing to files.
	[b69e50478671]

	* src/lib/obuffer-file.c:
	o_buffer_send() should have tried to send data immediately if the
	buffer was in non-blocking state.
	[abb584aabe31]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.c:
	If mbox opening fails, don't leave the lock files lying around.
	[03ea377ed93b]

	* src/lib-storage/index/index-fetch.c:
	FETCH RFC822 and RFC822.TEXT also needs to set \Seen flag for
	message
	[bfa9ab91eba7]

2002-11-12  Timo Sirainen  <tss@iki.fi>

	* dovecot-example.conf, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/index-mailbox-check.c, src/lib-storage/index/index-
	storage.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-storage.c, src/master
	/imap-process.c, src/master/settings.c, src/master/settings.h:
	mailbox_check_interval setting: Dovecot can notify client of new
	mail in selected mailbox soon after it's received. This setting
	specifies the minimum interval in seconds between new mail
	notifications to client - internally they may be checked more or
	less often. Setting this to 0 disables the checking.
	[3b44bc64afd4]

	* src/lib-index/mbox/mbox-sync.c:
	If mbox file is deleted for selected folder, recreate it again so we
	can handle locking issues properly. For example mutt deletes the
	mbox when all mails are expunged.
	[a7691dc0a869]

2002-11-07  Timo Sirainen  <tss@iki.fi>

	* src/imap/rawlog.c:
	Print timestamp marks into rawlog.
	[26691b7d6203]

2002-11-06  Timo Sirainen  <tss@iki.fi>

	* src/imap/main.c:
	Drop root privileges before handling rawlog opening.
	[99c7e303c92a]

	* dovecot-example.conf, src/imap/main.c, src/login/client-
	authenticate.c, src/login/master.c, src/login/master.h,
	src/master/common.h, src/master/imap-process.c, src/master/login-
	process.c, src/master/master-interface.h, src/master/settings.c,
	src/master/settings.h:
	Added verbose_proctitle setting: Show more verbose process titles
	(in ps). Currently shows user name and IP address. Useful for seeing
	who are actually using the IMAP processes (eg. shared mailboxes or
	if same uid is used for multiple accounts).
	[ab3590c3a7d9]

	* src/imap/rawlog.c:
	A bit kludgy bugfix to prevent rawlog from hanging.
	[320f59a5a36c]

	* src/lib-index/maildir/maildir-sync.c:
	Maildir syncing code wasn't updated.
	[7a53aa3bd95d]

	* src/lib-imap/imap-bodystructure.c:
	another buggy check
	[3bd84cc9dbf6]

	* src/lib-imap/imap-bodystructure.c:
	buggy check
	[36090ea10e08]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-envelope.c:
	A few extra checks to prevent memory eating by sending mails with
	multiple header fields with same name.
	[6c8e172ff068]

	* src/lib-index/mail-index-compress.c, src/lib-index/mail-tree.c:
	Don't try to truncate in-memory indexes.
	[e3162b4267ec]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-modifylog.c, src
	/lib-index/mail-tree.c:
	Fixes to make in-memory indexes working again.
	[d1e0cbffe1e1]

	* src/login/client-authenticate.c, src/login/client.c:
	Whops, AUTHENTICATE data still wasn't cleared right.
	[d7eb0bfd3eb5]

	* src/login/client.c:
	More password clearing.
	[6b0125b34bb1]

	* src/auth/auth-plain.c, src/auth/login-connection.c:
	Plaintext passwords weren't cleared from memory after use.
	[50bb42557703]

	* src/lib/ibuffer.c, src/lib/ibuffer.h:
	i_buffer_get_modifyable_data(): Like i_buffer_get_data(), but
	returns non-const data. If modifying isn't allowed to buffer,
	returns NULL.
	[3696d2bd829e]

2002-11-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-index.c:
	Fixes for parsing mbox messages when ending \n in header actually
	belongs to next From-line (eg. "\n\nFrom").
	[291ff43ccf82]

	* src/lib-index/mail-index.c:
	Fixed wrong printf-type.
	[50959a72b966]

2002-11-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-data.c, src/lib-index/mail-index.c:
	Fixes for anon-mmaped indexes.
	[2d76b723dac4]

	* src/lib-index/mail-index.c:
	Setting index file's timestamp was done too early - there was
	msync() immediately after it to reset the timestamp again.
	[c97be611a109]

	* src/lib-index/mbox/mbox-sync.c:
	We did a full sync too often.
	[a0eb55ddb5f0]

	* src/lib-charset/charset-ascii.c, src/lib-charset/charset-iconv.c,
	src/lib-imap/imap-date.c, src/lib-imap/imap-quote.c, src/lib-index
	/mail-custom-flags.c, src/lib-index/mail-index-data.c, src/lib-index
	/mail-index-update.c, src/lib-index/mail-modifylog.c, src/lib-mail
	/message-parser.c, src/lib-storage/index/mbox/mbox-expunge.c,
	src/lib/ibuffer-mmap.c, src/lib/ibuffer.c, src/lib/macros.h,
	src/lib/md5.c, src/lib/obuffer-file.c, src/lib/write-full.c:
	Several minor fixes: signess, casting away const, missing static,
	etc.
	[e524da896d92]

	* src/lib/obuffer.c:
	o_buffer_seek() returns int, not ssize_t
	[4305e0c739cf]

	* src/lib-index/mail-index.h, src/lib-index/mbox/mbox-lock.c:
	mbox_unlock() actually set exclusive lock
	[056f4d135e4c]

	* configure.in:
	Print the size of off_t at end.
	[fa29eb5865e7]

	* src/master/main.c:
	Never open imaps port if we're building with SSL disabled.
	[ba6f89be8237]

	* src/lib/failures.c, src/lib/strfuncs.c, src/lib/strfuncs.h:
	Added printf_string_fix_format() which currently just replaces %m
	with strerror(errno). i_panic, i_fatal, i_error and i_warning didn't
	expand the %m before when not writing to syslog.
	[703bbeceb248]

	* src/lib-charset/charset-ascii.c:
	compiler warning fix
	[c96607edbcb0]

	* src/lib/compat.h:
	EOVERFLOW doesn't exist everywhere, fallback it to EINVAL.
	[3c6a0cb061c6]

	* src/auth/userinfo-pam.c, src/auth/userinfo-passwd-file.c, src/auth
	/userinfo-passwd.c, src/auth/userinfo-passwd.h, src/auth/userinfo-
	shadow.c, src/auth/userinfo-vpopmail.c:
	Fixed warnings when compiling with Solaris 8
	[944dbdc61f3d]

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h, src/lib-index/mbox/mbox-rewrite.c, src/lib-
	index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c, src
	/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	expunge.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-status.c, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/index-sync.c, src/lib-storage/index/index-
	update-flags.c, src/lib-storage/index/maildir/maildir-copy.c:
	And more locking/syncing fixes. Now it's finally beginning to look
	sane again.
	[2626acd3c6f4]

2002-11-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	SEARCH TEXT now checks only field values (not names) from headers.
	RFC doesn't really specify how this should be handled and I think
	it's better this way. Also it's easier to handle correctly :)
	[cafe57140f5c]

	* configure.in, src/Makefile.am, src/imap/Makefile.am, src/imap/cmd-
	search.c, src/lib-charset/.cvsignore, src/lib-charset/Makefile.am,
	src/lib-charset/charset-ascii.c, src/lib-charset/charset-iconv.c,
	src/lib-charset/charset-utf8.h, src/lib-imap/imap-message-cache.c,
	src/lib-mail/Makefile.am, src/lib-mail/message-header-search.c, src
	/lib-mail/message-header-search.h, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-storage.h, src/lib-storage
	/mail-search.c, src/lib-storage/mail-search.h, src/lib-storage/mail-
	storage.h:
	SEARCH CHARSET support. Currently we do it through iconv() and only
	ASCII characters are compared case-insensitively.
	[f2aa58c2afd0]

	* src/lib-index/mail-index-update.c:
	updating fields in index data file was buggy
	[a59f68334ad6]

	* src/lib/base64.h:
	forgot
	[a75b7a269674]

	* src/lib/base64.c, src/login/client-authenticate.c:
	size parameter to base64_decode()..
	[41c43eb65c18]

	* src/lib/base64.c, src/lib/base64.h, src/login/client-authenticate.c:
	Changed base64_decode() to separate src/dest buffers.
	[24f2776422c0]

	* src/auth/userinfo-pam.c:
	PAM was implemented pretty wrong, should have read the manual.
	[796c12593140]

	* src/lib-storage/index/mbox/mbox-save.c:
	APPEND fixed for mbox
	[ca988d72265b]

	* src/lib-index/mbox/mbox-sync.c:
	more lock fixes
	[a48ef667e709]

	* src/lib-index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-
	rewrite.c, src/lib-index/mbox/mbox-sync.c:
	mbox locking fixes
	[08d5e82b9068]

2002-11-02  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-close.c, src/lib-index/mail-index-open.c, src/lib-index
	/mail-index-update-cache.c, src/lib-index/mail-index.c, src/lib-
	index/mail-index.h, src/lib-index/mail-tree.c, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-sync.c, src/lib-
	index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-
	index/mbox/mbox-lock.c, src/lib-index/mbox/mbox-rewrite.c, src/lib-
	index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c, src
	/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	expunge.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-status.c,
	src/lib-storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-sync.c, src/lib-storage/index
	/index-update-flags.c, src/lib-storage/index/maildir/maildir-copy.c,
	src/lib-storage/index/mbox/mbox-expunge.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/mail-storage.h:
	Mostly mbox locking/syncing fixes. Still some problems though.
	[c834e77b624c]

2002-11-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-update.c:
	update_by_replace_fields() didn't update header
	[4bf3e0cb8159]

2002-10-30  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	don't unref() the ibuffer we got from imap cache.
	[db3155105b1d]

2002-10-29  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-rewrite.c:
	mbox locking fixes
	[9d72849fe68e]

	* src/lib-index/mail-index-compress.c:
	index compression was broken.
	[31b87d270b32]

	* src/lib/obuffer-file.c:
	errno wasn't set when timeout occured.
	[85ee22e02ca7]

	* src/lib/ibuffer-file.c, src/lib/obuffer-file.c:
	If timeout wasn't set, it was assumed that it was immediate.
	[c31add7eaa57]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mbox/mbox-lock.c:
	mbox locking wasn't working.
	[33be9c9f3b3a]

	* AUTHORS, COPYING:
	updates
	[ac68ab739a4d]

	* acconfig.h, configure.in, src/imap/Makefile.am, src/imap/client.h,
	src/imap/main.c, src/imap/rawlog.c, src/imap/rawlog.h:
	--with-rawlog: Build support for logging traffic of user sessions.
	If user's home directory contains "rawlog" directory, the input and
	output traffic is written to YYYYMMDD-hhmmss-pid.in and .out files.
	This was made for debugging purposes.
	[3a83b05a0be3]

	* src/lib-index/mail-index-data.c, src/lib-index/mail-index-update.c:
	Fixed (recently) broken updating of index data file. Also we don't
	leave deleted data lying around in the file anymore but instead fill
	it with zeros.
	[65b73446b4cf]

	* src/lib/data-stack.c:
	DEBUG: when t_pop()ing, fill the free'd memory area with 0xde bytes.
	[797c5eb84267]

	* acconfig.h, configure.in, src/auth/userinfo-pam.c:
	Call pam_setcred() if it exists.
	[39a24074abf4]

2002-10-28  Timo Sirainen  <tss@iki.fi>

	* acconfig.h, configure.in, src/auth/auth.c, src/auth/userinfo-passwd-
	file.c, src/imap/cmd-append.c, src/imap/commands-util.c, src/lib-
	imap/imap-message-cache.c, src/lib-imap/imap-parser.c, src/lib-index
	/mail-index-update.c, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-update-
	flags.c, src/lib/macros.h, src/lib/temp-string.c:
	Added --enable-asserts (default) and fixed some warnings when
	building without. Added i_unreached() to indicate supposedly
	unreachable code block and changed a existing i_assert(0) calls to
	it. Removed return_if_fail() and return_val_if_fail() macros,
	they're not useful.
	[e1254b838e0b]

	* src/lib-index/maildir/maildir-build.c:
	path parameter wasn't used
	[c97f631bd26d]

	* acconfig.h, configure.in, src/lib-index/mail-index-data.c, src/lib-
	index/mail-index-util.h, src/lib-index/mail-index.c, src/lib-index
	/mail-modifylog.c, src/lib-index/mail-tree.c:
	Added --enable-debug. Currently it just forces file locks so that
	index files can't be written to when not holding exclusive lock.
	Also main index file can't be even read if we're unlocked (other
	files don't get notification of unlock, so they don't do this at
	least yet).
	[42e65c2ba49d]

	* src/lib/mmap-util.c, src/lib/mmap-util.h:
	Removed mmap_aligned() which isn't used anywhere. Added mmap_file()
	which accepts prot argument. We use now fstat() instead of lseek()
	to get file size.
	[52fd3d82e59a]

	* src/lib-index/mail-index-update.c, src/lib-index/maildir/maildir-
	build.c:
	Support W=rfc822.size flag in maildir file name.
	[14da2c45cdc7]

	* src/lib-index/mail-index-update.c:
	if virtual_size == physical_size in message, update it's binary-
	flag.
	[c8aaf80bc89f]

	* src/lib-index/mail-tree.h:
	comment update
	[9194f598bfbd]

	* src/lib-index/mail-tree-redblack.c, src/lib-index/mail-tree.h:
	node color needs only one bit, not a full 32bit integer. so moved it
	to highest bit of node_count.
	[a182d31b46cd]

	* src/lib-storage/index/index-status.c:
	Previous lowwater change broke STATUS.
	[3952bda70287]

	* TODO:
	updated
	[fe8a014a479e]

	* src/lib/data-stack.c, src/lib/data-stack.h, src/lib/ioloop-poll.c,
	src/lib/ioloop.c, src/lib/temp-string.c:
	changed t_push() and t_pop() to return unsigned int. added global
	data_stack_frame which is used by TempString to verify it's accessed
	only in the same frame.
	[37893ed97492]

	* src/lib-index/mail-index-fsck.c:
	fsck() should reset lowwater marks to end of uids, not to beginning.
	[5a193db8fe56]

	* src/lib-storage/index/index-fetch-section.c, src/lib-storage/index
	/index-msgcache.c, src/lib-storage/index/index-search.c, src/lib
	/ibuffer-data.c, src/lib/ibuffer-file.c, src/lib/ibuffer-internal.h,
	src/lib/ibuffer-mmap.c, src/lib/ibuffer.c, src/lib/ibuffer.h:
	keep i_buffer_seek() void and make it close the buffer if any errors
	happen. next read will then notice the error. easier to handle it
	that way.
	[45b43851bc9a]

	* src/lib/ibuffer-file.c, src/lib/iobuffer-internal.h, src/lib
	/obuffer-file.c:
	cleanups
	[1f1ff728ff65]

	* src/auth/login-connection.c, src/auth/master.c, src/imap/client.c,
	src/lib-index/mbox/mbox-rewrite.c, src/lib-storage/index/mbox/mbox-
	expunge.c, src/lib-storage/index/mbox/mbox-save.c,
	src/lib/Makefile.am, src/lib/alarm-hup.c, src/lib/alarm-hup.h,
	src/lib/file-lock.c, src/lib/ibuffer-data.c, src/lib/ibuffer-file.c,
	src/lib/ibuffer-mmap.c, src/lib/ibuffer.c, src/lib/ibuffer.h,
	src/lib/iobuffer-internal.h, src/lib/iobuffer.c, src/lib/lib.c,
	src/lib/obuffer-file.c, src/lib/obuffer.c, src/lib/obuffer.h,
	src/login/auth-connection.c, src/login/client-authenticate.c,
	src/login/client.c, src/master/auth-process.c, src/master/login-
	process.c:
	I/O buffers now use real blocking instead of setting up a sub-ioloop
	to poll(). alarm() is called every 30 secs to send SIGHUP and break
	out of the read/write calls, so the given timeout values aren't
	exact.

	Also some other cleanups, like not including ioloop.h in
	[io]buffer.h which broke several other files which hadn't included
	it itself..
	[3b53dd1280c6]

	* src/lib-index/mail-index-compress.c:
	bugfix
	[9aabf64c8da2]

	* configure.in:
	and fix linux-sendfile check so it fails with freebsd :)
	[e815df17e52e]

	* configure.in:
	buggy checks. we were supposed to compile them, not run. plus fixes
	for freebsd-sendfile checking so that it fails with linux.
	[3a1be480d16a]

	* acconfig.h, configure.in, src/lib/sendfile-util.c:
	Support FreeBSD-compatible sendfile(). Completely untested.
	[a95b1ccff82e]

2002-10-27  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-
	cache.h:
	Forgot in last commit.
	[17888202b002]

	* TODO:
	updated
	[ab394352fcb3]

	* src/lib-index/mail-index-compress.c, src/lib-index/mail-index-
	data.c, src/lib-index/mail-index-data.h, src/lib-index/mail-index-
	update-cache.c, src/lib-index/mail-index-update.c, src/lib-index
	/mail-index-util.c, src/lib-index/mail-index-util.h, src/lib-index
	/mail-index.c, src/lib-index/mail-index.h, src/lib-index/maildir
	/maildir-build.c, src/lib-index/maildir/maildir-index.c, src/lib-
	index/maildir/maildir-index.h, src/lib-index/maildir/maildir-open.c,
	src/lib-index/maildir/maildir-rebuild.c, src/lib-index/maildir
	/maildir-sync.c, src/lib-index/maildir/maildir-update.c, src/lib-
	index/mbox/mbox-append.c, src/lib-index/mbox/mbox-index.c, src/lib-
	index/mbox/mbox-index.h, src/lib-index/mbox/mbox-open.c, src/lib-
	index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c,
	src/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-msgcache.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-copy.c, src/lib-storage/index/maildir/maildir-expunge.c,
	src/lib-storage/index/mbox/mbox-expunge.c:
	Moved several fields from .imap.index file to .imap.index.data file.
	Fixed code so that most of the fields do not need to be set when
	building index, allowing the index building to be fast (just
	readdir()s with maildir). This still needs some configuration and
	ability to update the fields whenever it can grab exclusive lock.

	Also fixed SEARCH LARGER, SMALLER and KEYWORD.
	[2cb2e0a3423b]

	* src/lib-index/maildir/maildir-build.c, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-sync.c, src/lib-
	index/maildir/maildir-update.c:
	Don't bother going through all that trouble to send file size to
	ibuffer. One extra fstat() isn't that bad, and we'll soon get rid of
	the first one..
	[a70ca21d022c]

2002-10-26  Timo Sirainen  <tss@iki.fi>

	* src/lib/ibuffer-mmap.c:
	Print error message if madvise() fails (it never should).
	[08a7cdc53876]

	* src/lib/ibuffer.c:
	i_buffer_set_read_limit() - don't fail if we don't know the file
	size.
	[bd6362f13e7a]

	* src/lib-index/mail-index.h, src/lib-index/mbox/Makefile.am, src/lib-
	index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.c, src/lib-
	index/mbox/mbox-index.h, src/lib-index/mbox/mbox-lock.c, src/lib-
	index/mbox/mbox-lock.h, src/lib-index/mbox/mbox-open.c, src/lib-
	index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-index/mbox/mbox-sync-full.c, src/lib-index/mbox/mbox-sync.c,
	src/lib-storage/index/mbox/mbox-expunge.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h:
	mbox locking fixes / changes. we now read-lock the mbox file before
	syncing so we can be sure no-one corrupts our reads by expunging
	mailbox. mbox file is kept open all the time, but re-opened when
	device/inode for file has changed (ie. someone overwrote it). File
	is also kept mmap()ed until lock is dropped.

	we currently create .lock file even when reading the file (ie. being
	effectively write-lock), but that'll be made configurable later.
	[83da62e0675a]

	* src/lib/ibuffer-mmap.c:
	seek: we munmap()ed unneededly sometimes
	[8ca4d597938c]

	* dovecot-example.conf:
	and a couple more fixes..
	[9e121e74c188]

	* dovecot-example.conf:
	Updated SSL certificate comments.
	[1f9b96080525]

2002-10-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c:
	still not right
	[ca99b1d7ceef]

	* src/lib-mail/message-parser.c:
	Header parser was still a bit wrong.
	[fc13fbca2fff]

	* src/lib-index/mbox/mbox-index.c:
	If Content-Length header was invalid, we didn't fix it properly.
	[f0e88a0751e5]

	* src/lib-index/maildir/maildir-sync.c:
	comment update
	[7427dd68c492]

	* src/lib-mail/message-parser.c:
	Header parsing should always keep one character lookahead, so it can
	see if header continues in next line. This wasn't done properly.
	[01e94a80235d]

	* src/lib-index/mail-tree-redblack.c:
	and correct a stupid copy&paste-bug
	[41133ae3feb6]

	* src/lib-index/mail-tree-redblack.c:
	Set node variable after mmap updating which may change it..
	[10d6c1cb6511]

	* src/lib-storage/index/index-sync.c:
	Don't crash either if expunge or update_flags sync_callbacks haven't
	been set when syncing modify log
	[9d4c71bfaed9]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-from.c,
	src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.c:
	Small mbox tweaks, hopefully resulting in a bit better performance.
	[48910084a8ce]

	* src/lib-index/mail-tree.c:
	Tree file wasn't correctly re-mmap()ed when sync_id changed.
	[d97b0454692e]

	* src/imap/cmd-select.c, src/lib-storage/index/index-save.c, src/lib-
	storage/index/index-sync.c:
	Error message fixes for APPEND. Make sure we don't crash if
	sync_callbacks isn't set. Don't set sync_callbacks until SELECT is
	finished.
	[eebb12795ea7]

	* src/lib/ibuffer-file.c:
	If i_buffer_read() fails because of EOF, set buf_errno to 0.
	[0329dd6cd40e]

	* src/lib-mail/message-parser.c, src/lib-storage/index/index-search.c:
	More (char *) -> (const char *) fixes
	[78ae6262d6ca]

	* src/lib-imap/imap-parser.c:
	Buffer returns const type, don't cast it away.
	[54788b83654f]

	* src/lib-index/mbox/mbox-sync.c:
	If mbox file's timestamp isn't same as index file's, it means the
	file has changed. We didn't check this properly when opening the
	mbox file first time. Also some cleanups.
	[6c01ae6f3b1c]

	* src/lib-imap/imap-parser.c:
	imap_parser_read_args() didn't correctly always return "need for
	more data" which sometimes resulted in broken parsing of client
	commands.
	[7927650f3b9b]

	* src/lib/ibuffer-internal.h, src/lib/ibuffer.c:
	We dont' need last_cr anymore.
	[81c8140719a4]

	* src/lib/ibuffer.c:
	Don't try to handle CR-only line changes, makes overly complex code
	and it's not needed anywhere.
	[6a5333eea7d1]

2002-10-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-compress.c:
	fdatasync() before close().
	[1f2bbcaf9ac5]

	* src/lib-index/mail-tree-redblack.c:
	after _mail_tree_grow(), the node_base changes and crashes
	[dbccdcccb7fa]

	* TODO:
	updated
	[4ff240ec007a]

	* src/lib-index/mail-tree-redblack.c, src/lib-index/mail-tree.c, src
	/lib-index/mail-tree.h:
	Instead of keeping "unused nodes" list in tree file, just move the
	last node over the deleted one. This way we're also able to truncate
	the file when needed.
	[fef80ac4fb09]

	* src/lib-index/mail-index-compress.c:
	Make sure we never truncate ourself smaller than
	INDEX_FILE_MIN_SIZE.
	[e57417d8f28a]

	* acconfig.h, configure.in, src/lib/compat.h:
	Check fdatasync() from -lrt if it's not in libc (solaris). Also
	fallback to fsync() entirely if fdatasync() doesn't exist.
	[83d4617e1dca]

	* src/lib/utc-mktime.c, src/lib/utc-offset.c:
	comment cleanups
	[293aac070c2c]

	* src/imap/cmd-append.c, src/lib-imap/imap-date.c, src/lib-imap/imap-
	date.h, src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-
	from.c, src/lib-index/mbox/mbox-index.c, src/lib-mail/rfc822-date.c,
	src/lib-mail/rfc822-date.h, src/lib-storage/index/index-copy.c, src
	/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-storage.h, src/lib/Makefile.am, src/lib/gmtoff.c,
	src/lib/gmtoff.h, src/lib/ioloop.c, src/lib/ioloop.h, src/lib/utc-
	mktime.c, src/lib/utc-mktime.h, src/lib/utc-offset.c, src/lib/utc-
	offset.h:
	Fixes to timezone handling which were handling quite badly. added
	ioloop_timezone which gets updated with ioloop_time. Changed some
	GMT references to UTC. Timezone offsets are in minutes now
	everywhere instead of seconds. Fixes for unsigned time_t.
	[efa46e28a0d7]

	* src/lib-index/maildir/maildir-index.c:
	Ignore and leave maildir flags after ',' character (eg.
	file:2,S,U123).
	[a18cfbfbdad4]

2002-10-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-index-open.c,
	src/lib-index/mail-index.c, src/lib-index/mail-modifylog.c, src/lib-
	storage/subscription-file/subscription-file.c, src/lib/file-lock.c,
	src/lib/file-lock.h, src/lib/lib-signals.c:
	file_wait_lock() now takes timeout-parameter so one badly behaving
	process won't start creating tons of lock-waiting processes.
	[fd0181ae25f6]

	* src/lib-index/mail-index.c:
	minor fixes
	[9783f589969b]

	* src/lib-index/mail-index-compress.c, src/lib-index/mail-index-
	data.c, src/lib-index/mail-index-data.h, src/lib-index/mail-index-
	update.c, src/lib-index/mail-index.c, src/lib-index/mail-index.h,
	src/lib-index/mail-modifylog.c, src/lib-index/mail-modifylog.h, src
	/lib-index/mail-tree-redblack.c, src/lib-index/mail-tree.c, src/lib-
	index/mail-tree.h:
	Use fdatasync() instead of fsync() where possible. msync() all files
	first, then fsync them instead of msync+fsync+msync+fsync+.. data
	file now keeps track of when it's been changed, tree file didn't do
	mmap updates, plus other related cleanups.
	[48728d36513a]

	* src/lib-index/mail-custom-flags.h:
	comment update
	[9ad00c2c835e]

	* src/lib-index/mail-modifylog.c:
	if we're only process accessing modify log when it gets full, we can
	just truncate it instead of switching.
	[781c3aef4d68]

	* src/lib-index/mail-modifylog.c, src/lib-index/mail-modifylog.h, src
	/lib-storage/index/index-messageset.c, src/lib-storage/index/index-
	sync.c:
	Modify log was pretty much broken whenever it was switched.
	[9f0263a945ba]

	* src/lib-index/mbox/mbox-rewrite.c:
	input buffer limit wasn't reset in error conditions.
	[006202bcab99]

	* src/lib/strfuncs.c:
	Assert i_snprintf() string lengths to INT_MAX instead of SSIZE_T_MAX
	since
	*printf()s returns int, not ssize_t..
	[990dae663bc3]

	* src/lib/compat.c, src/lib/strfuncs.c:
	Check vsnprintf() return values more carefully, thanks to Thomas
	Wouters <thomas@xs4all.net> for noticing.
	[d2303c38a7cf]

	* TODO:
	useless test commit
	[40b7d6ca51e3]

	* TODO:
	updated
	[24a649e9c6d1]

2002-10-22  Timo Sirainen  <tss@iki.fi>

	* src/lib/obuffer-file.c:
	Still more bugfixes to o_buffer_send_ibuffer() without sendfile.
	[c64ef7b87247]

	* src/lib/obuffer-file.c:
	OBuffer was closed if sendfile() wasn't supported.
	[0363ba999da5]

	* src/lib/obuffer-file.c:
	o_buffer_send_ibuffer() didn't correctly update inbuf->v_offset when
	not using sendfile().
	[6617a4d1c424]

2002-10-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/subscription-file/subscription-file.c:
	cleanups, also file_wait_lock() return value wasn't checked
	correctly
	[c519f9f6ae65]

	* src/lib-index/mail-modifylog.c:
	Try to truncate modify log when switching.
	[584aae46e2ca]

	* TODO:
	updated
	[47d0c169bdba]

	* src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/maildir
	/maildir-storage.h:
	Hardlink COPYing still copied the file name instead of generating a
	new one, which really broke things when mail was duplicated in the
	same mailbox.
	[cb7f34709d2d]

	* doc/configuration.txt, dovecot-example.conf, src/lib-index/maildir
	/maildir-sync.c, src/lib-index/mbox/mbox-index.c, src/lib-
	storage/index/index-save.c, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/maildir/maildir-copy.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/mbox
	/mbox-save.c, src/master/imap-process.c, src/master/settings.c,
	src/master/settings.h:
	Added setting mail_save_crlf. Few other settings cleanups.
	[2fa0bfb65268]

	* src/lib/obuffer-file.c:
	Always flush buffer before closing it.
	[3448c77bb3d2]

	* src/lib/obuffer-file.c:
	writev() return value wasn't checked properly. EAGAIN and EINTR
	shouldn't be treated as fatal errors.
	[e85c1e9ff3d8]

2002-10-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-parser.c:
	List parsing was broken.
	[950b1c519e24]

	* src/master/main.c:
	typofix
	[24722a6b9ed2]

	* src/lib/fdpass.c:
	include sys/socket.h, not network.h. Required with solaris+ipv6
	where _XPG4_2 must be defined to get the cmsg-stuff to work but
	which also breaks ipv6.
	[fd24b81a7f04]

	* src/lib/strfuncs.c:
	Fail if %ll is used and we don't have long long.
	[c58fc0fd7894]

	* src/imap/mailbox-sync.c:
	Whops, this was missing from previous sync changes.
	[eeffd33b6b65]

	* configure.in, src/lib/failures.c, src/lib/strfuncs.c:
	Removed several useless handers of printf_string_upper_bound(), and
	added a few configure checks it required. That function could use a
	better audit.. Also stdlib.h was missing from failures.c for some
	reason..
	[c634b705f24b]

	* src/lib/ibuffer-data.c, src/lib/ibuffer-file.c, src/lib/ibuffer-
	internal.h, src/lib/ibuffer-mmap.c, src/lib/ibuffer.c,
	src/lib/ibuffer.h:
	i_buffer_skip() can't fail anymore, next read determines if it
	failed.
	[7434bac55c08]

	* dovecot-example.conf, src/lib-index/mail-index-open.c, src/lib-index
	/mail-index.c, src/lib-index/mail-index.h, src/lib-index/maildir
	/maildir-rebuild.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-
	storage/index/index-storage.c, src/master/imap-process.c,
	src/master/settings.c, src/master/settings.h:
	Added mail_cache_fields and mail_never_cache_fields settings, plus
	settings cleanup.
	[67d22b7b0918]

	* src/lib-index/mail-index-util.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h, src/lib-storage/index/index-msgcache.c, src
	/lib-storage/index/index-search.c:
	cache_fields_later() doesn't need MailIndexRecord parameter.
	[00d857873975]

	* src/lib-index/maildir/maildir-build.c, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-sync.c, src/lib-
	index/maildir/maildir-update.c:
	Don't call mail_index_update_header() if we don't want to cache
	anything.
	[985e9f790da5]

	* src/lib-index/mail-tree.c:
	Instead of growing tree file always 64 nodes larger, make it n%
	larger just like the index file. Huge performance gain with large
	mailboxes.
	[960075bacba6]

	* src/lib-index/mail-index-update.c, src/lib-index/mail-index-util.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-index.c, src/lib-index/mbox/mbox-index.c, src
	/lib-storage/index/index-msgcache.c, src/lib-storage/index/index-
	search.c:
	Added cache_fields_later() to MailIndex interface. That can be used
	to specify when some field is wanted to be cached, instead of doing
	it at every lookup_field*() call.
	[06377dd1e2a9]

	* src/lib-storage/index/index-storage.c:
	Indexes were never closed because refcount wasn't updated.
	[31cc41537495]

	* src/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-
	cache.h, src/lib-index/mail-index-update-cache.c, src/lib-index
	/mail-index-util.c, src/lib-index/mail-index-util.h, src/lib-index
	/mail-index.h, src/lib-index/maildir/maildir-index.h, src/lib-
	index/maildir/maildir-open.c, src/lib-index/mbox/mbox-index.h, src
	/lib-index/mbox/mbox-open.c, src/lib-storage/index/index-copy.c, src
	/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	fetch.h, src/lib-storage/index/index-msgcache.c, src/lib-
	storage/index/index-search.c:
	If maildir files are unexpectedly deleted, don't treat it as error,
	and don't return partially fetched data. Instead try to handle it
	just as if sync() had noticed it earlier.
	[f557fb280fb4]

	* src/lib-storage/index/index-expunge.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.h, src/lib-
	storage/index/index-sync.c:
	When doing EXPUNGE, if there's been external flag changes in
	messages we're going to delete, don't show the changes.
	[d5e5aef2d2c7]

	* src/lib-index/mail-modifylog.c, src/lib-storage/index/index-sync.c:
	Fixes for expunge handling
	[7b140cb09a2e]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/mail-modifylog.c, src/lib-index/mail-modifylog.h, src/lib-
	index/mail-tree-redblack.c, src/lib-storage/index/index-expunge.c,
	src/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	messageset.c, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-status.c, src/lib-storage/index/index-storage.h,
	src/lib-storage/index/index-sync.c, src/lib-storage/index/index-
	update-flags.c, src/lib-storage/index/maildir/maildir-expunge.c, src
	/lib-storage/index/mbox/mbox-expunge.c, src/lib-storage/mail-
	storage.h:
	Modify log now stores the changes in ranges, so store 1:100 doesn't
	generate 100 entries but just one. For single message changes this
	takes 8 bytes unneededly though, that could be fixed but for extra
	complexity so I don't think it's worth it.

	Also a change in sync-interface, expunge event no longer gets UID.
	It's not currently needed and I don't see any rfcs/drafts wanting it
	either. It's removed mostly because the log ranges makes it
	impossible to get it.
	[0f6fd6802265]

2002-10-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-custom-
	flags.h, src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-
	rewrite.c, src/lib-storage/index/index-copy.c, src/lib-storage/index
	/index-fetch.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-sync.c, src/lib-storage/index/index-update-
	flags.c, src/lib-storage/index/maildir/maildir-copy.c:
	mail_custom_flags_list_unref() isn't needed, the list returned by
	..list_get() can't be free'd even while the flags inside it may
	change. But only unused flags may change and only while calling
	..fix_list(), so it's no problem. Makes COPYing mails to selected
	mailbox work.
	[b5d9ce840177]

	* src/lib/strfuncs.c:
	printf_string_upper_bound(): Instead of just warning we can't handle
	something, panic. Much better idea than guessing something.
	[af7b05f88dae]

	* src/imap/Makefile.am, src/imap/client.h, src/imap/cmd-append.c,
	src/imap/cmd-capability.c, src/imap/cmd-check.c, src/imap/cmd-
	close.c, src/imap/cmd-copy.c, src/imap/cmd-expunge.c, src/imap/cmd-
	fetch.c, src/imap/cmd-noop.c, src/imap/cmd-search.c, src/imap/cmd-
	select.c, src/imap/cmd-store.c, src/imap/commands-util.c, src/imap
	/commands-util.h, src/lib-imap/imap-util.c, src/lib-imap/imap-
	util.h, src/lib-index/mail-custom-flags.c, src/lib-index/mail-
	custom-flags.h, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h, src/lib-index/mail-modifylog.c, src/lib-storage/index
	/index-expunge.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-fetch.h, src/lib-storage/index/index-
	messageset.c, src/lib-storage/index/index-search.c, src/lib-
	storage/index/index-status.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/index-
	sync.c, src/lib-storage/index/index-update-flags.c, src/lib-
	storage/index/maildir/maildir-expunge.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-storage/index/mbox
	/mbox-expunge.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/index/mbox/mbox-storage.h, src/lib-storage/mail-storage.h:
	MailStorage interface change. We now let storage call several sync-
	functions whenever it wants instead of forcing it through sync()
	function.

	This now allows us to send client FLAGS and PERMANENTFLAGS messages
	whenever new custom flags are added. Also EXPUNGE command now goes
	nicely through expunge() function (which CLOSE used) instead of
	through flag in sync(). "Out of disk space" alert is also sent now
	whenever it happens, before it was sent only when opening mailbox.

	Message set parser now complains when referencing mail sequences
	outside the possible range. Modify log before sent flags/expunges
	changes to client even if it didn't know about those messages yet.
	Also some other smaller cleanups.

	Beginnings of fixing APPEND and COPY when trying to store mails into
	selected mailbox. Before this didn't work too well or simply broke
	things. Still broken, needs a bit more changes..
	[925d6eb5f8be]

2002-10-18  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-parser.c:
	IMAP_ARG_EOL doesn't belong to number of arguments in list.
	[98588f02693b]

2002-10-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-data.c:
	If data file was compressed, other processes didn't reopen it
	properly. Also added a few more sanity checks.
	[ce21406ba256]

	* src/lib-index/mail-index-update.c:
	when record data had to be moved to end of .data file, the old space
	was discarded but wasn't marked into header's deleted_space.
	[2423f01aedd2]

	* src/lib-index/mail-modifylog.c:
	Switching modify log was broken
	[7dfdd149e6a6]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-
	bodystructure.h, src/lib-imap/imap-message-cache.c, src/lib-index
	/mail-index-data.c, src/lib-index/mail-index-data.h, src/lib-index
	/mail-index-update.c, src/lib-index/mail-index.h:
	If BODYSTRUCTURE is cached, we can use it to generate BODY reply. It
	takes some CPU, but probably still faster than needing to open the
	file.

	Also removed requirement of FIELD_TYPE_LOCATION to exist in .data
	file. This will be useful when we don't need the location (eg.
	filename == uid).
	[8179ef2a2c62]

	* src/imap/cmd-append.c, src/imap/cmd-fetch.c, src/imap/cmd-search.c,
	src/imap/cmd-status.c, src/imap/cmd-store.c, src/imap/commands-
	util.c, src/imap/commands-util.h, src/lib-imap/imap-envelope.c, src
	/lib-imap/imap-parser.c, src/lib-imap/imap-parser.h, src/lib-
	storage/index/index-fetch.c, src/lib-storage/mail-search.c, src/lib-
	storage/mail-search.h:
	ImapArgList changed from linked list to array. easier to handle that
	way.
	[85ab93a7693b]

2002-10-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-open.c, src/lib-index/mail-index.h:
	Delete unused temp files.
	[e730a1dcaaff]

	* src/lib-storage/index/index-search.c:
	SEARCH SEEN, UNSEEN, DELETED, UNDELETED, RECENT, UNRECENT
	optimizations. We can limit the fetched messages by checking
	lowwater marks in header. We can also immediately abort searching if
	header says there's no messages with such flags.
	[2a25bf21557b]

	* src/lib-storage/index/index-search.c:
	SEARCH SMALLER/LARGER - we may be able to handle the request using
	only physical sizes, avoids calculating the virtual size in those
	cases
	[4d77a27f7cd1]

	* src/lib-index/mail-index-data.c:
	Verify memory alignment when accessing index data file.
	[c54c1ca69362]

	* INSTALL, configure.in:
	Added --with-mem-align=BYTES option
	[b66ccecbc8a6]

	* src/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	fetch.h:
	FETCH BODY[] sets \Seen flag to messages now while fetching it, not
	only after a successful fetch. This means that index is locked while
	doing this, and we also send FLAGS reply to client for messages
	where it was changed.
	[8fd9842b64d9]

	* src/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-
	cache.h, src/lib-mail/message-send.c, src/lib-mail/message-send.h,
	src/lib-storage/index/index-fetch-section.c:
	Fixed several problems with FETCH BODY[..]<limits>, especially
	related to handling missing CRs.
	[20d5136a0c6a]

	* src/master/settings.c:
	more checks / fixes / cleanups
	[8a252e6567d7]

	* doc/configuration.txt, dovecot-example.conf:
	doc updates
	[06576f1d9e69]

	* src/master/settings.c:
	Set default SSL cert paths
	[e58a36e61d33]

	* src/login/client.c:
	doing LOGOUT now prints "Aborted login" to logfile instead of
	"Logged out"
	[a607e0ba2a66]

2002-10-15  Timo Sirainen  <tss@iki.fi>

	* src/auth/cookie.c, src/auth/main.c:
	Initialize random generator before chrooting so it can open
	/dev/urandom
	[250a30e3cf70]

	* doc/configuration.txt:
	updated
	[5392919ed5dd]

	* doc/design.txt, doc/mail-storages.txt:
	updates
	[b3073f5b1e37]

	* .cvsignore, INSTALL, README, doc/auth.txt, doc/configuration.txt,
	doc/mail-storages.txt:
	Documentation updates.
	[58899a413569]

	* INSTALL:
	Added installation document
	[4c7d08ae3f6e]

	* src/login/ssl-proxy.c:
	removed gnutls-kludge, we require gnutls 0.5.5 or later now.
	[314bcc861a67]

	* configure.in:
	help update
	[951cb252e577]

2002-10-14  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-envelope.c:
	imap_envelope_parse() wasn't working
	[a63ec8754d2e]

	* src/lib-imap/imap-parser.c:
	use p_realloc() instead of p_realloc_min().
	[9824d5df1843]

	* src/lib/ibuffer-data.c:
	wasn't working
	[08b99ae95f30]

	* src/lib/mempool-alloconly.c:
	p_realloc() was buggy
	[5138499f90ad]

	* src/lib/obuffer-file.c:
	Use the largest output buffer size when growing corked buffer.
	[37c5e6ef22f4]

	* src/lib-mail/message-send.c:
	check return value of o_buffer_send() correctly
	[0de1093e8054]

	* src/lib/ibuffer-mmap.c:
	bugfix to seek()
	[64b8dc2f0c34]

	* src/lib/obuffer-file.c:
	iovec.iov_len may be signed, fix the warning
	[68bffc14763c]

	* src/lib/obuffer-file.c:
	o_buffer_send_ibuffer() - handle properly writing 0 bytes
	[829e85f92aa6]

	* src/lib-index/mbox/mbox-open.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-storage/index/mbox/mbox-expunge.c, src/lib/obuffer-file.c,
	src/lib/obuffer.h:
	Bugfixes to mbox and OBuffer handling.
	[cca1c7004a6f]

	* src/lib/ibuffer-mmap.c:
	bugfix
	[bd30c10f2864]

	* src/lib/ibuffer-mmap.c, src/lib/ibuffer.c:
	bugfixes
	[c9293b1f721b]

	* src/lib/obuffer.c:
	ignore 0 byte long sends.
	[0957ac190eaf]

	* configure.in:
	bugfix
	[79280b4912ff]

	* acconfig.h, configure.in:
	checks for writev()
	[c2fdc076ae7f]

	* src/auth/login-connection.c, src/auth/master.c, src/auth/userinfo-
	passwd-file.c, src/imap/client.c, src/imap/client.h, src/imap/cmd-
	append.c, src/imap/main.c, src/lib-imap/imap-bodystructure.c, src
	/lib-imap/imap-bodystructure.h, src/lib-imap/imap-envelope.c, src
	/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-cache.h,
	src/lib-imap/imap-parser.c, src/lib-imap/imap-parser.h, src/lib-
	index/mail-index-update-cache.c, src/lib-index/mail-index-update.c,
	src/lib-index/mail-index-util.c, src/lib-index/mail-index.h, src
	/lib-index/maildir/maildir-index.h, src/lib-index/maildir/maildir-
	open.c, src/lib-index/maildir/maildir-update.c, src/lib-index/mbox
	/mbox-append.c, src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox
	/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-index/mbox
	/mbox-open.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-index/mbox
	/mbox-rewrite.c, src/lib-index/mbox/mbox-sync.c, src/lib-mail
	/message-parser.c, src/lib-mail/message-parser.h, src/lib-mail
	/message-send.c, src/lib-mail/message-send.h, src/lib-mail/message-
	size.c, src/lib-mail/message-size.h, src/lib-storage/index/index-
	copy.c, src/lib-storage/index/index-fetch-section.c, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-fetch.h,
	src/lib-storage/index/index-msgcache.c, src/lib-storage/index/index-
	save.c, src/lib-storage/index/index-search.c, src/lib-storage/index
	/index-storage.h, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-expunge.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-storage
	/mail-storage.h, src/lib/Makefile.am, src/lib/compat.c,
	src/lib/compat.h, src/lib/data-stack.c, src/lib/ibuffer-data.c,
	src/lib/ibuffer-file.c, src/lib/ibuffer-internal.h, src/lib/ibuffer-
	mmap.c, src/lib/ibuffer.c, src/lib/ibuffer.h, src/lib/iobuffer-
	internal.h, src/lib/iobuffer.c, src/lib/iobuffer.h, src/lib/lib.h,
	src/lib/network.c, src/lib/network.h, src/lib/obuffer-file.c,
	src/lib/obuffer-internal.h, src/lib/obuffer.c, src/lib/obuffer.h,
	src/login/auth-connection.c, src/login/client-authenticate.c,
	src/login/client.c, src/login/client.h, src/master/auth-process.c,
	src/master/login-process.c, src/master/settings.c:
	Split IOBuffer into mmaped IBuffer, file IBuffer, memory data
	IBuffer and file OBuffer.
	[1f0e7229ee58]

2002-10-13  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-alloconly.c:
	Check return values for malloc()s and calloc()s.
	[849f3846212a]

2002-10-12  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-envelope.c, src/lib-imap/imap-envelope.h, src/lib-
	imap/imap-parser.c, src/lib-index/mail-index-update.c, src/lib-index
	/mail-index.h, src/lib-mail/rfc822-date.c, src/lib-
	mail/rfc822-date.h, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-search.c, src/lib-storage/mail-search.c, src
	/lib-storage/mail-search.h:
	Dropped sent_time and alignment from MailIndexRecord. SEARCH can now
	use cached ENVELOPE data to search FROM, TO, CC, BCC, SUBJECT,
	HEADER MESSAGE-ID and HEADER IN-REPLY-TO. They're never cached
	anymore now. Also SEARCH SENT* had to be changed to use ENVELOPE (or
	fallback to Date-header parsing) because sent_time was removed.
	[e057845d94ca]

2002-10-11  Timo Sirainen  <tss@iki.fi>

	* src/login/ssl-proxy.c:
	Print alerts to log.
	[6edfb92319cf]

2002-10-10  Timo Sirainen  <tss@iki.fi>

	* src/login/client.c, src/login/ssl-proxy.c:
	STARTTLS was broken
	[d12fa0b21a59]

	* src/lib/mmap-anon.c:
	bugfix/cleanup
	[576967cbd064]

	* src/lib-index/maildir/maildir-build.c, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-open.c, src/lib-
	index/maildir/maildir-sync.c, src/lib-index/maildir/maildir-
	update.c, src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-
	rewrite.c, src/lib-storage/index/mbox/mbox-expunge.c,
	src/lib/iobuffer.c, src/lib/iobuffer.h, src/lib/ioloop.c, src/lib
	/mempool-datastack.c, src/lib/network.c:
	Created datastack_mempool which is used by at least a few temporary
	IOBuffers. Some other minor speedups/cleanups in IOBuffer and
	elsewhere..
	[f25e575bf1ca]

	* src/lib/Makefile.am:
	missing mempool-datastack.c
	[c3c7f9345f83]

2002-10-09  Timo Sirainen  <tss@iki.fi>

	* src/lib/data-stack.c, src/lib/data-stack.h, src/lib/mempool.h,
	src/lib/temp-string.c:
	s/t_try_grow/t_try_realloc/
	[e90b95f6d962]

	* src/lib/data-stack.h:
	typofix
	[ec0b16ee7ef9]

	* src/auth/auth.c, src/lib-mail/message-content-parser.h, src/lib-mail
	/message-parser.h, src/lib-mail/message-part-serialize.h, src/lib-
	mail/rfc822-tokenize.h, src/lib-storage/index/index-fetch-section.c,
	src/lib-storage/mail-storage.h, src/lib/base64.h, src/lib/hex-
	binary.h, src/lib/temp-string.h:
	changed all "temporary memory pool" references to "data stack"
	[f3ab97771ed8]

	* src/lib/Makefile.am, src/lib/data-stack.c, src/lib/data-stack.h,
	src/lib/lib.c, src/lib/lib.h, src/lib/temp-mempool.c, src/lib/temp-
	mempool.h:
	s/temporary memory pool/data stack/ which is the correct name for
	it.
	[383503837741]

	* src/lib-imap/imap-bodystructure.c:
	Parse Content-Language correctly for BODYSTRUCTURE.
	[e807d88e653c]

	* src/lib-mail/rfc822-tokenize.h:
	IS_TOKEN_STRING() wasn't working
	[9dfdd3f999bd]

	* src/lib-index/mbox/mbox-index.c:
	mbox_skip_forward() didn't correctly check for LF+CR+LF header
	ending.
	[d545f7835578]

	* src/lib-storage/index/index-fetch-section.c:
	FETCH BODY[HEADER.FIELDS*] is handled now better for huge headers.
	For headers larger than 32kB we now scan the header data twice
	instead of saving anything to memory.
	[8d3bfd8bc032]

	* src/lib/temp-mempool.c:
	t_try_grow() works now for "last allocated memory in current stack
	frame", instead of just for last allocated memory. ie. x =
	t_malloc(), t_push() ... t_pop(), t_try_grow(x) works.
	[24d69bc634d8]

	* src/lib-index/mail-index.c, src/lib-index/mail-tree-redblack.c:
	whops, update tree and modifylog with correct uid instead of 0.
	added extra assertions.
	[f09e67287f7d]

	* src/lib-index/mail-index-fsck.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h:
	Fixes for first_hole_* updating. Removed last_lookup, it doesn't
	speed up much anymore and it's just annoyance to keep valid.
	[2f3d3ba129e1]

	* src/lib-index/mail-tree.c:
	mail_tree_rebuild() wasn't updated for new indexing code
	[55f04b297f87]

	* src/lib-index/mail-index.c:
	expunge fixes
	[0039b676a423]

	* src/auth/main.c, src/imap/main.c, src/lib-index/mail-index-
	compress.c, src/lib-index/mail-index-fsck.c, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h, src/lib-index/mail-tree-
	redblack.c, src/lib-index/mail-tree.h, src/lib-index/maildir
	/maildir-open.c, src/lib-index/maildir/maildir-update.c, src/lib-
	index/mbox/mbox-index.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib/iobuffer.c, src/lib/iobuffer.h, src/lib/ioloop.c,
	src/lib/ioloop.h, src/master/main.c:
	ioloop_create() takes now pool-parameter. io_buffer_create_mmaped()
	takes start_offset parameter instead of getting it with lseek().
	Instead of using offsets to index file, we now use record indexes
	(first_hole_index, tree file).
	[60040a9d243f]

	* src/lib/network.c:
	Send error message if close() fails in net_disconnect().
	[792fc5b3daa4]

	* src/login/ssl-proxy.c:
	We didn't destroy the ssl connection after error in send.
	[eaaf0d2fea8d]

	* src/login/main.c, src/login/ssl-proxy.c:
	Don't warn about invalid sessions.
	[fec256b5f3fd]

2002-10-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-message-cache.c:
	imap_msgcache_get_rfc822_partial() calculated missing header size by
	actually reading it, instead of getting it from index file.
	[595aa6817b7f]

	* src/imap/cmd-select.c:
	\* flag was missing from PERMANENTFLAGS.
	[6b5814fd9e7d]

	* src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-rewrite.c:
	minor speedups
	[652553a9f54c]

2002-10-07  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/rfc822-address.c:
	Comments inside <> mail addresses crashed.
	[d1f925376da7]

	* src/lib-index/mail-index-open.c:
	"fast open" with (eg. used with STATUS) worked exactly opposite way,
	caching was done when "fast" was TRUE.
	[a78def4088c1]

	* src/lib-index/mail-tree-redblack.c:
	speedup
	[fb59a15622d0]

	* src/lib-index/mail-tree-redblack.c:
	mail_tree_lookup_uid_range() still buggy if first_uid wasn't found.
	[b319eb0fc181]

	* src/lib-index/mail-tree-redblack.c:
	sequence number still wasn't right always
	[225d515edaa1]

2002-10-06  Timo Sirainen  <tss@iki.fi>

	* src/lib/iobuffer.c:
	make io_buffer_send_flush() always removes the cork, even if there's
	nothing in output buffer.
	[356fe3713970]

	* TODO:
	updated with lots of new capability comments
	[fd1fc4cf11b7]

	* src/lib-index/mail-tree-redblack.c:
	still wrong seq
	[285b3ca58cf7]

	* src/lib-index/mail-tree-redblack.c:
	mail_tree_lookup_uid_range() didn't return correct seq number if the
	first UID wasn't found.
	[7f8b00d5ff68]

	* src/lib-index/mbox/mbox-lock.c:
	dotlock fixes: don't delete dotlock when we didn't create it (when
	removing a shared lock). if mbox file hasn't been changed for 5
	seconds, assume stale lock file.
	[5d2298649157]

	* src/lib/restrict-access.c:
	kludge: localtime() must be called before chroot(), or the timezone
	isn't known. fixes wrong timestamps with login process.
	[fb674793e75a]

	* src/login/ssl-proxy.c:
	Don't try to deinitialize gnutls if we haven't initialized it..
	[3ac9badb73ba]

	* src/lib-index/mbox/mbox-rewrite.c:
	Write Content-Length header for rewritten messages.
	[b0a62e264b22]

	* src/lib-imap/imap-message-cache.c, src/lib-index/mail-index-
	update.c, src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-
	fsck.c, src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-
	index.h, src/lib-index/mbox/mbox-rewrite.c, src/lib-mail/message-
	parser.c, src/lib-mail/message-parser.h, src/lib-storage/index
	/index-fetch-section.c, src/lib-storage/index/index-search.c:
	message_parse_header() now calls the function with empty name/value
	at end of headers. we use this feature with mbox to allow usage of
	Content-Length header field.
	[d037915978ca]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h:
	Compress index when 50% of it is deleted.
	[44751b4d92e1]

	* src/lib-index/mbox/mbox-lock.c:
	lockfix
	[9b36fc3c1385]

	* src/lib-index/mail-index.h, src/lib-index/mbox/mbox-lock.c:
	more locking fixes.
	[0da2b09461aa]

	* src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-lock.c, src
	/lib-index/mbox/mbox-lock.h, src/lib-index/mbox/mbox-rebuild.c, src
	/lib-index/mbox/mbox-rewrite.c, src/lib-storage/index/mbox/mbox-
	expunge.c, src/lib-storage/index/mbox/mbox-save.c:
	mbox locking cleanups
	[cb405d2f5fd5]

	* src/auth/master.c, src/auth/userinfo-passwd-file.c,
	src/imap/client.c, src/lib-imap/imap-message-cache.c, src/lib-index
	/mail-index-update-cache.c, src/lib-index/mail-index-util.c, src
	/lib-index/mail-index.h, src/lib-index/maildir/maildir-update.c, src
	/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.c, src
	/lib-index/mbox/mbox-index.h, src/lib-index/mbox/mbox-open.c, src
	/lib-index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-fetch.h, src/lib-storage/index
	/index-msgcache.c, src/lib-storage/index/index-search.c, src/lib-
	storage/index/mbox/mbox-expunge.c, src/lib-storage/index/mbox/mbox-
	save.c, src/lib/iobuffer.c, src/lib/iobuffer.h, src/login/auth-
	connection.c, src/login/client.c, src/master/auth-process.c,
	src/master/login-process.c, src/master/settings.c:
	Added io_buffer_set_start_offset() and io_buffer_ref() and replaced
	io_buffer_destroy() with io_buffer_unref().

	mbox file is now kept open all the time.
	[ea958a5b9de1]

	* src/auth/userinfo-passwd-file.c, src/lib-imap/imap-message-cache.c,
	src/lib-index/mail-index-update-cache.c, src/lib-index/mail-index-
	util.c, src/lib-index/maildir/maildir-open.c, src/lib-index/maildir
	/maildir-update.c, src/lib-index/mbox/mbox-fsck.c, src/lib-
	index/mbox/mbox-open.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-
	index/mbox/mbox-rewrite.c, src/lib-storage/index/index-copy.c, src
	/lib-storage/index/index-msgcache.c, src/lib-storage/index/index-
	search.c, src/lib-storage/index/mbox/mbox-expunge.c,
	src/lib/iobuffer.c, src/lib/iobuffer.h, src/master/settings.c:
	Added autoclose_fd-flag for io_buffer_create_file() and
	io_buffer_create_mmap().
	[567e932cdc66]

	* src/lib-index/mbox/mbox-rewrite.c:
	When updating any of the fields, keep them in the original location
	in header instead of moving to bottom.
	[aa449d013563]

	* src/lib-index/mail-index.c:
	Small optimization for mail_index_lookup() when there's only one
	hole in index file.
	[7a0be5e88815]

	* src/lib-index/mail-tree-redblack.c:
	guess it works now, debugging disabled now.
	[d57e5037db2c]

	* src/lib-index/mail-tree-redblack.c, src/lib-index/mail-tree.c:
	bugfixes
	[9fd132e47845]

	* src/lib-index/mail-index-data.c:
	If the data file was fully truncated, the mmap wasn't updated and it
	crashed later.
	[cf4b8f204aea]

	* src/lib-index/mail-tree-redblack.c:
	bad typo bug
	[16d22ccf3f54]

	* src/lib-index/mail-tree-redblack.c:
	crashfix when growing tree file size
	[a39343e9e197]

	* src/lib-index/Makefile.am, src/lib-index/mail-hash.c, src/lib-index
	/mail-hash.h, src/lib-index/mail-index-compress.c, src/lib-index
	/mail-index-open.c, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h, src/lib-index/mail-modifylog.c, src/lib-index/mail-tree-
	redblack.c, src/lib-index/mail-tree.c, src/lib-index/mail-tree.h,
	src/lib-index/maildir/maildir-index.c, src/lib-index/maildir
	/maildir-rebuild.c, src/lib-index/mbox/mbox-index.c, src/lib-
	index/mbox/mbox-rebuild.c, src/lib-storage/index/index-expunge.c,
	src/lib-storage/index/index-messageset.c, src/lib-storage/index
	/index-search.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-sync.c:
	First version of binary tree file, still some locking issues while
	opening the file.
	[0dc59fd3faed]

	* src/auth/userinfo-passwd-file.c:
	one final hpux fix.
	[c2269ed9ffcb]

	* NEWS, configure.in:
	0.98.4 released
	[ae6b163339a8]

	* src/lib-index/mbox/mbox-index.c, src/lib-storage/index/index-save.c,
	src/lib-storage/index/index-search.c:
	compiler warning fixes
	[693f93219218]

	* src/auth/auth-digest-md5.c, src/auth/userinfo-pam.c, src/auth
	/userinfo-passwd.c, src/auth/userinfo-shadow.c, src/login/client-
	authenticate.c:
	more compiler warnings fixes
	[adefba58053b]

	* src/lib/fdpass.c, src/lib/iobuffer.c, src/login/auth-connection.c,
	src/login/client.h:
	compiler fixes
	[2c6b6594a14b]

	* src/lib/network.c, src/lib/network.h:
	keep the port unsigned.
	[fd32faeb7ba5]

2002-10-05  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-parser.c, src/lib-index/mbox/mbox-append.c, src
	/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.h, src
	/lib-mail/message-parser.c:
	compiler warning fixes
	[f15420cb362d]

	* src/lib/mmap-anon.c:
	hpux compiler fix
	[5d8688afe0ad]

	* src/lib/md5.c:
	Fix for hpux ansi compiler.
	[19cb83563b20]

	* src/lib/fdpass.c:
	Define CMSG_SPACE always if it's undefined, not only if __sun__ is
	defined.
	[9efeeb4ac5a9]

2002-10-04  Timo Sirainen  <tss@iki.fi>

	* src/lib/ioloop.c:
	extra checks
	[2ee7f547201a]

	* src/lib-mail/message-send.c:
	message_send() didn't correctly add CR to 256k boundaries.
	[c756ed5a0351]

2002-10-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c:
	() was missing around envelope in body/bodystructure.
	[eeb855e385ce]

	* configure.in:
	0.98.3 version number update
	[39e430a0d212]

	* NEWS, TODO:
	0.98.3 out..
	[37d52d6a3e7a]

	* src/lib-imap/Makefile.am, src/lib-imap/imap-bodystructure.c, src
	/lib-imap/imap-envelope.c, src/lib-imap/imap-quote.c, src/lib-imap
	/imap-quote.h:
	Several fields in BODY were unquoted.
	[6f4eeb6a0a0d]

2002-09-30  Timo Sirainen  <tss@iki.fi>

	* TODO:
	update
	[36ab6a6c8bdf]

	* NEWS, TODO, configure.in:
	0.98.2 released
	[25f2b396c297]

	* src/lib-index/mbox/mbox-fsck.c:
	t_push() added
	[38bb7337df0c]

	* src/lib-mail/message-part-serialize.c:
	message_part_serialize_update_header() was still broken, it modified
	the start position of header record.
	[526ebe074df1]

	* src/lib-index/mail-index-update.c, src/lib-index/mail-index-util.c,
	src/lib-index/mail-index.h, src/lib-index/mbox/mbox-fsck.c, src/lib-
	index/mbox/mbox-index.c, src/lib-mail/message-part-serialize.c, src
	/lib-storage/index/index-msgcache.c:
	Cached MessagePart reading wasn't working because alignment broke
	the strict size checking.
	[e34e14d758eb]

	* src/lib-storage/index/maildir/maildir-copy.c:
	hardlink-COPY fixed.
	[fad3998041d4]

2002-09-29  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-append.c:
	cleanup
	[aeff4a271544]

	* src/master/common.h:
	cleanup
	[0903ba071661]

	* src/lib/mempool-alloconly.c, src/lib/mempool-system.c:
	more ANSI-C fixes.
	[1b503c732877]

	* src/lib-index/maildir/maildir-index.c, src/lib-index/mbox/mbox-
	index.c, src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	ANSI-C compatibility fixes
	[39c9a9fc190b]

	* configure.in:
	s/--enable/--with/ to all auth modules. added --with-file-offset-
	size=BITS
	[a0abed892d11]

	* src/lib-index/mail-modifylog.c, src/lib-index/mail-modifylog.h, src
	/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-messageset.c, src/lib-
	storage/index/index-messageset.h, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-sync.c, src/lib-storage/index
	/index-update-flags.c, src/lib-storage/index/maildir/maildir-copy.c,
	src/lib-storage/mail-storage.h:
	Modify log fixes. STORE and SEARCH didn't handle properly message
	sequence numbers when some in the middle were externally deleted.
	[276b7a53c264]

2002-09-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-fetch-section.c, src/lib-storage/index
	/index-fetch.c, src/lib-storage/index/index-fetch.h:
	cleanup
	[b79b6da2f84a]

	* src/imap/cmd-fetch.c, src/imap/cmd-search.c, src/imap/cmd-store.c,
	src/imap/commands-util.c, src/imap/commands-util.h, src/lib-
	storage/index/index-status.c, src/lib-storage/index/index-storage.c,
	src/lib-storage/index/index-storage.h, src/lib-storage/index/index-
	sync.c, src/lib-storage/mail-storage.h:
	Send RECENT after all EXISTS replies. Check for new mail in mailbox
	after each FETCH, STORE and SEARCH commands and notify about it with
	EXISTS.
	[ba058497efa9]

2002-09-27  Timo Sirainen  <tss@iki.fi>

	* src/login/auth-connection.c:
	if auth processes were killed, login process didn't reconnect to
	them
	[b7f6772b91ff]

2002-09-26  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-message-cache.c:
	Always return ENVELOPE, even if full of NILs.
	[cdd72de7214b]

	* src/lib/iobuffer.c:
	Handle mmap() failures better.
	[b3bbd1b0fbd7]

	* src/lib-mail/message-part-serialize.c:
	message_part_serialize_update_header() didn't update positions for
	subparts so they got broken with mbox when headers were updated.
	[2b2dc11ea0f6]

	* src/lib-index/mail-index-update-cache.c:
	fsck() before updating the cache.
	[fb2bb2d2b4a5]

	* src/imap/cmd-select.c, src/lib-storage/index/index-status.c, src
	/lib-storage/mail-storage.h:
	When selecting a mailbox and we're out of disk space, send ALERT to
	user telling about it.
	[d0cff4da67ac]

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-index-util.c:
	out of disk space -fixes
	[6f82f54b8e27]

2002-09-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/index-search.c:
	Only first search condition was checked.
	[79d9a40fbb72]

	* src/login/client-authenticate.c:
	If authentication failed, the failure message was written to output
	buffer but the buffer wasn't flushed.
	[0c1ff60e55e6]

2002-09-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c:
	custom flags weren't saved properly.
	[f07ad72a1c7e]

	* src/lib-storage/index/mbox/mbox-save.c:
	mbox ignored message flags for APPEND.
	[d2a305fa0ec2]

	* NEWS, TODO, configure.in:
	released 0.98.1
	[df941be7c6b0]

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-index.h, src
	/lib-index/mbox/mbox-rewrite.c:
	Rewrite only needed parts of mbox. We don't rename() anymore, which
	means we play nicely now with symlinks and avoid possible data loss
	when new mail was being sent while we were rewriting.
	[f5e59d65d124]

	* src/lib/iobuffer.c:
	io_buffer_send_iobuffer() didn't set buf_errno if sendfile() failed.
	[2cb72f8e0998]

	* src/lib-index/mbox/mbox-from.c:
	One digit day wasn't parsed correctly in From-line.
	[98e62bc03363]

	* src/lib/lib-signals.c:
	comment fix
	[5b20fb38ac92]

	* src/imap/cmd-append.c, src/lib-imap/imap-parser.c:
	We didn't allow saving messages longer than 8192 bytes. Now we also
	send the "+ OK" only after other parameters have been verified to be
	ok.
	[899d3e189dbf]

	* src/lib-imap/imap-bodystructure.c:
	BODY / BODYSTRUCTURE generator didn't like if message didn't start
	from zero offset in inbuf.
	[5954f9c2e620]

	* src/lib-index/mail-index-update.c:
	mail_index_update_headers() seeked always to beginning of file,
	instead of beginning of message, which broke mbox.
	[3f9c648d34db]

2002-09-23  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox
	/mbox-storage.c:
	CREATE and DELETE fixes for mbox (last changes for .98 :)
	[21a9d15025c7]

	* NEWS, TODO, configure.in:
	0.98 released.
	[fd304e62e88a]

	* src/lib-index/mbox/mbox-rewrite.c:
	Actually, first don't do anything if there's no dirty flags. Then
	fsck(). Then check again if fsck() removed the dirty flags.
	[19108e7c5af2]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-create.c,
	src/imap/cmd-rename.c, src/imap/cmd-subscribe.c, src/imap/commands-
	util.c, src/imap/commands-util.h:
	UNSUBSCRIBE wasn't working.
	[20769b7516a2]

	* src/lib-index/mbox/mbox-rewrite.c:
	fsck() before checking the rewrite-flag, so we won't write the
	1-byte files..
	[1d4d92c2e8c9]

	* src/lib-index/mbox/mbox-rewrite.c:
	keep exclusive lock while rewriting.
	[a101127403a7]

	* TODO:
	updated
	[696139d3b8f6]

	* src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-lock.c, src
	/lib-index/mbox/mbox-lock.h, src/lib-index/mbox/mbox-rebuild.c, src
	/lib-index/mbox/mbox-rewrite.c, src/lib-storage/index/mbox/mbox-
	expunge.c, src/lib-storage/index/mbox/mbox-save.c:
	mbox locking changes. support read-locking now. there's still
	problems though..
	[5509d87fe68b]

	* src/lib-index/mail-index-update-cache.c, src/lib-index/mbox/mbox-
	fsck.c, src/lib-index/mbox/mbox-lock.c, src/lib-index/mbox/mbox-
	rebuild.c, src/lib-index/mbox/mbox-rewrite.c:
	some cleanups + fd leaks when recaching mailbox.
	[ef6ae9e1b585]

	* src/imap/cmd-append.c, src/imap/cmd-copy.c, src/imap/cmd-select.c,
	src/imap/cmd-status.c, src/lib-index/mail-index-open.c, src/lib-
	index/mail-index.h, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-storage.c, src
	/lib-storage/mail-storage.h:
	Added fast-flag for mailbox opening, which doesn't do any index
	compressing or cache updating. This flag is set when mailbox is
	opened by APPEND, COPY or STATUS (ie. not SELECT/EXAMINE).
	[d66aa1f1fb2d]

	* src/imap/cmd-logout.c:
	close mailbox before sending "OK Logout completed", because the
	closing may take some time with mbox
	[c6c0e376008f]

	* src/lib-index/mbox/mbox-index.c:
	Better checking for the ending From-line, so it won't falsely check
	it in some outbox messages.
	[e6a00377af97]

	* TODO:
	updated
	[21d53f6b38fc]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-fsck.c,
	src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h:
	Handle properly messages which have only partial header (eg. new
	From-line comes before \n\n).
	[7a4fac415698]

	* src/lib-index/mail-index-compress.c:
	mail_index_compress_data() didn't set used_file_size in header
	[57a111fd821b]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-rewrite.c,
	src/lib-mail/message-parser.c, src/lib-storage/index/index-save.c,
	src/lib-storage/index/index-search.c, src/lib/iobuffer.c,
	src/lib/iobuffer.h:
	IOBuffer cleanup, hopefully fixes some mbox problems.
	[3dcc2275b4ca]

2002-09-22  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-fsck.c,
	src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h,
	src/lib-index/mbox/mbox-rebuild.c:
	Ignore empty lines at beginning of mbox file.
	[c020e1168cc3]

2002-09-21  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/Makefile.am:
	missing header file
	[0d75aa8b7344]

	* src/lib-index/mail-modifylog.c:
	switching modifylog crashed.
	[51eea5cbb075]

2002-09-20  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-fsck.c:
	mbox fsck() didn't like files containing only "\n". fsck also now
	resets dirty flag in header if it didn't find any dirty flags. this
	also fixes mbox_rewrite() creating those \n-files.
	[e5fdb222d38a]

	* src/lib-index/mail-index-data.c:
	wrong parameters to msync(), causing it to fail when trying to mark
	old data file deleted.
	[49e6f5496071]

	* dovecot-example.conf:
	list supported auth methods
	[8d7e46d41ce3]

	* configure.in:
	vpopmail needs also crypt()
	[00dbc7e5f441]

	* configure.in:
	list vpopmail in auths list.
	[536bb62e73bd]

	* configure.in:
	print "checking vpopmail"
	[b7fe6867e549]

	* acconfig.h, configure.in, dovecot-example.conf,
	src/auth/Makefile.am, src/auth/userinfo-vpopmail.c,
	src/auth/userinfo.c, src/auth/userinfo.h:
	vpopmail authentication. compiles, not tested if it really works.
	[fa2d1a1d025e]

	* src/master/main.c:
	Print usage with invalid parameters.
	[49f4b0be0d87]

	* src/lib-index/mail-index-data.c:
	mail_index_data_sync_file() now doesn't complain if mmap_used_length
	is 0
	[abd08fadb297]

	* src/lib-index/mail-index-compress.c, src/lib-index/mail-index-
	fsck.c, src/lib-index/mail-index.c:
	Index compression broke it + few other fixes
	[6173b306d276]

	* src/lib-index/mail-index-fsck.c:
	fsck() now prints what differences it found
	[406527c791c7]

2002-09-19  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-expunge.c:
	don't silently ignore if expunge can't unlink() some message.
	[910afdb348ae]

	* src/lib-index/maildir/maildir-index.c:
	rename() file first, only then update index if it was successful.
	[ce5b402f6a7a]

	* src/lib-storage/index/index-update-flags.c:
	STORE needs to sync too, or maildir could see old filenames.
	[9be2c12d0983]

	* src/lib-mail/message-content-parser.c:
	message_content_parse_header() didn't parse the header properly and
	just skipped all but the first parameter.
	[de8683b5bb16]

	* src/lib-index/mail-index-open.c:
	..better crashfix, to fix mbox crashes too..
	[bd51b6445bcd]

	* src/lib-index/mail-hash.c, src/lib-index/mail-index-open.c:
	crashed if index or hash was rebuilt
	[6dfdda80e822]

2002-09-17  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-storage/index/index-expunge.c:
	FSCK flag is removed at set_lock(), so it can't be directly set
	anywhere.. but using index->set_flags |= FSCK now keeps it. fixes
	mbox problems after flag changes.
	[a4eb58705351]

	* src/lib-storage/index/index-update-flags.c:
	Don't save \Recent flag to index.
	[7cb03d43a0ea]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-fsck.c,
	src/lib-storage/index/mbox/mbox-expunge.c:
	Handle 1-bytes mbox files (just \n) without any warnings, and
	expunging all mails now doesn't write the \n.
	[54b3b82bd73e]

	* src/lib-index/mbox/mbox-from.c, src/lib-storage/index/mbox/mbox-
	expunge.c, src/lib-storage/index/mbox/mbox-save.c:
	expunging last message from mbox duplicated the whole file.
	appending mail to mbox works now too.
	[757c32a1920d]

	* src/lib-mail/message-parser.c:
	message_parse_header() went to infinite loop with partial header
	[d0ba9a65891c]

2002-09-16  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-envelope.c:
	\r\n chars are now always stripped from headers before placing them
	in envelope.
	[483f4afe5da2]

	* src/lib-index/mail-hash.c, src/lib-index/mail-index-open.c, src/lib-
	index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-rebuild.c, src/lib-index/maildir/maildir-
	sync.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-storage/index
	/index-status.c:
	if hash was rebuilt, it wasn't always mmap()ed. recent-status wasn't
	updated properly when opening mails. maildir sync() didn't always
	expunge messages with correct sequence number. added some checks for
	messages_count in header.
	[30ee462a6457]

	* src/lib-index/mail-index-open.c:
	when opening index, sync before updating cached fields so it won't
	print warnings if mails were deleted
	[f5b444bf9157]

	* src/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	fetch.h, src/lib-storage/index/index-messageset.h:
	Report FETCH failure properly
	[29cf23950452]

	* src/imap/cmd-subscribe.c:
	UNSUBSCRIBE didn't work if folder didn't exist.
	[38282593753f]

	* src/lib-index/mail-modifylog.c:
	still wrong..
	[cdf38b5cc2b7]

	* src/lib-index/mail-modifylog.c:
	modifylog opening was buggy
	[0a45c4744f51]

	* src/lib-index/mail-modifylog.c:
	fixed some locking issues
	[90abe1af4c72]

	* src/lib-index/mail-index.c:
	mail_index_lookup() didn't always return correct record..
	[73a5f8a34893]

	* src/lib-index/mail-index-compress.c:
	bugfix
	[518f63be3723]

	* src/lib-index/mail-index.c:
	cleanup/fix
	[08135c37551a]

	* src/lib-mail/message-parser.c:
	message_parse_header() works now properly if there's no message body
	at all, or if the ending \n is missing from header.
	[62058959536a]

	* src/lib/file-set-size.c:
	file_set_size() was buggy when it was supposed to shrink file
	[14bad0a48eb4]

	* src/imap/cmd-status.c:
	bugfix
	[ff68d1f1e75b]

	* src/lib-index/mbox/mbox-index.c:
	don't set flags dirty when they were updated by external change
	[0c5832e58728]

	* src/lib-index/mail-index-data.c:
	data file wasn't initialized properly
	[f0a52521d844]

	* src/lib-index/mail-index-data.c:
	don't set mmap_used_length to 0 before msync()ing with it..
	[fbe3a420e960]

	* configure.in:
	report --without-gnutls better..
	[cba0daefb7a5]

	* configure.in:
	another typo .. maybe --without-gnutls works now :)
	[fa3b4c2e252a]

	* configure.in:
	typo..
	[9cae5f6626ff]

	* configure.in:
	added --without-gnutls option
	[bf1e284fece2]

	* src/lib/mmap-anon.c:
	..and don't #undef the linux mremap() support..
	[1f6f8e4557b1]

	* src/lib/mmap-anon.c:
	portability fixes
	[015910e16bfa]

	* src/lib-index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-
	rewrite.c:
	mbox fixes
	[fc8ad9d30478]

	* src/lib-index/mail-modifylog.c:
	fixes
	[5523767c0515]

	* src/lib-index/mail-hash.c:
	hash creation was buggy
	[1e05ff078961]

	* src/lib-index/mail-index.c:
	bugfixes
	[acb77be5d683]

	* src/imap/cmd-append.c, src/lib-index/mail-hash.c, src/lib-index
	/mail-index-data.c, src/lib-index/mail-index-open.c, src/lib-index
	/mail-index.c, src/lib-index/mail-modifylog.c, src/lib-index/maildir
	/maildir-sync.c, src/lib-storage/index/index-save.c:
	Fixes for no diskspace handling. seems to work now.
	[06d6eca0a45f]

	* src/lib/strfuncs.c:
	previous t_push()/t_pop() changes break things. fixed :)
	[400ac5f9ed40]

	* TODO:
	updated
	[1fe8eae6fd89]

	* src/lib-index/mail-hash.c, src/lib-index/mail-index-data.c, src/lib-
	index/mail-index.c, src/lib-index/mail-modifylog.c, src/lib-index
	/mail-modifylog.h:
	Modify log is now able to stay in memory. Some other fixes/cleanups.
	[aef7c7a8f691]

	* src/lib/strfuncs.c:
	t_push()/t_pop() around various *sprintf() functions, so "%m" format
	won't eat extra memory.
	[3f92df43cfa7]

2002-09-15  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-message-cache.c, src/lib-index/mbox/mbox-append.c,
	src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.c, src
	/lib-mail/message-parser.c, src/lib-mail/message-send.c, src/lib-
	mail/message-size.c, src/lib-storage/index/mbox/mbox-expunge.c,
	src/lib/iobuffer.c, src/lib/iobuffer.h:
	s/io_buffer_read_data/io_buffer_read_data_blocking/ and fixed the
	various kludges elsewhere to use it more easily
	[9277e893304e]

	* src/lib-index/mail-modifylog.c:
	we shouldn't crash anymore when modify log gets full
	[bbd248788571]

	* src/imap/cmd-status.c, src/lib-storage/index/index-status.c:
	minor fixes
	[fc1859e67253]

	* src/lib-index/mail-index.c:
	messages flags were added twice to header
	[9ef72cb26b30]

	* src/lib-index/mail-index.c:
	always verify the seen/deleted message counts in index header
	[a97509eb0bc3]

	* src/lib-storage/index/index-fetch-section.c:
	removed extra whitespace
	[2499dad2932b]

	* src/lib-index/mail-index-data.c:
	creating data file didn't work
	[a3fa2d4f441c]

	* acconfig.h:
	mremap check again..
	[c02b968d0378]

	* configure.in:
	mremap() check
	[e8863d6088fe]

	* src/lib-index/mail-hash.c, src/lib-index/mail-hash.h, src/lib-index
	/mail-index-compress.c, src/lib-index/mail-index-data.c, src/lib-
	index/mail-index-data.h, src/lib-index/mail-index.c, src/lib-index
	/mail-lockdir.c, src/lib-index/mail-modifylog.c, src/lib-
	storage/index/index-copy.c, src/lib-storage/index/index-fetch.c, src
	/lib-storage/index/index-save.c, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib/write-full.h:
	More cleanups. lib-storage should handle "out of disk space"
	conditions properly.
	[ca6967899c05]

2002-09-14  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c, src/lib-imap/imap-message-cache.c, src/lib-
	index/Makefile.am, src/lib-index/mail-custom-flags.c, src/lib-index
	/mail-hash.c, src/lib-index/mail-index-compress.c, src/lib-index
	/mail-index-data.c, src/lib-index/mail-index-data.h, src/lib-index
	/mail-index-fsck.c, src/lib-index/mail-index-open.c, src/lib-index
	/mail-index-util.c, src/lib-index/mail-index-util.h, src/lib-index
	/mail-index.c, src/lib-index/mail-index.h, src/lib-index/mail-
	modifylog.c, src/lib-index/maildir/maildir-build.c, src/lib-
	index/maildir/maildir-index.c, src/lib-index/maildir/maildir-open.c,
	src/lib-index/maildir/maildir-rebuild.c, src/lib-index/maildir
	/maildir-sync.c, src/lib-index/maildir/maildir-update.c, src/lib-
	index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-
	index/mbox/mbox-open.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-
	index/mbox/mbox-rewrite.c, src/lib-storage/index/index-copy.c, src
	/lib-storage/index/index-fetch-section.c, src/lib-storage/index
	/index-fetch.c, src/lib-storage/index/index-fetch.h, src/lib-
	storage/index/index-messageset.c, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/maildir/maildir-copy.c, src/lib-storage
	/subscription-file/subscription-file.c, src/lib/Makefile.am, src/lib
	/file-lock.c, src/lib/file-lock.h, src/lib/file-set-size.c, src/lib
	/file-set-size.h, src/lib/mmap-anon.c, src/lib/mmap-util.c, src/lib
	/mmap-util.h:
	lots of cleanups. also index/datafile is now capable of staying in
	memory, as long as it's noticed while opening the index.
	[cf4d065f2f85]

2002-09-13  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-hash.c, src
	/lib-index/mail-index-compress.c, src/lib-index/mail-index-data.c,
	src/lib-index/mail-index-data.h, src/lib-index/mail-index-update.c,
	src/lib-index/mail-index-util.c, src/lib-index/mail-index-util.h,
	src/lib-index/mail-index.c, src/lib-index/mail-modifylog.c, src/lib-
	index/maildir/maildir-build.c, src/lib-index/maildir/maildir-
	index.c, src/lib-index/maildir/maildir-open.c, src/lib-index/maildir
	/maildir-rebuild.c, src/lib-index/maildir/maildir-sync.c, src/lib-
	index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.c, src/lib-
	index/mbox/mbox-index.h, src/lib-index/mbox/mbox-open.c, src/lib-
	index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-rewrite.c, src
	/lib-index/mbox/mbox-sync.c, src/lib-storage/index/index-status.c,
	src/lib/Makefile.am, src/lib/file-set-size.c, src/lib/file-set-
	size.h, src/lib/mmap-util.c, src/lib/mmap-util.h:
	Added extra functions for easier printing of error messages. Moved
	file_set_size() to generic function in lib. If there's no space to
	build hash file, it builds itself in anon-mmaped memory and stays
	there.
	[ed0d5b17c7a4]

	* src/lib/failures.c, src/lib/failures.h:
	make sure failure handlers don't modify errno.
	[94382d79ae47]

2002-09-11  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-data.c:
	Index data file wasn't re-mmap()ed always when file size was
	changed, resulting in corruption error messages.
	[79ae841efc11]

2002-09-10  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index.c:
	expunge() shouldn't update mmap, since we could be just going
	through the index records.
	[e506203cffa4]

	* src/lib-index/mbox/mbox-rewrite.c:
	Don't fsck() at mbox_index_rewrite() if there's no dirty flags.
	[b426c07093d3]

	* src/lib-storage/index/index-search.c:
	SEARCH fixes
	[12f056754b7b]

	* src/lib/iobuffer.c:
	io_buffer_read_mmaped() now also returns correct amount of bytes
	[6a18c1cf4d68]

	* src/lib/iobuffer.c:
	fixes for io_buffer_read_max()
	[05a1cf2761da]

	* src/lib-index/mbox/mbox-open.c:
	cleanup
	[2a2ab4994b8a]

	* src/lib-mail/message-parser.c:
	message/rfc822 mime parts weren't parsed correctly
	[4327b1266604]

	* src/lib-storage/index/index-search.c:
	crashfix for searching from message body
	[9ee27ef24ab8]

	* src/lib-index/mail-index.c:
	Actually, don't bother fsyncing after each written mail, it slows
	down too much and the corruption can be handled later just fine.
	[78df368a395b]

	* src/lib-index/mail-index.h, src/lib-index/mbox/mbox-index.c, src
	/lib-index/mbox/mbox-rewrite.c:
	Don't rewrite mbox if no flags were changed.
	[d85a6898bf39]

	* src/lib-index/mail-index-update.c:
	Date-field wasn't saved when ENVELOPE was cached into index.
	[8617d7a36fd6]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-build.c, src/lib-index/maildir/maildir-
	index.c, src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-
	index.c:
	Broke saving new mail
	[9f78db959fdc]

	* src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-build.c, src/lib-index/mbox/mbox-append.c:
	cleanups / reliability fixes
	[0bb7bf7266ab]

	* src/lib-index/mail-index-data.c:
	error message update
	[ad2ceb287fce]

2002-09-09  Timo Sirainen  <tss@iki.fi>

	* src/lib/compat.h:
	cast i_toupper() and i_tolower() return as char, so comparing
	highascii works without casting (breaks if comparing to unsigned
	char though)
	[f0f49949009b]

	* src/lib-mail/rfc822-date.c:
	typofix for parsing 'S' timeszone
	[24dda549b0ce]

	* src/lib-imap/imap-envelope.c:
	Highascii + space at end of some ENVELOPE header got into infinite
	loop.
	[70646fbf2c35]

	* src/login/ssl-proxy.c:
	crashfix if client closed before SSL handshake was done
	[16cc35217bfb]

	* src/lib-imap/imap-message-cache.c:
	crashfix
	[16ae7b6a2f0b]

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-modifylog.c,
	src/lib-storage/index/index-save.c, src/lib/iobuffer.h:
	custom flag & copy crash fixes.
	[cf1279829ad1]

	* src/lib-storage/index/mbox/mbox-expunge.c:
	EXPUNGE works with mbox. finally.
	[e6e5fd3d4718]

	* src/lib/iobuffer.c:
	offset wasn't updated properly to output buffers with sendfile().
	[38d77994baa5]

	* src/lib-index/mail-custom-flags.c, src/lib-index/mail-custom-
	flags.h, src/lib-index/mail-index.c, src/lib-index/mbox/mbox-
	append.c, src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-
	index.c, src/lib-index/mbox/mbox-index.h, src/lib-storage/index
	/index-storage.c, src/lib-storage/index/mbox/mbox-storage.c:
	X-IMAPbase is now parsed correctly.
	[95d21ab87eeb]

2002-09-08  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-util.c, src/lib-storage/index/index-
	msgcache.c, src/lib/hash.c, src/lib/macros.h, src/login/auth-
	connection.c, src/login/ssl-proxy.c, src/master/common.h, src/master
	/login-process.c:
	Replaced INT_TO_POINTER and POINTER_TO_INT macros with POINTER_CAST
	and POINTER_CAST_TO macros, the CAST_TO takes a parameter to which
	type we're casting to. Also POINTER_CAST should be valid ANSI-C now.
	[db6e288be0e9]

	* src/lib-index/mail-index-update.c, src/lib-index/mbox/mbox-fsck.c,
	src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-rewrite.c:
	more size_t fixes
	[d82e7d23a28d]

	* src/lib-imap/imap-bodystructure.c, src/lib-index/mail-hash.c, src
	/lib-index/mail-index-update.c, src/lib-index/mail-index.c, src/lib-
	index/mail-index.h, src/lib-index/mbox/mbox-fsck.c, src/lib-
	index/mbox/mbox-index.c, src/lib-storage/index/index-save.c,
	src/lib/macros.h, src/login/auth-connection.h:
	more size_t fixes.
	[c095607a1a28]

	* src/lib/lib.c, src/lib/temp-mempool.c:
	more size_t fixes
	[fcd6c11710b4]

	* configure.in:
	ssize_t should be checked against long before long long.
	[e5465a0c6964]

	* src/lib/iobuffer.c:
	size_t breakages
	[d80488b69f6c]

	* src/lib/iobuffer.c:
	forgot to change some ints into ssize_t
	[550398e31b88]

	* src/lib/lib.c:
	..and now it uses size_t properly..
	[88b31d45c8a4]

	* src/lib/lib.c, src/lib/lib.h, src/lib/macros.h:
	nearest_power() uses now size_t.
	[ecbff0f2b811]

	* configure.in:
	result of ssize_t check wasn't reported
	[041fb6098877]

	* configure.in:
	fixed ssize_t and off_t checks.
	[60925d3e2c4d]

	* src/auth/auth-digest-md5.c, src/auth/auth-interface.h, src/auth
	/auth-plain.c, src/auth/login-connection.c, src/auth/userinfo-
	passwd-file.c, src/imap/client.c, src/imap/cmd-append.c, src/lib-
	imap/imap-envelope.c, src/lib-imap/imap-envelope.h, src/lib-imap
	/imap-message-cache.c, src/lib-imap/imap-parser.c, src/lib-imap
	/imap-util.c, src/lib-index/mail-custom-flags.c, src/lib-index/mail-
	hash.c, src/lib-index/mail-index-data.c, src/lib-index/mail-index-
	data.h, src/lib-index/mail-index-update.c, src/lib-index/mail-
	index.h, src/lib-index/maildir/maildir-build.c, src/lib-index/mbox
	/mbox-append.c, src/lib-index/mbox/mbox-from.c, src/lib-index/mbox
	/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-index/mbox
	/mbox-rewrite.c, src/lib-mail/message-parser.c, src/lib-mail
	/message-parser.h, src/lib-mail/message-part-serialize.c, src/lib-
	mail/message-part-serialize.h, src/lib-mail/message-send.c, src/lib-
	mail/message-size.c, src/lib-mail/rfc822-date.c, src/lib-
	mail/rfc822-tokenize.c, src/lib-mail/rfc822-tokenize.h, src/lib-
	storage/index/index-fetch-section.c, src/lib-storage/index/index-
	save.c, src/lib-storage/index/index-search.c, src/lib-storage/index
	/index-storage.h, src/lib-storage/index/maildir/maildir-save.c, src
	/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.h, src/lib-storage/mail-storage.h, src/lib-storage
	/subscription-file/subscription-file.c, src/lib/base64.c,
	src/lib/base64.h, src/login/auth-connection.c, src/login/client-
	authenticate.c, src/login/ssl-proxy.c:
	move size_t fixes
	[4223b9ed0c80]

	* acconfig.h, configure.in, src/imap/commands-util.c, src/lib-imap
	/imap-bodystructure.c, src/lib-storage/index/index-fetch.c, src/lib-
	storage/index/index-search.c, src/lib/base64.c, src/lib/base64.h,
	src/lib/fdpass.c, src/lib/fdpass.h, src/lib/hex-binary.c, src/lib
	/hex-binary.h, src/lib/imem.c, src/lib/imem.h, src/lib/iobuffer.c,
	src/lib/iobuffer.h, src/lib/md5.c, src/lib/md5.h, src/lib/mempool-
	alloconly.c, src/lib/mempool-system.c, src/lib/mempool.c,
	src/lib/mempool.h, src/lib/mmap-util.c, src/lib/network.c,
	src/lib/network.h, src/lib/randgen.c, src/lib/randgen.h,
	src/lib/strfuncs.c, src/lib/strfuncs.h, src/lib/temp-mempool.c,
	src/lib/temp-mempool.h, src/lib/temp-string.c, src/lib/temp-
	string.h, src/lib/write-full.c:
	size_t fixes for lib/. Changed OFF_T_FORMAT to PRIuOFF_T which is
	more C99-like.
	[4a7ab9e94f25]

	* src/imap/Makefile.am:
	flags-file isn't needed anymore
	[7fc832e6bab4]

	* src/lib-storage/index/mbox/mbox-storage.c:
	mbox compilation fix
	[f1bdcf3448f6]

	* src/lib-index/mail-custom-flags.c, src/lib-index/mbox/mbox-append.c,
	src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.c, src
	/lib-index/mbox/mbox-index.h, src/lib-index/mbox/mbox-rewrite.c:
	partial changes to add X-IMAPbase parser update custom flags
	[38341ad6a9db]

	* acconfig.h, configure.in, src/lib/compat.h, src/lib/hostpid.c,
	src/lib/lib.h, src/lib/strfuncs.c, src/lib/strfuncs.h:
	added dec2str() function and largest_t type, removed itoa() and
	ltoa() macros and did some other cleanups.
	[0ffecd4e7e1a]

	* src/lib/macros.h:
	Better fix for POINTER_TO_UINT
	[f012779ee5ef]

	* src/lib/macros.h:
	POINTER_TO_UINT() fixed to not give warnings with 64bit pointers.
	[af686373b971]

	* src/lib/compat.c:
	missed header file with some conditions.
	[782a0d4baa71]

	* configure.in, src/lib-index/Makefile.am, src/lib-index/mail-custom-
	flags.c, src/lib-index/mail-custom-flags.h, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h, src/lib-storage/Makefile.am,
	src/lib-storage/flags-file/.cvsignore, src/lib-storage/flags-
	file/Makefile.am, src/lib-storage/flags-file/flags-file.c, src/lib-
	storage/flags-file/flags-file.h, src/lib-storage/index/index-copy.c,
	src/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	status.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/index-update-flags.c, src/lib-
	storage/index/maildir/maildir-save.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c:
	Moved custom flags handling into lib-index.
	[73bf05a1d862]

2002-09-07  Timo Sirainen  <tss@iki.fi>

	* src/login/ssl-proxy.c:
	nonblocking handshake was a bit buggy
	[61b0bb62b42e]

	* src/login/ssl-proxy.c:
	Don't log PUSH_ERRORs.
	[d638f42bf813]

	* src/imap/cmd-fetch.c, src/imap/cmd-store.c:
	updated error messages for FETCH/STORE when expunged messages were
	referenced. we use now exactly the same as rfc2180.
	[674d0067ea22]

	* src/lib-index/Makefile.am, src/lib-index/mail-messageset.c, src/lib-
	index/mail-messageset.h, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/index-copy.c, src/lib-storage/index/index-fetch.c, src
	/lib-storage/index/index-messageset.c, src/lib-storage/index/index-
	messageset.h, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-update-
	flags.c, src/lib-storage/index/maildir/maildir-copy.c:
	Moved lib-index/mail-messageset.* to lib-storage/index/index-
	messageset.*.
	[4716cf66c2cc]

	* src/lib-index/mail-messageset.c:
	Put back the "not all messages were found" error to
	mail_index_uidset_foreach(). Now it's only sent when they weren't
	found because they were just expunged and client wasn't notified
	yet, not when they don't exist anymore.
	[00e52ea54ed4]

	* src/lib-mail/message-parser.c:
	Don't strip extra spaces after "field: ".
	[53e8e405266b]

	* src/lib-imap/imap-envelope.c:
	Convert 8bit text in headers to quoted-printable in ENVELOPE.
	[bf5adc969d86]

2002-09-06  Timo Sirainen  <tss@iki.fi>

	* doc/multiaccess.txt:
	typofix
	[99a150cfc4e5]

	* src/lib-storage/index/index-save.c:
	minor cleanup
	[69b87c03ea8c]

	* src/lib-storage/index/index-save.c:
	comment update
	[628b12562e4b]

	* src/imap/client.c, src/lib-storage/index/index-save.c,
	src/lib/iobuffer.c, src/lib/iobuffer.h:
	Added io_buffer_read_blocking() which can be used to read data
	blockingly, but with a specified timeout. Client fds are now
	nonblocking and use it with APPEND fixing a possible infinite wait
	if client didn't send any data.
	[2660a5684515]

	* src/lib-index/mbox/mbox-index.c:
	comment cleanup
	[aeb4e8d48aa2]

	* src/lib-mail/message-part-serialize.c, src/lib-mail/message-part-
	serialize.h:
	continuing mbox updates
	[ad47775241a6]

	* src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h:
	Whops, didn't compile :) Removed beginning of wrong way to fix
	custom flags.
	[b045148bf408]

	* src/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-
	cache.h, src/lib-index/mail-index-update.c, src/lib-index/mail-
	index-util.c, src/lib-index/mail-index-util.h, src/lib-index/mail-
	index.c, src/lib-index/mail-index.h, src/lib-index/mail-modifylog.c,
	src/lib-index/mbox/Makefile.am, src/lib-index/mbox/mbox-append.c,
	src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-index.c, src
	/lib-index/mbox/mbox-index.h, src/lib-index/mbox/mbox-open.c, src
	/lib-index/mbox/mbox-rewrite.c, src/lib-index/mbox/mbox-sync.c, src
	/lib-storage/index/index-fetch.c, src/lib-storage/index/index-
	msgcache.c, src/lib-storage/index/index-save.c, src/lib-
	storage/index/index-search.c, src/lib-storage/index/mbox/mbox-
	storage.c:
	Bigger changes.. full_virtual_size was removed from index record and
	MessagePart caching is now forced. Also added per-message flags,
	including binary flags which can be used to check if CRs need to be
	inserted into message data.

	Added mbox-rewrite support which can be used to write out mbox file
	with updated flags. This still has the problem of being able to read
	changed custom flags, that'll require another bigger change.

	There's also several other mostly mbox related fixes.
	[ff05b320482c]

	* src/lib/network.c:
	net_accept() set listening socket nonblocking, not the new socket.
	thanks to james.antill@redhat.com for noticing.
	[e0193106a95d]

2002-09-05  Timo Sirainen  <tss@iki.fi>

	* src/imap/client.c:
	Flush output buffer to client at exit, and send a nice "BYE Server
	shutting down." message when we're being killed.
	[a1204e882bc7]

	* src/lib-index/mail-messageset.c:
	Allow UID messageset traversal to go past the synced messages.
	[2800791d1b31]

	* src/lib-storage/index/index-expunge.c:
	also, it shouldn't crash :)
	[e083f01122bb]

	* src/lib-storage/index/index-expunge.c:
	EXPUNGE shouldn't do "internal error" when there's nothing to
	expunge..
	[fd9bd2f01a75]

	* src/lib/iobuffer.c:
	io_buffer_send_iobuffer() was buggy with non-sendfile() method.
	[2dcabe0fd1cb]

2002-09-04  Timo Sirainen  <tss@iki.fi>

	* src/lib-mail/message-parser.c, src/lib/iobuffer.c:
	message_parse_header() was buggy with big headers, and
	io_buffer_read_data() should have returned the data so far even if
	it overflowed.
	[9660df1ca44f]

	* src/lib-storage/index/index-fetch-section.c:
	FETCH BODY[HEADER.FIELDS ...] wasn't working
	[7e1f18c5d708]

	* src/lib-index/mail-hash.c, src/lib-index/mail-hash.h, src/lib-index
	/mail-index-compress.c, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h:
	s/updateid/sync_id/ like it was with modify log.
	[e0f995ee5969]

	* src/lib-index/mail-index-compress.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h:
	index wasn't re-mmap()ed when it's size was changed. this is now
	done by updating "updateid" field in header and checking if it has
	changed. also the previous hash-rebuild-check was broken.
	[cb05d392ad24]

	* src/lib-index/mail-index.c:
	make sure the hash gets rebuilt if it wasn't opened yet when message
	was being expunged (probably unnecessary)
	[e1a810a57d4e]

	* src/lib-index/mail-messageset.c:
	mail_index_uidset_foreach() bugfix/cleanup for handling deleted
	messages
	[00b6ffc4d342]

	* src/lib-index/mail-index-compress.c:
	Hash wasn't updated when compressing the index
	[e35df75f639d]

	* src/lib-index/mail-index.c, src/lib-index/mail-messageset.c:
	more verbose error messages for hash corruption
	[124856b82684]

	* src/lib-index/mail-index.c:
	mail_index_mark_flag_changes() didn't update deleted-flag changes if
	there were seen-flag changes..
	[dd4c983dd0aa]

	* src/lib-index/mail-messageset.c:
	mail_index_uidset_foreach() still sometimes returned "Some messages
	weren't found".
	[b03fd5ed8ad1]

	* src/login/client.c:
	always use nonblocking I/O
	[0bb796d35d2a]

	* src/lib-storage/index/index-expunge.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/maildir/maildir-expunge.c, src/lib-
	storage/index/mbox/mbox-expunge.c:
	index_expunge_seek_first() now separates between "not found" and
	"failure". also updated it's error message to be more verbose.
	[524e78f870a2]

	* src/login/ssl-proxy.c:
	don't warn about UNEXPECTED_PACKET_LENGTH errors in SSL, they just
	mean the connection was dropped.
	[4d657b92448f]

	* src/lib-index/mail-messageset.c:
	mail_index_uidset_foreach() now never replies with "some messages
	weren't read". that's mostly a problem with non-UID fetches and a
	bit annoying to handle if last message was expunged.
	[f62c2eee1fa8]

	* src/lib-index/mail-index.c, src/lib-index/mail-messageset.c:
	verify that mail_hash_lookup_uid() returns offset to correct record.
	[71246aeb262d]

	* src/lib-storage/index/maildir/maildir-storage.c:
	more INBOX-sensitivity fixes
	[945063e0fb85]

2002-09-03  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	"CREATE Inbox.sub" created it using that case, instead of
	"INBOX.sub" which caused trouble.
	[5b631c4f95a1]

	* src/imap/commands-util.c, src/lib-storage/index/maildir/maildir-
	storage.c, src/lib-storage/index/mbox/mbox-storage.c:
	"Mailbox doesn't exist" error now gives the name of the mailbox that
	was tried to be accessed.
	[899ea73710fc]

	* src/lib-index/mail-modifylog.c:
	"revert back to shared lock" actually tried to set exclusive lock
	again
	[24c8fcb78e0e]

	* src/lib-index/mail-messageset.c:
	messageset traversal: if user function requested stop, we leaked
	t_pop().
	[2ec94f1bf60b]

	* src/lib/iobuffer.c, src/lib/iobuffer.h:
	s/io_buffer_send_buf/io_buffer_send_iobuffer/, also we set buf_errno
	when send or receiving fails, which can be checked later.
	[788d8536ee18]

	* src/lib-index/mail-hash.c:
	mail_hash_rebuild() now tries to lock itself, fixing crash if trying
	to rebuild hash when opening index
	[4dc5d31e2282]

	* src/lib-mail/message-send.c:
	Removed buffering, it's done by io_buffer_send() now.
	[4dd31e34e72f]

	* src/lib-index/mail-modifylog.c:
	mail_modifylog_try_lock() didn't check for EAGAIN error.
	[c2ec223e37ba]

	* src/lib-imap/imap-parser.c:
	because the iobuffer is now buffered, the "+ OK" continuation
	request wasn't actually sent to client .. we flush it now.
	[ed1c4a141118]

	* src/lib-index/mail-index.h:
	update
	[879dcb6e209a]

	* src/lib-index/mail-index.c, src/lib-index/maildir/maildir-build.c,
	src/lib-index/mbox/mbox-append.c:
	previous fix for updating initial message flags wasn't done
	correctly
	[90a604e78df1]

	* src/lib-index/mail-index.c, src/lib-index/maildir/maildir-build.c,
	src/lib-index/mbox/mbox-append.c:
	Flags for new messages weren't set properly, so the header sum
	counters were wrong.
	[cf7de0db6ba8]

	* src/lib-storage/index/index-copy.c:
	COPY was broken.
	[2c641eb4324b]

	* src/lib-storage/index/index-save.c:
	cleanups
	[0d18820ea7af]

	* src/lib-index/mail-messageset.c:
	If we notice hash corruption, we can't rebuild it because we're
	holding shared lock, not exclusive.. So, just fail and mark it to be
	rebuilt later.
	[8d07a46abfdd]

2002-09-02  Timo Sirainen  <tss@iki.fi>

	* src/lib/iobuffer.c:
	If we're corked, try to buffer the data instead of immediately
	trying to write it. But is less syscalls faster than memcpy()ing?..
	[9b87ee7cc19f]

	* src/lib-storage/index/maildir/maildir-save.c:
	APPEND always saved mails to INBOX with maildir.
	[f9522c8629b8]

	* src/lib-imap/imap-date.c:
	IMAP date+time parser bugfix
	[82f566bc9d85]

	* src/imap/cmd-append.c, src/lib-imap/Makefile.am, src/lib-imap/imap-
	date.c, src/lib-imap/imap-date.h, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-search.c:
	Whops, we were using RFC822 dates everywhere instead of IMAP dates.
	[2f67de235489]

	* src/lib-mail/rfc822-date.c:
	timezone check was wrong
	[8abce0f7d065]

	* src/imap/cmd-append.c, src/lib-storage/index/index-save.c:
	APPEND was broken.
	[97d0b9fcc18a]

	* src/lib/write-full.c:
	write_full(): behave correctly if given size was 0.
	[b1d05f79758f]

	* src/lib-index/mail-modifylog.c:
	fixes for modifylog opening
	[91e5141f994c]

	* src/lib-storage/index/index-storage.c:
	Reset index error message after it's been moved to storage.
	[0c3ffb677ad1]

	* src/lib-mail/message-part-serialize.c, src/lib-mail/message-part-
	serialize.h, src/lib-storage/index/index-msgcache.c:
	forgot to add before
	[76a3a6c0c452]

	* src/lib-imap/imap-bodystructure.c, src/lib-mail/message-parser.c,
	src/lib-mail/rfc822-address.c, src/lib-mail/rfc822-tokenize.c, src
	/lib-mail/rfc822-tokenize.h:
	Fixed rfc822_tokens_get_value(). It doesn't have "put spaces around
	all tokens" option anymore, but instead spaces are always put
	between atoms. This should fix address fields with non-7bit charset.
	[d6105a8a6ca9]

	* src/lib-storage/index/index-fetch-section.c, src/lib-storage/index
	/index-fetch.c, src/lib-storage/index/index-fetch.h:
	avoid sending extra spaces in FETCH reply.
	[8a9c6b71761f]

	* src/lib-index/mail-index.c:
	index->lookup_uid_range() optimization for first_uid <= first UID in
	mailbox.
	[63cd510c6598]

	* src/lib-storage/index/index-search.c:
	specifying messageset/uidset in SEARCH broke it
	[27fd7817b226]

	* src/lib-index/mail-index-update.c:
	when we figure out we should cache old body/bodystructure, use
	preparsed MessagePart from FIELD_TYPE_MESSAGEPART if it's already
	there.
	[eb0659c9841e]

	* src/lib/fdpass.c:
	removed useless (void *) cast.
	[e2fe8921e8ad]

	* src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-message-
	cache.c, src/lib-imap/imap-message-cache.h, src/lib-index/mail-
	index-update.c, src/lib-index/mail-index.h, src/lib-
	mail/Makefile.am, src/lib-mail/message-parser.c, src/lib-mail
	/message-parser.h, src/lib-storage/index/Makefile.am, src/lib-
	storage/index/index-fetch-section.c, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h:
	Added support for caching of MessagePart data. This is useful for
	fetching body[part]s. Also BODY and BODYSTRUCTURE can be generated
	fast using it.

	Also fixed index corruption in some situations when more cached data
	was added to index.
	[5fe3e04ca8d9]

2002-09-01  Timo Sirainen  <tss@iki.fi>

	* src/lib-imap/imap-bodystructure.c, src/lib-mail/message-parser.c,
	src/lib-mail/message-parser.h, src/lib-storage/index/index-fetch-
	section.c:
	there was no need for MessagePart->pos.virtual_pos, so removed it.
	[31034993473c]

2002-08-31  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mail-index-data.c, src/lib-index/mail-index-update.c,
	src/lib-index/mail-index.c, src/lib-index/mail-index.h, src/lib-
	index/maildir/maildir-index.c, src/lib-index/mbox/mbox-append.c, src
	/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-open.c, src
	/lib-index/mbox/mbox-sync.c:
	added index->lookup_field_raw() and update_field_raw(), changed mbox
	to save the offsets in raw uoff_t instead of hex encoded.
	[a6d7ed739926]

	* src/lib-index/mail-hash.c, src/lib-index/mail-index-data.c, src/lib-
	index/mail-index.c:
	Fixed some index rebuilding behaviour.
	[08186ac2784e]

	* src/lib-index/mail-index.c:
	".log.2" is also possible index file.
	[fc3383ac21a9]

	* dovecot-example.conf, src/lib-index/mail-index.c, src/lib-
	storage/index/maildir/maildir-list.c, src/master/imap-process.c,
	src/master/settings.c, src/master/settings.h:
	Added overwrite_incompatible_index setting. Also we now try to use
	only .imap.index-<hostname> and .imap.index index files instead of
	scanning the dir for any compatible index. This also fixes (partly)
	LIST giving \Marked flag when there's no new mails.
	[edc37d046b08]

2002-08-29  Timo Sirainen  <tss@iki.fi>

	* src/imap/cmd-select.c, src/lib-storage/flags-file/flags-file.c, src
	/lib-storage/index/index-status.c, src/lib-storage/mail-storage.h:
	Custom flags are now shown in FLAGS and PERMANENTFLAGS lists after
	SELECT. It also warns if there's for some reason a duplicate index
	number in custom flags file.
	[867ec80dbf42]

	* src/lib-index/maildir/maildir-build.c, src/lib-index/maildir
	/maildir-index.c, src/lib-index/maildir/maildir-index.h, src/lib-
	index/maildir/maildir-sync.c:
	Initial message flags weren't set from file name in maildir folders
	when new mail was added (or when index was built first time).
	[352c2567ba11]

	* src/login/client-authenticate.c:
	disable_plaintext_auth=yes didn't allow them even with TLS/SSL
	connections.
	[bac5a44da22b]

	* src/imap/cmd-list.c:
	Don't send \Children or \NoChildren flags for LIST anymore, we never
	supported the CHILDREN draft properly, and it's not becoming
	standard anyway. Get it back in when/if we add support for LISTEXT
	draft.
	[6f837354f2fe]

	* NEWS, TODO, configure.in:
	0.97 released
	[fb7500933a11]

	* src/lib-imap/imap-message-cache.c:
	allow 0 sized body
	[d0a9a516f00f]

	* src/lib-index/mail-messageset.c:
	added t_push() + t_pop() around the foreach-function call.
	[afa320f00439]

	* src/lib-index/mbox/mbox-open.c:
	mbox_open_mail() was buggy
	[858984f26cf8]

	* src/lib/iobuffer.c:
	warn if io_buffer_create_mmap() contains invalid size parameter
	[a73e43fa20e0]

	* src/lib-index/mail-index.c:
	bugfix for sync fix
	[dc0891523276]

	* src/lib-index/mail-modifylog.c:
	mail_modifylog_mark_synced() didn't update mmap
	[ccb155c2c93f]

	* src/lib-index/mail-index.c:
	reset modifylog sync mark at the end of opening index file
	[616d71338d52]

	* src/lib-index/mbox/mbox-fsck.c:
	mbox fix
	[20e979ad0b6d]

	* src/lib-index/mbox/mbox-index.c:
	fix
	[18f0d0952a7d]

	* src/lib-index/mbox/mbox-fsck.c:
	mbox fsck fixes
	[73e79cf8f496]

	* src/lib-index/mbox/mbox-sync.c:
	mbox fixes
	[5a4d07a88a8e]

	* src/lib/iobuffer.c:
	just removed useles line of code
	[954aadb2b2c2]

	* src/lib-index/mail-index.c:
	last_lookup wasn't reset after mmap(). still feels somewhat buggy
	though..
	[a437489953da]

2002-08-28  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-append.c:
	maybe now?
	[438d5f258b01]

	* src/lib-index/mbox/mbox-append.c:
	fixes..
	[1dfa3c9d60ef]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-sync.c:
	more fixes
	[2876947b8d38]

	* src/lib-index/mbox/mbox-append.c:
	more fix fixes (maybe i should test these before committing :)
	[d1407cb2b39b]

	* src/lib-index/mbox/mbox-append.c:
	yet more mbox fix fixes
	[0d8bfff71b80]

	* src/lib-index/mbox/mbox-open.c:
	fix to previous mbox fix :)
	[51b449a2a56b]

	* src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-sync.c:
	mbox fixes
	[8035cf09b913]

	* src/lib/iobuffer.c:
	IOBuffer was buggy if start_offset wasn't 0
	[7418fefb57a8]

	* src/lib-index/mbox/mbox-sync.c:
	Don't fsck mbox every time it's opened.
	[d6ab9aa7e105]

	* src/lib-index/mbox/mbox-lock.c:
	Notify if waiting for release of mbox dotlock failed.
	[2841fc79578f]

	* src/lib/mempool-alloconly.c, src/lib/temp-mempool.c:
	Still memaligns
	[c081870db35c]

	* src/lib/temp-mempool.c:
	More alignment fixes
	[12746cf2e447]

	* src/login/client-authenticate.c:
	crashfix
	[0e58a036265e]

	* src/lib-index/mail-hash.h, src/lib-index/mail-index.c, src/lib-index
	/mail-index.h:
	MailHashHeader is now 8-byte aligned. Fixed other header alignments
	too and stored MEM_ALIGN_SIZE into compat_data[].
	[8cef827d2d79]

	* src/lib/strfuncs.c:
	t_strsplit(): bad typobug..
	[9381df54c9c3]

	* src/lib/mempool-alloconly.c, src/lib/mempool-system.c:
	Allocated memory wasn't aligned according to MEM_ALIGN_SIZE.
	[b28ac4106d5a]

	* src/lib-storage/index/index-search.c:
	wrong assert()s :)
	[f239e9a2c96c]

	* configure.in:
	added -Wcast-qual to list of "remember to test with" cflags :)
	[168e0bd616b6]

	* src/auth/auth-digest-md5.c, src/auth/cookie.c, src/auth/userinfo-
	passwd.c, src/auth/userinfo-shadow.c, src/imap/cmd-fetch.c,
	src/imap/commands.c, src/lib/network.c, src/lib/strfuncs.c,
	src/lib/strfuncs.h, src/login/client-authenticate.c:
	added t_strdup_noconst() which can be used instead of (char *)
	t_strdup(). Removed several castings that removed the const
	qualifier.
	[83ae914a583a]

	* src/lib/iobuffer.c, src/lib/strfuncs.c:
	casting fixes
	[8740373ee20e]

	* src/lib/randgen.c, src/lib/randgen.h:
	removed const attribute from buffer argument for random_fill(), that
	really shouldn't have been there..
	[4bcf3ff12c60]

	* TODO:
	updated
	[2ffff61ee5e1]

	* configure.in, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h:
	Use 8 byte memory alignment by default. Also fixed index headers a
	bit to be 8 byte aligned.
	[4ecb78d94182]

	* src/lib/hash.c, src/lib/temp-mempool.c:
	Don't include system headers before lib.h, since config.h may change
	their behaviour (64bit off_t)
	[296c6dbf50a5]

	* src/lib/Makefile.am, src/lib/iobuffer.c, src/lib/sendfile-util.c,
	src/lib/sendfile-util.h:
	sendfile() works now properly with 64bit off_t
	[8aaa39e7aec8]

	* src/lib/lib.h:
	config.h should be included first.
	[2d2e2594e60f]

	* configure.in, src/lib/compat.h, src/lib/iobuffer.c, src/lib/lib.h,
	src/lib/strfuncs.h:
	64bit off_t fixes
	[62fc6c729962]

	* configure.in:
	whops, 64bit support was disabled.
	[db8ea2c11ab7]

	* src/login/ssl-proxy.c:
	Last changes broke SSL. Also handshaking is now non-blocking.
	[71fc142c2d7b]

	* src/lib-index/mail-index-data.c, src/lib-index/mail-index-update.c,
	src/lib-index/mail-index.c:
	bugfixes for overflow checks :)
	[37a388fe4dab]

	* src/lib-index/mail-index-compress.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h, src/lib-storage/index/index-expunge.c, src
	/lib-storage/index/index-status.c, src/lib-storage/index/index-
	sync.c:
	More overflow fixes.
	[d5f0f634b86e]

	* src/lib-storage/index/index-search.c:
	Some cleanups, assertion fixes.
	[b4adc3429867]

2002-08-27  Timo Sirainen  <tss@iki.fi>

	* acconfig.h, configure.in, src/imap/cmd-fetch.c, src/lib-imap/imap-
	bodystructure.c, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	message-cache.c, src/lib-imap/imap-message-cache.h, src/lib-imap
	/imap-parser.c, src/lib-imap/imap-parser.h, src/lib-index/mail-
	hash.c, src/lib-index/mail-hash.h, src/lib-index/mail-index-
	compress.c, src/lib-index/mail-index-data.c, src/lib-index/mail-
	index-data.h, src/lib-index/mail-index-fsck.c, src/lib-index/mail-
	index-update.c, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h, src/lib-index/mail-messageset.c, src/lib-index/mail-
	modifylog.c, src/lib-index/maildir/maildir-sync.c, src/lib-
	index/mbox/mbox-append.c, src/lib-index/mbox/mbox-from.c, src/lib-
	index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-open.c, src/lib-
	index/mbox/mbox-rebuild.c, src/lib-index/mbox/mbox-sync.c, src/lib-
	mail/message-parser.c, src/lib-mail/message-parser.h, src/lib-mail
	/message-send.c, src/lib-mail/message-send.h, src/lib-mail/message-
	size.c, src/lib-mail/message-size.h, src/lib-storage/flags-file
	/flags-file.c, src/lib-storage/index/index-fetch-section.c, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-save.c, src
	/lib-storage/index/index-search.c, src/lib-storage/mail-storage.h,
	src/lib/iobuffer.c, src/lib/iobuffer.h, src/lib/lib.h,
	src/lib/strfuncs.c, src/lib/temp-string.c, src/master/main.c:
	Introduced uoff_t which is the unsigned-equilevant of off_t. This
	was needed to be able to handle off_t overflows properly. Also
	changed a few unsigned int fields into uoff_t so we should now
	support >2G mails if uoff_t is 64bit. Also fixed several potential
	integer overflows.
	[d493b9cc265e]

	* src/lib-mail/rfc822-date.c:
	Year was set wrong in date parser. We'll also now do full checking
	for date string to make sure we don't overflow/underflow anything.
	[6be018ca51ef]

	* src/lib-index/mail-index-compress.c, src/lib-index/mail-index-
	data.c, src/lib-index/mail-index-data.h, src/lib-index/mail-index-
	update-cache.c, src/lib-index/mail-index.h:
	More cleanups / potential overflow fixes
	[5e9cf9565353]

	* src/lib-index/mail-messageset.c, src/lib-index/mail-messageset.h,
	src/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	fetch.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-update-
	flags.c, src/lib-storage/index/maildir/maildir-copy.c:
	Errors in user-specified messagesets are now properly reported back
	to user.
	[306c20092a96]

	* src/lib-storage/index/index-search.c:
	fixes for messageset handling
	[b2bc8d2e56ff]

	* src/lib-index/mail-hash.c:
	Hash is now properly rebuilt if errors are noticed while opening it.
	[d8ff9a34ed03]

	* src/lib/hash.c, src/lib/primes.c, src/lib/primes.h:
	Changed behaviour of primes_closest() to return given number back if
	it's a prime itself.
	[e399e33d033d]

	* src/lib/mmap-util.c:
	Fail if we try to mmap() files larger than 2G fully to memory
	[526284657da7]

	* src/lib-index/mail-hash.c, src/lib-index/mail-hash.h:
	If hash file was rebuilt, other processes didn't notice that. Also
	added several extra checks to make sure we never overflow anything
	unexpectedly.
	[1ab58549429d]

	* src/login/auth-connection.c:
	"Authentication server isn't connected, try again later.." error is
	sent to user when imap-auth hasn't been connected to for some
	reason.
	[38681cf8c4cd]

	* src/login/auth-connection.c:
	Automatically try to reconnect imap-auths once in a second if any of
	them weren't connected properly. Immediate reconnection was also
	removed, so we don't eat all CPU now if imap-auth behaves badly.
	[1ba4156fe84f]

	* src/lib/iobuffer.c:
	io_buffer_send() was buggy
	[0757e34063ec]

	* src/login/ssl-proxy.c:
	removed warnings when SSL support is disabled.
	[2a56fca685a2]

	* src/login/client.c, src/login/main.c, src/login/ssl-proxy.c,
	src/login/ssl-proxy.h, src/master/main.c:
	Some fixes to checking if SSL should be used.
	[8b4c5ea7e6da]

	* src/master/main.c:
	imaps host was resolved wrong
	[2d6f60efa704]

	* dovecot-example.conf, src/auth/main.c, src/imap/main.c,
	src/login/main.c, src/master/main.c, src/master/settings.c,
	src/master/settings.h:
	Added log_path and log_timestamp settings to config file. Removed -l
	command line option for imap-master.
	[b420373f88f6]

2002-08-26  Timo Sirainen  <tss@iki.fi>

	* src/auth/userinfo-pam.c, src/auth/userinfo-passwd-file.c, src/auth
	/userinfo-passwd.c, src/auth/userinfo-shadow.c, src/lib/network.c,
	src/master/imap-process.c:
	fixed compile warnings with some systems
	[a3d77e73f99b]

	* src/lib-index/mail-index.c:
	A bit better index file truncating: Truncate it also when first hole
	reaches to end of file, even if all messages weren't deleted.
	[148cdb150e64]

	* src/lib-index/mail-messageset.c:
	reset error message so we don't fail before we're looking at an old
	failure..
	[b7d7474cbcb2]

	* src/lib-index/mail-index.c:
	when all mail is deleted, truncate the index files.
	[33e86ee7d167]

	* src/lib-storage/index/mbox/mbox-save.c:
	Make sure mbox file ends with \n when appending new mail to it
	[8509281fda72]

	* TODO, src/lib-index/Makefile.am, src/lib-index/mail-hash.c, src/lib-
	index/mail-hash.h, src/lib-index/mail-index-compress.c, src/lib-
	index/mail-index-data.c, src/lib-index/mail-index-data.h, src/lib-
	index/mail-index.c, src/lib-index/mail-index.h, src/lib-index/mail-
	modifylog.c, src/lib-storage/flags-file/flags-file.c, src/lib-
	storage/index/index-save.c, src/lib-storage/index/mbox/mbox-save.c,
	src/lib-storage/subscription-file/subscription-file.c,
	src/lib/Makefile.am, src/lib/write-full.c, src/lib/write-full.h:
	Added write_full() which is a simple wrapper around write() meant
	for writing into files.

	When there's too much deleted data in index files, they're now
	compressed when the index is being opened.
	[e9375147c0cb]

	* src/lib/fdpass.c:
	comment update
	[6ac07b3fe0ff]

	* dovecot-example.conf:
	default to PAM authentication
	[f182971ba39d]

2002-08-25  Timo Sirainen  <tss@iki.fi>

	* src/lib-storage/index/maildir/maildir-storage.c:
	Don't allow '\' character in mailbox name.
	[91e73c5bb8f3]

	* src/lib-index/Makefile.am, src/lib-index/mail-index-update-cache.c,
	src/lib-index/mail-index-update.c, src/lib-index/mail-index.c, src
	/lib-index/mail-index.h, src/lib-index/maildir/maildir-update.c, src
	/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-from.c, src
	/lib-index/mbox/mbox-index.c, src/lib-storage/index/index-fetch.c:
	after a few times of trying to access uncached fields, they're
	cached the next time mailbox is opened. also some mbox fixes.
	[55e09f36d23d]

	* src/lib-storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/mbox/mbox-storage.c:
	Don't allow using "../" anywhere in mailbox names.
	[e8de6f485c65]

2002-08-24  Timo Sirainen  <tss@iki.fi>

	* src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox/mbox-sync.c:
	mbox fixes, fsck and sync seems to work now.
	[6cefb1763f3e]

	* src/imap/main.c, src/lib-imap/imap-message-cache.c, src/lib-imap
	/imap-message-cache.h, src/lib-imap/imap-parser.c, src/lib-
	index/Makefile.am, src/lib-index/mail-index-update.c, src/lib-index
	/mail-index.h, src/lib-index/mbox/Makefile.am, src/lib-index/mbox
	/mbox-append.c, src/lib-index/mbox/mbox-fsck.c, src/lib-index/mbox
	/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-index/mbox
	/mbox-open.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-index/mbox
	/mbox-sync.c, src/lib-storage/index/index-copy.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage.c, src/lib-storage/mail-storage.h,
	src/lib/iobuffer.c, src/lib/iobuffer.h:
	mbox fixes, not fully working yet but almost :)
	[a946ce1f09b7]

2002-08-23  Timo Sirainen  <tss@iki.fi>

	* COPYING, src/lib/md5.c, src/lib/md5.h:
	Replaced the MD5 implementation with Solar Designer's.
	[163675942b83]

	* src/lib/strfuncs.h:
	added MAX_LONG_STRLEN and ltoa() macro
	[df8438cd8a43]

	* src/lib/hex-binary.h:
	comment update
	[a766fb2132de]

	* TODO:
	updated
	[6491ac40cdf5]

	* src/lib-mail/message-send.c:
	bugfix
	[b4e760cf04c3]

	* src/lib-storage/index/index-fetch.c:
	call imap_message_close() at the end of FETCH, so no message files
	are left open.
	[3de6ef1b50cb]

	* src/lib-mail/message-send.c, src/lib-mail/message-send.h:
	message_send() buffers data now instead of making lots of write()
	calls, so it should be faster.
	[e01bf167b27c]

2002-08-22  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-allocfree.h:
	not needed
	[af70462f5ca1]

	* TODO, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-storage/index/mbox
	/mbox-save.c, src/lib-storage/index/mbox/mbox-storage.c, src/lib-
	storage/mail-storage.c, src/lib-storage/mail-storage.h:
	"Critical errors" aren't displayed to users anymore, ie. anything
	that is not a predefined human readable error message is written
	into log file and user gets only "Internal error [timestamp]".
	[bb294faf7379]

	* src/lib-imap/Makefile.am, src/lib-imap/imap-message-send.c, src/lib-
	imap/imap-message-send.h, src/lib-mail/Makefile.am, src/lib-mail
	/message-send.c, src/lib-mail/message-send.h, src/lib-storage/index
	/index-fetch-section.c, src/lib-storage/index/index-fetch.c:
	moved lib-imap/imap-message-send.* into lib-mail/message-send.*
	[a4423c83b2b0]

	* TODO:
	updated
	[e285afe55c48]

	* src/auth/auth-digest-md5.c, src/auth/auth-plain.c, src/auth/auth.c,
	src/auth/auth.h, src/auth/cookie.c, src/auth/cookie.h, src/auth
	/login-connection.c, src/auth/main.c, src/auth/master.c,
	src/imap/client.c, src/imap/cmd-list.c, src/imap/cmd-store.c,
	src/imap/commands-util.c, src/lib-imap/imap-bodystructure.c, src
	/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-cache.h,
	src/lib-index/mail-index-update.c, src/lib-index/mail-index.h, src
	/lib-index/mail-messageset.c, src/lib-index/mail-messageset.h, src
	/lib-index/maildir/maildir-sync.c, src/lib-index/mbox/mbox-append.c,
	src/lib-index/mbox/mbox-fsck.c, src/lib-mail/message-content-
	parser.c, src/lib-mail/message-content-parser.h, src/lib-mail
	/message-parser.c, src/lib-mail/message-parser.h, src/lib-
	mail/rfc822-tokenize.c, src/lib-mail/rfc822-tokenize.h, src/lib-
	storage/flags-file/flags-file.c, src/lib-storage/flags-file/flags-
	file.h, src/lib-storage/index/index-copy.c, src/lib-storage/index
	/index-fetch-section.c, src/lib-storage/index/index-fetch.c, src
	/lib-storage/index/index-fetch.h, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-storage.c, src/lib-
	storage/index/index-storage.h, src/lib-storage/index/index-sync.c,
	src/lib-storage/index/index-update-flags.c, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-expunge.c, src/lib-storage/index/maildir/maildir-list.c,
	src/lib-storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/mbox-expunge.c, src/lib-storage/index/mbox/mbox-
	list.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-storage
	/mail-search.c, src/lib-storage/mail-search.h, src/lib-storage/mail-
	storage.h, src/lib-storage/subscription-file/subscription-file.c,
	src/lib-storage/subscription-file/subscription-file.h,
	src/lib/hash.c, src/lib/hash.h, src/lib/iobuffer.c,
	src/lib/iobuffer.h, src/lib/ioloop-internal.h, src/lib/ioloop-
	poll.c, src/lib/ioloop-select.c, src/lib/ioloop.c, src/lib/ioloop.h,
	src/login/auth-connection.c, src/login/auth-connection.h, src/login
	/client-authenticate.c, src/login/client.c, src/login/client.h,
	src/login/main.c, src/login/master.c, src/login/master.h, src/login
	/ssl-proxy.c, src/master/auth-process.c, src/master/auth-process.h,
	src/master/login-process.c, src/master/main.c:
	s/user_data/context/ and some s/Data/Context/
	[82b7de533f98]

	* src/lib-imap/imap-message-cache.h, src/lib-mail/message-parser.c,
	src/lib-mail/message-parser.h, src/lib-mail/message-size.c,
	src/lib/iobuffer.c:
	fixes, seems to be somewhat working now.
	[21c8e080150d]

	* src/lib/strfuncs.c:
	added some extra asserts
	[2d8711a043a0]

	* src/lib-mail/message-parser.c:
	removed useless p_free() calls
	[5ce1e8ca79bb]

	* src/lib/mmap-util.c:
	mmap_aligned() was buggy
	[622e22c0486f]

	* configure.in, src/auth/auth-digest-md5.c, src/auth/login-
	connection.c, src/auth/userinfo-passwd-file.c, src/auth/userinfo.h,
	src/imap/client.c, src/imap/cmd-fetch.c, src/imap/cmd-list.c, src
	/lib-imap/imap-bodystructure.c, src/lib-imap/imap-bodystructure.h,
	src/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-
	cache.h, src/lib-imap/imap-message-send.c, src/lib-imap/imap-
	message-send.h, src/lib-imap/imap-parser.c, src/lib-
	index/Makefile.am, src/lib-index/mail-hash.c, src/lib-index/mail-
	index-data.c, src/lib-index/mail-index-fsck.c, src/lib-index/mail-
	index-update.c, src/lib-index/mail-index.c, src/lib-index/mail-
	index.h, src/lib-index/mail-modifylog.c, src/lib-index/maildir
	/maildir-build.c, src/lib-index/maildir/maildir-index.c, src/lib-
	index/maildir/maildir-index.h, src/lib-index/maildir/maildir-open.c,
	src/lib-index/maildir/maildir-sync.c, src/lib-index/maildir/maildir-
	update.c, src/lib-index/mbox/mbox-append.c, src/lib-index/mbox/mbox-
	fsck.c, src/lib-index/mbox/mbox-index.c, src/lib-index/mbox/mbox-
	index.h, src/lib-index/mbox/mbox-open.c, src/lib-index/mbox/mbox-
	sync.c, src/lib-mail/message-parser.c, src/lib-mail/message-
	parser.h, src/lib-mail/message-size.c, src/lib-mail/message-size.h,
	src/lib-storage/flags-file/flags-file.c, src/lib-storage/index
	/index-copy.c, src/lib-storage/index/index-fetch-section.c, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-save.c, src
	/lib-storage/index/index-search.c, src/lib-storage/index/maildir
	/maildir-storage.c, src/lib-storage/index/mbox/mbox-save.c, src/lib-
	storage/index/mbox/mbox-storage.c, src/lib-storage/mail-storage.c,
	src/lib-storage/mail-storage.h, src/lib-storage/subscription-file
	/subscription-file.c, src/lib/compat.c, src/lib/compat.h,
	src/lib/imem.c, src/lib/imem.h, src/lib/iobuffer.c,
	src/lib/iobuffer.h, src/lib/mmap-util.c, src/lib/strfuncs.c,
	src/lib/strfuncs.h, src/login/auth-connection.c,
	src/master/settings.c:
	Message data is parsed in blocks (no longer entirely mmap()ed).
	Several IOBuffer changes. All mixed signed/unsigned comparisions
	were fixed so code can now be compiled with gcc's -W flag. mbox
	support is broken currently, and there's most likely several other
	problems too.
	[1b34ec11fff8]

2002-08-13  Timo Sirainen  <tss@iki.fi>

	* src/lib/mempool-allocfree.c:
	not needed
	[744588369401]

2002-08-09  Timo Sirainen  <tss@iki.fi>

	* NEWS:
	moved ChangeLog into NEWS, ChangeLog will contain CVS changes now
	[d2c29e0e2570]

	* src/lib-storage/.cvsignore:
	updated
	[3b288990eb37]

	* COPYING, src/lib-storage/Makefile.am:
	fixes
	[6d0a30d1197c]

	* .cvsignore, .inslog2, AUTHORS, COPYING.LGPL, Makefile.am, NEWS,
	README, TODO, acconfig.h, autogen.sh, configure.in, doc/.cvsignore,
	doc/Makefile.am, doc/auth.txt, doc/design.txt, doc/index.txt,
	doc/multiaccess.txt, doc/nfs.txt, dovecot-example.conf,
	src/.cvsignore, src/Makefile.am, src/auth/.cvsignore,
	src/auth/Makefile.am, src/auth/auth-digest-md5.c, src/auth/auth-
	interface.h, src/auth/auth-plain.c, src/auth/auth.c,
	src/auth/auth.h, src/auth/common.h, src/auth/cookie.c,
	src/auth/cookie.h, src/auth/login-connection.c, src/auth/login-
	connection.h, src/auth/main.c, src/auth/master.c, src/auth/userinfo-
	pam.c, src/auth/userinfo-passwd-file.c, src/auth/userinfo-passwd.c,
	src/auth/userinfo-passwd.h, src/auth/userinfo-shadow.c,
	src/auth/userinfo.c, src/auth/userinfo.h, src/imap/.cvsignore,
	src/imap/.psrc, src/imap/Makefile.am, src/imap/client.c,
	src/imap/client.h, src/imap/cmd-append.c, src/imap/cmd-
	authenticate.c, src/imap/cmd-capability.c, src/imap/cmd-check.c,
	src/imap/cmd-close.c, src/imap/cmd-copy.c, src/imap/cmd-create.c,
	src/imap/cmd-delete.c, src/imap/cmd-examine.c, src/imap/cmd-
	expunge.c, src/imap/cmd-fetch.c, src/imap/cmd-list.c, src/imap/cmd-
	login.c, src/imap/cmd-logout.c, src/imap/cmd-lsub.c, src/imap/cmd-
	noop.c, src/imap/cmd-rename.c, src/imap/cmd-search.c, src/imap/cmd-
	select.c, src/imap/cmd-status.c, src/imap/cmd-store.c, src/imap/cmd-
	subscribe.c, src/imap/cmd-uid.c, src/imap/cmd-unsubscribe.c,
	src/imap/commands-util.c, src/imap/commands-util.h,
	src/imap/commands.c, src/imap/commands.h, src/imap/common.h,
	src/imap/main.c, src/lib-imap/.cvsignore, src/lib-imap/Makefile.am,
	src/lib-imap/imap-bodystructure.c, src/lib-imap/imap-
	bodystructure.h, src/lib-imap/imap-envelope.c, src/lib-imap/imap-
	envelope.h, src/lib-imap/imap-match.c, src/lib-imap/imap-match.h,
	src/lib-imap/imap-message-cache.c, src/lib-imap/imap-message-
	cache.h, src/lib-imap/imap-message-send.c, src/lib-imap/imap-
	message-send.h, src/lib-imap/imap-parser.c, src/lib-imap/imap-
	parser.h, src/lib-imap/imap-util.c, src/lib-imap/imap-util.h, src
	/lib-index/.cvsignore, src/lib-index/Makefile.am, src/lib-index
	/mail-hash.c, src/lib-index/mail-hash.h, src/lib-index/mail-index-
	data.c, src/lib-index/mail-index-data.h, src/lib-index/mail-index-
	fsck.c, src/lib-index/mail-index-update.c, src/lib-index/mail-index-
	util.c, src/lib-index/mail-index-util.h, src/lib-index/mail-index.c,
	src/lib-index/mail-index.h, src/lib-index/mail-lockdir.c, src/lib-
	index/mail-lockdir.h, src/lib-index/mail-messageset.c, src/lib-index
	/mail-messageset.h, src/lib-index/mail-modifylog.c, src/lib-index
	/mail-modifylog.h, src/lib-index/maildir/.cvsignore, src/lib-
	index/maildir/Makefile.am, src/lib-index/maildir/maildir-build.c,
	src/lib-index/maildir/maildir-index.c, src/lib-index/maildir
	/maildir-index.h, src/lib-index/maildir/maildir-open.c, src/lib-
	index/maildir/maildir-rebuild.c, src/lib-index/maildir/maildir-
	sync.c, src/lib-index/maildir/maildir-update.c, src/lib-
	index/mbox/.cvsignore, src/lib-index/mbox/Makefile.am, src/lib-
	index/mbox/mbox-append.c, src/lib-index/mbox/mbox-fsck.c, src/lib-
	index/mbox/mbox-index.c, src/lib-index/mbox/mbox-index.h, src/lib-
	index/mbox/mbox-lock.c, src/lib-index/mbox/mbox-lock.h, src/lib-
	index/mbox/mbox-open.c, src/lib-index/mbox/mbox-rebuild.c, src/lib-
	index/mbox/mbox-sync.c, src/lib-mail/.cvsignore, src/lib-
	mail/Makefile.am, src/lib-mail/message-content-parser.c, src/lib-
	mail/message-content-parser.h, src/lib-mail/message-parser.c, src
	/lib-mail/message-parser.h, src/lib-mail/message-size.c, src/lib-
	mail/message-size.h, src/lib-mail/rfc822-address.c, src/lib-
	mail/rfc822-address.h, src/lib-mail/rfc822-date.c, src/lib-
	mail/rfc822-date.h, src/lib-mail/rfc822-tokenize.c, src/lib-
	mail/rfc822-tokenize.h, src/lib-storage/.cvsignore, src/lib-
	storage/Makefile.am, src/lib-storage/flags-file/.cvsignore, src/lib-
	storage/flags-file/Makefile.am, src/lib-storage/flags-file/flags-
	file.c, src/lib-storage/flags-file/flags-file.h, src/lib-
	storage/index/.cvsignore, src/lib-storage/index/Makefile.am, src
	/lib-storage/index/index-copy.c, src/lib-storage/index/index-
	expunge.c, src/lib-storage/index/index-fetch-section.c, src/lib-
	storage/index/index-fetch.c, src/lib-storage/index/index-fetch.h,
	src/lib-storage/index/index-save.c, src/lib-storage/index/index-
	search.c, src/lib-storage/index/index-status.c, src/lib-
	storage/index/index-storage.c, src/lib-storage/index/index-
	storage.h, src/lib-storage/index/index-sync.c, src/lib-storage/index
	/index-update-flags.c, src/lib-storage/index/maildir/.cvsignore, src
	/lib-storage/index/maildir/Makefile.am, src/lib-
	storage/index/maildir/maildir-copy.c, src/lib-storage/index/maildir
	/maildir-expunge.c, src/lib-storage/index/maildir/maildir-list.c,
	src/lib-storage/index/maildir/maildir-save.c, src/lib-
	storage/index/maildir/maildir-storage.c, src/lib-
	storage/index/maildir/maildir-storage.h, src/lib-
	storage/index/mbox/.cvsignore, src/lib-
	storage/index/mbox/Makefile.am, src/lib-storage/index/mbox/mbox-
	expunge.c, src/lib-storage/index/mbox/mbox-list.c, src/lib-
	storage/index/mbox/mbox-save.c, src/lib-storage/index/mbox/mbox-
	storage.c, src/lib-storage/index/mbox/mbox-storage.h, src/lib-
	storage/mail-search.c, src/lib-storage/mail-search.h, src/lib-
	storage/mail-storage.c, src/lib-storage/mail-storage.h, src/lib-
	storage/subscription-file/.cvsignore, src/lib-storage/subscription-
	file/Makefile.am, src/lib-storage/subscription-file/subscription-
	file.c, src/lib-storage/subscription-file/subscription-file.h,
	src/lib/.cvsignore, src/lib/Makefile.am, src/lib/base64.c,
	src/lib/base64.h, src/lib/compat.c, src/lib/compat.h,
	src/lib/failures.c, src/lib/failures.h, src/lib/fdpass.c,
	src/lib/fdpass.h, src/lib/gmtoff.c, src/lib/gmtoff.h,
	src/lib/hash.c, src/lib/hash.h, src/lib/hex-binary.c, src/lib/hex-
	binary.h, src/lib/hostpid.c, src/lib/hostpid.h, src/lib/imem.c,
	src/lib/imem.h, src/lib/iobuffer.c, src/lib/iobuffer.h, src/lib
	/ioloop-internal.h, src/lib/ioloop-poll.c, src/lib/ioloop-select.c,
	src/lib/ioloop.c, src/lib/ioloop.h, src/lib/lib-signals.c, src/lib
	/lib-signals.h, src/lib/lib.c, src/lib/lib.h, src/lib/macros.h,
	src/lib/md5.c, src/lib/md5.h, src/lib/mempool-allocfree.c, src/lib
	/mempool-allocfree.h, src/lib/mempool-alloconly.c, src/lib/mempool-
	system.c, src/lib/mempool.c, src/lib/mempool.h, src/lib/mmap-util.c,
	src/lib/mmap-util.h, src/lib/network.c, src/lib/network.h,
	src/lib/primes.c, src/lib/primes.h, src/lib/randgen.c,
	src/lib/randgen.h, src/lib/restrict-access.c, src/lib/restrict-
	access.h, src/lib/strfuncs.c, src/lib/strfuncs.h, src/lib/temp-
	mempool.c, src/lib/temp-mempool.h, src/lib/temp-string.c, src/lib
	/temp-string.h, src/lib/unlink-directory.c, src/lib/unlink-
	directory.h, src/lib/unlink-lockfiles.c, src/lib/unlink-lockfiles.h,
	src/login/.cvsignore, src/login/.psrc, src/login/Makefile.am,
	src/login/auth-connection.c, src/login/auth-connection.h, src/login
	/client-authenticate.c, src/login/client-authenticate.h,
	src/login/client.c, src/login/client.h, src/login/common.h,
	src/login/main.c, src/login/master.c, src/login/master.h, src/login
	/ssl-proxy.c, src/login/ssl-proxy.h, src/master/.cvsignore,
	src/master/.psrc, src/master/Makefile.am, src/master/auth-process.c,
	src/master/auth-process.h, src/master/common.h, src/master/imap-
	process.c, src/master/login-process.c, src/master/login-process.h,
	src/master/main.c, src/master/master-interface.h,
	src/master/settings.c, src/master/settings.h, stamp.h.in:
	Initial revision
	[3b1985cbc908]

